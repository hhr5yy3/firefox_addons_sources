"use strict";(self.webpackChunkchrome_extension=self.webpackChunkchrome_extension||[]).push([[18,60],{45948:function(e,n,t){var r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(n,"__esModule",{value:!0}),n.useBnplSuggestionAtCheckoutWidgetInnerState=void 0;var o=r(t(96540)),a=r(t(95093)),i=t(55015),s=t(7444),c=t(31229),u=t(46239),l=t(89710),d=t(74617),p=t(59003),f=t(94700);function m(e,n){var t={offerId:e.offerId,fromScreen:"browserCheckoutButton",isTemporaryUser:n};(0,u.sendMessageToBackgroundScript)({message:"logUserEvent",data:{event:{type:"clickedPayWithJoko",payload:t}}}),(0,u.sendMessageToBackgroundScript)({message:"logAmplitudeEvent",data:{event:{type:"BNPL - Clicked Pay with Joko",properties:t}}})}n.useBnplSuggestionAtCheckoutWidgetInnerState=function(e){var n=(0,i.useUserRegion)(),t=(0,c.useIsTemporaryUser)(),r=(0,f.useWidgetDisplay)(),y=r.isWidgetDisplayed,h=r.closeWidget,v=r.onWidgetInnerStateLoadEnd,_=(0,s.useAppFeature)(i.Feature.shouldUseFactorizedBnplSubscriptionWidgetIntoPanelInExtensions),g=o.default.useCallback((function(){t||_?(m(e,t),h(),(0,d.displayPanelAndLogEvents)({offer:e,bnpl:{isBnplSectionEnabledForOffer:!0,shouldOpenBnplSubscription:!t,isFromBnplSuggestionAtCheckoutWidget:!0},isTemporaryUser:t,userOfferActivationInfo:void 0,defaultPanelLocationOverride:{panelTab:i.PanelTab.offerDetails,offerDetailsSection:i.OfferDetailsSection.bnpl}},"bnplSuggestionAtCheckoutWidget")):((0,p.displayBnplSubscriptionWidget)({offer:e,isFromBnplSuggestionAtCheckoutWidget:!0}),m(e,t),h()),(0,l.handleUserInterfaceComponentInteractionInBackgroundOrLoadTrackingLink)({offer:e,triggeringEventType:i.UserInterfaceComponentInteractionEventType.bnplSuggestionAtCheckoutWidgetStartButton})}),[e,t,_]),b=o.default.useCallback((function(){var n;!function(e,n){var t={offerId:e.offerId,offerType:e.type,isTemporaryUser:n,widgetType:"bnplSuggestionAtCheckout"};(0,u.sendMessageToBackgroundScript)({message:"logUserEvent",data:{event:{type:"closedBrowserExtensionWidget",payload:t}}}),(0,u.sendMessageToBackgroundScript)({message:"logAmplitudeEvent",data:{event:{type:"Browser Extension - Widget Closed",properties:t}}})}(e,t),h();var r=(0,a.default)().unix();(0,i.setLocalStorageItem)(i.LocalStorageKey.lastDismissedBnplSuggestionAtCheckoutWidgetAt,r),(0,i.updateLocalStorageItem)(i.LocalStorageKey.lastDismissedBnplSuggestionAtCheckoutWidgetTimestampMap,((n={})[e.offerId]=r,n))}),[e,t]);return o.default.useEffect(v,[]),{onClickCloseButton:b,onClickDisplayBnplSubscriptionWidget:g,userRegion:n,isWidgetDisplayed:y}}},14568:function(e,n,t){var r=this&&this.__awaiter||function(e,n,t,r){return new(t||(t=Promise))((function(o,a){function i(e){try{c(r.next(e))}catch(e){a(e)}}function s(e){try{c(r.throw(e))}catch(e){a(e)}}function c(e){var n;e.done?o(e.value):(n=e.value,n instanceof t?n:new t((function(e){e(n)}))).then(i,s)}c((r=r.apply(e,n||[])).next())}))},o=this&&this.__generator||function(e,n){var t,r,o,a,i={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return a={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function s(s){return function(c){return function(s){if(t)throw new TypeError("Generator is already executing.");for(;a&&(a=0,s[0]&&(i=0)),i;)try{if(t=1,r&&(o=2&s[0]?r.return:s[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,s[1])).done)return o;switch(r=0,o&&(s=[2&s[0],o.value]),s[0]){case 0:case 1:o=s;break;case 4:return i.label++,{value:s[1],done:!1};case 5:i.label++,r=s[1],s=[0];continue;case 7:s=i.ops.pop(),i.trys.pop();continue;default:if(!(o=i.trys,(o=o.length>0&&o[o.length-1])||6!==s[0]&&2!==s[0])){i=0;continue}if(3===s[0]&&(!o||s[1]>o[0]&&s[1]<o[3])){i.label=s[1];break}if(6===s[0]&&i.label<o[1]){i.label=o[1],o=s;break}if(o&&i.label<o[2]){i.label=o[2],i.ops.push(s);break}o[2]&&i.ops.pop(),i.trys.pop();continue}s=n.call(e,i)}catch(e){s=[6,e],r=0}finally{t=o=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,c])}}},a=this&&this.__read||function(e,n){var t="function"==typeof Symbol&&e[Symbol.iterator];if(!t)return e;var r,o,a=t.call(e),i=[];try{for(;(void 0===n||n-- >0)&&!(r=a.next()).done;)i.push(r.value)}catch(e){o={error:e}}finally{try{r&&!r.done&&(t=a.return)&&t.call(a)}finally{if(o)throw o.error}}return i},i=this&&this.__spreadArray||function(e,n,t){if(t||2===arguments.length)for(var r,o=0,a=n.length;o<a;o++)!r&&o in n||(r||(r=Array.prototype.slice.call(n,0,o)),r[o]=n[o]);return e.concat(r||Array.prototype.slice.call(n))},s=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(n,"__esModule",{value:!0}),n.checkIsBnplEnabled=n.checkIsBnplEnabledForOffer=n.useCreateUserBnplTransactionStartPollingAndHandleNavigation=n.formatPhoneNumber=n.checkIsNameValid=n.checkDoesContainOnlyDigits=n.isFormattedBirthDateValid=n.checkIsEmailValid=n.checkShouldAskEmailForAppleUser=n.isPhoneNumberValid=n.useBnplUserInformation=n.checkIsFloaPaymentSessionReady=n.checkIsFloaEligibilityAccepted=n.useUpdateProvisionedUserBnplTransactionsLocalStorage=n.handleUnfinishedBnplSubscription=n.handleRefreshUserBnplTransactionsInLocalStorage=n.getUserBnplTransactionsFromLocalStorage=n.useUserBnplTransactionsFromBackend=n.useUserBnplTransactionWithPolling=n.useUserBnplTransaction=void 0;var c=s(t(96540)),u=s(t(95093)),l=t(55015),d=t(47615),p=t(7444),f=t(32668),m=t(31229),y=t(46239),h=t(72886),v=t(13897),_=6e5,g="provisionedUserBnplTransactionsLocalStorage";function b(e){var n=a(c.default.useState(void 0),2),t=n[0],r=n[1],o=a(c.default.useState(!1),2),i=o[0],s=o[1];return c.default.useEffect((function(){if(i){var n=setInterval((function(){(0,y.sendMessageToBackgroundScript)({message:"getUserBnplTransaction",data:{createdAt:(0,u.default)(e).unix()}},(function(e){(null==e?void 0:e.bnplTransaction)&&r(e.bnplTransaction)}))}),500),t=setTimeout((function(){return clearInterval(n)}),_);return function(){clearInterval(n),clearTimeout(t)}}}),[i]),{userBnplTransaction:t,startPolling:function(){return s(!0)},stopPolling:function(){return s(!1)}}}function C(e,n){return e.offerId===n&&e.status===l.BnplTransactionStatus.provisioned}function S(e){return Date.now()-new Date(e.createdAt).getTime()<864e5}function T(e){return!!e.swanPaymentCard&&e.swanPaymentCard.hasEverReceivedAnAuthorization}function I(e){localStorage.setItem(g,JSON.stringify(e.map((function(e){return{createdAt:e.createdAt,amount:e.amount,status:e.status,offerId:e.offerId}}))))}function A(){return r(this,void 0,void 0,(function(){return o(this,(function(e){switch(e.label){case 0:return[4,new Promise((function(e){return(0,y.sendMessageToBackgroundScript)({message:"getUserBnplTransactions"},(function(n){return e((null==n?void 0:n.bnplTransactions)?n.bnplTransactions:void 0)}))}))];case 1:return[2,e.sent()]}}))}))}function E(e){if(!e)return!1;try{return new RegExp("^(0|\\+".concat(l.PHONE_NUMBER_PREFIX_INDICATOR,")[6-7](\\d{2}){4}$"),"g").test(e.replace(/\s/g,""))}catch(e){return!1}}function k(e){var n=!(!e||!O(e)||function(e){return/@privaterelay\.appleid\.com/.test(e)}(e));return!n}function O(e){return/^[^\s@]+@[^\s@]+\.[^\s@]{2,}$/.test(e)}function P(e){var n=(0,u.default)(e,"DD/MM/YYYY"),t=/^\d{1,2}\/\d{1,2}\/\d{4}$/.test(e),r=n.isValid(),o=n<(0,u.default)(),a=n>=(0,u.default)("01/01/1900","DD/MM/YYYY");return t&&r&&o&&a}function w(e){return/^[0-9]+$/.test(e)}function L(e){return/^[a-zA-Z\u00C0-\u017F']+(?:[-\s][a-zA-Z\u00C0-\u017F']+)*$/.test(e)}n.useUserBnplTransaction=function(e){var n=a(c.default.useState(void 0),2),t=n[0],r=n[1];return c.default.useEffect((function(){(0,y.sendMessageToBackgroundScript)({message:"getUserBnplTransaction",data:{createdAt:(0,u.default)(e).unix()}},(function(e){(null==e?void 0:e.bnplTransaction)&&r(e.bnplTransaction)}))}),[]),t},n.useUserBnplTransactionWithPolling=b,n.useUserBnplTransactionsFromBackend=function(e){var n=function(){var e=a(c.default.useState(void 0),2),n=e[0],t=e[1];return c.default.useEffect((function(){(0,y.sendMessageToBackgroundScript)({message:"getUserBnplTransactions"},(function(e){(null==e?void 0:e.bnplTransactions)&&t(e.bnplTransactions)}))}),[]),n}(),t=(0,l.useHasFeature)(l.Feature.bnplNewCardReadyDisplayInExtensions);return c.default.useMemo((function(){if(void 0!==n){var r=n.filter((function(n){return C(n,e)&&S(n)&&(!t||!T(n))})).reverse();return I(r),r}}),[n,e,t])},n.getUserBnplTransactionsFromLocalStorage=function(e){if(!e)return[];var n=localStorage.getItem(g);return n?JSON.parse(n).filter((function(n){return C(n,e.offerId)&&S(n)})):[]},n.handleRefreshUserBnplTransactionsInLocalStorage=function(e){return r(this,void 0,void 0,(function(){var n;return o(this,(function(t){switch(t.label){case 0:return[4,A()];case 1:return void 0===(n=t.sent())||I(n.filter((function(n){return C(n,e)&&S(n)&&!T(n)})).reverse()),[2]}}))}))},n.handleUnfinishedBnplSubscription=function(e){var n=e.offer,t=e.unfinishedBnplSubscriptionStateByTabIdMap,r=e.tabId,o=e.isResumptionOfUnfinishedBnplSubscriptionOnUrlChangeEnabled,a=e.shouldUseFactorizedBnplSubscriptionWidgetIntoPanel;if(!(o&&n&&t&&r&&t[r]))return(0,h.submitWidgetDisplayDecision)({widgetName:h.PriorityOrderedWidgetName.bnplSubscriptionWidget,shouldDisplayWidget:!1}),!1;var i=t[r];return n.offerId!==i.offerId||i.updatedAt<Date.now()-9e5||i.currentBnplScreenName===l.BnplScreenName.cardErrorScreen?((0,v.removeUnfinishedBnplSubscriptionStateInLocalStorage)(r),(0,h.submitWidgetDisplayDecision)({widgetName:h.PriorityOrderedWidgetName.bnplSubscriptionWidget,shouldDisplayWidget:!1}),!1):((0,h.submitWidgetDisplayDecision)({widgetName:h.PriorityOrderedWidgetName.bnplSubscriptionWidget,shouldDisplayWidget:!0,props:{offer:n,unfinishedBnplSubscriptionState:i,shouldUseFactorizedBnplSubscriptionWidgetIntoPanel:a}}),!0)},n.useUpdateProvisionedUserBnplTransactionsLocalStorage=function(e){c.default.useEffect((function(){var n,t,r,o;if(e){var s=localStorage.getItem(g),c=s?JSON.parse(s):[];if(!c.some((function(n){return n.createdAt===e.createdAt}))){var u={createdAt:e.createdAt,amount:e.amount,status:e.status,offerId:e.offerId,panLastFourDigits:null!==(o=null===(r=null===(t=null===(n=e.swanPaymentCard)||void 0===n?void 0:n.confidentialCardData)||void 0===t?void 0:t.pan)||void 0===r?void 0:r.slice(-4))&&void 0!==o?o:null};localStorage.setItem(g,JSON.stringify(i([u],a(c),!1)))}}}),[e])},n.checkIsFloaEligibilityAccepted=function(e){var n;return!!((null===(n=null==e?void 0:e.amount)||void 0===n?void 0:n.valueInCents)&&e.floaEligibility&&e.floaEligibility.hasAgreement&&e.floaEligibilityInstallmentSchedule&&e.floaEligibilityInstallmentSchedule.eligibilityInstallments&&3===e.floaEligibilityInstallmentSchedule.eligibilityInstallments.length&&e.floaEligibilityInstallmentSchedule.eligibilityInstallments.every((function(e){return e.amount&&e.date&&e.rank})))},n.checkIsFloaPaymentSessionReady=function(e){var n;return!!((null===(n=null==e?void 0:e.lastFloaPaymentSession)||void 0===n?void 0:n.sessionId)&&e.lastFloaPaymentSession.sessionUrl&&e.lastFloaPaymentSession.status)},n.useBnplUserInformation=function(){var e=a(c.default.useState(),2),n=e[0],t=e[1],r=a(c.default.useState(),2),o=r[0],i=r[1],s=a(c.default.useState(),2),d=s[0],p=s[1],f=a(c.default.useState(),2),y=f[0],h=f[1],v=a(c.default.useState(),2),_=v[0],g=v[1],b=a(c.default.useState(),2),C=b[0],S=b[1],T=a(c.default.useState(),2),I=T[0],A=T[1],B=a(c.default.useState(),2),N=B[0],M=B[1],R=a(c.default.useState(),2),D=R[0],x=R[1],U=a(function(){var e=a(c.default.useState(void 0),2),n=e[0],t=e[1],r=c.default.useRef(n),o=/^\d{2}$|^\d{2}\/\d{2}$/,i=/^\d{3}$|^\d{2}\/\d{3}$/;return c.default.useEffect((function(){r.current&&n&&r.current.length<n.length&&(o.test(n)?t("".concat(n,"/")):i.test(n)&&t("".concat(n.slice(0,n.length-1),"/").concat(n[n.length-1]))),r.current=n}),[n]),[n,t]}(),2),F=U[0],W=U[1],H=a(c.default.useState(),2),G=H[0],j=H[1],V=a(c.default.useState(),2),K=V[0],q=V[1];!function(e){var n=e.setFirstName,t=e.setLastName,r=e.setBirthLastName,o=e.setPhoneNumber,a=e.setEmail,i=e.setBnplEmail,s=e.setGender,d=e.setFormattedBirthDate,p=e.setPostalAddress,f=e.setZipCode,y=e.setCity,h=e.setBirthFrenchDepartment,v=(0,m.useUser)();c.default.useEffect((function(){if(null==v?void 0:v.userInfo){if(v.userInfo.firstName&&n&&n(v.userInfo.firstName),v.userInfo.lastName&&t&&t(v.userInfo.lastName),v.userInfo.birthLastName&&r?r(v.userInfo.birthLastName):v.userInfo.lastName&&r&&r(v.userInfo.lastName),v.phoneNumber&&o&&o(v.phoneNumber),v.email&&a&&a(v.email),v.bnplEmail&&i&&i(v.bnplEmail),v.userInfo.gender&&(v.userInfo.gender===l.Gender.Male||v.userInfo.gender===l.Gender.Female)&&s&&s(v.userInfo.gender),v.userInfo.birthDate&&d){var e=u.default.utc(v.userInfo.birthDate).format("DD/MM/YYYY");P(e)&&d(e)}v.userInfo.postalAddress&&(v.userInfo.postalAddress.postalAddress&&p&&p(v.userInfo.postalAddress.postalAddress),v.userInfo.postalAddress.zipCode&&f&&f(v.userInfo.postalAddress.zipCode),v.userInfo.postalAddress.city&&y&&y(v.userInfo.postalAddress.city),v.userInfo.birthFrenchDepartment&&h&&h(v.userInfo.birthFrenchDepartment))}}),[v])}({setFirstName:t,setLastName:i,setBirthLastName:j,setPhoneNumber:p,setEmail:h,setBnplEmail:g,setGender:S,setFormattedBirthDate:W,setPostalAddress:A,setZipCode:x,setCity:M,setBirthFrenchDepartment:q});var z={firstName:n,lastName:o,phoneNumber:d,email:y,bnplEmail:_,gender:C,postalAddress:I,city:N,zipCode:D,formattedBirthDate:F,birthLastName:G,birthFrenchDepartment:K,setFirstName:t,setLastName:i,setPhoneNumber:p,setBnplEmail:g,setGender:S,setPostalAddress:A,setCity:M,setZipCode:x,setFormattedBirthDate:W,setBirthLastName:j,setBirthFrenchDepartment:q},J=function(e){var n=e.firstName,t=e.lastName,r=e.birthLastName,o=e.phoneNumber,a=e.email,i=e.bnplEmail,s=e.gender,u=e.postalAddress,d=e.city,p=e.zipCode,f=e.formattedBirthDate,m=e.birthFrenchDepartment;return c.default.useMemo((function(){return!!(n&&L(n)&&t&&L(t)&&r&&L(r)&&o&&E(o)&&(a&&!k(a)||i&&O(i))&&s&&[l.Gender.Male,l.Gender.Female].includes(s)&&u&&d&&p&&w(p)&&5===p.length&&f&&P(f)&&m)}),[n,t,r,o,i,s,u,d,p,f,m])}(z);return{bnplUserInformation:z,isBnplUserInformationValid:J}},n.isPhoneNumberValid=E,n.checkShouldAskEmailForAppleUser=k,n.checkIsEmailValid=O,n.isFormattedBirthDateValid=P,n.checkDoesContainOnlyDigits=w,n.checkIsNameValid=L,n.formatPhoneNumber=function(e){return null==e?void 0:e.replace(/\s/g,"").replace(/^0([6-7](\d{2}){4})$/,"+".concat(l.PHONE_NUMBER_PREFIX_INDICATOR,"$1"))},n.useCreateUserBnplTransactionStartPollingAndHandleNavigation=function(e){var n=e.offerId,t=a(c.default.useState(void 0),2),r=t[0],o=t[1],i=b(r),s=i.userBnplTransaction,l=i.startPolling,p=i.stopPolling,f=a(c.default.useState(!1),2),m=f[0],h=f[1];return(0,d.useEligibilityNavigation)({userBnplTransaction:s,isLoading:m,setIsLoading:h,userBnplTransactionCreatedAt:r,offerId:n}),{createUserBnplTransactionStartPollingAndHandleNavigation:function(e){n&&function(e){var n=e.setUserBnplTransactionCreatedAt,t=e.startPollingUserBnplTransaction,r=e.stopPollingUserBnplTransaction,o=e.valueInCents,a=e.offerId,i=u.default.utc().milliseconds(0).toISOString();n(i),s={createdAt:i,amount:{valueInCents:o,currency:"EUR"},offerId:a},(0,y.sendMessageToBackgroundScript)({message:"createUserBnplTransaction",data:s}),t(),setTimeout((function(){return r()}),_);var s}({setUserBnplTransactionCreatedAt:o,startPollingUserBnplTransaction:l,stopPollingUserBnplTransaction:p,valueInCents:e,offerId:n})},userBnplTransactionCreatedAt:r,isLoading:m,setIsLoading:h}},n.checkIsBnplEnabledForOffer=function(e){var n,t;return null===(t=null===(n=e.browserExtension)||void 0===n?void 0:n.bnpl)||void 0===t?void 0:t.active},n.checkIsBnplEnabled=function(){return r(this,void 0,void 0,(function(){var e;return o(this,(function(n){switch(n.label){case 0:return(e=(0,f.checkIsOnMobileScreen)())?[4,(0,m.checkIsTemporaryUser)()]:[3,2];case 1:e=n.sent(),n.label=2;case 2:return e?[2,!1]:[2,(0,p.checkHasFeatureByPlatform)({desktopFeature:l.Feature.bnplEnabledDesktopBrowserExtensionNew,mobileFeature:l.Feature.bnplEnabledMobileBrowserExtensionNew})]}}))}))}},47615:function(e,n,t){var r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(n,"__esModule",{value:!0}),n.useShouldUseBnplTopBar=n.useFloaPaymentNavigation=n.useCardNavigation=n.usePaymentSessionNavigation=n.useEligibilityNavigation=n.HAS_SEEN_BNPL_CARD_DETAILS_LOCAL_STORAGE_KEY=void 0;var o=r(t(96540)),a=t(55015),i=t(47248),s=t(14568),c=t(32668),u=t(74137),l=t(46239),d=t(74617),p=t(13897),f=t(97669);function m(){var e=(0,a.useHasFeature)(a.Feature.bnplTopBarInDesktopBrowserExtension),n=(0,a.useHasFeature)(a.Feature.bnplTopBarInMobileBrowserExtension),t=(0,c.checkIsOnMobileScreen)();return!t&&e||t&&n}n.HAS_SEEN_BNPL_CARD_DETAILS_LOCAL_STORAGE_KEY="hasSeenBnplCardDetails",n.useEligibilityNavigation=function(e){var n=e.userBnplTransaction,t=e.isLoading,r=e.setIsLoading,c=e.userBnplTransactionCreatedAt,u=e.offerId,d=o.default.useRef(void 0);!function(e){var n=e.userBnplTransaction,t=e.setIsLoading,r=e.eligibilityTimeoutHandleRef,c=e.userBnplTransactionCreatedAt,u=e.offerId,d=(0,p.useBnplNavigationContext)().setCurrentBnplScreenNameAndLogEvents;o.default.useEffect((function(){var e={offerId:u,userBnplTransactionCreatedAt:c};(0,s.checkIsFloaEligibilityAccepted)(n)?(t(!1),r.current&&clearTimeout(r.current),(0,l.sendMessageToBackgroundScript)({message:"logUserEvent",data:{event:{type:"floaEligibilityAccepted",payload:e}}}),(0,l.sendMessageToBackgroundScript)({message:"logAmplitudeEvent",data:{event:{type:"FLOA - Eligibility Accepted",properties:e}}}),d({screenName:a.BnplScreenName.eligibilityScheduleScreen})):(null==n?void 0:n.floaEligibility)&&!1===n.floaEligibility.hasAgreement&&(t(!1),(0,l.sendMessageToBackgroundScript)({message:"logUserEvent",data:{event:{type:"floaEligibilityRejected",payload:e}}}),(0,l.sendMessageToBackgroundScript)({message:"logAmplitudeEvent",data:{event:{type:"FLOA - Eligibility Rejected",properties:e}}}),d({screenName:a.BnplScreenName.cardErrorScreen,errorType:i.BnplErrorType.floaEligibilityRejected}))}),[n])}({userBnplTransaction:n,setIsLoading:r,eligibilityTimeoutHandleRef:d,userBnplTransactionCreatedAt:c,offerId:u}),function(e){var n=e.isLoading,t=e.eligibilityTimeoutHandleRef,r=e.userBnplTransactionCreatedAt,s=e.offerId,c=(0,p.useBnplNavigationContext)().setCurrentBnplScreenNameAndLogEvents;o.default.useEffect((function(){if(n)return t.current&&clearTimeout(t.current),t.current=setTimeout((function(){var e={offerId:s,userBnplTransactionCreatedAt:r};(0,l.sendMessageToBackgroundScript)({message:"logUserEvent",data:{event:{type:"floaEligibilityTimeout",payload:e}}}),(0,l.sendMessageToBackgroundScript)({message:"logAmplitudeEvent",data:{event:{type:"FLOA - Eligibility Timeout",properties:e}}}),c({screenName:a.BnplScreenName.cardErrorScreen,errorType:i.BnplErrorType.floaEligibilityTimeout})}),3e4),function(){t.current&&clearTimeout(t.current)}}),[n])}({isLoading:t,eligibilityTimeoutHandleRef:d,userBnplTransactionCreatedAt:c,offerId:u})},n.usePaymentSessionNavigation=function(e){var n=e.setIsLoading,t=e.userBnplTransactionCreatedAt,r=e.hasPressedContinue,c=(0,p.useBnplNavigationContext)(),u=c.offer,d=c.setCurrentBnplScreenNameAndLogEvents,f=(0,s.useUserBnplTransactionWithPolling)(t),m=f.userBnplTransaction,y=f.startPolling,h=f.stopPolling,v=o.default.useRef();o.default.useEffect((function(){r&&(y(),v.current=setTimeout((function(){var e={offerId:u.offerId,userBnplTransactionCreatedAt:t};(0,l.sendMessageToBackgroundScript)({message:"logUserEvent",data:{event:{type:"floaPaymentSessionCreationTimeout",payload:e}}}),(0,l.sendMessageToBackgroundScript)({message:"logAmplitudeEvent",data:{event:{type:"BNPL - Floa Payment Session Creation Timeout",properties:e}}}),h(),d({screenName:a.BnplScreenName.cardErrorScreen,errorType:i.BnplErrorType.floaPaymentSessionCreationTimeout})}),3e4))}),[r]),o.default.useEffect((function(){(0,s.checkIsFloaPaymentSessionReady)(m)&&(clearTimeout(v.current),h(),n(!1),d({screenName:a.BnplScreenName.floaPaymentScreen}))}),[m])},n.useCardNavigation=function(e){var t=(0,p.useBnplNavigationContext)(),r=t.offer,y=t.setCurrentBnplScreenNameAndLogEvents,h=t.closeBnplPanelAndLogEvents,v=(0,s.useUserBnplTransactionWithPolling)(e),_=v.userBnplTransaction,g=v.startPolling,b=v.stopPolling,C=o.default.useRef(),S=m(),T=(0,a.useHasFeature)(a.Feature.bnplNewCardReadyDisplayInExtensions),I=(0,a.useHasFeature)(a.Feature.shouldUseFactorizedBnplSubscriptionWidgetIntoPanelInExtensions),A=((0,f.usePanelDisplayContext)()||{bnpl:{}}).bnpl,E=A.setIsInBnplSubscription,k=A.setLastUserBnplTransaction;return o.default.useEffect((function(){g(),C.current=setTimeout((function(){var n={offerId:r.offerId,userBnplTransactionCreatedAt:e};(0,l.sendMessageToBackgroundScript)({message:"logUserEvent",data:{event:{type:"jokoCardCreationTimeout",payload:n}}}),(0,l.sendMessageToBackgroundScript)({message:"logAmplitudeEvent",data:{event:{type:"BNPL - Joko Card Creation Timeout",properties:n}}}),b(),y({screenName:a.BnplScreenName.cardErrorScreen,errorType:i.BnplErrorType.jokoCardCreationTimeout})}),3e4)}),[]),o.default.useEffect((function(){if(null==_?void 0:_.swanPaymentCard){var t=(0,c.checkIsOnMobileScreen)(),o={offerId:r.offerId,userBnplTransactionCreatedAt:e};(0,l.sendMessageToBackgroundScript)({message:"logUserEvent",data:{event:{type:"jokoCardCreationSuccess",payload:o}}}),(0,l.sendMessageToBackgroundScript)({message:"logAmplitudeEvent",data:{event:{type:"BNPL - Joko Card Creation Success",properties:o}}}),b(),clearTimeout(C.current),I&&(null==k||k(_));var i=setTimeout((0,u.withSentry)((function(){if(T){if(localStorage.setItem(n.HAS_SEEN_BNPL_CARD_DETAILS_LOCAL_STORAGE_KEY,"false"),I)return void(null==E||E(!1));h(!0),(0,d.displayPanelAndLogEvents)({offer:r,bnpl:{isBnplSectionEnabledForOffer:!0,lastUserBnplTransactionFromBnplSubscriptionWidget:_},isTemporaryUser:!1,userOfferActivationInfo:void 0,defaultPanelLocationOverride:{panelTab:a.PanelTab.offerDetails,offerDetailsSection:a.OfferDetailsSection.bnpl}},"bnplWidget")}else if(!t&&S&&e){if(I)return void(null==E||E(!1));var o={offer:r,userBnplTransactionCreatedAt:e};(0,l.sendMessageToBackgroundScript)({message:"displayBnplCardReadyWidget",data:o}),h(!0)}else y({screenName:a.BnplScreenName.cardReadyScreen})})),1250);return function(){return clearTimeout(i)}}}),[_]),_},n.useFloaPaymentNavigation=function(e){var n=e.offerId,t=e.userBnplTransaction,r=e.startPollingUserBnplTransaction,s=e.stopPollingUserBnplTransaction,c=(0,p.useBnplNavigationContext)().setCurrentBnplScreenNameAndLogEvents,u=o.default.useRef(void 0),d={offerId:n,userBnplTransactionCreatedAt:(null==t?void 0:t.createdAt)?t.createdAt:void 0};o.default.useEffect((function(){return r(),u.current=setTimeout((function(){(0,l.sendMessageToBackgroundScript)({message:"logUserEvent",data:{event:{type:"floaPaymentTimeout",payload:d}}}),(0,l.sendMessageToBackgroundScript)({message:"logAmplitudeEvent",data:{event:{type:"BNPL - Floa Payment Timeout",properties:d}}}),s(),c({screenName:a.BnplScreenName.cardErrorScreen,errorType:i.BnplErrorType.floaPaymentTimeout})}),3e5),function(){return clearTimeout(u.current)}}),[]),o.default.useEffect((function(){var e;if(null===(e=null==t?void 0:t.lastFloaPaymentSession)||void 0===e?void 0:e.status)switch(t.lastFloaPaymentSession.status){case"retryable":case"failed":s(),clearTimeout(u.current),c({screenName:a.BnplScreenName.cardErrorScreen,errorType:i.BnplErrorType.floaPaymentRejected}),(0,l.sendMessageToBackgroundScript)({message:"focusCurrentContentScriptTab"});break;case"succeeded":s(),clearTimeout(u.current),c({screenName:a.BnplScreenName.cardPendingScreen}),(0,l.sendMessageToBackgroundScript)({message:"focusCurrentContentScriptTab"})}}),[t])},n.useShouldUseBnplTopBar=m},94576:function(e,n,t){var r=this&&this.__read||function(e,n){var t="function"==typeof Symbol&&e[Symbol.iterator];if(!t)return e;var r,o,a=t.call(e),i=[];try{for(;(void 0===n||n-- >0)&&!(r=a.next()).done;)i.push(r.value)}catch(e){o={error:e}}finally{try{r&&!r.done&&(t=a.return)&&t.call(a)}finally{if(o)throw o.error}}return i},o=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(n,"__esModule",{value:!0}),n.unmountBottomSheet=n.useBottomSheetContainerInnerState=n.useBottomSheetDisplay=void 0;var a=o(t(96540)),i=o(t(40961)),s=t(55015),c=t(17621),u=t(26368);function l(e){var n=(0,c.getHashedElementId)(c.JokoExtensionRootElement[e]),t=document.getElementById(n);null!==t&&(i.default.unmountComponentAtNode(t),t.remove())}n.useBottomSheetDisplay=function(){var e=r(a.default.useState(void 0),2),n=e[0],t=e[1],o=a.default.useCallback((function(){return t(!1)}),[]);return{isBottomSheetDisplayed:n,setIsBottomSheetDisplayed:t,closeBottomSheet:o}},n.useBottomSheetContainerInnerState=function(e,n,t,o,i){var d=(0,c.useHashedElementId)(e),p=r(a.default.useState(void 0),2),f=p[0],m=p[1],y=a.default.useCallback((function(){return setTimeout((function(){var e=n.current;e&&(m(e.clientHeight),o(!0))}),100)}),[]),h=a.default.useCallback((function(n,t){!1===t&&"transform"===n.propertyName&&l(e)}),[t]);!function(e){a.default.useEffect((function(){var e,n,t=(0,c.getHashedElementId)(c.JokoExtensionRootElement.snoozingBottomSheet),r=function(e){e.preventDefault(),e.stopPropagation()};return n=setTimeout((function(){if(null==(e=document.getElementById(t))?void 0:e.children){var n=null==e?void 0:e.children[0];(null==n?void 0:n.contentWindow)&&n.contentWindow.document.addEventListener("touchmove",r,{passive:!1})}}),100),function(){if(n&&clearTimeout(n),null==e?void 0:e.children){var t=null==e?void 0:e.children[0];(null==t?void 0:t.contentWindow)&&t.contentWindow.document.removeEventListener("touchmove",r)}}}),[e])}(d);var v=f?f-u.BOTTOM_SHEET_BAR_HEIGHT:0,_=(0,s.useMakeMobileBottomSheetSlidable)({onSlideToBottom:function(){o(!1),null==i||i()},maximumTopOffset:v,initialTopOffset:0,isMobileExtension:!0,shouldSetTopOffsetToMaximumValueOnDragToBottom:!0}),g=_.topOffset,b=_.isBeingDragged,C=_.onDragListener,S=_.onPressListener,T=_.onReleaseListener;return{onBottomSheetTransitionEnd:h,height:f,elementId:d,handleMountedBottomSheetInnerContainer:y,topOffset:b?t?g:Math.min(v,v+g):t?0:v,isBeingDragged:b,onDragListener:C,onPressListener:S,onReleaseListener:T}},n.unmountBottomSheet=l},2073:function(e,n,t){var r=this&&this.__assign||function(){return r=Object.assign||function(e){for(var n,t=1,r=arguments.length;t<r;t++)for(var o in n=arguments[t])Object.prototype.hasOwnProperty.call(n,o)&&(e[o]=n[o]);return e},r.apply(this,arguments)},o=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(n,"__esModule",{value:!0}),n.displaySnoozingBottomSheet=void 0;var a=o(t(96540)),i=o(t(40961)),s=t(55015),c=t(17621),u=o(t(92328)),l=o(t(40549));n.displaySnoozingBottomSheet=function(e){var n=e.offer,t=e.closingActionOnSnoozing,o=e.widgetInnerContainerRef,d=e.panelInnerContainerRef,p=document.createElement("div");p.id=(0,c.getHashedElementId)(c.JokoExtensionRootElement.snoozingBottomSheet),document.documentElement.appendChild(p),i.default.render(a.default.createElement(l.default,null,a.default.createElement(s.LocalesContextProvider,null,a.default.createElement(u.default,r({},{offer:n,closingActionOnSnoozing:t,widgetInnerContainerRef:o,panelInnerContainerRef:d})))),p)}},31814:function(e,n,t){var r=this&&this.__awaiter||function(e,n,t,r){return new(t||(t=Promise))((function(o,a){function i(e){try{c(r.next(e))}catch(e){a(e)}}function s(e){try{c(r.throw(e))}catch(e){a(e)}}function c(e){var n;e.done?o(e.value):(n=e.value,n instanceof t?n:new t((function(e){e(n)}))).then(i,s)}c((r=r.apply(e,n||[])).next())}))},o=this&&this.__generator||function(e,n){var t,r,o,a,i={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return a={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function s(s){return function(c){return function(s){if(t)throw new TypeError("Generator is already executing.");for(;a&&(a=0,s[0]&&(i=0)),i;)try{if(t=1,r&&(o=2&s[0]?r.return:s[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,s[1])).done)return o;switch(r=0,o&&(s=[2&s[0],o.value]),s[0]){case 0:case 1:o=s;break;case 4:return i.label++,{value:s[1],done:!1};case 5:i.label++,r=s[1],s=[0];continue;case 7:s=i.ops.pop(),i.trys.pop();continue;default:if(!(o=i.trys,(o=o.length>0&&o[o.length-1])||6!==s[0]&&2!==s[0])){i=0;continue}if(3===s[0]&&(!o||s[1]>o[0]&&s[1]<o[3])){i.label=s[1];break}if(6===s[0]&&i.label<o[1]){i.label=o[1],o=s;break}if(o&&i.label<o[2]){i.label=o[2],i.ops.push(s);break}o[2]&&i.ops.pop(),i.trys.pop();continue}s=n.call(e,i)}catch(e){s=[6,e],r=0}finally{t=o=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,c])}}},a=this&&this.__read||function(e,n){var t="function"==typeof Symbol&&e[Symbol.iterator];if(!t)return e;var r,o,a=t.call(e),i=[];try{for(;(void 0===n||n-- >0)&&!(r=a.next()).done;)i.push(r.value)}catch(e){o={error:e}}finally{try{r&&!r.done&&(t=a.return)&&t.call(a)}finally{if(o)throw o.error}}return i},i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(n,"__esModule",{value:!0}),n.handlePostLoadingAdBlockerDetection=n.useAdBlockerDetectionInOfferWidget=void 0;var s=i(t(96540)),c=t(55015),u=t(17621),l=t(74137),d=t(46239);function p(e){(0,d.sendMessageToBackgroundScript)({message:"logUserEvent",data:{event:{type:"adBlockerDetected",payload:{from:e}}}}),(0,d.sendMessageToBackgroundScript)({message:"logAmplitudeEvent",data:{event:{type:"Offers - Ad Blocker Detected",properties:{from:e}}}})}n.useAdBlockerDetectionInOfferWidget=function(){var e=a(s.default.useState(void 0),2),n=e[0],t=e[1];return s.default.useEffect((function(){m().then((function(e){e&&p("browserExtensionOfferWidget"),t(e)}))}),[]),n};var f=250;function m(){var e;return r(this,void 0,void 0,(function(){var n;return o(this,(function(t){switch(t.label){case 0:return[4,(0,c.getSetting)(c.SettingKey.adBlockerDetectionAssetUrl)];case 1:return n=null!==(e=t.sent())&&void 0!==e?e:c.DEFAULT_AD_BLOCKER_DETECTION_ASSET_URL,[2,new Promise((function(e){var t=(0,u.getHashedElementId)(u.JokoExtensionRootElement.adBlockerDetectionIframe),r=setTimeout((function(){e(!1),y(t),chrome.runtime.onMessage.removeListener(o)}),f),o=(0,l.withSentry)((function(n){"adBlockerDetected"===n.message&&(clearTimeout(r),e(!0),y(t),chrome.runtime.onMessage.removeListener(o))}));chrome.runtime.onMessage.addListener(o),function(e){var n=e.iframeId,t=e.adBlockerDetectionAssetUrl,r=document.createElement("iframe");r.id=n,r.src=t,r.style.display="none",document.documentElement.append(r)}({iframeId:t,adBlockerDetectionAssetUrl:n})}))]}}))}))}function y(e){var n=document.getElementById(e);n&&n.remove()}n.handlePostLoadingAdBlockerDetection=function(e){return r(this,void 0,void 0,(function(){var n,t,r;return o(this,(function(o){switch(o.label){case 0:return(null==e?void 0:e.offerId)?(n=e.offerId,[4,(0,c.getLocalStorageItem)(c.LocalStorageKey.offerActivatedInSessionTimestampMsMap)]):[2];case 1:return(null==(t=o.sent())?void 0:t[n])?(r=t[n],Date.now()-r>3e3?[2]:[4,m()]):[2];case 2:return o.sent()&&p("browserExtensionPostLoadingCheck"),[2]}}))}))}},7444:function(e,n,t){var r=this&&this.__awaiter||function(e,n,t,r){return new(t||(t=Promise))((function(o,a){function i(e){try{c(r.next(e))}catch(e){a(e)}}function s(e){try{c(r.throw(e))}catch(e){a(e)}}function c(e){var n;e.done?o(e.value):(n=e.value,n instanceof t?n:new t((function(e){e(n)}))).then(i,s)}c((r=r.apply(e,n||[])).next())}))},o=this&&this.__generator||function(e,n){var t,r,o,a,i={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return a={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function s(s){return function(c){return function(s){if(t)throw new TypeError("Generator is already executing.");for(;a&&(a=0,s[0]&&(i=0)),i;)try{if(t=1,r&&(o=2&s[0]?r.return:s[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,s[1])).done)return o;switch(r=0,o&&(s=[2&s[0],o.value]),s[0]){case 0:case 1:o=s;break;case 4:return i.label++,{value:s[1],done:!1};case 5:i.label++,r=s[1],s=[0];continue;case 7:s=i.ops.pop(),i.trys.pop();continue;default:if(!(o=i.trys,(o=o.length>0&&o[o.length-1])||6!==s[0]&&2!==s[0])){i=0;continue}if(3===s[0]&&(!o||s[1]>o[0]&&s[1]<o[3])){i.label=s[1];break}if(6===s[0]&&i.label<o[1]){i.label=o[1],o=s;break}if(o&&i.label<o[2]){i.label=o[2],i.ops.push(s);break}o[2]&&i.ops.pop(),i.trys.pop();continue}s=n.call(e,i)}catch(e){s=[6,e],r=0}finally{t=o=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,c])}}},a=this&&this.__read||function(e,n){var t="function"==typeof Symbol&&e[Symbol.iterator];if(!t)return e;var r,o,a=t.call(e),i=[];try{for(;(void 0===n||n-- >0)&&!(r=a.next()).done;)i.push(r.value)}catch(e){o={error:e}}finally{try{r&&!r.done&&(t=a.return)&&t.call(a)}finally{if(o)throw o.error}}return i},i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(n,"__esModule",{value:!0}),n.getUserFeaturesMapWithTimeout=n.useAppFeature=n.checkHasFeatureByPlatform=void 0;var s=i(t(96540)),c=t(55015),u=t(58029),l=t(55071),d=t(32668),p=t(74137);n.checkHasFeatureByPlatform=function(e){var n=e.desktopFeature,t=e.mobileFeature;return r(this,void 0,void 0,(function(){var e,r;return o(this,(function(o){switch(o.label){case 0:return(0,d.checkIsOnMobileScreen)()?(e=t)?[4,(0,c.checkHasFeature)(t)]:[3,2]:[3,3];case 1:e=o.sent(),o.label=2;case 2:return[2,!!e];case 3:return(r=n)?[4,(0,c.checkHasFeature)(n)]:[3,5];case 4:r=o.sent(),o.label=5;case 5:return[2,!!r]}}))}))},n.useAppFeature=function(e){var n=a(s.default.useState(!1),2),t=n[0],r=n[1];return s.default.useEffect((function(){(0,c.checkHasFeature)(e).then(r)}),[]),t};n.getUserFeaturesMapWithTimeout=function(e){var n;return void 0===e&&(e=500),r(this,void 0,void 0,(function(){var t,r;return o(this,(function(o){switch(o.label){case 0:return o.trys.push([0,2,,3]),[4,(0,l.wrapPromiseWithTimeout)((0,u.getUserFeaturesMap)(),e)];case 1:return t=null!==(n=o.sent())&&void 0!==n?n:{},[3,3];case 2:return r=o.sent(),(0,p.captureSentryException)(r),console.error(r),t={},[3,3];case 3:return[2,t]}}))}))}},40334:function(e,n,t){var r=this&&this.__awaiter||function(e,n,t,r){return new(t||(t=Promise))((function(o,a){function i(e){try{c(r.next(e))}catch(e){a(e)}}function s(e){try{c(r.throw(e))}catch(e){a(e)}}function c(e){var n;e.done?o(e.value):(n=e.value,n instanceof t?n:new t((function(e){e(n)}))).then(i,s)}c((r=r.apply(e,n||[])).next())}))},o=this&&this.__generator||function(e,n){var t,r,o,a,i={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return a={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function s(s){return function(c){return function(s){if(t)throw new TypeError("Generator is already executing.");for(;a&&(a=0,s[0]&&(i=0)),i;)try{if(t=1,r&&(o=2&s[0]?r.return:s[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,s[1])).done)return o;switch(r=0,o&&(s=[2&s[0],o.value]),s[0]){case 0:case 1:o=s;break;case 4:return i.label++,{value:s[1],done:!1};case 5:i.label++,r=s[1],s=[0];continue;case 7:s=i.ops.pop(),i.trys.pop();continue;default:if(!(o=i.trys,(o=o.length>0&&o[o.length-1])||6!==s[0]&&2!==s[0])){i=0;continue}if(3===s[0]&&(!o||s[1]>o[0]&&s[1]<o[3])){i.label=s[1];break}if(6===s[0]&&i.label<o[1]){i.label=o[1],o=s;break}if(o&&i.label<o[2]){i.label=o[2],i.ops.push(s);break}o[2]&&i.ops.pop(),i.trys.pop();continue}s=n.call(e,i)}catch(e){s=[6,e],r=0}finally{t=o=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,c])}}},a=this&&this.__values||function(e){var n="function"==typeof Symbol&&Symbol.iterator,t=n&&e[n],r=0;if(t)return t.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&r>=e.length&&(e=void 0),{value:e&&e[r++],done:!e}}};throw new TypeError(n?"Object is not iterable.":"Symbol.iterator is not defined.")};Object.defineProperty(n,"__esModule",{value:!0}),n.getUserRegion=n.blockRedirectsToMerchantApps=void 0;var i=t(55015),s=t(7444),c=t(32668),u=t(46239);n.blockRedirectsToMerchantApps=function(){return r(this,void 0,void 0,(function(){var e;return o(this,(function(n){switch(n.label){case 0:return(0,c.checkIsOnMobileScreen)()?[4,(0,s.checkHasFeatureByPlatform)({mobileFeature:i.Feature.appRedirectsBlockingMobileSafariExtension})]:[2];case 1:return n.sent()?[4,d()]:[2];case 2:return(e=n.sent())?[4,new Promise((function(e){return setTimeout(e,1e3)}))]:[2];case 3:return n.sent(),Array.isArray(e.blockedCustomUrlSchemes)&&e.blockedCustomUrlSchemes.length>0&&function(e){var n,t,s,c,l=this,d=e.map((function(e){return e.toLowerCase()})).filter((function(e){return/^[a-z0-9-]+:/.test(e)}));if(0===d.length)return;try{for(var f=a(d),y=f.next();!y.done;y=f.next()){var h=y.value,v=document.querySelectorAll('a[href^="'.concat(h,'"]')),_=function(e){var n=e.getAttribute("href"),t=!0;if(!n)return"continue";e.addEventListener("click",(function(){return r(l,void 0,void 0,(function(){var e,r;return o(this,(function(o){switch(o.label){case 0:return r=i.getLocalizedTexts,[4,p()];case 1:return e=r.apply(void 0,[o.sent()]).contentscript.appRedirectsBlockingMessages.confirmationPopup,window.confirm(e)?(m({url:n,redirectType:"customUrlScheme",hasConfirmedRedirect:!0}),t?(t=!1,window.location.href=n):(0,u.sendMessageToBackgroundScript)({message:"openTab",data:{url:n}})):m({url:n,redirectType:"customUrlScheme",hasConfirmedRedirect:!1}),[2]}}))}))})),e.setAttribute("href","#")};try{for(var g=(s=void 0,a(Array.from(v))),b=g.next();!b.done;b=g.next()){_(b.value)}}catch(e){s={error:e}}finally{try{b&&!b.done&&(c=g.return)&&c.call(g)}finally{if(s)throw s.error}}}}catch(e){n={error:e}}finally{try{y&&!y.done&&(t=f.return)&&t.call(f)}finally{if(n)throw n.error}}}(e.blockedCustomUrlSchemes),Array.isArray(e.blockedUniversalLinkDomains)&&e.blockedUniversalLinkDomains.length>0&&function(e){var n,t,r,o,i,s;try{for(var c=a(e),u=c.next();!u.done;u=c.next()){var l=u.value;if(/^([a-z0-9-]+\.)?[a-z0-9-]+\.[a-z0-9-]+$/.test(l)){var d=["http://".concat(l),"https://".concat(l),"http://www.".concat(l),"https://www.".concat(l)];if(!d.some((function(e){return window.location.href.startsWith(e)})))try{for(var p=(r=void 0,a(d)),y=p.next();!y.done;y=p.next()){var h=y.value,v=document.querySelectorAll('a[href^="'.concat(h,'"]')),_=function(e){var n=e.getAttribute("href");if(!n)return"continue";"#mock-anchor"!==n&&(e.addEventListener("click",(function(){m({url:n,redirectType:"universalLink"}),f(n)}),{capture:!0}),e.setAttribute("href","#mock-anchor"))};try{for(var g=(i=void 0,a(Array.from(v))),b=g.next();!b.done;b=g.next()){_(b.value)}}catch(e){i={error:e}}finally{try{b&&!b.done&&(s=g.return)&&s.call(g)}finally{if(i)throw i.error}}}}catch(e){r={error:e}}finally{try{y&&!y.done&&(o=p.return)&&o.call(p)}finally{if(r)throw r.error}}}}}catch(e){n={error:e}}finally{try{u&&!u.done&&(t=c.return)&&t.call(c)}finally{if(n)throw n.error}}}(e.blockedUniversalLinkDomains),[2]}}))}))};var l=3e6;function d(){return r(this,void 0,void 0,(function(){var e;return o(this,(function(n){switch(n.label){case 0:return[4,(0,i.getSetting)(i.SettingKey.mobileSafariExtensionAppRedirectsBlockingSettings,l)];case 1:return(e=n.sent())&&"object"==typeof e?[2,e]:[2,void 0]}}))}))}function p(){return r(this,void 0,void 0,(function(){var e;return o(this,(function(n){switch(n.label){case 0:return[4,(0,i.getLocalStorageItem)(i.LocalStorageKey.userRegion)];case 1:return(e=n.sent())?[2,e]:[2,(0,i.getRegionFromBrowserLanguage)()]}}))}))}function f(e){return r(this,void 0,void 0,(function(){var n;return o(this,(function(t){switch(t.label){case 0:return n=new Promise((function(n){return(0,u.sendMessageToBackgroundScript)({message:"openUrlInCurrentTab",data:{url:e}},(function(){return n(!0)}))})),[4,Promise.race([n,new Promise((function(e){return setTimeout((function(){return e(!1)}),500)}))])];case 1:return!t.sent()&&(window.location.href=e),[2]}}))}))}function m(e){var n={url:e.url,redirectType:e.redirectType,hasConfirmedRedirect:e.hasConfirmedRedirect};(0,u.sendMessageToBackgroundScript)({message:"logUserEvent",data:{event:{type:"appRedirectBlocked",payload:n}}}),(0,u.sendMessageToBackgroundScript)({message:"logAmplitudeEvent",data:{event:{type:"Navigation - App Redirect Blocked",properties:n}}})}n.getUserRegion=p},47175:(e,n,t)=>{var r;Object.defineProperty(n,"__esModule",{value:!0}),n.SPINNER_ICON_URL=n.SHOPPING_BAG_GREEN_ICON_URL=n.SHOPPING_BAG_ICON_URL=n.JOKO_CARD_MINIMIZED_ICON_URL=n.COUPON_WHITE_ICON_URL=n.COUPON_WITHOUT_PERCENT_ICON_URL=n.GEAR_ICON_URL=n.USER_SILHOUETTE_GREEN_ICON_URL=n.USER_SILHOUETTE_ICON_URL=n.REDIRECTION_ICON_URL=n.LIGHTNING_BOLT_FILLED_CIRCLE_GREEN_ICON_URL=n.LIGHTNING_BOLT_FILLED_CIRCLE_BLACK_ICON_URL=n.MAGNIFYING_GLASS_WITH_SQUARE_GREEN_ICON_URL=n.MAGNIFYING_GLASS_WITH_SQUARE_ICON_URL=n.MAGNIFYING_GLASS_ICON_URL=n.CREDIT_CARD_ICON_URL=n.INFO_CIRCLE_BLACK_ICON_URL=n.WARNING_TRIANGLE_RED_ICON_URL=n.BOOK_OPEN_BLACK_ICON_URL=n.EMPTY_CHECKBOX_ICON_URL=n.TRASH_CAN_ICON_URL=n.COPY_BUTTON_PURPLE_ICON_URL=n.NOTIFICATION_OFF_ICON_URL=n.CLOCK_GRAY_ICON_URL=n.CLOCK_BLACK_ICON_URL=n.RADIO_BUTTON_UNCHECKED_GRAY=n.RADIO_BUTTON_CHECKED_GREEN=n.CHECK_MARK_PURPLE_ICON_URL=n.CHECK_MARK_GREEN_ICON_URL=n.CHECK_MARK_BLACK_ICON_URL=n.CHECK_MARK_FILLED_ROUND_GREEN_ICON_URL=n.CHECK_MARK_FILLED_GREEN_ICON_URL=n.STOPWATCH_BLACK_ICON_URL=n.SETTINGS_WHEEL_ICON_URL=n.LOGIN_PADLOCK_GREEN_ICON_URL=n.LOGIN_PADLOCK_WHITE_ICON_URL=n.COOKIE_ICON_URL=n.THREE_DOTS_GRAY_ICON_URL=n.THREE_DOTS_ICON_URL=n.FOUR_DOTS_ICON_URL=n.ARROW_RIGHT_BLACK_ICON_URL=n.CHEVRON_LEFT_STRAIGHT_ICON_URL=n.CHEVRON_RIGHT_THIN_ROUND_ICON_URL=n.CHEVRON_DOWN_ICON_URL=n.CROSS_BLACK_ICON_URL=n.LOGO_WITH_TITLE_WHITE_IMAGE_URL=n.OLD_LOGO_WITH_TITLE_IMAGE_URL=n.LOGO_WITH_TITLE_IMAGE_URL=n.LOGO_WHITE_IMAGE_URL=n.LOGO_IMAGE_URL=void 0,n.AMBIT_BLACK_ITALIC_FONT_URL=n.AMBIT_BLACK_FONT_URL=n.AMBIT_BOLD_ITALIC_FONT_URL=n.AMBIT_BOLD_FONT_URL=n.AMBIT_SEMI_BOLD_ITALIC_FONT_URL=n.AMBIT_SEMI_BOLD_FONT_URL=n.AMBIT_LIGHT_ITALIC_FONT_URL=n.AMBIT_LIGHT_FONT_URL=n.AMBIT_EXTRA_LIGHT_ITALIC_FONT_URL=n.AMBIT_EXTRA_LIGHT_FONT_URL=n.AMBIT_THIN_ITALIC_FONT_URL=n.AMBIT_THIN_FONT_URL=n.AMBIT_ITALIC_FONT_URL=n.AMBIT_REGULAR_FONT_URL=n.STEPS_TO_COMPLETE_VERTICAL_SOLID_LINES_ILLUSTRATION_URL=n.STEPS_TO_COMPLETE_VERTICAL_ILLUSTRATION_URL=n.HORIZONTAL_BAR_GRAY_ILLUSTRATION_URL=n.HORIZONTAL_BAR_GREEN_ILLUSTRATION_URL=n.JOKO_CARD_BARE_ILLUSTRATION_URL=n.JOKO_CARD_TILTED_ILLUSTRATION_URL=n.JOKO_CARD_ILLUSTRATION_URL=n.PRICE_TRACKING_GRAPH_LOADING_PLACEHOLDER_ILLUSTRATION_URL=n.LIGHTNING_BOLT_PURPLE_ILLUSTRATION_URL=n.COUPY_SUCCESS_ILLUSTRATION_URL=n.COUPY_SHADOW_ILLUSTRATION_URL=n.COUPY_MEDITATING_ILLUSTRATION_URL=n.COUPY_NO_SAVINGS_ILLUSTRATION_URL=n.COUPY_ERROR_ILLUSTRATION_URL=n.COUPY_WAVING_LEFT_ARM_ILLUSTRATION_URL=n.COUPY_WAVING_WITHOUT_LEFT_ARM_ILLUSTRATION_URL=n.OFFER_PLACEHOLDER_ILLUSTRATION_URL=n.SEARCH_ENGINE_ACTIVATE_OFFER_BUTTON_ICON_URL=n.SEARCH_ENGINE_SHOP_BUTTON_ICON_URL=n.THREE_TIMES_ICON_URL=n.PRICE_TRACKING_GRAY_ICON_URL=n.PRICE_TRACKING_ICON_URL=void 0;var o=t(55015),a=(0,t(24543).getExtensionAssetUrl)("/assets");n.LOGO_IMAGE_URL="".concat(a,"/logo.svg"),n.LOGO_WHITE_IMAGE_URL="".concat(a,"/logo-white.svg"),n.LOGO_WITH_TITLE_IMAGE_URL="".concat(a,"/logo-with-title.png"),n.OLD_LOGO_WITH_TITLE_IMAGE_URL="".concat(a,"/old-logo-with-title.png"),n.LOGO_WITH_TITLE_WHITE_IMAGE_URL="".concat(a,"/logo-with-title-white.svg"),n.CROSS_BLACK_ICON_URL="".concat(a,"/cross-black.svg"),n.CHEVRON_DOWN_ICON_URL="".concat(a,"/chevron.svg"),n.CHEVRON_RIGHT_THIN_ROUND_ICON_URL="".concat(a,"/chevron-thin-round-right.svg"),n.CHEVRON_LEFT_STRAIGHT_ICON_URL="".concat(a,"/chevron-straight-left.svg"),n.ARROW_RIGHT_BLACK_ICON_URL="".concat(a,"/arrow-right-black.png"),n.FOUR_DOTS_ICON_URL="".concat(a,"/four-dots.svg"),n.THREE_DOTS_ICON_URL="".concat(a,"/three-dots.svg"),n.THREE_DOTS_GRAY_ICON_URL="".concat(a,"/three-dots-gray.svg"),n.COOKIE_ICON_URL="".concat(a,"/cookie.png"),n.LOGIN_PADLOCK_WHITE_ICON_URL="".concat(a,"/login-padlock-white.svg"),n.LOGIN_PADLOCK_GREEN_ICON_URL="".concat(a,"/login-padlock-green.svg"),n.SETTINGS_WHEEL_ICON_URL="".concat(a,"/settings-wheel.svg"),n.STOPWATCH_BLACK_ICON_URL="".concat(a,"/stopwatch-black.svg"),n.CHECK_MARK_FILLED_GREEN_ICON_URL="".concat(a,"/check-mark-filled-green.svg"),n.CHECK_MARK_FILLED_ROUND_GREEN_ICON_URL="".concat(a,"/check-mark-filled-round-green.svg"),n.CHECK_MARK_BLACK_ICON_URL="".concat(a,"/check-mark-black.svg"),n.CHECK_MARK_GREEN_ICON_URL="".concat(a,"/check-mark-green.svg"),n.CHECK_MARK_PURPLE_ICON_URL="".concat(a,"/check-mark-purple.svg"),n.RADIO_BUTTON_CHECKED_GREEN="".concat(a,"/radio-button-checked-green.svg"),n.RADIO_BUTTON_UNCHECKED_GRAY="".concat(a,"/radio-button-unchecked-gray.svg"),n.CLOCK_BLACK_ICON_URL="".concat(a,"/clock-black.svg"),n.CLOCK_GRAY_ICON_URL="".concat(a,"/clock-gray.svg"),n.NOTIFICATION_OFF_ICON_URL="".concat(a,"/notification-off.svg"),n.COPY_BUTTON_PURPLE_ICON_URL="".concat(a,"/copy-button-purple.svg"),n.TRASH_CAN_ICON_URL="".concat(a,"/trash-can.svg"),n.EMPTY_CHECKBOX_ICON_URL="".concat(a,"/checkbox-empty.svg"),n.BOOK_OPEN_BLACK_ICON_URL="".concat(a,"/book-open-black.png"),n.WARNING_TRIANGLE_RED_ICON_URL="".concat(a,"/warning-triangle-red.svg"),n.INFO_CIRCLE_BLACK_ICON_URL="".concat(a,"/info-circle-black.png"),n.CREDIT_CARD_ICON_URL="".concat(a,"/credit-card.svg"),n.MAGNIFYING_GLASS_ICON_URL="".concat(a,"/magnifying-glass.svg"),n.MAGNIFYING_GLASS_WITH_SQUARE_ICON_URL="".concat(a,"/magnifying-glass-with-square.svg"),n.MAGNIFYING_GLASS_WITH_SQUARE_GREEN_ICON_URL="".concat(a,"/magnifying-glass-with-square-green.svg"),n.LIGHTNING_BOLT_FILLED_CIRCLE_BLACK_ICON_URL="".concat(a,"/lightning-bolt-filled-circle-black.svg"),n.LIGHTNING_BOLT_FILLED_CIRCLE_GREEN_ICON_URL="".concat(a,"/lightning-bolt-filled-circle-green.svg"),n.REDIRECTION_ICON_URL="".concat(a,"/redirection.svg"),n.USER_SILHOUETTE_ICON_URL="".concat(a,"/user-silhouette.svg"),n.USER_SILHOUETTE_GREEN_ICON_URL="".concat(a,"/user-silhouette-green.svg"),n.GEAR_ICON_URL="".concat(a,"/gear.svg"),n.COUPON_WITHOUT_PERCENT_ICON_URL="".concat(a,"/coupon-without-percent.svg"),n.COUPON_WHITE_ICON_URL="".concat(a,"/coupon-white.svg"),n.JOKO_CARD_MINIMIZED_ICON_URL="".concat(a,"/joko-card-minimized.svg"),n.SHOPPING_BAG_ICON_URL="".concat(a,"/shopping-bag.svg"),n.SHOPPING_BAG_GREEN_ICON_URL="".concat(a,"/shopping-bag-green.svg"),n.SPINNER_ICON_URL="".concat(a,"/spinner.png"),n.PRICE_TRACKING_ICON_URL="".concat(a,"/price-tracking.svg"),n.PRICE_TRACKING_GRAY_ICON_URL="".concat(a,"/price-tracking-gray.svg"),n.THREE_TIMES_ICON_URL="".concat(a,"/three-times.svg"),n.SEARCH_ENGINE_SHOP_BUTTON_ICON_URL="".concat(a,"/search-engine-shop-offer-button.svg"),n.SEARCH_ENGINE_ACTIVATE_OFFER_BUTTON_ICON_URL=((r={})[o.Region.FR]="".concat(a,"/search-engine-activate-offer-button.svg"),r[o.Region.US]="".concat(a,"/search-engine-activate-offer-button-us.svg"),r[o.Region.GB]="".concat(a,"/search-engine-activate-offer-button-us.svg"),r),n.OFFER_PLACEHOLDER_ILLUSTRATION_URL="".concat(a,"/offer-placeholder.svg"),n.COUPY_WAVING_WITHOUT_LEFT_ARM_ILLUSTRATION_URL="".concat(a,"/coupy-waving-without-left-arm.png"),n.COUPY_WAVING_LEFT_ARM_ILLUSTRATION_URL="".concat(a,"/coupy-waving-left-arm.svg"),n.COUPY_ERROR_ILLUSTRATION_URL="".concat(a,"/coupy-error.svg"),n.COUPY_NO_SAVINGS_ILLUSTRATION_URL="".concat(a,"/coupy-no-savings.png"),n.COUPY_MEDITATING_ILLUSTRATION_URL="".concat(a,"/coupy-meditating.svg"),n.COUPY_SHADOW_ILLUSTRATION_URL="".concat(a,"/coupy-shadow.svg"),n.COUPY_SUCCESS_ILLUSTRATION_URL="".concat(a,"/coupy-success.png"),n.LIGHTNING_BOLT_PURPLE_ILLUSTRATION_URL="".concat(a,"/lightning-bolt-purple.svg"),n.PRICE_TRACKING_GRAPH_LOADING_PLACEHOLDER_ILLUSTRATION_URL="".concat(a,"/price-tracking-graph-loading-placeholder.svg"),n.JOKO_CARD_ILLUSTRATION_URL="".concat(a,"/joko-card.png"),n.JOKO_CARD_TILTED_ILLUSTRATION_URL="".concat(a,"/joko-card-tilted.png"),n.JOKO_CARD_BARE_ILLUSTRATION_URL="".concat(a,"/joko-card-bare.png"),n.HORIZONTAL_BAR_GREEN_ILLUSTRATION_URL="".concat(a,"/horizontal-bar-green.svg"),n.HORIZONTAL_BAR_GRAY_ILLUSTRATION_URL="".concat(a,"/horizontal-bar-gray.svg"),n.STEPS_TO_COMPLETE_VERTICAL_ILLUSTRATION_URL="".concat(a,"/steps-to-complete-vertical.svg"),n.STEPS_TO_COMPLETE_VERTICAL_SOLID_LINES_ILLUSTRATION_URL="".concat(a,"/steps-to-complete-vertical-solid-lines.svg"),n.AMBIT_REGULAR_FONT_URL="".concat(a,"/Ambit-Regular.ttf"),n.AMBIT_ITALIC_FONT_URL="".concat(a,"/Ambit-Italic.ttf"),n.AMBIT_THIN_FONT_URL="".concat(a,"/Ambit-Thin.ttf"),n.AMBIT_THIN_ITALIC_FONT_URL="".concat(a,"/Ambit-ThinItalic.ttf"),n.AMBIT_EXTRA_LIGHT_FONT_URL="".concat(a,"/Ambit-ExtraLight.ttf"),n.AMBIT_EXTRA_LIGHT_ITALIC_FONT_URL="".concat(a,"/Ambit-ExtraLightItalic.ttf"),n.AMBIT_LIGHT_FONT_URL="".concat(a,"/Ambit-Light.ttf"),n.AMBIT_LIGHT_ITALIC_FONT_URL="".concat(a,"/Ambit-LightItalic.ttf"),n.AMBIT_SEMI_BOLD_FONT_URL="".concat(a,"/Ambit-SemiBold.ttf"),n.AMBIT_SEMI_BOLD_ITALIC_FONT_URL="".concat(a,"/Ambit-SemiBoldItalic.ttf"),n.AMBIT_BOLD_FONT_URL="".concat(a,"/Ambit-Bold.ttf"),n.AMBIT_BOLD_ITALIC_FONT_URL="".concat(a,"/Ambit-BoldItalic.ttf"),n.AMBIT_BLACK_FONT_URL="".concat(a,"/Ambit-Black.ttf"),n.AMBIT_BLACK_ITALIC_FONT_URL="".concat(a,"/Ambit-BlackItalic.ttf")},70992:function(e,n,t){var r=this&&this.__awaiter||function(e,n,t,r){return new(t||(t=Promise))((function(o,a){function i(e){try{c(r.next(e))}catch(e){a(e)}}function s(e){try{c(r.throw(e))}catch(e){a(e)}}function c(e){var n;e.done?o(e.value):(n=e.value,n instanceof t?n:new t((function(e){e(n)}))).then(i,s)}c((r=r.apply(e,n||[])).next())}))},o=this&&this.__generator||function(e,n){var t,r,o,a,i={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return a={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function s(s){return function(c){return function(s){if(t)throw new TypeError("Generator is already executing.");for(;a&&(a=0,s[0]&&(i=0)),i;)try{if(t=1,r&&(o=2&s[0]?r.return:s[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,s[1])).done)return o;switch(r=0,o&&(s=[2&s[0],o.value]),s[0]){case 0:case 1:o=s;break;case 4:return i.label++,{value:s[1],done:!1};case 5:i.label++,r=s[1],s=[0];continue;case 7:s=i.ops.pop(),i.trys.pop();continue;default:if(!(o=i.trys,(o=o.length>0&&o[o.length-1])||6!==s[0]&&2!==s[0])){i=0;continue}if(3===s[0]&&(!o||s[1]>o[0]&&s[1]<o[3])){i.label=s[1];break}if(6===s[0]&&i.label<o[1]){i.label=o[1],o=s;break}if(o&&i.label<o[2]){i.label=o[2],i.ops.push(s);break}o[2]&&i.ops.pop(),i.trys.pop();continue}s=n.call(e,i)}catch(e){s=[6,e],r=0}finally{t=o=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,c])}}};Object.defineProperty(n,"__esModule",{value:!0}),n.updateCognitoPhoneNumber=n.checkIsSignedIn=void 0;var a=t(55015),i=t(46239);n.checkIsSignedIn=function(){return r(this,void 0,void 0,(function(){return o(this,(function(e){switch(e.label){case 0:return[4,(0,a.getLocalStorageItem)(a.LocalStorageKey.userId)];case 1:return e.sent()?[2,!0]:[4,new Promise((function(e){(0,i.sendMessageToBackgroundScript)({message:"checkIsSignedIn"},(function(n){n&&"object"==typeof n&&"isSignedIn"in n&&"boolean"==typeof n.isSignedIn&&e(n.isSignedIn)}))}))];case 2:return[2,e.sent()]}}))}))},n.updateCognitoPhoneNumber=function(e){return new Promise((function(n,t){return(0,i.sendMessageToBackgroundScript)({message:"updateCognitoPhoneNumber",data:{formattedPhoneNumber:e}},(function(e){return e.success?n():t()}))}))}},52879:function(e,n,t){var r=this&&this.__read||function(e,n){var t="function"==typeof Symbol&&e[Symbol.iterator];if(!t)return e;var r,o,a=t.call(e),i=[];try{for(;(void 0===n||n-- >0)&&!(r=a.next()).done;)i.push(r.value)}catch(e){o={error:e}}finally{try{r&&!r.done&&(t=a.return)&&t.call(a)}finally{if(o)throw o.error}}return i},o=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(n,"__esModule",{value:!0}),n.useShouldDisplayBankReconnectionBanner=void 0;var a=o(t(96540)),i=t(55015),s=t(46239);n.useShouldDisplayBankReconnectionBanner=function(){var e=(0,i.useHasFeature)(i.Feature.bankReconnectionBannerMobileBrowserExtension),n=r(a.default.useState(!1),2),t=n[0],o=n[1];return a.default.useEffect((function(){e&&new Promise((function(e){return(0,s.sendMessageToBackgroundScript)({message:"checkHasDisconnectedBank"},(function(n){return e(n)}))})).then(o)}),[]),t}},37392:(e,n)=>{Object.defineProperty(n,"__esModule",{value:!0}),n.removeJokoDomEventListener=n.setJokoDomEventListener=n.sendJokoDomEvent=n.JokoDomEvent=void 0,function(e){e.onJokoPanelDisplayed="onJokoPanelDisplayed",e.onJokoPanelCloseRequest="onJokoPanelCloseRequest",e.onJokoPanelLocationChangeRequest="onJokoPanelLocationChangeRequest",e.onJokoWidgetsCloseRequest="onJokoWidgetsCloseRequest",e.onOfferActivated="onOfferActivated",e.onOfferWidgetClosed="onOfferWidgetClosed",e.onCashbackTrackingLostWidgetClosed="onCashbackTrackingLostWidgetClosed",e.startSideButtonCashbackActivationAnimation="startSideButtonCashbackActivationAnimation"}(n.JokoDomEvent||(n.JokoDomEvent={})),n.sendJokoDomEvent=function(e,n){document.dispatchEvent(new CustomEvent(e,{detail:n}))},n.setJokoDomEventListener=function(e,n){var t=function(t){t.detail?n(t.detail):console.error("An undefined event data was received for the event ".concat(e))};return document.addEventListener(e,t),t},n.removeJokoDomEventListener=function(e,n){document.removeEventListener(e,n)}},17621:function(e,n,t){var r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(n,"__esModule",{value:!0}),n.getHashedElementId=n.useHashedElementId=n.JokoExtensionElement=n.JokoExtensionRootElement=void 0;var o=r(t(96540)),a=r(t(83503));function i(e,n){var t=window.navigator.userAgent,r="".concat(e,"-").concat(t,"-").concat(n||"");return function(e){var n=e.charCodeAt(0);if(n>96&&n<123)return e;var t=n%26+97;return String.fromCharCode(t)+e.substring(1)}((0,a.default)(r))}!function(e){e.offerWidget="offerWidgetRoot",e.cashbackReminderWidget="cashbackReminderWidgetRoot",e.cashbackTrackingLostWidget="cashbackTrackingLostWidgetRoot",e.cashbackReactivationAtCheckoutWidget="cashbackReactivationAtCheckoutWidgetRoot",e.cashbackActivationConfirmationWidget="cashbackActivationConfirmationWidgetRoot",e.alternativeOffersWidget="alternativeOffersWidgetRoot",e.couponAutomationProposalWidget="couponAutomationProposalWidgetRoot",e.couponApplicationWidget="couponApplicationWidgetRoot",e.bnplSubscriptionWidget="bnplSubscriptionWidgetRoot",e.bnplSuggestionAtCheckoutWidget="bnplSuggestionAtCheckoutWidgetRoot",e.bnplCardReadyWidget="bnplCardReadyWidgetRoot",e.priceComparisonWidget="priceComparisonWidgetRoot",e.priceComparisonFeedbackWidget="priceComparisonFeedbackWidgetRoot",e.priceComparisonFeedbackSubmittedWidget="priceComparisonFeedbackSubmittedWidgetRoot",e.merchantWebsiteTrackingConsentSuggestionWidget="merchantWebsiteTrackingConsentSuggestionWidgetRoot",e.merchantWebsiteTrackingConsentErrorWidget="merchantWebsiteTrackingConsentErrorWidgetRoot",e.panel="panelRoot",e.sideButton="sideButtonRoot",e.affiliateLinkIframeLoader="affiliateLinkIframeLoaderRoot",e.couponNetworkRequestFormatterSandboxedIframe="couponNetworkRequestFormatterSandboxedIframeRoot",e.offerCashbackActivationInterstitial="offerCashbackActivationInterstitialRoot",e.embeddedAmazonBnplButton="embeddedAmazonBnplButtonRoot",e.embeddedSearchResultsInfo="embeddedSearchResultsInfo",e.embeddedProductDiscoveryExperience="embeddedProductDiscoveryExperience",e.adBlockerDetectionIframe="adBlockerDetectionIframeRoot",e.snoozingConfirmationWidget="snoozingConfirmationWidgetRoot",e.snoozingBottomSheet="snoozingBottomSheetRoot",e.deleteAllBrowsedProductsBottomSheet="deleteAllBrowsedProductsBottomSheetRoot"}(n.JokoExtensionRootElement||(n.JokoExtensionRootElement={})),function(e){e.offerWidget="offerWidget",e.cashbackReminderWidget="cashbackReminderWidget",e.cashbackTrackingLostWidget="cashbackTrackingLostWidget",e.cashbackReactivationAtCheckoutWidget="cashbackReactivationAtCheckoutWidget",e.cashbackActivationConfirmationWidget="cashbackActivationConfirmationWidget",e.alternativeOffersWidget="alternativeOffersWidget",e.couponAutomationProposalWidget="couponAutomationProposalWidget",e.couponApplicationWidget="couponApplicationWidget",e.bnplSubscriptionWidget="bnplSubscriptionWidget",e.bnplSuggestionAtCheckoutWidget="bnplSuggestionAtCheckoutWidget",e.bnplCardReadyWidget="bnplCardReadyWidget",e.priceComparisonWidget="priceComparisonWidget",e.priceComparisonFeedbackWidget="priceComparisonFeedbackWidget",e.priceComparisonFeedbackSubmittedWidget="priceComparisonFeedbackSubmittedWidget",e.merchantWebsiteTrackingConsentSuggestionWidget="merchantWebsiteTrackingConsentSuggestionWidget",e.merchantWebsiteTrackingConsentErrorWidget="merchantWebsiteTrackingConsentErrorWidget",e.snoozingConfirmationWidget="snoozingConfirmationWidget",e.panel="panel",e.panelFrame="panelFrame",e.bnplSubscriptionFrame="bnplSubscriptionFrame",e.errorScreen="errorScreen",e.offerActivationInterstitial="offerActivationInterstitial",e.snoozingBottomSheet="snoozingBottomSheet",e.deleteAllBrowsedProductsBottomSheet="deleteAllBrowsedProductsBottomSheet"}(n.JokoExtensionElement||(n.JokoExtensionElement={})),n.useHashedElementId=function(e,n){return o.default.useMemo((function(){return i(e,n)}),[e,n])},n.getHashedElementId=i},62849:function(e,n,t){var r=this&&this.__createBinding||(Object.create?function(e,n,t,r){void 0===r&&(r=t);var o=Object.getOwnPropertyDescriptor(n,t);o&&!("get"in o?!n.__esModule:o.writable||o.configurable)||(o={enumerable:!0,get:function(){return n[t]}}),Object.defineProperty(e,r,o)}:function(e,n,t,r){void 0===r&&(r=t),e[r]=n[t]}),o=this&&this.__setModuleDefault||(Object.create?function(e,n){Object.defineProperty(e,"default",{enumerable:!0,value:n})}:function(e,n){e.default=n}),a=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var n={};if(null!=e)for(var t in e)"default"!==t&&Object.prototype.hasOwnProperty.call(e,t)&&r(n,e,t);return o(n,e),n},i=this&&this.__awaiter||function(e,n,t,r){return new(t||(t=Promise))((function(o,a){function i(e){try{c(r.next(e))}catch(e){a(e)}}function s(e){try{c(r.throw(e))}catch(e){a(e)}}function c(e){var n;e.done?o(e.value):(n=e.value,n instanceof t?n:new t((function(e){e(n)}))).then(i,s)}c((r=r.apply(e,n||[])).next())}))},s=this&&this.__generator||function(e,n){var t,r,o,a,i={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return a={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function s(s){return function(c){return function(s){if(t)throw new TypeError("Generator is already executing.");for(;a&&(a=0,s[0]&&(i=0)),i;)try{if(t=1,r&&(o=2&s[0]?r.return:s[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,s[1])).done)return o;switch(r=0,o&&(s=[2&s[0],o.value]),s[0]){case 0:case 1:o=s;break;case 4:return i.label++,{value:s[1],done:!1};case 5:i.label++,r=s[1],s=[0];continue;case 7:s=i.ops.pop(),i.trys.pop();continue;default:if(!(o=i.trys,(o=o.length>0&&o[o.length-1])||6!==s[0]&&2!==s[0])){i=0;continue}if(3===s[0]&&(!o||s[1]>o[0]&&s[1]<o[3])){i.label=s[1];break}if(6===s[0]&&i.label<o[1]){i.label=o[1],o=s;break}if(o&&i.label<o[2]){i.label=o[2],i.ops.push(s);break}o[2]&&i.ops.pop(),i.trys.pop();continue}s=n.call(e,i)}catch(e){s=[6,e],r=0}finally{t=o=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,c])}}},c=this&&this.__read||function(e,n){var t="function"==typeof Symbol&&e[Symbol.iterator];if(!t)return e;var r,o,a=t.call(e),i=[];try{for(;(void 0===n||n-- >0)&&!(r=a.next()).done;)i.push(r.value)}catch(e){o={error:e}}finally{try{r&&!r.done&&(t=a.return)&&t.call(a)}finally{if(o)throw o.error}}return i};Object.defineProperty(n,"__esModule",{value:!0}),n.useExtensionType=n.getExtensionType=void 0;var u=a(t(96540)),l=t(46239);function d(){return i(this,void 0,void 0,(function(){return s(this,(function(e){return[2,new Promise((function(e){(0,l.sendMessageToBackgroundScript)({message:"getExtensionType",data:{}},(function(n){e(n.extensionType)}))}))]}))}))}n.getExtensionType=d,n.useExtensionType=function(){var e=c(u.useState(void 0),2),n=e[0],t=e[1];return u.useEffect((function(){d().then(t)}),[]),n}},87867:function(e,n){var t=this&&this.__values||function(e){var n="function"==typeof Symbol&&Symbol.iterator,t=n&&e[n],r=0;if(t)return t.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&r>=e.length&&(e=void 0),{value:e&&e[r++],done:!e}}};throw new TypeError(n?"Object is not iterable.":"Symbol.iterator is not defined.")};Object.defineProperty(n,"__esModule",{value:!0}),n.removeInputElement=n.removeAllAttributesExceptClassAndUseSafeIdAndName=n.traverseChildrenAndApplyHtmlElementTransformers=void 0,n.traverseChildrenAndApplyHtmlElementTransformers=function e(n,r){var o,a,i,s;if(r.length){try{for(var c=t(r),u=c.next();!u.done;u=c.next()){(0,u.value)(n)}}catch(e){o={error:e}}finally{try{u&&!u.done&&(a=c.return)&&a.call(c)}finally{if(o)throw o.error}}try{for(var l=t(Array.from(n.children)),d=l.next();!d.done;d=l.next()){var p=d.value;p instanceof HTMLElement&&e(p,r)}}catch(e){i={error:e}}finally{try{d&&!d.done&&(s=l.return)&&s.call(l)}finally{if(i)throw i.error}}}},n.removeAllAttributesExceptClassAndUseSafeIdAndName=function(e){var n,r;try{for(var o=t(Array.from(e.attributes)),a=o.next();!a.done;a=o.next()){var i=a.value;switch(i.name){case"class":break;case"id":case"name":e.setAttribute(i.name,"".concat(e.getAttribute(i.name),"-joko"));break;default:e.removeAttribute(i.name)}}}catch(e){n={error:e}}finally{try{a&&!a.done&&(r=o.return)&&r.call(o)}finally{if(n)throw n.error}}},n.removeInputElement=function(e){e instanceof HTMLInputElement&&e.remove()}},92204:function(e,n,t){var r=this&&this.__awaiter||function(e,n,t,r){return new(t||(t=Promise))((function(o,a){function i(e){try{c(r.next(e))}catch(e){a(e)}}function s(e){try{c(r.throw(e))}catch(e){a(e)}}function c(e){var n;e.done?o(e.value):(n=e.value,n instanceof t?n:new t((function(e){e(n)}))).then(i,s)}c((r=r.apply(e,n||[])).next())}))},o=this&&this.__generator||function(e,n){var t,r,o,a,i={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return a={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function s(s){return function(c){return function(s){if(t)throw new TypeError("Generator is already executing.");for(;a&&(a=0,s[0]&&(i=0)),i;)try{if(t=1,r&&(o=2&s[0]?r.return:s[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,s[1])).done)return o;switch(r=0,o&&(s=[2&s[0],o.value]),s[0]){case 0:case 1:o=s;break;case 4:return i.label++,{value:s[1],done:!1};case 5:i.label++,r=s[1],s=[0];continue;case 7:s=i.ops.pop(),i.trys.pop();continue;default:if(!(o=i.trys,(o=o.length>0&&o[o.length-1])||6!==s[0]&&2!==s[0])){i=0;continue}if(3===s[0]&&(!o||s[1]>o[0]&&s[1]<o[3])){i.label=s[1];break}if(6===s[0]&&i.label<o[1]){i.label=o[1],o=s;break}if(o&&i.label<o[2]){i.label=o[2],i.ops.push(s);break}o[2]&&i.ops.pop(),i.trys.pop();continue}s=n.call(e,i)}catch(e){s=[6,e],r=0}finally{t=o=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,c])}}},a=this&&this.__read||function(e,n){var t="function"==typeof Symbol&&e[Symbol.iterator];if(!t)return e;var r,o,a=t.call(e),i=[];try{for(;(void 0===n||n-- >0)&&!(r=a.next()).done;)i.push(r.value)}catch(e){o={error:e}}finally{try{r&&!r.done&&(t=a.return)&&t.call(a)}finally{if(o)throw o.error}}return i},i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(n,"__esModule",{value:!0}),n.useImageSource=n.checkShouldLoadImagesThroughBackgroundScript=n.shouldLoadImagesThroughBackgroundScript=n.useImagePreloader=void 0;var s=i(t(96540)),c=i(t(2543)),u=t(46239);function l(e){return new Promise((function(n){var t=new Image;t.onload=function(){return n()},t.src=e}))}n.useImagePreloader=function(e){var n=a(s.default.useState(!0),2),t=n[0],i=n[1],u=s.default.useMemo((function(){return c.default.uniq(e)}),[e]);return s.default.useEffect((function(){var e=!1;if(u.length)return function(){r(this,void 0,void 0,(function(){return o(this,(function(n){switch(n.label){case 0:return e?[2]:[4,Promise.all(u.map(l))];case 1:return n.sent(),e?[2]:(i(!1),[2])}}))}))}(),function(){e=!0}}),[u]),t},n.shouldLoadImagesThroughBackgroundScript=!1;n.checkShouldLoadImagesThroughBackgroundScript=function(){var e=new Image;e.onerror=function(){return n.shouldLoadImagesThroughBackgroundScript=!0},e.src="https://joko-mobile-app-media.s3.eu-west-1.amazonaws.com/browser-extension/background_script/background_script_image_loading_assessment_asset.png"},n.useImageSource=function(e){var t=a(s.default.useState(void 0),2),i=t[0],c=t[1];return s.default.useEffect((function(){n.shouldLoadImagesThroughBackgroundScript&&e&&function(e){return r(this,void 0,void 0,(function(){return o(this,(function(n){switch(n.label){case 0:return[4,new Promise((function(n){return(0,u.sendMessageToBackgroundScript)({message:"loadImage",data:{imageUrl:e}},(function(e){return n(e.base64Image)}))}))];case 1:return[2,n.sent()]}}))}))}(e).then(c)}),[]),n.shouldLoadImagesThroughBackgroundScript?i||"":e}},77653:function(e,n,t){var r=this&&this.__read||function(e,n){var t="function"==typeof Symbol&&e[Symbol.iterator];if(!t)return e;var r,o,a=t.call(e),i=[];try{for(;(void 0===n||n-- >0)&&!(r=a.next()).done;)i.push(r.value)}catch(e){o={error:e}}finally{try{r&&!r.done&&(t=a.return)&&t.call(a)}finally{if(o)throw o.error}}return i},o=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(n,"__esModule",{value:!0}),n.getUserOfferActivationInfo=n.useMerchantOfferMatchingUrlWithConditionsAndCoupons=n.getMerchantOffersWithConditionsAndCouponsFromOfferIds=n.getMerchantOfferWithConditionsAndCouponsFromS3=n.getMerchantOfferMatchingUrlWithConditionsAndCoupons=void 0;var a=o(t(96540)),i=t(46239);function s(e){return new Promise((function(n){return(0,i.sendMessageToBackgroundScript)({message:"getMerchantOfferMatchingUrlWithConditionsAndCoupons",data:{url:e}},(function(e){return n((null==e?void 0:e.offer)?e.offer:void 0)}))}))}n.getMerchantOfferMatchingUrlWithConditionsAndCoupons=s,n.getMerchantOfferWithConditionsAndCouponsFromS3=function(e){return new Promise((function(n){return(0,i.sendMessageToBackgroundScript)({message:"getMerchantOfferWithConditionsAndCouponsFromS3",data:{offerId:e}},(function(e){return n((null==e?void 0:e.offer)?e.offer:void 0)}))}))},n.getMerchantOffersWithConditionsAndCouponsFromOfferIds=function(e){return new Promise((function(n){return(0,i.sendMessageToBackgroundScript)({message:"getMerchantOffersWithConditionsAndCouponsFromOfferIds",data:{offerIds:e}},(function(e){return n((null==e?void 0:e.offers)||void 0)}))}))},n.useMerchantOfferMatchingUrlWithConditionsAndCoupons=function(e){var n=r(a.default.useState(void 0),2),t=n[0],o=n[1];return a.default.useEffect((function(){s(e).then(o)}),[]),t},n.getUserOfferActivationInfo=function(e){return e?new Promise((function(n){(0,i.sendMessageToBackgroundScript)({message:"getUserOfferActivationInfo",data:{offerId:e.offerId}},(function(e){(null==e?void 0:e.userOfferActivationInfo)&&n(e.userOfferActivationInfo),n(void 0)}))})):Promise.resolve(void 0)}},32668:function(e,n,t){var r=this&&this.__read||function(e,n){var t="function"==typeof Symbol&&e[Symbol.iterator];if(!t)return e;var r,o,a=t.call(e),i=[];try{for(;(void 0===n||n-- >0)&&!(r=a.next()).done;)i.push(r.value)}catch(e){o={error:e}}finally{try{r&&!r.done&&(t=a.return)&&t.call(a)}finally{if(o)throw o.error}}return i},o=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(n,"__esModule",{value:!0}),n.checkIsOnMobileScreen=n.useDisableMobileSafariAutoZoomOnInputFocus=n.useDisableMobileSafariNativeSwipe=n.useForceMobileSafariAutoLoginEasterEgg=n.isOsVersion18OrLater=void 0;var a=o(t(96540)),i=t(55015),s=t(25841),c=t(46239);function u(e){e.touches[0].pageX>20&&e.touches[0].pageX<window.innerWidth-20||e.preventDefault()}n.isOsVersion18OrLater=Number((0,s.getSafariMajorAndMinorOsVersion)())>=18,n.useForceMobileSafariAutoLoginEasterEgg=function(){var e=r(a.default.useState(0),2),n=e[0],t=e[1];return a.default.useEffect((function(){n>=5&&(0,i.getLocalStorageItem)(i.LocalStorageKey.userId).then((function(e){t(0),window.confirm("You are logged in with user ".concat(e,". Do you want to manually trigger automatic login?"))&&(0,c.sendMessageToBackgroundScript)({message:"forceMobileSafariAutoLogin",data:{}})}))}),[n]),function(){return t(n+1)}},n.useDisableMobileSafariNativeSwipe=function(e){var n=e.isMobileExtension,t=e.sideButtonElementRef;a.default.useEffect((function(){return n&&t.current&&t.current.addEventListener("touchstart",u),function(){n&&t.current&&t.current.removeEventListener("touchstart",u)}}),[n,t])},n.useDisableMobileSafariAutoZoomOnInputFocus=function(e){var n=a.default.useRef();a.default.useEffect((function(){if(e){var t=document.querySelector("[name=viewport]");return t?n.current=t.getAttribute("content")||void 0:t=document.createElement("meta"),t.setAttribute("content","width=device-width, initial-scale=1, maximum-scale=1"),function(){var e=document.querySelector("[name=viewport]");e&&(n.current?e.setAttribute("content",n.current):e.remove())}}}),[])};n.checkIsOnMobileScreen=function(){return window.screen.width<500}},84092:function(e,n,t){var r,o=this&&this.__createBinding||(Object.create?function(e,n,t,r){void 0===r&&(r=t);var o=Object.getOwnPropertyDescriptor(n,t);o&&!("get"in o?!n.__esModule:o.writable||o.configurable)||(o={enumerable:!0,get:function(){return n[t]}}),Object.defineProperty(e,r,o)}:function(e,n,t,r){void 0===r&&(r=t),e[r]=n[t]}),a=this&&this.__setModuleDefault||(Object.create?function(e,n){Object.defineProperty(e,"default",{enumerable:!0,value:n})}:function(e,n){e.default=n}),i=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var n={};if(null!=e)for(var t in e)"default"!==t&&Object.prototype.hasOwnProperty.call(e,t)&&o(n,e,t);return a(n,e),n};Object.defineProperty(n,"__esModule",{value:!0}),n.parsePriceAmountAndCurrency=void 0;var s=i(t(2543)),c=t(55015),u=((r={})[c.CurrencySymbol.EUR]=c.Currency.EUR,r[c.CurrencySymbol.GBP]=c.Currency.GBP,r[c.CurrencySymbol.USD]=c.Currency.USD,r);n.parsePriceAmountAndCurrency=function(e){if(!e)return{priceAmount:null,priceCurrency:null};var n=s.deburr(e.toLowerCase().trim());if(""===n)return{priceAmount:null,priceCurrency:null};var t=n.match(/\$|€|£|(eur)|(usd)|(gbp)/);if(!t)return{priceAmount:null,priceCurrency:null};var r=t[0],o=null;if(o=Object.values(c.CurrencySymbol).includes(r)?u[r]:r.toUpperCase(),!Object.values(c.Currency).includes(o))return{priceAmount:null,priceCurrency:null};if(Object.values(c.CurrencySymbol).includes(r)&&0!==t.index&&t.index!==n.length-1)return n=(n=n.replace(/[$€£]/g,".")).replace(/[,\s]/g,""),{priceAmount:parseFloat(n),priceCurrency:o};if((n=n.replace(/\$|€|£|(eur)|(usd)|(gbp)|\s/g,"")).includes(".")&&n.includes(","))n=n.replace(/,/g,"");else if(n.includes(",")){var a=n.split(",");n=a.length>2||3===a[a.length-1].length?n.replace(/,/g,""):n.replace(",",".")}return{priceAmount:parseFloat(n),priceCurrency:o}}},24366:function(e,n,t){var r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(n,"__esModule",{value:!0}),n.useSetMomentLocale=void 0;var o=r(t(96540)),a=r(t(95093));t(85498),t(53872);var i=t(55015);n.useSetMomentLocale=function(){var e=(0,i.useUserRegion)();o.default.useEffect((function(){switch(e){case i.Region.FR:a.default.locale("fr");break;case i.Region.US:a.default.locale("en-au")}}),[e])}},74137:function(e,n,t){var r=this&&this.__awaiter||function(e,n,t,r){return new(t||(t=Promise))((function(o,a){function i(e){try{c(r.next(e))}catch(e){a(e)}}function s(e){try{c(r.throw(e))}catch(e){a(e)}}function c(e){var n;e.done?o(e.value):(n=e.value,n instanceof t?n:new t((function(e){e(n)}))).then(i,s)}c((r=r.apply(e,n||[])).next())}))},o=this&&this.__generator||function(e,n){var t,r,o,a,i={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return a={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function s(s){return function(c){return function(s){if(t)throw new TypeError("Generator is already executing.");for(;a&&(a=0,s[0]&&(i=0)),i;)try{if(t=1,r&&(o=2&s[0]?r.return:s[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,s[1])).done)return o;switch(r=0,o&&(s=[2&s[0],o.value]),s[0]){case 0:case 1:o=s;break;case 4:return i.label++,{value:s[1],done:!1};case 5:i.label++,r=s[1],s=[0];continue;case 7:s=i.ops.pop(),i.trys.pop();continue;default:if(!(o=i.trys,(o=o.length>0&&o[o.length-1])||6!==s[0]&&2!==s[0])){i=0;continue}if(3===s[0]&&(!o||s[1]>o[0]&&s[1]<o[3])){i.label=s[1];break}if(6===s[0]&&i.label<o[1]){i.label=o[1],o=s;break}if(o&&i.label<o[2]){i.label=o[2],i.ops.push(s);break}o[2]&&i.ops.pop(),i.trys.pop();continue}s=n.call(e,i)}catch(e){s=[6,e],r=0}finally{t=o=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,c])}}},a=this&&this.__read||function(e,n){var t="function"==typeof Symbol&&e[Symbol.iterator];if(!t)return e;var r,o,a=t.call(e),i=[];try{for(;(void 0===n||n-- >0)&&!(r=a.next()).done;)i.push(r.value)}catch(e){o={error:e}}finally{try{r&&!r.done&&(t=a.return)&&t.call(a)}finally{if(o)throw o.error}}return i},i=this&&this.__spreadArray||function(e,n,t){if(t||2===arguments.length)for(var r,o=0,a=n.length;o<a;o++)!r&&o in n||(r||(r=Array.prototype.slice.call(n,0,o)),r[o]=n[o]);return e.concat(r||Array.prototype.slice.call(n))};Object.defineProperty(n,"__esModule",{value:!0}),n.withSentry=n.captureSentryException=n.sentryHub=void 0;var s=t(37315),c=t(55015),u=t(58029),l=t(70992),d=t(62849),p=t(32668),f=t(46239);n.sentryHub=new s.Hub(new s.BrowserClient({dsn:c.SENTRY_DSN,transport:s.makeFetchTransport,stackParser:s.defaultStackParser,integrations:[],release:c.versionNumber,sampleRate:1,beforeSend:function(e){try{return function(e){var n,t;r(this,void 0,void 0,(function(){var r;return o(this,(function(o){switch(o.label){case 0:return[4,(0,l.checkIsSignedIn)()];case 1:return(r=o.sent())?[4,(0,u.checkHasFeatureFromLocalStorage)((0,p.checkIsOnMobileScreen)()?c.Feature.logSentryEventsInUserEventsMobileBrowserExtension:c.Feature.logSentryEventsInUserEventsDesktopBrowserExtension)]:[3,3];case 2:r=o.sent(),o.label=3;case 3:return r?[4,(0,f.sendMessageToBackgroundScript)({message:"logUserEvent",data:{event:{type:"sentryEventSent",active:!1,payload:{script:"contentScript",sentryEventId:e.event_id,exceptions:null===(t=null===(n=e.exception)||void 0===n?void 0:n.values)||void 0===t?void 0:t.map((function(e){return{exceptionType:(null==e?void 0:e.type)?"".concat(e.type):"",exceptionValue:(null==e?void 0:e.value)?"".concat(e.value):""}})),eventLevel:e.level,eventTimestamp:e.timestamp}}}})]:[3,5];case 4:o.sent(),o.label=5;case 5:return[2]}}))}))}(e),e}catch(n){return console.error(n),e}}})),n.sentryHub.setTags({script:"contentScript",environment:"production",versionNumber:c.versionNumber}),(0,c.getLocalStorageItem)(c.LocalStorageKey.userId).then((function(e){return n.sentryHub.setTag("userId",e)})),(0,d.getExtensionType)().then((function(e){return n.sentryHub.setTag("extensionType",e)})),(0,c.checkIsOnDevStack)().then((function(e){return n.sentryHub.setTag("isDevStack",e)})),n.captureSentryException=function(e){n.sentryHub.captureException(e)},n.withSentry=function(e){return function(){for(var t=[],r=0;r<arguments.length;r++)t[r]=arguments[r];try{return e.apply(void 0,i([],a(t),!1))}catch(e){throw n.sentryHub.captureException(e),e}}}},84159:function(e,n,t){var r=this&&this.__awaiter||function(e,n,t,r){return new(t||(t=Promise))((function(o,a){function i(e){try{c(r.next(e))}catch(e){a(e)}}function s(e){try{c(r.throw(e))}catch(e){a(e)}}function c(e){var n;e.done?o(e.value):(n=e.value,n instanceof t?n:new t((function(e){e(n)}))).then(i,s)}c((r=r.apply(e,n||[])).next())}))},o=this&&this.__generator||function(e,n){var t,r,o,a,i={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return a={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function s(s){return function(c){return function(s){if(t)throw new TypeError("Generator is already executing.");for(;a&&(a=0,s[0]&&(i=0)),i;)try{if(t=1,r&&(o=2&s[0]?r.return:s[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,s[1])).done)return o;switch(r=0,o&&(s=[2&s[0],o.value]),s[0]){case 0:case 1:o=s;break;case 4:return i.label++,{value:s[1],done:!1};case 5:i.label++,r=s[1],s=[0];continue;case 7:s=i.ops.pop(),i.trys.pop();continue;default:if(!(o=i.trys,(o=o.length>0&&o[o.length-1])||6!==s[0]&&2!==s[0])){i=0;continue}if(3===s[0]&&(!o||s[1]>o[0]&&s[1]<o[3])){i.label=s[1];break}if(6===s[0]&&i.label<o[1]){i.label=o[1],o=s;break}if(o&&i.label<o[2]){i.label=o[2],i.ops.push(s);break}o[2]&&i.ops.pop(),i.trys.pop();continue}s=n.call(e,i)}catch(e){s=[6,e],r=0}finally{t=o=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,c])}}},a=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(n,"__esModule",{value:!0}),n.getSnoozeEndTimestampInMs=n.useSnoozeSettingsButtonInnerState=n.checkIsExtensionSnoozed=void 0;var i=a(t(96540)),s=a(t(95093)),c=t(55015),u=t(37392),l=t(46239),d=t(74617),p=t(18989),f=t(76764),m=t(94700),y="snoozeEndTimestampInMs";n.checkIsExtensionSnoozed=function(){return(e=localStorage.getItem(y))&&Date.now()<Number(e)?Promise.resolve(!0):function(){return r(this,void 0,void 0,(function(){var e;return o(this,(function(n){switch(n.label){case 0:return[4,(0,c.getLocalStorageItem)(c.LocalStorageKey.snoozeForAllWebsitesEndTimestampInMs)];case 1:return[2,!!((e=n.sent())&&Date.now()<Number(e))]}}))}))}();var e},n.useSnoozeSettingsButtonInnerState=function(e){var n=e.isMobileExtension,t=e.offer,r=e.closingActionOnSnoozing,o=e.widgetInnerContainerRef,a=e.panelInnerContainerRef,s=e.snoozeSettingsButtonRef,h=e.setIsSnoozeSettingsPopupOpen,v=e.setIsBottomSheetDisplayed,g=i.default.useCallback((function(){var e,n=window.location.href,o=_();localStorage.setItem(y,o),(0,p.unmountSideButton)(),(0,u.sendJokoDomEvent)(u.JokoDomEvent.onJokoWidgetsCloseRequest,{}),"panel"===r.source?r.closePanelAndLogEvents("snoozeButton"):"widget"===r.source&&r.closeWidget();var a,i,s=null!==(e=null==t?void 0:t.screen.title)&&void 0!==e?e:(0,c.getSecondLevelDomain)(n);(0,f.displaySnoozingConfirmationWidget)({offerId:null==t?void 0:t.offerId,websiteName:s}),a=null==t?void 0:t.offerId,i={offerId:a},(0,l.sendMessageToBackgroundScript)({message:"logUserEvent",data:{event:{type:"snoozedExtensionForCurrentWebsite",payload:i}}}),(0,l.sendMessageToBackgroundScript)({message:"logAmplitudeEvent",data:{event:{type:"Browser Extension - Snoozed For Current Website",properties:i}}})}),[t]),b=i.default.useRef(null),C=i.default.useRef(null);return(0,d.useOnClickInsidePanel)({panelInnerContainerRef:a,excludedElementRefs:[b,C,s],onClick:function(){n?null==v||v(!1):null==h||h(!1)},shouldAlsoDetectClickOutsidePanel:!0}),(0,m.useOnClickInsideWidget)({widgetInnerContainerRef:o,excludedElementRefs:[b,C,s],onClick:function(){n?null==v||v(!1):null==h||h(!1)}}),{onClickSnoozeForCurrentWebsiteButton:g,desktopSnoozeSettingsPopupRef:b,mobileSnoozingBottomSheetRef:C}};var h=2,v=36;function _(){var e=(0,s.default)(),n=(0,s.default)().add(1,"days").startOf("day");return n.diff(e,"hours")<h?n=(0,s.default)().add(h,"hours"):n.diff(e,"hours")>v&&(n=(0,s.default)().add(v,"hours")),n.valueOf().toString()}n.getSnoozeEndTimestampInMs=_},64534:function(e,n,t){var r=this&&this.__createBinding||(Object.create?function(e,n,t,r){void 0===r&&(r=t);var o=Object.getOwnPropertyDescriptor(n,t);o&&!("get"in o?!n.__esModule:o.writable||o.configurable)||(o={enumerable:!0,get:function(){return n[t]}}),Object.defineProperty(e,r,o)}:function(e,n,t,r){void 0===r&&(r=t),e[r]=n[t]}),o=this&&this.__setModuleDefault||(Object.create?function(e,n){Object.defineProperty(e,"default",{enumerable:!0,value:n})}:function(e,n){e.default=n}),a=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var n={};if(null!=e)for(var t in e)"default"!==t&&Object.prototype.hasOwnProperty.call(e,t)&&r(n,e,t);return o(n,e),n},i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(n,"__esModule",{value:!0}),n.useCheckIsSocialProofValueSatisfyingThreshold=n.SocialProofName=void 0;var s,c=i(t(95093)),u=a(t(35759)),l=t(55015),d=u.object({displayedAmountOfCashbackEarnedByUsers:u.number(),displayedAmountSavedByUsersUsingAutoCoupons:u.number(),totalAmountSavedByUsersUsingAutoCoupons:u.number()}).nonstrict(),p=u.object({highSuccessRateReassuranceElement:u.object({minSuccessRate:u.number()}),lastUsedRecentlyReassuranceElement:u.object({maxDelaySinceLastUseInHours:u.number()})}).nonstrict();!function(e){e.displayedAmountOfCashbackEarnedByUsers="displayedAmountOfCashbackEarnedByUsers",e.displayedAmountSavedByUsersUsingAutoCoupons="displayedAmountSavedByUsersUsingAutoCoupons",e.totalAmountSavedByUsersUsingAutoCoupons="totalAmountSavedByUsersUsingAutoCoupons",e.displayedSuccessRateAutoCoupons="displayedSuccessRateAutoCoupons",e.lastUsedAtAutoCoupons="lastUsedAtAutoCoupons"}(s=n.SocialProofName||(n.SocialProofName={}));var f={displayedAmountOfCashbackEarnedByUsers:.1,displayedAmountSavedByUsersUsingAutoCoupons:.1,totalAmountSavedByUsersUsingAutoCoupons:.1},m={highSuccessRateReassuranceElement:{minSuccessRate:.03},lastUsedRecentlyReassuranceElement:{maxDelaySinceLastUseInHours:48}};n.useCheckIsSocialProofValueSatisfyingThreshold=function(e){var n,t,r=e.socialProofName,o=e.socialProofValue,a=null!==(n=(0,l.useSetting)({settingKey:l.SettingKey.minimumAmountValuesSocialProofDisplay,validator:d}))&&void 0!==n?n:f,i=null!==(t=(0,l.useSetting)({settingKey:l.SettingKey.autoCouponCheckoutWidgetReassuranceElementThresholds,validator:p}))&&void 0!==t?t:m;if(!o)return!1;switch(r){case s.displayedAmountOfCashbackEarnedByUsers:case s.displayedAmountSavedByUsersUsingAutoCoupons:case s.totalAmountSavedByUsersUsingAutoCoupons:return o>a[r];case s.displayedSuccessRateAutoCoupons:return o>i.highSuccessRateReassuranceElement.minSuccessRate;case s.lastUsedAtAutoCoupons:return(0,c.default)().diff((0,c.default)(o),"hours")<i.lastUsedRecentlyReassuranceElement.maxDelaySinceLastUseInHours}}},26368:function(e,n,t){var r=this&&this.__makeTemplateObject||function(e,n){return Object.defineProperty?Object.defineProperty(e,"raw",{value:n}):e.raw=n,e};Object.defineProperty(n,"__esModule",{value:!0}),n.MOBILE_PANEL_HEIGHT=n.TRUNCATED_TEXT_CSS_MIXIN=n.CLICKABLE_ELEMENT_CSS_MIXIN=n.NON_HIGHLIGHTABLE_NOR_DRAGGABLE_ELEMENT_CSS_MIXIN=n.OPEN_AND_CLOSE_ANIMATIONS_DURATION_IN_SECONDS=n.DEFAULT_BUTTON_FONT_WEIGHT=n.DEFAULT_FULL_WIDTH_BUTTON_FONT_SIZE=n.DEFAULT_BUTTON_FONT_SIZE=n.DEFAULT_BOTTOM_SHEET_BOTTOM_PADDING=n.DEFAULT_BOTTOM_SHEET_HORIZONTAL_PADDING=n.BOTTOM_SHEET_BAR_HEIGHT=n.BOTTOM_SHEET_MAXIMUM_HEIGHT=n.DEFAULT_PANEL_TOP_PADDING=n.DEFAULT_PANEL_AND_WIDGET_HORIZONTAL_PADDING=n.WIDGET_VERTICAL_PADDING=n.DEFAULT_FULL_WIDTH_BUTTON_HEIGHT=n.DEFAULT_BUTTON_HEIGHT=n.TAB_SELECTOR_HEIGHT=n.PANEL_TOP_BAR_HEIGHT=n.DESKTOP_PANEL_AND_WIDGET_WIDTH=n.DESKTOP_PANEL_HEIGHT=n.HIGHER_TRANSLATE3D_Z_AXIS=n.HIGHEST_Z_INDEX=void 0;var o,a,i,s=t(38267);n.HIGHEST_Z_INDEX=2147483647,n.HIGHER_TRANSLATE3D_Z_AXIS=9999999,n.DESKTOP_PANEL_HEIGHT=600,n.DESKTOP_PANEL_AND_WIDGET_WIDTH=390,n.PANEL_TOP_BAR_HEIGHT=45,n.TAB_SELECTOR_HEIGHT=68,n.DEFAULT_BUTTON_HEIGHT=34,n.DEFAULT_FULL_WIDTH_BUTTON_HEIGHT=40,n.WIDGET_VERTICAL_PADDING=16,n.DEFAULT_PANEL_AND_WIDGET_HORIZONTAL_PADDING=16,n.DEFAULT_PANEL_TOP_PADDING=16,n.BOTTOM_SHEET_MAXIMUM_HEIGHT=100,n.BOTTOM_SHEET_BAR_HEIGHT=21,n.DEFAULT_BOTTOM_SHEET_HORIZONTAL_PADDING=16,n.DEFAULT_BOTTOM_SHEET_BOTTOM_PADDING=8,n.DEFAULT_BUTTON_FONT_SIZE=12,n.DEFAULT_FULL_WIDTH_BUTTON_FONT_SIZE=14,n.DEFAULT_BUTTON_FONT_WEIGHT=900,n.OPEN_AND_CLOSE_ANIMATIONS_DURATION_IN_SECONDS=.3,n.NON_HIGHLIGHTABLE_NOR_DRAGGABLE_ELEMENT_CSS_MIXIN=(0,s.css)(o||(o=r(["\n    -webkit-touch-callout: none;\n    -webkit-user-select: none;\n    -html-user-select: none;\n    -moz-user-select: none;\n    -ms-user-select: none;\n    user-select: none;\n    user-drag: none;\n"],["\n    -webkit-touch-callout: none;\n    -webkit-user-select: none;\n    -html-user-select: none;\n    -moz-user-select: none;\n    -ms-user-select: none;\n    user-select: none;\n    user-drag: none;\n"]))),n.CLICKABLE_ELEMENT_CSS_MIXIN=(0,s.css)(a||(a=r(["\n    touch-action: manipulation;\n    -webkit-tap-highlight-color: transparent;\n    cursor: pointer;\n    ","\n"],["\n    touch-action: manipulation;\n    -webkit-tap-highlight-color: transparent;\n    cursor: pointer;\n    ","\n"])),n.NON_HIGHLIGHTABLE_NOR_DRAGGABLE_ELEMENT_CSS_MIXIN),n.TRUNCATED_TEXT_CSS_MIXIN=(0,s.css)(i||(i=r(["\n    overflow: hidden;\n    text-overflow: ellipsis;\n    white-space: nowrap;\n"],["\n    overflow: hidden;\n    text-overflow: ellipsis;\n    white-space: nowrap;\n"]))),n.MOBILE_PANEL_HEIGHT=function(){var e=2*Math.round(.6*window.screen.height/2);if(e<425)return 425;if(e>600)return 600;return e}()},68134:function(e,n,t){var r=this&&this.__read||function(e,n){var t="function"==typeof Symbol&&e[Symbol.iterator];if(!t)return e;var r,o,a=t.call(e),i=[];try{for(;(void 0===n||n-- >0)&&!(r=a.next()).done;)i.push(r.value)}catch(e){o={error:e}}finally{try{r&&!r.done&&(t=a.return)&&t.call(a)}finally{if(o)throw o.error}}return i},o=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(n,"__esModule",{value:!0}),n.useGetTabId=n.getTabId=void 0;var a=o(t(96540)),i=t(46239);function s(){return new Promise((function(e){return(0,i.sendMessageToBackgroundScript)({message:"getTabId"},(function(n){return e(n.tabId)}))}))}n.getTabId=s,n.useGetTabId=function(){var e=r(a.default.useState(void 0),2),n=e[0],t=e[1];return a.default.useEffect((function(){s().then(t)}),[]),n}},31229:function(e,n,t){var r=this&&this.__awaiter||function(e,n,t,r){return new(t||(t=Promise))((function(o,a){function i(e){try{c(r.next(e))}catch(e){a(e)}}function s(e){try{c(r.throw(e))}catch(e){a(e)}}function c(e){var n;e.done?o(e.value):(n=e.value,n instanceof t?n:new t((function(e){e(n)}))).then(i,s)}c((r=r.apply(e,n||[])).next())}))},o=this&&this.__generator||function(e,n){var t,r,o,a,i={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return a={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function s(s){return function(c){return function(s){if(t)throw new TypeError("Generator is already executing.");for(;a&&(a=0,s[0]&&(i=0)),i;)try{if(t=1,r&&(o=2&s[0]?r.return:s[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,s[1])).done)return o;switch(r=0,o&&(s=[2&s[0],o.value]),s[0]){case 0:case 1:o=s;break;case 4:return i.label++,{value:s[1],done:!1};case 5:i.label++,r=s[1],s=[0];continue;case 7:s=i.ops.pop(),i.trys.pop();continue;default:if(!(o=i.trys,(o=o.length>0&&o[o.length-1])||6!==s[0]&&2!==s[0])){i=0;continue}if(3===s[0]&&(!o||s[1]>o[0]&&s[1]<o[3])){i.label=s[1];break}if(6===s[0]&&i.label<o[1]){i.label=o[1],o=s;break}if(o&&i.label<o[2]){i.label=o[2],i.ops.push(s);break}o[2]&&i.ops.pop(),i.trys.pop();continue}s=n.call(e,i)}catch(e){s=[6,e],r=0}finally{t=o=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,c])}}},a=this&&this.__read||function(e,n){var t="function"==typeof Symbol&&e[Symbol.iterator];if(!t)return e;var r,o,a=t.call(e),i=[];try{for(;(void 0===n||n-- >0)&&!(r=a.next()).done;)i.push(r.value)}catch(e){o={error:e}}finally{try{r&&!r.done&&(t=a.return)&&t.call(a)}finally{if(o)throw o.error}}return i},i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(n,"__esModule",{value:!0}),n.useIsTemporaryUser=n.checkIsTemporaryUser=n.checkIsPhoneNumberDuplicate=n.updateUser=n.useUser=void 0;var s=i(t(96540)),c=t(46239);function u(){return new Promise((function(e){return(0,c.sendMessageToBackgroundScript)({message:"checkIsTemporaryUser"},(function(n){e((null==n?void 0:n.isTemporaryUser)||!1)}))}))}n.useUser=function(){var e=a(s.default.useState(void 0),2),n=e[0],t=e[1];return s.default.useEffect((function(){(0,c.sendMessageToBackgroundScript)({message:"getUser"},(function(e){(null==e?void 0:e.user)&&t(e.user)}))}),[]),n},n.updateUser=function(e){return new Promise((function(n,t){return(0,c.sendMessageToBackgroundScript)({message:"updateUser",data:e},(function(e){return e.success?n():t()}))}))},n.checkIsPhoneNumberDuplicate=function(e){return new Promise((function(n,t){return(0,c.sendMessageToBackgroundScript)({message:"checkIsPhoneNumberDuplicate",data:{formattedPhoneNumber:e}},(function(e){var r=e.isDuplicate;void 0===r&&t(),n(!!r)}))}))},n.checkIsTemporaryUser=u,n.useIsTemporaryUser=function(){var e=this,n=a(s.default.useState(!1),2),t=n[0],i=n[1],c=function(){return r(e,void 0,void 0,(function(){var e;return o(this,(function(n){switch(n.label){case 0:return"visible"!==document.visibilityState?[3,2]:(e=i,[4,u()]);case 1:e.apply(void 0,[n.sent()]),n.label=2;case 2:return[2]}}))}))};return s.default.useEffect((function(){return function(){r(this,void 0,void 0,(function(){return o(this,(function(e){switch(e.label){case 0:return document.addEventListener("visibilitychange",c),[4,c()];case 1:return e.sent(),[2]}}))}))}(),function(){return document.removeEventListener("visibilitychange",c)}}),[]),t}},87439:(e,n)=>{Object.defineProperty(n,"__esModule",{value:!0}),n.compareVersions=void 0,n.compareVersions=function(e,n){for(var t=e.split("."),r=n.split("."),o=Math.max(t.length,r.length),a=0;a<o;a++){var i=parseInt(t[a]||"0"),s=parseInt(r[a]||"0");if(i<s)return-1;if(i>s)return 1}return 0}},66499:function(e,n,t){var r=this&&this.__awaiter||function(e,n,t,r){return new(t||(t=Promise))((function(o,a){function i(e){try{c(r.next(e))}catch(e){a(e)}}function s(e){try{c(r.throw(e))}catch(e){a(e)}}function c(e){var n;e.done?o(e.value):(n=e.value,n instanceof t?n:new t((function(e){e(n)}))).then(i,s)}c((r=r.apply(e,n||[])).next())}))},o=this&&this.__generator||function(e,n){var t,r,o,a,i={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return a={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function s(s){return function(c){return function(s){if(t)throw new TypeError("Generator is already executing.");for(;a&&(a=0,s[0]&&(i=0)),i;)try{if(t=1,r&&(o=2&s[0]?r.return:s[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,s[1])).done)return o;switch(r=0,o&&(s=[2&s[0],o.value]),s[0]){case 0:case 1:o=s;break;case 4:return i.label++,{value:s[1],done:!1};case 5:i.label++,r=s[1],s=[0];continue;case 7:s=i.ops.pop(),i.trys.pop();continue;default:if(!(o=i.trys,(o=o.length>0&&o[o.length-1])||6!==s[0]&&2!==s[0])){i=0;continue}if(3===s[0]&&(!o||s[1]>o[0]&&s[1]<o[3])){i.label=s[1];break}if(6===s[0]&&i.label<o[1]){i.label=o[1],o=s;break}if(o&&i.label<o[2]){i.label=o[2],i.ops.push(s);break}o[2]&&i.ops.pop(),i.trys.pop();continue}s=n.call(e,i)}catch(e){s=[6,e],r=0}finally{t=o=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,c])}}};Object.defineProperty(n,"__esModule",{value:!0}),n.retrieveConsentToTermsOfServiceAndPrivacyPolicyFromWebApp=n.setWebAppListener=n.openWebAppSignInPage=n.handleGetWebAppLoginInfoMessage=void 0;var a=t(74137),i=t(46239);n.handleGetWebAppLoginInfoMessage=function(){for(var e={},n=0;;n++){var t=localStorage.key(n);if(!t)break;("@AuthenticationStore:devStackMode"===t||t.startsWith("CognitoIdentityServiceProvider"))&&(e[t]=localStorage.getItem(t))}(0,i.sendMessageToBackgroundScript)({message:"webAppLoginInfoSent",data:e})};function s(e){if(e.source===window&&e.data.type&&"string"==typeof e.data.type&&e.data.type.startsWith("joko:"))switch(e.data.type){case"joko:saveOfferActivatedInitialUrlPayload":(0,i.sendMessageToBackgroundScript)({message:"saveOfferActivatedInitialUrlPayload",data:e.data.payload});break;case"joko:offerActivatedFromWebApp":(0,i.sendMessageToBackgroundScript)({message:"triggerPostAffiliateLinkLoadingActions",data:{offerId:e.data.payload.offerId,rememberActivation:!0}})}}n.openWebAppSignInPage=function(){return new Promise((function(e){(0,i.sendMessageToBackgroundScript)({message:"openTab",data:{url:"https://app.joko.com/auth/sign-in"}},e)}))},n.setWebAppListener=function(){var e=(0,a.withSentry)(s);window.removeEventListener("message",e),window.addEventListener("message",e)};n.retrieveConsentToTermsOfServiceAndPrivacyPolicyFromWebApp=function(){return r(this,void 0,void 0,(function(){var e,n;return o(this,(function(t){switch(t.label){case 0:return[4,new Promise((function(e){return setTimeout(e,1e3)}))];case 1:return t.sent(),function(){try{var e=new URL(window.location.href).hostname;return!!/app\.(hello)?joko\.com/.test(e)}catch(e){return(0,a.captureSentryException)(e),!1}}()?(e="true"===localStorage.getItem("@ConsentsStore:mobileSafariExtensionTermsOfServiceAndPrivacyPolicyConsent"),n="true"===localStorage.getItem("@ConsentsStore:mobileSafariExtensionTermsOfServiceAndPrivacyPolicyConsentIsDevStackMode"),e&&(0,i.sendMessageToBackgroundScript)({message:"termsOfServiceAndPrivacyPolicyConsentDetected",data:{isDevStackMode:n}}),[2]):[2]}}))}))}},13093:function(e,n,t){var r=this&&this.__assign||function(){return r=Object.assign||function(e){for(var n,t=1,r=arguments.length;t<r;t++)for(var o in n=arguments[t])Object.prototype.hasOwnProperty.call(n,o)&&(e[o]=n[o]);return e},r.apply(this,arguments)},o=this&&this.__awaiter||function(e,n,t,r){return new(t||(t=Promise))((function(o,a){function i(e){try{c(r.next(e))}catch(e){a(e)}}function s(e){try{c(r.throw(e))}catch(e){a(e)}}function c(e){var n;e.done?o(e.value):(n=e.value,n instanceof t?n:new t((function(e){e(n)}))).then(i,s)}c((r=r.apply(e,n||[])).next())}))},a=this&&this.__generator||function(e,n){var t,r,o,a,i={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return a={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function s(s){return function(c){return function(s){if(t)throw new TypeError("Generator is already executing.");for(;a&&(a=0,s[0]&&(i=0)),i;)try{if(t=1,r&&(o=2&s[0]?r.return:s[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,s[1])).done)return o;switch(r=0,o&&(s=[2&s[0],o.value]),s[0]){case 0:case 1:o=s;break;case 4:return i.label++,{value:s[1],done:!1};case 5:i.label++,r=s[1],s=[0];continue;case 7:s=i.ops.pop(),i.trys.pop();continue;default:if(!(o=i.trys,(o=o.length>0&&o[o.length-1])||6!==s[0]&&2!==s[0])){i=0;continue}if(3===s[0]&&(!o||s[1]>o[0]&&s[1]<o[3])){i.label=s[1];break}if(6===s[0]&&i.label<o[1]){i.label=o[1],o=s;break}if(o&&i.label<o[2]){i.label=o[2],i.ops.push(s);break}o[2]&&i.ops.pop(),i.trys.pop();continue}s=n.call(e,i)}catch(e){s=[6,e],r=0}finally{t=o=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,c])}}},i=this&&this.__rest||function(e,n){var t={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&n.indexOf(r)<0&&(t[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var o=0;for(r=Object.getOwnPropertySymbols(e);o<r.length;o++)n.indexOf(r[o])<0&&Object.prototype.propertyIsEnumerable.call(e,r[o])&&(t[r[o]]=e[r[o]])}return t},s=this&&this.__read||function(e,n){var t="function"==typeof Symbol&&e[Symbol.iterator];if(!t)return e;var r,o,a=t.call(e),i=[];try{for(;(void 0===n||n-- >0)&&!(r=a.next()).done;)i.push(r.value)}catch(e){o={error:e}}finally{try{r&&!r.done&&(t=a.return)&&t.call(a)}finally{if(o)throw o.error}}return i},c=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(n,"__esModule",{value:!0}),n.saveState=n.handleActiveState=n.startCouponApplication=n.startCouponAutomation=void 0;var u=c(t(2543)),l=t(55015),d=t(74137),p=t(95537),f=t(33682),m=t(18045),y=t(91958),h=t(99959),v=t(622),_=t(50479),g=t(42604),b=t(18345),C=t(98356),S=t(13103),T=t(11046),I=t(46239),A=t(89710),E=t(23907),k=t(72886);function O(e){return o(this,void 0,void 0,(function(){var n,t,r,o,i,s,c,u,l;return a(this,(function(a){switch(a.label){case 0:return B({passive:e}),n=e.coupons,t=e.offerId,r=e.selectors,o=e.shouldLoadAffiliateLinkOnAutomation,i=e.couponApplicationProcessId,s=e.displayedAmountSavedByUsersUsingAutoCoupons,c=e.totalAmountSavedByUsersUsingAutoCoupons,u=e.displayedSuccessRateAutoCoupons,l=e.lastUsedAtAutoCoupons,[4,(0,E.checkShouldDisplayCouponsCheckoutWidgetForOffer)(e)];case 1:return a.sent()?(0,E.handleCouponAutomationProposalWidgetDisplay)({numberOfCoupons:n.length,offerId:t,selectors:r,shouldLoadAffiliateLinkOnAutomation:o,startCouponApplication:function(n){return P(e,"couponWidget",n)},couponApplicationProcessId:i,displayedAmountSavedByUsersUsingAutoCoupons:s,totalAmountSavedByUsersUsingAutoCoupons:c,displayedSuccessRateAutoCoupons:u,lastUsedAtAutoCoupons:l}):(0,k.submitWidgetDisplayDecision)({widgetName:k.PriorityOrderedWidgetName.couponAutomationProposalWidget,shouldDisplayWidget:!1}),[2]}}))}))}function P(e,n,t){!1!==e.shouldLoadAffiliateLinkOnAutomation&&(0,A.handleUserInterfaceComponentInteractionInBackground)(r(r({},e),{triggeringEventType:l.UserInterfaceComponentInteractionEventType.couponSuggestionWidgetStartButton})),(0,I.sendMessageToBackgroundScript)({message:"updateMerchantOfferLastUsedAtAutoCoupons",data:{offerId:e.offerId,lastUsedAtAutoCouponsTimestampInSeconds:Math.floor(Date.now()/1e3)}}),e.stateType=l.CouponAutomationPassiveStateType.init,w(e,n,t)}function w(e,n,t){return o(this,void 0,void 0,(function(){var o,s;return a(this,(function(a){switch(a.label){case 0:return B({passive:e}),(0,C.injectScriptAndReplaceExistingOne)(C.InjectedScriptElement.countPendingRequests),o=function(){"couponWidget"===n&&(null==t||t());var o=(0,v.getPriceAmountAndCurrency)(e),a=o.priceAmount,s=o.priceCurrency,c=o.priceSelector;if(e.selectors.price=c,(0,_.logStartedCouponApplicationEvents)(e,n),null!==a&&s){var u=function(e,n,t){var o=e.shouldUseNetworkRequestsApplication,a=i(e,["shouldUseNetworkRequestsApplication"]);return{active:r(r({},a),{shouldUseNetworkRequestsApplication:o,shouldUseIframePriceParsing:o,basePrice:n,priceCurrency:t,couponIndex:0,isFinal:!1,webpageUrl:window.location.href,stateType:o?l.CouponAutomationActiveStateType.send:l.CouponAutomationActiveStateType.prepare})}}(e,a,s);(0,E.displayCouponApplicationWidget)(u,!1)}else(0,E.displayCouponApplicationWidget)({},!0)},(s=e.selectors.showCouponFieldClickableElement?e.selectors.showCouponFieldClickableElement.selector:void 0)&&!e.shouldUseNetworkRequestsApplication?[3,1]:(o(),[3,3]);case 1:return L(s),[4,(0,S.sleepUntilNoPendingRequestsAndUntilAllCouponElementsAreFoundWithTimeout)(e,S.SHOW_COUPON_FIELD_CLICKABLE_ELEMENT_POST_CLICK_DELAY_IN_MS,S.COUPON_ELEMENTS_INSPECTION_TIMEOUT_IN_MS)];case 2:a.sent(),o(),a.label=3;case 3:return[2]}}))}))}function L(e){var n=(0,f.getElementFromSelector)(e);(0,l.checkIsCouponSelectorError)(n)||"function"!=typeof n.click||n.click()}function B(e){var n=window.location.href;(0,I.sendMessageToBackgroundScript)({message:"saveCouponAutomationState",data:{state:e,url:n}})}function N(e){var n=e.coupons,t=e.bestCoupon,r=e.isFinal,o=e.couponIndex;return r&&t&&t!==n[o]}function M(e){return o(this,void 0,void 0,(function(){var n,t,r,o;return a(this,(function(a){switch(a.label){case 0:if(!e.networkRequestsParameters)throw new Error("Invalid or missing network request parameters");return n=(0,T.getCouponTokens)(e.responseParsingResult),t=Math.random().toString(36).substring(2,8).toUpperCase(),[4,(0,g.fetchMerchantApiCouponApplicationResponse)({couponCode:t,activeState:e,couponRequestTokens:n})];case 1:return r=a.sent(),[4,(0,b.checkWasApplicationSuccessfulFromMerchantApiResponse)({response:r,appliedCouponCode:t,activeState:e,warmupCouponApplicationStatus:void 0})];case 2:return o=a.sent(),[4,(0,S.sleepUntilNoPendingRequests)(S.NETWORK_REQUESTS_POST_COUPON_APPLICATION_DELAY_IN_MS)];case 3:if(a.sent(),"successful"===o.result.type)throw new Error("The response parsing mechanism interpreted the warmup application as a successful one");return e.warmupCouponApplicationStatus={wasResponseOk:r.ok},e.responseParsingResult=o,[2]}}))}))}function R(e,n){return o(this,void 0,void 0,(function(){var t,r,o;return a(this,(function(a){switch(a.label){case 0:return t=(0,T.getCouponTokens)(n.active?n.active.responseParsingResult:n.done?n.done.responseParsingResult:void 0),r=e.isFinal&&e.bestCoupon?e.bestCoupon.code:e.coupons[e.couponIndex].code,[4,(0,g.fetchMerchantApiCouponApplicationResponse)({couponCode:r,couponRequestTokens:t,activeState:e})];case 1:return o=a.sent(),[2,(0,b.checkWasApplicationSuccessfulFromMerchantApiResponse)({response:o,appliedCouponCode:r,activeState:e,warmupCouponApplicationStatus:n.active?n.active.warmupCouponApplicationStatus:n.done?n.done.warmupCouponApplicationStatus:void 0})]}}))}))}function D(e,n,t,r){return o(this,void 0,void 0,(function(){var o,i,s;return a(this,(function(a){switch(a.label){case 0:return[4,x()];case 1:if(o=a.sent(),!e.contentWindow)throw new Error("Iframe content window not found");return(i=e.contentWindow.document).open(),i.write(o),i.close(),[4,(0,S.sleepUntilNoPendingRequests)(100)];case 2:return a.sent(),s=(0,v.getPriceAmountAndCurrency)(n,i.body),W({nextActiveState:t,previousActiveState:n,priceAmount:s.priceAmount}),document.documentElement.removeChild(e),F({nextActiveState:t,previousActiveState:n,setState:r,priceAmount:s.priceAmount}),[2]}}))}))}function x(){return o(this,void 0,void 0,(function(){return a(this,(function(e){switch(e.label){case 0:return[4,fetch(window.location.href)];case 1:return[2,e.sent().text()]}}))}))}function U(e){var n=e.activeState,t=e.nextActiveState,r=e.setState,i=e.onError;return o(this,void 0,void 0,(function(){var e,o,s,c;return a(this,(function(a){switch(a.label){case 0:return e=(0,v.getPriceAmountAndCurrency)(n),o=e.priceAmount,s=e.priceSelector,t.selectors.price=s,o||!n.isPageReloading?[3,2]:[4,(0,S.sleepUntilNoPendingRequests)(S.SELECTORS_POST_PAGE_RELOAD_CHECK_VALIDITY_DELAY_IN_MS)];case 1:a.sent(),c=(0,v.getPriceAmountAndCurrency)(n),o=c.priceAmount,t.selectors.price=c.priceSelector,a.label=2;case 2:return o||n.shouldUseNetworkRequestsApplication?(W({nextActiveState:t,previousActiveState:n,priceAmount:o}),F({nextActiveState:t,previousActiveState:n,setState:r,priceAmount:o}),[2]):(i(n,Error("Could not read price."),!1),[2])}}))}))}function F(e){var n=e.nextActiveState,t=e.previousActiveState,r=e.setState,o=e.priceAmount,a={active:n};(0,_.logCouponTestedEvent)(a.active,t.webpageUrl,o),t.couponIndex+1>=t.coupons.length?(a.active.isFinal=!0,a.active.shouldUseIframePriceParsing=!1):a.active.couponIndex+=1,B(a),r(a)}function W(e){var n=e.nextActiveState,t=e.previousActiveState,r=e.priceAmount;null!==r&&(r>t.basePrice&&(n.basePrice=r),(t.bestPrice&&r<t.bestPrice||void 0===t.bestPrice&&r<t.basePrice)&&(n.bestPrice=r,n.bestCoupon=t.coupons[t.couponIndex])),!t.bestCoupon&&t.responseParsingResult&&"successful"===t.responseParsingResult.result.type&&(n.bestCoupon=t.coupons[t.couponIndex])}n.startCouponAutomation=function(){return o(this,void 0,void 0,(function(){var e,n;return a(this,(function(t){switch(t.label){case 0:return[4,(0,k.checkShouldPrioritizeAutoCouponsWidgetOverCashbackReminderWidget)()];case 1:return t.sent(),e=window.location.href,n=function(e){if(null==e?void 0:e.passive)e.passive.shouldUseNetworkRequestsApplication&&(0,C.injectScriptAndReplaceExistingOne)(C.InjectedScriptElement.captureHeadersAuthorizationToken),function(e){switch(e.stateType){case l.CouponAutomationPassiveStateType.inspect:!function(e){var n=this;if(0===e.coupons.length)return;(0,_.logCouponElementsDetectionMechanismStartedOnCartWebpage)(e);var t=0,r=u.default.once(_.logCouponElementsFoundEvent),i=(0,p.detectCouponCrmDriverForCurrentWebsite)(),s=window.setInterval((0,d.withSentry)((function(){return o(n,void 0,void 0,(function(){var n,o,c,u,d;return a(this,(function(a){switch(a.label){case 0:return t+=1,n=(0,m.checkDoCouponElementsExistAndUpdateSelectors)(e),o=n.doCouponElementsExist,c=n.selectors,u=(0,m.checkShowCouponElementsButtonExists)(c),e.selectors=c,(0,_.checkShouldLogElementsFoundEvent)(e)&&r(e),o||u?(clearInterval(s),e.stateType=l.CouponAutomationPassiveStateType.propose,e.selectors=c,[4,i]):[3,2];case 1:return(d=a.sent())&&(e.couponCrm=d.couponCrm),O(e),[3,3];case 2:(1===t&&!(0,E.checkShouldDisplayCouponsCheckoutWidgetForOffer)(e)||2===t)&&((0,k.submitWidgetDisplayDecision)({widgetName:k.PriorityOrderedWidgetName.couponAutomationProposalWidget,shouldDisplayWidget:!1}),(0,_.logCouponElementsNotFoundEvent)(e)),a.label=3;case 3:return[2]}}))}))})),S.COUPON_AUTOMATION_INSPECT_INTERVAL_IN_MS)}(e);break;case l.CouponAutomationPassiveStateType.propose:O(e);break;case l.CouponAutomationPassiveStateType.init:w(e,"couponWidget")}}(e.passive);else if(e&&(e.active||e.done)){(0,C.injectScriptAndReplaceExistingOne)(C.InjectedScriptElement.countPendingRequests);var n=function(e){return e.active?{active:r(r({},e.active),{isPageReloading:!0})}:e}(e);(0,E.displayCouponApplicationWidget)(n,!1)}else(0,k.submitWidgetDisplayDecision)({widgetName:k.PriorityOrderedWidgetName.couponAutomationProposalWidget,shouldDisplayWidget:!1})},(0,I.sendMessageToBackgroundScript)({message:"getCouponAutomationState",data:{url:e}},n),[2]}}))}))},n.startCouponApplication=P,n.handleActiveState=function(e,n,t){switch(e.stateType){case l.CouponAutomationActiveStateType.prepare:!function(e,n,t){o(this,void 0,void 0,(function(){var o,i,c,u,d,p,f,h;return a(this,(function(a){switch(a.label){case 0:if(o=e.selectors.showCouponFieldClickableElement?e.selectors.showCouponFieldClickableElement.selector:void 0,i=s((0,y.getRemovalButton)(e),2),c=i[0],u=i[1],e.selectors.removalButton=u,B(d={active:r(r({},e),{stateType:l.CouponAutomationActiveStateType.fill})}),e.isFinal&&(e.bestCoupon===e.coupons[e.couponIndex]||!e.bestCoupon))return n(d),[2];a.label=1;case 1:return a.trys.push([1,11,,12]),c?(c.click(),o?[3,3]:[4,(0,S.sleepUntilNoPendingRequestsAndUntilAllCouponElementsAreFoundWithTimeout)(d.active,S.REMOVAL_BUTTON_POST_CLICK_DELAY_IN_MS,S.COUPON_ELEMENTS_INSPECTION_TIMEOUT_IN_MS)]):[3,6];case 2:return a.sent(),[3,5];case 3:return[4,(0,S.sleepUntilNoPendingRequests)(S.REMOVAL_BUTTON_POST_CLICK_DELAY_IN_MS)];case 4:a.sent(),a.label=5;case 5:return[3,8];case 6:return(0,m.checkDoCouponElementsExistAndUpdateSelectors)(d.active).doCouponElementsExist?[3,8]:[4,(0,S.sleepUntilRemovalButtonElementIsFoundWithTimeout)(d.active,S.COUPON_ELEMENTS_INSPECTION_TIMEOUT_IN_MS)];case 7:a.sent(),p=s((0,y.getRemovalButton)(d.active),1),(f=p[0])&&f.click(),a.label=8;case 8:return!o||(0,m.checkDoCouponElementsExistAndUpdateSelectors)(d.active).doCouponElementsExist?[3,10]:(L(o),[4,(0,S.sleepUntilNoPendingRequestsAndUntilAllCouponElementsAreFoundWithTimeout)(d.active,S.SHOW_COUPON_FIELD_CLICKABLE_ELEMENT_POST_CLICK_DELAY_IN_MS,S.COUPON_ELEMENTS_INSPECTION_TIMEOUT_IN_MS)]);case 9:a.sent(),a.label=10;case 10:return n(d),[3,12];case 11:return h=a.sent(),t(e,h,!1),[3,12];case 12:return[2]}}))}))}(e,n,t);break;case l.CouponAutomationActiveStateType.fill:!function(e,n,t){var i=this,c=function(){return o(i,void 0,void 0,(function(){var o,i,c,u,d;return a(this,(function(a){switch(a.label){case 0:return e.isPageReloading?[4,(0,S.sleepUntilNoPendingRequestsAndUntilAllCouponElementsAreFoundWithTimeout)(e,S.FILL_COUPON_INPUT_FIELD_DELAY_IN_MS,S.COUPON_ELEMENTS_INSPECTION_TIMEOUT_IN_MS)]:[3,2];case 1:a.sent(),a.label=2;case 2:o={active:r(r({},e),{stateType:l.CouponAutomationActiveStateType.checkValidity,isPageReloading:void 0===e.isPageReloading||e.isPageReloading})},i=e.coupons[e.couponIndex],e.isFinal&&(void 0!==e.bestCoupon&&(i=e.bestCoupon),o={done:o.active}),B(o);try{e.isFinal&&!N(e)||function(e,n){var t=function(e,n){var t=n.selectors,r=s((0,h.getCouponInputField)(t),2),o=r[0],a=r[1];return n.selectors.couponField=a,o&&o instanceof HTMLInputElement?(o.focus(),o.click(),o.dispatchEvent(new KeyboardEvent("keydown",{key:"Backspace",bubbles:!0})),o.dispatchEvent(new KeyboardEvent("keyup",{key:"Backspace",bubbles:!0})),o.value=e,o.dispatchEvent(new Event("change",{bubbles:!0})),o.dispatchEvent(new Event("input",{bubbles:!0})),{wasFillingSuccessful:!0,couponInputFieldElement:o}):{wasFillingSuccessful:!1}}(n,e),r=t.wasFillingSuccessful,o=t.couponInputFieldElement;if(!r||!o)throw new Error("Coupon input field not found or invalid");!function(e,n){var t=s((0,y.getValidationButton)(e.selectors,n),2),r=t[0],o=t[1];e.selectors.validationButton=o,n.dispatchEvent(new KeyboardEvent("keydown",{key:"Enter",bubbles:!0})),n.dispatchEvent(new KeyboardEvent("keyup",{key:"Enter",bubbles:!0})),n.blur(),r&&r.click()}(e,o)}(e,i.code),e.isFinal&&((0,_.logCouponApplicationFinalEvents)(e),(0,E.setLastCouponAutomationResult)({type:E.CouponAutomationResultType.completed,timestampInMs:Date.now()}))}catch(n){return t(e,n,e.isFinal),[2]}c=!!o.active&&o.active.isPageReloading,a.label=3;case 3:return a.trys.push([3,5,,6]),u=e.customDelayBetweenApplicationsInMs?e.customDelayBetweenApplicationsInMs:c?S.COUPON_APPLICATION_PAGE_RELOAD_TIMEOUT_IN_MS:S.SELECTORS_POST_COUPON_APPLICATION_DELAY_IN_MS,[4,(0,S.sleepUntilNoPendingRequests)(u)];case 4:return a.sent(),n(r(r({},o),{active:o.active?r(r({},o.active),{isPageReloading:!1}):void 0})),[3,6];case 5:return d=a.sent(),t(e,d,e.isFinal),[3,6];case 6:return[2]}}))}))},u=e.isPageReloading,d=e.selectors,p=e.couponIndex;if(u){var f=d.showCouponFieldClickableElement?d.showCouponFieldClickableElement.selector:void 0;f&&p>0&&L(f)}(0,S.runCallbackOnPageFinishedLoading)(c,u)}(e,n,t);break;case l.CouponAutomationActiveStateType.send:!function(e,n,t){o(this,void 0,void 0,(function(){var o,i,s;return a(this,(function(a){switch(a.label){case 0:o=e.isFinal?{done:e}:{active:r(r({},e),{stateType:l.CouponAutomationActiveStateType.checkValidity})},i=Date.now(),a.label=1;case 1:if(a.trys.push([1,5,,6]),!e.networkRequestsParameters)throw new Error("Invalid or missing network request parameters");return!o.active||o.active.warmupCouponApplicationStatus?[3,3]:[4,M(o.active)];case 2:a.sent(),a.label=3;case 3:return[4,R(e,o)];case 4:return s=a.sent(),e.isFinal&&((0,_.logCouponApplicationFinalEvents)(e),(0,E.setLastCouponAutomationResult)({type:E.CouponAutomationResultType.completed,timestampInMs:Date.now()}),!N(e))?(B(o),n(o),[2]):(o.active&&(o.active.responseParsingResult=s,o.active.couponCrm=s.couponCrm),B(o),"successful"===s.result.type||N(e)&&e.isFinal?(function(e,n){var t;if(e.active&&(B(e),e.active.couponCrm)){var r=(0,p.getCouponCrmDriver)(e.active.couponCrm);try{return r.getAmountSaved(),void n(e)}catch(e){console.error(e)}}if(!(null===(t=e.active)||void 0===t?void 0:t.shouldUseIframePriceParsing))return e.active&&(e.active.isPageReloading=!0),setTimeout((function(){return n(e)}),S.COUPON_APPLICATION_PAGE_RELOAD_TIMEOUT_IN_MS),void window.location.reload();e.active&&(e.active.isPageReloading=!1);B(e),n(e)}(o,n),[2]):((0,S.executeDelayedCallback)(e.customDelayBetweenApplicationsInMs?e.customDelayBetweenApplicationsInMs:S.NETWORK_REQUESTS_POST_COUPON_APPLICATION_DELAY_IN_MS,i,(function(){return n(o)})),[3,6]));case 5:return function(e,n,t,o,a){if(t.active)return t.active.shouldUseNetworkRequestsApplication=!1,t.active.stateType=l.CouponAutomationActiveStateType.prepare,void o(t);if(t.done){return a.shouldUseNetworkRequestsApplication=!1,void o({active:r(r({},a),{stateType:l.CouponAutomationActiveStateType.prepare})})}n(a,e,!1)}(a.sent(),t,o,n,e),[3,6];case 6:return[2]}}))}))}(e,n,t);break;case l.CouponAutomationActiveStateType.checkValidity:!function(e,n,t){var i=this,s=function(){return o(i,void 0,void 0,(function(){var o,i,s;return a(this,(function(a){switch(a.label){case 0:return e.isPageReloading?[4,(0,S.sleepUntilNoPendingRequests)(e.shouldUseNetworkRequestsApplication?S.NETWORK_REQUESTS_POST_PAGE_RELOAD_CHECK_VALIDITY_DELAY_IN_MS:S.SELECTORS_POST_PAGE_RELOAD_CHECK_VALIDITY_DELAY_IN_MS)]:[3,2];case 1:a.sent(),a.label=2;case 2:if(o=r(r({},e),{webpageUrl:window.location.href,stateType:e.shouldUseNetworkRequestsApplication?l.CouponAutomationActiveStateType.send:l.CouponAutomationActiveStateType.prepare}),!e.couponCrm||!e.shouldUseNetworkRequestsApplication)return[3,3];try{return function(e){var n=e.activeState,t=e.nextActiveState,r=e.setState;if(!n.couponCrm)throw new Error("Missing coupon CRM");var o=(0,p.getCouponCrmDriver)(n.couponCrm),a=o.getAmountSaved().priceAmount;W({nextActiveState:t,previousActiveState:n,priceAmount:a}),F({nextActiveState:t,previousActiveState:n,setState:r,priceAmount:a})}({activeState:e,nextActiveState:o,setState:n}),[2]}catch(e){console.error(e)}return[3,9];case 3:if(!e.shouldUseNetworkRequestsApplication||!e.shouldUseIframePriceParsing)return[3,9];if(!e.responseParsingResult||"successful"!==e.responseParsingResult.result.type)return[3,8];(i=document.createElement("iframe")).style.display="none",document.documentElement.appendChild(i),a.label=4;case 4:return a.trys.push([4,6,,7]),[4,D(i,e,o,n)];case 5:return a.sent(),[2];case 6:return s=a.sent(),console.error(s),document.documentElement.contains(i)&&document.documentElement.removeChild(i),e.shouldUseNetworkRequestsApplication=!1,e.isPageReloading=!0,B({active:e}),window.location.reload(),[2];case 7:return[3,9];case 8:return F({nextActiveState:o,previousActiveState:e,setState:n,priceAmount:e.basePrice}),[2];case 9:return[4,U({activeState:e,nextActiveState:o,setState:n,onError:t})];case 10:return a.sent(),[2]}}))}))};(0,S.runCallbackOnPageFinishedLoading)(s,e.isPageReloading)}(e,n,t)}},n.saveState=B},50139:function(e,n,t){var r=this&&this.__values||function(e){var n="function"==typeof Symbol&&Symbol.iterator,t=n&&e[n],r=0;if(t)return t.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&r>=e.length&&(e=void 0),{value:e&&e[r++],done:!e}}};throw new TypeError(n?"Object is not iterable.":"Symbol.iterator is not defined.")},o=this&&this.__read||function(e,n){var t="function"==typeof Symbol&&e[Symbol.iterator];if(!t)return e;var r,o,a=t.call(e),i=[];try{for(;(void 0===n||n-- >0)&&!(r=a.next()).done;)i.push(r.value)}catch(e){o={error:e}}finally{try{r&&!r.done&&(t=a.return)&&t.call(a)}finally{if(o)throw o.error}}return i},a=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(n,"__esModule",{value:!0}),n.replaceFirstLeafFieldMatchingCriterionInObject=n.getLeafFieldValuesMatchingRegexesInObject=n.replaceArbitrarilyNestedFieldInObject=n.checkIsUuid=n.checkIsBase64Encoded=n.convertVariableNameToReadableText=n.standardizeText=n.BASE_COUPON_ELEMENTS_KEYWORDS=n.TEXT_HTML_TAGS=void 0;var i=a(t(2543));n.TEXT_HTML_TAGS=["span","div","dl","td","p","strong","section","dd","dt","em","del","b","h1","h2","h3","h4","h5","h6","i","title"],n.BASE_COUPON_ELEMENTS_KEYWORDS=["coupon","avantage","promo","discount","reduction","remise","rebate","voucher","code"],n.standardizeText=function(e){return i.default.deburr(e.toLowerCase().trim())},n.convertVariableNameToReadableText=function(e){return/^([A-Z_]+)$/.test(e)?e.toLowerCase().replace(/_/g," "):e.replace(/([A-Z])/g," $&").toLowerCase().replace(/(-|_)/g," ").replace(/\d/,"")},n.checkIsBase64Encoded=function(e){return/^[A-Za-z0-9+/\-_]{8,}={1,2}$/.test(e)},n.checkIsUuid=function(e){return/^[a-f\d]{8}(-[a-f\d]{4}){3}-[a-f\d]{12}$/i.test(e)},n.replaceArbitrarilyNestedFieldInObject=function e(n,t,o){var a,i;if(!n||"object"!=typeof n)return!1;if(t in n)return n[t]=o,!0;try{for(var s=r(Object.values(n)),c=s.next();!c.done;c=s.next()){var u=c.value;if("object"==typeof u&&e(u,t,o))return!0}}catch(e){a={error:e}}finally{try{c&&!c.done&&(i=s.return)&&i.call(s)}finally{if(a)throw a.error}}return!1},n.getLeafFieldValuesMatchingRegexesInObject=function e(n,t,a,i){var s,c;if(void 0===i&&(i=[]),!n||"object"!=typeof n)return i;var u=function(n,r){"object"==typeof r&&e(r,t,a,i),t.some((function(e){return e.test(n)}))&&!a.some((function(e){return e.test(n)}))&&i.push({fieldKey:n,fieldValue:r})};try{for(var l=r(Object.entries(n)),d=l.next();!d.done;d=l.next()){var p=o(d.value,2);u(p[0],p[1])}}catch(e){s={error:e}}finally{try{d&&!d.done&&(c=l.return)&&c.call(l)}finally{if(s)throw s.error}}return i},n.replaceFirstLeafFieldMatchingCriterionInObject=function e(n,t,a){var i,s;if(!n||"object"!=typeof n)return!1;try{for(var c=r(Object.entries(n)),u=c.next();!u.done;u=c.next()){var l=o(u.value,2),d=l[0],p=l[1];if("object"==typeof p&&e(p,t,a))return!0;if(t({key:d,value:p}))return n[d]=a,!0}}catch(e){i={error:e}}finally{try{u&&!u.done&&(s=c.return)&&s.call(c)}finally{if(i)throw i.error}}return!1}},9971:(e,n)=>{Object.defineProperty(n,"__esModule",{value:!0}),n.getAllCookieNames=n.getCookieValueByName=void 0,n.getCookieValueByName=function(e){var n=new RegExp("(^| )"+e+"=([^;]+)"),t=document.cookie.match(n);if(t)return t[2]},n.getAllCookieNames=function(){return document.cookie.split(";").map((function(e){return e.split("=")[0].trim()}))}},73703:function(e,n,t){var r=this&&this.__read||function(e,n){var t="function"==typeof Symbol&&e[Symbol.iterator];if(!t)return e;var r,o,a=t.call(e),i=[];try{for(;(void 0===n||n-- >0)&&!(r=a.next()).done;)i.push(r.value)}catch(e){o={error:e}}finally{try{r&&!r.done&&(t=a.return)&&t.call(a)}finally{if(o)throw o.error}}return i},o=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(n,"__esModule",{value:!0}),n.useCouponApplicationWidgetInnerState=n.useCouponAutomationProposalWidgetInnerState=void 0;var a=o(t(96540)),i=t(55015),s=t(74137),c=t(26368),u=t(31229),l=t(13093),d=t(622),p=t(50479),f=t(23907),m=t(94700);n.useCouponAutomationProposalWidgetInnerState=function(e){var n=e.startCouponApplication,t=e.offerId,r=e.closeButtonDisplayedText,o=(0,m.useWidgetDisplay)(),c=o.isWidgetDisplayed,l=o.closeWidget,d=o.onWidgetInnerStateLoadEnd,y=(0,u.useIsTemporaryUser)(),h=a.default.useCallback((function(){(0,p.logClosedCouponWidgetEvents)(t,y,r),(0,f.setLastCouponAutomationResult)({type:f.CouponAutomationResultType.dismissed,timestampInMs:Date.now()}),l()}),[]),v=a.default.useCallback((function(){return n(l)}),[]);return a.default.useEffect((function(){var e=(0,s.withSentry)((function(e,n){var t;if("local"===n){var r=new URL(window.location.href).hostname,o="".concat(i.LocalStorageKey.couponAutomationStateKeyPrefix).concat(r);!e[o]||(null===(t=e[o].newValue.state)||void 0===t?void 0:t.passive)&&e[o].newValue.state.passive.stateType===i.CouponAutomationPassiveStateType.propose||l()}}));return chrome.storage.onChanged.addListener(e),function(){return chrome.storage.onChanged.removeListener(e)}}),[l]),a.default.useEffect(d,[]),{onClickStartButton:v,onClickWidgetCloseButton:h,isWidgetDisplayed:c}},n.useCouponApplicationWidgetInnerState=function(e,n){var t=(0,m.useWidgetDisplay)(),o=t.isWidgetDisplayed,s=t.closeWidget,y=t.onWidgetInnerStateLoadEnd,h=(0,u.useIsTemporaryUser)(),v=r(a.default.useState(!1),2),_=v[0],g=v[1],b=r(a.default.useState(n),2),C=b[0],S=b[1],T=r(a.default.useState(e),2),I=T[0],A=T[1],E=(0,i.useLocalizedTexts)().contentscript.couponAutomation.applicationWidget.progressContent.exitConfirmationContent,k=a.default.useCallback((function(){if(!I.active||I.active.isFinal||I.active.isPageReloading||C||window.confirm(E)){var e=I.passive?I.passive.offerId:I.active?I.active.offerId:I.done?I.done.offerId:void 0;(0,p.logClosedCouponWidgetEvents)(e,h),function(e,n,t,r,o){!e.active||n||e.active.isFinal||((0,p.logCancelledCouponApplicationEvents)(e),t(!0),(0,f.setLastCouponAutomationResult)({type:f.CouponAutomationResultType.cancelled,timestampInMs:Date.now()}));setTimeout((function(){r({}),o({})}),1e3*c.OPEN_AND_CLOSE_ANIMATIONS_DURATION_IN_SECONDS)}(I,C,g,A,l.saveState),s()}}),[I,C,h]),O=a.default.useCallback((function(e,n,t){return function(e,n,t,r,o){if(function(e){if(!e)return!1;var n=(0,d.getPriceAmountAndCurrency)(e).priceAmount;if(!n)return!1;if(n<e.basePrice&&(!e.bestPrice||n<=e.bestPrice))return e.bestPrice=n,e.bestCoupon||(e.bestCoupon=e.coupons[e.couponIndex]),!0;return!1}(e)){var a={done:e};o(a),(0,l.saveState)(a),(0,p.logCouponApplicationSucceededEvents)(e,!1,t?e.coupons.length:e.couponIndex),(0,f.setLastCouponAutomationResult)({type:f.CouponAutomationResultType.completed,timestampInMs:Date.now()})}else{var i=void 0;n instanceof Error&&(i=n.message),r(!0),(0,p.logCouponApplicationFailedEvents)(e,!0,i,t?e.coupons.length:e.couponIndex),(0,f.setLastCouponAutomationResult)({type:f.CouponAutomationResultType.crashed,timestampInMs:Date.now()})}}(e,n,t,S,A)}),[]);return a.default.useEffect((function(){void 0!==I.active&&(_||(0,l.handleActiveState)(I.active,A,O))}),[I]),a.default.useEffect(y,[]),{isWidgetDisplayed:o,state:I,hasError:C,stopAutomationAndCloseWidget:k,closeWidget:s}}},95537:function(e,n,t){var r=this&&this.__awaiter||function(e,n,t,r){return new(t||(t=Promise))((function(o,a){function i(e){try{c(r.next(e))}catch(e){a(e)}}function s(e){try{c(r.throw(e))}catch(e){a(e)}}function c(e){var n;e.done?o(e.value):(n=e.value,n instanceof t?n:new t((function(e){e(n)}))).then(i,s)}c((r=r.apply(e,n||[])).next())}))},o=this&&this.__generator||function(e,n){var t,r,o,a,i={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return a={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function s(s){return function(c){return function(s){if(t)throw new TypeError("Generator is already executing.");for(;a&&(a=0,s[0]&&(i=0)),i;)try{if(t=1,r&&(o=2&s[0]?r.return:s[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,s[1])).done)return o;switch(r=0,o&&(s=[2&s[0],o.value]),s[0]){case 0:case 1:o=s;break;case 4:return i.label++,{value:s[1],done:!1};case 5:i.label++,r=s[1],s=[0];continue;case 7:s=i.ops.pop(),i.trys.pop();continue;default:if(!(o=i.trys,(o=o.length>0&&o[o.length-1])||6!==s[0]&&2!==s[0])){i=0;continue}if(3===s[0]&&(!o||s[1]>o[0]&&s[1]<o[3])){i.label=s[1];break}if(6===s[0]&&i.label<o[1]){i.label=o[1],o=s;break}if(o&&i.label<o[2]){i.label=o[2],i.ops.push(s);break}o[2]&&i.ops.pop(),i.trys.pop();continue}s=n.call(e,i)}catch(e){s=[6,e],r=0}finally{t=o=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,c])}}};Object.defineProperty(n,"__esModule",{value:!0}),n.getCouponCrmDriver=n.detectCouponCrmDriverForCurrentWebsite=void 0;var a=t(55015),i=t(28722),s=t(21472),c=t(89342),u=t(49557),l=t(69375),d=t(60778),p=t(59102);n.detectCouponCrmDriverForCurrentWebsite=function(){return r(this,void 0,void 0,(function(){var e,n,t=this;return o(this,(function(a){switch(a.label){case 0:return e=[new i.DemandwareDriver,new s.ShopifyDriver,new c.WooCommerceDriver,new u.PrestaShopDriver,new l.BigCommerceDriver,new d.OpenCartDriver,new p.WixDriver],[4,Promise.all(e.map((function(e){return r(t,void 0,void 0,(function(){var n;return o(this,(function(t){switch(t.label){case 0:return n={couponDriver:e},[4,e.checkShouldUseDriver()];case 1:return[2,(n.shouldUseDriver=t.sent(),n)]}}))}))})))];case 1:return 1===(n=a.sent().filter((function(e){return e.shouldUseDriver})).map((function(e){return e.couponDriver}))).length?(f.crmDriver=n[0],[2,n[0]]):[2,void 0]}}))}))};var f={crmDriver:void 0};n.getCouponCrmDriver=function(e){if(f.crmDriver&&f.crmDriver.couponCrm===e)return f.crmDriver;switch(e){case a.CouponCrm.demandware:f.crmDriver=new i.DemandwareDriver;break;case a.CouponCrm.shopify:f.crmDriver=new s.ShopifyDriver;break;case a.CouponCrm.wooCommerce:f.crmDriver=new c.WooCommerceDriver;break;case a.CouponCrm.prestaShop:f.crmDriver=new u.PrestaShopDriver;break;case a.CouponCrm.bigCommerce:f.crmDriver=new l.BigCommerceDriver;break;case a.CouponCrm.openCart:f.crmDriver=new d.OpenCartDriver;break;case a.CouponCrm.wix:f.crmDriver=new p.WixDriver}return f.crmDriver}},33757:(e,n)=>{Object.defineProperty(n,"__esModule",{value:!0}),n.BaseCouponCrmDriver=void 0;var t=function(){function e(e,n){this.couponCrm=e,this.expectedContentType=n,this.responseBody=void 0}return e.prototype.checkIsValidContentType=function(e){if(this.expectedContentType){var n=e.headers.get("content-type")||void 0;if(!n||!n.includes(this.expectedContentType))throw new Error("Unexpected response content type")}},e}();n.BaseCouponCrmDriver=t},69375:function(e,n,t){var r,o=this&&this.__extends||(r=function(e,n){return r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,n){e.__proto__=n}||function(e,n){for(var t in n)Object.prototype.hasOwnProperty.call(n,t)&&(e[t]=n[t])},r(e,n)},function(e,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function t(){this.constructor=e}r(e,n),e.prototype=null===n?Object.create(n):(t.prototype=n.prototype,new t)}),a=this&&this.__awaiter||function(e,n,t,r){return new(t||(t=Promise))((function(o,a){function i(e){try{c(r.next(e))}catch(e){a(e)}}function s(e){try{c(r.throw(e))}catch(e){a(e)}}function c(e){var n;e.done?o(e.value):(n=e.value,n instanceof t?n:new t((function(e){e(n)}))).then(i,s)}c((r=r.apply(e,n||[])).next())}))},i=this&&this.__generator||function(e,n){var t,r,o,a,i={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return a={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function s(s){return function(c){return function(s){if(t)throw new TypeError("Generator is already executing.");for(;a&&(a=0,s[0]&&(i=0)),i;)try{if(t=1,r&&(o=2&s[0]?r.return:s[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,s[1])).done)return o;switch(r=0,o&&(s=[2&s[0],o.value]),s[0]){case 0:case 1:o=s;break;case 4:return i.label++,{value:s[1],done:!1};case 5:i.label++,r=s[1],s=[0];continue;case 7:s=i.ops.pop(),i.trys.pop();continue;default:if(!(o=i.trys,(o=o.length>0&&o[o.length-1])||6!==s[0]&&2!==s[0])){i=0;continue}if(3===s[0]&&(!o||s[1]>o[0]&&s[1]<o[3])){i.label=s[1];break}if(6===s[0]&&i.label<o[1]){i.label=o[1],o=s;break}if(o&&i.label<o[2]){i.label=o[2],i.ops.push(s);break}o[2]&&i.ops.pop(),i.trys.pop();continue}s=n.call(e,i)}catch(e){s=[6,e],r=0}finally{t=o=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,c])}}};Object.defineProperty(n,"__esModule",{value:!0}),n.BigCommerceDriver=void 0;var s=t(55015),c=function(e){function n(){return e.call(this,s.CouponCrm.bigCommerce,"application/json")||this}return o(n,e),n.prototype.checkShouldUseDriver=function(){return!!document.querySelector('meta[content*="bigcommerce"]')},n.prototype.checkIsCouponApplicationSuccessful=function(e){return a(this,void 0,void 0,(function(){var n;return i(this,(function(t){switch(t.label){case 0:return this.checkIsValidContentType(e),n=this,[4,e.json()];case 1:if(n.responseBody=t.sent(),!this.responseBody.data&&!this.responseBody.data.hasOwnProperty("status"))throw new Error("Unexpected response structure");return[2,"success"===this.responseBody.data.status]}}))}))},n.prototype.applyCoupon=function(){return a(this,void 0,void 0,(function(){return i(this,(function(e){throw new Error("Not implemented")}))}))},n.prototype.getAmountSaved=function(){throw new Error("Not implemented")},n}(t(33757).BaseCouponCrmDriver);n.BigCommerceDriver=c},28722:function(e,n,t){var r,o=this&&this.__extends||(r=function(e,n){return r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,n){e.__proto__=n}||function(e,n){for(var t in n)Object.prototype.hasOwnProperty.call(n,t)&&(e[t]=n[t])},r(e,n)},function(e,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function t(){this.constructor=e}r(e,n),e.prototype=null===n?Object.create(n):(t.prototype=n.prototype,new t)}),a=this&&this.__awaiter||function(e,n,t,r){return new(t||(t=Promise))((function(o,a){function i(e){try{c(r.next(e))}catch(e){a(e)}}function s(e){try{c(r.throw(e))}catch(e){a(e)}}function c(e){var n;e.done?o(e.value):(n=e.value,n instanceof t?n:new t((function(e){e(n)}))).then(i,s)}c((r=r.apply(e,n||[])).next())}))},i=this&&this.__generator||function(e,n){var t,r,o,a,i={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return a={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function s(s){return function(c){return function(s){if(t)throw new TypeError("Generator is already executing.");for(;a&&(a=0,s[0]&&(i=0)),i;)try{if(t=1,r&&(o=2&s[0]?r.return:s[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,s[1])).done)return o;switch(r=0,o&&(s=[2&s[0],o.value]),s[0]){case 0:case 1:o=s;break;case 4:return i.label++,{value:s[1],done:!1};case 5:i.label++,r=s[1],s=[0];continue;case 7:s=i.ops.pop(),i.trys.pop();continue;default:if(!(o=i.trys,(o=o.length>0&&o[o.length-1])||6!==s[0]&&2!==s[0])){i=0;continue}if(3===s[0]&&(!o||s[1]>o[0]&&s[1]<o[3])){i.label=s[1];break}if(6===s[0]&&i.label<o[1]){i.label=o[1],o=s;break}if(o&&i.label<o[2]){i.label=o[2],i.ops.push(s);break}o[2]&&i.ops.pop(),i.trys.pop();continue}s=n.call(e,i)}catch(e){s=[6,e],r=0}finally{t=o=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,c])}}};Object.defineProperty(n,"__esModule",{value:!0}),n.DemandwareDriver=void 0;var s=t(55015),c=function(e){function n(){return e.call(this,s.CouponCrm.demandware,"application/json")||this}return o(n,e),n.prototype.checkShouldUseDriver=function(){return!!document.querySelector('form[action*="/on/demandware.store/"][action$="Cart-AddCoupon"], script[src*="demandware.static"], img[src*="demandware.static"]')},n.prototype.checkIsCouponApplicationSuccessful=function(e){return a(this,void 0,void 0,(function(){var n;return i(this,(function(t){switch(t.label){case 0:return this.checkIsValidContentType(e),n=this,[4,e.json()];case 1:if(n.responseBody=t.sent(),this.responseBody.hasOwnProperty("ok"))return[2,this.responseBody.ok];if(this.responseBody.hasOwnProperty("error"))return[2,!this.responseBody.error];throw new Error("Unexpected response structure")}}))}))},n.prototype.applyCoupon=function(){return a(this,void 0,void 0,(function(){return i(this,(function(e){throw new Error("Not implemented")}))}))},n.prototype.getAmountSaved=function(){throw new Error("Not implemented")},n}(t(33757).BaseCouponCrmDriver);n.DemandwareDriver=c},60778:function(e,n,t){var r,o=this&&this.__extends||(r=function(e,n){return r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,n){e.__proto__=n}||function(e,n){for(var t in n)Object.prototype.hasOwnProperty.call(n,t)&&(e[t]=n[t])},r(e,n)},function(e,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function t(){this.constructor=e}r(e,n),e.prototype=null===n?Object.create(n):(t.prototype=n.prototype,new t)}),a=this&&this.__awaiter||function(e,n,t,r){return new(t||(t=Promise))((function(o,a){function i(e){try{c(r.next(e))}catch(e){a(e)}}function s(e){try{c(r.throw(e))}catch(e){a(e)}}function c(e){var n;e.done?o(e.value):(n=e.value,n instanceof t?n:new t((function(e){e(n)}))).then(i,s)}c((r=r.apply(e,n||[])).next())}))},i=this&&this.__generator||function(e,n){var t,r,o,a,i={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return a={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function s(s){return function(c){return function(s){if(t)throw new TypeError("Generator is already executing.");for(;a&&(a=0,s[0]&&(i=0)),i;)try{if(t=1,r&&(o=2&s[0]?r.return:s[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,s[1])).done)return o;switch(r=0,o&&(s=[2&s[0],o.value]),s[0]){case 0:case 1:o=s;break;case 4:return i.label++,{value:s[1],done:!1};case 5:i.label++,r=s[1],s=[0];continue;case 7:s=i.ops.pop(),i.trys.pop();continue;default:if(!(o=i.trys,(o=o.length>0&&o[o.length-1])||6!==s[0]&&2!==s[0])){i=0;continue}if(3===s[0]&&(!o||s[1]>o[0]&&s[1]<o[3])){i.label=s[1];break}if(6===s[0]&&i.label<o[1]){i.label=o[1],o=s;break}if(o&&i.label<o[2]){i.label=o[2],i.ops.push(s);break}o[2]&&i.ops.pop(),i.trys.pop();continue}s=n.call(e,i)}catch(e){s=[6,e],r=0}finally{t=o=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,c])}}};Object.defineProperty(n,"__esModule",{value:!0}),n.OpenCartDriver=n.OPEN_CART_JAVASCRIPT_BROADCAST_CHANNEL_NAME=void 0;var s=t(55015),c=t(33757),u=t(98356);n.OPEN_CART_JAVASCRIPT_BROADCAST_CHANNEL_NAME="jokoAreOpenCartJavascriptVariablesDefinedChannel";var l=function(e){function t(){return e.call(this,s.CouponCrm.openCart)||this}return o(t,e),t.prototype.checkShouldUseDriver=function(){return a(this,void 0,void 0,(function(){return i(this,(function(e){switch(e.label){case 0:return document.querySelector('a[href*="index.php?route=checkout"], form[action*="index.php?route=checkout/cart"]')?[2,!0]:[4,this.refreshDoOpenCartJavascriptVariablesExist()];case 1:return e.sent(),[2,!!this.doOpenCartJavascriptVariablesExist]}}))}))},t.prototype.refreshDoOpenCartJavascriptVariablesExist=function(){return a(this,void 0,void 0,(function(){var e,t=this;return i(this,(function(r){return e=new BroadcastChannel(n.OPEN_CART_JAVASCRIPT_BROADCAST_CHANNEL_NAME),(0,u.injectScriptAndReplaceExistingOne)(u.InjectedScriptElement.checkOpenCartJavascriptVariablesExist),[2,Promise.race([new Promise((function(n){e.onmessage=function(r){e.close(),t.doOpenCartJavascriptVariablesExist=!!r.data,n()}})),new Promise((function(n){setTimeout((function(){e.close(),n()}),200)}))])]}))}))},t.prototype.checkIsCouponApplicationSuccessful=function(e){return a(this,void 0,void 0,(function(){var n;return i(this,(function(t){switch(t.label){case 0:return n=this,[4,e.text()];case 1:return n.responseBody=t.sent(),[2,!/invalid||error/i.test(this.responseBody)]}}))}))},t.prototype.applyCoupon=function(){return a(this,void 0,void 0,(function(){return i(this,(function(e){throw new Error("Not implemented")}))}))},t.prototype.getAmountSaved=function(){throw new Error("Not implemented")},t}(c.BaseCouponCrmDriver);n.OpenCartDriver=l},49557:function(e,n,t){var r,o=this&&this.__extends||(r=function(e,n){return r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,n){e.__proto__=n}||function(e,n){for(var t in n)Object.prototype.hasOwnProperty.call(n,t)&&(e[t]=n[t])},r(e,n)},function(e,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function t(){this.constructor=e}r(e,n),e.prototype=null===n?Object.create(n):(t.prototype=n.prototype,new t)}),a=this&&this.__awaiter||function(e,n,t,r){return new(t||(t=Promise))((function(o,a){function i(e){try{c(r.next(e))}catch(e){a(e)}}function s(e){try{c(r.throw(e))}catch(e){a(e)}}function c(e){var n;e.done?o(e.value):(n=e.value,n instanceof t?n:new t((function(e){e(n)}))).then(i,s)}c((r=r.apply(e,n||[])).next())}))},i=this&&this.__generator||function(e,n){var t,r,o,a,i={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return a={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function s(s){return function(c){return function(s){if(t)throw new TypeError("Generator is already executing.");for(;a&&(a=0,s[0]&&(i=0)),i;)try{if(t=1,r&&(o=2&s[0]?r.return:s[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,s[1])).done)return o;switch(r=0,o&&(s=[2&s[0],o.value]),s[0]){case 0:case 1:o=s;break;case 4:return i.label++,{value:s[1],done:!1};case 5:i.label++,r=s[1],s=[0];continue;case 7:s=i.ops.pop(),i.trys.pop();continue;default:if(!(o=i.trys,(o=o.length>0&&o[o.length-1])||6!==s[0]&&2!==s[0])){i=0;continue}if(3===s[0]&&(!o||s[1]>o[0]&&s[1]<o[3])){i.label=s[1];break}if(6===s[0]&&i.label<o[1]){i.label=o[1],o=s;break}if(o&&i.label<o[2]){i.label=o[2],i.ops.push(s);break}o[2]&&i.ops.pop(),i.trys.pop();continue}s=n.call(e,i)}catch(e){s=[6,e],r=0}finally{t=o=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,c])}}};Object.defineProperty(n,"__esModule",{value:!0}),n.PrestaShopDriver=n.PRESTASHOP_JAVASCRIPT_OBJECT_BROADCAST_CHANNEL_NAME=void 0;var s=t(55015),c=t(33757),u=t(98356);n.PRESTASHOP_JAVASCRIPT_OBJECT_BROADCAST_CHANNEL_NAME="jokoPrestaShopJavascriptObjectChannel";var l=function(e){function t(){return e.call(this,s.CouponCrm.prestaShop,"application/json")||this}return o(t,e),t.prototype.checkShouldUseDriver=function(){return a(this,void 0,void 0,(function(){return i(this,(function(e){switch(e.label){case 0:return[4,this.refreshPrestashopJavascriptObject()];case 1:return e.sent(),[2,!!this.prestaShopJavascriptObject]}}))}))},t.prototype.refreshPrestashopJavascriptObject=function(){return a(this,void 0,void 0,(function(){var e,t=this;return i(this,(function(r){return e=new BroadcastChannel(n.PRESTASHOP_JAVASCRIPT_OBJECT_BROADCAST_CHANNEL_NAME),(0,u.injectScriptAndReplaceExistingOne)(u.InjectedScriptElement.capturePrestashopJavascriptObject),[2,Promise.race([new Promise((function(n){e.onmessage=function(r){e.close(),t.prestaShopJavascriptObject=r.data,n()}})),new Promise((function(n){setTimeout((function(){e.close(),n()}),200)}))])]}))}))},t.prototype.checkIsCouponApplicationSuccessful=function(e){return a(this,void 0,void 0,(function(){var n;return i(this,(function(t){switch(t.label){case 0:return this.checkIsValidContentType(e),n=this,[4,e.json()];case 1:if(n.responseBody=t.sent(),!this.responseBody.hasOwnProperty("success"))throw new Error("Unexpected response structure");return[2,this.responseBody.success]}}))}))},t.prototype.applyCoupon=function(){return a(this,void 0,void 0,(function(){return i(this,(function(e){throw new Error("Not implemented")}))}))},t.prototype.getAmountSaved=function(){throw new Error("Not implemented")},t}(c.BaseCouponCrmDriver);n.PrestaShopDriver=l},21472:function(e,n,t){var r,o=this&&this.__extends||(r=function(e,n){return r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,n){e.__proto__=n}||function(e,n){for(var t in n)Object.prototype.hasOwnProperty.call(n,t)&&(e[t]=n[t])},r(e,n)},function(e,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function t(){this.constructor=e}r(e,n),e.prototype=null===n?Object.create(n):(t.prototype=n.prototype,new t)}),a=this&&this.__awaiter||function(e,n,t,r){return new(t||(t=Promise))((function(o,a){function i(e){try{c(r.next(e))}catch(e){a(e)}}function s(e){try{c(r.throw(e))}catch(e){a(e)}}function c(e){var n;e.done?o(e.value):(n=e.value,n instanceof t?n:new t((function(e){e(n)}))).then(i,s)}c((r=r.apply(e,n||[])).next())}))},i=this&&this.__generator||function(e,n){var t,r,o,a,i={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return a={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function s(s){return function(c){return function(s){if(t)throw new TypeError("Generator is already executing.");for(;a&&(a=0,s[0]&&(i=0)),i;)try{if(t=1,r&&(o=2&s[0]?r.return:s[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,s[1])).done)return o;switch(r=0,o&&(s=[2&s[0],o.value]),s[0]){case 0:case 1:o=s;break;case 4:return i.label++,{value:s[1],done:!1};case 5:i.label++,r=s[1],s=[0];continue;case 7:s=i.ops.pop(),i.trys.pop();continue;default:if(!(o=i.trys,(o=o.length>0&&o[o.length-1])||6!==s[0]&&2!==s[0])){i=0;continue}if(3===s[0]&&(!o||s[1]>o[0]&&s[1]<o[3])){i.label=s[1];break}if(6===s[0]&&i.label<o[1]){i.label=o[1],o=s;break}if(o&&i.label<o[2]){i.label=o[2],i.ops.push(s);break}o[2]&&i.ops.pop(),i.trys.pop();continue}s=n.call(e,i)}catch(e){s=[6,e],r=0}finally{t=o=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,c])}}},s=this&&this.__read||function(e,n){var t="function"==typeof Symbol&&e[Symbol.iterator];if(!t)return e;var r,o,a=t.call(e),i=[];try{for(;(void 0===n||n-- >0)&&!(r=a.next()).done;)i.push(r.value)}catch(e){o={error:e}}finally{try{r&&!r.done&&(t=a.return)&&t.call(a)}finally{if(o)throw o.error}}return i};Object.defineProperty(n,"__esModule",{value:!0}),n.ShopifyDriver=void 0;var c=t(55015),u=t(9971),l=t(33757),d=t(76070),p=["REDUCTION_INVALID_DISCOUNT_CODE","REDUCTION_INVALID_CODE"],f=function(e){function n(){var n=e.call(this,c.CouponCrm.shopify,"application/json")||this;return n.shopifyTokens=n.getInitialShopifyTokens(),n.graphqlApiEndpointUrl="https://".concat(new URL(window.location.href).hostname,"/checkouts/unstable/graphql"),n}return o(n,e),n.prototype.getInitialShopifyTokens=function(){var e=s(n.SHOPIFY_TOKENS_META_TAG_SELECTORS.map((function(e){return document.querySelector(e)})).map((function(e){return e?e.getAttribute("content"):null})).map((function(e){return e?e.substring(1,e.length-1):null})),2),t=e[0],r=e[1],o=(0,u.getCookieValueByName)("queue_token");if(t&&r&&o)return{sessionToken:t,sourceToken:r,queueToken:o}},n.prototype.checkShouldUseDriver=function(){return!!document.querySelector('script[src*="cdn.shopify.com"]')},n.prototype.checkIsCouponApplicationSuccessful=function(e){return a(this,void 0,void 0,(function(){var n,t;return i(this,(function(r){switch(r.label){case 0:return n=this,[4,e.json()];case 1:if(n.responseBody=r.sent(),!(this.responseBody&&this.responseBody.data&&this.responseBody.data.session&&this.responseBody.data.session.negotiate))throw new Error("Unexpected response structure");return this.responseBody.data.session.negotiate.hasOwnProperty("errors")?(t=new Set(this.responseBody.data.session.negotiate.errors.map((function(e){return e.code}))),[2,!p.some((function(e){return t.has(e)}))]):[2,!0]}}))}))},n.prototype.applyCoupon=function(e){return a(this,void 0,void 0,(function(){var n;return i(this,(function(t){if(!this.shopifyTokens)throw new Error("Shopify tokens not found");return n={sessionInput:{sessionToken:this.shopifyTokens.sessionToken},reduction:{code:e}},[2,fetch(this.graphqlApiEndpointUrl,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({query:d.shopifyProposalQuery,variables:n})})]}))}))},n.prototype.getAmountSaved=function(){throw new Error("Not implemented")},n.SHOPIFY_TOKENS_META_TAG_SELECTORS=['meta[name="serialized-session-token"]','meta[name="serialized-source-token"]'],n}(l.BaseCouponCrmDriver);n.ShopifyDriver=f},76070:(e,n)=>{Object.defineProperty(n,"__esModule",{value:!0}),n.shopifyProposalQuery=void 0,n.shopifyProposalQuery="\n    query Proposal(\n        $alternativePaymentCurrency: AlternativePaymentCurrencyInput\n        $delivery: DeliveryTermsInput\n        $discounts: DiscountTermsInput\n        $payment: PaymentTermInput\n        $merchandise: MerchandiseTermInput\n        $buyerIdentity: BuyerIdentityTermInput\n        $taxes: TaxTermInput\n        $sessionInput: SessionTokenInput!\n        $checkpointData: String\n        $queueToken: String\n        $reduction: ReductionInput\n        $availableRedeemables: AvailableRedeemablesInput\n        $changesetTokens: [String!]\n        $tip: TipTermInput\n        $note: NoteInput\n        $localizationExtension: LocalizationExtensionInput\n        $nonNegotiableTerms: NonNegotiableTermsInput\n        $scriptFingerprint: ScriptFingerprintInput\n        $transformerFingerprintV2: String\n        $optionalDuties: OptionalDutiesInput\n        $attribution: AttributionInput\n        $captcha: CaptchaInput\n        $poNumber: String\n        $saleAttributions: SaleAttributionsInput\n    ) {\n        session(sessionInput: $sessionInput) {\n            negotiate(\n                input: {\n                    purchaseProposal: {\n                        alternativePaymentCurrency: $alternativePaymentCurrency\n                        delivery: $delivery\n                        discounts: $discounts\n                        payment: $payment\n                        merchandise: $merchandise\n                        buyerIdentity: $buyerIdentity\n                        taxes: $taxes\n                        reduction: $reduction\n                        availableRedeemables: $availableRedeemables\n                        tip: $tip\n                        note: $note\n                        poNumber: $poNumber\n                        nonNegotiableTerms: $nonNegotiableTerms\n                        localizationExtension: $localizationExtension\n                        scriptFingerprint: $scriptFingerprint\n                        transformerFingerprintV2: $transformerFingerprintV2\n                        optionalDuties: $optionalDuties\n                        attribution: $attribution\n                        captcha: $captcha\n                        saleAttributions: $saleAttributions\n                    }\n                    checkpointData: $checkpointData\n                    queueToken: $queueToken\n                    changesetTokens: $changesetTokens\n                }\n            ) {\n                __typename\n                result {\n                    ... on NegotiationResultAvailable {\n                        queueToken\n                        buyerProposal {\n                            ...BuyerProposalDetails\n                            __typename\n                        }\n                        sellerProposal {\n                            ...ProposalDetails\n                            __typename\n                        }\n                        __typename\n                    }\n                    ... on CheckpointDenied {\n                        redirectUrl\n                        __typename\n                    }\n                    ... on Throttled {\n                        pollAfter\n                        queueToken\n                        pollUrl\n                        __typename\n                    }\n                    ... on SubmittedForCompletion {\n                        receipt {\n                            ...ReceiptDetails\n                            __typename\n                        }\n                        __typename\n                    }\n                    ... on NegotiationResultFailed {\n                        __typename\n                    }\n                    __typename\n                }\n                errors {\n                    code\n                    localizedMessage\n                    nonLocalizedMessage\n                    localizedMessageHtml\n                    ... on RemoveTermViolation {\n                        target\n                        __typename\n                    }\n                    ... on AcceptNewTermViolation {\n                        target\n                        __typename\n                    }\n                    ... on ConfirmChangeViolation {\n                        from\n                        to\n                        __typename\n                    }\n                    ... on UnprocessableTermViolation {\n                        target\n                        __typename\n                    }\n                    ... on UnresolvableTermViolation {\n                        target\n                        __typename\n                    }\n                    ... on GenericError {\n                        __typename\n                    }\n                    __typename\n                }\n            }\n            __typename\n        }\n    }\n    fragment BuyerProposalDetails on Proposal {\n        merchandiseDiscount {\n            ...ProposalDiscountFragment\n            __typename\n        }\n        deliveryDiscount {\n            ...ProposalDiscountFragment\n            __typename\n        }\n        delivery {\n            ...ProposalDeliveryFragment\n            __typename\n        }\n        merchandise {\n            ... on FilledMerchandiseTerms {\n                taxesIncluded\n                merchandiseLines {\n                    stableId\n                    merchandise {\n                        ...SourceProvidedMerchandise\n                        ...ProductVariantMerchandiseDetails\n                        ...ContextualizedProductVariantMerchandiseDetails\n                        ... on MissingProductVariantMerchandise {\n                            id\n                            digest\n                            variantId\n                            __typename\n                        }\n                        __typename\n                    }\n                    quantity {\n                        ... on ProposalMerchandiseQuantityByItem {\n                            items {\n                                ... on IntValueConstraint {\n                                    value\n                                    __typename\n                                }\n                                __typename\n                            }\n                            __typename\n                        }\n                        __typename\n                    }\n                    totalAmount {\n                        ... on MoneyValueConstraint {\n                            value {\n                                amount\n                                currencyCode\n                                __typename\n                            }\n                            __typename\n                        }\n                        __typename\n                    }\n                    recurringTotal {\n                        title\n                        interval\n                        intervalCount\n                        recurringPrice {\n                            amount\n                            currencyCode\n                            __typename\n                        }\n                        fixedPrice {\n                            amount\n                            currencyCode\n                            __typename\n                        }\n                        fixedPriceCount\n                        __typename\n                    }\n                    lineAllocations {\n                        ...LineAllocationDetails\n                        __typename\n                    }\n                    lineComponentsSource\n                    lineComponents {\n                        ...MerchandiseBundleLineComponent\n                        __typename\n                    }\n                    __typename\n                }\n                __typename\n            }\n            __typename\n        }\n        runningTotal {\n            ... on MoneyValueConstraint {\n                value {\n                    amount\n                    currencyCode\n                    __typename\n                }\n                __typename\n            }\n            __typename\n        }\n        total {\n            ... on MoneyValueConstraint {\n                value {\n                    amount\n                    currencyCode\n                    __typename\n                }\n                __typename\n            }\n            __typename\n        }\n        checkoutTotalBeforeTaxesAndShipping {\n            ... on MoneyValueConstraint {\n                value {\n                    amount\n                    currencyCode\n                    __typename\n                }\n                __typename\n            }\n            __typename\n        }\n        checkoutTotalTaxes {\n            ... on MoneyValueConstraint {\n                value {\n                    amount\n                    currencyCode\n                    __typename\n                }\n                __typename\n            }\n            __typename\n        }\n        checkoutTotal {\n            ... on MoneyValueConstraint {\n                value {\n                    amount\n                    currencyCode\n                    __typename\n                }\n                __typename\n            }\n            __typename\n        }\n        deferredTotal {\n            amount {\n                ... on MoneyValueConstraint {\n                    value {\n                        amount\n                        currencyCode\n                        __typename\n                    }\n                    __typename\n                }\n                __typename\n            }\n            subtotalAmount {\n                ... on MoneyValueConstraint {\n                    value {\n                        amount\n                        currencyCode\n                        __typename\n                    }\n                    __typename\n                }\n                __typename\n            }\n            taxes {\n                ... on MoneyValueConstraint {\n                    value {\n                        amount\n                        currencyCode\n                        __typename\n                    }\n                    __typename\n                }\n                __typename\n            }\n            dueAt\n            __typename\n        }\n        hasOnlyDeferredShipping\n        subtotalBeforeTaxesAndShipping {\n            ... on MoneyValueConstraint {\n                value {\n                    amount\n                    currencyCode\n                    __typename\n                }\n                __typename\n            }\n            __typename\n        }\n        attribution {\n            attributions {\n                ... on AttributionItem {\n                    ... on RetailAttributions {\n                        deviceId\n                        locationId\n                        userId\n                        __typename\n                    }\n                    ... on DraftOrderAttributions {\n                        userIdentifier: userId\n                        sourceName\n                        locationIdentifier: locationId\n                        __typename\n                    }\n                    __typename\n                }\n                __typename\n            }\n            __typename\n        }\n        saleAttributions {\n            attributions {\n                ... on SaleAttribution {\n                    recipient {\n                        ... on StaffMember {\n                            id\n                            __typename\n                        }\n                        ... on Location {\n                            id\n                            __typename\n                        }\n                        ... on PointOfSaleDevice {\n                            id\n                            __typename\n                        }\n                        __typename\n                    }\n                    targetMerchandiseLines {\n                        ...FilledMerchandiseLineTargetCollectionFragment\n                        ... on AnyMerchandiseLineTargetCollection {\n                            any\n                            __typename\n                        }\n                        __typename\n                    }\n                    __typename\n                }\n                __typename\n            }\n            __typename\n        }\n        __typename\n    }\n    fragment ProposalDiscountFragment on DiscountTermsV2 {\n        __typename\n        ... on FilledDiscountTerms {\n            acceptUnexpectedDiscounts\n            lines {\n                ...DiscountLineDetailsFragment\n                __typename\n            }\n            __typename\n        }\n        ... on PendingTerms {\n            pollDelay\n            taskId\n            __typename\n        }\n        ... on UnavailableTerms {\n            __typename\n        }\n    }\n    fragment DiscountLineDetailsFragment on DiscountLine {\n        allocations {\n            ... on DiscountAllocatedAllocationSet {\n                __typename\n                allocations {\n                    amount {\n                        ... on MoneyValueConstraint {\n                            value {\n                                amount\n                                currencyCode\n                                __typename\n                            }\n                            __typename\n                        }\n                        __typename\n                    }\n                    target {\n                        index\n                        targetType\n                        stableId\n                        __typename\n                    }\n                    __typename\n                }\n            }\n            __typename\n        }\n        discount {\n            ...DiscountDetailsFragment\n            __typename\n        }\n        lineAmount {\n            ... on MoneyValueConstraint {\n                value {\n                    amount\n                    currencyCode\n                    __typename\n                }\n                __typename\n            }\n            __typename\n        }\n        __typename\n    }\n    fragment DiscountDetailsFragment on Discount {\n        ... on CustomDiscount {\n            title\n            presentationLevel\n            allocationMethod\n            targetSelection\n            targetType\n            signature\n            signatureUuid\n            type\n            value {\n                ... on PercentageValue {\n                    percentage\n                    __typename\n                }\n                ... on FixedAmountValue {\n                    appliesOnEachItem\n                    fixedAmount {\n                        ... on MoneyValueConstraint {\n                            value {\n                                amount\n                                currencyCode\n                                __typename\n                            }\n                            __typename\n                        }\n                        __typename\n                    }\n                    __typename\n                }\n                __typename\n            }\n            __typename\n        }\n        ... on CodeDiscount {\n            title\n            code\n            presentationLevel\n            allocationMethod\n            targetSelection\n            targetType\n            value {\n                ... on PercentageValue {\n                    percentage\n                    __typename\n                }\n                ... on FixedAmountValue {\n                    appliesOnEachItem\n                    fixedAmount {\n                        ... on MoneyValueConstraint {\n                            value {\n                                amount\n                                currencyCode\n                                __typename\n                            }\n                            __typename\n                        }\n                        __typename\n                    }\n                    __typename\n                }\n                __typename\n            }\n            __typename\n        }\n        ... on DiscountCodeTrigger {\n            code\n            __typename\n        }\n        ... on AutomaticDiscount {\n            presentationLevel\n            title\n            allocationMethod\n            targetSelection\n            targetType\n            value {\n                ... on PercentageValue {\n                    percentage\n                    __typename\n                }\n                ... on FixedAmountValue {\n                    appliesOnEachItem\n                    fixedAmount {\n                        ... on MoneyValueConstraint {\n                            value {\n                                amount\n                                currencyCode\n                                __typename\n                            }\n                            __typename\n                        }\n                        __typename\n                    }\n                    __typename\n                }\n                __typename\n            }\n            __typename\n        }\n        __typename\n    }\n    fragment ProposalDeliveryFragment on DeliveryTerms {\n        __typename\n        ... on FilledDeliveryTerms {\n            intermediateRates\n            progressiveRatesEstimatedTimeUntilCompletion\n            shippingRatesStatusToken\n            deliveryLines {\n                destinationAddress {\n                    ... on StreetAddress {\n                        name\n                        firstName\n                        lastName\n                        company\n                        address1\n                        address2\n                        city\n                        countryCode\n                        zoneCode\n                        postalCode\n                        coordinates {\n                            latitude\n                            longitude\n                            __typename\n                        }\n                        phone\n                        __typename\n                    }\n                    ... on Geolocation {\n                        country {\n                            code\n                            __typename\n                        }\n                        zone {\n                            code\n                            __typename\n                        }\n                        coordinates {\n                            latitude\n                            longitude\n                            __typename\n                        }\n                        postalCode\n                        __typename\n                    }\n                    ... on PartialStreetAddress {\n                        name\n                        firstName\n                        lastName\n                        company\n                        address1\n                        address2\n                        city\n                        countryCode\n                        zoneCode\n                        postalCode\n                        phone\n                        coordinates {\n                            latitude\n                            longitude\n                            __typename\n                        }\n                        __typename\n                    }\n                    __typename\n                }\n                targetMerchandise {\n                    ...FilledMerchandiseLineTargetCollectionFragment\n                    __typename\n                }\n                groupType\n                selectedDeliveryStrategy {\n                    ... on CompleteDeliveryStrategy {\n                        handle\n                        __typename\n                    }\n                    ... on DeliveryStrategyReference {\n                        handle\n                        __typename\n                    }\n                    __typename\n                }\n                availableDeliveryStrategies {\n                    ... on CompleteDeliveryStrategy {\n                        title\n                        handle\n                        custom\n                        description\n                        code\n                        acceptsInstructions\n                        phoneRequired\n                        methodType\n                        carrierName\n                        incoterms\n                        brandedPromise {\n                            logoUrl\n                            name\n                            __typename\n                        }\n                        deliveryStrategyBreakdown {\n                            amount {\n                                ... on MoneyValueConstraint {\n                                    value {\n                                        amount\n                                        currencyCode\n                                        __typename\n                                    }\n                                    __typename\n                                }\n                                __typename\n                            }\n                            discountRecurringCycleLimit\n                            excludeFromDeliveryOptionPrice\n                            targetMerchandise {\n                                ...FilledMerchandiseLineTargetCollectionFragment\n                                __typename\n                            }\n                            __typename\n                        }\n                        minDeliveryDateTime\n                        maxDeliveryDateTime\n                        deliveryPromisePresentmentTitle {\n                            short\n                            long\n                            __typename\n                        }\n                        displayCheckoutRedesign\n                        estimatedTimeInTransit {\n                            ... on IntIntervalConstraint {\n                                lowerBound\n                                upperBound\n                                __typename\n                            }\n                            ... on IntValueConstraint {\n                                value\n                                __typename\n                            }\n                            __typename\n                        }\n                        amount {\n                            ... on MoneyValueConstraint {\n                                value {\n                                    amount\n                                    currencyCode\n                                    __typename\n                                }\n                                __typename\n                            }\n                            __typename\n                        }\n                        amountAfterDiscounts {\n                            ... on MoneyValueConstraint {\n                                value {\n                                    amount\n                                    currencyCode\n                                    __typename\n                                }\n                                __typename\n                            }\n                            __typename\n                        }\n                        pickupLocation {\n                            ... on PickupInStoreLocation {\n                                address {\n                                    address1\n                                    address2\n                                    city\n                                    countryCode\n                                    phone\n                                    postalCode\n                                    zoneCode\n                                    __typename\n                                }\n                                instructions\n                                name\n                                __typename\n                            }\n                            ... on PickupPointLocation {\n                                address {\n                                    address1\n                                    address2\n                                    address3\n                                    city\n                                    countryCode\n                                    zoneCode\n                                    postalCode\n                                    coordinates {\n                                        latitude\n                                        longitude\n                                        __typename\n                                    }\n                                    __typename\n                                }\n                                businessHours {\n                                    day\n                                    openingTime\n                                    closingTime\n                                    __typename\n                                }\n                                carrierCode\n                                carrierName\n                                handle\n                                kind\n                                name\n                                carrierLogoUrl\n                                fromDeliveryOptionGenerator\n                                __typename\n                            }\n                            __typename\n                        }\n                        __typename\n                    }\n                    __typename\n                }\n                __typename\n            }\n            __typename\n        }\n        ... on PendingTerms {\n            pollDelay\n            taskId\n            __typename\n        }\n        ... on UnavailableTerms {\n            __typename\n        }\n    }\n    fragment FilledMerchandiseLineTargetCollectionFragment on FilledMerchandiseLineTargetCollection {\n        linesV2 {\n            ... on MerchandiseLine {\n                stableId\n                merchandise {\n                    ...MerchandiseFragment\n                    __typename\n                }\n                totalAmount {\n                    ... on MoneyValueConstraint {\n                        value {\n                            amount\n                            currencyCode\n                            __typename\n                        }\n                        __typename\n                    }\n                    __typename\n                }\n                __typename\n            }\n            ... on MerchandiseBundleLineComponent {\n                stableId\n                merchandise {\n                    ...MerchandiseFragment\n                    __typename\n                }\n                totalAmount {\n                    ... on MoneyValueConstraint {\n                        value {\n                            amount\n                            currencyCode\n                            __typename\n                        }\n                        __typename\n                    }\n                    __typename\n                }\n                __typename\n            }\n            __typename\n        }\n        __typename\n    }\n    fragment MerchandiseFragment on ProposalMerchandise {\n        ...SourceProvidedMerchandise\n        ... on ProductVariantMerchandise {\n            id\n            digest\n            variantId\n            title\n            subtitle\n            requiresShipping\n            properties {\n                ...MerchandiseProperties\n                __typename\n            }\n            __typename\n        }\n        ... on ContextualizedProductVariantMerchandise {\n            id\n            digest\n            variantId\n            title\n            subtitle\n            requiresShipping\n            sellingPlan {\n                id\n                digest\n                name\n                prepaid\n                deliveriesPerBillingCycle\n                subscriptionDetails {\n                    billingInterval\n                    billingIntervalCount\n                    billingMaxCycles\n                    deliveryInterval\n                    deliveryIntervalCount\n                    __typename\n                }\n                __typename\n            }\n            properties {\n                ...MerchandiseProperties\n                __typename\n            }\n            __typename\n        }\n        ... on MissingProductVariantMerchandise {\n            id\n            digest\n            variantId\n            __typename\n        }\n        __typename\n    }\n    fragment SourceProvidedMerchandise on Merchandise {\n        ... on SourceProvidedMerchandise {\n            __typename\n            product {\n                id\n                title\n                productType\n                vendor\n                __typename\n            }\n            productUrl\n            digest\n            variantId\n            optionalIdentifier\n            title\n            untranslatedTitle\n            subtitle\n            untranslatedSubtitle\n            taxable\n            giftCard\n            requiresShipping\n            price {\n                amount\n                currencyCode\n                __typename\n            }\n            deferredAmount {\n                amount\n                currencyCode\n                __typename\n            }\n            image {\n                altText\n                one: transformedSrc(maxWidth: 64, maxHeight: 64)\n                two: transformedSrc(maxWidth: 128, maxHeight: 128)\n                four: transformedSrc(maxWidth: 256, maxHeight: 256)\n                __typename\n            }\n            options {\n                name\n                value\n                __typename\n            }\n            properties {\n                ...MerchandiseProperties\n                __typename\n            }\n            taxCode\n            taxesIncluded\n            weight {\n                value\n                unit\n                __typename\n            }\n            sku\n        }\n        __typename\n    }\n    fragment MerchandiseProperties on MerchandiseProperty {\n        name\n        value {\n            ... on MerchandisePropertyValueString {\n                string: value\n                __typename\n            }\n            ... on MerchandisePropertyValueInt {\n                int: value\n                __typename\n            }\n            ... on MerchandisePropertyValueFloat {\n                float: value\n                __typename\n            }\n            ... on MerchandisePropertyValueBoolean {\n                boolean: value\n                __typename\n            }\n            ... on MerchandisePropertyValueJson {\n                json: value\n                __typename\n            }\n            __typename\n        }\n        visible\n        __typename\n    }\n    fragment ProductVariantMerchandiseDetails on ProductVariantMerchandise {\n        id\n        digest\n        variantId\n        title\n        untranslatedTitle\n        subtitle\n        untranslatedSubtitle\n        product {\n            id\n            vendor\n            productType\n            __typename\n        }\n        productUrl\n        image {\n            altText\n            one: transformedSrc(maxWidth: 64, maxHeight: 64)\n            two: transformedSrc(maxWidth: 128, maxHeight: 128)\n            four: transformedSrc(maxWidth: 256, maxHeight: 256)\n            __typename\n        }\n        properties {\n            ...MerchandiseProperties\n            __typename\n        }\n        requiresShipping\n        options {\n            name\n            value\n            __typename\n        }\n        sellingPlan {\n            id\n            subscriptionDetails {\n                billingInterval\n                __typename\n            }\n            __typename\n        }\n        giftCard\n        __typename\n    }\n    fragment ContextualizedProductVariantMerchandiseDetails on ContextualizedProductVariantMerchandise {\n        id\n        digest\n        variantId\n        title\n        untranslatedTitle\n        subtitle\n        untranslatedSubtitle\n        sku\n        price {\n            amount\n            currencyCode\n            __typename\n        }\n        product {\n            id\n            vendor\n            productType\n            __typename\n        }\n        productUrl\n        image {\n            altText\n            one: transformedSrc(maxWidth: 64, maxHeight: 64)\n            two: transformedSrc(maxWidth: 128, maxHeight: 128)\n            four: transformedSrc(maxWidth: 256, maxHeight: 256)\n            __typename\n        }\n        properties {\n            ...MerchandiseProperties\n            __typename\n        }\n        requiresShipping\n        options {\n            name\n            value\n            __typename\n        }\n        sellingPlan {\n            name\n            id\n            digest\n            deliveriesPerBillingCycle\n            prepaid\n            subscriptionDetails {\n                billingInterval\n                billingIntervalCount\n                billingMaxCycles\n                deliveryInterval\n                deliveryIntervalCount\n                __typename\n            }\n            __typename\n        }\n        giftCard\n        deferredAmount {\n            amount\n            currencyCode\n            __typename\n        }\n        __typename\n    }\n    fragment LineAllocationDetails on LineAllocation {\n        stableId\n        quantity\n        totalAmountBeforeReductions {\n            amount\n            currencyCode\n            __typename\n        }\n        totalAmountAfterDiscounts {\n            amount\n            currencyCode\n            __typename\n        }\n        totalAmountAfterLineDiscounts {\n            amount\n            currencyCode\n            __typename\n        }\n        checkoutPriceAfterDiscounts {\n            amount\n            currencyCode\n            __typename\n        }\n        checkoutPriceAfterLineDiscounts {\n            amount\n            currencyCode\n            __typename\n        }\n        checkoutPriceBeforeReductions {\n            amount\n            currencyCode\n            __typename\n        }\n        unitPrice {\n            price {\n                amount\n                currencyCode\n                __typename\n            }\n            measurement {\n                referenceUnit\n                referenceValue\n                __typename\n            }\n            __typename\n        }\n        allocations {\n            ... on LineComponentDiscountAllocation {\n                allocation {\n                    amount {\n                        ... on MoneyValueConstraint {\n                            value {\n                                amount\n                                currencyCode\n                                __typename\n                            }\n                            __typename\n                        }\n                        __typename\n                    }\n                    __typename\n                }\n                amount {\n                    amount\n                    currencyCode\n                    __typename\n                }\n                discount {\n                    ...DiscountDetailsFragment\n                    __typename\n                }\n                __typename\n            }\n            __typename\n        }\n        __typename\n    }\n    fragment MerchandiseBundleLineComponent on MerchandiseBundleLineComponent {\n        __typename\n        stableId\n        merchandise {\n            ...SourceProvidedMerchandise\n            ...ProductVariantMerchandiseDetails\n            ...ContextualizedProductVariantMerchandiseDetails\n            ... on MissingProductVariantMerchandise {\n                id\n                digest\n                variantId\n                __typename\n            }\n            __typename\n        }\n        quantity {\n            ... on ProposalMerchandiseQuantityByItem {\n                items {\n                    ... on IntValueConstraint {\n                        value\n                        __typename\n                    }\n                    __typename\n                }\n                __typename\n            }\n            __typename\n        }\n        totalAmount {\n            ... on MoneyValueConstraint {\n                value {\n                    amount\n                    currencyCode\n                    __typename\n                }\n                __typename\n            }\n            __typename\n        }\n        recurringTotal {\n            title\n            interval\n            intervalCount\n            recurringPrice {\n                amount\n                currencyCode\n                __typename\n            }\n            fixedPrice {\n                amount\n                currencyCode\n                __typename\n            }\n            fixedPriceCount\n            __typename\n        }\n        lineAllocations {\n            ...LineAllocationDetails\n            __typename\n        }\n    }\n    fragment ProposalDetails on Proposal {\n        merchandiseDiscount {\n            ...ProposalDiscountFragment\n            __typename\n        }\n        deliveryDiscount {\n            ...ProposalDiscountFragment\n            __typename\n        }\n        deliveryExpectations {\n            ...ProposalDeliveryExpectationFragment\n            __typename\n        }\n        availableRedeemables {\n            ... on PendingTerms {\n                taskId\n                pollDelay\n                __typename\n            }\n            ... on AvailableRedeemables {\n                availableRedeemables {\n                    paymentMethod {\n                        ...RedeemablePaymentMethodFragment\n                        __typename\n                    }\n                    balance {\n                        ... on MoneyValueConstraint {\n                            value {\n                                amount\n                                currencyCode\n                                __typename\n                            }\n                            __typename\n                        }\n                        __typename\n                    }\n                    __typename\n                }\n                __typename\n            }\n            __typename\n        }\n        delivery {\n            ... on FilledDeliveryTerms {\n                intermediateRates\n                progressiveRatesEstimatedTimeUntilCompletion\n                shippingRatesStatusToken\n                deliveryLines {\n                    id\n                    availableOn\n                    destinationAddress {\n                        ... on StreetAddress {\n                            name\n                            firstName\n                            lastName\n                            company\n                            address1\n                            address2\n                            city\n                            countryCode\n                            zoneCode\n                            postalCode\n                            coordinates {\n                                latitude\n                                longitude\n                                __typename\n                            }\n                            phone\n                            __typename\n                        }\n                        ... on Geolocation {\n                            country {\n                                code\n                                __typename\n                            }\n                            zone {\n                                code\n                                __typename\n                            }\n                            coordinates {\n                                latitude\n                                longitude\n                                __typename\n                            }\n                            postalCode\n                            __typename\n                        }\n                        ... on PartialStreetAddress {\n                            name\n                            firstName\n                            lastName\n                            company\n                            address1\n                            address2\n                            city\n                            countryCode\n                            zoneCode\n                            postalCode\n                            phone\n                            coordinates {\n                                latitude\n                                longitude\n                                __typename\n                            }\n                            __typename\n                        }\n                        __typename\n                    }\n                    targetMerchandise {\n                        ...FilledMerchandiseLineTargetCollectionFragment\n                        __typename\n                    }\n                    groupType\n                    selectedDeliveryStrategy {\n                        ... on CompleteDeliveryStrategy {\n                            handle\n                            __typename\n                        }\n                        __typename\n                    }\n                    availableDeliveryStrategies {\n                        ... on CompleteDeliveryStrategy {\n                            originLocation {\n                                id\n                                __typename\n                            }\n                            title\n                            handle\n                            custom\n                            description\n                            code\n                            acceptsInstructions\n                            phoneRequired\n                            methodType\n                            carrierName\n                            incoterms\n                            brandedPromise {\n                                logoUrl\n                                name\n                                __typename\n                            }\n                            deliveryStrategyBreakdown {\n                                amount {\n                                    ... on MoneyValueConstraint {\n                                        value {\n                                            amount\n                                            currencyCode\n                                            __typename\n                                        }\n                                        __typename\n                                    }\n                                    __typename\n                                }\n                                discountRecurringCycleLimit\n                                excludeFromDeliveryOptionPrice\n                                targetMerchandise {\n                                    ...FilledMerchandiseLineTargetCollectionFragment\n                                    __typename\n                                }\n                                __typename\n                            }\n                            minDeliveryDateTime\n                            maxDeliveryDateTime\n                            deliveryPromiseProviderApiClientId\n                            deliveryPromisePresentmentTitle {\n                                short\n                                long\n                                __typename\n                            }\n                            displayCheckoutRedesign\n                            estimatedTimeInTransit {\n                                ... on IntIntervalConstraint {\n                                    lowerBound\n                                    upperBound\n                                    __typename\n                                }\n                                ... on IntValueConstraint {\n                                    value\n                                    __typename\n                                }\n                                __typename\n                            }\n                            amount {\n                                ... on MoneyValueConstraint {\n                                    value {\n                                        amount\n                                        currencyCode\n                                        __typename\n                                    }\n                                    __typename\n                                }\n                                __typename\n                            }\n                            amountAfterDiscounts {\n                                ... on MoneyValueConstraint {\n                                    value {\n                                        amount\n                                        currencyCode\n                                        __typename\n                                    }\n                                    __typename\n                                }\n                                __typename\n                            }\n                            pickupLocation {\n                                ... on PickupInStoreLocation {\n                                    address {\n                                        address1\n                                        address2\n                                        city\n                                        countryCode\n                                        phone\n                                        postalCode\n                                        zoneCode\n                                        __typename\n                                    }\n                                    instructions\n                                    name\n                                    distanceFromBuyer {\n                                        unit\n                                        value\n                                        __typename\n                                    }\n                                    __typename\n                                }\n                                ... on PickupPointLocation {\n                                    address {\n                                        address1\n                                        address2\n                                        address3\n                                        city\n                                        countryCode\n                                        zoneCode\n                                        postalCode\n                                        coordinates {\n                                            latitude\n                                            longitude\n                                            __typename\n                                        }\n                                        __typename\n                                    }\n                                    businessHours {\n                                        day\n                                        openingTime\n                                        closingTime\n                                        __typename\n                                    }\n                                    carrierCode\n                                    carrierName\n                                    handle\n                                    kind\n                                    name\n                                    carrierLogoUrl\n                                    fromDeliveryOptionGenerator\n                                    __typename\n                                }\n                                __typename\n                            }\n                            __typename\n                        }\n                        __typename\n                    }\n                    __typename\n                }\n                simpleDeliveryLine {\n                    availableDeliveryStrategies {\n                        title\n                        amountAfterDiscounts {\n                            ... on MoneyValueConstraint {\n                                value {\n                                    amount\n                                    currencyCode\n                                    __typename\n                                }\n                                __typename\n                            }\n                            __typename\n                        }\n                        deliveryPromisePresentmentTitle {\n                            short\n                            long\n                            __typename\n                        }\n                        __typename\n                    }\n                    __typename\n                }\n                __typename\n            }\n            ... on PendingTerms {\n                pollDelay\n                taskId\n                __typename\n            }\n            ... on UnavailableTerms {\n                __typename\n            }\n            __typename\n        }\n        payment {\n            ... on FilledPaymentTerms {\n                availablePayments {\n                    paymentMethod {\n                        ... on AnyDirectPaymentMethod {\n                            __typename\n                            availablePaymentProviders {\n                                paymentMethodIdentifier\n                                name\n                                brands\n                                orderingIndex\n                                displayName\n                                availablePresentmentCurrencies\n                                paymentMethodUiExtension {\n                                    ...UiExtensionInstallationFragment\n                                    __typename\n                                }\n                                checkoutHostedFields\n                                alternative\n                                __typename\n                            }\n                        }\n                        ... on AnyOffsitePaymentMethod {\n                            __typename\n                            availableOffsiteProviders {\n                                __typename\n                                paymentMethodIdentifier\n                                name\n                                paymentBrands\n                                orderingIndex\n                                showRedirectionNotice\n                                availablePresentmentCurrencies\n                            }\n                        }\n                        ... on AnyCustomOnsitePaymentMethod {\n                            __typename\n                            availableCustomOnsiteProviders {\n                                __typename\n                                paymentMethodIdentifier\n                                name\n                                paymentBrands\n                                orderingIndex\n                                availablePresentmentCurrencies\n                                paymentMethodUiExtension {\n                                    ...UiExtensionInstallationFragment\n                                    __typename\n                                }\n                            }\n                        }\n                        ... on DirectPaymentMethod {\n                            __typename\n                            paymentMethodIdentifier\n                        }\n                        ... on GiftCardPaymentMethod {\n                            __typename\n                        }\n                        ... on AnyRedeemablePaymentMethod {\n                            __typename\n                            availableRedemptionConfigs {\n                                __typename\n                                ... on CustomRedemptionConfig {\n                                    paymentMethodIdentifier\n                                    paymentMethodUiExtension {\n                                        ...UiExtensionInstallationFragment\n                                        __typename\n                                    }\n                                    __typename\n                                }\n                            }\n                            orderingIndex\n                        }\n                        ... on WalletsPlatformConfiguration {\n                            name\n                            configurationParams\n                            __typename\n                        }\n                        ... on AnyWalletPaymentMethod {\n                            availableWalletPaymentConfigs {\n                                ... on PaypalWalletConfig {\n                                    __typename\n                                    name\n                                    clientId\n                                    merchantId\n                                    venmoEnabled\n                                    payflow\n                                    paymentIntent\n                                    paymentMethodIdentifier\n                                    orderingIndex\n                                }\n                                ... on ShopPayWalletConfig {\n                                    __typename\n                                    name\n                                    storefrontUrl\n                                    paymentMethodIdentifier\n                                    orderingIndex\n                                }\n                                ... on ShopifyInstallmentsWalletConfig {\n                                    __typename\n                                    name\n                                    availableLoanTypes\n                                    maxPrice {\n                                        amount\n                                        currencyCode\n                                        __typename\n                                    }\n                                    minPrice {\n                                        amount\n                                        currencyCode\n                                        __typename\n                                    }\n                                    supportedCountries\n                                    supportedCurrencies\n                                    giftCardsNotAllowed\n                                    subscriptionItemsNotAllowed\n                                    ineligibleTestModeCheckout\n                                    ineligibleLineItem\n                                    paymentMethodIdentifier\n                                    orderingIndex\n                                }\n                                ... on FacebookPayWalletConfig {\n                                    __typename\n                                    name\n                                    partnerId\n                                    partnerMerchantId\n                                    supportedContainers\n                                    acquirerCountryCode\n                                    mode\n                                    paymentMethodIdentifier\n                                    orderingIndex\n                                }\n                                ... on ApplePayWalletConfig {\n                                    __typename\n                                    name\n                                    supportedNetworks\n                                    walletAuthenticationToken\n                                    walletOrderTypeIdentifier\n                                    walletServiceUrl\n                                    paymentMethodIdentifier\n                                    orderingIndex\n                                }\n                                ... on GooglePayWalletConfig {\n                                    __typename\n                                    name\n                                    allowedAuthMethods\n                                    allowedCardNetworks\n                                    gateway\n                                    gatewayMerchantId\n                                    merchantId\n                                    authJwt\n                                    environment\n                                    paymentMethodIdentifier\n                                    orderingIndex\n                                }\n                                ... on AmazonPayClassicWalletConfig {\n                                    __typename\n                                    name\n                                    orderingIndex\n                                }\n                                __typename\n                            }\n                            __typename\n                        }\n                        ... on LocalPaymentMethodConfig {\n                            __typename\n                            paymentMethodIdentifier\n                            name\n                            displayName\n                            additionalParameters {\n                                ... on IdealBankSelectionParameterConfig {\n                                    __typename\n                                    label\n                                    options {\n                                        label\n                                        value\n                                        __typename\n                                    }\n                                }\n                                __typename\n                            }\n                            orderingIndex\n                        }\n                        ... on AnyPaymentOnDeliveryMethod {\n                            __typename\n                            additionalDetails\n                            paymentInstructions\n                            paymentMethodIdentifier\n                            orderingIndex\n                            displayName\n                            availablePresentmentCurrencies\n                        }\n                        ... on PaymentOnDeliveryMethod {\n                            __typename\n                            additionalDetails\n                            paymentInstructions\n                            paymentMethodIdentifier\n                        }\n                        ... on CustomPaymentMethod {\n                            id\n                            name\n                            additionalDetails\n                            paymentInstructions\n                            __typename\n                        }\n                        ... on ManualPaymentMethodConfig {\n                            id\n                            name\n                            additionalDetails\n                            paymentInstructions\n                            paymentMethodIdentifier\n                            orderingIndex\n                            availablePresentmentCurrencies\n                            __typename\n                        }\n                        ... on CustomPaymentMethodConfig {\n                            id\n                            name\n                            additionalDetails\n                            paymentInstructions\n                            paymentMethodIdentifier\n                            orderingIndex\n                            availablePresentmentCurrencies\n                            __typename\n                        }\n                        ... on DeferredPaymentMethod {\n                            orderingIndex\n                            displayName\n                            __typename\n                        }\n                        ... on NoopPaymentMethod {\n                            __typename\n                        }\n                        ... on GiftCardPaymentMethod {\n                            __typename\n                        }\n                        ... on CustomerCreditCardPaymentMethod {\n                            __typename\n                            expired\n                            expiryMonth\n                            expiryYear\n                            name\n                            orderingIndex\n                            ...CustomerCreditCardPaymentMethodFragment\n                        }\n                        ... on PaypalBillingAgreementPaymentMethod {\n                            __typename\n                            orderingIndex\n                            paypalAccountEmail\n                            ...PaypalBillingAgreementPaymentMethodFragment\n                        }\n                        __typename\n                    }\n                    __typename\n                }\n                paymentLines {\n                    ...PaymentLines\n                    __typename\n                }\n                billingAddress {\n                    ... on StreetAddress {\n                        firstName\n                        lastName\n                        company\n                        address1\n                        address2\n                        city\n                        countryCode\n                        zoneCode\n                        postalCode\n                        phone\n                        __typename\n                    }\n                    ... on InvalidBillingAddress {\n                        __typename\n                    }\n                    __typename\n                }\n                paymentFlexibilityPaymentTermsTemplate {\n                    id\n                    translatedName\n                    dueDate\n                    dueInDays\n                    type\n                    __typename\n                }\n                __typename\n            }\n            ... on PendingTerms {\n                pollDelay\n                __typename\n            }\n            ... on UnavailableTerms {\n                __typename\n            }\n            __typename\n        }\n        poNumber\n        merchandise {\n            ... on FilledMerchandiseTerms {\n                taxesIncluded\n                merchandiseLines {\n                    stableId\n                    merchandise {\n                        ...SourceProvidedMerchandise\n                        ...ProductVariantMerchandiseDetails\n                        ...ContextualizedProductVariantMerchandiseDetails\n                        ... on MissingProductVariantMerchandise {\n                            id\n                            digest\n                            variantId\n                            __typename\n                        }\n                        __typename\n                    }\n                    quantity {\n                        ... on ProposalMerchandiseQuantityByItem {\n                            items {\n                                ... on IntValueConstraint {\n                                    value\n                                    __typename\n                                }\n                                __typename\n                            }\n                            __typename\n                        }\n                        __typename\n                    }\n                    totalAmount {\n                        ... on MoneyValueConstraint {\n                            value {\n                                amount\n                                currencyCode\n                                __typename\n                            }\n                            __typename\n                        }\n                        __typename\n                    }\n                    recurringTotal {\n                        title\n                        interval\n                        intervalCount\n                        recurringPrice {\n                            amount\n                            currencyCode\n                            __typename\n                        }\n                        fixedPrice {\n                            amount\n                            currencyCode\n                            __typename\n                        }\n                        fixedPriceCount\n                        __typename\n                    }\n                    lineAllocations {\n                        ...LineAllocationDetails\n                        __typename\n                    }\n                    lineComponentsSource\n                    lineComponents {\n                        ...MerchandiseBundleLineComponent\n                        __typename\n                    }\n                    __typename\n                }\n                __typename\n            }\n            __typename\n        }\n        note {\n            customAttributes {\n                key\n                value\n                __typename\n            }\n            message\n            __typename\n        }\n        scriptFingerprint {\n            signature\n            signatureUuid\n            lineItemScriptChanges\n            paymentScriptChanges\n            shippingScriptChanges\n            __typename\n        }\n        transformerFingerprintV2\n        buyerIdentity {\n            ... on FilledBuyerIdentityTerms {\n                buyerIdentity {\n                    ... on GuestProfile {\n                        presentmentCurrency\n                        countryCode\n                        market {\n                            id\n                            handle\n                            __typename\n                        }\n                        __typename\n                    }\n                    ... on CustomerProfile {\n                        id\n                        presentmentCurrency\n                        fullName\n                        firstName\n                        lastName\n                        countryCode\n                        email\n                        imageUrl\n                        acceptsMarketing\n                        acceptsSmsMarketing\n                        acceptsEmailMarketing\n                        ordersCount\n                        phone\n                        billingAddresses {\n                            id\n                            default\n                            address {\n                                firstName\n                                lastName\n                                address1\n                                address2\n                                phone\n                                postalCode\n                                city\n                                company\n                                zoneCode\n                                countryCode\n                                label\n                                __typename\n                            }\n                            __typename\n                        }\n                        shippingAddresses {\n                            id\n                            default\n                            address {\n                                firstName\n                                lastName\n                                address1\n                                address2\n                                phone\n                                postalCode\n                                city\n                                company\n                                zoneCode\n                                countryCode\n                                label\n                                __typename\n                            }\n                            __typename\n                        }\n                        storeCreditAccounts {\n                            id\n                            balance {\n                                amount\n                                currencyCode\n                                __typename\n                            }\n                            __typename\n                        }\n                        __typename\n                    }\n                    ... on BusinessCustomerProfile {\n                        checkoutExperienceConfiguration {\n                            availablePaymentOptions\n                            editableShippingAddress\n                            __typename\n                        }\n                        id\n                        presentmentCurrency\n                        fullName\n                        firstName\n                        lastName\n                        acceptsMarketing\n                        acceptsSmsMarketing\n                        acceptsEmailMarketing\n                        company {\n                            id\n                            name\n                            externalId\n                            __typename\n                        }\n                        countryCode\n                        imageUrl\n                        email\n                        ordersCount\n                        phone\n                        selectedCompanyLocation {\n                            id\n                            name\n                            externalId\n                            __typename\n                        }\n                        locationCount\n                        billingAddress {\n                            firstName\n                            lastName\n                            address1\n                            address2\n                            phone\n                            postalCode\n                            city\n                            company\n                            zoneCode\n                            countryCode\n                            label\n                            __typename\n                        }\n                        shippingAddress {\n                            firstName\n                            lastName\n                            address1\n                            address2\n                            phone\n                            postalCode\n                            city\n                            company\n                            zoneCode\n                            countryCode\n                            label\n                            __typename\n                        }\n                        __typename\n                    }\n                    __typename\n                }\n                contactInfoV2 {\n                    ... on EmailFormContents {\n                        email\n                        __typename\n                    }\n                    ... on SMSFormContents {\n                        phoneNumber\n                        __typename\n                    }\n                    __typename\n                }\n                marketingConsent {\n                    ... on SMSMarketingConsent {\n                        value\n                        __typename\n                    }\n                    ... on EmailMarketingConsent {\n                        value\n                        __typename\n                    }\n                    __typename\n                }\n                shopPayOptInPhone\n                __typename\n            }\n            __typename\n        }\n        checkoutCompletionTarget\n        recurringTotals {\n            title\n            interval\n            intervalCount\n            recurringPrice {\n                amount\n                currencyCode\n                __typename\n            }\n            fixedPrice {\n                amount\n                currencyCode\n                __typename\n            }\n            fixedPriceCount\n            __typename\n        }\n        subtotalBeforeTaxesAndShipping {\n            ... on MoneyValueConstraint {\n                value {\n                    amount\n                    currencyCode\n                    __typename\n                }\n                __typename\n            }\n            __typename\n        }\n        totalSavings {\n            ... on MoneyValueConstraint {\n                value {\n                    amount\n                    currencyCode\n                    __typename\n                }\n                __typename\n            }\n            __typename\n        }\n        runningTotal {\n            ... on MoneyValueConstraint {\n                value {\n                    amount\n                    currencyCode\n                    __typename\n                }\n                __typename\n            }\n            __typename\n        }\n        total {\n            ... on MoneyValueConstraint {\n                value {\n                    amount\n                    currencyCode\n                    __typename\n                }\n                __typename\n            }\n            __typename\n        }\n        checkoutTotalBeforeTaxesAndShipping {\n            ... on MoneyValueConstraint {\n                value {\n                    amount\n                    currencyCode\n                    __typename\n                }\n                __typename\n            }\n            __typename\n        }\n        checkoutTotalTaxes {\n            ... on MoneyValueConstraint {\n                value {\n                    amount\n                    currencyCode\n                    __typename\n                }\n                __typename\n            }\n            __typename\n        }\n        checkoutTotal {\n            ... on MoneyValueConstraint {\n                value {\n                    amount\n                    currencyCode\n                    __typename\n                }\n                __typename\n            }\n            __typename\n        }\n        deferredTotal {\n            amount {\n                ... on MoneyValueConstraint {\n                    value {\n                        amount\n                        currencyCode\n                        __typename\n                    }\n                    __typename\n                }\n                __typename\n            }\n            subtotalAmount {\n                ... on MoneyValueConstraint {\n                    value {\n                        amount\n                        currencyCode\n                        __typename\n                    }\n                    __typename\n                }\n                __typename\n            }\n            taxes {\n                ... on MoneyValueConstraint {\n                    value {\n                        amount\n                        currencyCode\n                        __typename\n                    }\n                    __typename\n                }\n                __typename\n            }\n            dueAt\n            __typename\n        }\n        hasOnlyDeferredShipping\n        subtotalBeforeReductions {\n            ... on MoneyValueConstraint {\n                value {\n                    amount\n                    currencyCode\n                    __typename\n                }\n                __typename\n            }\n            __typename\n        }\n        duty {\n            ... on FilledDutyTerms {\n                totalDutyAmount {\n                    ... on MoneyValueConstraint {\n                        value {\n                            amount\n                            currencyCode\n                            __typename\n                        }\n                        __typename\n                    }\n                    __typename\n                }\n                totalTaxAndDutyAmount {\n                    ... on MoneyValueConstraint {\n                        value {\n                            amount\n                            currencyCode\n                            __typename\n                        }\n                        __typename\n                    }\n                    __typename\n                }\n                totalAdditionalFeesAmount {\n                    ... on MoneyValueConstraint {\n                        value {\n                            amount\n                            currencyCode\n                            __typename\n                        }\n                        __typename\n                    }\n                    __typename\n                }\n                __typename\n            }\n            ... on PendingTerms {\n                pollDelay\n                __typename\n            }\n            ... on UnavailableTerms {\n                __typename\n            }\n            __typename\n        }\n        tax {\n            ... on FilledTaxTerms {\n                totalTaxAmount {\n                    ... on MoneyValueConstraint {\n                        value {\n                            amount\n                            currencyCode\n                            __typename\n                        }\n                        __typename\n                    }\n                    __typename\n                }\n                totalTaxAndDutyAmount {\n                    ... on MoneyValueConstraint {\n                        value {\n                            amount\n                            currencyCode\n                            __typename\n                        }\n                        __typename\n                    }\n                    __typename\n                }\n                totalAmountIncludedInTarget {\n                    ... on MoneyValueConstraint {\n                        value {\n                            amount\n                            currencyCode\n                            __typename\n                        }\n                        __typename\n                    }\n                    __typename\n                }\n                exemptions {\n                    taxExemptionReason\n                    targets {\n                        ... on TargetAllLines {\n                            __typename\n                        }\n                        __typename\n                    }\n                    __typename\n                }\n                __typename\n            }\n            ... on PendingTerms {\n                pollDelay\n                __typename\n            }\n            ... on UnavailableTerms {\n                __typename\n            }\n            __typename\n        }\n        tip {\n            tipSuggestions {\n                ... on TipSuggestion {\n                    __typename\n                    percentage\n                    amount {\n                        ... on MoneyValueConstraint {\n                            value {\n                                amount\n                                currencyCode\n                                __typename\n                            }\n                            __typename\n                        }\n                        __typename\n                    }\n                }\n                __typename\n            }\n            terms {\n                ... on FilledTipTerms {\n                    tipLines {\n                        amount {\n                            ... on MoneyValueConstraint {\n                                value {\n                                    amount\n                                    currencyCode\n                                    __typename\n                                }\n                                __typename\n                            }\n                            __typename\n                        }\n                        __typename\n                    }\n                    __typename\n                }\n                __typename\n            }\n            __typename\n        }\n        localizationExtension {\n            ... on LocalizationExtension {\n                fields {\n                    ... on LocalizationExtensionField {\n                        key\n                        title\n                        value\n                        __typename\n                    }\n                    __typename\n                }\n                __typename\n            }\n            __typename\n        }\n        landedCostDetails {\n            incotermInformation {\n                incoterm\n                reason\n                __typename\n            }\n            __typename\n        }\n        nonNegotiableTerms {\n            signature\n            contents {\n                signature\n                targetTerms\n                targetLine {\n                    allLines\n                    index\n                    __typename\n                }\n                attributes\n                __typename\n            }\n            __typename\n        }\n        optionalDuties {\n            buyerRefusesDuties\n            refuseDutiesPermitted\n            __typename\n        }\n        attribution {\n            attributions {\n                ... on AttributionItem {\n                    ... on RetailAttributions {\n                        deviceId\n                        locationId\n                        userId\n                        __typename\n                    }\n                    ... on DraftOrderAttributions {\n                        userIdentifier: userId\n                        sourceName\n                        locationIdentifier: locationId\n                        __typename\n                    }\n                    __typename\n                }\n                __typename\n            }\n            __typename\n        }\n        saleAttributions {\n            attributions {\n                ... on SaleAttribution {\n                    recipient {\n                        ... on StaffMember {\n                            id\n                            __typename\n                        }\n                        ... on Location {\n                            id\n                            __typename\n                        }\n                        ... on PointOfSaleDevice {\n                            id\n                            __typename\n                        }\n                        __typename\n                    }\n                    targetMerchandiseLines {\n                        ...FilledMerchandiseLineTargetCollectionFragment\n                        ... on AnyMerchandiseLineTargetCollection {\n                            any\n                            __typename\n                        }\n                        __typename\n                    }\n                    __typename\n                }\n                __typename\n            }\n            __typename\n        }\n        managedByMarketsPro\n        captcha {\n            ... on Captcha {\n                provider\n                challenge\n                sitekey\n                token\n                __typename\n            }\n            ... on PendingTerms {\n                taskId\n                pollDelay\n                __typename\n            }\n            __typename\n        }\n        cartCheckoutValidation {\n            ... on PendingTerms {\n                taskId\n                pollDelay\n                __typename\n            }\n            __typename\n        }\n        alternativePaymentCurrency {\n            ... on AllocatedAlternativePaymentCurrencyTotal {\n                total {\n                    amount\n                    currencyCode\n                    __typename\n                }\n                paymentLineAllocations {\n                    amount {\n                        amount\n                        currencyCode\n                        __typename\n                    }\n                    stableId\n                    __typename\n                }\n                __typename\n            }\n            __typename\n        }\n        __typename\n    }\n    fragment ProposalDeliveryExpectationFragment on DeliveryExpectationTerms {\n        __typename\n        ... on FilledDeliveryExpectationTerms {\n            deliveryExpectations {\n                minDeliveryDateTime\n                maxDeliveryDateTime\n                deliveryStrategyHandle\n                brandedPromise {\n                    logoUrl\n                    name\n                    __typename\n                }\n                deliveryOptionHandle\n                deliveryExpectationPresentmentTitle {\n                    short\n                    long\n                    __typename\n                }\n                promiseProviderApiClientId\n                __typename\n            }\n            __typename\n        }\n        ... on PendingTerms {\n            pollDelay\n            taskId\n            __typename\n        }\n        ... on UnavailableTerms {\n            __typename\n        }\n    }\n    fragment RedeemablePaymentMethodFragment on RedeemablePaymentMethod {\n        redemptionSource\n        redemptionContent {\n            ... on ShopCashRedemptionContent {\n                billingAddress {\n                    ... on StreetAddress {\n                        firstName\n                        lastName\n                        company\n                        address1\n                        address2\n                        city\n                        countryCode\n                        zoneCode\n                        postalCode\n                        phone\n                        __typename\n                    }\n                    __typename\n                }\n                redemptionId\n                destinationAmount {\n                    amount\n                    currencyCode\n                    __typename\n                }\n                sourceAmount {\n                    amount\n                    currencyCode\n                    __typename\n                }\n                __typename\n            }\n            ... on StoreCreditRedemptionContent {\n                storeCreditAccountId\n                __typename\n            }\n            ... on CustomRedemptionContent {\n                redemptionAttributes {\n                    key\n                    value\n                    __typename\n                }\n                maskedIdentifier\n                paymentMethodIdentifier\n                __typename\n            }\n            __typename\n        }\n        __typename\n    }\n    fragment UiExtensionInstallationFragment on UiExtensionInstallation {\n        extension {\n            approvalScopes {\n                handle\n                __typename\n            }\n            capabilities {\n                apiAccess\n                networkAccess\n                blockProgress\n                collectBuyerConsent {\n                    smsMarketing\n                    __typename\n                }\n                __typename\n            }\n            appId\n            extensionLocale\n            extensionPoints\n            translations\n            scriptUrl\n            uuid\n            registrationUuid\n            version\n            apiVersion\n            __typename\n        }\n        __typename\n    }\n    fragment CustomerCreditCardPaymentMethodFragment on CustomerCreditCardPaymentMethod {\n        cvvSessionId\n        paymentMethodIdentifier\n        token\n        displayLastDigits\n        brand\n        defaultPaymentMethod\n        deletable\n        requiresCvvConfirmation\n        billingAddress {\n            ... on StreetAddress {\n                address1\n                address2\n                city\n                company\n                countryCode\n                firstName\n                lastName\n                phone\n                postalCode\n                zoneCode\n                __typename\n            }\n            __typename\n        }\n        __typename\n    }\n    fragment PaypalBillingAgreementPaymentMethodFragment on PaypalBillingAgreementPaymentMethod {\n        paymentMethodIdentifier\n        token\n        billingAddress {\n            ... on StreetAddress {\n                address1\n                address2\n                city\n                company\n                countryCode\n                firstName\n                lastName\n                phone\n                postalCode\n                zoneCode\n                __typename\n            }\n            __typename\n        }\n        __typename\n    }\n    fragment PaymentLines on PaymentLine {\n        stableId\n        specialInstructions\n        amount {\n            ... on MoneyValueConstraint {\n                value {\n                    amount\n                    currencyCode\n                    __typename\n                }\n                __typename\n            }\n            __typename\n        }\n        dueAt\n        paymentMethod {\n            ... on DirectPaymentMethod {\n                sessionId\n                paymentMethodIdentifier\n                creditCard {\n                    ... on CreditCard {\n                        brand\n                        lastDigits\n                        name\n                        __typename\n                    }\n                    __typename\n                }\n                paymentAttributes\n                __typename\n            }\n            ... on GiftCardPaymentMethod {\n                code\n                balance {\n                    amount\n                    currencyCode\n                    __typename\n                }\n                __typename\n            }\n            ... on RedeemablePaymentMethod {\n                ...RedeemablePaymentMethodFragment\n                __typename\n            }\n            ... on WalletsPlatformPaymentMethod {\n                name\n                walletParams\n                __typename\n            }\n            ... on WalletPaymentMethod {\n                name\n                walletContent {\n                    ... on ShopPayWalletContent {\n                        billingAddress {\n                            ... on StreetAddress {\n                                firstName\n                                lastName\n                                company\n                                address1\n                                address2\n                                city\n                                countryCode\n                                zoneCode\n                                postalCode\n                                phone\n                                __typename\n                            }\n                            ... on InvalidBillingAddress {\n                                __typename\n                            }\n                            __typename\n                        }\n                        sessionToken\n                        paymentMethodIdentifier\n                        __typename\n                    }\n                    ... on PaypalWalletContent {\n                        paypalBillingAddress: billingAddress {\n                            ... on StreetAddress {\n                                firstName\n                                lastName\n                                company\n                                address1\n                                address2\n                                city\n                                countryCode\n                                zoneCode\n                                postalCode\n                                phone\n                                __typename\n                            }\n                            ... on InvalidBillingAddress {\n                                __typename\n                            }\n                            __typename\n                        }\n                        email\n                        payerId\n                        token\n                        paymentMethodIdentifier\n                        acceptedSubscriptionTerms\n                        expiresAt\n                        __typename\n                    }\n                    ... on ApplePayWalletContent {\n                        data\n                        signature\n                        version\n                        lastDigits\n                        paymentMethodIdentifier\n                        header {\n                            applicationData\n                            ephemeralPublicKey\n                            publicKeyHash\n                            transactionId\n                            __typename\n                        }\n                        __typename\n                    }\n                    ... on GooglePayWalletContent {\n                        signature\n                        signedMessage\n                        protocolVersion\n                        paymentMethodIdentifier\n                        __typename\n                    }\n                    ... on FacebookPayWalletContent {\n                        billingAddress {\n                            ... on StreetAddress {\n                                firstName\n                                lastName\n                                company\n                                address1\n                                address2\n                                city\n                                countryCode\n                                zoneCode\n                                postalCode\n                                phone\n                                __typename\n                            }\n                            ... on InvalidBillingAddress {\n                                __typename\n                            }\n                            __typename\n                        }\n                        containerData\n                        containerId\n                        mode\n                        paymentMethodIdentifier\n                        __typename\n                    }\n                    ... on ShopifyInstallmentsWalletContent {\n                        autoPayEnabled\n                        billingAddress {\n                            ... on StreetAddress {\n                                firstName\n                                lastName\n                                company\n                                address1\n                                address2\n                                city\n                                countryCode\n                                zoneCode\n                                postalCode\n                                phone\n                                __typename\n                            }\n                            ... on InvalidBillingAddress {\n                                __typename\n                            }\n                            __typename\n                        }\n                        disclosureDetails {\n                            evidence\n                            id\n                            type\n                            __typename\n                        }\n                        installmentsToken\n                        sessionToken\n                        paymentMethodIdentifier\n                        __typename\n                    }\n                    __typename\n                }\n                __typename\n            }\n            ... on LocalPaymentMethod {\n                paymentMethodIdentifier\n                name\n                additionalParameters {\n                    ... on IdealPaymentMethodParameters {\n                        bank\n                        __typename\n                    }\n                    __typename\n                }\n                __typename\n            }\n            ... on PaymentOnDeliveryMethod {\n                additionalDetails\n                paymentInstructions\n                paymentMethodIdentifier\n                __typename\n            }\n            ... on OffsitePaymentMethod {\n                paymentMethodIdentifier\n                name\n                __typename\n            }\n            ... on CustomPaymentMethod {\n                id\n                name\n                additionalDetails\n                paymentInstructions\n                paymentMethodIdentifier\n                __typename\n            }\n            ... on CustomOnsitePaymentMethod {\n                paymentMethodIdentifier\n                name\n                paymentAttributes\n                __typename\n            }\n            ... on ManualPaymentMethod {\n                id\n                name\n                paymentMethodIdentifier\n                __typename\n            }\n            ... on DeferredPaymentMethod {\n                orderingIndex\n                displayName\n                __typename\n            }\n            ... on CustomerCreditCardPaymentMethod {\n                ...CustomerCreditCardPaymentMethodFragment\n                __typename\n            }\n            ... on PaypalBillingAgreementPaymentMethod {\n                ...PaypalBillingAgreementPaymentMethodFragment\n                __typename\n            }\n            ... on NoopPaymentMethod {\n                __typename\n            }\n            __typename\n        }\n        __typename\n    }\n    fragment ReceiptDetails on Receipt {\n        ... on ProcessedReceipt {\n            id\n            token\n            redirectUrl\n            analytics {\n                checkoutCompletedEventId\n                __typename\n            }\n            poNumber\n            orderIdentity {\n                buyerIdentifier\n                id\n                __typename\n            }\n            eligibleForMarketingOptIn\n            purchaseOrder {\n                ...ReceiptPurchaseOrder\n                __typename\n            }\n            orderCreationStatus {\n                __typename\n            }\n            paymentDetails {\n                creditCardBrand\n                paymentCardBrand\n                creditCardLastFourDigits\n                paymentAmount {\n                    amount\n                    currencyCode\n                    __typename\n                }\n                paymentGateway\n                __typename\n            }\n            shopAppLinksAndResources {\n                mobileUrl\n                qrCodeUrl\n                canTrackOrderUpdates\n                shopInstallmentsViewSchedules\n                shopInstallmentsMobileUrl\n                installmentsHighlightEligible\n                mobileUrlAttributionPayload\n                shopAppEligible\n                shopAppQrCodeKillswitch\n                shopPayOrder\n                buyerHasShopApp\n                buyerHasShopPay\n                orderUpdateOptions\n                __typename\n            }\n            postPurchasePageUrl\n            postPurchasePageRequested\n            postPurchaseVaultedPaymentMethodStatus\n            paymentFlexibilityPaymentTermsTemplate {\n                __typename\n                dueDate\n                dueInDays\n                id\n                translatedName\n                type\n            }\n            __typename\n        }\n        ... on ProcessingReceipt {\n            id\n            pollDelay\n            __typename\n        }\n        ... on ActionRequiredReceipt {\n            id\n            action {\n                ... on CompletePaymentChallenge {\n                    offsiteRedirect\n                    url\n                    __typename\n                }\n                __typename\n            }\n            timeout {\n                millisecondsRemaining\n                __typename\n            }\n            __typename\n        }\n        ... on FailedReceipt {\n            id\n            processingError {\n                ... on InventoryClaimFailure {\n                    __typename\n                }\n                ... on InventoryReservationFailure {\n                    __typename\n                }\n                ... on OrderCreationFailure {\n                    paymentsHaveBeenReverted\n                    __typename\n                }\n                ... on OrderCreationSchedulingFailure {\n                    __typename\n                }\n                ... on PaymentFailed {\n                    code\n                    messageUntranslated\n                    hasOffsitePaymentMethod\n                    __typename\n                }\n                ... on DiscountUsageLimitExceededFailure {\n                    __typename\n                }\n                ... on CustomerPersistenceFailure {\n                    __typename\n                }\n                __typename\n            }\n            __typename\n        }\n        __typename\n    }\n    fragment ReceiptPurchaseOrder on PurchaseOrder {\n        __typename\n        sessionToken\n        totalAmountToPay {\n            amount\n            currencyCode\n            __typename\n        }\n        checkoutCompletionTarget\n        delivery {\n            ... on PurchaseOrderDeliveryTerms {\n                deliveryLines {\n                    __typename\n                    deliveryStrategy {\n                        handle\n                        title\n                        description\n                        methodType\n                        pickupLocation {\n                            ... on PickupInStoreLocation {\n                                name\n                                address {\n                                    address1\n                                    address2\n                                    city\n                                    countryCode\n                                    zoneCode\n                                    postalCode\n                                    phone\n                                    coordinates {\n                                        latitude\n                                        longitude\n                                        __typename\n                                    }\n                                    __typename\n                                }\n                                instructions\n                                __typename\n                            }\n                            __typename\n                        }\n                        __typename\n                    }\n                    lineAmount {\n                        amount\n                        currencyCode\n                        __typename\n                    }\n                    lineAmountAfterDiscounts {\n                        amount\n                        currencyCode\n                        __typename\n                    }\n                    destinationAddress {\n                        ... on StreetAddress {\n                            name\n                            firstName\n                            lastName\n                            company\n                            address1\n                            address2\n                            city\n                            countryCode\n                            zoneCode\n                            postalCode\n                            coordinates {\n                                latitude\n                                longitude\n                                __typename\n                            }\n                            phone\n                            __typename\n                        }\n                        __typename\n                    }\n                    groupType\n                    targetMerchandise {\n                        ... on PurchaseOrderMerchandiseLine {\n                            stableId\n                            merchandise {\n                                ... on ProductVariantSnapshot {\n                                    ...ProductVariantSnapshotMerchandiseDetails\n                                    __typename\n                                }\n                                __typename\n                            }\n                            __typename\n                        }\n                        ... on PurchaseOrderBundleLineComponent {\n                            stableId\n                            merchandise {\n                                ... on ProductVariantSnapshot {\n                                    ...ProductVariantSnapshotMerchandiseDetails\n                                    __typename\n                                }\n                                __typename\n                            }\n                            __typename\n                        }\n                        __typename\n                    }\n                }\n                __typename\n            }\n            __typename\n        }\n        payment {\n            ... on PurchaseOrderPaymentTerms {\n                billingAddress {\n                    __typename\n                    ... on StreetAddress {\n                        name\n                        firstName\n                        lastName\n                        company\n                        address1\n                        address2\n                        city\n                        countryCode\n                        zoneCode\n                        postalCode\n                        coordinates {\n                            latitude\n                            longitude\n                            __typename\n                        }\n                        phone\n                        __typename\n                    }\n                    ... on InvalidBillingAddress {\n                        __typename\n                    }\n                }\n                paymentLines {\n                    amount {\n                        amount\n                        currencyCode\n                        __typename\n                    }\n                    postPaymentMessage\n                    dueAt\n                    paymentMethod {\n                        ... on DirectPaymentMethod {\n                            sessionId\n                            paymentMethodIdentifier\n                            vaultingAgreement\n                            creditCard {\n                                brand\n                                lastDigits\n                                __typename\n                            }\n                            billingAddress {\n                                ... on StreetAddress {\n                                    name\n                                    firstName\n                                    lastName\n                                    company\n                                    address1\n                                    address2\n                                    city\n                                    countryCode\n                                    zoneCode\n                                    postalCode\n                                    coordinates {\n                                        latitude\n                                        longitude\n                                        __typename\n                                    }\n                                    phone\n                                    __typename\n                                }\n                                ... on InvalidBillingAddress {\n                                    __typename\n                                }\n                                __typename\n                            }\n                            __typename\n                        }\n                        ... on CustomerCreditCardPaymentMethod {\n                            brand\n                            displayLastDigits\n                            token\n                            deletable\n                            defaultPaymentMethod\n                            requiresCvvConfirmation\n                            billingAddress {\n                                ... on StreetAddress {\n                                    address1\n                                    address2\n                                    city\n                                    company\n                                    countryCode\n                                    firstName\n                                    lastName\n                                    phone\n                                    postalCode\n                                    zoneCode\n                                    __typename\n                                }\n                                __typename\n                            }\n                            __typename\n                        }\n                        ... on PurchaseOrderGiftCardPaymentMethod {\n                            balance {\n                                amount\n                                currencyCode\n                                __typename\n                            }\n                            code\n                            __typename\n                        }\n                        ... on WalletPaymentMethod {\n                            name\n                            walletContent {\n                                ... on ShopPayWalletContent {\n                                    billingAddress {\n                                        ... on StreetAddress {\n                                            firstName\n                                            lastName\n                                            company\n                                            address1\n                                            address2\n                                            city\n                                            countryCode\n                                            zoneCode\n                                            postalCode\n                                            phone\n                                            __typename\n                                        }\n                                        ... on InvalidBillingAddress {\n                                            __typename\n                                        }\n                                        __typename\n                                    }\n                                    sessionToken\n                                    paymentMethodIdentifier\n                                    __typename\n                                }\n                                ... on PaypalWalletContent {\n                                    billingAddress {\n                                        ... on StreetAddress {\n                                            firstName\n                                            lastName\n                                            company\n                                            address1\n                                            address2\n                                            city\n                                            countryCode\n                                            zoneCode\n                                            postalCode\n                                            phone\n                                            __typename\n                                        }\n                                        ... on InvalidBillingAddress {\n                                            __typename\n                                        }\n                                        __typename\n                                    }\n                                    email\n                                    payerId\n                                    token\n                                    expiresAt\n                                    __typename\n                                }\n                                ... on ApplePayWalletContent {\n                                    billingAddress {\n                                        ... on StreetAddress {\n                                            firstName\n                                            lastName\n                                            company\n                                            address1\n                                            address2\n                                            city\n                                            countryCode\n                                            zoneCode\n                                            postalCode\n                                            phone\n                                            __typename\n                                        }\n                                        ... on InvalidBillingAddress {\n                                            __typename\n                                        }\n                                        __typename\n                                    }\n                                    data\n                                    signature\n                                    version\n                                    __typename\n                                }\n                                ... on GooglePayWalletContent {\n                                    billingAddress {\n                                        ... on StreetAddress {\n                                            firstName\n                                            lastName\n                                            company\n                                            address1\n                                            address2\n                                            city\n                                            countryCode\n                                            zoneCode\n                                            postalCode\n                                            phone\n                                            __typename\n                                        }\n                                        ... on InvalidBillingAddress {\n                                            __typename\n                                        }\n                                        __typename\n                                    }\n                                    signature\n                                    signedMessage\n                                    protocolVersion\n                                    __typename\n                                }\n                                ... on FacebookPayWalletContent {\n                                    billingAddress {\n                                        ... on StreetAddress {\n                                            firstName\n                                            lastName\n                                            company\n                                            address1\n                                            address2\n                                            city\n                                            countryCode\n                                            zoneCode\n                                            postalCode\n                                            phone\n                                            __typename\n                                        }\n                                        ... on InvalidBillingAddress {\n                                            __typename\n                                        }\n                                        __typename\n                                    }\n                                    containerData\n                                    containerId\n                                    mode\n                                    __typename\n                                }\n                                ... on ShopifyInstallmentsWalletContent {\n                                    autoPayEnabled\n                                    billingAddress {\n                                        ... on StreetAddress {\n                                            firstName\n                                            lastName\n                                            company\n                                            address1\n                                            address2\n                                            city\n                                            countryCode\n                                            zoneCode\n                                            postalCode\n                                            phone\n                                            __typename\n                                        }\n                                        ... on InvalidBillingAddress {\n                                            __typename\n                                        }\n                                        __typename\n                                    }\n                                    disclosureDetails {\n                                        evidence\n                                        id\n                                        type\n                                        __typename\n                                    }\n                                    installmentsToken\n                                    sessionToken\n                                    creditCard {\n                                        brand\n                                        lastDigits\n                                        __typename\n                                    }\n                                    __typename\n                                }\n                                __typename\n                            }\n                            __typename\n                        }\n                        ... on WalletsPlatformPaymentMethod {\n                            name\n                            walletParams\n                            __typename\n                        }\n                        ... on LocalPaymentMethod {\n                            paymentMethodIdentifier\n                            name\n                            displayName\n                            billingAddress {\n                                ... on StreetAddress {\n                                    name\n                                    firstName\n                                    lastName\n                                    company\n                                    address1\n                                    address2\n                                    city\n                                    countryCode\n                                    zoneCode\n                                    postalCode\n                                    coordinates {\n                                        latitude\n                                        longitude\n                                        __typename\n                                    }\n                                    phone\n                                    __typename\n                                }\n                                ... on InvalidBillingAddress {\n                                    __typename\n                                }\n                                __typename\n                            }\n                            additionalParameters {\n                                ... on IdealPaymentMethodParameters {\n                                    bank\n                                    __typename\n                                }\n                                __typename\n                            }\n                            __typename\n                        }\n                        ... on PaymentOnDeliveryMethod {\n                            additionalDetails\n                            paymentInstructions\n                            paymentMethodIdentifier\n                            billingAddress {\n                                ... on StreetAddress {\n                                    name\n                                    firstName\n                                    lastName\n                                    company\n                                    address1\n                                    address2\n                                    city\n                                    countryCode\n                                    zoneCode\n                                    postalCode\n                                    coordinates {\n                                        latitude\n                                        longitude\n                                        __typename\n                                    }\n                                    phone\n                                    __typename\n                                }\n                                ... on InvalidBillingAddress {\n                                    __typename\n                                }\n                                __typename\n                            }\n                            __typename\n                        }\n                        ... on OffsitePaymentMethod {\n                            paymentMethodIdentifier\n                            name\n                            billingAddress {\n                                ... on StreetAddress {\n                                    name\n                                    firstName\n                                    lastName\n                                    company\n                                    address1\n                                    address2\n                                    city\n                                    countryCode\n                                    zoneCode\n                                    postalCode\n                                    coordinates {\n                                        latitude\n                                        longitude\n                                        __typename\n                                    }\n                                    phone\n                                    __typename\n                                }\n                                ... on InvalidBillingAddress {\n                                    __typename\n                                }\n                                __typename\n                            }\n                            __typename\n                        }\n                        ... on ManualPaymentMethod {\n                            additionalDetails\n                            name\n                            paymentInstructions\n                            id\n                            paymentMethodIdentifier\n                            billingAddress {\n                                ... on StreetAddress {\n                                    name\n                                    firstName\n                                    lastName\n                                    company\n                                    address1\n                                    address2\n                                    city\n                                    countryCode\n                                    zoneCode\n                                    postalCode\n                                    coordinates {\n                                        latitude\n                                        longitude\n                                        __typename\n                                    }\n                                    phone\n                                    __typename\n                                }\n                                ... on InvalidBillingAddress {\n                                    __typename\n                                }\n                                __typename\n                            }\n                            __typename\n                        }\n                        ... on CustomPaymentMethod {\n                            additionalDetails\n                            name\n                            paymentInstructions\n                            id\n                            paymentMethodIdentifier\n                            billingAddress {\n                                ... on StreetAddress {\n                                    name\n                                    firstName\n                                    lastName\n                                    company\n                                    address1\n                                    address2\n                                    city\n                                    countryCode\n                                    zoneCode\n                                    postalCode\n                                    coordinates {\n                                        latitude\n                                        longitude\n                                        __typename\n                                    }\n                                    phone\n                                    __typename\n                                }\n                                ... on InvalidBillingAddress {\n                                    __typename\n                                }\n                                __typename\n                            }\n                            __typename\n                        }\n                        ... on DeferredPaymentMethod {\n                            orderingIndex\n                            displayName\n                            __typename\n                        }\n                        ... on PaypalBillingAgreementPaymentMethod {\n                            token\n                            billingAddress {\n                                ... on StreetAddress {\n                                    address1\n                                    address2\n                                    city\n                                    company\n                                    countryCode\n                                    firstName\n                                    lastName\n                                    phone\n                                    postalCode\n                                    zoneCode\n                                    __typename\n                                }\n                                __typename\n                            }\n                            __typename\n                        }\n                        ... on RedeemablePaymentMethod {\n                            redemptionSource\n                            redemptionContent {\n                                ... on CustomRedemptionContent {\n                                    redemptionAttributes {\n                                        key\n                                        value\n                                        __typename\n                                    }\n                                    maskedIdentifier\n                                    paymentMethodIdentifier\n                                    __typename\n                                }\n                                ... on StoreCreditRedemptionContent {\n                                    storeCreditAccountId\n                                    __typename\n                                }\n                                __typename\n                            }\n                            __typename\n                        }\n                        ... on CustomOnsitePaymentMethod {\n                            paymentMethodIdentifier\n                            name\n                            __typename\n                        }\n                        __typename\n                    }\n                    __typename\n                }\n                __typename\n            }\n            __typename\n        }\n        buyerIdentity {\n            ... on PurchaseOrderBuyerIdentityTerms {\n                contactMethod {\n                    ... on PurchaseOrderEmailContactMethod {\n                        email\n                        __typename\n                    }\n                    ... on PurchaseOrderSMSContactMethod {\n                        phoneNumber\n                        __typename\n                    }\n                    __typename\n                }\n                marketingConsent {\n                    ... on PurchaseOrderEmailContactMethod {\n                        email\n                        __typename\n                    }\n                    ... on PurchaseOrderSMSContactMethod {\n                        phoneNumber\n                        __typename\n                    }\n                    __typename\n                }\n                __typename\n            }\n            buyerIdentity {\n                __typename\n                ... on GuestProfile {\n                    presentmentCurrency\n                    countryCode\n                    market {\n                        id\n                        handle\n                        __typename\n                    }\n                    __typename\n                }\n                ... on DecodedCustomerProfile {\n                    id\n                    presentmentCurrency\n                    fullName\n                    firstName\n                    lastName\n                    countryCode\n                    email\n                    imageUrl\n                    acceptsMarketing\n                    acceptsSmsMarketing\n                    acceptsEmailMarketing\n                    ordersCount\n                    phone\n                    __typename\n                }\n                ... on BusinessCustomerProfile {\n                    checkoutExperienceConfiguration {\n                        availablePaymentOptions\n                        editableShippingAddress\n                        __typename\n                    }\n                    id\n                    presentmentCurrency\n                    fullName\n                    firstName\n                    lastName\n                    acceptsMarketing\n                    acceptsSmsMarketing\n                    acceptsEmailMarketing\n                    countryCode\n                    imageUrl\n                    email\n                    ordersCount\n                    phone\n                    selectedCompanyLocation {\n                        id\n                        name\n                        externalId\n                        __typename\n                    }\n                    locationCount\n                    company {\n                        id\n                        name\n                        externalId\n                        __typename\n                    }\n                    __typename\n                }\n            }\n            __typename\n        }\n        merchandise {\n            merchandiseLines {\n                stableId\n                merchandise {\n                    ...ProductVariantSnapshotMerchandiseDetails\n                    __typename\n                }\n                lineAllocations {\n                    checkoutPriceAfterDiscounts {\n                        amount\n                        currencyCode\n                        __typename\n                    }\n                    checkoutPriceAfterLineDiscounts {\n                        amount\n                        currencyCode\n                        __typename\n                    }\n                    checkoutPriceBeforeReductions {\n                        amount\n                        currencyCode\n                        __typename\n                    }\n                    quantity\n                    stableId\n                    totalAmountAfterDiscounts {\n                        amount\n                        currencyCode\n                        __typename\n                    }\n                    totalAmountAfterLineDiscounts {\n                        amount\n                        currencyCode\n                        __typename\n                    }\n                    totalAmountBeforeReductions {\n                        amount\n                        currencyCode\n                        __typename\n                    }\n                    discountAllocations {\n                        __typename\n                        amount {\n                            amount\n                            currencyCode\n                            __typename\n                        }\n                        discount {\n                            ...DiscountDetailsFragment\n                            __typename\n                        }\n                    }\n                    unitPrice {\n                        measurement {\n                            referenceUnit\n                            referenceValue\n                            __typename\n                        }\n                        price {\n                            amount\n                            currencyCode\n                            __typename\n                        }\n                        __typename\n                    }\n                    __typename\n                }\n                lineComponents {\n                    ...PurchaseOrderBundleLineComponent\n                    __typename\n                }\n                quantity {\n                    __typename\n                    ... on PurchaseOrderMerchandiseQuantityByItem {\n                        items\n                        __typename\n                    }\n                }\n                recurringTotal {\n                    fixedPrice {\n                        __typename\n                        amount\n                        currencyCode\n                    }\n                    fixedPriceCount\n                    interval\n                    intervalCount\n                    recurringPrice {\n                        __typename\n                        amount\n                        currencyCode\n                    }\n                    title\n                    __typename\n                }\n                lineAmount {\n                    __typename\n                    amount\n                    currencyCode\n                }\n                __typename\n            }\n            __typename\n        }\n        tax {\n            totalTaxAmountV2 {\n                __typename\n                amount\n                currencyCode\n            }\n            totalDutyAmount {\n                amount\n                currencyCode\n                __typename\n            }\n            totalTaxAndDutyAmount {\n                amount\n                currencyCode\n                __typename\n            }\n            totalAmountIncludedInTarget {\n                amount\n                currencyCode\n                __typename\n            }\n            __typename\n        }\n        discounts {\n            lines {\n                ...PurchaseOrderDiscountLineFragment\n                __typename\n            }\n            __typename\n        }\n        totalSavings {\n            amount\n            currencyCode\n            __typename\n        }\n        subtotalBeforeTaxesAndShipping {\n            amount\n            currencyCode\n            __typename\n        }\n        landedCostDetails {\n            incotermInformation {\n                incoterm\n                reason\n                __typename\n            }\n            __typename\n        }\n        optionalDuties {\n            buyerRefusesDuties\n            refuseDutiesPermitted\n            __typename\n        }\n        tip {\n            tipLines {\n                amount {\n                    amount\n                    currencyCode\n                    __typename\n                }\n                __typename\n            }\n            __typename\n        }\n        hasOnlyDeferredShipping\n        note {\n            customAttributes {\n                key\n                value\n                __typename\n            }\n            message\n            __typename\n        }\n        shopPayArtifact {\n            optIn {\n                vaultPhone\n                __typename\n            }\n            __typename\n        }\n        recurringTotals {\n            fixedPrice {\n                amount\n                currencyCode\n                __typename\n            }\n            fixedPriceCount\n            interval\n            intervalCount\n            recurringPrice {\n                amount\n                currencyCode\n                __typename\n            }\n            title\n            __typename\n        }\n        checkoutTotalBeforeTaxesAndShipping {\n            __typename\n            amount\n            currencyCode\n        }\n        checkoutTotal {\n            __typename\n            amount\n            currencyCode\n        }\n        checkoutTotalTaxes {\n            __typename\n            amount\n            currencyCode\n        }\n        subtotalBeforeReductions {\n            __typename\n            amount\n            currencyCode\n        }\n        deferredTotal {\n            amount {\n                __typename\n                ... on MoneyValueConstraint {\n                    value {\n                        amount\n                        currencyCode\n                        __typename\n                    }\n                    __typename\n                }\n            }\n            dueAt\n            subtotalAmount {\n                __typename\n                ... on MoneyValueConstraint {\n                    value {\n                        amount\n                        currencyCode\n                        __typename\n                    }\n                    __typename\n                }\n            }\n            taxes {\n                __typename\n                ... on MoneyValueConstraint {\n                    value {\n                        amount\n                        currencyCode\n                        __typename\n                    }\n                    __typename\n                }\n            }\n            __typename\n        }\n        metafields {\n            key\n            namespace\n            value\n            valueType: type\n            __typename\n        }\n    }\n    fragment ProductVariantSnapshotMerchandiseDetails on ProductVariantSnapshot {\n        variantId\n        options {\n            name\n            value\n            __typename\n        }\n        productTitle\n        title\n        productUrl\n        untranslatedTitle\n        untranslatedSubtitle\n        sellingPlan {\n            name\n            id\n            digest\n            deliveriesPerBillingCycle\n            prepaid\n            subscriptionDetails {\n                billingInterval\n                billingIntervalCount\n                billingMaxCycles\n                deliveryInterval\n                deliveryIntervalCount\n                __typename\n            }\n            __typename\n        }\n        deferredAmount {\n            amount\n            currencyCode\n            __typename\n        }\n        digest\n        giftCard\n        image {\n            altText\n            one: url(transform: { maxWidth: 64, maxHeight: 64 })\n            two: url(transform: { maxWidth: 128, maxHeight: 128 })\n            four: url(transform: { maxWidth: 256, maxHeight: 256 })\n            __typename\n        }\n        price {\n            amount\n            currencyCode\n            __typename\n        }\n        productId\n        productType\n        properties {\n            ...MerchandiseProperties\n            __typename\n        }\n        requiresShipping\n        sku\n        taxCode\n        taxable\n        vendor\n        weight {\n            unit\n            value\n            __typename\n        }\n        __typename\n    }\n    fragment PurchaseOrderBundleLineComponent on PurchaseOrderBundleLineComponent {\n        stableId\n        merchandise {\n            ...ProductVariantSnapshotMerchandiseDetails\n            __typename\n        }\n        lineAllocations {\n            checkoutPriceAfterDiscounts {\n                amount\n                currencyCode\n                __typename\n            }\n            checkoutPriceAfterLineDiscounts {\n                amount\n                currencyCode\n                __typename\n            }\n            checkoutPriceBeforeReductions {\n                amount\n                currencyCode\n                __typename\n            }\n            quantity\n            stableId\n            totalAmountAfterDiscounts {\n                amount\n                currencyCode\n                __typename\n            }\n            totalAmountAfterLineDiscounts {\n                amount\n                currencyCode\n                __typename\n            }\n            totalAmountBeforeReductions {\n                amount\n                currencyCode\n                __typename\n            }\n            discountAllocations {\n                __typename\n                amount {\n                    amount\n                    currencyCode\n                    __typename\n                }\n                discount {\n                    ...DiscountDetailsFragment\n                    __typename\n                }\n                index\n            }\n            unitPrice {\n                measurement {\n                    referenceUnit\n                    referenceValue\n                    __typename\n                }\n                price {\n                    amount\n                    currencyCode\n                    __typename\n                }\n                __typename\n            }\n            __typename\n        }\n        quantity\n        recurringTotal {\n            fixedPrice {\n                __typename\n                amount\n                currencyCode\n            }\n            fixedPriceCount\n            interval\n            intervalCount\n            recurringPrice {\n                __typename\n                amount\n                currencyCode\n            }\n            title\n            __typename\n        }\n        totalAmount {\n            __typename\n            amount\n            currencyCode\n        }\n        __typename\n    }\n    fragment PurchaseOrderDiscountLineFragment on PurchaseOrderDiscountLine {\n        discount {\n            ...DiscountDetailsFragment\n            __typename\n        }\n        lineAmount {\n            amount\n            currencyCode\n            __typename\n        }\n        deliveryAllocations {\n            amount {\n                amount\n                currencyCode\n                __typename\n            }\n            discount {\n                ...DiscountDetailsFragment\n                __typename\n            }\n            index\n            stableId\n            targetType\n            __typename\n        }\n        merchandiseAllocations {\n            amount {\n                amount\n                currencyCode\n                __typename\n            }\n            discount {\n                ...DiscountDetailsFragment\n                __typename\n            }\n            index\n            stableId\n            targetType\n            __typename\n        }\n        __typename\n    }\n"},59102:function(e,n,t){var r,o=this&&this.__extends||(r=function(e,n){return r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,n){e.__proto__=n}||function(e,n){for(var t in n)Object.prototype.hasOwnProperty.call(n,t)&&(e[t]=n[t])},r(e,n)},function(e,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function t(){this.constructor=e}r(e,n),e.prototype=null===n?Object.create(n):(t.prototype=n.prototype,new t)}),a=this&&this.__createBinding||(Object.create?function(e,n,t,r){void 0===r&&(r=t);var o=Object.getOwnPropertyDescriptor(n,t);o&&!("get"in o?!n.__esModule:o.writable||o.configurable)||(o={enumerable:!0,get:function(){return n[t]}}),Object.defineProperty(e,r,o)}:function(e,n,t,r){void 0===r&&(r=t),e[r]=n[t]}),i=this&&this.__setModuleDefault||(Object.create?function(e,n){Object.defineProperty(e,"default",{enumerable:!0,value:n})}:function(e,n){e.default=n}),s=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var n={};if(null!=e)for(var t in e)"default"!==t&&Object.prototype.hasOwnProperty.call(e,t)&&a(n,e,t);return i(n,e),n},c=this&&this.__awaiter||function(e,n,t,r){return new(t||(t=Promise))((function(o,a){function i(e){try{c(r.next(e))}catch(e){a(e)}}function s(e){try{c(r.throw(e))}catch(e){a(e)}}function c(e){var n;e.done?o(e.value):(n=e.value,n instanceof t?n:new t((function(e){e(n)}))).then(i,s)}c((r=r.apply(e,n||[])).next())}))},u=this&&this.__generator||function(e,n){var t,r,o,a,i={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return a={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function s(s){return function(c){return function(s){if(t)throw new TypeError("Generator is already executing.");for(;a&&(a=0,s[0]&&(i=0)),i;)try{if(t=1,r&&(o=2&s[0]?r.return:s[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,s[1])).done)return o;switch(r=0,o&&(s=[2&s[0],o.value]),s[0]){case 0:case 1:o=s;break;case 4:return i.label++,{value:s[1],done:!1};case 5:i.label++,r=s[1],s=[0];continue;case 7:s=i.ops.pop(),i.trys.pop();continue;default:if(!(o=i.trys,(o=o.length>0&&o[o.length-1])||6!==s[0]&&2!==s[0])){i=0;continue}if(3===s[0]&&(!o||s[1]>o[0]&&s[1]<o[3])){i.label=s[1];break}if(6===s[0]&&i.label<o[1]){i.label=o[1],o=s;break}if(o&&i.label<o[2]){i.label=o[2],i.ops.push(s);break}o[2]&&i.ops.pop(),i.trys.pop();continue}s=n.call(e,i)}catch(e){s=[6,e],r=0}finally{t=o=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,c])}}};Object.defineProperty(n,"__esModule",{value:!0}),n.WixDriver=void 0;var l=s(t(2543)),d=t(55015),p=t(33757),f=t(4008),m=function(e){function n(){var n=e.call(this,d.CouponCrm.wix,"application/json")||this;return n.graphqlApiEndpointUrl="https://".concat(new URL(window.location.href).hostname,"/_api/wixstores-graphql-server/graphql"),n.cartId=void 0,n}return o(n,e),n.prototype.checkShouldUseDriver=function(){return!!document.querySelector('script[src*="static.parastorage.com"]')},n.prototype.getCartId=function(){return c(this,void 0,void 0,(function(){var e,n;return u(this,(function(t){switch(t.label){case 0:return this.cartId?[2,this.cartId]:[4,fetch(this.graphqlApiEndpointUrl,{headers:this.buildRequestHeaders(),referrerPolicy:"strict-origin-when-cross-origin",method:"POST",mode:"cors",credentials:"include",body:JSON.stringify({query:f.wixCartQuery,variables:{locale:document.documentElement.lang||"en",withTax:!0,withShipping:!1}})})];case 1:return[4,t.sent().json()];case 2:if(e=t.sent(),"string"!=typeof(n=l.get(e,"data.cart.cartId")))throw new Error("Invalid cart ID");return this.cartId=n,[2,n]}}))}))},n.prototype.buildRequestHeaders=function(){var e=new Headers;return e.set("content-type","application/json; charset=utf-8"),e},n.prototype.checkIsCouponApplicationSuccessful=function(e){return c(this,void 0,void 0,(function(){var n;return u(this,(function(t){switch(t.label){case 0:return this.checkIsValidContentType(e),n=this,[4,e.json()];case 1:if(n.responseBody=t.sent(),!this.responseBody.data||!this.responseBody.data.cart||!this.responseBody.data.cart.setCoupon)throw new Error("Unexpected response structure");if(!this.responseBody.data.cart.setCoupon.hasOwnProperty("errors"))return[2,!0];if(!Array.isArray(this.responseBody.data.cart.setCoupon.errors))throw new Error("Unexpected response structure");return[2,0===this.responseBody.data.cart.setCoupon.errors.length]}}))}))},n.prototype.applyCoupon=function(e){return c(this,void 0,void 0,(function(){var n;return u(this,(function(t){switch(t.label){case 0:return[4,this.getCartId()];case 1:return n=t.sent(),[2,fetch(this.graphqlApiEndpointUrl,{headers:this.buildRequestHeaders(),referrer:window.location.href,referrerPolicy:"strict-origin-when-cross-origin",method:"POST",mode:"cors",credentials:"include",body:JSON.stringify({query:f.wixSetCouponMutation,variables:{params:{cartId:n,code:e}},operationName:"setCoupon",source:"WixStoresWebClient"})})]}}))}))},n.prototype.getAmountSaved=function(){throw new Error("Not implemented")},n}(p.BaseCouponCrmDriver);n.WixDriver=m},4008:(e,n)=>{Object.defineProperty(n,"__esModule",{value:!0}),n.wixSetCouponMutation=n.wixCartQuery=void 0,n.wixCartQuery="query getCart($locale: String!, $withTax: Boolean, $withShipping: Boolean) {\n    cart {\n        cartId\n        checkoutId\n        ecomId\n        purchaseFlowId\n        storeId\n        buyerNote\n        tems {\n           cartItemId\n           catalogAppId\n            product {\n                id\n                productType\n                urlPart\n                weight\n                name\n                price\n                comparePrice\n                customTextFields {\n                    title\n                    value\n                }\n            media(limit: 1) {\n                altText\n                mediaType\n                url\n                height\n                width\n            }\n            digitalProductFileItems {\n                fileType\n            }\n        }\n        optionsSelectionsValues {\n            id\n            title\n            value\n        }\n        freeText {\n            title\n            value\n        }\n        sku\n        quantity\n        inventoryQuantity\n        convertedPrices {\n            formattedComparePrice\n            formattedPrice\n            formattedTotalPrice\n            totalPrice\n            formattedPriceBeforeDiscount\n            price\n            depositAmount\n            formattedDepositAmount\n        }\n        formattedDepositAmount\n        depositAmount\n        formattedPriceBeforeDiscount\n        discountRules {\n            name\n        }\n        renderingConfig {\n            hidePrice\n            hideQuantity\n        }\n        paymentType\n        selectedMembership {\n            membershipId\n            appId\n            name {\n                original\n                translated\n            }      \n        }\n    }   \n    appliedCoupon {\n      discountValue\n      convertedDiscountValue\n      code\n      couponId\n      couponType\n      name\n    }\n    currencyFormat {\n      code\n    }\n    convertedCurrencyFormat {\n      code\n    }\n    additionalFees {\n      code\n      name\n      totalPrice\n      formattedTotalPrice\n      convertedFormattedTotalPrice\n    }\n    totals(withTax: $withTax, withShipping: $withShipping) {\n      subTotal\n      total\n      shipping\n      discount\n      itemsTotal\n      tax\n      payNow\n      payLater\n      additionalFeesTotal\n      formattedItemsTotal\n      formattedSubTotal\n      formattedShipping\n      formattedDiscount\n      formattedTax\n      formattedAdditionalFeesTotal\n      formattedPayNow\n      formattedPayLater\n      formattedTotal\n    }\n    convertedTotals(withTax: $withTax, withShipping: $withShipping) {\n      subTotal\n      total\n      shipping\n      discount\n      itemsTotal\n      tax\n      payNow\n      payLater\n      additionalFeesTotal\n      formattedItemsTotal\n      formattedSubTotal\n      formattedShipping\n      formattedDiscount\n      formattedTax\n      formattedAdditionalFeesTotal\n      formattedPayNow\n      formattedPayLater\n      formattedTotal\n    }\n    destination {\n      country\n      countryName(translateTo: $locale)\n      subdivision\n      subdivisionName(translateTo: $locale)\n      zipCode\n    }\n    selectedShippingOption {\n      id\n    }\n    shippingRuleInfo {\n      status\n      canShipToDestination\n      shippingRule {\n    id\n    options {\n      id\n      title\n      rate: convertedRate\n      formattedRate: convertedFormattedRate\n      deliveryTime\n      pickupInfo {\n        address {\n            countryName(translateTo: $locale)\n            subdivisionName(translateTo: $locale)\n            addressLine\n            city\n        }\n        pickupMethod\n      }\n      deliveryTimeSlot {\n        from\n        to\n      }\n    }\n      }\n    }\n    destinationCompleteness\n    minimumOrderAmount {\n      reached\n      diff\n      value\n      convertedDiff\n      convertedValue\n      formattedConvertedDiff\n      formattedConvertedValue\n    }\n    violations {\n      severity\n      target {\n    other {\n      name\n    }\n    lineItem {\n      name\n      id\n    }\n      }\n      description\n    }\n    }\n  }\n",n.wixSetCouponMutation="mutation setCoupon($params: SetCouponInput!) {\n  cart {\n    setCoupon(params: $params) {\n\n  errors {\n    code\n    commandName\n    message\n    field\n  }\n  cart {\n    cartId\n    checkoutId\n    ecomId\n    storeId\n    buyerNote\n    items {\ncartItemId\ncatalogAppId\nconvertedFormattedComparePrice\nconvertedFormattedPrice\nconvertedFormattedTotalPrice\nconvertedPrices {\n  comparePrice\n  formattedComparePrice\n  formattedPrice\n  formattedTotalPrice\n  price\n  totalPrice\n  formattedPriceBeforeDiscount\n}\nproduct {\n  comparePrice\n  convertedComparePrice\n  convertedPrice\n  customTextFields {\ntitle\nvalue\n  }\n  id\n  productType\n  urlPart\n  name\n  pageUrl\n  price\n  sku\n  weight\n  media(limit: 1) {\naltText\nmediaType\nurl\nheight\nwidth\n  }\n  digitalProductFileItems {\nfileType\n  }\n}\noptionsSelectionsValues {\n  id\n  title\n  value\n}\nconvertedTotalPrice\nfreeText {\n  title\n  value\n}\nsku\nquantity\ninventoryQuantity\nformattedComparePrice\nformattedPrice\nformattedTotalPrice\nformattedPriceBeforeDiscount\ndiscountRules {\n  name\n}\nsubscriptionPlan {\n  id\n  name\n  tagline\n  frequency\n  duration\n}\ntotalPrice\n    }\n    subscriptionPlan {\nid\nname\ntagline\nfrequency\nduration\n    }\n\n    appliedCoupon {\nconvertedDiscountValue\ncode\ncouponId\ncouponType\nname\ndiscountValue\n    }\n    couponCalculationError\n     additionalFees {\ncode\nname\ntotalPrice\nformattedTotalPrice\nconvertedFormattedTotalPrice\n    }\n    totals {\nsubTotal\nshipping\ntax\ntotal\ndiscount\nshippingWithoutTax\ngiftCardAmount\nformattedSubTotal\nformattedShipping\nformattedTax\noriginalTotal\nitemsTotal\nadditionalFeesTotal\nformattedItemsTotal\nformattedOriginalTotal\nformattedTotalBeforeTax\nformattedTotal\nformattedDiscount\nformattedShippingWithoutTax\nformattedGiftCardAmount\nformattedAdditionalFeesTotal\ntotalBeforeTax\n    }\n    destination {\ncountry\nsubdivision\nzipCode\n    }\n    selectedShippingOption {\nid\n    }\n    shippingAddress {\nemail\nfirstName\nlastName\nfullName\naddressLine\naddressLine1\naddressLine2\nstreet {\n  name\n  number\n}\ncity\ncompany\ncountry\nsubdivision\nzipCode\nphoneNumber\ntaxInfo {\n  taxId\n  taxType\n}\naddressesServiceId\n    }\n    billingAddress {\naddressLine\nemail\nfirstName\nlastName\nfullName\naddressLine1\naddressLine2\nstreet {\n  name\n  number\n}\ncity\ncompany\ncountry\nsubdivision\nzipCode\nphoneNumber\ntaxInfo {\n  taxId\n  taxType\n}\naddressesServiceId\n    }\n    taxCalculationError\n    taxRuleInfo {\nrule {\n  applyToShipping\n}\nstatus\n    }\n    checkoutCustomField {\nvalue\n    }\n    convertedCurrencyFormat {\ncode\n    }\n    convertedTotals {\ndiscount\nformattedDiscount\nformattedGiftCardAmount\nformattedItemsTotal\nformattedOriginalTotal\nformattedShipping\nformattedShippingWithoutTax\nformattedSubTotal\nformattedTax\nformattedTotal\nformattedTotalBeforeTax\ngiftCardAmount\nitemsTotal\noriginalTotal\nshipping\nshippingWithoutTax\nsubTotal\ntax\ntotal\ntotalBeforeTax\n    }\n    currencyFormat {\ncode\n    }\n    destinationCompleteness\n    giftCard {\nid\ncode\nerrorCode\n    }\n    shippingRuleInfo {\nshippingRule {\n  id\n  ruleType\n  options {\nconvertedRate\nconvertedFormattedRate\nid\ntitle\nrate\nformattedRate\ndeliveryTime\npickupInfo {\n  address {\n    country\n    subdivision\n    addressLine\n    city\n    zipCode\n  }\n  instructions\n}\n  }\n}\n    }\n  }\n\n    }\n  }\n}\n"},89342:function(e,n,t){var r,o=this&&this.__extends||(r=function(e,n){return r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,n){e.__proto__=n}||function(e,n){for(var t in n)Object.prototype.hasOwnProperty.call(n,t)&&(e[t]=n[t])},r(e,n)},function(e,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function t(){this.constructor=e}r(e,n),e.prototype=null===n?Object.create(n):(t.prototype=n.prototype,new t)}),a=this&&this.__awaiter||function(e,n,t,r){return new(t||(t=Promise))((function(o,a){function i(e){try{c(r.next(e))}catch(e){a(e)}}function s(e){try{c(r.throw(e))}catch(e){a(e)}}function c(e){var n;e.done?o(e.value):(n=e.value,n instanceof t?n:new t((function(e){e(n)}))).then(i,s)}c((r=r.apply(e,n||[])).next())}))},i=this&&this.__generator||function(e,n){var t,r,o,a,i={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return a={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function s(s){return function(c){return function(s){if(t)throw new TypeError("Generator is already executing.");for(;a&&(a=0,s[0]&&(i=0)),i;)try{if(t=1,r&&(o=2&s[0]?r.return:s[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,s[1])).done)return o;switch(r=0,o&&(s=[2&s[0],o.value]),s[0]){case 0:case 1:o=s;break;case 4:return i.label++,{value:s[1],done:!1};case 5:i.label++,r=s[1],s=[0];continue;case 7:s=i.ops.pop(),i.trys.pop();continue;default:if(!(o=i.trys,(o=o.length>0&&o[o.length-1])||6!==s[0]&&2!==s[0])){i=0;continue}if(3===s[0]&&(!o||s[1]>o[0]&&s[1]<o[3])){i.label=s[1];break}if(6===s[0]&&i.label<o[1]){i.label=o[1],o=s;break}if(o&&i.label<o[2]){i.label=o[2],i.ops.push(s);break}o[2]&&i.ops.pop(),i.trys.pop();continue}s=n.call(e,i)}catch(e){s=[6,e],r=0}finally{t=o=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,c])}}};Object.defineProperty(n,"__esModule",{value:!0}),n.WooCommerceDriver=void 0;var s=t(55015),c=function(e){function n(){return e.call(this,s.CouponCrm.wooCommerce,"text/html")||this}return o(n,e),n.prototype.checkShouldUseDriver=function(){return!!document.querySelector('script[id*="woocommerce"]')},n.prototype.checkIsCouponApplicationSuccessful=function(e){return a(this,void 0,void 0,(function(){var n,t;return i(this,(function(r){switch(r.label){case 0:return this.checkIsValidContentType(e),n=this,[4,e.text()];case 1:return n.responseBody=r.sent(),(t=document.createElement("html")).innerHTML=this.responseBody,[2,!t.querySelector('ul[class*="woocommerce-error"]')]}}))}))},n.prototype.applyCoupon=function(){return a(this,void 0,void 0,(function(){return i(this,(function(e){throw new Error("Not implemented")}))}))},n.prototype.getAmountSaved=function(){throw new Error("Not implemented")},n}(t(33757).BaseCouponCrmDriver);n.WooCommerceDriver=c},33682:function(e,n,t){var r,o=this&&this.__values||function(e){var n="function"==typeof Symbol&&Symbol.iterator,t=n&&e[n],r=0;if(t)return t.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&r>=e.length&&(e=void 0),{value:e&&e[r++],done:!e}}};throw new TypeError(n?"Object is not iterable.":"Symbol.iterator is not defined.")},a=this&&this.__read||function(e,n){var t="function"==typeof Symbol&&e[Symbol.iterator];if(!t)return e;var r,o,a=t.call(e),i=[];try{for(;(void 0===n||n-- >0)&&!(r=a.next()).done;)i.push(r.value)}catch(e){o={error:e}}finally{try{r&&!r.done&&(t=a.return)&&t.call(a)}finally{if(o)throw o.error}}return i},i=this&&this.__spreadArray||function(e,n,t){if(t||2===arguments.length)for(var r,o=0,a=n.length;o<a;o++)!r&&o in n||(r||(r=Array.prototype.slice.call(n,0,o)),r[o]=n[o]);return e.concat(r||Array.prototype.slice.call(n))};Object.defineProperty(n,"__esModule",{value:!0}),n.buildCssSelector=n.getElementFromSelector=void 0;var s=t(55015),c=t(50139);n.getElementFromSelector=function(e,n){void 0===n&&(n=document.documentElement);try{if(!e)return{message:"Selector is not defined",selector:"",type:s.CouponAutomationSelectorErrorType.Unknown};var t=n.querySelectorAll(e);if(t.length>1)return{message:"More than one result",selector:e,type:s.CouponAutomationSelectorErrorType.MoreThanOneMatch};if(0===t.length)return{message:"No result",selector:e,type:s.CouponAutomationSelectorErrorType.NoMatch};var r=t.item(0);return r.nodeType===n.ELEMENT_NODE?r:{message:"Not an element node",selector:e,type:s.CouponAutomationSelectorErrorType.NotANode}}catch(n){return n instanceof DOMException?{message:"DOM error: ".concat(n.message),selector:e||"",type:s.CouponAutomationSelectorErrorType.DOM}:{message:"Unknown error: ".concat(n),selector:e||"",type:s.CouponAutomationSelectorErrorType.Unknown}}},n.buildCssSelector=function(e,n){var t=function(e,n){var t,r;if(!n)return;var a=e.tagName;try{for(var i=o(e.getAttributeNames()),s=i.next();!s.done;s=i.next()){var c=s.value,u=e.getAttribute(c);if(l({attributeName:c,attributeValue:u,elementType:n})&&(a+="[".concat(c,'="').concat(u,'"]')),d(a))return a}}catch(e){t={error:e}}finally{try{s&&!s.done&&(r=i.return)&&r.call(i)}finally{if(t)throw t.error}}return}(e,n);return t||(t=function(e){var n=[],t=e;for(;t.parentElement;){if(t.id){n.unshift("#"+t.id);break}for(var r=1,o=t;o.previousElementSibling;)o=o.previousElementSibling,r++;n.unshift(t.tagName+":nth-child(".concat(r,")")),t=t.parentElement}return n.join(" > ")}(e)),t};var u=((r={})[s.CouponElementType.couponInputField]=["input","field"],r[s.CouponElementType.validationButton]=["apply","submit","add","valid","redeem","confirm"],r[s.CouponElementType.removalButton]=["cancel","delete","remove","annuler","supprimer","retirer"],r[s.CouponElementType.totalPrice]=["price","total","amount","value","checkout","cart","basket"],r[s.CouponElementType.showCouponFieldClickableElement]=["display","show","collapse","expand"],r);function l(e){var n=e.attributeName,t=e.attributeValue,r=e.elementType;if(!t||!n||t.includes("\n"))return!1;var o=r?i(i([],a(c.BASE_COUPON_ELEMENTS_KEYWORDS),!1),a(u[r]),!1):c.BASE_COUPON_ELEMENTS_KEYWORDS,s=(0,c.convertVariableNameToReadableText)(t),l=(0,c.convertVariableNameToReadableText)(n);return o.some((function(e){return s.includes(e)}))||o.some((function(e){return l.includes(e)}))}function d(e){return 1===document.querySelectorAll(e).length}},18045:function(e,n,t){var r=this&&this.__assign||function(){return r=Object.assign||function(e){for(var n,t=1,r=arguments.length;t<r;t++)for(var o in n=arguments[t])Object.prototype.hasOwnProperty.call(n,o)&&(e[o]=n[o]);return e},r.apply(this,arguments)},o=this&&this.__read||function(e,n){var t="function"==typeof Symbol&&e[Symbol.iterator];if(!t)return e;var r,o,a=t.call(e),i=[];try{for(;(void 0===n||n-- >0)&&!(r=a.next()).done;)i.push(r.value)}catch(e){o={error:e}}finally{try{r&&!r.done&&(t=a.return)&&t.call(a)}finally{if(o)throw o.error}}return i};Object.defineProperty(n,"__esModule",{value:!0}),n.checkShowCouponElementsButtonExists=n.checkDoCouponElementsExistAndUpdateSelectors=void 0;var a=t(55015),i=t(622),s=t(33682),c=t(91958),u=t(99959);n.checkDoCouponElementsExistAndUpdateSelectors=function(e){var n=e.selectors,t=n,r=o((0,u.getCouponInputField)(n),2),a=r[0],s=r[1];if(t.couponField=s,!a)return{doCouponElementsExist:!1,selectors:t};var l=o((0,c.getValidationButton)(n,a),2),d=l[0],p=l[1];if(t.validationButton=p,!d)return{doCouponElementsExist:!1,selectors:t};var f=(0,i.getPriceAmountAndCurrency)(e),m=f.priceAmount,y=f.priceSelector;return t.price=y,m?{doCouponElementsExist:!0,selectors:t}:{doCouponElementsExist:!1,selectors:t}},n.checkShowCouponElementsButtonExists=function(e){if(e.showCouponFieldClickableElement){var n=!(0,a.checkIsCouponSelectorError)((0,s.getElementFromSelector)(e.showCouponFieldClickableElement.selector));return e.showCouponFieldClickableElement=r(r({},e.showCouponFieldClickableElement),{detectionStatus:n?a.CouponSelectorElementDetectionStatus.found:a.CouponSelectorElementDetectionStatus.notFound}),n}return!1}},91958:function(e,n,t){var r=this&&this.__values||function(e){var n="function"==typeof Symbol&&Symbol.iterator,t=n&&e[n],r=0;if(t)return t.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&r>=e.length&&(e=void 0),{value:e&&e[r++],done:!e}}};throw new TypeError(n?"Object is not iterable.":"Symbol.iterator is not defined.")},o=this&&this.__read||function(e,n){var t="function"==typeof Symbol&&e[Symbol.iterator];if(!t)return e;var r,o,a=t.call(e),i=[];try{for(;(void 0===n||n-- >0)&&!(r=a.next()).done;)i.push(r.value)}catch(e){o={error:e}}finally{try{r&&!r.done&&(t=a.return)&&t.call(a)}finally{if(o)throw o.error}}return i},a=this&&this.__spreadArray||function(e,n,t){if(t||2===arguments.length)for(var r,o=0,a=n.length;o<a;o++)!r&&o in n||(r||(r=Array.prototype.slice.call(n,0,o)),r[o]=n[o]);return e.concat(r||Array.prototype.slice.call(n))};Object.defineProperty(n,"__esModule",{value:!0}),n.getRemovalButton=n.getValidationButton=void 0;var i,s=t(55015),c=t(50139),u=t(33682),l=t(99959);function d(e){return!!e&&!(0,s.checkIsCouponSelectorError)(e)&&"function"==typeof e.click}n.getValidationButton=function(e,n){var t=e.validationButton,o=(0,u.getElementFromSelector)(t?t.selector:void 0);if(d(o))return t&&(t.detectionStatus=s.CouponSelectorElementDetectionStatus.found),[o,t];var a=function(e){var n=f(e,i.apply,p);n.length>1&&(n=m(n,e,p));if(n.length>=1)return function(e){var n,t,o=e[0],a=0;try{for(var i=r(e),s=i.next();!s.done;s=i.next()){for(var c=s.value,u=c,l=0;u.parentElement;)u=u.parentElement,l++;l>a&&(o=c,a=l)}}catch(e){n={error:e}}finally{try{s&&!s.done&&(t=i.return)&&t.call(i)}finally{if(n)throw n.error}}return o}(n)}(n);return a?t={selector:(0,u.buildCssSelector)(a,s.CouponElementType.validationButton),selectorType:s.CouponSelectorType.automatic,detectionStatus:s.CouponSelectorElementDetectionStatus.found}:t&&(t.detectionStatus=s.CouponSelectorElementDetectionStatus.notFound),[a,t]},function(e){e[e.apply=0]="apply",e[e.remove=1]="remove"}(i||(i={}));var p=5;function f(e,n,t){for(var o,a,i=e,s=1;s<=t&&i.parentElement;s++)i=i.parentElement;var c=_(i,n);try{for(var u=r(c),l=u.next();!l.done;l=u.next()){var d=l.value;if(d.length>=1)return d}}catch(e){o={error:e}}finally{try{l&&!l.done&&(a=u.return)&&a.call(u)}finally{if(o)throw o.error}}return[]}function m(e,n,t){for(var r=n,o=1;o<=t;o++){if(!(r=r.parentElement))return[];var a=e.filter((function(e){return!!r&&r.contains(e)}));if(a.length>=1)return a}return[]}n.getRemovalButton=function(e){var n=e.selectors,t=n.removalButton;if(t){var o=(0,u.getElementFromSelector)(t.selector);if(d(o))return t.detectionStatus=s.CouponSelectorElementDetectionStatus.found,[o,t]}var a=function(e){var n=(0,u.getElementFromSelector)(e.couponField?e.couponField.selector:void 0);return(0,l.checkIsValidCouponInputFieldElement)(n)?function(e){var n=f(e,i.remove,y);(n=n.filter(v)).length>1&&(n=m(n,e,y));return n.length>0?n[0]:void 0}(n):function(){var e,n,t=_(document.body,i.remove);try{for(var o=r(t),a=o.next();!a.done;a=o.next()){var s=a.value,c=s.filter(v);if(1===s.length)return c[0]}}catch(n){e={error:n}}finally{try{a&&!a.done&&(n=o.return)&&n.call(o)}finally{if(e)throw e.error}}}()}(n);return a?[a,t={selector:(0,u.buildCssSelector)(a,s.CouponElementType.removalButton),selectorType:s.CouponSelectorType.automatic,detectionStatus:s.CouponSelectorElementDetectionStatus.found}]:(t&&(t.detectionStatus=s.CouponSelectorElementDetectionStatus.notFound),[void 0,t])};var y=7;var h=["article","product","basket","cart","item","produit","panier"];function v(e){var n,t,o=function(n){var t=e.getAttribute(n);if(!t)return"continue";var r=(0,c.convertVariableNameToReadableText)(n),o=(0,c.convertVariableNameToReadableText)(t);return l.COUPON_GENERAL_KEYWORDS.some((function(e){return r.includes(e)||o.includes(e)}))&&!h.some((function(e){return r.includes(e)||o.includes(e)}))?{value:!0}:void 0};try{for(var a=r(e.getAttributeNames()),i=a.next();!i.done;i=a.next()){var s=o(i.value);if("object"==typeof s)return s.value}}catch(e){n={error:e}}finally{try{i&&!i.done&&(t=a.return)&&t.call(a)}finally{if(n)throw n.error}}return!1}function _(e,n){return[a(a(a([],o(Array.from(e.getElementsByTagName("button"))),!1),o(Array.from(e.querySelectorAll('input[type="submit"]'))),!1),o(Array.from(e.querySelectorAll('input[type="button"]'))),!1).filter((function(e,t,r){return 1===r.length&&n===i.apply||C(e,n)})),Array.from(e.getElementsByTagName("a")).filter((function(e){var t=e.getAttribute("href");return(!t||t.length<=1)&&C(e,n)})),Array.from(e.getElementsByTagName("div")).filter((function(e){return C(e,n)})),Array.from(e.querySelectorAll('input[type="checkbox"]'))]}var g=["valider","ajouter","appliquer","confirmer","utiliser","ok","apply","submit","add"],b=["supprimer","annuler","retirer","remove","cancel","delete"];function C(e,n){if(!e.textContent)return!1;var t=n===i.apply?g:b,r=e.innerText||e.getAttribute("value")||"",o=(0,c.standardizeText)(r);return t.some((function(e){return o.includes(e)}))&&!h.some((function(e){return o.includes(e)}))}},99959:function(e,n,t){var r=this&&this.__values||function(e){var n="function"==typeof Symbol&&Symbol.iterator,t=n&&e[n],r=0;if(t)return t.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&r>=e.length&&(e=void 0),{value:e&&e[r++],done:!e}}};throw new TypeError(n?"Object is not iterable.":"Symbol.iterator is not defined.")};Object.defineProperty(n,"__esModule",{value:!0}),n.getCouponInputFieldHeuristic=n.checkIsValidCouponInputFieldElement=n.getCouponInputField=n.COUPON_GENERAL_KEYWORDS=void 0;var o=t(55015),a=t(50139),i=t(33682);function s(e){if(!e||(0,o.checkIsCouponSelectorError)(e)||"INPUT"!==e.tagName)return!1;var n=e;return!!n.type&&"text"===n.type}n.COUPON_GENERAL_KEYWORDS=["coupon","promo","discount","reduction","remise","rebate","voucher"],n.getCouponInputField=function(e){var n=e.couponField,t=(0,i.getElementFromSelector)(n?n.selector:void 0);if(s(t))return n&&(n.detectionStatus=o.CouponSelectorElementDetectionStatus.found),[t,n];var r=l(document.documentElement);return r?n={selector:(0,i.buildCssSelector)(r,o.CouponElementType.couponInputField),selectorType:o.CouponSelectorType.automatic,detectionStatus:o.CouponSelectorElementDetectionStatus.found}:n&&(n.detectionStatus=o.CouponSelectorElementDetectionStatus.notFound),[r,n]},n.checkIsValidCouponInputFieldElement=s;var c=["placeholder","aria-label"],u=["newsletter","mail","subscribe"];function l(e){var t=Array.from(e.getElementsByTagName("input")).filter((function(e){return"text"===e.type&&!e.getAttribute("readonly")&&!e.getAttribute("disabled")})),r=d(t,c,n.COUPON_GENERAL_KEYWORDS,a.standardizeText,u);return r||d(t,"all",n.COUPON_GENERAL_KEYWORDS,(function(e){return(0,a.standardizeText)((0,a.convertVariableNameToReadableText)(e))}),u)}function d(e,n,t,o,a){var i,s,c,u,l,d;void 0===a&&(a=[]);try{for(var p=r(e),f=p.next();!f.done;f=p.next()){var m=f.value,y="all"===n?m.getAttributeNames():"string"==typeof n?[n]:n,h=function(e){var n=m.getAttribute(e);if(a.some((function(e){return n&&n.includes(e)})))return{value:void 0}};try{for(var v=(c=void 0,r(y)),_=v.next();!_.done;_=v.next()){var g=h(_.value);if("object"==typeof g)return g.value}}catch(e){c={error:e}}finally{try{_&&!_.done&&(u=v.return)&&u.call(v)}finally{if(c)throw c.error}}var b=function(e){var n=m.getAttribute(e);if(!n)return"continue";var r=o(n);return t.some((function(e){return r.includes(e)}))?{value:m}:void 0};try{for(var C=(l=void 0,r(y)),S=C.next();!S.done;S=C.next()){var T=b(S.value);if("object"==typeof T)return T.value}}catch(e){l={error:e}}finally{try{S&&!S.done&&(d=C.return)&&d.call(C)}finally{if(l)throw l.error}}}}catch(e){i={error:e}}finally{try{f&&!f.done&&(s=p.return)&&s.call(p)}finally{if(i)throw i.error}}}n.getCouponInputFieldHeuristic=l},622:function(e,n,t){var r=this&&this.__values||function(e){var n="function"==typeof Symbol&&Symbol.iterator,t=n&&e[n],r=0;if(t)return t.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&r>=e.length&&(e=void 0),{value:e&&e[r++],done:!e}}};throw new TypeError(n?"Object is not iterable.":"Symbol.iterator is not defined.")};Object.defineProperty(n,"__esModule",{value:!0}),n.getPriceAmountAndCurrency=void 0;var o=t(55015),a=t(84092),i=t(50139),s=t(33682);n.getPriceAmountAndCurrency=function(e,n){void 0===n&&(n=document.documentElement);var t=e.selectors.price,c=(0,s.getElementFromSelector)(t?t.selector:void 0,n);if(!(0,o.checkIsCouponSelectorError)(c)){t&&(t.detectionStatus=o.CouponSelectorElementDetectionStatus.found);var f=(0,a.parsePriceAmountAndCurrency)(c.innerText),m=f.priceAmount,h=f.priceCurrency;if(m)return{priceAmount:m,priceCurrency:h,priceSelector:t}}if(!(c=function(e){var n,t,o=function(e){var n,t,o,a,s=[];try{for(var c=r(i.TEXT_HTML_TAGS),l=c.next();!l.done;l=c.next()){var d=l.value,p=Array.from(e.getElementsByTagName(d));try{for(var f=(o=void 0,r(p)),m=f.next();!m.done;m=f.next()){var y=m.value;y.textContent&&u((0,i.standardizeText)(y.textContent))&&s.push(y)}}catch(e){o={error:e}}finally{try{m&&!m.done&&(a=f.return)&&a.call(f)}finally{if(o)throw o.error}}}}catch(e){n={error:e}}finally{try{l&&!l.done&&(t=c.return)&&t.call(c)}finally{if(n)throw n.error}}return s}(e),a=[l,d,p,y,_,b];try{for(var s=r(a),c=s.next();!c.done;c=s.next()){var f=c.value;if(o.length<=1)break;o=f(o)}}catch(e){n={error:e}}finally{try{c&&!c.done&&(t=s.return)&&t.call(s)}finally{if(n)throw n.error}}if(o.length>=1)return o[0]}(n)))return t&&(t.detectionStatus=o.CouponSelectorElementDetectionStatus.notFound),{priceAmount:null,priceCurrency:null,priceSelector:t};t={selector:(0,s.buildCssSelector)(c,o.CouponElementType.totalPrice),selectorType:o.CouponSelectorType.automatic,detectionStatus:o.CouponSelectorElementDetectionStatus.found};var v=(0,a.parsePriceAmountAndCurrency)(c.innerText);return{priceAmount:v.priceAmount,priceCurrency:v.priceCurrency,priceSelector:t}};var c=[/^([\d,\s]+((,|\.)\d{1,2})?\s*(€|\$|£))$/,/^((€|\$|£)\s*[\d,\s]+((,|\.)\d{1,2})?)$/,/^([\d,\s]+(€|\$|£)\s*\d{1,2})$/];function u(e){return c.some((function(n){return n.test(e)}))}function l(e){for(var n={},t=0,r=0;r<e.length;r++)for(var o=0;o<e.length;o++)r!==o&&e[r].contains(e[o])&&e[r].innerText.trim()===e[o].innerText.trim()&&(n[r]=!0);for(var a in n)e.splice(Number(a)-t,1),t+=1;return e}function d(e){return e.filter((function(e){var n=(0,a.parsePriceAmountAndCurrency)(e.innerText);return n.priceAmount&&n.priceAmount>=0}))}function p(e){return e.filter(m)}var f=/(sous[-\s]?total)|(subtotal)/;function m(e){var n,t,o,a,s=window.getComputedStyle(e);if("del"===e.tagName||"line-through"===s.textDecorationLine||"none"===s.display||"visible"!==s.visibility)return!1;var c=e.parentElement;if(c)try{for(var u=r(i.TEXT_HTML_TAGS),l=u.next();!l.done;l=u.next()){var d=l.value,p=Array.from(c.getElementsByTagName(d));try{for(var m=(o=void 0,r(p)),y=m.next();!y.done;y=m.next()){var h=y.value;if(h.innerText&&f.test((0,i.standardizeText)(h.innerText)))return!1}}catch(e){o={error:e}}finally{try{y&&!y.done&&(a=m.return)&&a.call(m)}finally{if(o)throw o.error}}}}catch(e){n={error:e}}finally{try{l&&!l.done&&(t=u.return)&&t.call(u)}finally{if(n)throw n.error}}return!0}function y(e){var n,t,o,a=[];try{for(var i=r(e),s=i.next();!s.done;s=i.next()){var c=s.value,u=v(c);u&&(!o||u<o?(o=u,a=[c]):u===o&&a.push(c))}}catch(e){n={error:e}}finally{try{s&&!s.done&&(t=i.return)&&t.call(i)}finally{if(n)throw n.error}}return a.length?a:e}var h=["total","final"];function v(e,n){var t,o,a,s,c,u;void 0===n&&(n=7);for(var l=e,d=1;d<=n&&(l=l.parentElement);d++)try{for(var p=(t=void 0,r(i.TEXT_HTML_TAGS)),f=p.next();!f.done;f=p.next()){var m=f.value,y=Array.from(l.getElementsByTagName(m));try{for(var v=(a=void 0,r(y)),_=v.next();!_.done;_=v.next()){var g=_.value;try{for(var b=(c=void 0,r(h)),C=b.next();!C.done;C=b.next()){var S=C.value;if(g.innerText&&null!==g.offsetParent&&(0,i.standardizeText)(g.innerText).includes(S))return d}}catch(e){c={error:e}}finally{try{C&&!C.done&&(u=b.return)&&u.call(b)}finally{if(c)throw c.error}}}}catch(e){a={error:e}}finally{try{_&&!_.done&&(s=v.return)&&s.call(v)}finally{if(a)throw a.error}}}}catch(e){t={error:e}}finally{try{f&&!f.done&&(o=p.return)&&o.call(p)}finally{if(t)throw t.error}}}function _(e){var n,t,o,a,i=[],s=0,c=[];try{for(var u=r(e),l=u.next();!l.done;l=u.next()){var d=l.value,p=g(window.getComputedStyle(d).fontSize);p&&p>s?(s=p,i=[d]):p===s?i.push(d):void 0===p&&c.push(d)}}catch(e){n={error:e}}finally{try{l&&!l.done&&(t=u.return)&&t.call(u)}finally{if(n)throw n.error}}try{for(var f=r(c),m=f.next();!m.done;m=f.next()){var y=m.value;i.push(y)}}catch(e){o={error:e}}finally{try{m&&!m.done&&(a=f.return)&&a.call(f)}finally{if(o)throw o.error}}return i}function g(e){if(e){var n=(0,i.standardizeText)(e);if(!n.includes("em"))return Number(n.replace("px","").trim())}}function b(e){var n,t,o=[],a=0;try{for(var i=r(e),s=i.next();!s.done;s=i.next()){var c=s.value,u=Number(window.getComputedStyle(c).fontWeight);u>a?(a=u,o=[c]):u===a&&o.push(c)}}catch(e){n={error:e}}finally{try{s&&!s.done&&(t=i.return)&&t.call(i)}finally{if(n)throw n.error}}return o}},50479:function(e,n,t){var r=this&&this.__awaiter||function(e,n,t,r){return new(t||(t=Promise))((function(o,a){function i(e){try{c(r.next(e))}catch(e){a(e)}}function s(e){try{c(r.throw(e))}catch(e){a(e)}}function c(e){var n;e.done?o(e.value):(n=e.value,n instanceof t?n:new t((function(e){e(n)}))).then(i,s)}c((r=r.apply(e,n||[])).next())}))},o=this&&this.__generator||function(e,n){var t,r,o,a,i={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return a={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function s(s){return function(c){return function(s){if(t)throw new TypeError("Generator is already executing.");for(;a&&(a=0,s[0]&&(i=0)),i;)try{if(t=1,r&&(o=2&s[0]?r.return:s[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,s[1])).done)return o;switch(r=0,o&&(s=[2&s[0],o.value]),s[0]){case 0:case 1:o=s;break;case 4:return i.label++,{value:s[1],done:!1};case 5:i.label++,r=s[1],s=[0];continue;case 7:s=i.ops.pop(),i.trys.pop();continue;default:if(!(o=i.trys,(o=o.length>0&&o[o.length-1])||6!==s[0]&&2!==s[0])){i=0;continue}if(3===s[0]&&(!o||s[1]>o[0]&&s[1]<o[3])){i.label=s[1];break}if(6===s[0]&&i.label<o[1]){i.label=o[1],o=s;break}if(o&&i.label<o[2]){i.label=o[2],i.ops.push(s);break}o[2]&&i.ops.pop(),i.trys.pop();continue}s=n.call(e,i)}catch(e){s=[6,e],r=0}finally{t=o=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,c])}}},a=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(n,"__esModule",{value:!0}),n.logCouponApplicationFailedEvents=n.logCouponApplicationSucceededEvents=n.logCouponApplicationFinalEvents=n.logCancelledCouponApplicationEvents=n.logCouponTestedEvent=n.logStartedCouponApplicationEvents=n.logClosedCouponWidgetEvents=n.logCouponAutomationProposalWidgetDisplayedEvents=n.checkShouldLogElementsFoundEvent=n.logCouponElementsNotFoundEvent=n.logCouponElementsFoundEvent=n.logCouponElementsDetectionMechanismStartedOnCartWebpage=void 0;var i=a(t(2543)),s=t(55015),c=t(46239),u=t(59039),l=t(23907);function d(e,n,t){var r=e.offerId,o=e.bestCoupon,a=e.basePrice,i=e.bestPrice,s=e.selectors,u=e.priceCurrency,l=e.couponApplicationProcessId,d=e.shouldUseNetworkRequestsApplication;if(o){var p=void 0!==a&&void 0!==i?Number((a-i).toFixed(2)):0,f={offerId:r,couponApplied:o.code,couponAppliedMerchantCouponId:o.merchantCouponId,amountSaved:p,currency:u,selectors:s,wereAllCouponsTested:n,couponApplicationProcessId:l,numberOfCouponsTested:t,totalNumberOfCoupons:e.coupons.length,usingNetworkRequestsApplication:d};(0,c.sendMessageToBackgroundScript)({message:"logUserEvent",data:{event:{type:"couponApplicationSucceeded",payload:f}}}),(0,c.sendMessageToBackgroundScript)({message:"logAmplitudeEvent",data:{event:{type:"Coupons - Coupon Application Succeeded",properties:f}}})}}function p(e,n,t,r){var o=e.offerId,a=e.selectors,i=e.couponApplicationProcessId,s=e.shouldUseNetworkRequestsApplication,u={offerId:o,selectors:a,isError:n,errorMessage:t,couponApplicationProcessId:i,numberOfCouponsTested:r,totalNumberOfCoupons:e.coupons.length,usingNetworkRequestsApplication:s};(0,c.sendMessageToBackgroundScript)({message:"logUserEvent",data:{event:{type:"couponApplicationFailed",payload:u}}}),(0,c.sendMessageToBackgroundScript)({message:"logAmplitudeEvent",data:{event:{type:"Coupons - Coupon Application Failed",properties:u}}})}n.logCouponElementsDetectionMechanismStartedOnCartWebpage=function(e){return r(this,void 0,void 0,(function(){var n,t,r,a;return o(this,(function(o){switch(o.label){case 0:return[4,(0,u.checkIsCartWebpageAndGetMatchData)(window.location.href)];case 1:return o.sent().isCartWebpage?(n=e.offerId,t=e.selectors,r=e.couponApplicationProcessId,a={offerId:n,selectors:t,couponApplicationProcessId:r,webpageUrl:window.location.href},(0,c.sendMessageToBackgroundScript)({message:"logUserEvent",data:{event:{type:"couponElementsDetectionMechanismStarted",active:!1,payload:a}}}),[2]):[2]}}))}))},n.logCouponElementsFoundEvent=function(e){var n=e.offerId,t=e.selectors,r=e.couponApplicationProcessId,o=e.isAutoCouponCheckoutWidgetDisplayEnabled,a=e.shouldHideAutoCouponCheckoutWidgetDueToLowSuccessRate,i={offerId:n,selectors:t,couponApplicationProcessId:r,webpageUrl:window.location.href,isAutoCouponCheckoutWidgetDisplayEnabled:o,shouldHideAutoCouponCheckoutWidgetDueToLowSuccessRate:a,isAutoCouponCheckoutWidgetSnoozed:(0,l.checkIsCouponsCheckoutWidgetSnoozed)(e)};(0,c.sendMessageToBackgroundScript)({message:"logUserEvent",data:{event:{type:"couponElementsFound",active:!1,payload:i}}})},n.logCouponElementsNotFoundEvent=function(e){return r(this,void 0,void 0,(function(){var n,t,r,a,i,s;return o(this,(function(o){switch(o.label){case 0:return[4,(0,u.checkIsCartWebpageAndGetMatchData)(window.location.href)];case 1:return o.sent().isCartWebpage?(n=e.offerId,t=e.selectors,r=e.couponApplicationProcessId,a=e.isAutoCouponCheckoutWidgetDisplayEnabled,i=e.shouldHideAutoCouponCheckoutWidgetDueToLowSuccessRate,s={offerId:n,selectors:t,couponApplicationProcessId:r,webpageUrl:window.location.href,isAutoCouponCheckoutWidgetDisplayEnabled:a,shouldHideAutoCouponCheckoutWidgetDueToLowSuccessRate:i,isAutoCouponCheckoutWidgetSnoozed:(0,l.checkIsCouponsCheckoutWidgetSnoozed)(e)},(0,c.sendMessageToBackgroundScript)({message:"logUserEvent",data:{event:{type:"couponElementsNotFound",active:!1,payload:s}}}),[2]):[2]}}))}))},n.checkShouldLogElementsFoundEvent=function(e){var n=e.selectors;return!!(n.couponField&&n.couponField.detectionStatus===s.CouponSelectorElementDetectionStatus.found||n.showCouponFieldClickableElement&&n.showCouponFieldClickableElement.detectionStatus===s.CouponSelectorElementDetectionStatus.found)},n.logCouponAutomationProposalWidgetDisplayedEvents=function(e){var n=e.offerId,t=e.selectors,r=e.couponApplicationProcessId,o=e.widgetVariant,a=e.displayedSuccessRateAutoCoupons,i=e.lastUsedAtAutoCoupons,u=(0,s.getCurrentUrlHostname)(),l={widgetType:"autoCoupon",widgetVariant:o,offerId:n,widgetDisplayedTimestampInMs:Date.now(),timeToDisplayWidgetAfterPageLoadingStart:Date.now()-performance.timeOrigin,currentUrlHostname:u,selectors:t,couponApplicationProcessId:r,displayedSuccessRateAutoCoupons:a,lastUsedAtAutoCoupons:i};(0,c.sendMessageToBackgroundScript)({message:"logUserEvent",data:{event:{type:"browserExtensionWidgetDisplayed",payload:l}}}),(0,c.sendMessageToBackgroundScript)({message:"logAmplitudeEvent",data:{event:{type:"Browser Extension - Widget Displayed",properties:l}}})},n.logClosedCouponWidgetEvents=function(e,n,t){var r={offerId:e,isTemporaryUser:n,closeButtonDisplayedText:t,widgetType:"autoCoupon"};(0,c.sendMessageToBackgroundScript)({message:"logUserEvent",data:{event:{type:"closedBrowserExtensionWidget",payload:r}}}),(0,c.sendMessageToBackgroundScript)({message:"logAmplitudeEvent",data:{event:{type:"Browser Extension - Widget Closed",properties:r}}})},n.logStartedCouponApplicationEvents=function(e,n){var t={offerId:e.offerId,selectors:e.selectors,from:n,couponApplicationProcessId:e.couponApplicationProcessId,usingNetworkRequestsApplication:e.shouldUseNetworkRequestsApplication,networkRequestsParameters:e.networkRequestsParameters,detectedCouponCrm:e.couponCrm};(0,c.sendMessageToBackgroundScript)({message:"logUserEvent",data:{event:{type:"startedCouponApplication",payload:t}}}),(0,c.sendMessageToBackgroundScript)({message:"logAmplitudeEvent",data:{event:{type:"Coupons - Started Coupon Application",properties:t}}})},n.logCouponTestedEvent=function(e,n,t){var r=e.offerId,o=e.couponIndex,a=e.isPageReloading,s=e.coupons,u=e.basePrice,l=e.webpageUrl,d=e.priceCurrency,p=e.couponApplicationProcessId,f=e.shouldUseNetworkRequestsApplication,m=e.responseParsingResult,y=s[o],h=y.merchantCouponId,v=y.code,_=y.isSelectedForReevaluation,g=t?Math.round(100*(u-t))/100:void 0,b={merchantCouponId:h,couponCode:v,isSelectedForReevaluation:_,offerId:r,totalCartPriceBeforeApplication:u,totalCartPriceAfterApplication:t,totalCartPriceCurrency:d,amountSaved:g,didCouponWork:f&&m?"successful"===m.result.type:(g||0)>0,didPageReload:!!a,positionTestedAt:o,webpageUrlBeforeApplication:n,usingNetworkRequestsApplication:f,webpageUrlAfterApplication:l,couponApplicationProcessId:p,nextCouponId:o<s.length-1?s[o+1].merchantCouponId:void 0,responseParsingResult:i.default.omit(m,"rawHtmlResponse")};(0,c.sendMessageToBackgroundScript)({message:"logUserEvent",data:{event:{type:"couponAutomaticallyTested",payload:b}}})},n.logCancelledCouponApplicationEvents=function(e){if(e.active){var n=e.active,t={offerId:n.offerId,selectors:n.selectors,couponApplicationProcessId:n.couponApplicationProcessId,usingNetworkRequestsApplication:n.shouldUseNetworkRequestsApplication};(0,c.sendMessageToBackgroundScript)({message:"logUserEvent",data:{event:{type:"cancelledCouponApplication",payload:t}}}),(0,c.sendMessageToBackgroundScript)({message:"logAmplitudeEvent",data:{event:{type:"Coupons - Cancelled Coupon Application",properties:t}}})}},n.logCouponApplicationFinalEvents=function(e){e.bestCoupon?d(e,!0,e.coupons.length):p(e,!1,void 0,e.coupons.length)},n.logCouponApplicationSucceededEvents=d,n.logCouponApplicationFailedEvents=p},21427:function(e,n,t){var r=this&&this.__assign||function(){return r=Object.assign||function(e){for(var n,t=1,r=arguments.length;t<r;t++)for(var o in n=arguments[t])Object.prototype.hasOwnProperty.call(n,o)&&(e[o]=n[o]);return e},r.apply(this,arguments)},o=this&&this.__awaiter||function(e,n,t,r){return new(t||(t=Promise))((function(o,a){function i(e){try{c(r.next(e))}catch(e){a(e)}}function s(e){try{c(r.throw(e))}catch(e){a(e)}}function c(e){var n;e.done?o(e.value):(n=e.value,n instanceof t?n:new t((function(e){e(n)}))).then(i,s)}c((r=r.apply(e,n||[])).next())}))},a=this&&this.__generator||function(e,n){var t,r,o,a,i={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return a={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function s(s){return function(c){return function(s){if(t)throw new TypeError("Generator is already executing.");for(;a&&(a=0,s[0]&&(i=0)),i;)try{if(t=1,r&&(o=2&s[0]?r.return:s[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,s[1])).done)return o;switch(r=0,o&&(s=[2&s[0],o.value]),s[0]){case 0:case 1:o=s;break;case 4:return i.label++,{value:s[1],done:!1};case 5:i.label++,r=s[1],s=[0];continue;case 7:s=i.ops.pop(),i.trys.pop();continue;default:if(!(o=i.trys,(o=o.length>0&&o[o.length-1])||6!==s[0]&&2!==s[0])){i=0;continue}if(3===s[0]&&(!o||s[1]>o[0]&&s[1]<o[3])){i.label=s[1];break}if(6===s[0]&&i.label<o[1]){i.label=o[1],o=s;break}if(o&&i.label<o[2]){i.label=o[2],i.ops.push(s);break}o[2]&&i.ops.pop(),i.trys.pop();continue}s=n.call(e,i)}catch(e){s=[6,e],r=0}finally{t=o=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,c])}}},i=this&&this.__read||function(e,n){var t="function"==typeof Symbol&&e[Symbol.iterator];if(!t)return e;var r,o,a=t.call(e),i=[];try{for(;(void 0===n||n-- >0)&&!(r=a.next()).done;)i.push(r.value)}catch(e){o={error:e}}finally{try{r&&!r.done&&(t=a.return)&&t.call(a)}finally{if(o)throw o.error}}return i},s=this&&this.__spreadArray||function(e,n,t){if(t||2===arguments.length)for(var r,o=0,a=n.length;o<a;o++)!r&&o in n||(r||(r=Array.prototype.slice.call(n,0,o)),r[o]=n[o]);return e.concat(r||Array.prototype.slice.call(n))},c=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(n,"__esModule",{value:!0}),n.useSkippedCouponsSplit=n.useShouldSkipUnsuccessfulCouponsEnabled=n.useEnrichedMerchantCoupons=void 0;var u=c(t(96540)),l=c(t(2543)),d=t(55015),p=t(32668),f=t(46239);n.useEnrichedMerchantCoupons=function(e,n){var t=i(u.default.useState(void 0),2),s=t[0],c=t[1];return u.default.useEffect((function(){(function(e,n){var t;return o(this,void 0,void 0,(function(){var o,i,s,c;return a(this,(function(a){switch(a.label){case 0:return e?(o=(null===(t=e.browserExtension)||void 0===t?void 0:t.coupons)&&e.browserExtension.coupons.itemList||[],(s=n)?[3,2]:[4,(0,d.checkHasFeature)((0,p.checkIsOnMobileScreen)()?d.Feature.skipUnsuccessfulCouponsMobileBrowserExtension:d.Feature.skipUnsuccessfulCouponsDesktopBrowserExtension)]):[2,[]];case 1:s=a.sent(),a.label=2;case 2:return i=s,[4,(0,d.getSetting)(d.SettingKey.couponsPriorityManagementSettings)];case 3:return c=a.sent(),(0,d.checkShouldSkipUnsuccessfulCoupons)(o.length,i,c)?[2,new Promise((function(n){return(0,f.sendMessageToBackgroundScript)({message:"getEnrichedMerchantCoupons",data:{offer:e}},(function(e){n(e||o.map((function(e){return r(r({},e),{shouldSkip:!1,isSelectedForReevaluation:!1})})))}))}))]:[2,o.map((function(e){return r(r({},e),{shouldSkip:!1,isSelectedForReevaluation:!1})}))]}}))}))})(e,n).then(c)}),[e]),s},n.useShouldSkipUnsuccessfulCouponsEnabled=function(){var e=i(u.default.useState(void 0),2),n=e[0],t=e[1];return u.default.useEffect((function(){(0,d.checkHasFeature)((0,p.checkIsOnMobileScreen)()?d.Feature.skipUnsuccessfulCouponsMobileBrowserExtension:d.Feature.skipUnsuccessfulCouponsDesktopBrowserExtension).then(t)}),[]),n},n.useSkippedCouponsSplit=function(e,n){var t=i(u.default.useMemo((function(){return e&&void 0!==n?n?l.default.partition(e,(function(e){var n=e.shouldSkip,t=e.isSelectedForReevaluation;return n&&!t})):[[],s([],i(e),!1)]:[void 0,void 0]}),[e,n]),2);return{skippedCoupons:t[0],selectedCoupons:t[1]}}},42604:function(e,n,t){var r=this&&this.__awaiter||function(e,n,t,r){return new(t||(t=Promise))((function(o,a){function i(e){try{c(r.next(e))}catch(e){a(e)}}function s(e){try{c(r.throw(e))}catch(e){a(e)}}function c(e){var n;e.done?o(e.value):(n=e.value,n instanceof t?n:new t((function(e){e(n)}))).then(i,s)}c((r=r.apply(e,n||[])).next())}))},o=this&&this.__generator||function(e,n){var t,r,o,a,i={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return a={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function s(s){return function(c){return function(s){if(t)throw new TypeError("Generator is already executing.");for(;a&&(a=0,s[0]&&(i=0)),i;)try{if(t=1,r&&(o=2&s[0]?r.return:s[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,s[1])).done)return o;switch(r=0,o&&(s=[2&s[0],o.value]),s[0]){case 0:case 1:o=s;break;case 4:return i.label++,{value:s[1],done:!1};case 5:i.label++,r=s[1],s=[0];continue;case 7:s=i.ops.pop(),i.trys.pop();continue;default:if(!(o=i.trys,(o=o.length>0&&o[o.length-1])||6!==s[0]&&2!==s[0])){i=0;continue}if(3===s[0]&&(!o||s[1]>o[0]&&s[1]<o[3])){i.label=s[1];break}if(6===s[0]&&i.label<o[1]){i.label=o[1],o=s;break}if(o&&i.label<o[2]){i.label=o[2],i.ops.push(s);break}o[2]&&i.ops.pop(),i.trys.pop();continue}s=n.call(e,i)}catch(e){s=[6,e],r=0}finally{t=o=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,c])}}},a=this&&this.__values||function(e){var n="function"==typeof Symbol&&Symbol.iterator,t=n&&e[n],r=0;if(t)return t.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&r>=e.length&&(e=void 0),{value:e&&e[r++],done:!e}}};throw new TypeError(n?"Object is not iterable.":"Symbol.iterator is not defined.")};Object.defineProperty(n,"__esModule",{value:!0}),n.fetchMerchantApiCouponApplicationResponse=void 0;var i=t(74137),s=t(50139),c=t(95537),u=t(98356),l=t(11046);function d(e,n){return r(this,void 0,void 0,(function(){var t,r,a,s,c,l,d;return o(this,(function(o){switch(o.label){case 0:t={formattedRequestUrlParameters:"",formattedRequestBody:null},o.label=1;case 1:return o.trys.push([1,3,,4]),r=n.requestUrlParametersFormatter,a=n.requestBodyFormatter,[4,(0,u.getCouponNetworkRequestFormattedOutputs)({couponCode:e,requestUrlParametersFormattingScript:r||'""',requestBodyFormattingScript:a||"null"})];case 2:return(s=o.sent())?(c=s.formattedRequestUrlParameters,l=s.formattedRequestBody,[2,{formattedRequestUrlParameters:c||"",formattedRequestBody:l||null}]):[2,t];case 3:return d=o.sent(),(0,i.captureSentryException)(new Error("Error while formatting network request parameters and body: ".concat(d))),[2,t];case 4:return[2]}}))}))}function p(e,n,t){var r=new URL(e.merchantApiEndpointUrl+n);return function(e,n){var t=n.csrfToken,r=n.arbitraryToken,o=l.CSRF_TOKEN_NAMES.find((function(n){return e.searchParams.has(n)}));t&&o&&e.searchParams.set(o,t);r&&e.searchParams.has(r.key)&&e.searchParams.set(r.key,r.value)}(r,t),function(e,n){var t,r,o=n.cartId;if(!o)return;var i=e.pathname.split("/"),c=[s.checkIsBase64Encoded,s.checkIsUuid],u=function(n){if(n(o)){var t=i.findIndex((function(e){return n(e)&&o.length===e.length}));return t<0?"continue":(i[t]=o,e.pathname=i.join("/"),{value:void 0})}};try{for(var l=a(c),d=l.next();!d.done;d=l.next()){var p=u(d.value);if("object"==typeof p)return p.value}}catch(e){t={error:e}}finally{try{d&&!d.done&&(r=l.return)&&r.call(l)}finally{if(t)throw t.error}}}(r,t),r.toString()}function f(e,n,t){var r={headers:y(n,t),referrer:window.location.href,method:n.method,mode:"cors",credentials:"include"};return"GET"!==n.method&&(r.body=function(e,n,t){if(!n.requestContentType||!e)return e;var r=n.requestContentType.split(";").map((function(e){return e.trim()}));if("application/x-www-form-urlencoded"===r[0]){var o=new URLSearchParams(e);return function(e,n){var t=n.jsonRpcToken,r=n.csrfToken,o=n.arbitraryToken;e.has("JSONRPC")&&function(e,n){var t=e.get("JSONRPC");if(!t)return;var r=JSON.parse(t),o=(0,s.replaceArbitrarilyNestedFieldInObject)(r,l.JSONRPC_TOKEN_NAME,n);if(!o)throw new Error("Could not find JSON RPC token in request body");e.set("JSONRPC",JSON.stringify(r))}(e,t);(function(e,n){var t,r;try{for(var o=a(l.CSRF_TOKEN_NAMES),i=o.next();!i.done;i=o.next()){var s=i.value;if(e.has(s)){if(!n)throw new Error("CSRF token not found in the merchant webpage and required in request");e.set(s,n)}}}catch(e){t={error:e}}finally{try{i&&!i.done&&(r=o.return)&&r.call(o)}finally{if(t)throw t.error}}})(e,r),o&&e.has(o.key)&&e.set(o.key,o.value)}(o,t),o.toString()}if("application/json"===r[0])try{var i=JSON.parse(e);return function(e,n){!function(e,n){var t=n.cartId,r=n.csrfToken;t&&(0,s.replaceFirstLeafFieldMatchingCriterionInObject)(e,(function(e){return function(e){var n=e.key,t=e.value,r=e.cartId;return"string"==typeof t&&t.length===r.length&&h.some((function(e){return(0,s.convertVariableNameToReadableText)(n).includes(e)}))&&(o=t,a=r,!((0,s.checkIsBase64Encoded)(o)&&!(0,s.checkIsBase64Encoded)(a)||(0,s.checkIsUuid)(o)&&!(0,s.checkIsUuid)(a)));var o,a}({key:e.key,value:e.value,cartId:t})}),t);r&&(0,s.replaceFirstLeafFieldMatchingCriterionInObject)(e,(function(e){var n=e.key;return/csrf/i.test(n)}),r)}(function(e){return e.hasOwnProperty("query")&&e.hasOwnProperty("variables")&&e.hasOwnProperty("operationName")}(e)?e.variables:e,n)}(i,t),JSON.stringify(i)}catch(e){console.error(e)}return e}(e,n,t)),r}n.fetchMerchantApiCouponApplicationResponse=function(e){var n=e.couponCode,t=e.activeState,a=e.couponRequestTokens;return r(this,void 0,void 0,(function(){var e,r,i,s,u,l;return o(this,(function(o){switch(o.label){case 0:if(e=t.networkRequestsParameters,!(r=t.couponCrm))return[3,4];o.label=1;case 1:return o.trys.push([1,3,,4]),[4,(0,c.getCouponCrmDriver)(r).applyCoupon(n)];case 2:return[2,o.sent()];case 3:return i=o.sent(),console.error(i),[3,4];case 4:if(!e)throw new Error("Invalid network requests parameters");return[4,d(n,e)];case 5:return s=o.sent(),u=s.formattedRequestUrlParameters,l=s.formattedRequestBody,[2,fetch(p(e,u,a),f(l,e,a))]}}))}))};var m=new Set(["accept-charset","accept-encoding","access-control-request-headers","access-control-request-method","connection","content-length","cookie","date","dnt","expect","host","keep-alive","origin","permission-policy","referer","te","trailer","transfer-encoding","upgrade","via","user-agent"]);function y(e,n){var t,r,o=e.requestContentType,i=e.additionalHeaders,s=n.authorizationToken,c=n.jsonRpcToken,u=n.csrfToken,l=new Headers,d=void 0,p=void 0;if(i)try{for(var f=a(i),y=f.next();!y.done;y=f.next()){var h=y.value,v=h.name,_=h.value,g=v.toLowerCase();_.startsWith("Bearer")&&s&&s.startsWith("Bearer")?d=v:m.has(g)||g.startsWith("sec-")||g.startsWith("proxy-")||l.set(v,_),/csrf/.test(g)&&(p=v)}}catch(e){t={error:e}}finally{try{y&&!y.done&&(r=f.return)&&r.call(f)}finally{if(t)throw t.error}}return o&&l.set("content-type",o),s&&(d?l.set(d,s):l.set("authorization",s)),u&&(p?l.set(p,u):l.set("x-csrf-token",u)),c&&l.set("x-csrf-token",c),l}var h=["cart","bag","basket","order"]},18345:function(e,n,t){var r=this&&this.__awaiter||function(e,n,t,r){return new(t||(t=Promise))((function(o,a){function i(e){try{c(r.next(e))}catch(e){a(e)}}function s(e){try{c(r.throw(e))}catch(e){a(e)}}function c(e){var n;e.done?o(e.value):(n=e.value,n instanceof t?n:new t((function(e){e(n)}))).then(i,s)}c((r=r.apply(e,n||[])).next())}))},o=this&&this.__generator||function(e,n){var t,r,o,a,i={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return a={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function s(s){return function(c){return function(s){if(t)throw new TypeError("Generator is already executing.");for(;a&&(a=0,s[0]&&(i=0)),i;)try{if(t=1,r&&(o=2&s[0]?r.return:s[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,s[1])).done)return o;switch(r=0,o&&(s=[2&s[0],o.value]),s[0]){case 0:case 1:o=s;break;case 4:return i.label++,{value:s[1],done:!1};case 5:i.label++,r=s[1],s=[0];continue;case 7:s=i.ops.pop(),i.trys.pop();continue;default:if(!(o=i.trys,(o=o.length>0&&o[o.length-1])||6!==s[0]&&2!==s[0])){i=0;continue}if(3===s[0]&&(!o||s[1]>o[0]&&s[1]<o[3])){i.label=s[1];break}if(6===s[0]&&i.label<o[1]){i.label=o[1],o=s;break}if(o&&i.label<o[2]){i.label=o[2],i.ops.push(s);break}o[2]&&i.ops.pop(),i.trys.pop();continue}s=n.call(e,i)}catch(e){s=[6,e],r=0}finally{t=o=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,c])}}},a=this&&this.__read||function(e,n){var t="function"==typeof Symbol&&e[Symbol.iterator];if(!t)return e;var r,o,a=t.call(e),i=[];try{for(;(void 0===n||n-- >0)&&!(r=a.next()).done;)i.push(r.value)}catch(e){o={error:e}}finally{try{r&&!r.done&&(t=a.return)&&t.call(a)}finally{if(o)throw o.error}}return i},i=this&&this.__spreadArray||function(e,n,t){if(t||2===arguments.length)for(var r,o=0,a=n.length;o<a;o++)!r&&o in n||(r||(r=Array.prototype.slice.call(n,0,o)),r[o]=n[o]);return e.concat(r||Array.prototype.slice.call(n))},s=this&&this.__values||function(e){var n="function"==typeof Symbol&&Symbol.iterator,t=n&&e[n],r=0;if(t)return t.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&r>=e.length&&(e=void 0),{value:e&&e[r++],done:!e}}};throw new TypeError(n?"Object is not iterable.":"Symbol.iterator is not defined.")},c=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(n,"__esModule",{value:!0}),n.checkWasApplicationSuccessfulFromMerchantApiResponse=void 0;var u=c(t(2543)),l=t(55015),d=t(50139),p=t(99959),f=t(95537),m=[401,403,404,405,429,498,500,501];function y(e,n,t,a,i){return r(this,void 0,void 0,(function(){var r,s,c,u,l;return o(this,(function(o){switch(o.label){case 0:if(r=e.headers.get("content-type")||void 0,i&&!i.wasResponseOk&&e.ok)return[2,{responseContentType:r,type:"automatic",result:{type:"successful",decisionReason:"responseOkWithWarmupResponseNotOk"}}];if(!a)return[3,8];o.label=1;case 1:return o.trys.push([1,3,,7]),[4,(u=(0,f.getCouponCrmDriver)(a)).checkIsCouponApplicationSuccessful(e)];case 2:return c=o.sent(),[2,{responseContentType:r,type:"automatic",result:{type:c?"successful":"unsuccessful",decisionReason:"couponCrmDriver"},couponCrm:u.couponCrm}];case 3:return o.sent(),void 0!==(u=(0,f.getCouponCrmDriver)(a)).responseBody?[3,5]:[4,e.text()];case 4:return s=o.sent(),[3,6];case 5:s="string"!=typeof u.responseBody?JSON.stringify(u.responseBody):u.responseBody,o.label=6;case 6:return[3,7];case 7:return[3,10];case 8:return[4,e.text()];case 9:s=o.sent(),o.label=10;case 10:return s.length?(l=function(e){try{return JSON.parse(e)}catch(e){return}}(s),l?[2,_(r,t,l)]:r&&r.includes("text/html")?[2,b(r,s,n,t)]:[2,{responseContentType:r,type:"automatic",result:{type:"unknown",decisionReason:"unhandledResponseContentType"}}]):[2,{responseContentType:r,type:"automatic",result:e.ok?{type:"successful",decisionReason:"responseOkWithEmptyBody"}:{type:"unsuccessful",decisionReason:"responseNotOkWithEmptyBody"}}]}}))}))}n.checkWasApplicationSuccessfulFromMerchantApiResponse=function(e){var n=e.response,t=e.appliedCouponCode,a=e.activeState,i=e.warmupCouponApplicationStatus;return r(this,void 0,void 0,(function(){var e,r,s,c;return o(this,(function(o){switch(o.label){case 0:if(e=a.networkRequestsParameters,r=a.couponsNetworkRequestsSettings,s=a.couponCrm,c=e?e.responseParser:void 0,(r?r.httpErrorStatusCodesForFallback:m).includes(n.status))throw new Error("Received response with HTTP error status code: ".concat(n.status));return n.ok?c?[3,2]:[4,y(n,t,r,s,i)]:[2,{responseContentType:n.headers.get("content-type")||"",type:"automatic",result:{type:"unsuccessful",decisionReason:"responseNotOk"}}];case 1:case 3:return[2,o.sent()];case 2:return[4,O(n,c)]}}))}))};var h=[/error/i,/(in|not)\s?_?valid/i,/(in|not)\s?_?correct/i,/(un|not)\s?_?success/i,/not\s?_?applied/i],v=[/success/i,/applied/i,/valid/i,/correct/i];function _(e,n,t){var r=n?n.negativeJsonFieldDetectionRegexes.map((function(e){return new RegExp(e,"i")})):h,o=n?n.positiveJsonFieldDetectionRegexes.map((function(e){return new RegExp(e,"i")})):v,s=(0,d.getLeafFieldValuesMatchingRegexesInObject)(t,r,[]);if(1===s.length)return{responseContentType:e,type:"automatic",result:{type:s[0].fieldValue?"unsuccessful":"successful",decisionReason:"foundNegativeFieldValue",fieldName:s[0].fieldKey}};var c=(0,d.getLeafFieldValuesMatchingRegexesInObject)(t,o,r);if(1===c.length&&0===s.length)return{responseContentType:e,type:"automatic",result:{type:c[0].fieldValue?"successful":"unsuccessful",decisionReason:"foundPositiveFieldValue",fieldName:c[0].fieldKey}};if(c.length+s.length>1){var u=i(i([],a(c),!1),a(s),!1).sort(g);return c.includes(u[0])?{responseContentType:e,type:"automatic",result:{type:u[0].fieldValue?"successful":"unsuccessful",decisionReason:"foundPositiveFieldValue",fieldName:u[0].fieldKey}}:{responseContentType:e,type:"automatic",result:{type:u[0].fieldValue?"unsuccessful":"successful",decisionReason:"foundNegativeFieldValue",fieldName:u[0].fieldKey}}}return{responseContentType:e,type:"automatic",result:{type:"unknown",decisionReason:"noFieldMatched"}}}function g(e,n){return i=e.fieldValue,s=n.fieldValue,("boolean"==typeof i&&"boolean"!=typeof s?-1:"boolean"!=typeof i&&"boolean"==typeof s?1:null===i&&null!==s?-1:null===s&&null!==i?1:"string"==typeof i&&"string"!=typeof s?-1:"string"!=typeof i&&"string"==typeof s?1:0)||(t=e.fieldKey,r=n.fieldKey,o=d.BASE_COUPON_ELEMENTS_KEYWORDS.some((function(e){return t.includes(e)})),a=d.BASE_COUPON_ELEMENTS_KEYWORDS.some((function(e){return r.includes(e)})),o&&!a?-1:!o&&a?1:0);var t,r,o,a,i,s}function b(e,n,t,r){var o=document.createElement("html");o.innerHTML=n,o.style.display="none",document.body.appendChild(o);var i=C(o,t)||(0,p.getCouponInputFieldHeuristic)(o),s=function(e,n){var t=e.indexOf(n);if(-1===t)return;var r=e.substring(t-k,t+k);return h.some((function(e){return e.test(r)}))}(n,t);if(s)return document.body.removeChild(o),{responseContentType:e,rawHtmlResponse:n,type:"automatic",result:{type:"unsuccessful",decisionReason:"errorLikeMessageFound"}};if(!i)return document.body.removeChild(o),{responseContentType:e,rawHtmlResponse:n,type:"automatic",result:{type:"successful",decisionReason:"noElementFound"}};var c=void 0!==S(i,(function(e){return function(e){return E.some((function(n){return n.test(e.className)}))}(e)||function(e,n){var t=getComputedStyle(e);if(!t)return!1;var r=t.getPropertyValue("color");return o=I,i=r,s=a(A(o),3),c=s[0],u=s[1],l=s[2],d=a(A(i),3),p=d[0],f=d[1],m=d[2],Math.sqrt(Math.pow(c-p,2)+Math.pow(u-f,2)+Math.pow(l-m,2))<(n?n.errorRgbEuclideanDistanceToPureRedThreshold:T);var o,i,s,c,u,l,d,p,f,m}(e,r)}));return c?(document.body.removeChild(o),{responseContentType:e,rawHtmlResponse:n,type:"automatic",result:{type:"unsuccessful",decisionReason:"foundErrorLikeElement"}}):(document.body.removeChild(o),{responseContentType:e,rawHtmlResponse:n,type:"automatic",result:{type:"successful",decisionReason:"noErrorLikeMessageFound"}})}function C(e,n){var t,r;if(e.textContent&&e.textContent.includes(n)){if(!e.children.length)return e;try{for(var o=s(Array.from(e.children)),a=o.next();!a.done;a=o.next()){var i=C(a.value,n);if(i)return i}}catch(e){t={error:e}}finally{try{a&&!a.done&&(r=o.return)&&r.call(o)}finally{if(t)throw t.error}}}}function S(e,n,t){var r,o;if(void 0===t&&(t=4),t&&e){if(n(e))return e;var a=function(e){if(!e)return[];var n=e.parentElement;return n?Array.from(n.children):[]}(e);try{for(var i=s(a),c=i.next();!c.done;c=i.next()){var u=c.value;if(u.parentElement){var l=1===u.parentElement.children.length?t:t-1,d=S(u.parentElement,n,l);if(d)return d}}}catch(e){r={error:e}}finally{try{c&&!c.done&&(o=i.return)&&o.call(i)}finally{if(r)throw r.error}}}}var T=25,I="rgb(255, 0, 0)";function A(e){var n=e.replace(/[^\d,]/g,"").split(",");return 3!==n.length?[255,255,255]:n.map((function(e){return parseInt(e)}))}var E=[/error/i,/warning/i,/invalid/i,/incorrect/i];var k=1e3;function O(e,n){return r(this,void 0,void 0,(function(){var t,r,a;return o(this,(function(o){switch(o.label){case 0:return t=e.headers.get("content-type")||"",[4,e.text()];case 1:switch(r=o.sent(),a=t.includes("text/html")?r:void 0,n.type){case l.CouponResponseParserType.objectPath:return[2,{type:"manual",responseContentType:t,rawHtmlResponse:a,responseParser:n,result:{type:u.default.get(JSON.parse(r),n.value)?"successful":"unsuccessful"}}];case l.CouponResponseParserType.successfulApplicationDetectionRegex:return[2,{type:"manual",responseContentType:t,rawHtmlResponse:a,responseParser:n,result:{type:new RegExp(n.value).test(r)?"successful":"unsuccessful"}}];case l.CouponResponseParserType.unsuccessfulApplicationDetectionRegex:return[2,{type:"manual",responseContentType:t,rawHtmlResponse:a,responseParser:n,result:{type:new RegExp(n.value).test(r)?"unsuccessful":"successful"}}]}return[2]}}))}))}},98356:function(e,n,t){var r=this&&this.__awaiter||function(e,n,t,r){return new(t||(t=Promise))((function(o,a){function i(e){try{c(r.next(e))}catch(e){a(e)}}function s(e){try{c(r.throw(e))}catch(e){a(e)}}function c(e){var n;e.done?o(e.value):(n=e.value,n instanceof t?n:new t((function(e){e(n)}))).then(i,s)}c((r=r.apply(e,n||[])).next())}))},o=this&&this.__generator||function(e,n){var t,r,o,a,i={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return a={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function s(s){return function(c){return function(s){if(t)throw new TypeError("Generator is already executing.");for(;a&&(a=0,s[0]&&(i=0)),i;)try{if(t=1,r&&(o=2&s[0]?r.return:s[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,s[1])).done)return o;switch(r=0,o&&(s=[2&s[0],o.value]),s[0]){case 0:case 1:o=s;break;case 4:return i.label++,{value:s[1],done:!1};case 5:i.label++,r=s[1],s=[0];continue;case 7:s=i.ops.pop(),i.trys.pop();continue;default:if(!(o=i.trys,(o=o.length>0&&o[o.length-1])||6!==s[0]&&2!==s[0])){i=0;continue}if(3===s[0]&&(!o||s[1]>o[0]&&s[1]<o[3])){i.label=s[1];break}if(6===s[0]&&i.label<o[1]){i.label=o[1],o=s;break}if(o&&i.label<o[2]){i.label=o[2],i.ops.push(s);break}o[2]&&i.ops.pop(),i.trys.pop();continue}s=n.call(e,i)}catch(e){s=[6,e],r=0}finally{t=o=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,c])}}};Object.defineProperty(n,"__esModule",{value:!0}),n.getCouponNetworkRequestFormattedOutputs=n.injectScriptAndReplaceExistingOne=n.InjectedScriptElement=void 0;var a,i=t(55015),s=t(17621),c=t(62849),u=t(33682);function l(e){var n=e.couponCode,t=e.requestUrlParametersFormattingScript,r=e.requestBodyFormattingScript;return new Promise((function(e,o){var a=(0,s.getHashedElementId)(s.JokoExtensionRootElement.couponNetworkRequestFormatterSandboxedIframe),i=document.getElementById(a),c=null==i?void 0:i.contentWindow;if(!c)return e(void 0);var u=setTimeout((function(){e(void 0),window.removeEventListener("message",l)}),2e3),l=function(n){var t=n.data,r=t.type,a=t.formattedRequestUrlParameters,i=t.formattedRequestBody,s=t.error;r&&"jokoFormatterSandboxedIframeResponse"===r&&(s&&o(s),e({formattedRequestUrlParameters:a,formattedRequestBody:i}),clearTimeout(u),window.removeEventListener("message",l))};window.addEventListener("message",l);var d={type:"jokoFormatterSandboxedIframeRequest",couponCode:n,requestUrlParametersFormattingScript:t,requestBodyFormattingScript:r};c.postMessage(d,"*")}))}function d(e){var n=e.couponCode,t=e.requestUrlParametersFormattingScript,r=e.requestBodyFormattingScript,o=function(e,n){return new Function('const couponCode = "'.concat(e,'";\n                return ').concat(n,";"))()};return{formattedRequestUrlParameters:o(n,t),formattedRequestBody:o(n,r)}}!function(e){e.countPendingRequests="countPendingRequests",e.captureHeadersAuthorizationToken="captureHeadersAuthorizationToken",e.capturePrestashopJavascriptObject="capturePrestashopJavascriptObject",e.checkOpenCartJavascriptVariablesExist="checkOpenCartJavascriptVariablesExist"}(a=n.InjectedScriptElement||(n.InjectedScriptElement={})),n.injectScriptAndReplaceExistingOne=function(e){return r(this,void 0,void 0,(function(){var n,t,r,l,d;return o(this,(function(o){switch(o.label){case 0:return[4,(0,c.getExtensionType)()];case 1:return n=o.sent(),t=(0,s.getHashedElementId)(e),r=(0,u.getElementFromSelector)("#".concat(t)),(0,i.checkIsCouponSelectorError)(r)||r.remove(),l=document.createElement("script"),n===i.ExtensionType.desktopChromeExtension?l.src=(0,i.getExtensionAssetUrl)("assets/".concat(e,"CouponScript.js")):(d=function(e){switch(e){case a.countPendingRequests:return"(function () {\n                        var container = document.querySelector('#jokoCountPendingRequestsDataContainer');\n                        if (!container) {\n                            container = document.createElement('div');\n                            container.setAttribute('id', 'jokoCountPendingRequestsDataContainer');\n                            document.body.appendChild(container);\n                        }\n                        var proxied = window.XMLHttpRequest.prototype.send;\n                        window.XMLHttpRequest.prototype.send = function () {\n                            var element = document.createElement('div');\n                            element.classList.add('jokoCountPendingRequestsDataContainer');\n                            container.appendChild(element);\n                            var pointer = this;\n                            var intervalId = window.setInterval(function () {\n                                if (pointer.readyState != XMLHttpRequest.DONE) {\n                                    return;\n                                }\n                                element.remove();\n                                clearInterval(intervalId);\n                            }, 100);\n                            return proxied.apply(this, [].slice.call(arguments));\n                        };\n                        const oldFetch = window.fetch;\n                        window.fetch = function (...arguments) {\n                            var element = document.createElement('div');\n                            return Promise.resolve(arguments)\n                                .then(function (args) {\n                                    container.appendChild(element);\n                                    return args;\n                                })\n                                .then(function (args) {\n                                    return oldFetch.apply(this, args);\n                                })\n                                .then(function (response) {\n                                    element.remove();\n                                    return response;\n                                })\n                                .catch(function (error) {\n                                    element.remove();\n                                    throw error;\n                                });\n                        };\n                    })();\n                    ";case a.captureHeadersAuthorizationToken:return"(function () {\n                        const localStorageItem = localStorage.getItem('jokoExtensionTokenData');\n                        if (localStorageItem) {\n                            try {\n                                const localStorageItemObject = JSON.parse(localStorageItem);\n                                if (\n                                    localStorageItemObject.lastRefreshedTimestampMs &&\n                                    Date.now() - localStorageItemObject.lastRefreshedTimestampMs < 1000 * 60 * 30\n                                )\n                                    return;\n                            } catch (error) {\n                                console.error(error);\n                            }\n                        }\n                        const oldFetch = window.fetch;\n                        window.fetch = function (...arguments) {\n                            return Promise.resolve(arguments)\n                                .then(function (arguments) {\n                                    if (arguments.length > 1 && arguments[1] && arguments[1].headers) {\n                                        const token =\n                                            arguments[1].headers['Authorization'] ||\n                                            arguments[1].headers['authorization'];\n                                        if (token)\n                                            localStorage.setItem(\n                                                'jokoExtensionTokenData',\n                                                JSON.stringify({\n                                                    token,\n                                                    lastRefreshedTimestampMs: Date.now(),\n                                                })\n                                            );\n                                    }\n                                    return arguments;\n                                })\n                                .then(function (arguments) {\n                                    return oldFetch.apply(this, arguments).then((response) => {\n                                        if (response.headers && response.headers.has('authorization'))\n                                            localStorage.setItem(\n                                                'jokoExtensionTokenData',\n                                                JSON.stringify({\n                                                    token: response.headers.get('authorization'),\n                                                    lastRefreshedTimestampMs: Date.now(),\n                                                })\n                                            );\n                                        return response;\n                                    });\n                                });\n                        };\n                    })();\n                    ";case a.capturePrestashopJavascriptObject:return"(function () {\n                        const broadcastChannel = new BroadcastChannel('jokoPrestaShopJavascriptObjectChannel');\n                        if (window.prestashop) broadcastChannel.postMessage(window.prestashop.cart);\n                        else broadcastChannel.postMessage(undefined);\n                    })();\n                    ";case a.checkOpenCartJavascriptVariablesExist:return"(function () {\n                        const broadcastChannel = new BroadcastChannel(\n                            'jokoAreOpenCartJavascriptVariablesDefinedChannel'\n                        );\n                        broadcastChannel.postMessage(!!(window.cart && window.voucher));\n                    })();\n                    "}}(e),l.appendChild(document.createTextNode(d)),l.type="text/javascript"),l.id=t,document.body.appendChild(l),[2]}}))}))},n.getCouponNetworkRequestFormattedOutputs=function(e){var n=e.couponCode,t=e.requestUrlParametersFormattingScript,a=e.requestBodyFormattingScript;return r(this,void 0,void 0,(function(){return o(this,(function(e){switch(e.label){case 0:return[4,(0,c.getExtensionType)()];case 1:return e.sent()!==i.ExtensionType.desktopChromeExtension?[3,3]:[4,new Promise((function(e){var n=(0,s.getHashedElementId)(s.JokoExtensionRootElement.couponNetworkRequestFormatterSandboxedIframe);if(document.getElementById(n))return e();var t=document.createElement("iframe");t.id=n,t.style.display="none",t.src=(0,i.getExtensionAssetUrl)("assets/couponNetworkRequestFormatterSandboxedIframe.html"),t.onload=function(){return e()},document.documentElement.append(t)}))];case 2:return e.sent(),[2,l({couponCode:n,requestUrlParametersFormattingScript:t,requestBodyFormattingScript:a})];case 3:return[2,d({couponCode:n,requestUrlParametersFormattingScript:t,requestBodyFormattingScript:a})]}}))}))}},13103:function(e,n,t){var r=this&&this.__awaiter||function(e,n,t,r){return new(t||(t=Promise))((function(o,a){function i(e){try{c(r.next(e))}catch(e){a(e)}}function s(e){try{c(r.throw(e))}catch(e){a(e)}}function c(e){var n;e.done?o(e.value):(n=e.value,n instanceof t?n:new t((function(e){e(n)}))).then(i,s)}c((r=r.apply(e,n||[])).next())}))},o=this&&this.__generator||function(e,n){var t,r,o,a,i={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return a={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function s(s){return function(c){return function(s){if(t)throw new TypeError("Generator is already executing.");for(;a&&(a=0,s[0]&&(i=0)),i;)try{if(t=1,r&&(o=2&s[0]?r.return:s[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,s[1])).done)return o;switch(r=0,o&&(s=[2&s[0],o.value]),s[0]){case 0:case 1:o=s;break;case 4:return i.label++,{value:s[1],done:!1};case 5:i.label++,r=s[1],s=[0];continue;case 7:s=i.ops.pop(),i.trys.pop();continue;default:if(!(o=i.trys,(o=o.length>0&&o[o.length-1])||6!==s[0]&&2!==s[0])){i=0;continue}if(3===s[0]&&(!o||s[1]>o[0]&&s[1]<o[3])){i.label=s[1];break}if(6===s[0]&&i.label<o[1]){i.label=o[1],o=s;break}if(o&&i.label<o[2]){i.label=o[2],i.ops.push(s);break}o[2]&&i.ops.pop(),i.trys.pop();continue}s=n.call(e,i)}catch(e){s=[6,e],r=0}finally{t=o=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,c])}}},a=this&&this.__read||function(e,n){var t="function"==typeof Symbol&&e[Symbol.iterator];if(!t)return e;var r,o,a=t.call(e),i=[];try{for(;(void 0===n||n-- >0)&&!(r=a.next()).done;)i.push(r.value)}catch(e){o={error:e}}finally{try{r&&!r.done&&(t=a.return)&&t.call(a)}finally{if(o)throw o.error}}return i};Object.defineProperty(n,"__esModule",{value:!0}),n.sleepUntilRemovalButtonElementIsFoundWithTimeout=n.sleepUntilNoPendingRequestsAndUntilAllCouponElementsAreFoundWithTimeout=n.runCallbackOnPageFinishedLoading=n.sleepUntilNoPendingRequests=n.executeDelayedCallback=n.SELECTORS_POST_PAGE_RELOAD_CHECK_VALIDITY_DELAY_IN_MS=n.NETWORK_REQUESTS_POST_PAGE_RELOAD_CHECK_VALIDITY_DELAY_IN_MS=n.SELECTORS_POST_COUPON_APPLICATION_DELAY_IN_MS=n.COUPON_APPLICATION_PAGE_RELOAD_TIMEOUT_IN_MS=n.NETWORK_REQUESTS_POST_COUPON_APPLICATION_DELAY_IN_MS=n.FILL_COUPON_INPUT_FIELD_DELAY_IN_MS=n.REMOVAL_BUTTON_POST_CLICK_DELAY_IN_MS=n.SHOW_COUPON_FIELD_CLICKABLE_ELEMENT_POST_CLICK_DELAY_IN_MS=n.COUPON_ELEMENTS_INSPECTION_TIMEOUT_IN_MS=n.COUPON_AUTOMATION_INSPECT_INTERVAL_IN_MS=void 0;var i=t(55015),s=t(74137),c=t(33682),u=t(18045),l=t(91958);n.COUPON_AUTOMATION_INSPECT_INTERVAL_IN_MS=2e3,n.COUPON_ELEMENTS_INSPECTION_TIMEOUT_IN_MS=2500,n.SHOW_COUPON_FIELD_CLICKABLE_ELEMENT_POST_CLICK_DELAY_IN_MS=125,n.REMOVAL_BUTTON_POST_CLICK_DELAY_IN_MS=125,n.FILL_COUPON_INPUT_FIELD_DELAY_IN_MS=125,n.NETWORK_REQUESTS_POST_COUPON_APPLICATION_DELAY_IN_MS=100,n.COUPON_APPLICATION_PAGE_RELOAD_TIMEOUT_IN_MS=2e3,n.SELECTORS_POST_COUPON_APPLICATION_DELAY_IN_MS=500,n.NETWORK_REQUESTS_POST_PAGE_RELOAD_CHECK_VALIDITY_DELAY_IN_MS=150,n.SELECTORS_POST_PAGE_RELOAD_CHECK_VALIDITY_DELAY_IN_MS=750;function d(e){return new Promise((function(n){return setTimeout(n,e)}))}function p(e){return r(this,void 0,void 0,(function(){var n;return o(this,(function(t){switch(t.label){case 0:return[4,d(e)];case 1:return t.sent(),r=(0,c.getElementFromSelector)("#".concat(f)),null===(n=(0,i.checkIsCouponSelectorError)(r)?null:r.childElementCount)?[2,Promise.reject(new Error("Pending requests are not being counted."))]:n>0?[2,p(100)]:[2,Promise.resolve()]}var r}))}))}n.executeDelayedCallback=function(e,n,t){return r(this,void 0,void 0,(function(){var r;return o(this,(function(o){switch(o.label){case 0:return(r=Date.now())-n<e?[4,d(e-(r-n))]:[3,2];case 1:o.sent(),o.label=2;case 2:return t(),[2]}}))}))},n.sleepUntilNoPendingRequests=p;var f="jokoCountPendingRequestsDataContainer";n.runCallbackOnPageFinishedLoading=function(e,n){if(n||"complete"!==document.readyState)var t=setInterval((0,s.withSentry)((function(){"complete"===document.readyState&&(clearInterval(t),e())})),25);else e()},n.sleepUntilNoPendingRequestsAndUntilAllCouponElementsAreFoundWithTimeout=function(e,n,t){return r(this,void 0,void 0,(function(){var r,a,i,s;return o(this,(function(o){switch(o.label){case 0:return[4,p(n)];case 1:o.sent(),r=Date.now(),o.label=2;case 2:return a=(0,u.checkDoCouponElementsExistAndUpdateSelectors)(e),i=a.selectors,s=a.doCouponElementsExist,e.selectors=i,s?[2]:[4,d(100)];case 3:o.sent(),o.label=4;case 4:if(Date.now()-r<t)return[3,2];o.label=5;case 5:return[2]}}))}))},n.sleepUntilRemovalButtonElementIsFoundWithTimeout=function(e,n){return r(this,void 0,void 0,(function(){var t,r,i,s;return o(this,(function(o){switch(o.label){case 0:t=Date.now(),o.label=1;case 1:return r=a((0,l.getRemovalButton)(e),2),i=r[0],s=r[1],i?(e.selectors.removalButton=s,[2]):[4,d(100)];case 2:o.sent(),o.label=3;case 3:if(Date.now()-t<n)return[3,1];o.label=4;case 4:return[2]}}))}))}},11046:function(e,n,t){var r=this&&this.__values||function(e){var n="function"==typeof Symbol&&Symbol.iterator,t=n&&e[n],r=0;if(t)return t.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&r>=e.length&&(e=void 0),{value:e&&e[r++],done:!e}}};throw new TypeError(n?"Object is not iterable.":"Symbol.iterator is not defined.")};Object.defineProperty(n,"__esModule",{value:!0}),n.getCouponTokens=n.CSRF_TOKEN_NAMES=n.JSONRPC_TOKEN_NAME=n.TOKEN_EXPIRATION_DELAY_IN_MS=n.AUTHORIZATION_TOKEN_LOCAL_STORAGE_KEY=void 0;var o=t(99959),a=t(50139),i=t(9971);n.AUTHORIZATION_TOKEN_LOCAL_STORAGE_KEY="jokoExtensionTokenData",n.TOKEN_EXPIRATION_DELAY_IN_MS=18e5,n.JSONRPC_TOKEN_NAME="_TOKEN",n.CSRF_TOKEN_NAMES=["csrf_token","CSRFToken","csrfToken","csrf"];var s=["cart id","bag id","basket id","cart token","bag token","basket token"];function c(e){return n.CSRF_TOKEN_NAMES.map((function(n){return d(n,e)})).find((function(e){return void 0!==e}))}function u(e){var t=Array.from(e.querySelectorAll('input[name*="token" i][type="hidden"]')).filter((function(e){return e.getAttribute("name")!==n.JSONRPC_TOKEN_NAME&&!n.CSRF_TOKEN_NAMES.includes(e.getAttribute("name")||"")}));if(1===t.length)return l(t[0]);var r=f(t);return 1===r.length?l(r[0]):void 0}function l(e){var n=e.getAttribute("name"),t=e.getAttribute("value");if(n&&t)return{key:n,value:t}}function d(e,n){if(void 0===n&&(n=document.documentElement),e){var t=Array.from(n.querySelectorAll('input[name="'.concat(e,'"][type="hidden"]')));if(t.length){if(1===t.length||p(t))return t[0].getAttribute("value")||void 0;var r=f(t);if(r.length)return(1===r.length||p(r))&&r[0].getAttribute("value")||void 0}}}function p(e){if(!e.length)return!0;var n=e[0].getAttribute("value");return e.every((function(e){return e.getAttribute("value")===n}))}function f(e){var n=function(e){var n=e.map((function(e){return e.closest("form")})).filter(m);if(n.length>=1)return n[0];var t=(0,o.getCouponInputFieldHeuristic)(document.documentElement);if(!t)return;var r=t.closest("form");return r||void 0}(e);return n?e.filter((function(e){return null!==e.getAttribute("value")})).filter((function(e){return n.contains(e)})):[]}function m(e){var n,t;if(!e)return!1;var o=e.getAttributeNames(),i=function(n){var t=(0,a.convertVariableNameToReadableText)(n),r=(0,a.convertVariableNameToReadableText)(e.getAttribute(n));if(a.BASE_COUPON_ELEMENTS_KEYWORDS.some((function(e){return r.includes(e)}))||a.BASE_COUPON_ELEMENTS_KEYWORDS.some((function(e){return t.includes(e)})))return{value:!0}};try{for(var s=r(o),c=s.next();!c.done;c=s.next()){var u=i(c.value);if("object"==typeof u)return u.value}}catch(e){n={error:e}}finally{try{c&&!c.done&&(t=s.return)&&t.call(s)}finally{if(n)throw n.error}}return!1}n.getCouponTokens=function(e){var t=function(){var e=localStorage.getItem(n.AUTHORIZATION_TOKEN_LOCAL_STORAGE_KEY);if(e)try{return JSON.parse(e).token}catch(e){return}}(),r=d(n.JSONRPC_TOKEN_NAME),o=function(){var e=Object.keys(localStorage),n=e.map(a.convertVariableNameToReadableText),t=e.filter((function(e,t){return s.some((function(e){return n[t].includes(e)}))}));if(1!==t.length)return;var r=localStorage.getItem(t[0]);return!r||r.length<y?void 0:r}()||function(){try{var e=(0,i.getAllCookieNames)(),n=e.map(a.convertVariableNameToReadableText),t=e.filter((function(e,t){return s.some((function(e){return n[t].includes(e)}))}));if(1!==t.length)return;var r=(0,i.getCookieValueByName)(t[0]);if(!r||r.length<y)return;return r}catch(e){return void console.error(e)}}();if(e&&e.responseContentType&&e.responseContentType.includes("text/html")&&e.rawHtmlResponse){var l=(new DOMParser).parseFromString(e.rawHtmlResponse,"text/html").documentElement;return{authorizationToken:t,jsonRpcToken:r,cartId:o,csrfToken:c(l)||c(document.documentElement),arbitraryToken:u(l)||u(document.documentElement)}}return{authorizationToken:t,jsonRpcToken:r,cartId:o,csrfToken:c(document.documentElement),arbitraryToken:u(document.documentElement)}};var y=8},643:function(e,n,t){var r=this&&this.__assign||function(){return r=Object.assign||function(e){for(var n,t=1,r=arguments.length;t<r;t++)for(var o in n=arguments[t])Object.prototype.hasOwnProperty.call(n,o)&&(e[o]=n[o]);return e},r.apply(this,arguments)},o=this&&this.__awaiter||function(e,n,t,r){return new(t||(t=Promise))((function(o,a){function i(e){try{c(r.next(e))}catch(e){a(e)}}function s(e){try{c(r.throw(e))}catch(e){a(e)}}function c(e){var n;e.done?o(e.value):(n=e.value,n instanceof t?n:new t((function(e){e(n)}))).then(i,s)}c((r=r.apply(e,n||[])).next())}))},a=this&&this.__generator||function(e,n){var t,r,o,a,i={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return a={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function s(s){return function(c){return function(s){if(t)throw new TypeError("Generator is already executing.");for(;a&&(a=0,s[0]&&(i=0)),i;)try{if(t=1,r&&(o=2&s[0]?r.return:s[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,s[1])).done)return o;switch(r=0,o&&(s=[2&s[0],o.value]),s[0]){case 0:case 1:o=s;break;case 4:return i.label++,{value:s[1],done:!1};case 5:i.label++,r=s[1],s=[0];continue;case 7:s=i.ops.pop(),i.trys.pop();continue;default:if(!(o=i.trys,(o=o.length>0&&o[o.length-1])||6!==s[0]&&2!==s[0])){i=0;continue}if(3===s[0]&&(!o||s[1]>o[0]&&s[1]<o[3])){i.label=s[1];break}if(6===s[0]&&i.label<o[1]){i.label=o[1],o=s;break}if(o&&i.label<o[2]){i.label=o[2],i.ops.push(s);break}o[2]&&i.ops.pop(),i.trys.pop();continue}s=n.call(e,i)}catch(e){s=[6,e],r=0}finally{t=o=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,c])}}},i=this&&this.__values||function(e){var n="function"==typeof Symbol&&Symbol.iterator,t=n&&e[n],r=0;if(t)return t.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&r>=e.length&&(e=void 0),{value:e&&e[r++],done:!e}}};throw new TypeError(n?"Object is not iterable.":"Symbol.iterator is not defined.")},s=this&&this.__read||function(e,n){var t="function"==typeof Symbol&&e[Symbol.iterator];if(!t)return e;var r,o,a=t.call(e),i=[];try{for(;(void 0===n||n-- >0)&&!(r=a.next()).done;)i.push(r.value)}catch(e){o={error:e}}finally{try{r&&!r.done&&(t=a.return)&&t.call(a)}finally{if(o)throw o.error}}return i},c=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(n,"__esModule",{value:!0}),n.handleEmbeddedAmazonBnplButtonsDisplay=n.AMAZON_MERCHANT_ID=void 0;var u,l=c(t(96540)),d=c(t(40961)),p=t(55015),f=c(t(40549)),m=t(46239),y=t(17621),h=t(87867),v=t(2321),_=t(77653),g=t(7444),b=c(t(61840));n.AMAZON_MERCHANT_ID="amazon",function(e){e.topButton="placeYourOrder",e.bottomButton="placeYourOrderSecondary"}(u||(u={}));function C(e,n,t){return o(this,void 0,void 0,(function(){var r,o;return a(this,(function(a){switch(a.label){case 0:return(r=document.getElementById(n))&&r.parentElement?[4,S(r,e,t)]:[2];case 1:return(o=a.sent())?[2,I(o,r.parentElement,n)]:[2]}}))}))}function S(e,n,t){return o(this,void 0,void 0,(function(){var r;return a(this,(function(i){switch(i.label){case 0:return(r=e.cloneNode(!0))instanceof HTMLElement?((0,h.traverseChildrenAndApplyHtmlElementTransformers)(r,[h.removeAllAttributesExceptClassAndUseSafeIdAndName,h.removeInputElement]),r.addEventListener("click",(function(e){return function(e,n,t){return o(this,void 0,void 0,(function(){var r;return a(this,(function(o){switch(o.label){case 0:return e.preventDefault(),e.stopImmediatePropagation(),r={fromScreen:"embeddedBnplButton",embeddedAmazonBnplButtonPosition:"topButton"===n?"top":"bottom",offerId:t},(0,m.sendMessageToBackgroundScript)({message:"logUserEvent",data:{event:{type:"clickedPayWithJoko",payload:r}}}),(0,m.sendMessageToBackgroundScript)({message:"logAmplitudeEvent",data:{event:{type:"BNPL - Clicked Pay with Joko",properties:r}}}),[4,(0,v.checkCanDisplayCardReadyWidget)()];case 1:return o.sent()||(0,m.sendMessageToBackgroundScript)({message:"displayBnplSubscriptionWidget"}),[2]}}))}))}(e,n,t)})),r.style.marginTop="10px",[4,(0,v.checkCanDisplayCardReadyWidget)()]):[2];case 1:return i.sent()?T(r,p.colors.frenchGray):T(r,p.colors.black),[2,r]}}))}))}function T(e,n){e.style.backgroundColor=n,e.style.borderColor=n}function I(e,n,t){var o=e.querySelector("#".concat(t,"-announce-joko"));if(o){var a=document.createElement("div"),i=(0,y.getHashedElementId)(y.JokoExtensionRootElement.embeddedAmazonBnplButton,t);if(!document.getElementById(i)){a.id=i;var s=function(e){var n=document.querySelector("#payment-info"),t=function(){T(e,p.colors.frenchGray),n&&n.scrollIntoView({behavior:"smooth",block:"center"})};return t}(e);return d.default.render(l.default.createElement(f.default,null,l.default.createElement(b.default,r({},{onJokoCardReady:s}))),a),o.replaceChildren.apply(o,[a]),n.appendChild(e),!0}}}n.handleEmbeddedAmazonBnplButtonsDisplay=function(e){return o(this,void 0,void 0,(function(){var t,r,o,c,l,d,f,y,h,v,b;return a(this,(function(a){switch(a.label){case 0:return p.browserKind===p.Browser.mobileAppWebView?[2]:[4,(0,g.checkHasFeatureByPlatform)({mobileFeature:p.Feature.bnplEmbeddedAmazonBnplButtonMobileBrowserExtension})];case 1:return a.sent()?[4,(0,_.getMerchantOfferMatchingUrlWithConditionsAndCoupons)(window.location.href)]:[2];case 2:if(!(t=a.sent())||t.merchantId!==n.AMAZON_MERCHANT_ID||"/gp/buy/spc/handlers/display.html"!==e.pathname)return[2];r=new Map,a.label=3;case 3:a.trys.push([3,8,9,10]),o=i(Object.entries(u)),c=o.next(),a.label=4;case 4:return c.done?[3,7]:(l=s(c.value,2),d=l[0],f=l[1],[4,C(d,f,t.offerId)]);case 5:a.sent()&&r.set(f,!0),a.label=6;case 6:return c=o.next(),[3,4];case 7:return[3,10];case 8:return y=a.sent(),v={error:y},[3,10];case 9:try{c&&!c.done&&(b=o.return)&&b.call(o)}finally{if(v)throw v.error}return[7];case 10:return r.get(u.topButton)||r.get(u.bottomButton)?(h={offerId:t.offerId,merchantId:t.merchantId,embeddedAmazonBnplTopButtonDisplayed:!!r.get(u.topButton),embeddedAmazonBnplBottomButtonDisplayed:!!r.get(u.bottomButton)},(0,m.sendMessageToBackgroundScript)({message:"logUserEvent",data:{event:{type:"browserExtensionEmbeddedBnplButtonDisplayed",payload:h}}}),(0,m.sendMessageToBackgroundScript)({message:"logAmplitudeEvent",data:{event:{type:"Browser Extension - Embedded BNPL Button Displayed",properties:h}}}),[2]):[2]}}))}))}},50671:function(e,n,t){var r=this&&this.__awaiter||function(e,n,t,r){return new(t||(t=Promise))((function(o,a){function i(e){try{c(r.next(e))}catch(e){a(e)}}function s(e){try{c(r.throw(e))}catch(e){a(e)}}function c(e){var n;e.done?o(e.value):(n=e.value,n instanceof t?n:new t((function(e){e(n)}))).then(i,s)}c((r=r.apply(e,n||[])).next())}))},o=this&&this.__generator||function(e,n){var t,r,o,a,i={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return a={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function s(s){return function(c){return function(s){if(t)throw new TypeError("Generator is already executing.");for(;a&&(a=0,s[0]&&(i=0)),i;)try{if(t=1,r&&(o=2&s[0]?r.return:s[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,s[1])).done)return o;switch(r=0,o&&(s=[2&s[0],o.value]),s[0]){case 0:case 1:o=s;break;case 4:return i.label++,{value:s[1],done:!1};case 5:i.label++,r=s[1],s=[0];continue;case 7:s=i.ops.pop(),i.trys.pop();continue;default:if(!(o=i.trys,(o=o.length>0&&o[o.length-1])||6!==s[0]&&2!==s[0])){i=0;continue}if(3===s[0]&&(!o||s[1]>o[0]&&s[1]<o[3])){i.label=s[1];break}if(6===s[0]&&i.label<o[1]){i.label=o[1],o=s;break}if(o&&i.label<o[2]){i.label=o[2],i.ops.push(s);break}o[2]&&i.ops.pop(),i.trys.pop();continue}s=n.call(e,i)}catch(e){s=[6,e],r=0}finally{t=o=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,c])}}},a=this&&this.__read||function(e,n){var t="function"==typeof Symbol&&e[Symbol.iterator];if(!t)return e;var r,o,a=t.call(e),i=[];try{for(;(void 0===n||n-- >0)&&!(r=a.next()).done;)i.push(r.value)}catch(e){o={error:e}}finally{try{r&&!r.done&&(t=a.return)&&t.call(a)}finally{if(o)throw o.error}}return i},i=this&&this.__values||function(e){var n="function"==typeof Symbol&&Symbol.iterator,t=n&&e[n],r=0;if(t)return t.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&r>=e.length&&(e=void 0),{value:e&&e[r++],done:!e}}};throw new TypeError(n?"Object is not iterable.":"Symbol.iterator is not defined.")},s=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(n,"__esModule",{value:!0}),n.cancelMerchantWebsiteTrackingConsentBannerTriggeringRequestAndDisplayOfferWidget=n.handleMerchantWebsiteTrackingConsentBannerTriggeringRequest=n.checkIsMerchantWebsiteTrackingConsentBannerTriggerBeingRequested=n.disableMerchantWebsiteTrackingConsentBannerTriggerRequestMode=n.triggerMerchantWebsiteTrackingConsentBanner=n.checkHasUserGivenFullTrackingConsentOnCurrentWebsite=n.checkShouldPromptUserToRetriggerMerchantWebsiteTrackingConsentBanner=n.useMerchantWebsiteTrackingConsentBannerTriggeringInformation=void 0;var c=s(t(96540)),u=t(55015),l=t(7444),d=t(62166),p=t(67456),f=t(76688),m=t(46239),y=t(16868),h=t(72886);function v(e){var n;return r(this,void 0,void 0,(function(){return o(this,(function(t){switch(t.label){case 0:return(null===(n=null==e?void 0:e.browserExtension)||void 0===n?void 0:n.trackingConsent)?e.type!==u.OfferType.Online||!1!==e.browserExtension.trackingConsent.disableTrackingConsentBannerFlow?[2,!1]:[4,(0,l.checkHasFeatureByPlatform)({desktopFeature:u.Feature.enableTrackingConsentBannerFlowInDesktopBrowserExtension,mobileFeature:u.Feature.enableTrackingConsentBannerFlowInMobileBrowserExtension})]:[2,!1];case 1:return[2,t.sent()]}}))}))}function _(e){var n,t;return r(this,void 0,void 0,(function(){var r,a,i,s,c,u,l,d,p;return o(this,(function(o){switch(o.label){case 0:return(null===(n=null==e?void 0:e.browserExtension)||void 0===n?void 0:n.trackingConsent)?(r=e.browserExtension.trackingConsent,a=r.trackingConsentRelatedCookieOrLocalStorageIds,i=r.isTrackingConsentDataInLocalStorageInsteadOfCookies,e.browserExtension.trackingConsent.cmpId?[4,g(e.browserExtension.trackingConsent.cmpId)]:[3,2]):[2,void 0];case 1:return l=o.sent(),[3,3];case 2:l={},o.label=3;case 3:return c=(s=l).trackingConsentRelatedCookieOrLocalStorageIds,u=s.isTrackingConsentDataInLocalStorageInsteadOfCookies,d=null!==(t=null!=a?a:c)&&void 0!==t?t:void 0,p=!(!i&&!u),d?[2,{trackingConsentRelatedCookieOrLocalStorageIds:d,isTrackingConsentDataInLocalStorageInsteadOfCookies:p}]:[2,void 0]}}))}))}function g(e){return r(this,void 0,void 0,(function(){var n,t;return o(this,(function(r){switch(r.label){case 0:return[4,(0,p.getMerchantWebsiteTrackingConsentCmpDataSettings)()];case 1:return(null==(n=r.sent())?void 0:n[e])&&(t=n[e])?[2,{trackingConsentRelatedCookieOrLocalStorageIds:t.trackingConsentRelatedCookieOrLocalStorageIds,isTrackingConsentDataInLocalStorageInsteadOfCookies:t.isTrackingConsentDataInLocalStorageInsteadOfCookies}]:[2,{}]}}))}))}function b(){var e=localStorage.getItem(d.LAST_DETECTED_TRACKING_CONSENT_CHOICE_STORAGE_KEY);if(null!==e)return e===u.TrackingConsentChoice.acceptAll}function C(e,n){if((0,d.getUniqueElementFromSelector)(n))return!0;if(!e)return!1;var t=e.trackingConsentRelatedCookieOrLocalStorageIds,r=e.isTrackingConsentDataInLocalStorageInsteadOfCookies,o=S({cookieNames:t}),a=r?I({localStorageKeys:t}):[];return t.every((function(e){return o.includes(e)||a.includes(e)}))}function S(e){var n,t,r=e.cookieNames,o=e.shouldRemoveFoundEntries,a=new Set(document.cookie.split(";").map((function(e){return e.trim().split("=")[0]}))),s=[];try{for(var c=i(r),u=c.next();!u.done;u=c.next()){var l=u.value;a.has(l)&&(s.push(l),o&&T(l))}}catch(e){n={error:e}}finally{try{u&&!u.done&&(t=c.return)&&t.call(c)}finally{if(n)throw n.error}}return s}function T(e){var n=document.domain,t=n.split(".").slice(1).join(".");document.cookie="".concat(e,"=; expires=Thu, 01 Jan 1970 00:00:00 UTC; domain=").concat(n,"; path=/;"),document.cookie="".concat(e,"=; expires=Thu, 01 Jan 1970 00:00:00 UTC; domain=").concat(t,"; path=/;")}function I(e){var n,t,r=e.localStorageKeys,o=e.shouldRemoveFoundEntries,a=[];try{for(var s=i(r),c=s.next();!c.done;c=s.next()){var u=c.value;localStorage.getItem(u)&&(a.push(u),o&&localStorage.removeItem(u))}}catch(e){n={error:e}}finally{try{c&&!c.done&&(t=s.return)&&t.call(s)}finally{if(n)throw n.error}}return a}n.useMerchantWebsiteTrackingConsentBannerTriggeringInformation=function(e){var n=this,t=e.offer,i=e.isDisplayedWithinOfferSearchTab,s=a(c.default.useState(),2),u=s[0],l=s[1];return c.default.useEffect((function(){r(n,void 0,void 0,(function(){var e,n,r,s,c,u,f,m;return o(this,(function(o){switch(o.label){case 0:return[4,Promise.all([v(t),_(t),(0,d.getMerchantWebsiteTrackingConsentSelectors)(t),(0,p.getPostCancellationDeactivationDelaySetting)()])];case 1:return e=a.apply(void 0,[o.sent(),4]),n=e[0],r=e[1],s=e[2],c=e[3],u=!(!n||!function(e,n){var t=e?e.trackingConsentRelatedCookieOrLocalStorageIds:void 0,r=n?n.consentBanner:void 0,o=n?n.acceptAllButton:void 0;return(null==t?void 0:t.length)&&!!r&&!!o}(r,s)||i||function(e){var n=Number(localStorage.getItem(O));if(!n)return!1;var t=e||P;return Date.now()-n<24*t*3600*1e3}(c)),f=s&&null!==(m=s.consentBanner)&&void 0!==m?m:void 0,l({shouldCheckConsentChoiceOnActivationClick:u,trackingConsentRelatedStorageInfo:r,consentBannerSelector:f}),[2]}}))}))}),[t,i]),u},n.checkShouldPromptUserToRetriggerMerchantWebsiteTrackingConsentBanner=function(e,n){return r(this,void 0,void 0,(function(){var t,r,a;return o(this,(function(o){switch(o.label){case 0:return n?(t=n.shouldCheckConsentChoiceOnActivationClick,r=n.trackingConsentRelatedStorageInfo,a=n.consentBannerSelector,t?b()?[2,!1]:[4,(0,f.checkWasMerchantWebsiteTrackingConsentErrorWidgetDisplayedRecently)(e)]:[2,!1]):[2,!1];case 1:return o.sent()?[2,!1]:[2,C(r,a)]}}))}))},n.checkHasUserGivenFullTrackingConsentOnCurrentWebsite=b,n.triggerMerchantWebsiteTrackingConsentBanner=function(e){return r(this,void 0,void 0,(function(){var n,t,r,a,i;return o(this,(function(o){switch(o.label){case 0:return[4,_(e)];case 1:return n=o.sent(),e&&n?(t=n.trackingConsentRelatedCookieOrLocalStorageIds,r=n.isTrackingConsentDataInLocalStorageInsteadOfCookies,a=S({cookieNames:t,shouldRemoveFoundEntries:!0}),i=r?I({localStorageKeys:t,shouldRemoveFoundEntries:!0}):[],localStorage.setItem(A,Date.now().toString()),localStorage.removeItem(d.LAST_DETECTED_TRACKING_CONSENT_CHOICE_STORAGE_KEY),s={offerId:e.offerId,deletedCookieNames:a,deletedLocalStorageKeys:i},(0,m.sendMessageToBackgroundScript)({message:"logUserEvent",data:{event:{type:"merchantWebsiteTrackingConsentBannerTriggered",payload:s}}}),(0,m.sendMessageToBackgroundScript)({message:"logAmplitudeEvent",data:{event:{type:"Browser Extension - Merchant Website Tracking Consent Banner Triggered",properties:s}}}),window.location.reload(),[2]):[2]}var s}))}))};var A="jokoMerchantWebsiteTrackingConsentBannerTriggerRequestedAt";function E(){localStorage.removeItem(A)}function k(){var e=localStorage.getItem(A);return!!e&&Date.now()-parseInt(e)<1e4}n.disableMerchantWebsiteTrackingConsentBannerTriggerRequestMode=E,n.checkIsMerchantWebsiteTrackingConsentBannerTriggerBeingRequested=k,n.handleMerchantWebsiteTrackingConsentBannerTriggeringRequest=function(e){return r(this,void 0,void 0,(function(){var n;return o(this,(function(t){switch(t.label){case 0:return(n=e&&k())?[4,(0,f.checkWasMerchantWebsiteTrackingConsentErrorWidgetDisplayedRecently)(e.offerId)]:[3,2];case 1:n=!t.sent(),t.label=2;case 2:return n?(0,h.submitWidgetDisplayDecision)({widgetName:h.PriorityOrderedWidgetName.merchantWebsiteTrackingConsentErrorWidget,props:{offer:e},shouldDisplayWidget:!0}):(0,h.submitWidgetDisplayDecision)({widgetName:h.PriorityOrderedWidgetName.merchantWebsiteTrackingConsentErrorWidget,shouldDisplayWidget:!1}),[2]}}))}))};var O="jokoMerchantWebsiteTrackingConsentBannerTriggerCancelledAt";n.cancelMerchantWebsiteTrackingConsentBannerTriggeringRequestAndDisplayOfferWidget=function(e){var n;E(),(0,f.clearMerchantWebsiteTrackingConsentErrorWidgetTimeout)(),(0,y.displayOfferWidgetAndLogUserEvent)({offer:e,hasMerchantWebsiteTrackingConsentBannerRequestBeenCancelled:!0}),localStorage.setItem(O,Date.now().toString()),n={offerId:e.offerId},(0,m.sendMessageToBackgroundScript)({message:"logUserEvent",data:{event:{type:"merchantWebsiteTrackingConsentBannerTriggeringCancelled",payload:n}}}),(0,m.sendMessageToBackgroundScript)({message:"logAmplitudeEvent",data:{event:{type:"Browser Extension - Merchant Website Tracking Consent Banner Triggering Cancelled",properties:n}}})};var P=30},62166:function(e,n,t){var r=this&&this.__awaiter||function(e,n,t,r){return new(t||(t=Promise))((function(o,a){function i(e){try{c(r.next(e))}catch(e){a(e)}}function s(e){try{c(r.throw(e))}catch(e){a(e)}}function c(e){var n;e.done?o(e.value):(n=e.value,n instanceof t?n:new t((function(e){e(n)}))).then(i,s)}c((r=r.apply(e,n||[])).next())}))},o=this&&this.__generator||function(e,n){var t,r,o,a,i={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return a={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function s(s){return function(c){return function(s){if(t)throw new TypeError("Generator is already executing.");for(;a&&(a=0,s[0]&&(i=0)),i;)try{if(t=1,r&&(o=2&s[0]?r.return:s[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,s[1])).done)return o;switch(r=0,o&&(s=[2&s[0],o.value]),s[0]){case 0:case 1:o=s;break;case 4:return i.label++,{value:s[1],done:!1};case 5:i.label++,r=s[1],s=[0];continue;case 7:s=i.ops.pop(),i.trys.pop();continue;default:if(!(o=i.trys,(o=o.length>0&&o[o.length-1])||6!==s[0]&&2!==s[0])){i=0;continue}if(3===s[0]&&(!o||s[1]>o[0]&&s[1]<o[3])){i.label=s[1];break}if(6===s[0]&&i.label<o[1]){i.label=o[1],o=s;break}if(o&&i.label<o[2]){i.label=o[2],i.ops.push(s);break}o[2]&&i.ops.pop(),i.trys.pop();continue}s=n.call(e,i)}catch(e){s=[6,e],r=0}finally{t=o=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,c])}}},a=this&&this.__read||function(e,n){var t="function"==typeof Symbol&&e[Symbol.iterator];if(!t)return e;var r,o,a=t.call(e),i=[];try{for(;(void 0===n||n-- >0)&&!(r=a.next()).done;)i.push(r.value)}catch(e){o={error:e}}finally{try{r&&!r.done&&(t=a.return)&&t.call(a)}finally{if(o)throw o.error}}return i};Object.defineProperty(n,"__esModule",{value:!0}),n.getUniqueElementFromSelector=n.getMerchantWebsiteTrackingConsentSelectors=n.handleMerchantWebsiteTrackingConsentDetection=n.LAST_DETECTED_TRACKING_CONSENT_CHOICE_STORAGE_KEY=void 0;var i=t(55015),s=t(50671),c=t(67456),u=t(76688),l=t(46239),d=t(16868);n.LAST_DETECTED_TRACKING_CONSENT_CHOICE_STORAGE_KEY="jokoLastDetectedTrackingConsentChoice";function p(e){var n;return r(this,void 0,void 0,(function(){var t,r;return o(this,(function(o){switch(o.label){case 0:return(null===(n=null==e?void 0:e.browserExtension)||void 0===n?void 0:n.trackingConsent)?[4,f((t=e.browserExtension.trackingConsent).cmpId)]:[2,void 0];case 1:return r=o.sent(),[2,m({trackingConsentSelectorsFromOffer:t.selectors||void 0,trackingConsentSelectorsFromCmp:r})]}}))}))}function f(e){return r(this,void 0,void 0,(function(){var n,t;return o(this,(function(r){switch(r.label){case 0:return e?[4,(0,c.getMerchantWebsiteTrackingConsentCmpDataSettings)()]:[2,void 0];case 1:return(null==(n=r.sent())?void 0:n[e])?[2,(t=n[e])?t.selectors:void 0]:[2,void 0]}}))}))}function m(e){var n=e.trackingConsentSelectorsFromOffer,t=e.trackingConsentSelectorsFromCmp;if(n||t)return t?n?{consentBanner:n.consentBanner||t.consentBanner,acceptAllButton:n.acceptAllButton||t.acceptAllButton,rejectAllButton:n.rejectAllButton||t.rejectAllButton,customChoiceButton:n.customChoiceButton||t.customChoiceButton}:t:n}function y(e,n,t){var r,o;try{var a=h(null!==(r=n.consentBanner)&&void 0!==r?r:void 0);if(!a)return;clearInterval(t);var c=function(e,n){var t,r,o,a=h(null!==(t=n.acceptAllButton)&&void 0!==t?t:void 0),i=!!a&&e.contains(a),s=h(null!==(r=n.rejectAllButton)&&void 0!==r?r:void 0),c=!!s&&e.contains(s),u=h(null!==(o=n.customChoiceButton)&&void 0!==o?o:void 0),l=!!u&&e.contains(u);return{acceptAllButtonElement:i?a:void 0,rejectAllButtonElement:c?s:void 0,customChoiceButtonElement:l?u:void 0}}(a,n),u=c.acceptAllButtonElement,d=c.rejectAllButtonElement,p=c.customChoiceButtonElement;o={offerId:e.offerId,wasAcceptAllButtonFound:!!u,wasRejectAllButtonFound:!!d,wasCustomChoiceButtonFound:!!p},(0,l.sendMessageToBackgroundScript)({message:"logUserEvent",data:{event:{type:"merchantWebsiteTrackingConsentBannerDetected",payload:o}}}),(0,l.sendMessageToBackgroundScript)({message:"logAmplitudeEvent",data:{event:{type:"Browser Extension - Merchant Website Tracking Consent Banner Detected",properties:o}}}),_(u,i.TrackingConsentChoice.acceptAll,e),_(d,i.TrackingConsentChoice.rejectAll,e),_(p,i.TrackingConsentChoice.customChoice,e),!u&&(0,s.checkIsMerchantWebsiteTrackingConsentBannerTriggerBeingRequested)()&&(0,s.cancelMerchantWebsiteTrackingConsentBannerTriggeringRequestAndDisplayOfferWidget)(e)}catch(e){console.error("Error while detecting tracking-consent banner and buttons: ".concat(e))}}function h(e){if(e){var n=document.querySelectorAll(e);if(1===n.length)return n[0]}}n.handleMerchantWebsiteTrackingConsentDetection=function(e){return r(this,void 0,void 0,(function(){var n,t,r,i,u,l,d;return o(this,(function(o){switch(o.label){case 0:return e?[4,Promise.all([p(e),(0,c.getMerchantWebsiteTrackingConsentBannerDetectionSettings)({defaultDetectionIntervalInMs:500,defaultDetectionAttemptsNumber:5})])]:[2];case 1:return n=a.apply(void 0,[o.sent(),2]),t=n[0],r=n[1],i=r.detectionIntervalInMs,u=r.detectionAttemptsNumber,t?(l=0,d=setInterval((function(){++l<=u?y(e,t,d):(clearInterval(d),(0,s.checkIsMerchantWebsiteTrackingConsentBannerTriggerBeingRequested)()&&(0,s.cancelMerchantWebsiteTrackingConsentBannerTriggeringRequestAndDisplayOfferWidget)(e))}),i),y(e,t,d),[2]):[2]}}))}))},n.getMerchantWebsiteTrackingConsentSelectors=p,n.getUniqueElementFromSelector=h;var v={};function _(e,t,r){if(e){var o=v[t];if(o)e.removeEventListener("click",o),e.addEventListener("click",o);else{var a=function(e,t){return function(){var r;if(localStorage.setItem(n.LAST_DETECTED_TRACKING_CONSENT_CHOICE_STORAGE_KEY,e),r={trackingConsentChoice:e,offerId:t.offerId},(0,l.sendMessageToBackgroundScript)({message:"logUserEvent",data:{event:{type:"merchantWebsiteTrackingConsentChoiceDetected",payload:r}}}),(0,l.sendMessageToBackgroundScript)({message:"logAmplitudeEvent",data:{event:{type:"Browser Extension - Merchant Website Tracking Consent Choice Detected",properties:r}}}),(0,s.checkIsMerchantWebsiteTrackingConsentBannerTriggerBeingRequested)()||(0,u.checkIsMerchantWebsiteTrackingConsentErrorWidgetMounted)()){if((0,s.disableMerchantWebsiteTrackingConsentBannerTriggerRequestMode)(),(0,u.clearMerchantWebsiteTrackingConsentErrorWidgetTimeout)(),e===i.TrackingConsentChoice.acceptAll)return(0,u.unmountMerchantWebsiteTrackingConsentErrorWidget)(),void(0,d.displayOfferWidgetAndLogUserEvent)({offer:t,hasUserJustCorrectedMerchantWebsiteTrackingConsentChoice:!0});(0,u.checkIsMerchantWebsiteTrackingConsentErrorWidgetMounted)()||(0,u.displayMerchantWebsiteTrackingConsentSuggestionWidget)({offer:t})}}}(t,r);v[t]=a,e.addEventListener("click",a)}}}},67456:function(e,n,t){var r=this&&this.__awaiter||function(e,n,t,r){return new(t||(t=Promise))((function(o,a){function i(e){try{c(r.next(e))}catch(e){a(e)}}function s(e){try{c(r.throw(e))}catch(e){a(e)}}function c(e){var n;e.done?o(e.value):(n=e.value,n instanceof t?n:new t((function(e){e(n)}))).then(i,s)}c((r=r.apply(e,n||[])).next())}))},o=this&&this.__generator||function(e,n){var t,r,o,a,i={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return a={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function s(s){return function(c){return function(s){if(t)throw new TypeError("Generator is already executing.");for(;a&&(a=0,s[0]&&(i=0)),i;)try{if(t=1,r&&(o=2&s[0]?r.return:s[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,s[1])).done)return o;switch(r=0,o&&(s=[2&s[0],o.value]),s[0]){case 0:case 1:o=s;break;case 4:return i.label++,{value:s[1],done:!1};case 5:i.label++,r=s[1],s=[0];continue;case 7:s=i.ops.pop(),i.trys.pop();continue;default:if(!(o=i.trys,(o=o.length>0&&o[o.length-1])||6!==s[0]&&2!==s[0])){i=0;continue}if(3===s[0]&&(!o||s[1]>o[0]&&s[1]<o[3])){i.label=s[1];break}if(6===s[0]&&i.label<o[1]){i.label=o[1],o=s;break}if(o&&i.label<o[2]){i.label=o[2],i.ops.push(s);break}o[2]&&i.ops.pop(),i.trys.pop();continue}s=n.call(e,i)}catch(e){s=[6,e],r=0}finally{t=o=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,c])}}};Object.defineProperty(n,"__esModule",{value:!0}),n.getPostCancellationDeactivationDelaySetting=n.getDelayBeforeMerchantWebsiteTrackingConsentErrorWidgetDisplayInSecondsSetting=n.getMerchantWebsiteTrackingConsentCmpDataSettings=n.getMerchantWebsiteTrackingConsentBannerDetectionSettings=void 0;var a=t(55015);n.getMerchantWebsiteTrackingConsentBannerDetectionSettings=function(e){var n=e.defaultDetectionIntervalInMs,t=e.defaultDetectionAttemptsNumber;return r(this,void 0,void 0,(function(){var e,r,i;return o(this,(function(o){switch(o.label){case 0:return[4,(0,a.getSetting)(a.SettingKey.trackingConsentSettings)];case 1:return(e=o.sent())?(r=e.consentBannerDetectionIntervalInMs?e.consentBannerDetectionIntervalInMs:n,i=e.consentBannerDetectionAttemptsNumber?e.consentBannerDetectionAttemptsNumber:t,[2,{detectionIntervalInMs:r,detectionAttemptsNumber:i}]):[2,{detectionIntervalInMs:n,detectionAttemptsNumber:t}]}}))}))},n.getMerchantWebsiteTrackingConsentCmpDataSettings=function(){return r(this,void 0,void 0,(function(){var e;return o(this,(function(n){switch(n.label){case 0:return[4,(0,a.getSetting)(a.SettingKey.trackingConsentSettings)];case 1:return(null==(e=n.sent())?void 0:e.cmpData)?[2,e.cmpData]:[2,void 0]}}))}))},n.getDelayBeforeMerchantWebsiteTrackingConsentErrorWidgetDisplayInSecondsSetting=function(){return r(this,void 0,void 0,(function(){var e;return o(this,(function(n){switch(n.label){case 0:return[4,(0,a.getSetting)(a.SettingKey.trackingConsentSettings)];case 1:return(null==(e=n.sent())?void 0:e.delayBeforeTrackingConsentErrorWidgetDisplayInSeconds)?[2,e.delayBeforeTrackingConsentErrorWidgetDisplayInSeconds]:[2,void 0]}}))}))},n.getPostCancellationDeactivationDelaySetting=function(){return r(this,void 0,void 0,(function(){var e;return o(this,(function(n){switch(n.label){case 0:return[4,(0,a.getSetting)(a.SettingKey.trackingConsentSettings)];case 1:return(null==(e=n.sent())?void 0:e.postCancellationDeactivationDelayInDays)?[2,e.postCancellationDeactivationDelayInDays]:[2,void 0]}}))}))}},76688:function(e,n,t){var r=this&&this.__assign||function(){return r=Object.assign||function(e){for(var n,t=1,r=arguments.length;t<r;t++)for(var o in n=arguments[t])Object.prototype.hasOwnProperty.call(n,o)&&(e[o]=n[o]);return e},r.apply(this,arguments)},o=this&&this.__awaiter||function(e,n,t,r){return new(t||(t=Promise))((function(o,a){function i(e){try{c(r.next(e))}catch(e){a(e)}}function s(e){try{c(r.throw(e))}catch(e){a(e)}}function c(e){var n;e.done?o(e.value):(n=e.value,n instanceof t?n:new t((function(e){e(n)}))).then(i,s)}c((r=r.apply(e,n||[])).next())}))},a=this&&this.__generator||function(e,n){var t,r,o,a,i={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return a={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function s(s){return function(c){return function(s){if(t)throw new TypeError("Generator is already executing.");for(;a&&(a=0,s[0]&&(i=0)),i;)try{if(t=1,r&&(o=2&s[0]?r.return:s[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,s[1])).done)return o;switch(r=0,o&&(s=[2&s[0],o.value]),s[0]){case 0:case 1:o=s;break;case 4:return i.label++,{value:s[1],done:!1};case 5:i.label++,r=s[1],s=[0];continue;case 7:s=i.ops.pop(),i.trys.pop();continue;default:if(!(o=i.trys,(o=o.length>0&&o[o.length-1])||6!==s[0]&&2!==s[0])){i=0;continue}if(3===s[0]&&(!o||s[1]>o[0]&&s[1]<o[3])){i.label=s[1];break}if(6===s[0]&&i.label<o[1]){i.label=o[1],o=s;break}if(o&&i.label<o[2]){i.label=o[2],i.ops.push(s);break}o[2]&&i.ops.pop(),i.trys.pop();continue}s=n.call(e,i)}catch(e){s=[6,e],r=0}finally{t=o=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,c])}}},i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(n,"__esModule",{value:!0}),n.logClickedMerchantWebsiteTrackingConsentWidgetCloseButtonEvents=n.logClickedMerchantWebsiteTrackingConsentWidgetButtonEvents=n.checkWasMerchantWebsiteTrackingConsentErrorWidgetDisplayedRecently=n.checkIsMerchantWebsiteTrackingConsentErrorWidgetMounted=n.unmountMerchantWebsiteTrackingConsentErrorWidget=n.clearMerchantWebsiteTrackingConsentErrorWidgetTimeout=n.displayMerchantWebsiteTrackingConsentErrorWidgetWithTimeout=n.displayMerchantWebsiteTrackingConsentSuggestionWidget=void 0;var s=i(t(96540)),c=i(t(40961)),u=i(t(95093)),l=t(55015),d=t(7444),p=t(17621),f=t(50671),m=t(67456),y=t(46239),h=i(t(96394)),v=i(t(8042));function _(e,n){var t=(0,l.getCurrentUrlHostname)(),r={widgetType:n,offerId:e,widgetDisplayedTimestampInMs:Date.now(),timeToDisplayWidgetAfterPageLoadingStart:Date.now()-performance.timeOrigin,currentUrlHostname:t};(0,y.sendMessageToBackgroundScript)({message:"logUserEvent",data:{event:{type:"browserExtensionWidgetDisplayed",payload:r}}}),(0,y.sendMessageToBackgroundScript)({message:"logAmplitudeEvent",data:{event:{type:"Browser Extension - Widget Displayed",properties:r}}})}n.displayMerchantWebsiteTrackingConsentSuggestionWidget=function(e){return o(this,void 0,void 0,(function(){var n,t,o;return a(this,(function(a){switch(a.label){case 0:return n=(0,p.getHashedElementId)(p.JokoExtensionRootElement.merchantWebsiteTrackingConsentSuggestionWidget),(t=document.createElement("div")).id=n,document.documentElement.appendChild(t),[4,(0,d.getUserFeaturesMapWithTimeout)()];case 1:return o=a.sent(),c.default.render(s.default.createElement(l.FeaturesContextProvider,{initialUserFeaturesMap:o},s.default.createElement(v.default,r({},e))),t),_(e.offer.offerId,"merchantWebsiteTrackingConsentSuggestion"),[2]}}))}))};var g={timeoutId:void 0};function b(){return o(this,void 0,void 0,(function(){var e;return a(this,(function(n){switch(n.label){case 0:return[4,(0,m.getDelayBeforeMerchantWebsiteTrackingConsentErrorWidgetDisplayInSecondsSetting)()];case 1:return void 0===(e=n.sent())||"number"!=typeof e?[2,10]:[2,e]}}))}))}function C(){var e=(0,p.getHashedElementId)(p.JokoExtensionRootElement.merchantWebsiteTrackingConsentErrorWidget);return document.getElementById(e)}n.displayMerchantWebsiteTrackingConsentErrorWidgetWithTimeout=function(e){return o(this,void 0,void 0,(function(){var n,t,i;return a(this,(function(u){switch(u.label){case 0:return[4,b()];case 1:return-1!==(n=u.sent())&&(0,f.checkIsMerchantWebsiteTrackingConsentBannerTriggerBeingRequested)()?((0,l.updateLocalStorageItem)(l.LocalStorageKey.merchantWebsiteTrackingConsentErrorWidgetLastDisplayAtByOfferIdMap,((i={})[e.offer.offerId]=Date.now(),i)),t=setTimeout((function(){!function(e){o(this,void 0,void 0,(function(){var n,t,o;return a(this,(function(a){switch(a.label){case 0:return n=(0,p.getHashedElementId)(p.JokoExtensionRootElement.merchantWebsiteTrackingConsentErrorWidget),(t=document.createElement("div")).id=n,document.documentElement.appendChild(t),[4,(0,d.getUserFeaturesMapWithTimeout)()];case 1:return o=a.sent(),c.default.render(s.default.createElement(l.FeaturesContextProvider,{initialUserFeaturesMap:o},s.default.createElement(h.default,r({},e))),t),_(e.offer.offerId,"merchantWebsiteTrackingConsentError"),[2]}}))}))}(e),g.timeoutId=void 0}),1e3*n),g.timeoutId=t,[2]):[2]}}))}))},n.clearMerchantWebsiteTrackingConsentErrorWidgetTimeout=function(){if(g){var e=g.timeoutId;e&&(clearTimeout(e),g.timeoutId=void 0)}},n.unmountMerchantWebsiteTrackingConsentErrorWidget=function(){var e=C();null!==e&&(c.default.unmountComponentAtNode(e),e.remove())},n.checkIsMerchantWebsiteTrackingConsentErrorWidgetMounted=function(){return!!C()};n.checkWasMerchantWebsiteTrackingConsentErrorWidgetDisplayedRecently=function(e){return o(this,void 0,void 0,(function(){var n;return a(this,(function(t){switch(t.label){case 0:return[4,(0,l.getLocalStorageItem)(l.LocalStorageKey.merchantWebsiteTrackingConsentErrorWidgetLastDisplayAtByOfferIdMap)];case 1:return(null==(n=t.sent())?void 0:n[e])?[2,(0,u.default)().diff((0,u.default)(n[e]),"days")<7]:[2,!1]}}))}))},n.logClickedMerchantWebsiteTrackingConsentWidgetButtonEvents=function(e,n,t){var r={offerId:e,widgetType:n,buttonType:t};(0,y.sendMessageToBackgroundScript)({message:"logUserEvent",data:{event:{type:"clickedMerchantWebsiteTrackingConsentWidgetButton",payload:r}}}),(0,y.sendMessageToBackgroundScript)({message:"logAmplitudeEvent",data:{event:{type:"Browser Extension - Clicked Merchant Website Tracking Consent Widget Button",properties:r}}})},n.logClickedMerchantWebsiteTrackingConsentWidgetCloseButtonEvents=function(e,n){var t={offerId:e,widgetType:n};(0,y.sendMessageToBackgroundScript)({message:"logUserEvent",data:{event:{type:"closedBrowserExtensionWidget",payload:t}}}),(0,y.sendMessageToBackgroundScript)({message:"logAmplitudeEvent",data:{event:{type:"Browser Extension - Widget Closed",properties:t}}})}},81082:(e,n,t)=>{Object.defineProperty(n,"__esModule",{value:!0}),n.sendMessageThroughPort=n.setContentScriptPortMessageListener=void 0;var r=t(22831),o=chrome.runtime.connect({name:"contentScriptPort|".concat(Date.now())});n.setContentScriptPortMessageListener=function(){var e=function(e){var n=a.get(e.messageId);null==n||n(e.response),a.delete(e.messageId)};o.onMessage.removeListener(e),o.onMessage.addListener(e)};var a=new Map;n.sendMessageThroughPort=function(e,n){var t=(0,r.v4)();n&&a.set(t,n),o.postMessage({messageId:t,message:e})}},46239:function(e,n,t){var r=this&&this.__awaiter||function(e,n,t,r){return new(t||(t=Promise))((function(o,a){function i(e){try{c(r.next(e))}catch(e){a(e)}}function s(e){try{c(r.throw(e))}catch(e){a(e)}}function c(e){var n;e.done?o(e.value):(n=e.value,n instanceof t?n:new t((function(e){e(n)}))).then(i,s)}c((r=r.apply(e,n||[])).next())}))},o=this&&this.__generator||function(e,n){var t,r,o,a,i={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return a={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function s(s){return function(c){return function(s){if(t)throw new TypeError("Generator is already executing.");for(;a&&(a=0,s[0]&&(i=0)),i;)try{if(t=1,r&&(o=2&s[0]?r.return:s[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,s[1])).done)return o;switch(r=0,o&&(s=[2&s[0],o.value]),s[0]){case 0:case 1:o=s;break;case 4:return i.label++,{value:s[1],done:!1};case 5:i.label++,r=s[1],s=[0];continue;case 7:s=i.ops.pop(),i.trys.pop();continue;default:if(!(o=i.trys,(o=o.length>0&&o[o.length-1])||6!==s[0]&&2!==s[0])){i=0;continue}if(3===s[0]&&(!o||s[1]>o[0]&&s[1]<o[3])){i.label=s[1];break}if(6===s[0]&&i.label<o[1]){i.label=o[1],o=s;break}if(o&&i.label<o[2]){i.label=o[2],i.ops.push(s);break}o[2]&&i.ops.pop(),i.trys.pop();continue}s=n.call(e,i)}catch(e){s=[6,e],r=0}finally{t=o=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,c])}}},a=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(n,"__esModule",{value:!0}),n.sendMessageToBackgroundScript=void 0;var i=a(t(2543)),s=t(55015),c=t(25841),u=t(81082);n.sendMessageToBackgroundScript=function(e,n){return r(this,void 0,void 0,(function(){return o(this,(function(t){switch(t.label){case 0:return[4,d()];case 1:return t.sent()?(0,u.sendMessageThroughPort)(e,n):chrome.runtime.sendMessage(e,{},(function(e){return null==n?void 0:n(e)})),[2]}}))}))};var l=["17.3","17.4","17.5"],d=i.default.once((function(){return r(void 0,void 0,void 0,(function(){var e,n;return o(this,(function(t){switch(t.label){case 0:return s.browserKind!==s.Browser.safari?[2,!1]:(e=(0,c.getSafariMajorAndMinorOsVersion)())&&l.some((function(n){return e.startsWith(n)}))?[4,(0,s.getLocalStorageItem)(s.LocalStorageKey.userFeaturesMap)]:[2,!1];case 1:return[2,!!(null==(n=t.sent())?void 0:n[s.Feature.sendMessagesThroughPortMobileBrowserExtension])]}}))}))}))},22991:function(e,n,t){var r=this&&this.__read||function(e,n){var t="function"==typeof Symbol&&e[Symbol.iterator];if(!t)return e;var r,o,a=t.call(e),i=[];try{for(;(void 0===n||n-- >0)&&!(r=a.next()).done;)i.push(r.value)}catch(e){o={error:e}}finally{try{r&&!r.done&&(t=a.return)&&t.call(a)}finally{if(o)throw o.error}}return i},o=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(n,"__esModule",{value:!0}),n.useOnClickAlternativeOffer=n.useAlternativeOffers=void 0;var a=o(t(96540)),i=t(55015),s=t(77653),c=t(46239),u=t(89710),l=t(23081);n.useAlternativeOffers=function(e){var n=r(a.default.useState(void 0),2),t=n[0],o=n[1];return a.default.useEffect((function(){e.length&&(0,s.getMerchantOffersWithConditionsAndCouponsFromOfferIds)(e).then(o)}),[]),t},n.useOnClickAlternativeOffer=function(e){var n=e.currentWebpageOfferId,t=e.userInterfaceComponentInteractionEventType;return function(e){switch(e.type){case i.OfferType.Online:(0,c.sendMessageToBackgroundScript)({message:"openUniversalOnlineOfferActivationInterstitial",data:{offerId:e.offerId,shouldOpenInCurrentTab:!1,triggeringEventType:t}});break;case i.OfferType.OneTime:if(!e.website)return;(0,u.handleUserInterfaceComponentInteractionInBackgroundOrLoadTrackingLink)({offer:e,triggeringEventType:t}),(0,l.logClickedWebsiteLinkEvents)(e.offerId),window.open(e.website,"_blank")}var r=t===i.UserInterfaceComponentInteractionEventType.alternativeOffersWidgetBrowsedAlternativeOffer?"alternativeOffersWidget":"panelAlternativeOffersSection";!function(e){var n=e.currentWebpageOfferId,t=e.alternativeOfferId,r=e.fromComponent,o={currentWebpageOfferId:n,alternativeOfferId:t,fromComponent:r};(0,c.sendMessageToBackgroundScript)({message:"logUserEvent",data:{event:{type:"clickedAlternativeOffer",payload:o}}}),(0,c.sendMessageToBackgroundScript)({message:"logAmplitudeEvent",data:{event:{type:"Offers - Clicked Alternative Offer",properties:o}}})}({currentWebpageOfferId:n,alternativeOfferId:e.offerId,fromComponent:r})}}},4135:function(e,n,t){var r=this&&this.__assign||function(){return r=Object.assign||function(e){for(var n,t=1,r=arguments.length;t<r;t++)for(var o in n=arguments[t])Object.prototype.hasOwnProperty.call(n,o)&&(e[o]=n[o]);return e},r.apply(this,arguments)},o=this&&this.__awaiter||function(e,n,t,r){return new(t||(t=Promise))((function(o,a){function i(e){try{c(r.next(e))}catch(e){a(e)}}function s(e){try{c(r.throw(e))}catch(e){a(e)}}function c(e){var n;e.done?o(e.value):(n=e.value,n instanceof t?n:new t((function(e){e(n)}))).then(i,s)}c((r=r.apply(e,n||[])).next())}))},a=this&&this.__generator||function(e,n){var t,r,o,a,i={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return a={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function s(s){return function(c){return function(s){if(t)throw new TypeError("Generator is already executing.");for(;a&&(a=0,s[0]&&(i=0)),i;)try{if(t=1,r&&(o=2&s[0]?r.return:s[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,s[1])).done)return o;switch(r=0,o&&(s=[2&s[0],o.value]),s[0]){case 0:case 1:o=s;break;case 4:return i.label++,{value:s[1],done:!1};case 5:i.label++,r=s[1],s=[0];continue;case 7:s=i.ops.pop(),i.trys.pop();continue;default:if(!(o=i.trys,(o=o.length>0&&o[o.length-1])||6!==s[0]&&2!==s[0])){i=0;continue}if(3===s[0]&&(!o||s[1]>o[0]&&s[1]<o[3])){i.label=s[1];break}if(6===s[0]&&i.label<o[1]){i.label=o[1],o=s;break}if(o&&i.label<o[2]){i.label=o[2],i.ops.push(s);break}o[2]&&i.ops.pop(),i.trys.pop();continue}s=n.call(e,i)}catch(e){s=[6,e],r=0}finally{t=o=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,c])}}},i=this&&this.__read||function(e,n){var t="function"==typeof Symbol&&e[Symbol.iterator];if(!t)return e;var r,o,a=t.call(e),i=[];try{for(;(void 0===n||n-- >0)&&!(r=a.next()).done;)i.push(r.value)}catch(e){o={error:e}}finally{try{r&&!r.done&&(t=a.return)&&t.call(a)}finally{if(o)throw o.error}}return i},s=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(n,"__esModule",{value:!0}),n.useOnClickSnoozeCashbackNotActivatedIndicator=n.checkWasCashbackNotActivatedIndicatorSnoozedRecentlyForOffer=n.useCashbackNotActivatedIndicator=void 0;var c=s(t(96540)),u=t(55015),l=t(46239),d=t(98444);n.useCashbackNotActivatedIndicator=function(e){var n=e.isMobileExtension,t=e.offerId,r=e.offerType,o=e.isOfferActivated,a=i(c.default.useState(!1),2),s=a[0],l=a[1],p=(0,u.useHasFeatureByPlatform)({isMobileExtension:n,desktopFeature:u.Feature.sideButtonRedBadgeForNotActivatedCashbackDesktopBrowserExtension,mobileFeature:u.Feature.sideButtonRedBadgeForNotActivatedCashbackMobileBrowserExtension}),m=i(c.default.useState(!1),2),y=m[0],h=m[1];c.default.useEffect((function(){f(t).then(h)}),[t]);var v=(0,d.useWasCashbackOfferActivationOverriddenByCompetitorRecently)(t);return c.default.useEffect((function(){l(p&&r===u.OfferType.Online&&!y&&(!1===o||v))}),[p,o,r,v]),{shouldDisplayCashbackNotActivatedIndicator:s,setShouldDisplayCashbackNotActivatedIndicator:l}};var p=24;function f(e){var n;return o(this,void 0,void 0,(function(){var t,r;return a(this,(function(o){switch(o.label){case 0:return e?[4,(0,u.getLocalStorageItem)(u.LocalStorageKey.cashbackNotActivatedIndicatorLastSnoozedAtByOfferIdMap)]:[2,!1];case 1:return t=o.sent(),[4,(0,u.getSetting)(u.SettingKey.cashbackNotActivatedIndicatorDisplayCooldownInHours)];case 2:return r=null!==(n=o.sent())&&void 0!==n?n:p,[2,!!((null==t?void 0:t[e])&&Date.now()-t[e]<36e5*r)]}}))}))}n.checkWasCashbackNotActivatedIndicatorSnoozedRecentlyForOffer=f,n.useOnClickSnoozeCashbackNotActivatedIndicator=function(e,n){var t=this;return function(){return o(t,void 0,void 0,(function(){var t,o;return a(this,(function(a){switch(a.label){case 0:return n(!1),[4,(0,u.getLocalStorageItem)(u.LocalStorageKey.cashbackNotActivatedIndicatorLastSnoozedAtByOfferIdMap)];case 1:return t=a.sent(),[4,(0,u.setLocalStorageItem)(u.LocalStorageKey.cashbackNotActivatedIndicatorLastSnoozedAtByOfferIdMap,r(r({},t),(o={},o[e]=Date.now(),o)))];case 2:return a.sent(),(0,l.sendMessageToBackgroundScript)({message:"logUserEvent",data:{event:{type:"snoozedCashbackNotActivatedIndicator",payload:{offerId:e}}}}),[2]}}))}))}}},69568:function(e,n,t){var r=this&&this.__assign||function(){return r=Object.assign||function(e){for(var n,t=1,r=arguments.length;t<r;t++)for(var o in n=arguments[t])Object.prototype.hasOwnProperty.call(n,o)&&(e[o]=n[o]);return e},r.apply(this,arguments)},o=this&&this.__awaiter||function(e,n,t,r){return new(t||(t=Promise))((function(o,a){function i(e){try{c(r.next(e))}catch(e){a(e)}}function s(e){try{c(r.throw(e))}catch(e){a(e)}}function c(e){var n;e.done?o(e.value):(n=e.value,n instanceof t?n:new t((function(e){e(n)}))).then(i,s)}c((r=r.apply(e,n||[])).next())}))},a=this&&this.__generator||function(e,n){var t,r,o,a,i={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return a={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function s(s){return function(c){return function(s){if(t)throw new TypeError("Generator is already executing.");for(;a&&(a=0,s[0]&&(i=0)),i;)try{if(t=1,r&&(o=2&s[0]?r.return:s[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,s[1])).done)return o;switch(r=0,o&&(s=[2&s[0],o.value]),s[0]){case 0:case 1:o=s;break;case 4:return i.label++,{value:s[1],done:!1};case 5:i.label++,r=s[1],s=[0];continue;case 7:s=i.ops.pop(),i.trys.pop();continue;default:if(!(o=i.trys,(o=o.length>0&&o[o.length-1])||6!==s[0]&&2!==s[0])){i=0;continue}if(3===s[0]&&(!o||s[1]>o[0]&&s[1]<o[3])){i.label=s[1];break}if(6===s[0]&&i.label<o[1]){i.label=o[1],o=s;break}if(o&&i.label<o[2]){i.label=o[2],i.ops.push(s);break}o[2]&&i.ops.pop(),i.trys.pop();continue}s=n.call(e,i)}catch(e){s=[6,e],r=0}finally{t=o=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,c])}}},i=this&&this.__read||function(e,n){var t="function"==typeof Symbol&&e[Symbol.iterator];if(!t)return e;var r,o,a=t.call(e),i=[];try{for(;(void 0===n||n-- >0)&&!(r=a.next()).done;)i.push(r.value)}catch(e){o={error:e}}finally{try{r&&!r.done&&(t=a.return)&&t.call(a)}finally{if(o)throw o.error}}return i},s=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(n,"__esModule",{value:!0}),n.CASHBACK_ACTIVATION_ANIMATION_DURATION_IN_MS=n.displayOfferActivationInterstitial=n.checkWasOfferActivatedRecentlyFromLocalOrSessionStorage=n.useOfferActivationState=n.useOfferActivationButtonState=n.LOADING_INDICATOR_DISPLAY_TIME_IN_MS=n.OFFER_ACTIVATION_DURATION_HOURS=void 0;var c=s(t(96540)),u=s(t(40961)),l=t(55015),d=t(37392),p=t(17621),f=t(32668),m=t(50671),y=t(76688),h=t(46239),v=t(89710),_=t(32221),g=s(t(40549)),b=s(t(97599));n.OFFER_ACTIVATION_DURATION_HOURS=1,n.LOADING_INDICATOR_DISPLAY_TIME_IN_MS=1e3;var C="jokoLastOfferActivationInCurrentSessionTimestampInMs";function S(e){var n=this,t=e.offer,r=e.shouldUpdateStateOnJokoOfferActivatedDomEvent,s=e.shouldSyncWithWebpageSessionStorage,u=i(c.default.useState(void 0),2),l=u[0],p=u[1];return c.default.useEffect((function(){if(t){o(n,void 0,void 0,s?function(){return a(this,(function(e){switch(e.label){case 0:return[4,T(t)];case 1:return e.sent()?p(!0):p(!1),[2]}}))}:function(){return a(this,(function(e){switch(e.label){case 0:return[4,I(t)];case 1:return e.sent()?p(!0):p(!1),[2]}}))})}}),[t]),c.default.useEffect((function(){if(r){var e=(0,d.setJokoDomEventListener)(d.JokoDomEvent.onOfferActivated,(function(e){var n=e.offerId;(null==t?void 0:t.offerId)===n&&p(!0)}));return function(){return(0,d.removeJokoDomEventListener)(d.JokoDomEvent.onOfferActivated,e)}}}),[]),{isOfferActivated:l,setIsOfferActivated:p}}function T(e,t){return o(this,void 0,void 0,(function(){var r;return a(this,(function(o){switch(o.label){case 0:return e?(r=function(e){var t=sessionStorage.getItem(C),r=t?Number(t):void 0,o=null!=e?e:36e5*n.OFFER_ACTIVATION_DURATION_HOURS;if(r&&Date.now()-r<o)return!0}(t),r?[3,2]:[4,I(e,t)]):[2,!1];case 1:r=o.sent(),o.label=2;case 2:return r?[2,!0]:[2,!1]}}))}))}function I(e,t){return o(this,void 0,void 0,(function(){var r,o;return a(this,(function(a){switch(a.label){case 0:return e?[4,(0,l.getLocalStorageItem)(l.LocalStorageKey.offerActivatedInSessionTimestampMsMap)]:[2,!1];case 1:return(null==(r=a.sent())?void 0:r[e.offerId])?(o=null!=t?t:36e5*n.OFFER_ACTIVATION_DURATION_HOURS,Date.now()-r[e.offerId]<o?[2,!0]:[2,!1]):[2,!1]}}))}))}function A(e){var n=e.offer,t=e.onCloseOfferActivationInterstitial,o=e.shouldAcknowledgeCookieWarning,a=document.createElement("div");a.id=(0,p.getHashedElementId)(p.JokoExtensionRootElement.offerCashbackActivationInterstitial),document.documentElement.appendChild(a),u.default.render(c.default.createElement(g.default,null,c.default.createElement(b.default,r({},{offer:n,shouldAcknowledgeCookieWarning:o},{onClose:function(){null==t||t(),a.remove()}}))),a)}n.useOfferActivationButtonState=function(e){var t=this,r=e.offer,s=e.userInterfaceComponentInteractionEventType,u=e.isDisplayedWithinOfferSearchTab,p=e.isBrowsingCurrentWebpageOffer,g=e.closeWidgetOrPanel,b=e.wasCashbackActivationOverriddenByThirdParty,T=e.isWidgetOpenedAfterMerchantWebsiteTrackingConsentFlow,I=(0,f.checkIsOnMobileScreen)(),k=(0,l.useHasFeatureByPlatform)({isMobileExtension:I,mobileFeature:l.Feature.cashbackActivationAnimation1BDesktopBrowserExtension,desktopFeature:l.Feature.cashbackActivationAnimation1BDesktopBrowserExtension}),O=function(e){var t=e.offer,r=e.userInterfaceComponentInteractionEventType,o=e.isDisplayedWithinOfferSearchTab,a=e.closeWidgetOrPanel,s=e.wasCashbackActivationOverriddenByThirdParty,u=e.isWidgetOpenedAfterMerchantWebsiteTrackingConsentFlow,d=S({offer:t,shouldSyncWithWebpageSessionStorage:!0}),p=d.isOfferActivated,f=d.setIsOfferActivated,m=i(c.default.useState(!1),2),y=m[0],h=m[1],v=function(){o||(sessionStorage.setItem(C,Date.now().toString()),h(!0))},_=c.default.useMemo((function(){var e=sessionStorage.getItem(C);if(e&&!o)return Number(e)}),[y,p]);return c.default.useEffect((function(){var e;return y&&(e=setTimeout((function(){h(!1),f(!0)}),n.LOADING_INDICATOR_DISPLAY_TIME_IN_MS-(_?Date.now()-_:0))),function(){e&&clearTimeout(e)}}),[y,_]),c.default.useEffect((function(){var e;return y||!p||s||u||(e=setTimeout((function(){r!==l.UserInterfaceComponentInteractionEventType.offerWidgetActivateButton&&r!==l.UserInterfaceComponentInteractionEventType.cashbackReminderWidgetActivateButton||null==a||a()}),1e3)),function(){e&&clearTimeout(e)}}),[y,p]),c.default.useEffect((function(){y||p||!_||s||(Date.now()-_<n.LOADING_INDICATOR_DISPLAY_TIME_IN_MS?h(!0):Date.now()-_<36e5*n.OFFER_ACTIVATION_DURATION_HOURS&&f(!0))}),[_,y,y]),{isOfferActivated:p,isOfferActivationButtonLoading:y,recordOfferActivationInCurrentSession:v}}({offer:r,userInterfaceComponentInteractionEventType:s,isDisplayedWithinOfferSearchTab:u,closeWidgetOrPanel:g,wasCashbackActivationOverriddenByThirdParty:b,isWidgetOpenedAfterMerchantWebsiteTrackingConsentFlow:T}),P=O.isOfferActivated,w=O.isOfferActivationButtonLoading,L=O.recordOfferActivationInCurrentSession,B=(0,m.useMerchantWebsiteTrackingConsentBannerTriggeringInformation)({offer:r,isDisplayedWithinOfferSearchTab:u}),N=c.default.useMemo((function(){return(0,m.checkHasUserGivenFullTrackingConsentOnCurrentWebsite)()}),[]),M=(0,v.useShouldUseBackgroundAffiliateLinkLoading)({offer:r,userInterfaceComponentInteractionEventType:s}),R=M.shouldUseBackgroundAffiliateLinkLoading,D=M.shouldDisplayOfferActivationInterstitialForBackgroundAffiliateLinkLoading;return{isOfferActivationButtonLoading:w,isOfferActivated:P,onClickActivateOffer:function(){return o(t,void 0,void 0,(function(){var e,t,o,i,c;return a(this,(function(a){switch(a.label){case 0:return r?(e=r.offerId,f={offerId:e,from:s},(0,h.sendMessageToBackgroundScript)({message:"logUserEvent",data:{event:{type:"clickedActivateOffer",payload:f}}}),(0,h.sendMessageToBackgroundScript)({message:"logAmplitudeEvent",data:{event:{type:"Browser Extension - Clicked Activate Offer",properties:f}}}),(0,d.sendJokoDomEvent)(d.JokoDomEvent.onOfferActivated,{offerId:e}),l.browserKind!==l.Browser.mobileAppWebView?[3,1]:(null===(c=null===(i=window.ReactNativeWebView)||void 0===i?void 0:i.postMessage)||void 0===c||c.call(i,JSON.stringify({messageId:"activateOffer"})),[3,8])):[2];case 1:return[4,(0,m.checkShouldPromptUserToRetriggerMerchantWebsiteTrackingConsentBanner)(e,B)];case 2:return a.sent()?(null==g||g(),(0,y.displayMerchantWebsiteTrackingConsentSuggestionWidget)({offer:r}),(0,v.activateOfferInBackground)({offerId:e,userInterfaceComponentInteractionEventType:s,shouldNotRememberOfferActivation:!0,shouldForceAffiliateLinkLoading:b}),[3,8]):[3,3];case 3:return!u&&w?[3,8]:(L(),!R||u&&!p?[3,7]:((0,v.activateOfferInBackground)({offerId:e,userInterfaceComponentInteractionEventType:s,shouldNotRememberOfferActivation:!1,shouldForceAffiliateLinkLoading:b}),D?(t=A,o={offer:r},[4,(0,l.getLocalStorageUserState)(l.UserStateKey.hasAcknowledgedWarningForCookieTracking)]):[3,5]));case 4:return t.apply(void 0,[(o.shouldAcknowledgeCookieWarning=!a.sent()&&!N,o)]),[3,6];case 5:k&&function(e){var t=e.offerId,r=e.closeWidgetOrPanel;null==r||r(),setTimeout((function(){return(0,d.sendJokoDomEvent)(d.JokoDomEvent.startSideButtonCashbackActivationAnimation,{})}),E),setTimeout((function(){return(0,_.displayCashbackActivationConfirmationWidget)(t)}),E+n.CASHBACK_ACTIVATION_ANIMATION_DURATION_IN_MS)}({closeWidgetOrPanel:g,offerId:e}),a.label=6;case 6:return[3,8];case 7:(0,v.activateOfferWithOnlineOfferActivationPage)({offerId:e,isDisplayedWithinOfferSearchTab:u,isBrowsingCurrentWebpageOffer:p,userInterfaceComponentInteractionEventType:s,hasUserGivenFullTrackingConsentOnCurrentWebsite:!!N}),a.label=8;case 8:return[2]}var f}))}))},merchantWebsiteTrackingConsentBannerTriggeringInformation:B,hasUserGivenFullTrackingConsentOnCurrentWebsite:N}},n.useOfferActivationState=S,n.checkWasOfferActivatedRecentlyFromLocalOrSessionStorage=T,n.displayOfferActivationInterstitial=A;var E=100;n.CASHBACK_ACTIVATION_ANIMATION_DURATION_IN_MS=3e3},89710:function(e,n,t){var r=this&&this.__awaiter||function(e,n,t,r){return new(t||(t=Promise))((function(o,a){function i(e){try{c(r.next(e))}catch(e){a(e)}}function s(e){try{c(r.throw(e))}catch(e){a(e)}}function c(e){var n;e.done?o(e.value):(n=e.value,n instanceof t?n:new t((function(e){e(n)}))).then(i,s)}c((r=r.apply(e,n||[])).next())}))},o=this&&this.__generator||function(e,n){var t,r,o,a,i={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return a={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function s(s){return function(c){return function(s){if(t)throw new TypeError("Generator is already executing.");for(;a&&(a=0,s[0]&&(i=0)),i;)try{if(t=1,r&&(o=2&s[0]?r.return:s[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,s[1])).done)return o;switch(r=0,o&&(s=[2&s[0],o.value]),s[0]){case 0:case 1:o=s;break;case 4:return i.label++,{value:s[1],done:!1};case 5:i.label++,r=s[1],s=[0];continue;case 7:s=i.ops.pop(),i.trys.pop();continue;default:if(!(o=i.trys,(o=o.length>0&&o[o.length-1])||6!==s[0]&&2!==s[0])){i=0;continue}if(3===s[0]&&(!o||s[1]>o[0]&&s[1]<o[3])){i.label=s[1];break}if(6===s[0]&&i.label<o[1]){i.label=o[1],o=s;break}if(o&&i.label<o[2]){i.label=o[2],i.ops.push(s);break}o[2]&&i.ops.pop(),i.trys.pop();continue}s=n.call(e,i)}catch(e){s=[6,e],r=0}finally{t=o=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,c])}}},a=this&&this.__read||function(e,n){var t="function"==typeof Symbol&&e[Symbol.iterator];if(!t)return e;var r,o,a=t.call(e),i=[];try{for(;(void 0===n||n-- >0)&&!(r=a.next()).done;)i.push(r.value)}catch(e){o={error:e}}finally{try{r&&!r.done&&(t=a.return)&&t.call(a)}finally{if(o)throw o.error}}return i},i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(n,"__esModule",{value:!0}),n.handleUserInterfaceComponentInteractionInBackground=n.requestCardLinkedOfferNonAffiliateTrackingLinkLoading=n.handleUserInterfaceComponentInteractionInBackgroundOrLoadTrackingLink=n.activateOfferInBackground=n.activateOfferWithOnlineOfferActivationPage=n.useShouldUseBackgroundAffiliateLinkLoading=void 0;var s=i(t(96540)),c=t(55015),u=t(7444),l=t(46239);function d(e){return r(this,void 0,void 0,(function(){return o(this,(function(n){switch(n.label){case 0:switch(e){case c.UserInterfaceComponentInteractionEventType.offerWidgetActivateButton:return[3,1];case c.UserInterfaceComponentInteractionEventType.panelOfferDetailsTabCashbackSectionActivateButton:return[3,3]}return[3,5];case 1:return[4,p()];case 2:case 4:return[2,n.sent()];case 3:return[4,f()];case 5:return[2,{shouldUseBackgroundAffiliateLinkLoadingAppFeatureOverride:!1,shouldDisplayOfferActivationInterstitialForBackgroundAffiliateLinkLoadingAppFeatureOverride:void 0}]}}))}))}function p(){return r(this,void 0,void 0,(function(){var e,n,t,r,i,s;return o(this,(function(o){switch(o.label){case 0:return i=(r=Promise).all,s=[(0,u.checkHasFeatureByPlatform)({desktopFeature:c.Feature.offerWidgetBackgroundCashbackActivationWithInterstitialDesktopBrowserExtension,mobileFeature:c.Feature.offerWidgetBackgroundCashbackActivationWithInterstitialMobileBrowserExtension})],[4,(0,u.checkHasFeatureByPlatform)({desktopFeature:c.Feature.offerWidgetBackgroundCashbackActivationWithoutInterstitialDesktopBrowserExtension,mobileFeature:c.Feature.offerWidgetBackgroundCashbackActivationWithoutInterstitialMobileBrowserExtension})];case 1:return[4,i.apply(r,[s.concat([o.sent()])])];case 2:return e=a.apply(void 0,[o.sent(),2]),n=e[0],t=e[1],[2,{shouldUseBackgroundAffiliateLinkLoadingAppFeatureOverride:n||t,shouldDisplayOfferActivationInterstitialForBackgroundAffiliateLinkLoadingAppFeatureOverride:!!n||!t&&void 0}]}}))}))}function f(){return r(this,void 0,void 0,(function(){var e,n,t,r,i,s;return o(this,(function(o){switch(o.label){case 0:return i=(r=Promise).all,s=[(0,u.checkHasFeatureByPlatform)({desktopFeature:c.Feature.panelBackgroundCashbackActivationWithInterstitialDesktopBrowserExtension,mobileFeature:c.Feature.panelBackgroundCashbackActivationWithInterstitialMobileBrowserExtension})],[4,(0,u.checkHasFeatureByPlatform)({desktopFeature:c.Feature.panelBackgroundCashbackActivationWithoutInterstitialDesktopBrowserExtension,mobileFeature:c.Feature.panelBackgroundCashbackActivationWithoutInterstitialMobileBrowserExtension})];case 1:return[4,i.apply(r,[s.concat([o.sent()])])];case 2:return e=a.apply(void 0,[o.sent(),2]),n=e[0],t=e[1],[2,{shouldUseBackgroundAffiliateLinkLoadingAppFeatureOverride:n||t,shouldDisplayOfferActivationInterstitialForBackgroundAffiliateLinkLoadingAppFeatureOverride:!!n||!t&&void 0}]}}))}))}function m(e){var n=e.offer,t=e.triggeringEventType;n&&(0,l.sendMessageToBackgroundScript)({message:"requestCardLinkedOfferNonAffiliateTrackingLinkLoading",data:{offer:n,triggeringEventType:t}})}function y(e){var n=e.offerId,t=e.triggeringEventType,r=e.shouldOpenAffiliateLinkInNewActiveTab;n&&(0,l.sendMessageToBackgroundScript)({message:"handleUserInterfaceComponentInteractionInBackground",data:{offerId:n,triggeringEventType:t,shouldOpenAffiliateLinkInNewActiveTab:r}})}n.useShouldUseBackgroundAffiliateLinkLoading=function(e){var n=this,t=e.offer,i=e.userInterfaceComponentInteractionEventType,u=a(s.default.useState(!1),2),l=u[0],p=u[1],f=a(s.default.useState(!1),2),m=f[0],y=f[1],h=function(e){var n=(0,c.useSetting)({settingKey:c.SettingKey.affiliateLinkLoadingInExtensionsSettings}),t=s.default.useMemo((function(){var t;if(e)return e.affiliatePlatformId&&(null===(t=null==n?void 0:n.perAffiliatePlatform)||void 0===t?void 0:t[e.affiliatePlatformId])?n.perAffiliatePlatform[e.affiliatePlatformId]:(null==n?void 0:n.defaultConfiguration)?n.defaultConfiguration:void 0}),[n]);return t}(t);return s.default.useEffect((function(){r(n,void 0,void 0,(function(){var e,n,r,a,s,c,u;return o(this,(function(o){switch(o.label){case 0:return t?[4,d(i)]:[2];case 1:return e=o.sent(),n=e.shouldUseBackgroundAffiliateLinkLoadingAppFeatureOverride,r=e.shouldDisplayOfferActivationInterstitialForBackgroundAffiliateLinkLoadingAppFeatureOverride,a=function(e,n){var t,r,o,a;if(!e)return{};var i="boolean"==typeof(null===(r=null===(t=e.browserExtension)||void 0===t?void 0:t.affiliateLinkLoading)||void 0===r?void 0:r.shouldDisplayOfferActivationInterstitialForBackgroundAffiliateLinkLoadingOverride)?e.browserExtension.affiliateLinkLoading.shouldDisplayOfferActivationInterstitialForBackgroundAffiliateLinkLoadingOverride:void 0;return"object"==typeof(null===(a=null===(o=e.browserExtension)||void 0===o?void 0:o.affiliateLinkLoading)||void 0===a?void 0:a.offerActivationInteractionsWithBackgroundAffiliateLinkLoadingOverride)&&Array.isArray(e.browserExtension.affiliateLinkLoading.offerActivationInteractionsWithBackgroundAffiliateLinkLoadingOverride)?{shouldUseBackgroundAffiliateLinkLoadingOfferOverride:e.browserExtension.affiliateLinkLoading.offerActivationInteractionsWithBackgroundAffiliateLinkLoadingOverride.includes(n),shouldDisplayOfferActivationInterstitialForBackgroundAffiliateLinkLoadingOfferOverride:i}:{shouldDisplayOfferActivationInterstitialForBackgroundAffiliateLinkLoadingOfferOverride:i}}(t,i),s=a.shouldUseBackgroundAffiliateLinkLoadingOfferOverride,c=a.shouldDisplayOfferActivationInterstitialForBackgroundAffiliateLinkLoadingOfferOverride,(n||(void 0!==s?s:null===(u=null==h?void 0:h.offerActivationInteractionsWithBackgroundAffiliateLinkLoading)||void 0===u?void 0:u.includes(i)))&&(p(!0),y(void 0!==r?r:void 0!==c?c:!!(null==h?void 0:h.shouldDisplayOfferActivationInterstitialForBackgroundAffiliateLinkLoading))),[2]}}))}))}),[h]),{shouldUseBackgroundAffiliateLinkLoading:l,shouldDisplayOfferActivationInterstitialForBackgroundAffiliateLinkLoading:m}},n.activateOfferWithOnlineOfferActivationPage=function(e){var n=e.offerId,t=e.isDisplayedWithinOfferSearchTab,r=e.isBrowsingCurrentWebpageOffer,o=e.userInterfaceComponentInteractionEventType,a=e.hasUserGivenFullTrackingConsentOnCurrentWebsite;(0,l.sendMessageToBackgroundScript)({message:"openUniversalOnlineOfferActivationInterstitial",data:{offerId:n,shouldOpenInCurrentTab:!t||!!r,triggeringEventType:o,shouldDisableAffiliateRedirectionMechanism:t,hasAcceptedMerchantCookies:a}})},n.activateOfferInBackground=function(e){var n=e.offerId,t=e.userInterfaceComponentInteractionEventType,r=e.shouldNotRememberOfferActivation,o=e.shouldForceAffiliateLinkLoading;n&&(0,l.sendMessageToBackgroundScript)({message:"handleUserInterfaceComponentInteractionInBackground",data:{offerId:n,triggeringEventType:t,shouldNotRememberOfferActivation:r,shouldForceAffiliateLinkLoading:o}})},n.handleUserInterfaceComponentInteractionInBackgroundOrLoadTrackingLink=function(e){var n=e.offer,t=e.triggeringEventType,r=e.shouldOpenAffiliateLinkInNewActiveTab;n&&(n.type===c.OfferType.OneTime?n.oneTimeOfferTrackingLink&&m({offer:n,triggeringEventType:t}):y({offerId:n?n.offerId:void 0,triggeringEventType:t,shouldOpenAffiliateLinkInNewActiveTab:r}))},n.requestCardLinkedOfferNonAffiliateTrackingLinkLoading=m,n.handleUserInterfaceComponentInteractionInBackground=y},67441:(e,n,t)=>{Object.defineProperty(n,"__esModule",{value:!0}),n.checkCanDisplayAlternativeOffersInPanel=void 0;var r=t(55015),o=t(32668);n.checkCanDisplayAlternativeOffersInPanel=function(e){var n,t,a,i,s;if(e.type!==r.OfferType.NoCashback||!(null===(n=e.alternativeOffersIds)||void 0===n?void 0:n.length))return!1;var c=(0,o.checkIsOnMobileScreen)();return!(c&&!(null===(a=null===(t=e.browserExtension)||void 0===t?void 0:t.mobileVersion)||void 0===a?void 0:a.displayAlternativeOffersInPanel)||!c&&!(null===(s=null===(i=e.browserExtension)||void 0===i?void 0:i.desktopVersion)||void 0===s?void 0:s.displayAlternativeOffersInPanel))}},23081:function(e,n,t){var r=this&&this.__assign||function(){return r=Object.assign||function(e){for(var n,t=1,r=arguments.length;t<r;t++)for(var o in n=arguments[t])Object.prototype.hasOwnProperty.call(n,o)&&(e[o]=n[o]);return e},r.apply(this,arguments)},o=this&&this.__awaiter||function(e,n,t,r){return new(t||(t=Promise))((function(o,a){function i(e){try{c(r.next(e))}catch(e){a(e)}}function s(e){try{c(r.throw(e))}catch(e){a(e)}}function c(e){var n;e.done?o(e.value):(n=e.value,n instanceof t?n:new t((function(e){e(n)}))).then(i,s)}c((r=r.apply(e,n||[])).next())}))},a=this&&this.__generator||function(e,n){var t,r,o,a,i={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return a={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function s(s){return function(c){return function(s){if(t)throw new TypeError("Generator is already executing.");for(;a&&(a=0,s[0]&&(i=0)),i;)try{if(t=1,r&&(o=2&s[0]?r.return:s[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,s[1])).done)return o;switch(r=0,o&&(s=[2&s[0],o.value]),s[0]){case 0:case 1:o=s;break;case 4:return i.label++,{value:s[1],done:!1};case 5:i.label++,r=s[1],s=[0];continue;case 7:s=i.ops.pop(),i.trys.pop();continue;default:if(!(o=i.trys,(o=o.length>0&&o[o.length-1])||6!==s[0]&&2!==s[0])){i=0;continue}if(3===s[0]&&(!o||s[1]>o[0]&&s[1]<o[3])){i.label=s[1];break}if(6===s[0]&&i.label<o[1]){i.label=o[1],o=s;break}if(o&&i.label<o[2]){i.label=o[2],i.ops.push(s);break}o[2]&&i.ops.pop(),i.trys.pop();continue}s=n.call(e,i)}catch(e){s=[6,e],r=0}finally{t=o=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,c])}}},i=this&&this.__read||function(e,n){var t="function"==typeof Symbol&&e[Symbol.iterator];if(!t)return e;var r,o,a=t.call(e),i=[];try{for(;(void 0===n||n-- >0)&&!(r=a.next()).done;)i.push(r.value)}catch(e){o={error:e}}finally{try{r&&!r.done&&(t=a.return)&&t.call(a)}finally{if(o)throw o.error}}return i},s=this&&this.__spreadArray||function(e,n,t){if(t||2===arguments.length)for(var r,o=0,a=n.length;o<a;o++)!r&&o in n||(r||(r=Array.prototype.slice.call(n,0,o)),r[o]=n[o]);return e.concat(r||Array.prototype.slice.call(n))},c=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(n,"__esModule",{value:!0}),n.checkIsEnrichedMerchantOffer=n.logClickedWebsiteLinkEvents=n.usePriceTrackingUnavailableText=n.checkShouldDisplayPriceComparisonAlternatives=n.checkIsPriceTrackingDisabled=n.getCleanProductName=n.useCopyCoupon=n.useOfferDetailsSections=n.checkIsBnplSectionEnabledForOffer=n.useIsBnplSectionEnabledForOffer=n.useProductSaving=n.checkDidCouponsSectionFinishLoading=n.PanelCouponStartButtonStatus=n.useOfferDetailsTabContentSpecificProps=void 0;var u,l=c(t(96540)),d=t(55015),p=t(47248),f=t(14568),m=t(32668),y=t(74137),h=t(21427),v=t(46239),_=t(89710),g=t(33931),b=t(82198),C=t(86245);function S(e){var n=e.webpageUrl,t=e.productData,c=e.offer,u=e.userSavedWebpages,p=e.setUserSavedWebpages,f=e.fromComponent,m=e.isFromBrowsedProductsSection,y=(0,C.useSaveProduct)({webpageUrl:n,productData:t,offer:c,fromComponent:f,userSavedWebpages:u,setUserSavedWebpages:p}),h=y.isProductSaved,v=y.toggleIsProductSaved;return function(e,n,t,c,u,p){l.default.useEffect((function(){if(n&&c&&!p){var l=c.name,f=c.imageUrl,m=c.priceAmount,y=c.priceCurrency,h={__typename:"UserSavedWebpage",webpageUrl:u,webpageTitle:l||document.title,webpageImageUrl:f,productPriceAmount:m,productPriceCurrency:y};if(e)!function(e){var n=e.webpageUrl,t=e.currentProductSavedWebpage,c=e.userSavedWebpages,u=e.setUserSavedWebpages;o(this,void 0,void 0,(function(){var e,o;return a(this,(function(a){switch(a.label){case 0:return[4,(0,d.removeNonEssentialUrlComponents)(n)];case 1:return e=a.sent(),o=s([r(r({},t),{webpageUrl:e})],i(c.filter((function(e){return e.webpageTitle!==t.webpageTitle}))),!1),u(o),[2]}}))}))}({webpageUrl:u,currentProductSavedWebpage:h,userSavedWebpages:n,setUserSavedWebpages:t});else{var v=n.filter((function(e){return e.webpageTitle!==h.webpageTitle}));t(v)}}}),[e])}(h,u,p,t,n,m),{isProductSaved:h,toggleIsProductSaved:v}}function T(e){return o(this,void 0,void 0,(function(){var n,t;return a(this,(function(r){switch(r.label){case 0:return[4,Promise.all([(0,f.checkIsBnplEnabled)(),(0,d.checkHasFeature)(d.Feature.bnplSideButtonTabMobileBrowserExtension)])];case 1:return n=i.apply(void 0,[r.sent(),2]),t=n[0],[2,!!(n[1]&&t&&e&&e.browserExtension&&e.browserExtension.bnpl&&e.browserExtension.bnpl.active)]}}))}))}n.useOfferDetailsTabContentSpecificProps=function(e,n,t,o,a,s,c,p,f,m){var _=(0,d.useHasFeatureByPlatform)({isMobileExtension:c,desktopFeature:d.Feature.cardLinkedOfferCashbackWidgetDesktopBrowserExtension,mobileFeature:d.Feature.cardLinkedOfferCashbackWidgetMobileBrowserExtension}),C=function(e,n){var t=(0,h.useShouldSkipUnsuccessfulCouponsEnabled)(),r=(0,h.useEnrichedMerchantCoupons)(e,t),o=(0,h.useSkippedCouponsSplit)(r,t),a=o.skippedCoupons,s=o.selectedCoupons,c=(0,d.useHasFeature)(d.Feature.couponsSideButtonTabMobileBrowserExtension),p=(0,d.useHasFeatureByPlatform)({isMobileExtension:n,desktopFeature:d.Feature.showPanelStartCouponApplicationButtonInDesktopBrowserExtension,mobileFeature:d.Feature.showPanelStartCouponApplicationButtonInMobileBrowserExtension}),f=function(){var e=i(l.default.useState(void 0),2),n=e[0],t=e[1];return l.default.useEffect((function(){var e=function(e,n){return function(e,n,t){if("local"!==t)return;var r=new URL(window.location.href).hostname,o="".concat(d.LocalStorageKey.couponAutomationStateKeyPrefix).concat(r);if(!n[o])return;e(n[o].newValue.state)}(t,e,n)},n=(0,y.withSentry)(e);return chrome.storage.onChanged.addListener(n),(0,v.sendMessageToBackgroundScript)({message:"getCouponAutomationState",data:{url:window.location.href}},(function(e){t(void 0===e?{}:e)})),function(){return chrome.storage.onChanged.removeListener(n)}}),[]),n}(),m=function(e){return l.default.useMemo((function(){return e?e.passive?e.passive.stateType===d.CouponAutomationPassiveStateType.propose?u.enabled:e.passive.stateType===d.CouponAutomationPassiveStateType.init?u.inProgress:u.disabled:e.active?u.inProgress:u.done:u.disabled}),[e])}(f),_=function(e,n,t,r){return!!r&&(void 0===t?void 0:!(n&&e&&e.mobileApp&&e.mobileApp.coupons&&!1===e.mobileApp.coupons.automationActive)&&!(!n&&e&&e.browserExtension&&e.browserExtension.coupons&&!1===e.browserExtension.coupons.automationActive))}(e,n,f,p);return{offer:e,shouldSkipUnsuccessfulCouponsEnabled:t,coupons:r,skippedCoupons:a,selectedCoupons:s,isCouponsSectionEnabled:c,shouldShowStartCouponApplicationButton:_,couponAutomationState:f,panelCouponStartButtonStatus:m}}(e,c),T=function(e,n,t,o,a){var i=window.location.href,s=n?n.offerId:void 0,c=(0,b.useProductData)(i),u=c.productData,l=c.isProductDataLoaded,p=(0,d.usePriceHistory)({webpage:{webpageUrl:i,webpageTitle:document.title},offerId:s,isCurrentWebpage:!0,productDataFromCurrentWebpage:u,shouldAutomaticallyCheckAvailability:!!n,shouldFetchBlacklistedPriceTrackingDomainsFromBackend:!0}),f=p.priceHistory,m=p.isPriceHistoryAvailable,y=p.isPriceHistoryLoading,h=p.lastPrice,v=p.loadPriceHistoryAndLogEvents,_=p.isWebsiteBlacklistedForPriceTracking,C=S({webpageUrl:i,productData:u,offer:n,userSavedWebpages:o,setUserSavedWebpages:a,fromComponent:"panelOfferDetailsTabProductSection"}),T=C.isProductSaved,I=C.toggleIsProductSaved,A=function(e,n,t,r,o,a){var i=(0,g.useIsPriceComparisonEnabled)(e,o),s=(0,g.useLoadPriceComparison)({currentWebpageUrl:n,productData:t,merchantId:r,isPriceHistoryAvailable:a}).priceComparisonData,c=(0,g.useHasPriceComparisonLoadingTimedOut)(null==s?void 0:s.productAlternativesWithAssociatedOffers),u=(0,g.useShouldDisplayBestPriceTag)(t,s),l=u.wasCheaperAlternativeDetected,d=u.shouldDisplayBestPriceTagOnBrowsedProduct,p=u.shouldDisplayBestPriceTagOnCheapestAlternative;return{priceComparisonData:s,hasPriceComparisonLoadingTimedOut:c,wasCheaperAlternativeDetected:l,shouldDisplayBestPriceTagOnBrowsedProduct:d,shouldDisplayBestPriceTagOnCheapestAlternative:p,isPriceComparisonEnabled:i}}(e,i,u,null==n?void 0:n.merchantId,t,m);return r({productData:u,isProductDataLoaded:l,loadPriceHistoryAndLogEvents:v,priceHistory:f,lastPriceData:h,isWebsiteBlacklistedForPriceTracking:_,isPriceHistoryAvailable:m,isPriceHistoryLoading:y,isProductSaved:T,toggleIsProductSaved:I},A)}(s,e,c,p,f);return r(r({selectedOfferDetailsSection:o,setSelectedOfferDetailsSection:a,userOfferActivationInfo:n,shouldDisplayOnetimeOfferCashbackActivatedInfo:_,isBnplSectionEnabledForOffer:t,lastUserBnplTransactionFromBnplSubscriptionWidget:m},C),T)},function(e){e.disabled="disabled",e.enabled="enabled",e.inProgress="inProgress",e.done="done"}(u=n.PanelCouponStartButtonStatus||(n.PanelCouponStartButtonStatus={})),n.checkDidCouponsSectionFinishLoading=function(e){var n=e.shouldSkipUnsuccessfulCouponsEnabled,t=e.coupons,r=e.skippedCoupons,o=e.selectedCoupons,a=e.shouldShowStartCouponApplicationButton,i=e.couponAutomationState;return void 0!==n&&void 0!==t&&void 0!==r&&void 0!==o&&void 0!==a&&void 0!==i},n.useProductSaving=S,n.useIsBnplSectionEnabledForOffer=function(e){var n=i(l.default.useState(void 0),2),t=n[0],r=n[1];return l.default.useEffect((function(){T(e).then((function(e){return r(e)}))}),[e]),t},n.checkIsBnplSectionEnabledForOffer=T,n.useOfferDetailsSections=function(e,n){var t=(0,d.useLocalizedTexts)().contentscript.redesign.panel.offerDetails.selectorBar,r=(0,d.useUserRegion)();return[{id:d.OfferDetailsSection.cashback,displayedText:t.cashback},{id:d.OfferDetailsSection.coupons,displayedText:t.coupons},{id:d.OfferDetailsSection.product,displayedText:t.product,isHidden:n},{id:d.OfferDetailsSection.bnpl,displayedText:t.bnpl,isHidden:r!==d.Region.FR||(0,m.checkIsOnMobileScreen)()&&e}].filter((function(e){return!e.isHidden}))},n.useCopyCoupon=function(e){var n=e.coupon,t=e.currentWebpageOffer,r=i(l.default.useState(!1),2),o=r[0],a=r[1];return l.default.useEffect((function(){var e;return o&&(e=setTimeout((function(){return a(!1)}),5e3)),function(){e&&clearTimeout(e)}}),[o]),{hasBeenCopiedRecently:o,onClickCopy:function(){navigator.clipboard.writeText(n.code),o||function(e){var n=e.merchantCouponId,t={merchantCouponId:n};(0,v.sendMessageToBackgroundScript)({message:"logUserEvent",data:{event:{type:"copiedMerchantCouponCode",payload:t}}}),(0,v.sendMessageToBackgroundScript)({message:"logAmplitudeEvent",data:{event:{type:"Coupons - Copied Merchant Coupon Code",properties:t}}})}(n),a(!0),(0,_.handleUserInterfaceComponentInteractionInBackgroundOrLoadTrackingLink)({offer:t,triggeringEventType:p.UserInterfaceComponentInteractionEventType.copyCouponCodeButton})}}};n.getCleanProductName=function(e,n,t){return void 0===n&&(n=!1),void 0===t&&(t=55),e?(e=(0,d.decodeUnicodeCharacters)(e),n&&(e=(0,d.truncateText)(e,t)),e):""},n.checkIsPriceTrackingDisabled=function(e,n){return e!==d.Region.FR||!!n||d.browserKind===d.Browser.firefox},n.checkShouldDisplayPriceComparisonAlternatives=function(e,n){return!!e&&e.length>0&&!n},n.usePriceTrackingUnavailableText=function(e){var n=e.isProductSaved,t=e.isWebsiteBlacklistedForPriceTracking,r=e.isTemporaryUser,o=(0,d.useLocalizedTexts)().contentscript.redesign.panel.offerDetails.productSection.productAvailableForWebpage.priceTracking.unavailableGraphMessage;return t?o.productFromBlacklistedDomain:n?o.productSaved:r?o.saveProduct.temporaryAccount:o.saveProduct.regularAccount},n.logClickedWebsiteLinkEvents=function(e){var n={offerId:e};(0,v.sendMessageToBackgroundScript)({message:"logUserEvent",data:{event:{type:"clickedWebsiteLink",payload:n}}}),(0,v.sendMessageToBackgroundScript)({message:"logAmplitudeEvent",data:{event:{type:"Offers - Clicked Website Link",properties:n}}})},n.checkIsEnrichedMerchantOffer=function(e){return!(!("personalizedAffiliateLink"in e)||!e.personalizedAffiliateLink)}},86263:function(e,n,t){var r=this&&this.__assign||function(){return r=Object.assign||function(e){for(var n,t=1,r=arguments.length;t<r;t++)for(var o in n=arguments[t])Object.prototype.hasOwnProperty.call(n,o)&&(e[o]=n[o]);return e},r.apply(this,arguments)},o=this&&this.__read||function(e,n){var t="function"==typeof Symbol&&e[Symbol.iterator];if(!t)return e;var r,o,a=t.call(e),i=[];try{for(;(void 0===n||n-- >0)&&!(r=a.next()).done;)i.push(r.value)}catch(e){o={error:e}}finally{try{r&&!r.done&&(t=a.return)&&t.call(a)}finally{if(o)throw o.error}}return i},a=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(n,"__esModule",{value:!0}),n.useSetHeaderStateInSelectedSearchResultScreen=n.useSetHeaderStateBasedOnSearchState=n.useDesignSystemOfferSearchBarFocusState=n.useIsSearchBarFocused=n.useFilteredUserOffers=n.logClickedOfferEvents=n.useOnClickSearchResult=n.useDisplayedSearchResults=n.useSelectedOfferSearchResult=n.useOfferSearchTabContentInnerState=n.useOfferSearchTabContentSpecificProps=void 0;var i=a(t(96540)),s=t(55015),c=t(19972),u=t(32668),l=t(46239),d=t(67441),p=t(23081);function f(e,n){var t={offerId:e,type:n};(0,l.sendMessageToBackgroundScript)({message:"logAmplitudeEvent",data:{event:{type:"Offers - Clicked Offer",properties:t}}}),(0,l.sendMessageToBackgroundScript)({message:"logUserEvent",data:{event:{type:"clickedOffer",payload:t}}})}function m(e){return!!e.browserExtension&&!!e.browserExtension.displayInExtensionSearch&&e.type!==s.OfferType.Ongoing}n.useOfferSearchTabContentSpecificProps=function(){var e=function(){var e=o(i.default.useState([]),2),n=e[0],t=e[1],r=function(){(0,l.sendMessageToBackgroundScript)({message:"getOffersByTags",data:{}},(function(e){t(e.offers)}))};return i.default.useEffect(r,[]),n}(),n=o(i.default.useState(void 0),2),t=n[0],r=n[1];return i.default.useEffect((function(){(0,s.getLocalStorageItem)(s.LocalStorageKey.offerBrowsingTags).then(r)}),[]),{emptyQuerySearchResults:e,offerBrowsingTags:t}},n.useOfferSearchTabContentInnerState=function(){var e=o(i.default.useState(""),2),n=e[0],t=e[1],r=o(i.default.useState(!1),2),a=r[0],s=r[1],c=o(i.default.useState(void 0),2),u=c[0],l=c[1],d=o(i.default.useState(void 0),2),p=d[0],f=d[1],m=i.default.useRef(null),y=o(i.default.useState(!1),2),h=y[0],v=y[1],_=i.default.useCallback((function(){v(!h)}),[h]);return{searchText:n,setSearchText:t,isOfferSearchActive:a,setIsOfferSearchActive:s,selectedParentBrowsingTag:u,setSelectedParentBrowsingTag:l,selectedChildBrowsingTag:p,setSelectedChildBrowsingTag:f,scrollableContentRef:m,shouldResetScrollableContentEventListener:h,resetScrollableContentEventListener:_}},n.useSelectedOfferSearchResult=function(e,n,t,a){var c=o(i.default.useState(void 0),2),u=c[0],l=c[1],d=o(i.default.useState(s.OfferDetailsSection.cashback),2),f=d[0],m=d[1],y=(0,p.useOfferDetailsTabContentSpecificProps)(u,a,!1,f,m,e,n,void 0,(function(e){}));return r({selectedOfferSearchResult:u,setSelectedOfferSearchResult:l,userRegion:e,isMobileExtension:n,closePanelAndLogEvents:t},y)},n.useDisplayedSearchResults=function(e){var n=(0,s.useProgressiveDisplay)(e),t=n.displayedItems,r=n.showMoreResults;return{displayedSearchResults:t,handleScroll:function(e){var n=e.currentTarget;n.scrollHeight-n.scrollTop-n.clientHeight<1&&r()}}},n.useOnClickSearchResult=function(e,n,t){var r=e.offerId,o=e.type,a=(0,u.checkIsOnMobileScreen)(),c=(0,s.useHasFeatureByPlatform)({isMobileExtension:a,desktopFeature:s.Feature.alternativeOffersInPanelDesktopBrowserExtension,mobileFeature:s.Feature.alternativeOffersInPanelMobileBrowserExtension});return i.default.useCallback((function(){e.enrichedConditions&&(e.enrichedConditions.conditions=e.enrichedConditions.conditions.filter((function(e){return!e.summary.includes("via le bouton ci-dessous")}))),n(e),(0,l.sendMessageToBackgroundScript)({message:"getEnrichedMerchantOfferFromAppSync",data:{offerId:r}},(function(e){e.offer&&n(e.offer)})),e.type===s.OfferType.NoCashback?c&&(0,d.checkCanDisplayAlternativeOffersInPanel)(e)?t(s.OfferDetailsSection.cashback):t(s.OfferDetailsSection.bnpl):t(s.OfferDetailsSection.cashback),f(r,o)}),[e])},n.logClickedOfferEvents=f,n.useFilteredUserOffers=function(e,n,t,r,a,s){var c=o(i.default.useState([]),2),u=c[0],d=c[1],p=o(i.default.useState(!0),2),f=p[0],y=p[1],h=i.default.useRef(void 0);i.default.useEffect((function(){!function(e){var n=e.lastQueryLaunchTimestampMsRef,t=e.searchText,r=e.parentTagId,o=e.internalTagIdsToQuery,a=e.browsingTagIdsToQuery,i=e.emptyQuerySearchResults,s=e.setIsLoading,c=e.setUserOffersResult,u=(new Date).valueOf();n.current=u,t.length>0?(0,l.sendMessageToBackgroundScript)({message:"searchOffers",data:{searchQuery:t}},(function(e){u===n.current&&(s(!1),c(e.offers))})):a||o?(s(!0),(0,l.sendMessageToBackgroundScript)({message:"getOffersByTags",data:{parentTagId:r,browsingTagIds:a,internalTagIds:o}},(function(e){u===n.current&&(s(!1),c(e.offers))}))):0===i.length?s(!0):(s(!1),c(i))}({lastQueryLaunchTimestampMsRef:h,searchText:n,parentTagId:t?t.tagId:void 0,internalTagIdsToQuery:r,browsingTagIdsToQuery:a,emptyQuerySearchResults:e,setIsLoading:y,setUserOffersResult:d})}),[n,t,r,a,e]);var v=i.default.useMemo((function(){return u.filter(m)}),[u]);return i.default.useEffect((function(){f||s()}),[f]),{filteredUserOffers:v,isLoading:f}},n.useIsSearchBarFocused=function(e){var n=e.isSearchBarFocused,t=e.setIsSearchBarFocused,r=e.setSearchText,o=e.setIsOfferSearchActive,a=e.isMobileExtension,s=e.scrollableContentRef,c=e.shouldResetScrollableContentEventListener,u=i.default.useRef(null),l=i.default.useCallback((function(){t(!0),o(!0),a&&u.current&&u.current.scrollIntoView({behavior:"smooth",block:"center"})}),[]),d=i.default.useCallback((function(){return t(!1)}),[]),p=i.default.useCallback((function(){r("")}),[]),f=i.default.useCallback((function(e){var n=a?e.target.value.replace(/[\u2019]/g,"'"):e.target.value;r(n)}),[]),m=i.default.useCallback((function(e){"Escape"===e.key&&(o(!1),r(""),u.current&&u.current.blur()),"Enter"===e.key&&u.current&&u.current.blur()}),[]);return i.default.useEffect((function(){s.current&&s.current.addEventListener("scroll",(function(){u.current&&u.current.blur()}))}),[c]),{isSearchBarFocused:n,searchBarInputRef:u,onFocusSearchBarInput:l,onBlurSearchBarInput:d,onChangeSearchBarInput:f,onKeyDownSearchBarInput:m,onClickCancelCross:p}},n.useDesignSystemOfferSearchBarFocusState=function(e){var n=e.searchText,t=e.setSearchText,r=e.setIsOfferSearchActive,o=e.isMobileExtension,a=e.scrollableContentRef,s=e.shouldResetScrollableContentEventListener,c=e.selectedParentBrowsingTag,u=e.setSelectedParentBrowsingTag,l=e.selectedChildBrowsingTag,d=e.setSelectedChildBrowsingTag,p=i.default.useRef(null),f=i.default.useRef(""),m=i.default.useCallback((function(){n?t(""):!o&&l?d(void 0):c?(u(void 0),d(void 0)):r(!1),p.current&&p.current.blur()}),[n,c,l,o]),y=i.default.useCallback((function(){r(!0),o&&p.current&&p.current.scrollIntoView({behavior:"smooth",block:"center"})}),[m]),h=i.default.useCallback((function(){t("")}),[]),v=i.default.useCallback((function(e){"Escape"===e.key&&(r(!1),t(""),p.current&&p.current.blur()),"Enter"===e.key&&p.current&&p.current.blur()}),[]);return i.default.useEffect((function(){a.current&&a.current.addEventListener("scroll",(function(){p.current&&p.current.blur()}))}),[s]),{searchBarInputRef:p,onFocusSearchBarInput:y,onKeyDownSearchBarInput:v,onClickCancelCross:h,onGoBack:m,searchBarTextRef:f}},n.useSetHeaderStateBasedOnSearchState=function(e){var n=e.isOfferSearchActive,t=e.onGoBack,r=e.setPanelHeaderType,o=e.setOnClickPanelGoBackButton;i.default.useEffect((function(){return n?(r(c.PanelHeaderType.backArrowAndCloseButton),o((function(){return t}))):(r(c.PanelHeaderType.jokoLogoAndCloseButton),o((function(){return null}))),function(){r(c.PanelHeaderType.jokoLogoAndCloseButton),o((function(){return null}))}}),[n,t,r,o])},n.useSetHeaderStateInSelectedSearchResultScreen=function(e){var n=e.onGoBack,t=e.setPanelHeaderType,r=e.setOnClickPanelGoBackButton;i.default.useEffect((function(){return t(c.PanelHeaderType.backArrowAndCloseButton),r((function(){return n})),function(){t(c.PanelHeaderType.jokoLogoAndCloseButton),r((function(){return null}))}}),[t,r,n])}},74617:function(e,n,t){var r=this&&this.__assign||function(){return r=Object.assign||function(e){for(var n,t=1,r=arguments.length;t<r;t++)for(var o in n=arguments[t])Object.prototype.hasOwnProperty.call(n,o)&&(e[o]=n[o]);return e},r.apply(this,arguments)},o=this&&this.__awaiter||function(e,n,t,r){return new(t||(t=Promise))((function(o,a){function i(e){try{c(r.next(e))}catch(e){a(e)}}function s(e){try{c(r.throw(e))}catch(e){a(e)}}function c(e){var n;e.done?o(e.value):(n=e.value,n instanceof t?n:new t((function(e){e(n)}))).then(i,s)}c((r=r.apply(e,n||[])).next())}))},a=this&&this.__generator||function(e,n){var t,r,o,a,i={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return a={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function s(s){return function(c){return function(s){if(t)throw new TypeError("Generator is already executing.");for(;a&&(a=0,s[0]&&(i=0)),i;)try{if(t=1,r&&(o=2&s[0]?r.return:s[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,s[1])).done)return o;switch(r=0,o&&(s=[2&s[0],o.value]),s[0]){case 0:case 1:o=s;break;case 4:return i.label++,{value:s[1],done:!1};case 5:i.label++,r=s[1],s=[0];continue;case 7:s=i.ops.pop(),i.trys.pop();continue;default:if(!(o=i.trys,(o=o.length>0&&o[o.length-1])||6!==s[0]&&2!==s[0])){i=0;continue}if(3===s[0]&&(!o||s[1]>o[0]&&s[1]<o[3])){i.label=s[1];break}if(6===s[0]&&i.label<o[1]){i.label=o[1],o=s;break}if(o&&i.label<o[2]){i.label=o[2],i.ops.push(s);break}o[2]&&i.ops.pop(),i.trys.pop();continue}s=n.call(e,i)}catch(e){s=[6,e],r=0}finally{t=o=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,c])}}},i=this&&this.__rest||function(e,n){var t={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&n.indexOf(r)<0&&(t[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var o=0;for(r=Object.getOwnPropertySymbols(e);o<r.length;o++)n.indexOf(r[o])<0&&Object.prototype.propertyIsEnumerable.call(e,r[o])&&(t[r[o]]=e[r[o]])}return t},s=this&&this.__read||function(e,n){var t="function"==typeof Symbol&&e[Symbol.iterator];if(!t)return e;var r,o,a=t.call(e),i=[];try{for(;(void 0===n||n-- >0)&&!(r=a.next()).done;)i.push(r.value)}catch(e){o={error:e}}finally{try{r&&!r.done&&(t=a.return)&&t.call(a)}finally{if(o)throw o.error}}return i},c=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(n,"__esModule",{value:!0}),n.useOnClickInsidePanel=n.usePanelTabSvgIcon=n.useTabIconUrl=n.getCssFilterPropertyForTabIconUrl=n.enableWebpageBodyScrolling=n.disableWebpageBodyScrolling=n.usePanelWrapperInnerState=n.usePanelInnerState=n.getPanelElement=n.displayPanelAndLogEvents=n.toggleDisplayPanelAndLogEvents=void 0;var u=c(t(96540)),l=c(t(40961)),d=t(55015),p=c(t(84781)),f=c(t(20171)),m=c(t(49357)),y=c(t(76375)),h=t(47175),v=t(52879),_=t(37392),g=t(17621),b=t(32668),C=t(24366),S=t(26368),T=t(68134),I=t(46239),A=t(23081),E=t(86263),k=t(95752),O=t(87105),P=t(78148),w=t(18989),L=t(13897),B=c(t(40549)),N=c(t(91506)),M="jokoLastPanelOpenedOrClosedAt";function R(e){return document.getElementById(e||(0,g.getHashedElementId)(g.JokoExtensionRootElement.panel))}function D(e){var n=R(e);null!==n&&(l.default.unmountComponentAtNode(n),n.remove())}function x(e,n){return o(this,void 0,void 0,(function(){var t,o,i,c;return a(this,(function(a){switch(a.label){case 0:return[4,Promise.all([U(),(0,d.getUserFeaturesMap)()])];case 1:return t=s.apply(void 0,[a.sent(),2]),o=t[0],i=t[1],e.excludedPanelTabs=o,(c=document.createElement("div")).id=n,document.documentElement.appendChild(c),l.default.render(u.default.createElement(B.default,null,u.default.createElement(d.LocalesContextProvider,null,u.default.createElement(d.FeaturesContextProvider,{initialUserFeaturesMap:i},u.default.createElement(N.default,r({},e))))),c),[2]}}))}))}function U(){return o(this,void 0,void 0,(function(){var e,n,t,r;return a(this,(function(o){switch(o.label){case 0:return d.browserKind!==d.Browser.mobileAppWebView?[2,[]]:[4,Promise.all([(0,d.checkHasFeature)(d.Feature.extensionPanelSearchTabInMobileAppBrowser),(0,d.checkHasFeature)(d.Feature.extensionPanelProfileTabInMobileAppBrowser)])];case 1:return e=s.apply(void 0,[o.sent(),2]),n=e[0],t=e[1],r=[],n||r.push(d.PanelTab.offerSearch),t||r.push(d.PanelTab.profile),[2,r]}}))}))}function F(e,n){var t=n.offer,r=n.isProductPage,i=n.isCheckoutPage,s=n.bnpl,c=n.defaultPanelLocationOverride,u=n.isTemporaryUser,l=n.excludedPanelTabs;return o(this,void 0,void 0,(function(){var n,o,p,f,m,y,h,v;return a(this,(function(a){switch(a.label){case 0:return[4,(0,d.checkHasFeature)(d.Feature.bnplNewCardReadyDisplayInExtensions)];case 1:return n=a.sent(),p=(o=s||{isBnplSectionEnabledForOffer:!1}).isBnplSectionEnabledForOffer,f=o.userBnplTransactionsFromLocalStorage,m=(0,k.getInitialPanelLocation)({offer:t,isProductPage:r,isCheckoutPage:i,isBnplSectionEnabledForOffer:p,userBnplTransactionsFromLocalStorage:f,shouldMakeBnplTabAsDefaultIfUnusedCardExists:n,defaultPanelLocationOverride:c,excludedPanelTabs:l}),y=m.initiallySelectedPanelTab,h=m.initiallySelectedOfferDetailsSection,v={fromComponent:e,initiallySelectedPanelTab:y,initiallySelectedOfferDetailsSection:h,isTemporaryUser:u},(0,I.sendMessageToBackgroundScript)({message:"logUserEvent",data:{event:{type:"openedPanelOnBrowserExtension",payload:v}}}),(0,I.sendMessageToBackgroundScript)({message:"logAmplitudeEvent",data:{event:{type:"Browser Extension - Opened Panel",properties:v}}}),[2]}}))}))}function W(){document.body.style.overflow="hidden"}function H(){document.body.style.overflow="auto"}n.toggleDisplayPanelAndLogEvents=function(e,n){if(t=Number(localStorage.getItem(M)),!(Date.now()-t<1e3*S.OPEN_AND_CLOSE_ANIMATIONS_DURATION_IN_SECONDS+50)){var t,r=(0,g.getHashedElementId)(g.JokoExtensionRootElement.panel);null===R(r)?(x(e,r),localStorage.setItem(M,Date.now().toString()),F(n,e)):((0,_.sendJokoDomEvent)(_.JokoDomEvent.onJokoPanelCloseRequest,{closingSource:"clickBrowserAction"}),localStorage.setItem(M,Date.now().toString()))}},n.displayPanelAndLogEvents=function(e,n,t){var r=(0,g.getHashedElementId)(g.JokoExtensionRootElement.panel),o=R(r),a=null!==o,i=function(e){var n=!1,t=(null==e?void 0:e.children[0])?e.children[0].style.transform:null;if(t){var r=/translate3d\((.+)%, (.+)(px)?, (.+)px\)/.exec(t);(null==r?void 0:r[2])&&(n=0!==parseInt(r[2],10))}return n}(o);!i&&a?t&&(0,_.sendJokoDomEvent)(_.JokoDomEvent.onJokoPanelLocationChangeRequest,{panelLocation:t}):(i&&D(r),x(e,r),localStorage.setItem(M,Date.now().toString()),F(n,e))},n.getPanelElement=R,n.usePanelInnerState=function(e){var n=function(e){var n=this,t=e.offer,c=e.userOfferActivationInfo,l=e.isProductPage,p=e.isTemporaryUser,f=e.excludedPanelTabs,m=i(e,["offer","userOfferActivationInfo","isProductPage","isTemporaryUser","excludedPanelTabs"]),y=s(u.default.useState(void 0),2),h=y[0],v=y[1],C=u.default.useMemo(b.checkIsOnMobileScreen,[]),S=u.default.useMemo((function(){return!!document.getElementById((0,g.getHashedElementId)(g.JokoExtensionRootElement.offerWidget))}),[]),A=(0,k.usePanelLocation)(r({offer:t,userOfferActivationInfo:c,isProductPage:l,isTemporaryUser:p,excludedPanelTabs:f},m)),E=A.selectedPanelTab,O=A.setSelectedPanelTab,P=A.selectedOfferDetailsSection,B=A.setSelectedOfferDetailsSection,N=A.selectedProductsSection,M=A.setSelectedProductsSection,R=(0,T.useGetTabId)(),x=u.default.useCallback((function(e,i){return o(n,void 0,void 0,(function(){var n,o;return a(this,(function(a){switch(a.label){case 0:return n=window.location.href,v(!1),(0,L.removeUnfinishedBnplSubscriptionStateInLocalStorage)(R),function(e,n,t){var o=r(r({},e===d.PanelTab.offerDetails?{tab:e,section:n}:{tab:e}),{closingSource:t});(0,I.sendMessageToBackgroundScript)({message:"logUserEvent",data:{event:{type:"closedPanelOnBrowserExtension",payload:o}}}),(0,I.sendMessageToBackgroundScript)({message:"logAmplitudeEvent",data:{event:{type:"Browser Extension - Closed Panel",properties:o}}})}(E,P,e),(o=!i)?[4,(0,w.checkShouldDisplaySideButtonOnWebpage)(n,t)]:[3,2];case 1:o=a.sent(),a.label=2;case 2:return o&&(0,w.displaySideButton)({offer:t,userOfferActivationInfo:c,webpageUrl:n,isTemporaryUser:p}),[2]}}))}))}),[E,R]),U=u.default.useCallback((function(e){var n=e.propertyName;!1===h&&["opacity","right","transform"].includes(n)&&D()}),[h]);u.default.useEffect((function(){setTimeout((function(){return v(!0)}),50),(0,_.sendJokoDomEvent)(_.JokoDomEvent.onJokoPanelDisplayed,{});var e=(0,_.setJokoDomEventListener)(_.JokoDomEvent.onJokoPanelCloseRequest,(function(e){var n=e.closingSource;return x(n)}));return function(){return(0,_.removeJokoDomEventListener)(_.JokoDomEvent.onJokoPanelCloseRequest,e)}}),[]);var F=u.default.useRef(null);return{tabId:R,isPanelDisplayed:h,isMobileExtension:C,selectedPanelTab:E,setSelectedPanelTab:O,closePanelAndLogEvents:x,offer:t,isProductPage:l,selectedOfferDetailsSection:P,setSelectedOfferDetailsSection:B,selectedProductsSection:N,setSelectedProductsSection:M,onPanelTransitionEnd:U,isOfferWidgetMounted:S,panelInnerContainerRef:F,isTemporaryUser:p,excludedPanelTabs:f,unfinishedBnplSubscriptionState:m.bnpl.unfinishedBnplSubscriptionState}}(e),t=n.isMobileExtension,c=n.selectedOfferDetailsSection,l=n.setSelectedOfferDetailsSection,p=n.selectedProductsSection,f=n.setSelectedProductsSection,m=i(n,["isMobileExtension","selectedOfferDetailsSection","setSelectedOfferDetailsSection","selectedProductsSection","setSelectedProductsSection"]),y=function(e){var n=e.offer,t=e.userOfferActivationInfo,o=e.selectedOfferDetailsSection,a=e.setSelectedOfferDetailsSection,i=e.selectedProductsSection,c=e.setSelectedProductsSection,l=e.selectedPanelTab,p=e.closePanelAndLogEvents,f=e.panelInnerContainerRef,m=e.isMobileExtension,y=e.isTemporaryUser,h=e.bnpl,_=function(e,n,t,r,o){var a=(0,d.useUserRegion)(),i=s(u.default.useState(void 0),2),c=i[0],l=i[1];u.default.useEffect((function(){(0,I.sendMessageToBackgroundScript)({message:"getUserSavedWebpages"},(function(e){return l(e.userSavedWebpages)}))}),[]);var p=(0,v.useShouldDisplayBankReconnectionBanner)()&&r;return{offer:e,isMobileExtension:r,userRegion:a,closePanelAndLogEvents:n,panelInnerContainerRef:t,isTemporaryUser:o,shouldDisplayBankReconnectionBanner:p,userSavedWebpages:c,setUserSavedWebpages:l}}(n,p,f,m,y),g=(0,E.useOfferSearchTabContentSpecificProps)(),b=(0,A.useOfferDetailsTabContentSpecificProps)(n,t,h.isBnplSectionEnabledForOffer,o,a,_.userRegion,_.isMobileExtension,_.userSavedWebpages,_.setUserSavedWebpages,h.lastUserBnplTransactionFromBnplSubscriptionWidget),C=(0,O.useProductsTabContentSpecificProps)({isMobileExtension:m,selectedPanelTab:l,selectedProductsSection:i,setSelectedProductsSection:c}),S=(0,P.useProfileTabContentSpecificProps)(l,m);return r(r(r(r(r({},g),b),C),S),_)}(r(r({isMobileExtension:t,selectedOfferDetailsSection:c,setSelectedOfferDetailsSection:l,selectedProductsSection:p,setSelectedProductsSection:f},e),m));return{selectedPanelTab:m.selectedPanelTab,panelWrapperProps:m,panelTabsProps:y}},n.usePanelWrapperInnerState=function(e,n){var t,r,o,a=(0,g.useHashedElementId)(g.JokoExtensionElement.panel),i=u.default.useMemo(b.checkIsOnMobileScreen,[]);return(0,C.useSetMomentLocale)(),function(e){u.default.useEffect((function(){return e&&W(),function(){e&&H()}}),[e])}(i),r=(t={onClick:function(){return e("clickOutside")},shouldSkip:!i||n}).onClick,o=t.shouldSkip,u.default.useEffect((function(){if(!o)return window.addEventListener("click",r),function(){window.removeEventListener("click",r)}}),[o]),{elementId:a,isMobileExtension:i}},n.disableWebpageBodyScrolling=W,n.enableWebpageBodyScrolling=H,n.getCssFilterPropertyForTabIconUrl=function(e,n){return n?e?"":(0,d.getCssFilterFromBlackToTargetColor)(d.ColorName.frenchGray):e?(0,d.getCssFilterFromBlackToTargetColor)(d.ColorName.emerald):(0,d.getCssFilterFromBlackToTargetColor)(d.ColorName.frenchGray)},n.useTabIconUrl=function(e,n,t){return u.default.useMemo((function(){var r=n&&t;switch(e){case d.PanelTab.offerSearch:return r?h.MAGNIFYING_GLASS_WITH_SQUARE_GREEN_ICON_URL:h.MAGNIFYING_GLASS_WITH_SQUARE_ICON_URL;case d.PanelTab.offerDetails:return r?h.LIGHTNING_BOLT_FILLED_CIRCLE_GREEN_ICON_URL:h.LIGHTNING_BOLT_FILLED_CIRCLE_BLACK_ICON_URL;case d.PanelTab.products:return r?h.SHOPPING_BAG_GREEN_ICON_URL:h.SHOPPING_BAG_ICON_URL;case d.PanelTab.profile:return r?h.USER_SILHOUETTE_GREEN_ICON_URL:h.USER_SILHOUETTE_ICON_URL}}),[e,n,t])},n.usePanelTabSvgIcon=function(e){return u.default.useMemo((function(){switch(e){case d.PanelTab.offerSearch:return f.default;case d.PanelTab.offerDetails:return p.default;case d.PanelTab.products:return y.default;case d.PanelTab.profile:return m.default}}),[e])},n.useOnClickInsidePanel=function(e){var n=e.panelInnerContainerRef,t=e.onClick,r=e.excludedElementRefs,o=e.shouldAlsoDetectClickOutsidePanel,a=e.dependencyArray,i=u.default.useCallback((function(e){if(e.target){var n=r.some((function(n){var t;return null===(t=null==n?void 0:n.current)||void 0===t?void 0:t.contains(e.target)}));n||t()}}),null!=a?a:[]);u.default.useEffect((function(){return(null==n?void 0:n.current)&&n.current.addEventListener("pointerdown",i),o&&window.addEventListener("click",i),function(){(null==n?void 0:n.current)&&n.current.removeEventListener("pointerdown",i),o&&window.removeEventListener("click",i)}}),[i])}},95752:function(e,n,t){var r=this&&this.__awaiter||function(e,n,t,r){return new(t||(t=Promise))((function(o,a){function i(e){try{c(r.next(e))}catch(e){a(e)}}function s(e){try{c(r.throw(e))}catch(e){a(e)}}function c(e){var n;e.done?o(e.value):(n=e.value,n instanceof t?n:new t((function(e){e(n)}))).then(i,s)}c((r=r.apply(e,n||[])).next())}))},o=this&&this.__generator||function(e,n){var t,r,o,a,i={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return a={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function s(s){return function(c){return function(s){if(t)throw new TypeError("Generator is already executing.");for(;a&&(a=0,s[0]&&(i=0)),i;)try{if(t=1,r&&(o=2&s[0]?r.return:s[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,s[1])).done)return o;switch(r=0,o&&(s=[2&s[0],o.value]),s[0]){case 0:case 1:o=s;break;case 4:return i.label++,{value:s[1],done:!1};case 5:i.label++,r=s[1],s=[0];continue;case 7:s=i.ops.pop(),i.trys.pop();continue;default:if(!(o=i.trys,(o=o.length>0&&o[o.length-1])||6!==s[0]&&2!==s[0])){i=0;continue}if(3===s[0]&&(!o||s[1]>o[0]&&s[1]<o[3])){i.label=s[1];break}if(6===s[0]&&i.label<o[1]){i.label=o[1],o=s;break}if(o&&i.label<o[2]){i.label=o[2],i.ops.push(s);break}o[2]&&i.ops.pop(),i.trys.pop();continue}s=n.call(e,i)}catch(e){s=[6,e],r=0}finally{t=o=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,c])}}},a=this&&this.__read||function(e,n){var t="function"==typeof Symbol&&e[Symbol.iterator];if(!t)return e;var r,o,a=t.call(e),i=[];try{for(;(void 0===n||n-- >0)&&!(r=a.next()).done;)i.push(r.value)}catch(e){o={error:e}}finally{try{r&&!r.done&&(t=a.return)&&t.call(a)}finally{if(o)throw o.error}}return i},i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(n,"__esModule",{value:!0}),n.checkIsProductAndCheckoutWebpage=n.getInitialPanelLocation=n.usePanelLocation=n.checkIsPanelLocation=void 0;var s=i(t(96540)),c=t(55015),u=t(37392),l=t(46239),d=t(82198),p=t(14997);function f(e){var n=e.offer,t=e.isProductPage,r=e.isCheckoutPage,o=e.isBnplSectionEnabledForOffer,a=e.userBnplTransactionsFromLocalStorage,i=e.shouldMakeBnplTabAsDefaultIfUnusedCardExists,s=e.defaultPanelLocationOverride,u=e.excludedPanelTabs,l=function(e){var n=e.offer,t=e.isProductPage,r=e.isCheckoutPage,o=e.isBnplSectionEnabledForOffer,a=e.userBnplTransactionsFromLocalStorage,i=e.shouldMakeBnplTabAsDefaultIfUnusedCardExists,s=e.excludedPanelTabs;if(i&&a&&a.length)return{panelTab:c.PanelTab.offerDetails,offerDetailsSection:c.OfferDetailsSection.bnpl};if(t)return{panelTab:c.PanelTab.offerDetails,offerDetailsSection:c.OfferDetailsSection.product};if(r){if(m(n))return{panelTab:c.PanelTab.offerDetails,offerDetailsSection:c.OfferDetailsSection.coupons};if(o)return{panelTab:c.PanelTab.offerDetails,offerDetailsSection:c.OfferDetailsSection.bnpl};if(h(n))return{panelTab:c.PanelTab.offerDetails,offerDetailsSection:c.OfferDetailsSection.cashback}}else{if(h(n))return{panelTab:c.PanelTab.offerDetails,offerDetailsSection:c.OfferDetailsSection.cashback};if(m(n))return{panelTab:c.PanelTab.offerDetails,offerDetailsSection:c.OfferDetailsSection.coupons};if(o)return{panelTab:c.PanelTab.offerDetails,offerDetailsSection:c.OfferDetailsSection.bnpl}}var u=null==s?void 0:s.includes(c.PanelTab.offerSearch);return u?n?{panelTab:c.PanelTab.offerDetails,offerDetailsSection:c.OfferDetailsSection.cashback}:{panelTab:c.PanelTab.products,offerDetailsSection:c.OfferDetailsSection.cashback}:{panelTab:c.PanelTab.offerSearch,offerDetailsSection:c.OfferDetailsSection.cashback}}({offer:n,isProductPage:t,isCheckoutPage:r,isBnplSectionEnabledForOffer:o,userBnplTransactionsFromLocalStorage:a,shouldMakeBnplTabAsDefaultIfUnusedCardExists:i,excludedPanelTabs:u});(function(e,n){return!!(e&&e.panelTab&&n&&n.includes(e.panelTab))})(s,u)&&(s=void 0);var d=s?s.panelTab:void 0,p=d||l.panelTab,f=s?s.offerDetailsSection:void 0;return{initiallySelectedPanelTab:p,initiallySelectedOfferDetailsSection:f||l.offerDetailsSection,initiallySelectedProductsSection:c.ProductsSection.savedProducts}}function m(e){return y(e)>0}function y(e){var n,t;return(null===(t=null===(n=null==e?void 0:e.browserExtension)||void 0===n?void 0:n.coupons)||void 0===t?void 0:t.itemList)?e.browserExtension.coupons.itemList.length:0}function h(e){return!!e&&e.type!==c.OfferType.NoCashback}n.checkIsPanelLocation=function(e){return"object"==typeof e&&!!e&&(0,c.hasOwnProperty)(e,"panelTab")&&"string"==typeof e.panelTab&&Object.values(c.PanelTab).includes(e.panelTab)&&(0,c.hasOwnProperty)(e,"offerDetailsSection")&&"string"==typeof e.offerDetailsSection&&Object.values(c.OfferDetailsSection).includes(e.offerDetailsSection)},n.usePanelLocation=function(e){var n=e.offer,t=e.defaultPanelLocationOverride,r=e.isProductPage,o=e.isCheckoutPage,i=e.excludedPanelTabs,d=e.isTemporaryUser,p=e.bnpl,m=p.isBnplSectionEnabledForOffer,v=p.userBnplTransactionsFromLocalStorage,_=(0,c.useHasFeature)(c.Feature.bnplNewCardReadyDisplayInExtensions),g=s.default.useMemo((function(){return f({offer:n,isProductPage:r,isCheckoutPage:o,isBnplSectionEnabledForOffer:m,userBnplTransactionsFromLocalStorage:v,shouldMakeBnplTabAsDefaultIfUnusedCardExists:_,defaultPanelLocationOverride:t,excludedPanelTabs:i})}),[n,r,o,m,_,t,i]),b=g.initiallySelectedPanelTab,C=g.initiallySelectedOfferDetailsSection,S=g.initiallySelectedProductsSection,T=a(s.default.useState(b),2),I=T[0],A=T[1],E=a(s.default.useState(C),2),k=E[0],O=E[1],P=a(s.default.useState(S),2),w=P[0],L=P[1];return function(e,n,t){s.default.useEffect((function(){var r=(0,u.setJokoDomEventListener)(u.JokoDomEvent.onJokoPanelLocationChangeRequest,(function(r){var o=r.panelLocation,a=o.panelTab,i=o.offerDetailsSection;(null==t?void 0:t.includes(a))||e(a),n(i)}));return function(){return(0,u.removeJokoDomEventListener)(u.JokoDomEvent.onJokoPanelLocationChangeRequest,r)}}),[])}(A,O,i),function(e,n,t,r,o,a,i){s.default.useEffect((function(){return function(e,n){var t={tab:e,isDefaultTab:e===n};(0,l.sendMessageToBackgroundScript)({message:"logUserEvent",data:{event:{type:"navigatedPanelTabOnBrowserExtension",payload:t}}}),(0,l.sendMessageToBackgroundScript)({message:"logAmplitudeEvent",data:{event:{type:"Browser Extension - Navigated Panel Tab",properties:t}}})}(e,t)}),[e]),s.default.useEffect((function(){return function(e,n,t,r,o){var a={section:e,isDefaultSection:e===n,offerId:t?t.offerId:void 0,offerType:t?t.type:void 0,isTemporaryUser:r,numberOfCouponsAvailable:y(t),isCashbackAvailable:h(t),isBnplAvailable:o};(0,l.sendMessageToBackgroundScript)({message:"logUserEvent",data:{event:{type:"navigatedOfferSectionOnBrowserExtension",payload:a}}}),(0,l.sendMessageToBackgroundScript)({message:"logAmplitudeEvent",data:{event:{type:"Browser Extension - Navigated Offer Section",properties:a}}})}(n,r,o,a,i)}),[n])}(I,k,b,C,n,d,m),{selectedPanelTab:I,setSelectedPanelTab:A,selectedOfferDetailsSection:k,setSelectedOfferDetailsSection:O,selectedProductsSection:w,setSelectedProductsSection:L}},n.getInitialPanelLocation=f,n.checkIsProductAndCheckoutWebpage=function(e){return r(this,void 0,void 0,(function(){var n,t,r;return o(this,(function(o){switch(o.label){case 0:return[4,Promise.all([(0,d.getProductData)(e),(0,p.checkIsCheckoutWebpageAndGetMatchData)(e)])];case 1:return n=a.apply(void 0,[o.sent(),2]),t=n[0].productData,r=n[1].isCheckoutWebpage,[2,{isProductPage:(0,d.checkIsProductWebpageFromProductData)(t),isCheckoutPage:r}]}}))}))}},38543:function(e,n,t){var r=this&&this.__assign||function(){return r=Object.assign||function(e){for(var n,t=1,r=arguments.length;t<r;t++)for(var o in n=arguments[t])Object.prototype.hasOwnProperty.call(n,o)&&(e[o]=n[o]);return e},r.apply(this,arguments)},o=this&&this.__awaiter||function(e,n,t,r){return new(t||(t=Promise))((function(o,a){function i(e){try{c(r.next(e))}catch(e){a(e)}}function s(e){try{c(r.throw(e))}catch(e){a(e)}}function c(e){var n;e.done?o(e.value):(n=e.value,n instanceof t?n:new t((function(e){e(n)}))).then(i,s)}c((r=r.apply(e,n||[])).next())}))},a=this&&this.__generator||function(e,n){var t,r,o,a,i={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return a={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function s(s){return function(c){return function(s){if(t)throw new TypeError("Generator is already executing.");for(;a&&(a=0,s[0]&&(i=0)),i;)try{if(t=1,r&&(o=2&s[0]?r.return:s[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,s[1])).done)return o;switch(r=0,o&&(s=[2&s[0],o.value]),s[0]){case 0:case 1:o=s;break;case 4:return i.label++,{value:s[1],done:!1};case 5:i.label++,r=s[1],s=[0];continue;case 7:s=i.ops.pop(),i.trys.pop();continue;default:if(!(o=i.trys,(o=o.length>0&&o[o.length-1])||6!==s[0]&&2!==s[0])){i=0;continue}if(3===s[0]&&(!o||s[1]>o[0]&&s[1]<o[3])){i.label=s[1];break}if(6===s[0]&&i.label<o[1]){i.label=o[1],o=s;break}if(o&&i.label<o[2]){i.label=o[2],i.ops.push(s);break}o[2]&&i.ops.pop(),i.trys.pop();continue}s=n.call(e,i)}catch(e){s=[6,e],r=0}finally{t=o=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,c])}}},i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(n,"__esModule",{value:!0}),n.useProductAlternativeInnerState=void 0;var s=i(t(96540)),c=t(55015),u=t(77653),l=t(89710),d=t(33931);n.useProductAlternativeInnerState=function(e,n,t,i,p){var f=this,m=e.webpageUrl,y=e.productData,h=y.priceAmount,v=y.priceCurrency,_=(0,c.useLocalizedFormat)();return{priceToDisplay:s.default.useMemo((function(){return h?(0,c.formatProductPrice)(_,h,v):" — "}),[]),onClickAlternative:s.default.useCallback((function(){return o(f,void 0,void 0,(function(){var o,s;return a(this,(function(a){switch(a.label){case 0:return(0,d.logClickedPriceComparisonWebpageEvents)(e,t,i,n,p),(0,c.setLocalStorageItem)(c.LocalStorageKey.lastOpenedProductAlternative,{lastOpenedTimestamp:Date.now(),webpageUrl:m}),[4,(0,u.getMerchantOfferMatchingUrlWithConditionsAndCoupons)(m)];case 1:return(o=a.sent())?((0,l.handleUserInterfaceComponentInteractionInBackground)(r(r({},o),{triggeringEventType:c.UserInterfaceComponentInteractionEventType.priceComparisonAlternativeButton})),[4,(0,c.updateLocalStorageItem)(c.LocalStorageKey.offerActivatedInSessionTimestampMsMap,(s={},s[o.offerId]=Date.now(),s))]):[3,3];case 2:a.sent(),a.label=3;case 3:return window.open(m),[2]}}))}))}),[])}}},87105:function(e,n,t){var r=this&&this.__awaiter||function(e,n,t,r){return new(t||(t=Promise))((function(o,a){function i(e){try{c(r.next(e))}catch(e){a(e)}}function s(e){try{c(r.throw(e))}catch(e){a(e)}}function c(e){var n;e.done?o(e.value):(n=e.value,n instanceof t?n:new t((function(e){e(n)}))).then(i,s)}c((r=r.apply(e,n||[])).next())}))},o=this&&this.__generator||function(e,n){var t,r,o,a,i={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return a={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function s(s){return function(c){return function(s){if(t)throw new TypeError("Generator is already executing.");for(;a&&(a=0,s[0]&&(i=0)),i;)try{if(t=1,r&&(o=2&s[0]?r.return:s[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,s[1])).done)return o;switch(r=0,o&&(s=[2&s[0],o.value]),s[0]){case 0:case 1:o=s;break;case 4:return i.label++,{value:s[1],done:!1};case 5:i.label++,r=s[1],s=[0];continue;case 7:s=i.ops.pop(),i.trys.pop();continue;default:if(!(o=i.trys,(o=o.length>0&&o[o.length-1])||6!==s[0]&&2!==s[0])){i=0;continue}if(3===s[0]&&(!o||s[1]>o[0]&&s[1]<o[3])){i.label=s[1];break}if(6===s[0]&&i.label<o[1]){i.label=o[1],o=s;break}if(o&&i.label<o[2]){i.label=o[2],i.ops.push(s);break}o[2]&&i.ops.pop(),i.trys.pop();continue}s=n.call(e,i)}catch(e){s=[6,e],r=0}finally{t=o=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,c])}}},a=this&&this.__read||function(e,n){var t="function"==typeof Symbol&&e[Symbol.iterator];if(!t)return e;var r,o,a=t.call(e),i=[];try{for(;(void 0===n||n-- >0)&&!(r=a.next()).done;)i.push(r.value)}catch(e){o={error:e}}finally{try{r&&!r.done&&(t=a.return)&&t.call(a)}finally{if(o)throw o.error}}return i},i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(n,"__esModule",{value:!0}),n.PRODUCT_INFO_BUTTON_SIZE=n.useFormattedPriceAndSeparator=n.useOnClickPriceTrackingButton=n.useCurrentWebpageFromLastCapturedData=n.useProductsTabContentSpecificProps=n.useProductsSections=void 0;var s=i(t(96540)),c=t(55015),u=t(47248),l=t(68134),d=t(46239);n.useProductsSections=function(e){var n=(0,c.useLocalizedTexts)().contentscript.redesign.panel.products.selectorBar;return(0,c.useHasFeatureByPlatform)({isMobileExtension:e,desktopFeature:c.Feature.historyOfBrowsedProductsDesktopBrowserExtension,mobileFeature:c.Feature.historyOfBrowsedProductsMobileBrowserExtension})?[{id:u.ProductsSection.savedProducts,displayedText:n.savedProducts},{id:u.ProductsSection.browsedProducts,displayedText:n.browsedProducts}]:[{id:u.ProductsSection.savedProducts,displayedText:n.savedProducts}]},n.useProductsTabContentSpecificProps=function(e){var n=e.isMobileExtension,t=e.selectedPanelTab,r=e.selectedProductsSection,o=e.setSelectedProductsSection,i=(0,c.useSetting)({settingKey:c.SettingKey.blacklistedPriceTrackingDomains}),l=a(s.default.useState(void 0),2),p=l[0],f=l[1],m=(0,c.useHasFeatureByPlatform)({isMobileExtension:n,desktopFeature:c.Feature.historyOfBrowsedProductsDesktopBrowserExtension,mobileFeature:c.Feature.historyOfBrowsedProductsMobileBrowserExtension});return s.default.useEffect((function(){m&&t===u.PanelTab.products&&(0,d.sendMessageToBackgroundScript)({message:"getUserBrowsedProductWebpages"},(function(e){f(e.userBrowsedProductWebpages)}))}),[t]),{userBrowsedProductWebpages:p,setUserBrowsedProductWebpages:f,blacklistedPriceTrackingDomains:i,selectedProductsSection:r,setSelectedProductsSection:o}},n.useCurrentWebpageFromLastCapturedData=function(){var e=a(s.default.useState(void 0),2),n=e[0],t=e[1],i=s.default.useMemo((function(){return(e=n)?{name:e.webpageTitle,imageUrl:e.webpageImageUrl,priceAmount:e.productPriceAmount,priceCurrency:e.productPriceCurrency}:void 0;var e}),[n]);return s.default.useEffect((function(){!function(){r(this,void 0,void 0,(function(){var e,n;return o(this,(function(r){switch(r.label){case 0:return[4,(0,l.getTabId)()];case 1:return(e=r.sent())?[4,(0,c.getLocalStorageItem)(c.LocalStorageKey.capturedWebpageDataByTabIdMap)]:[2];case 2:return(n=r.sent()||{})[e]&&t(n[e]),[2]}}))}))}()}),[]),{currentWebpage:n,productDataFromCurrentWebpage:i}},n.useOnClickPriceTrackingButton=function(e){var n=e.webpageUrl,t=e.loadPriceHistoryAndLogEvents,r=e.currentlyOpenPriceTrackingGraphWebpageUrl,o=e.setCurrentlyOpenPriceTrackingGraphWebpageUrl,i=e.fromComponent,c=a(s.default.useState(!1),2),u=c[0],l=c[1],p=s.default.useCallback((function(e){e.stopPropagation();var t=!u;l(t),t?(!function(e,n){var t={url:e,fromComponent:n};(0,d.sendMessageToBackgroundScript)({message:"logUserEvent",data:{event:{type:"clickedProductWebpagePriceTrackingButton",payload:t}}}),(0,d.sendMessageToBackgroundScript)({message:"logAmplitudeEvent",data:{event:{type:"Webpages - Clicked Product Webpage Price Tracking Button",properties:t}}})}(n,i),o(n)):o(void 0)}),[u,n]);return s.default.useEffect((function(){u&&t(i).then((function(e){e.length||l(!1)}))}),[u]),s.default.useEffect((function(){r!==n&&l(!1)}),[r]),{onClickPriceTrackingButton:p,isPriceTrackingGraphOpen:u}};n.useFormattedPriceAndSeparator=function(e){var n=e.lastPriceData,t=e.productPriceAmount,r=e.productPriceCurrency,o=(0,c.useLocalizedFormat)();return s.default.useMemo((function(){if(t)return(0,c.formatProductPrice)(o,n?n.amount:t,n?n.currency:r)+" — "}),[o,n,t,r])},n.PRODUCT_INFO_BUTTON_SIZE=30},78148:function(e,n,t){var r=this&&this.__awaiter||function(e,n,t,r){return new(t||(t=Promise))((function(o,a){function i(e){try{c(r.next(e))}catch(e){a(e)}}function s(e){try{c(r.throw(e))}catch(e){a(e)}}function c(e){var n;e.done?o(e.value):(n=e.value,n instanceof t?n:new t((function(e){e(n)}))).then(i,s)}c((r=r.apply(e,n||[])).next())}))},o=this&&this.__generator||function(e,n){var t,r,o,a,i={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return a={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function s(s){return function(c){return function(s){if(t)throw new TypeError("Generator is already executing.");for(;a&&(a=0,s[0]&&(i=0)),i;)try{if(t=1,r&&(o=2&s[0]?r.return:s[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,s[1])).done)return o;switch(r=0,o&&(s=[2&s[0],o.value]),s[0]){case 0:case 1:o=s;break;case 4:return i.label++,{value:s[1],done:!1};case 5:i.label++,r=s[1],s=[0];continue;case 7:s=i.ops.pop(),i.trys.pop();continue;default:if(!(o=i.trys,(o=o.length>0&&o[o.length-1])||6!==s[0]&&2!==s[0])){i=0;continue}if(3===s[0]&&(!o||s[1]>o[0]&&s[1]<o[3])){i.label=s[1];break}if(6===s[0]&&i.label<o[1]){i.label=o[1],o=s;break}if(o&&i.label<o[2]){i.label=o[2],i.ops.push(s);break}o[2]&&i.ops.pop(),i.trys.pop();continue}s=n.call(e,i)}catch(e){s=[6,e],r=0}finally{t=o=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,c])}}},a=this&&this.__read||function(e,n){var t="function"==typeof Symbol&&e[Symbol.iterator];if(!t)return e;var r,o,a=t.call(e),i=[];try{for(;(void 0===n||n-- >0)&&!(r=a.next()).done;)i.push(r.value)}catch(e){o={error:e}}finally{try{r&&!r.done&&(t=a.return)&&t.call(a)}finally{if(o)throw o.error}}return i},i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(n,"__esModule",{value:!0}),n.useLineWithSeparatorProps=n.redirectToJokoAppHistoryScreen=n.redirectToJokoApp=n.useOnClickTemporaryUserLoginButton=n.useProfileTabContentSpecificProps=void 0;var s=i(t(96540)),c=t(55015),u=i(t(4279)),l=i(t(56906)),d=i(t(40944)),p=t(62849),f=t(32668),m=t(74137),y=t(66499),h=t(46239);function v(e){var n=e.collectedBalanceInPoints,t=e.pendingBalanceInPoints,r=(0,c.useLocalizedFormat)();return s.default.useMemo((function(){return{collected:_(n,r),pending:_(t,r)}}),[n,t,r])}function _(e,n){if(void 0!==e){var t=e/1e3,r=t>Math.pow(10,3)?Math.floor(t):t;return(0,c.formatCurrencyAmount)({number:r,localizedFormat:n})}}function g(){var e=window.open("joko://","_blank");e&&e.focus()}n.useProfileTabContentSpecificProps=function(e,n){var t=function(e){var n=a(s.default.useState(void 0),2),t=n[0],r=n[1];return function(e,n){s.default.useEffect((function(){if(n){var t=Date.now(),r=void 0;return(0,c.getLocalStorageItem)(c.LocalStorageKey.userDataLastFetchedTimestampMs).then((function(n){r=window.setInterval((0,m.withSentry)((function(){return function(e){var n=e.userDataLastFetchedTimestampMs,t=e.componentMountingTimestampMs,r=e.intervalId,o=e.setUserCollectedPointsBalance;(0,h.sendMessageToBackgroundScript)({message:"getSharedBalanceStatus"},(function(e){var a=e.sharedBalanceStatus;(function(e,n){return!(!(null==e?void 0:e.balancePoints)||!e.lastRefreshTimestampInMs)&&(!n||n<e.lastRefreshTimestampInMs)})(a,n)&&(t<a.lastRefreshTimestampInMs&&clearInterval(r),o(a.balancePoints),(0,c.setLocalStorageItem)(c.LocalStorageKey.userPoints,a.balancePoints))}))}({userDataLastFetchedTimestampMs:n,componentMountingTimestampMs:t,intervalId:r,setUserCollectedPointsBalance:e})})),b)})),function(){r&&clearInterval(r)}}}),[])}(r,e),s.default.useEffect((function(){(0,c.getLocalStorageItem)(c.LocalStorageKey.userPoints).then((function(e){null!==e&&r(e)}))}),[]),t}(n),i=function(e){var n=a(s.default.useState(void 0),2),t=n[0],i=n[1];return s.default.useEffect((function(){!function(e,n){r(this,void 0,void 0,(function(){var t;return o(this,(function(r){switch(r.label){case 0:return[4,(0,c.getLocalStorageItem)(c.LocalStorageKey.userPendingPoints)];case 1:return null!==(t=r.sent())&&e(t),n!==c.PanelTab.profile?[2]:((0,h.sendMessageToBackgroundScript)({message:"getUserPendingPoints"},(function(n){var t=n.userPendingPoints;return e(t||0)})),[2])}}))}))}(i,e)}),[e]),t}(e);return{formattedUserBalance:v({collectedBalanceInPoints:t,pendingBalanceInPoints:i}),collectedBalanceInPoints:t}},n.useOnClickTemporaryUserLoginButton=function(e){return s.default.useCallback((function(){(0,h.sendMessageToBackgroundScript)({message:"logUserEvent",data:{event:{type:"clickedLoginInExtensionProfileTab"}}}),(0,h.sendMessageToBackgroundScript)({message:"logAmplitudeEvent",data:{event:{type:"Registration - Clicked Login In Extension Profile Tab"}}}),e?g():(0,y.openWebAppSignInPage)()}),[e])},n.redirectToJokoApp=g,n.redirectToJokoAppHistoryScreen=function(e){if((0,f.checkIsOnMobileScreen)()){var n=document.createElement("a"),t="https://www.joko.com/link/History/"+encodeURIComponent(JSON.stringify({tabId:e?"pending":"all"}));n.href=t,n.click()}};var b=2e3;n.useLineWithSeparatorProps=function(e){var n=e.isDevStack,t=e.isMobileExtension,r=(0,c.useLocalizedTexts)().contentscript.redesign.panel.profile,o=(0,c.useLocalizedHelpCenterAndTosUrls)(),a=o.helpCenterUrl,i=o.tosUrl,f=(0,p.useExtensionType)(),m=s.default.useCallback((function(e,n){(0,h.sendMessageToBackgroundScript)({message:"openTab",data:{url:e}}),(0,h.sendMessageToBackgroundScript)({message:"logAmplitudeEvent",data:{event:n}})}),[]),y=[{title:r.helpCenter,description:"",iconComponent:d.default,shouldShowIcon:!0,shouldShowSeparator:!0,isMobileExtension:t,onClick:function(){return m(a,{type:"Profile - Clicked FAQ"})}},{title:r.termsOfService,description:"",iconComponent:u.default,shouldShowIcon:!0,shouldShowSeparator:!1,isMobileExtension:t,onClick:function(){return m(i,{type:"Profile - Clicked Terms Of Service"})}}];return f===c.ExtensionType.desktopSafariExtension&&y.push({title:r.manageMyAccount,iconComponent:l.default,shouldShowIcon:!0,shouldShowSeparator:!1,isMobileExtension:t,onClick:function(){return m(n?"https://dev.app.joko.com/home/profile/user-info":"https://app.joko.com/home/profile/user-info",{type:"Profile - Clicked Manage My Account"})}}),y}}}]);