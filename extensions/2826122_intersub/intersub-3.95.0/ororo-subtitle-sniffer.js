(()=>{"use strict";class e{constructor(){this.logDebugMessage=(...e)=>{this.logMessage(t.DEBUG,...e)},this.logInfo=(...e)=>{this.logMessage(t.INFO,...e)},this.logWarn=(...e)=>{this.logMessage(t.WARN,...e)},this.logError=(...e)=>{this.logMessage(t.ERROR,...e)}}}var t;!function(e){e[e.DEBUG=0]="DEBUG",e[e.INFO=1]="INFO",e[e.WARN=2]="WARN",e[e.ERROR=3]="ERROR"}(t||(t={}));const s="x-session";function o(e,t){if(function(){const e=globalThis;if(void 0!==e.cloneInto)return e}()){const s=globalThis.content,o=s?.fetch;if("function"==typeof o)return o(e,t)}return fetch(e,t)}class n extends e{constructor(e,t,s,o,n){super(),this.logServerUrl=e,this.publicTokenProvider=t,this.urlProvider=s,this.pluginDataProvider=o,this.logLevel=n,this.batchSize=50,this.batch=[],this.maxSendTimeout=1e4,this.sendTimeoutId=0,this.messageId=1e3*globalThis.crypto.getRandomValues(new Uint8Array(1))[0],window&&window.addEventListener("beforeunload",(()=>{this.sendBatch()}))}logMessage(e,...s){if(e<this.logLevel)return;const o=t[e],n=[];for(const e of s)e instanceof Error?n.push(JSON.parse(JSON.stringify(e,Object.getOwnPropertyNames(e)))):n.push(e);this.batch.push({eventType:o,timestamp:Date.now(),url:this.urlProvider(),pluginData:this.pluginDataProvider(),messageId:++this.messageId,data:JSON.stringify(n)}),this.sendBatchIfNeeded()}clearSendBatchTimeout(){this.sendTimeoutId&&(clearTimeout(this.sendTimeoutId),this.sendTimeoutId=0)}sendBatchIfNeeded(){this.batch.length<this.batchSize?this.sendTimeoutId||(this.sendTimeoutId=Number(setTimeout((()=>{this.sendBatch()}),this.maxSendTimeout))):this.sendBatch()}sendBatch(){if(this.clearSendBatchTimeout(),!this.batch.length)return;const e=function(e,t,o,n,i,r,a="text/plain"){const g=new URL(o,e);let c=new Headers({"Content-Type":a});i?(c.set("Accept",i),t&&(c=function(e,t){if(!t)return e;const o="Accept",n=e.get(o);if(!n)throw new Error(`Invalid headers object: it doesn't have ${o} header!`);return e.set(o,`${n};${s}=${t}`)||e}(c,t))):t&&t&&c.set(s,t);const d={credentials:"omit",method:n,headers:c};return void 0!==r&&(d.body=JSON.stringify(r)),{url:g.toString(),options:d}}(this.logServerUrl,this.publicTokenProvider(),this.logServerUrl,"POST","application/vnd.intersub.log.response.v1+json",[...this.batch]);this.batch.length=0,o(e.url,e.options)}}var i,r,a;!function(e){e.ALL="ALL",e.YOUTUBE="YOUTUBE",e.COURSERA="COURSERA",e.NETFLIX="NETFLIX",e.HDREZKA="HDREZKA",e.TED="TED",e.KINOPUB="KINOPUB",e.LORD_FILM="LORD_FILM",e.OTHER="OTHER",e.INTERSUB_LANDING="INTERSUB_LANDING",e.INTERSUB_DEV="INTERSUB_DEV",e.SOAP4ME="SOAP4ME",e.TWO_SUB_MOVIE="TWO_SUB_MOVIE",e.INORIGINAL="INORIGINAL",e.AMAZON_PRIME="AMAZON_PRIME",e.LINKEDIN_LEARNING="LINKEDIN_LEARNING",e.UDEMY="UDEMY",e.CRUNCHYROLL="CRUNCHYROLL",e.ORORO="ORORO"}(i||(i={})),function(e){e.getTypeName=function(){return"ExternalVideoServiceType"},e.values=[e.ALL,e.YOUTUBE,e.COURSERA,e.NETFLIX,e.HDREZKA,e.TED,e.KINOPUB,e.LORD_FILM,e.OTHER,e.INTERSUB_LANDING,e.INTERSUB_DEV,e.SOAP4ME,e.TWO_SUB_MOVIE,e.INORIGINAL,e.AMAZON_PRIME,e.LINKEDIN_LEARNING,e.UDEMY,e.CRUNCHYROLL,e.ORORO]}(i||(i={})),function(e){e.SUBS="SUBS"}(r||(r={})),function(e){e.SEND_SUBS="SEND_SUBS",e.INIT="INIT"}(a||(a={}));const g=new class extends e{logMessage(e,...s){switch(e){case t.DEBUG:console.debug("ORORO_SUBTITLES_LOG: debug",e,...s);break;case t.INFO:console.debug("ORORO_SUBTITLES_LOG: info",e,...s);break;case t.WARN:console.debug("ORORO_SUBTITLES_LOG: warn",e,...s);break;case t.ERROR:console.error("ORORO_SUBTITLES_LOG: error",e,...s)}this.sentryLogger?.logMessage(e,s)}setSentryLogger(e){this.sentryLogger=e}},c=new Map;function d(e,t){try{let e;e=(new window.DOMParser).parseFromString(t,"text/html");const s=[...e.querySelectorAll("#player-tracks track[srclang]")].map((e=>({lang:e.getAttribute("srclang"),kind:e.getAttribute("kind"),label:e.getAttribute("label"),src:e.getAttribute("src")}))),o=e.querySelector("video[data-id]");if(!o)return void g.logDebugMessage("ORORO_SUBTITLE: No video element in manifest");const n=o?.getAttribute("data-id");if(!n)return void g.logDebugMessage("ORORO_SUBTITLE: No video[data-id] in manifest");c.set(n.toString(),{videoId:n.toString(),subtitles:s,showTitle:o?.getAttribute("data-title")||"Unknown",episodeTitle:o?.getAttribute("data-media-title")||"Unknown"}),g.logDebugMessage(`ORORO_SUBTITLE: Intercepted manifest for video ${n}`)}catch(t){g.logError(`ORORO_SUBTITLE: Failed to process manifest from ${e}`)}}!function(){const t=new class extends e{logMessage(e,...t){this.sentryLogger&&this.sentryLogger.logMessage(e,t)}setSentryLogger(e){this.sentryLogger=e}};var s;t.logDebugMessage("ORORO_SUBTITLE: startup"),window.addEventListener("is_ororo_command",(e=>{const s=e.detail;switch(t.logDebugMessage(`ORORO_SUBTITLE: Received command ${s.type}`),s.type){case a.SEND_SUBS:{const e=s.data,o=function(e){return c.get(e)}(e);t.logDebugMessage(`ORORO_SUBTITLE: SEND_SUBS for video ${e}. Got manifest: ${!!o}`),o&&(t.logDebugMessage(`ORORO_SUBTITLE: SEND_SUBS for video ${e}. Sending manifest: ${!!o}`),window.dispatchEvent(new CustomEvent("is_ororo_subtitles",{detail:{type:r.SUBS,data:o}})));break}case a.INIT:{const e=s.data;i.ORORO,window.location.href,t.setSentryLogger(new n(e.logServerUrl,(()=>e.publicToken),(()=>window.location.href),(()=>e.pluginData),e.logLevel));break}}})),s=XMLHttpRequest.prototype.open,XMLHttpRequest.prototype.open=function(e,t,o,n,i){let r;r="string"==typeof t?new URL(t,location.href):t;let a=t;const g=new RegExp("^/[^/]+/[^/]+/[^/]+/videos/\\d+$"),c=new RegExp("^/[^/]+/[^/]+/[^/]+/video$");"GET"===e&&(g.test(r.pathname)||c.test(r.pathname))&&this.addEventListener("load",(()=>{"string"==typeof this.response&&this.response&&200===this.status&&d(r.toString(),this.response)}),!1);const l=void 0===o||o;s.apply(this,[e,a,l,n,i])}}()})();