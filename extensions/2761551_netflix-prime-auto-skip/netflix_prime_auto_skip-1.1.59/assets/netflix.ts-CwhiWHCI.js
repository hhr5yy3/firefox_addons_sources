import{s as u}from"./content-script-D7YBjZpd.js";import{s as m,P as y,c as k}from"./shared-functions-50IQFOKT.js";import{u as S,r as g,d as h}from"./storeTypes-CGrbvTi_.js";import"./chunk-QIZ4XBKF-C_NfkaUr.js";import"./_commonjsHelpers-CqkleIqs.js";m(y.Netflix);const{data:l,promise:v}=S("settings",h),x=navigator.userAgent;let c=0;const f=g(1),b=/edg/i.test(x),w={attributes:!0,childList:!0,subtree:!0};async function A(){console.log("%cStreaming enhanced","color: #00aeef;font-size: 2em;"),console.log("Settings",l.value)}async function p(t,e,i){typeof t=="number"&&typeof e=="number"&&e>t&&(console.log(i,e-t),l.value.Statistics[i]+=e-t,u("increaseBadge",{},"background"))}async function q(t=1e3){setTimeout(()=>{c=0},t)}async function C(){var t,e;await v,A(),(t=l.value.Netflix)!=null&&t.profile&&G(),(e=l.value.Netflix)!=null&&e.skipAd&&I(),P.observe(document,w)}const P=new MutationObserver(T);function T(){var i;const t=document.querySelector("video"),e=l.value.Netflix;if(e!=null&&e.profile&&N(),e!=null&&e.skipIntro&&d('[data-uia="player-skip-intro"]',"Intro skipped",!1)&&t){const a=t==null?void 0:t.currentTime;setTimeout(function(){p(a,t==null?void 0:t.currentTime,"IntroTimeSkipped")},600)}if(e!=null&&e.skipRecap&&(d('[data-uia="player-skip-recap"]',"Recap skipped",!1)||d('[data-uia="player-skip-preplay"]',"Recap skipped",!1))&&t){const a=t==null?void 0:t.currentTime;setTimeout(function(){p(a,t==null?void 0:t.currentTime,"RecapTimeSkipped")},600)}e!=null&&e.skipCredits&&d('[data-uia="next-episode-seamless-button-draining"]',"Credits skipped"),e!=null&&e.watchCredits&&d('[data-uia="watch-credits-seamless-button"]',"Credits watched"),e!=null&&e.skipBlocked&&d('[data-uia="interrupt-autoplay-continue"]',"Blocked skipped"),e!=null&&e.speedSlider&&t&&L(t),(i=l.value.Video)!=null&&i.scrollVolume&&t&&B(t)}async function B(t){const e=document.querySelector('[data-uia*="control-volume"] div:not(.enhanced)');if(e){e.classList.add("enhanced");const i=a=>{let n=t.volume;a.deltaY<0?n=Math.min(1,n+.1):n=Math.max(0,n-.1),t.volume=n};e==null||e.removeEventListener("wheel",i),e==null||e.addEventListener("wheel",i)}}function R(t){return new DOMParser().parseFromString("<!doctype html><body>"+t,"text/html").body.textContent}function N(){var e,i,a,n,s,r;const t=document.querySelector("[href*='/YourAccount']");if(t){const o=R(((a=(i=(e=t==null?void 0:t.getAttribute("aria-label"))==null?void 0:e.split("â€“"))==null?void 0:i[0].split("-"))==null?void 0:a[0].slice(0,-1))??"");o&&o!==l.value.General.profileName&&(l.value.General.profilePicture=(s=(n=t==null?void 0:t.firstChild)==null?void 0:n.firstChild)==null?void 0:s.src,console.log("Profile switched to",o,(r=l.value.General)==null?void 0:r.profilePicture),l.value.General.profileName=o,console.log("Profile switched to",o))}}function G(){!window.location.pathname.includes("Profile")&&!window.location.pathname.includes("profile")&&document.querySelectorAll(".profile-name").forEach(e=>{var i,a,n,s,r,o;e.textContent===l.value.General.profileName&&(l.value.General.profilePicture=(r=(s=(n=(a=(i=e==null?void 0:e.parentElement)==null?void 0:i.firstChild)==null?void 0:a.firstChild)==null?void 0:n.style)==null?void 0:s.backgroundImage)==null?void 0:r.slice(5,-2),(o=e==null?void 0:e.parentElement)==null||o.click(),console.log("Profile automatically chosen:",l.value.General.profileName),l.value.Statistics.SegmentsSkipped++,u("increaseBadge",{},"background"))})}function d(t,e,i=!0){const a=document.querySelector(t);return a?(console.log(e,a),a.click(),i&&l.value.Statistics.SegmentsSkipped++,u("increaseBadge",{},"background"),!0):!1}function I(){const t=setInterval(()=>{var s,r;if(!((s=l.value.Netflix)!=null&&s.skipAd)){console.log("stopped observing| Ad"),clearInterval(t);return}const e=document.querySelector("video"),i=Number((r=document.querySelector('span[class*="mmvz9h"]'))==null?void 0:r.textContent);if(e){let o=8;b&&(o=3),(i||c)&&e.paused&&e.play(),i>8&&e.playbackRate!=o?(console.log("Ad skipped, length:",i,"s"),l.value.Statistics.NetflixAdTimeSkipped+=i,l.value.Statistics.SegmentsSkipped++,u("increaseBadge",{},"background"),l.value.Video.epilepsy&&(e.style.opacity="0"),e.muted=!0,e.playbackRate=o,c=i):i>2&&e.playbackRate<2?(e.playbackRate=i/2,c=i):(i<=2||!i&&c)&&(e.muted=!1,e.playbackRate=f.value,c=0,l.value.Video.epilepsy&&(e.style.opacity="1"))}const a=document.querySelector('div[data-uia="pause-ad-title-display"]'),n=document.querySelector('button[data-uia="pause-ad-expand-button"]');n&&(a!=null&&a.checkVisibility({opacityProperty:!0}))&&(!e||e.paused&&c!=e.currentTime/10)&&(e&&(c=e.currentTime/10),q(),n.click(),console.log("Remove Video Paused ad",n),l.value.Statistics.SegmentsSkipped++,u("increaseBadge",{},"background"),setTimeout(()=>{const o=e||document.querySelector("video");o==null||o.pause()},100))},100)}const V="display: none;width:200px;",E="font-size: 3em;padding: 0 5px;margin: unset;align-content: center;";function L(t){var i,a,n,s;if(!document.querySelector("#videoSpeedSlider")){const r=(a=(i=document.querySelector('[data-uia="controls-standard"]'))==null?void 0:i.firstChild)==null?void 0:a.children;if(r){const o=(s=(n=r[r.length-2])==null?void 0:n.firstChild)==null?void 0:s.lastChild;o&&k(t,f,o,V,E)}}}C();
