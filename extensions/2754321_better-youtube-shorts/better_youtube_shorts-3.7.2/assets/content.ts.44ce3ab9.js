import{B as ee}from"./browser.cf86e89d.js";import{c as te,s as V,I,r as w,w as R,V as A,l as ne,C as x,a as g,D as re,b as oe,d as ie,e as le,f as ae}from"./retrieveFromStorage.7e5bd4fa.js";function l(){const e=document.querySelector("#shorts-player > div.html5-video-container > video");if(e===null)return null;const t=e.closest("ytd-reel-video-renderer");return t===null?null:+t.id}function M(){var n,i,a;const e=document.querySelector(`[id="${l()}"] > div.overlay.style-scope.ytd-reel-video-renderer > ytd-reel-player-overlay-renderer #like-button`),t=(a=(i=(n=e==null?void 0:e.firstElementChild)==null?void 0:n.innerText.split(/\r?\n/)[0])==null?void 0:i.trim().replace(/\s/g,"").replace(/\.$/,"").toLowerCase())!=null?a:"0",r=te(t);return isNaN(r)?0:r}const $=()=>document.querySelector(`[id="${l()}"]  > div.overlay.style-scope.ytd-reel-video-renderer #actions`);function D(){return document.querySelector(`[id="${l()}"]  > div.overlay.style-scope.ytd-reel-video-renderer > ytd-reel-player-overlay-renderer #overlay`)}function ce(){return document.querySelector(`[id="${l()}"] h2.title > yt-formatted-string`)}function j(){const e=l();return document.querySelector(`[id="${e}"] #player-container div.player-controls > ytd-shorts-player-controls.style-scope`)}function z(){return document.querySelector("#navigation-button-down > ytd-button-renderer > yt-button-shape")}function se(){return document.querySelector("#navigation-button-up > ytd-button-renderer > yt-button-shape")}function U(){return document.getElementById(`bys-ytViews${l()}`)}function ue(){return document.getElementById("page-manager")}function s(){return document.querySelector("#shorts-player>div>video")}function de(){const e=l();return document.getElementById(`ytPlayback${e}`)}function K(){const e=l();return document.getElementById(`volumeSliderController${e}`)}function B(){return document.querySelector(`[id="${l()}"] #progress-bar-line`)}function fe(){return document.querySelector(`[ id="${l()}" ] #comments-button .yt-spec-touch-feedback-shape__fill`)}function me(){return document.querySelector(`[id="${l()}"] #overlay reel-player-header-renderer`)}function ye(){var e,t;return(t=(e=document.querySelector("#factoids > view-count-factoid-renderer > factoid-renderer > div"))==null?void 0:e.getAttribute("aria-label"))!=null?t:""}function pe(){var r,n;const e=document.querySelector("#factoids > factoid-renderer:nth-child(3) > div"),t=document.querySelector("#factoids > upload-time-factoid-renderer > factoid-renderer > div");return(n=(r=e==null?void 0:e.getAttribute("aria-label"))!=null?r:t==null?void 0:t.getAttribute("aria-label"))!=null?n:""}function q(e,t){const r=s();r!==null&&(!t||((e==null?void 0:e.volume)!==null?r.volume=e.volume:e.volume=r.volume))}function E(e,t,r){t=t>1?1:t,t=t<0?0:t,e.volume=t;const n=K();if(n===null)return;const i=s();n.value=""+e.volume,i!==null&&(q(e,r),V(e))}function be(e){const t=K();t!==null&&(t.classList.remove(e?"vertical":"horizontal"),t.classList.add(e?"horizontal":"vertical"),t.setAttribute("orient",e?"horizontal":"vertical"))}function he(e,t,r,n){if(!n)return;const i=l();if(i===null)return;const a=j();if(!a)return;a.setAttribute(I,"");const o=w(`
    <input
      id="volumeSliderController${i}"
      type="range"
      class="volume-slider betterYT-volume-slider ${r?"horizontal":"vertical"}"
      min="0"
      max="1"
      step="0.01"
      orient="${r?"horizontal":"vertical"}"
      value="${t.volume}"
    />
  `);t.volume===null&&(t.volume=.5),a.appendChild(o),o.addEventListener("input",u=>E(t,u.target.valueAsNumber,n)),o.addEventListener("click",u=>u.stopPropagation()),R(o,()=>{const u=s();u!==null&&E(t,u.volume+A,n)},()=>{const u=s();u!==null&&E(t,u.volume-A,n)})}function G(){const e=ue();if(!e)return;document.fullscreenElement===e?document.exitFullscreen():e.requestFullscreen()}function O(){const e=s();return e===null?!1:e.currentTime>.5&&e.duration>1}function ve(){const e=s();return e===null?!1:e.currentTime>=e.duration-.25}function X(){var e;(e=z())==null||e.click()}function ke(){var e;(e=z())==null||e.click()}function Se(){var e;(e=se())==null||e.click()}function ge(){const e=s();if(e===null)return!1;e.currentTime=0}function Ee(e,t,r,n,i,a){if([...document.querySelectorAll("input")].includes(document.activeElement)||[...document.querySelectorAll("#contenteditable-root")].includes(document.activeElement)||t!==null&&!t.keybinds)return;const o=s();if(!o)return;const u=e.code,h=e.key.toLowerCase();let m;for(const[v,k]of Object.entries(r))(u===k||h===k)&&(m=v);if(!m)return;const y=t!==null&&t.volumeSlider;switch(m){case"seekBackward":o.currentTime-=i.seekAmount;break;case"seekForward":o.currentTime+=i.seekAmount;break;case"decreaseSpeed":o.playbackRate>.25&&(o.playbackRate-=.25);break;case"resetSpeed":o.playbackRate=1;break;case"increaseSpeed":o.playbackRate<16&&(o.playbackRate+=.25);break;case"increaseVolume":o.volume<1&&E(n,o.volume+A,y),o.volume>1&&(o.volume=1);break;case"decreaseVolume":o.volume>0&&E(n,o.volume-A,y),o.volume<0&&(o.volume=0);break;case"toggleFullScreen":{G();break}case"previousFrame":o.paused&&(o.currentTime-=.04);break;case"nextFrame":o.paused&&(o.currentTime+=.04);break;case"nextShort":ke();break;case"previousShort":Se();break;case"restartShort":ge();break}a.playbackRate=o.playbackRate}function J(e){const t=de();return t===null?!1:(t.innerText=`${e.playbackRate}x`,!0)}function Te(e,t){const r=l(),n=s();if(n===null)return;if(document.getElementById(`ytTimer${r}`)===null)return!1;const i=document.getElementById(`ytTimer${r}`);return!t&&i||(e.currTime=Math.floor(n.currentTime),i.innerText=`${e.currTime}/${Math.round(n.duration)}s`),!0}function Ie(e,t){Le(e,t)&&Ce()}function Ce(){var e;(e=fe())==null||e.click()}function Le(e,t){const r=l();return!(t===null||!t.automaticallyOpenComments||r===e.skippedId||r===e.openedCommentsId||(e.openedCommentsId=r,Ae()))}function Ae(){var e;return(e=document.querySelector(`[ id="${l()}" ] #watch-while-engagement-panel  [ visibility="ENGAGEMENT_PANEL_VISIBILITY_EXPANDED" ]`))!=null?e:!1}function xe(e,t,r){if(!r||!t.autoplay)return;const n=l();n!==null&&e.skippedId!==n&&(e.skippedId=n,X())}function Re(){if(s()===null)return!1}function we(e,t){var i;if(!t)return;const r=$(),n=w(`
    <div>
      <label class="autoplay-switch">
        <input type="checkbox" id="autoplay-checkbox${l()}" ${e.autoplay?"checked":""}/>
        <span class="autoplay-slider"></span>
      </label>
      <div class="yt-spec-button-shape-with-label__label">
        <span 
          role="text"
          class="betterYT-auto yt-core-attributed-string yt-core-attributed-string--white-space-pre-wrap yt-core-attributed-string--text-alignment-center"
        > ${ne("autoplay")} </span>
      </div>
    </div>
  `);r.insertBefore(n,r.children[0]),(i=document.getElementById(`autoplay-checkbox${l()}`))==null||i.addEventListener("change",a=>{e.autoplay=a.target.checked,V(e)})}function $e(e){const t=s();t!==null&&e.fullScreenDoubleClick&&t.addEventListener("dblclick",G)}function Be(e){const t=me();t!==null&&(e.hideShortsOverlay?t.classList.add("betterYT-hidden"):t.classList.remove("betterYT-hidden"))}function Oe(e,t,r){var _,Y;const n=l(),i=$(),a=s();if(!i||!a)return;i.setAttribute(I,"");const o=document.createElement("div");o.id="betterYT-container",o.setAttribute("class","button-container style-scope ytd-reel-player-overlay-renderer");const u=document.createElement("div");u.setAttribute("class","betterYT-renderer style-scope ytd-reel-player-overlay-renderer");const h=document.createElement("div");h.setAttribute("class","betterYT-button-shape");const m=document.createElement("label");m.setAttribute("class","yt-spec-button-shape-with-label");const y=document.createElement("button");y.setAttribute("class","yt-spec-button-shape-next yt-spec-button-shape-next--tonal yt-spec-button-shape-next--mono yt-spec-button-shape-next--size-l yt-spec-button-shape-next--icon-button ");const v=document.createElement("p");v.classList.add("betterYT"),v.id=`ytPlayback${n}`,y.style.display=r.playbackRate===!1?"none":"";const k=(_=document.location.pathname)==null?void 0:_.match(/\/shorts\/(.+)$/);if(k){const c=ce(),p=document.createElement("a");p.href=`https://youtube.com/watch?v=${k[1]}`,p.style.color="inherit",p.style.textDecoration="none",(Y=c.parentNode)==null||Y.insertBefore(p,c),p.appendChild(c)}const S=document.createElement("div");S.classList.add("yt-spec-button-shape-with-label__label");const C=document.createElement("span");C.setAttribute("class","yt-core-attributed-string yt-core-attributed-string--white-space-pre-wrap yt-core-attributed-string--text-alignment-center yt-core-attributed-string--word-wrapping"),C.id=`ytTimer${l()}`,C.setAttribute("role","text"),S.style.display=r.timer?"":"none !important",S.appendChild(C),y.appendChild(v),m.appendChild(y),m.appendChild(S),h.appendChild(m),u.appendChild(h),o.appendChild(u),i.insertBefore(o,i.children[0]),we(t,r.autoplay),r.playbackRate&&(a.playbackRate=e.playbackRate),J(e),o.addEventListener("click",()=>{const c=x.indexOf(a.playbackRate);if(c!==-1){const p=(c+1)%x.length;e.playbackRate=x[p];return}e.playbackRate=1}),r.timer&&R(y,()=>{const c=s();c!==null&&(c.playbackRate<16&&(c.playbackRate+=.25),e.playbackRate=c.playbackRate)},()=>{const c=s();c!==null&&(c.playbackRate>.25&&(c.playbackRate-=.25),e.playbackRate=c.playbackRate)}),R(S,()=>{const c=s();c!==null&&(c.currentTime+=1)},()=>{const c=s();c!==null&&(c.currentTime-=1)})}function Ne(e){var n;if(!O())return;const t=D(),r=document.createElement("h5");r.id=`bys-ytViews${l()}`,r.setAttribute(I,""),(n=t.querySelector("reel-player-header-renderer h2"))==null||n.prepend(r),_e(e)}function _e(e){const t=U();if(t===null)return;const r=[];if(e.viewCounter){const n=ye().replace(/(\r\n|\n|\r)/gm,"");n&&r.push(n)}if(e.uploadDate){const n=pe().replace(/(\r\n|\n|\r)/gm,"");n&&r.push(n)}t.innerText=r.join(" | ")}function Ye(e){if(!e)return;const t=D(),r=s();if(!t||r===null)return;const n=B();if(!n)return;const i=n.children[0],a=n.children[1];n.setAttribute(I,"");const o=t.children[1],u=w('<div class="betterYT-timestamp-tooltip"></div>');n.appendChild(u),o.style.marginBottom="-7px",n.style.height="10px",n.style.paddingTop="2px",n.classList.add("betterYT-progress-bar"),i.classList.add("betterYT-progress-bar"),a.classList.add("betterYT-progress-bar"),Pe({progressBar:n,pbBackground:i,pbForeground:a,tooltip:u})}function Pe({progressBar:e,pbBackground:t,pbForeground:r,tooltip:n}){const i=s();i!==null&&(e.addEventListener("mouseover",()=>{t.classList.add("betterYT-progress-bar-hover"),r.classList.add("betterYT-progress-bar-hover")}),e.addEventListener("mousemove",a=>{let o=a.clientX-i.getBoundingClientRect().left;o<0&&(o=0),o>i.clientWidth&&(o=i.clientWidth);const u=(o/i.clientWidth*i.duration).toFixed(1);n.textContent=`${u}s`,o-n.offsetWidth/2>i.clientWidth-n.offsetWidth?n.style.left=`${i.clientWidth-n.offsetWidth}px`:o-n.offsetWidth/2<=0?n.style.left="0px":n.style.left=`${o-n.offsetWidth/2}px`,n.style.bottom="12px",n.style.display="block"}),e.addEventListener("mouseout",()=>{t.classList.remove("betterYT-progress-bar-hover"),r.classList.remove("betterYT-progress-bar-hover"),n.style.display="none"}),e.addEventListener("click",a=>{let o=a.clientX-i.getBoundingClientRect().left;o<0&&(o=0),o>i.clientWidth&&(o=i.clientWidth),i.currentTime=o/i.clientWidth*i.duration}))}function Fe(){var e;(e=B())==null||e.removeAttribute("hidden")}function We(e,t,r,n){if(e.lastTime=-1,l()===null)return;Object.values(g).map(o=>Ve(o,e,t,r,n))}function L(e){return e!==null&&e.hasAttribute(I)}function Ve(e,t,r,n,i){switch(e){case g.ACTION_ELEMENT:L($())||Oe(t,r,i);break;case g.PROGRESS_BAR:L(B())||Ye(i.progressBar);break;case g.VOLUME_SLIDER:L(j())||he(t,r,i.showVolumeHorizontally,i.volumeSlider);break;case g.INFO:L(U())||Ne(i);break}}function Me(e,t){const r=l(),n=M();if(r!==null)return!(t===null||!O()||!t.skipEnabled||e.topId===0||r<e.topId||e.skippedId===r||n===null||isNaN(n)||n>=t.skipThreshold)}function De(e,t){const r=M();Me(e,t)&&(console.log("[BYS] :: Skipping short that had",r,"likes"),e.skippedId=l(),X())}function H(){if(window.location.toString().indexOf("youtube.com/shorts/")<0)return;const e=s(),t=l();e!==null&&t!==null&&(f.topId<t&&(f.topId=t),O()&&(De(f,d),Ie(f,d)),ve()&&xe(f,T,b.autoplay),Te(f,b.timer),We(f,T,d,b),$e(d),Fe(),Re(),Be(d))}const f=new Proxy(re,{set(e,t,r){e[t]=r;const n=s();if(n!==null)switch(t){case"playbackRate":n.playbackRate=r,J(f);break}return!0}});let N,d,T,b;oe(e=>{N=e});ie(e=>{d=e,typeof d.defaultPlaybackRate=="number"&&(f.playbackRate=d.defaultPlaybackRate)});le(e=>{T=e});ae(e=>{b=e});ee.runtime.onMessage.addListener(e=>{e!=null&&e.keybinds&&(N=e.keybinds),e!=null&&e.options&&(d=e.options),e!=null&&e.features&&(b=e.features),je()});document.addEventListener("keydown",e=>Ee(e,b,N,T,d,f));let P=setInterval(Z,1e3),F=setInterval(H,100),W=setInterval(Q,10);function Q(){window.location.toString().indexOf("youtube.com/shorts/")<0||s()&&q(T,b.volumeSlider)}function Z(){be(d.showVolumeHorizontally)}function je(){clearInterval(W),W=setInterval(Q,10),clearInterval(F),F=setInterval(H,100),clearInterval(P),P=setInterval(Z,1e3)}
