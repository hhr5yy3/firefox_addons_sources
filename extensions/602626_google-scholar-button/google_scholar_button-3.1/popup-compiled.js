(function(){/*

 Copyright The Closure Library Authors.
 SPDX-License-Identifier: Apache-2.0
*/
'use strict';function k(a){var b=typeof a;return"object"==b&&null!=a||"function"==b};class aa{getMessage(a,b){return browser.i18n.getMessage(a,b)}};function ba(a,b){a.a.textContent=b;b=a.a.innerHTML;return b.replace(a.j,(c,d)=>"<"+d+">").replace(a.b,(c,d)=>"&"+d+";")}class ca{constructor(){this.j=/&lt;(\/?(b|i|em|br))&gt;/gi;this.b=/&amp;([a-z0-9]+|#[0-9]+);/gi;this.a=document.createElement("div")}};class q{constructor(a){this.a=a}}var u=new q("A"),da=new q("BUTTON"),v=new q("DIV"),ea=new q("FORM"),fa=new q("INPUT"),ha=new q("IMG"),ia=new q("TABLE"),ja=new q("TH");const w=/([?&]oi=)([^&]+)/;function x(a){return(a.match(w)||["","",""])[2]}function y(a){return a.replace(w,"$1gsb"+("gsb20">=x(a)?"00":"50"))}function z(a,b){return y(a)==y(b)}function A(a,b){a=document.createElement(a);a.className=b;return a}function C(a,b){a=document.createElement(a.a);a.id=b;return a}function D(a,b,c=""){const d=document.createElement("a");d.setAttribute("href",a);d.textContent=b;c&&(d.className=c);return d}
function ka(a,b){const c=document.createElement("a");c.setAttribute("href",a);c.innerHTML=b;return c}function E(a,b){const c=b.length;for(let d=0;d<c;d++)a.appendChild(b[d])}function la(a,b,c){var d=new XMLHttpRequest;d.open(b?"POST":"GET","https://scholar.google.com/"+a,!0);d.onreadystatechange=()=>{4==d.readyState&&c(d.status,d.responseText)};d.timeout=3E4;b&&d.setRequestHeader("Content-Type","application/x-www-form-urlencoded");b?d.send(b):d.send()}
function F(a,b){let c=null;if(200==a){try{c=JSON.parse(b)}catch(d){}if("object"!=typeof c||c instanceof Array)c=null}return c};var G=class{constructor(a,b,c){this.type=a;this.a=b;this.time=c}},H=class{constructor(a,b){this.a=a;this.time=b}};function I(a){const b=a.b.slice(a.a+1);a.b=a.b.slice(0,a.a+1);const c=a.o();var d=a.b.length-20;let e=0;for(;e<a.b.length&&36E5<c-a.b[e].time;)e+=1;d=Math.max(d,e);0<d&&(b.push(...a.b.slice(0,d)),a.b=a.b.slice(d,a.a+1),a.a=Math.max(a.a-d,-1));J(a,b);for(let f in a.j)36E5<c-a.j[f].time&&delete a.j[f]}
function J(a,b){const c={};for(var d=0;d<a.b.length;d++)c[a.b[d].a]=!0;for(d=0;d<b.length;d++){const e=b[d].a;c[e]||(a.A["history-link-"+y(e)]=null)}}function L(a){return a.b[a.a]||new G("home","",a.o())}function ma(a){const b=a.b;a.b=[];a.a=-1;a.j={};J(a,b)}function M(a,b,c){a.A["history-link-"+y(b)]=c}function na(a){a.a+1<a.b.length&&(a.a+=1)}function oa(a){0<a.a&&--a.a}function N(a,b,c){a.j[b]=new H(c,a.o())}
var pa=class{constructor(a=Date.now){this.b=[];this.a=-1;this.j={};this.A={};this.o=a}add(a,b){-1!=this.a&&z(this.b[this.a].a,b)||(this.a+=1,this.b[this.a]=new G(a,b,this.o()),I(this))}replace(a,b){if(!(0>this.a)){--this.a;var c=this.b.slice(this.a+1);this.b=this.b.slice(0,this.a+1);J(this,c);this.add(a,b)}}};function qa(a){a.S.get(["authuser","history","history-index","history-patch-map"],b=>{b=b||{};a.J=b.authuser||"0";var c=a.b,d=b["history-index"],e=b["history-patch-map"];if("number"==typeof d&&Number.isInteger(d)){b=b.history;var f=[];if(Array.isArray(b))for(var h=0;h<b.length;h++){var g=b[h];"string"==typeof g.t&&"string"==typeof g.l&&"number"==typeof g.s&&f.push(new G(g.t,g.l,g.s))}b=f;c.b=b;c.a=0<=d&&d<c.b.length?d:-1;d={};if(Array.isArray(e))for(b=0;b<e.length;b++)f=e[b],"string"==typeof f.d&&
"string"==typeof f.c&&"number"==typeof f.t&&(d[f.d]=new H(f.c,f.t));e=d;c.j=e}I(c);c=document.body;c.setAttribute("dir",a.a.getMessage("@@bidi_dir"));c.innerHTML="";e=C(v,"header");d=C(da,"search-button");d.type="submit";E(a.A,[a.V]);E(a.P,[d,a.I,a.A]);E(e,[a.P]);b=C(v,"middle");E(b,[a.j,a.H]);f=C(v,"footer");h=C(v,"progress-inc");g=C(v,"progress-dec");E(a.Z,[h,g]);h=C(v,"footer-buttons");for(const l of[a.o,a.B])l.setAttribute("href","#"),l.setAttribute("role","button");O(a);P(a,"");a.R.setAttribute("href",
"/scholar_settings?oi=gsb&"+Q(a));a.O.setAttribute("href","/scholar?scilib=1&"+Q(a));E(h,[a.o,a.B,a.C,a.O,a.R]);E(f,[a.D,a.Z,h]);E(c,[e,b,f]);document.title=a.a.getMessage("853");d.title=a.a.getMessage("920");a.A.title=a.a.getMessage("1300");a.o.title=a.a.getMessage("1298");a.B.title=a.a.getMessage("1299");a.O.title=a.a.getMessage("732");a.C.title=a.a.getMessage("1108");a.R.title=a.a.getMessage("1301");a.P.addEventListener("submit",a.ba.bind(a));c.addEventListener("click",a.W.bind(a));c.addEventListener("auxclick",
a.W.bind(a));c.addEventListener("focus",a.$.bind(a),!0);R(a,!0);void 0!==a.Y&&S(a,a.Y)})}function O(a){a.o.classList.toggle("disabled",!(0<a.b.a));var b=a.b;a.B.classList.toggle("disabled",!(b.a+1<b.b.length))}function P(a,b){b=b.replace(/([?&])(output|hl|authuser)=[^&]*/g,"$1").replace(/([?&])&+/g,"$1").replace(/&$/,"");a.C.setAttribute("href","/"+(b+(0<=b.indexOf("?")?"&":"?"))+(x(b)?"":"oi=gsb&")+(b?"lookup=0&":"")+Q(a))}
function Q(a){const b="0"==a.J?"":"&authuser="+a.J;a=a.a.getMessage("@@ui_locale");0<=["pt-BR","pt-PT","zh-CN","zh-TW"].indexOf(a)||(a=a.split("-")[0],a={fil:"tl",he:"iw",nb:"no",nn:"no"}[a]||a);return"hl="+a+b}function R(a,b){document.body.classList.toggle("busy",b);T(a,"");U(a,"");a.H.classList.toggle("busy",b)}function S(a,b){V(a,b);a.I.focus();P(a,"gsb20">=x(b)?"?oi=gsb00":b);ra(a,b||"scholar?oi=gsb00&q=")}function T(a,b){a.H.textContent=b}
function U(a,b,c=""){clearTimeout(a.X);a.X=setTimeout(()=>{a.D.innerHTML=""},3E3);a.D.innerHTML=b;a.D.className=c}function sa(a){T(a,a.a.getMessage("1107")+" ");a.H.appendChild(D(a.C.getAttribute("href"),a.a.getMessage("1108")))}function V(a,b){b=ta(b);a.I.value=b}function ra(a,b){R(a,!0);b=b+(0<=b.indexOf("?")?"&":"?")+"output=gsb&"+Q(a);a.b.add("search",b);W(a);O(a);a.F(b,"",a.N.bind(a,b))}
function W(a){const b={},c=[];{var d=a.b;const g=d.A;var e=d.b;var f=[];for(let l=0;l<e.length;l++){const r=e[l];f.push({t:r.type,l:r.a,s:r.time})}e=f;g.history=e;g["history-index"]=d.a;e=d.j;f=[];for(h in e)f.push({d:h,c:e[h].a,t:e[h].time});var h=f;g["history-patch-map"]=h;d.A={};d=g}for(let g in d)null!=d[g]?b[g]=d[g]:c.push(g);a.S.set(b);browser.storage.local.remove(c)}
function ua(a,b){R(a,!0);b="scholar?q=info:"+encodeURIComponent(b)+":scholar.google.com/&output=gsb-cite&"+Q(a);a.b.add("cite",b);W(a);O(a);P(a,b);V(a,b);a.F(b,"",a.K.bind(a,b))}function va(a,b){return"#citations?update_op=library_add&citilm=1&xsrf="+encodeURIComponent(a.T)+"&info="+encodeURIComponent(b)+"&user="+encodeURIComponent(a.G)+"&"+Q(a)}
function wa(a,b){return"#citations?update_op=trash_citations&citilm=1&json=&xsrf="+encodeURIComponent(a.T)+"&s="+encodeURIComponent(a.G)+":"+encodeURIComponent(b)+"&"+Q(a)}function xa(a,b,c){b.classList.contains("spin")||(b.classList.add("spin"),a.D.innerHTML="",a.F(c,"",a.aa.bind(a,b)))}function ta(a){return"gsb20">=x(a)||0<a.indexOf("&output=gsb-cite")?"":decodeURIComponent((a.match(/^.*[?&]q=([^&]+).*$/)||["",""])[1].replace(/[+]/g,"%20"))}function X(a,b){return ba(a.da,(b||"")+"")}
function ya(a,b,c,d){const e="history-link-"+y(b);a.S.get(e,f=>{f=(f||{})[e];"string"==typeof f?c(f):d()})}
class za{constructor(a,b,c,d){this.a=a;this.ca=b;this.F=c;this.da=new ca;this.S=d;this.C=C(u,"full-screen");this.R=C(u,"settings");this.O=C(u,"library");this.o=C(u,"back");this.B=C(u,"forward");this.A=C(u,"account");this.V=C(ha,"account-img");this.Z=C(v,"progress");this.P=C(ea,"search-form");this.I=C(fa,"search-box");this.j=C(v,"main");this.H=C(v,"message");this.D=C(v,"library-message");this.T=this.G="";this.X=0;this.b=new pa;qa(this)}N(a,b,c,d=!1){function e(K,B){K&&(B.firstChild&&B.appendChild(document.createTextNode(" ")),
B.appendChild(K))}if(z(L(this.b).a,a)){this.j.innerHTML="";R(this,!1);var f=F(b,c)||{};b=f.r;if(b instanceof Array&&!f.L){var h=Math.min(b.length,3);this.G=(f.u||"")+"";this.T=(f.x||"")+"";this.V.src=(f.p||"")+""||"https://lh3.googleusercontent.com/a/default-user=s64";this.A.setAttribute("href","https://accounts.google.com/"+(this.G?"SignOutOptions":"Login")+"?continue="+encodeURIComponent("https://scholar.google.com"+this.C.getAttribute("href"))+"&"+Q(this));if(!d&&!ta(a)&&!a.match(/[?&]title=/)){if(0>=
h||!f.h){this.b.replace("home","");O(this);W(this);return}P(this,a)}M(this.b,L(this.b).a,c);for(a=0;a<h;a++){var g=b[a];if(!k(g))continue;var l=X(this,g.t),r=(g.u||"")+"";const K=X(this,g.x);var t=X(this,g.m),n=X(this,g.s),m=g.l||{};if(l&&k(m)){c={};for(let B in m)f=m[B],k(f)&&(c[B]=D((f.u||"")+"",(f.l||"")+"",B));f=A("div","result");var p=void 0;if(this.G&&m.f&&k(m.f)&&m.f.u&&(g=(g.c||"")+"",m=(m.f.u+"").substring(2))){if(p=this.b.j[m])d?g=p.a:N(this.b,m,g);g?(p=D(wa(this,g),"","library-star"),p.classList.add("saved"),
p.setAttribute("title",this.a.getMessage("96"))):(p=D(va(this,m),"","library-star"),p.setAttribute("title",this.a.getMessage("64")));p.setAttribute("data-docid",m)}m=A("h3","result-title");g="";K&&(g=A("span","result-marker"),g.innerHTML="["+K+"]",g=g.outerHTML+" ");l=g+l;r?(r=ka(r,l),m.appendChild(r)):m.innerHTML=l;f.appendChild(m);t&&(r=A("div","result-metadata"),r.innerHTML=t,f.appendChild(r));n&&1==h&&(t=A("div","result-snippet"),t.innerHTML=n,f.appendChild(t));n=A("div","result-links");p&&(p.innerHTML=
'<svg viewBox="0 0 16 16"><path d="M8 11.57l3.824 2.308-1.015-4.35 3.379-2.926-4.45-.378L8 2.122 6.261 6.224l-4.449.378 3.379 2.926-1.015 4.35z"/></svg>',p.setAttribute("role","button"),e(p,n));if(t=c.f)t.innerHTML='<svg viewBox="0 0 16 16"><path d="M1.5 3.5v5h2v.375L1.75 12.5h3L6.5 8.875V3.5zM9.5 3.5v5h2v.375L9.75 12.5h3L14.5 8.875V3.5z"/></svg>'+t.innerHTML,t.setAttribute("role","button"),e(t,n);e(c.c,n);e(c.r,n);e(c.v,n);n.firstChild&&f.appendChild(n);n=A("div","result-access");e(c.g,n);e(c.l,
n);n.firstChild&&f.appendChild(n);this.j.appendChild(f)}}this.j.firstChild||T(this,this.a.getMessage("1109"));W(this)}else sa(this)}}K(a,b,c){if(z(L(this.b).a,a)){this.j.innerHTML="";R(this,!1);var d=F(b,c)||{};b=d.l;a=d.i||[];if(b instanceof Array&&a instanceof Array&&!d.L){d=Math.min(b.length,5);M(this.b,L(this.b).a,c);W(this);c=C(ia,"cite");for(var e=0;e<d;e++){var f=b[e];if(!k(f))continue;var h=X(this,f.l);f=X(this,f.h);if(!h||!f)continue;const g=c.insertRow();g.tabIndex=0;const l=document.createElement(ja.a);
l.scope="row";l.innerHTML=h;g.appendChild(l);g.insertCell(-1).innerHTML=f}b=Math.min(a.length,5);d=C(v,"import");for(e=0;e<b;e++)h=a[e],k(h)&&(d.firstChild&&d.appendChild(document.createTextNode(" ")),d.appendChild(D((h.u||"")+"",(h.l||"")+"")));c.firstChild?(this.j.appendChild(c),this.j.appendChild(d)):T(this,this.a.getMessage("1109"))}else sa(this)}}aa(a,b,c){a.classList.remove("spin");const d=F(b,c)||{};c=a.getAttribute("data-docid")||"";const e=a.classList.contains("saved");d.L?(a=this.a.getMessage(e?
"1289":"1287"),U(this,a,"error")):d.M?U(this,""+d.M,"error"):200==b&&e&&c?(a.classList.remove("saved"),a.setAttribute("href",va(this,c)),a.setAttribute("title",this.a.getMessage("64")),N(this.b,c,"")):Array.isArray(d.U)&&1==d.U.length&&k(d.U[0])&&!e?(a.classList.add("saved"),b=d.U[0].c.split(":")[1]||"",a.setAttribute("href",wa(this,b)),a.setAttribute("title",this.a.getMessage("96")),N(this.b,c,b),U(this,this.a.getMessage("1285",['<a href="/scholar?scilib=1&'+Q(this)+'">',"</a>"]))):(a=this.a.getMessage(e?
"1289":"1287"),U(this,a,"error"));W(this)}ba(a){const b="scholar?oi=gsb95&q="+encodeURIComponent(this.I.value);P(this,b);ra(this,b);a.preventDefault()}W(a){if(!(1<a.button)){var b=document.body;for(let c=a.target;c!=b;c=c.parentElement){const d=1==c.nodeType&&c.getAttribute("href")||"";if(c.classList.contains("disabled")){a.preventDefault();break}else if(c==this.o||c==this.B){a.preventDefault();c==this.o?oa(this.b):na(this.b);const e=L(this.b);"home"==e.type?(this.j.innerHTML="",R(this,!1)):"search"==
e.type?ya(this,e.a,f=>{this.N(e.a,200,f,!0)},()=>{R(this,!0);this.F(e.a,"",this.N.bind(this,e.a))}):"cite"==e.type&&ya(this,e.a,f=>{this.K(e.a,200,f)},()=>{R(this,!0);this.F(e.a,"",this.K.bind(this,e.a))});P(this,e.a);V(this,e.a);O(this);W(this);break}else if("#f"==d.substr(0,2)){a.preventDefault();ua(this,d.substr(2));break}else if("#c"==d.substr(0,2)){a.preventDefault();xa(this,c,d.substr(1));break}else if(d){a.preventDefault();c==this.A&&(ma(this.b),W(this));this.ca(("/"==d[0]?"https://scholar.google.com":
"")+d);break}}}}$(a){a=a.target;if("TR"==a.nodeName){const b=a.querySelector("td");b&&setTimeout(()=>{window.getSelection().selectAllChildren(b)},20)}}};class Aa{get(a,b){browser.storage.local.get(a).then(b,()=>b(null))}set(a){browser.storage.local.set(a)}};const Y=new za(new aa,a=>{browser.tabs.create({url:a});window.close()},(a,b,c)=>{la(a,b,c)},new Aa);let Ba=0;function Z(a){Ba++||(a=(a||"")+"",Y.J?S(Y,a):Y.Y=a);browser.runtime.onMessage.removeListener(Z)}function Ca(){browser.tabs.query({active:!0,currentWindow:!0}).then(a=>Z("scholar?oi=gsb01&lookup_url="+encodeURIComponent((a&&a[0]||{}).url||"")),()=>Z())}browser.runtime.onMessage.addListener(Z);browser.tabs.executeScript({file:"contentscript-compiled.js"}).then(()=>setTimeout(Ca,100),()=>Ca());}).call(this);
