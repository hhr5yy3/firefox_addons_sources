"use strict";(self.webpackChunkvk_music_saver=self.webpackChunkvk_music_saver||[]).push([[692],{2692:(e,t,s)=>{function n(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}s.d(t,{Bridge:()=>h});var r={exports:{}};!function(e){var t=Object.prototype.hasOwnProperty,s="~";function n(){}function r(e,t,s){this.fn=e,this.context=t,this.once=s||!1}function o(e,t,n,o,i){if("function"!=typeof n)throw new TypeError("The listener must be a function");var c=new r(n,o||e,i),a=s?s+t:t;return e._events[a]?e._events[a].fn?e._events[a]=[e._events[a],c]:e._events[a].push(c):(e._events[a]=c,e._eventsCount++),e}function i(e,t){0==--e._eventsCount?e._events=new n:delete e._events[t]}function c(){this._events=new n,this._eventsCount=0}Object.create&&(n.prototype=Object.create(null),(new n).__proto__||(s=!1)),c.prototype.eventNames=function(){var e,n,r=[];if(0===this._eventsCount)return r;for(n in e=this._events)t.call(e,n)&&r.push(s?n.slice(1):n);return Object.getOwnPropertySymbols?r.concat(Object.getOwnPropertySymbols(e)):r},c.prototype.listeners=function(e){var t=s?s+e:e,n=this._events[t];if(!n)return[];if(n.fn)return[n.fn];for(var r=0,o=n.length,i=new Array(o);r<o;r++)i[r]=n[r].fn;return i},c.prototype.listenerCount=function(e){var t=s?s+e:e,n=this._events[t];return n?n.fn?1:n.length:0},c.prototype.emit=function(e,t,n,r,o,i){var c=s?s+e:e;if(!this._events[c])return!1;var a,h,p=this._events[c],f=arguments.length;if(p.fn){switch(p.once&&this.removeListener(e,p.fn,void 0,!0),f){case 1:return p.fn.call(p.context),!0;case 2:return p.fn.call(p.context,t),!0;case 3:return p.fn.call(p.context,t,n),!0;case 4:return p.fn.call(p.context,t,n,r),!0;case 5:return p.fn.call(p.context,t,n,r,o),!0;case 6:return p.fn.call(p.context,t,n,r,o,i),!0}for(h=1,a=new Array(f-1);h<f;h++)a[h-1]=arguments[h];p.fn.apply(p.context,a)}else{var u,l=p.length;for(h=0;h<l;h++)switch(p[h].once&&this.removeListener(e,p[h].fn,void 0,!0),f){case 1:p[h].fn.call(p[h].context);break;case 2:p[h].fn.call(p[h].context,t);break;case 3:p[h].fn.call(p[h].context,t,n);break;case 4:p[h].fn.call(p[h].context,t,n,r);break;default:if(!a)for(u=1,a=new Array(f-1);u<f;u++)a[u-1]=arguments[u];p[h].fn.apply(p[h].context,a)}}return!0},c.prototype.on=function(e,t,s){return o(this,e,t,s,!1)},c.prototype.once=function(e,t,s){return o(this,e,t,s,!0)},c.prototype.removeListener=function(e,t,n,r){var o=s?s+e:e;if(!this._events[o])return this;if(!t)return i(this,o),this;var c=this._events[o];if(c.fn)c.fn===t&&(!r||c.once)&&(!n||c.context===n)&&i(this,o);else{for(var a=0,h=[],p=c.length;a<p;a++)(c[a].fn!==t||r&&!c[a].once||n&&c[a].context!==n)&&h.push(c[a]);h.length?this._events[o]=1===h.length?h[0]:h:i(this,o)}return this},c.prototype.removeAllListeners=function(e){var t;return e?(t=s?s+e:e,this._events[t]&&i(this,t)):(this._events=new n,this._eventsCount=0),this},c.prototype.off=c.prototype.removeListener,c.prototype.addListener=c.prototype.on,c.prefixed=s,c.EventEmitter=c,e.exports=c}(r);const o=n(r.exports);class i extends o{has(e){return this.eventNames().includes(e)}emit(e,...t){const s=o.prefixed,n=s?s+e:e,r=this._events;if(!r[n])return Promise.reject();const i=r[n];if(i.fn)return i.once&&this.removeListener(e,i.fn,void 0,!0),Promise.resolve(i.fn.apply(i.context,t));{const s=[];for(let n=0;n<i.length;n++)i[n].once&&this.removeListener(e,i[n].fn,void 0,!0),s[n]=Promise.resolve(i[n].fn.apply(i[n].context,t));return Promise.all(s)}}}const c="iframe-message-bridge-",a=2e4;class h{constructor(e,t={}){this._event=new i,this._options={prefix:c,timeout:a,targetOrigin:"*",transfer:void 0},this.promiseMapping=new Map;const{prefix:s=c,timeout:n=a}=t;this.targetWindow=e,this.prefix=s,this.timeout=n,this._options={...this._options,...t};const r=({data:e})=>{this._processMessage(e)};window.addEventListener("message",r),this._event.on("$destroy",(()=>{window.removeEventListener("message",r)}))}post(e,t){if(!e)throw new Error("Name is required");if("string"!=typeof e)throw new Error("Name must be a string");const s=`${this.prefix}${e}`;return new Promise(((e,n)=>{const r=Math.random().toString(36).substr(2,9);this._sendMessage({name:s,_msgId:r,payload:t});const o=setTimeout((()=>{this._rejectMsg(r,"Timeout")}),this.timeout);this.promiseMapping.set(r,{id:r,resolve:e,reject:n,timeoutId:o})}))}on(e,t){let s=e,n=t;"function"==typeof s&&(n=e,s="*");const r=`${this.prefix}${s}`;if(!this._event)throw new Error("Bridge is destroyed");this._event.on(r,n)}off(e,t){const s=`${this.prefix}${e}`;if(!this._event)throw new Error("Bridge is destroyed");this._event.off(s,t)}destroy(){if(!this._event)throw new Error("Bridge is destroyed");this._event.emit("$destroy"),this._event.removeAllListeners(),this._event=null,this.promiseMapping.forEach((e=>{clearTimeout(e.timeoutId),e.reject("Bridge is destroyed")})),this.promiseMapping.clear()}_processMessage(e){if("string"==typeof e.name&&e.name.startsWith(this.prefix))try{const t=e;if(t._responseMsgId)return this._processResponseMessage(t);if(t._msgId)return this._processReceiveMessage(t)}catch(e){console.error(e)}}_processResponseMessage(e){const t=e._responseMsgId,s=this._getMsgPromiseById(t);s&&(clearTimeout(s.timeoutId),e._error?this._rejectMsg(t,e):this._resolveMsg(t,e),this._removeMsgPromiseById(t))}_processReceiveMessage(e){const{_msgId:t,...s}=e;if(!this._event)throw new Error("Bridge is destroyed");if(!this._event.has(s.name))return void this._responseMsgResult(t,{_error:"Unregistered event",...e});const n=e=>this._responseMsgResult(t,{...s,payload:e}),r=e=>this._responseMsgResult(t,{_error:e,...s});try{this._event.emit(s.name,s.payload).then(n,r)}catch(e){r(e)}}_resolveMsg(e,{...t}){const s=this._getMsgPromiseById(e);s?s.resolve(t.payload):console.warn(`Resolve msgPromise(id: ${e}) is not found`)}_rejectMsg(e,t){const s=this._getMsgPromiseById(e);s?s.reject(t):console.warn(`Reject msgPromise(id: ${e}) is not found`)}_getMsgPromiseById(e){return this.promiseMapping.get(e)}_removeMsgPromiseById(e){this.promiseMapping.delete(e)}_sendMessage(e){const{targetOrigin:t,transfer:s}=this._options;this.targetWindow.postMessage(e,t,s)}_responseMsgResult(e,t){this._sendMessage({...t,_msgId:e,_responseMsgId:e})}}}}]);