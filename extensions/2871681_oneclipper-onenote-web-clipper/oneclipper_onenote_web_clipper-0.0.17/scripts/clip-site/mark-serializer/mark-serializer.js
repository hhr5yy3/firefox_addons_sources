var u=new RegExp(/[-\s](c|cpp|charp|go|html|css|js|jsx|ts|json|kotlin|kt|java|py|python|r|rust|sass|scss|sql|vue|xml)/),L=new RegExp(/[\s:|?<>/~#^*\[\]]/g),E=new Set(["BLOCKQUOTE","LI","DD"]),m=new Set(["ADDRESS","ARTICLE","BLOCKQUOTE","DIV","DD","DL","DT","FOOTER","HEADER","HGROUP","H1","H2","H3","H4","H5","H6","HR","LI","P","PRE","OL","SECTION","TR","UL"]),a={H1:"#",H2:"##",H3:"###",H4:"####",H5:"#####",H6:"######",LI:"-",BLOCKQUOTE:">",HR:"---"};var h={B:"bold",CITE:"italic",CODE:"code",DEL:"strikethrough",DFN:"italic",EM:"italic",I:"italic",KBD:"code",MARK:"highlight",STRONG:"bold",VAR:"italic"},p={italic:"*",bold:"**","bold-italic":"***",highlight:"==",strikethrough:"~~",code:"`"},l=new Set(["AREA","ASIDE","BUTTON","COLGROUP","COL","CANVAS","DATALIST","EMBED","FORM","FIGCAPTION","HEADER","OPTION","OPTGROUP","FOOTER","INPUT","LABEL","LEGEND","LINK","META","MAP","METER","NOSCRIPT","NAV","OBJECT","SELECT","TEXTAREA","STYLE","SCRIPT","SOURCE","svg","PROGRESS","SLOT","TEMPLATE","TITLE","TIME","WBR","SEARCH"]),c=["nav","toc","sidebar","author","sticky","banner","share","comments","edit","ignore","subscribe","breadcrumb","rating","meta","tags","feed","dropdown","related","sponsor","promo","billboard","newsletter","cta","toolbar"],T=["FOOTER","TOC","SIDE","RATING"],d=new Set(["menu","menubar","menuitem","complementary","navigation","alert","alertdialog","dialog","presentation","progressbar","button","status","navigation","none","tablist","tab"]);var k={Space:32,LineBreak:10};function f(o){let t=o.length,s=0;for(;++s<t&&!(o.charCodeAt(s)!==k.LineBreak&&o.charCodeAt(s)!==k.Space););return o.slice(s)}var g=class{constructor(){}generate(t){return this.markdown=[],this.insertChildElements(t),this.markdown.join("")}insertChildElements(t,s){for(let i=0;i<t.length;i++){let e=t[i],n=e.tagName;if(e.nodeType===3){this.inserText(e);continue}else if(e.nodeType!==1)continue;if(!l.has(n)){if(e.hidden||e.ariaHidden==="true"||d.has(e.role)||e.style?.display==="none")return;if(m.has(n)){this.insertBlockElement(e,s,i+1);continue}if(n==="BR"){this.markdown.at(-1)===`\\
`?this.markdown.push(`
`):this.markdown.push(`\\
`);continue}if(n==="TABLE"){this.insertTable(e);continue}if(n?.includes("-")){for(let C of T)n.includes(C);(e.computedStyleMap()?.get("display").toString()??"inline").startsWith("inline")?this.insertInlineElement(e):this.insertBlockElement(e,s,i+1)}else this.insertInlineElement(e)}}}insertInlineElement(t){if(t.nodeType===3)return this.inserText(t);let s=t.tagName;if(!l.has(s)&&!(t.hidden||t.ariaHidden==="true"||d.has(t.role)||t.style?.display==="none")){if(t.className||t.id){for(let i of c)if(t.className?.toLowerCase()?.includes?.(i)||t.id?.toLowerCase()?.includes?.(i))return}if(h[s])return this.insertInlineMarkElem(t,h[s]);if(this.elements[s])return this.elements[s]?.(t);for(let i of t.childNodes)this.insertInlineElement(i)}}inserText(t){let s=t.data;s.trimStart()&&((s.startsWith(`
`)||s.startsWith("	"))&&(s=f(s),!s)||this.markdown.push(s??""))}elements={A:this.insertLink.bind(this),IMG:this.insertImg.bind(this),AUDIO:this.insertMedia.bind(this),EMBED:this.insertMedia.bind(this),VIDEO:this.insertMedia.bind(this),OBJECT:this.insertMedia.bind(this),TR:this.insertTableRow.bind(this),TH:this.insertTableCell.bind(this),TD:this.insertTableCell.bind(this),math:this.insertMathMLContent.bind(this),"MJX-CONTAINER":t=>this.insertMathMLContent(t.querySelector("math")),FIGURE:t=>this.insertImg(t.querySelector("img")),PICTURE:t=>this.insertImg(t.querySelector("img")),IFRAME:this.insertIframe.bind(this)};insertBlockElement(t,s,i){let e=t.tagName;for(let n of c)if(t.className?.toLowerCase()?.includes?.(n)||t.id?.toLowerCase()?.includes?.(n))return;if(a[e])return e==="LI"||this.markdown.push(`
`),this.insertBlockMarker(t,s,i),this.insertChildElements(t.childNodes,s),this.markdown.push(`
`);if(e==="OL"||e==="UL"){this.markdown.push(`
`);let n=e==="OL"?"counter":e==="UL"&&"list",r;return s?(r={...s},r.nestLevel?++r.nestLevel:r.nestLevel=1,r.type=n):r={type:n},this.insertChildElements(t.childNodes,r)}if(e==="PRE"){let n=t.className.match(u)?.[1]??"";return this.markdown.push("\n```"+n+`
`),this.markdown.push(t.innerText),this.markdown.push("\n```\n")}e==="P"&&!E.has(t.parentElement?.tagName)?this.markdown.push(`
`):e==="DD"?this.markdown.push(`
:	`):e==="DT"&&this.markdown.push(`
`),this.insertChildElements(t.childNodes)}insertBlockMarker(t,s,i){let e=a[t.tagName];s&&(s.type==="counter"&&(e=i+"."),s.nestLevel&&this.markdown.push("	".repeat(s.nestLevel))),this.markdown.push(e+" ")}insertInlineMarkElem(t,s){let i=p[s];this.markdown.push(i);for(let e of t.childNodes)this.insertInlineElement(e);this.markdown.push(i+" ")}insertLink(t){if(!t.textContent.startsWith(`
`))if(t.childElementCount===0){let s=` [${t.textContent}](${t.href}) `;this.markdown.push(s)}else t.href.startsWith("#")?this.insertChildElements(t.children):(this.markdown.push("["),this.insertChildElements(t.childNodes),this.markdown.push(`](${t.href})`))}insertImg(t){if(!t||t.width<80)return;let s=t.currentSrc||t.src;s.startsWith("data")&&(s=t.dataset.src||t.dataset.srcset?.split(", ")[0]);let i=s.includes("?")?s.split("?",1)[0]:s;if(!i)return;let e=`
![${t.alt??""}](${i}) `;this.markdown.push(e)}insertMedia(t){let s=t.currentSrc,i=`
![${s.slice(s.lastIndexOf("/")+1)}](${s}) `;this.markdown.push(i)}insertTable(t){this.markdown.push(`
`);let s=t.rows,i=s[0];this.insertTableRow(i);for(let e of i.children)this.markdown.push("|"+"-".repeat(e.textContent?.length??3));this.markdown.push(`|
`);for(let e=1;e<s.length;e++)this.insertTableRow(s[e])}insertTableRow(t){for(let s of t.children)this.insertInlineElement(s);this.markdown.push(`|
`)}insertTableCell(t){this.markdown.push("|");for(let s of t.childNodes)this.insertInlineElement(s)}insertMathMLContent(t){if(!t)return;let s=t.querySelector("annotation");this.markdown.push(s?`
$$
${s.textContent}
$$
`:`
<math-jax>${t.outerHTML}</math-jax>
`)}insertIframe(t){let s=t.contentDocument?.querySelector("body").children;s&&this.insertChildElements(s)}};export{g as MarkdownSerializer};
