"use strict";(()=>{var p;(o=>{let n="future/plugin";function r(...t){return f("images",...t)}o.getImageSrc=r;function f(...t){return c(n,...t)}o.getPublicPath=f;function g(t){n=t}o.setPublicPath=g;function c(...t){if(t.length===0)return".";let i=t.shift();for(let l=0;l<t.length;++l){let j=t[l];j.length>0&&(i+=`/${j}`)}return i===void 0?".":u(i)}o.join=c;function u(t){if(t.length===0)return".";let i=47,l=46,j=t.charCodeAt(0)===i,V=t.charCodeAt(t.length-1)===i,e="",C=0,m=-1,S=0,P;for(let a=0;a<=t.length;++a){if(a<t.length)P=t.charCodeAt(a);else{if(P===i)break;P=i}if(P===i){if(!(m===a-1||S===1))if(m!==a-1&&S===2){if(e.length<2||C!==2||e.charCodeAt(e.length-1)!==l||e.charCodeAt(e.length-2)!==l){if(e.length>2){let w=e.lastIndexOf("/");if(w!==e.length-1){w===-1?(e="",C=0):(e=e.slice(0,w),C=e.length-1-e.lastIndexOf("/")),m=a,S=0;continue}}else if(e.length===2||e.length===1){e="",C=0,m=a,S=0;continue}}j||(e.length>0?e+="/..":e="..",C=2)}else e.length>0?e+=`/${t.slice(m+1,a)}`:e=t.slice(m+1,a),C=a-m-1;m=a,S=0}else P===l&&S!==-1?++S:S=-1}return e.length===0&&!j&&(e="."),e.length>0&&V&&(e+="/"),j?`/${e}`:e}o.normalize=u})(p||={});var s;(c=>{let n;(t=>{function u(){return p.getPublicPath("vendors/runtime.js")}t.getVendorRuntime=u;function o(){return __thrush_future_vendor_dependencies__.map(i=>p.getPublicPath(i))}t.getVendorScripts=o})(n=c.Vendors||={});let r;(o=>{function u(){return[p.getPublicPath("background.entry.js")]}o.getBackgroundScripts=u})(r=c.Background||={});let f;(i=>{function u(){return[p.getPublicPath("../preload.js")]}i.getPreloadScripts=u;function o(){return[p.getPublicPath("content.entry.js")]}i.getContentScripts=o;function t(){return[p.getPublicPath("injected.css")]}i.getInjectedCss=t})(f=c.Content||={});let g;(t=>{function u(){return[p.getPublicPath("popover.entry.js")]}t.getPopoverScripts=u;function o(){return[p.getPublicPath("popover.entry.css")]}t.getPopoverCss=o})(g=c.Popover||={})})(s||={});var d;(g=>{async function n(c){let u=async o=>new Promise(t=>{let i=document.createElement("script");i.setAttribute("type","text/javascript"),i.setAttribute("src",o),i.addEventListener("load",()=>t()),document.head.appendChild(i)});await Promise.all(c.map(o=>u(o)))}g.injectBackgroundScripts=n;async function r(c,u,o){let t=i=>new Promise(l=>{chrome.tabs.executeScript(c,{file:i,frameId:u,runAt:"document_idle"},()=>{chrome.runtime.lastError&&console.warn("[thrush-future] [init] Failed to inject content script:",chrome.runtime.lastError.message),l()})});await Promise.all(o.map(i=>t(i)))}g.injectContentScripts=r;async function f(c,u,o){let t=i=>new Promise(l=>{chrome.tabs.insertCSS(c,{file:i,frameId:u,runAt:"document_idle"},()=>{chrome.runtime.lastError&&console.warn("[thrush-future] [init] Failed to CSS:",chrome.runtime.lastError.message),l()})});await Promise.all(o.map(i=>t(i)))}g.injectCSS=f})(d||={});var h;(g=>{function n(c){importScripts(...c)}g.injectBackgroundScripts=n;function r(c,u,o){return new Promise(t=>{chrome.scripting.executeScript({target:{tabId:c,frameIds:[u]},files:o},()=>{chrome.runtime.lastError&&console.warn("[thrush-future] [init] Failed to inject content scripts:",chrome.runtime.lastError.message),t()})})}g.injectContentScripts=r;async function f(c,u,o){return new Promise(t=>{chrome.scripting.insertCSS({target:{tabId:c,frameIds:[u]},files:o},()=>{chrome.runtime.lastError&&console.warn("[thrush-future] [init] Failed to inject CSS:",chrome.runtime.lastError.message),t()})})}g.injectCSS=f})(h||={});var x=chrome.runtime.getManifest().manifest_version;globalThis.ThrushFuture=globalThis.ThrushFuture||{};ThrushFuture.Init=ThrushFuture.Init||{};ThrushFuture.Init.BackgroundScript={async inject(){x>=3?globalThis.serviceWorker?.state==="parsed"?globalThis.addEventListener("install",()=>{ThrushFuture.Init.BackgroundScript.injectMV3()}):ThrushFuture.Init.BackgroundScript.injectMV3():await ThrushFuture.Init.BackgroundScript.injectMV2()},async injectMV2(){await d.injectBackgroundScripts([s.Vendors.getVendorRuntime()]),await d.injectBackgroundScripts(s.Vendors.getVendorScripts()),await d.injectBackgroundScripts(s.Background.getBackgroundScripts())},injectMV3(){h.injectBackgroundScripts([s.Vendors.getVendorRuntime()]),h.injectBackgroundScripts(s.Vendors.getVendorScripts()),h.injectBackgroundScripts(s.Background.getBackgroundScripts())}};ThrushFuture.Init.ContentScript={async inject(n,r){await ThrushFuture.Preload.isThrushFutureEnabled()&&(x>=3?await ThrushFuture.Init.ContentScript.injectMV3(n,r):await ThrushFuture.Init.ContentScript.injectMV2(n,r))},async injectPreload(n,r){x>=3?await h.injectContentScripts(n,r,s.Content.getPreloadScripts()):await d.injectContentScripts(n,r,s.Content.getPreloadScripts())},async injectMV2(n,r){await d.injectContentScripts(n,r,[s.Vendors.getVendorRuntime()]),await d.injectContentScripts(n,r,s.Vendors.getVendorScripts()),await d.injectCSS(n,r,s.Content.getInjectedCss()),await d.injectContentScripts(n,r,s.Content.getContentScripts())},async injectMV3(n,r){await h.injectContentScripts(n,r,[s.Vendors.getVendorRuntime()]),await h.injectContentScripts(n,r,s.Vendors.getVendorScripts()),await h.injectCSS(n,r,s.Content.getInjectedCss()),await h.injectContentScripts(n,r,s.Content.getContentScripts())}};ThrushFuture.Init.PopoverScript={async inject(){if(await ThrushFuture.Preload.isThrushFutureEnabled()){p.setPublicPath("../../future/plugin");let n=async r=>new Promise(f=>{let g=document.createElement("script");g.setAttribute("type","text/javascript"),g.setAttribute("src",r),g.addEventListener("load",()=>f()),document.head.appendChild(g)});await n(s.Vendors.getVendorRuntime()),await Promise.all(s.Vendors.getVendorScripts().map(async r=>n(r))),await Promise.all(s.Popover.getPopoverScripts().map(async r=>n(r)))}}};})();
