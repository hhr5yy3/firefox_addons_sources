// Copyright 2023 OneTab Ltd.  All rights reserved.
const K="1.83",Ot=!1,Wt=!1,zt=!1,jt=!1,Vt=!1,qt=!0,Q=!!navigator.userAgent.match(/Mobile/i),Jt="about:",Kt="about:blank",Qt="https://www.one-tab.com",Zt=!1,Z=!1,X=!1;async function Y(){return new Promise((t,e)=>{document.readyState==="complete"?t():document.addEventListener("readystatechange",n=>{document.readyState==="complete"&&t()})})}class tt{constructor({className:e="",q:n,width:r=n,height:o=n,style:i={},J:a={},K:u,Z:s},w){this.G=w,this.p=L("picture",{style:{position:"relative",display:"inline-block",userSelect:"none",width:r,height:o,...i},className:e,...a,draggable:!1,children:{N:L("source",{srcset:w(!0),media:"(prefers-color-scheme: light)"}),O:L("source",{srcset:w(!1),media:"(prefers-color-scheme: dark)"}),X:nt()},...u&&{onmouseover:c=>this.W(!0),onmouseout:c=>this.W(!1)},...s&&{onclick:s}})}Y(e){this.G=e,this.p.N.o.srcset=e(!0),this.p.O.o.srcset=e(!1)}W(e=!1){this.p.N.o.srcset=this.G(!0,e),this.p.O.o.srcset=this.G(!1,e)}}function et(...t){return new tt(...t).p.o}function nt(){const t=document.createElement("img");return t.className="lightDarkInnerImg",t.draggable=!1,t}function rt(t){return f(void 0,"div",{id:"headerText",style:{paddingTop:"40px",paddingBottom:"20px",[`padding${q()}`]:"240px",fontSize:"16px",color:"var(--text-color-weak)",fontWeight:"300",borderBottom:"1px dashed var(--dash-color)",marginBottom:"10px"},textContent:t}).o}function ot(){return et({style:{width:416/2+"px",height:114/2+"px",position:"absolute",top:"16px",[`${Ht()}`]:"19px"}},t=>`images/top-left-logo-${t?"light":"dark"}${l()?"":"-rtl"}.png`)}function A(t,e,n){let r=document.createElement("div"),o=document.createElement("div");J(o,"30px"),o.style.position="relative";let i=document.createElement("img");i.src=t?"images/twister-open.png":"images/twister-closed"+(l()?"":"-rtl")+".png",i.style.width=48/2+"px",i.style.height=50/2+"px",i.style.position="absolute",_t(i,"0px"),i.style.top="0px",o.textContent=e,o.style.fontSize="16px",o.style.cursor="pointer",r.appendChild(o),o.appendChild(i);let a=document.createElement("div");J(a,"30px"),a.style.paddingTop="10px",a.appendChild(n.o),a.style.display=t?"block":"none",r.appendChild(a),o.onclick=()=>{t=!t,i.src=t?"images/twister-open.png":"images/twister-closed"+(l()?"":"-rtl")+".png",a.style.display=t?"block":"none"};let u={D:n.o};return Object.assign(u,n),u.o=r,u}function it(t,e,n,r){let o=document.createElement("div");o.style.fontSize=e+"px",o.className="clickable";let i=document.createElement("span");if(r){let a=document.createElement("span");a.textContent=h("newExclamation")+" ",i.appendChild(a)}return typeof t=="string"?i.appendChild(document.createTextNode(t)):i.appendChild(t),i.style.verticalAlign="middle",i.onclick=a=>{n(i)},o.appendChild(i),o}const R=chrome.runtime.getURL("onetab.html"),G=R.substring(0,R.length-"onetab.html".length);let $=!1;async function Xt(){return $?(await chrome.permissions.getAll()).permissions.includes("tabGroups")&&chrome.tabGroups:!1}async function Yt(){if(!$||X)return!1;try{return await chrome.permissions.request({permissions:["tabGroups"]})}catch(t){return console.log('chrome.permissions.request for "tabGroups" permission failed with error:'),console.log(t),!1}}function te(t){let e=S(t);return e.toLowerCase().startsWith("www.")?e.substring("www.".length):e}function S(t){return t?(t.indexOf("//")===0&&(t="http:"+t),t.indexOf("://")===-1&&(t="http://"+t),t=t.substring(t.indexOf("://")+"://".length),t.indexOf("/")!==-1&&(t=t.substring(0,t.indexOf("/"))),t.indexOf(":")!==-1&&(t=t.substring(0,t.indexOf(":"))),t.indexOf("?")!==-1&&(t=t.substring(0,t.indexOf("?"))),t.indexOf("#")!==-1&&(t=t.substring(0,t.indexOf("#"))),t.toLowerCase()):"undefined"}function ee(t){return t.indexOf("://")===-1?"https://":(t=t.substring(0,t.indexOf("://")+"://".length),t.toLowerCase())}let H=["com","co.uk","org.uk","net","org","de","ru","info","xyz","nl"];function ne(t){let e=S(t);try{for(let n in H){let r="."+H[n];if(wt(e,r)){for(e=e.substring(0,e.length-r.length);e.indexOf(".")!==-1;)e=e.substring(e.indexOf(".")+1);e=e+r;break}}return e.indexOf("www.")===0&&(e=e.substring("www.".length)),e}catch{return e}}function at(t){t.noCacheRandom=st()}function st(){return new Date().getTime()+Math.round(Math.random()*1e4)+""}async function re(t,e){at(e);let n=JSON.stringify(e);return await(await ut(t,n)).json()}async function ut(t,e){let n={};e?(n.method="POST",n.body=e):n.method="GET",n.headers=new Headers,n.headers.append("Content-Type","text/json");let r=await fetch(t,n);if(r.status===200)return r;throw new Error("http response code"+r.status)}function oe(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,t=>{let e=Math.random()*16|0;return(t=="x"?e:e&3|8).toString(16)})}const ct="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz-_".split("");function lt(t,e){let n=ct,r=[],o=0;for(e=e||n.length,t=t||22,o=0;o<t;o++)r[o]=n[0|Math.random()*e];return r.join("")}function ft(){return lt()}function ie(){return ft()}function ae(t){return t==null?"":t.replace(/^\s+/,"").replace(/\s+$/,"")}function se(t,e){return t?.length>e&&(t=t.substring(0,e)+"â€¦"),t}function ue(...t){return(e,n)=>t.reduce((r,o)=>r||o(e,n),0)}function ce(t){return(e,n)=>t(e)-t(n)}function le(t){return(e,n)=>t(n)-t(e)}const fe=(t,e)=>!!e.starred-!!t.starred||t.starred&&e.starred&&e.starredDate-t.starredDate||e.createDate-t.createDate;function dt(t){return t||(t=""),t.replace(/[\x00-\x1F\x7F-\x9F]/g,"")}function wt(t,e){return t?t.indexOf(e,t.length-e.length)!==-1:!1}const ht={restoreWindow:"newWindow",pinnedTabs:"ignore",startupLaunch:"displayOneTab",restoreRemoval:"default",duplicates:"allow",pinned:"true"};function de(t,e){return e[t]?e[t]:ht[t]}function we(t,e,n){t.parentNode&&t.remove(),e.insertBefore(t,n===void 0||n>=e.children.length||e.children.length===0?null:e.children[Math.max(0,n)])}function pt(t,e){return L("div",t,e)}function L(t,e,n){return f(void 0,t,e,n)}function f(t,e,n,r){let o=e===void 0?t:document.createElement(e),i={},a={};if(n){n.style&&Object.assign(o.style,n.style);for(let s of Object.keys(n))s!=="style"&&s!=="children"&&s!=="child"&&s!=="init"&&(o[s]=n[s]),(s==="role"||s==="placeholder")&&o.setAttribute(s,n[s]);if(n.children){let s=Object.entries(n.children);for(const[w,c]of s)c instanceof HTMLElement?o.appendChild(c):(o.appendChild(c?.p?.o??c.o),c.u&&(Object.assign(a,c.u),a[w]=c));for(const[w,c]of s)i[w]=c,a[w]=c}if(n.l){let s=n.l;i.l=s,o.appendChild(s instanceof HTMLElement?s:s?.p?.o??s.o)}}e!==void 0&&t&&t.appendChild(o);let u={o,u:a};return Object.assign(u,i),r&&Object.assign(u,r),n?.init&&n.init(u),u}const _="about:reader?url=";function xt(t){return t?t.indexOf(":")===-1?"https://"+t:t.indexOf(_)===0?decodeURIComponent(t.substring(_.length)):t.startsWith(`${G}placeholder.html?`)?new URLSearchParams(t.substring(t.indexOf("?"))).get("url"):t:""}function he(t){let e=t.match(/\d+/);if(e)return parseInt(e[0])}const B=[...new Array(30)].map((t,e)=>parseInt(10+Math.pow(1.6,e)));function*gt(t){let e=0;for(;B.slice(0,e).reduce((n,r)=>n+r,0)<t;)yield B[e++]}async function pe(t,e,n){let r=0;for(let o of gt(t)){if(await n(r))return;await E(o),r+=o}throw new Error(`Timeout waiting for condition ${e}`)}function h(t){let e=chrome.i18n.getMessage(t);return e||(console.log("No translation available for: "+t),t)}function xe(t,e,n){return e&&((t||"").toLowerCase().startsWith("file:")||mt(t))?n?`data:text/html, <html><body><div id="placeholderUrl">${t}</div></body></html>`:`${G}placeholder.html?url=${encodeURI(t)}`:t}async function ge(){try{return Z||!0}catch(t){return console.log(t),!0}}function mt(t){for(let e of yt)if(t.startsWith(e))return!0;return!!(!t||t===""||t.startsWith("chrome-devtools:"))}const yt=["javascript:","about:",...["chrome://","edge://","data:"].filter(t=>!0),...["edge://","chrome://"].map(t=>["newtab","new-tab-page","print","network-error","badcastcrash","inducebrowsercrashforrealz","crash","crashdump","kill","hang","shorthang","gpuclean","gpucrash","gpuhang","memory-exhaust","memory-pressure-critical","memory-pressure-moderate","ppapiflashcrash","ppapiflashhang","quit","restart"].map(e=>`${t}${e}/`)).flat()];async function E(t){return new Promise(e=>setTimeout(e,t))}class Lt{async put(e,n){await chrome.storage.local.set({[e]:n})}async get(e){return(await chrome.storage.local.get([e]))[e]}async remove(e){return await chrome.storage.local.remove(e)}}const bt=new Lt;function b(){return bt}const Ct="undefined-34LKmiHxP3Mu48u8qrDaHf";function P(t,e,n){return Array.isArray(t)?t.map(r=>P(r,e,n)):typeof t=="object"&&t!==null?Object.fromEntries(Object.entries(t).map(([r,o])=>[r,P(o,e,n)])):t===e?n:t}const me="c",ye="e",Le="tg";class Dt{async put(e,n){await chrome.storage.session.set({[e]:n})}async get(e){return(await chrome.storage.session.get([e]))[e]}async getAll(){return await chrome.storage.session.get(null)}async remove(e){return await chrome.storage.session.remove(e)}async clearAll(){await chrome.storage.session.clear()}}class Tt{async put(e,n){await b().put("sessionStore",{...await this.getAll(),[e]:n})}async get(e){return(await this.getAll())[e]}async getAll(){return await b().get("sessionStore")??{}}async remove(e){let n=await this.getAll();delete n[e],await b().put("sessionStore",n)}async clearAll(){await b().remove("sessionStore")}}const vt=chrome.storage.session?new Dt:new Tt;function be(){return vt}function Ce(){return navigator.userAgent.includes(" Edg/")}async function De(t){let[e]=await chrome.tabs.query({windowId:t.windowId,active:!0});e&&e.id!==t.id?(await chrome.tabs.update(t.id,{active:!0}),await chrome.tabs.update(e.id,{active:!0})):console.log("No active tab found")}function Te(t,e){let n,r;return arguments.length===1?(n=t,r=n!==void 0):(r=t,n=e),r?[n]:[]}function ve({id:t,display:e,marginTop:n="16px",marginBottom:r="16px",marginLeft:o=0,marginRight:i=0,color:a="var(--border-color)",I:u,P:s,F:w}={}){return pt({...t&&{id:t},...s&&{className:"hideIfInLastSection"},...w&&{className:"hideIfInLastSubsection"},style:{...e&&{display:e},marginTop:n,marginBottom:r,marginLeft:o,marginRight:i,borderBottom:`1px solid ${a}`,...u}})}function Ie(t){return[`
`,"\v","\f","\r","Â…","\u2028","\u2029"].some(e=>e===t)}const It=["\v","\f","\r","Â…","\u2028","\u2029"];function Se(t){return t?(t=t.replaceAll(`\r
`,`
`),It.forEach(e=>t=t.replaceAll(e,`
`)),t):""}let g,m,N,U,O,p,x,C,D,F="ontouchstart"in window;function Ee({event:t,element:e,tt:n,et:r,nt:o,rt:i}){if(g=e,m=n,N=r,U=o,O=i,C=0,D=0,F&&t instanceof TouchEvent){if(t.touches.length>1)return;p=t.touches.item(0).pageX,x=t.touches.item(0).pageY,document.addEventListener("touchmove",T,!1),document.addEventListener("touchend",y,!1),t.preventDefault()}else p=t.clientX+window.scrollX,x=t.clientY+window.scrollY,document.addEventListener("mousemove",T,!1),document.addEventListener("mouseup",y,!1),t.preventDefault();N({$:g,H:m,_:p,B:x})}function T(t){let e,n,r,o;if(F&&t instanceof TouchEvent){if(t.touches.length>1)return r=0,o=0,U({$:g,H:m,dx:r,dy:o,_:p,B:x,pageX:e,pageY:n}),y(t);e=t.touches.item(0).pageX,n=t.touches.item(0).pageY}else e=t.clientX+window.scrollX,n=t.clientY+window.scrollY;r=e-p,o=n-x;let i=!1;(C!==r||D!==o)&&(i=!0),C=r,D=o,i&&U({$:g,H:m,dx:r,dy:o,_:p,B:x,pageX:e,pageY:n}),t.preventDefault()}function y(t){F&&t instanceof TouchEvent?(document.removeEventListener("touchmove",T,!1),document.removeEventListener("touchend",y,!1)):(document.removeEventListener("mousemove",T,!1),document.removeEventListener("mouseup",y,!1)),O({$:g,H:m,ot:C,it:D,_:p,B:x})}class I{constructor(e,n){this.x=e,this.y=n}g(e){return new I(this.x-e.x,this.y-e.y)}}class W{constructor(e,n,r,o){this.m=e,this.type=n,this.listener=r,this.L=o}remove(){this.m.removeEventListener(this.type,this.listener,this.L)}}function Pe(t,e){t.onmousemove=n=>{e(new d(t,n))}}function Ue(t,e){t.onmousedown=n=>{e(new d(t,n))}}function Fe(t,e){t.onmouseover=n=>{e(new d(t,n))}}function Me(t,e){t.onmouseup=n=>{e(new d(t,n))}}function ke(t,e){t.onmouseout=n=>{e(new d(t,n))}}function Ae(t,e){t.onclick=n=>{e(new d(t,n))}}function Re(t,e){t.ondblclick=n=>{e(new d(t,n))}}function Ge(t,e){v(t,"click",e)}function $e(t,e){v(t,"dblclick",e)}function He(t,e){return v(t,"mouseover",e)}function _e(t,e){return v(t,"mouseup",e)}function Be(t,e){let n;return n=r=>{let o,i;o=r.currentTarget,i=r.relatedTarget,o===t&&o!==i&&!M(o,i)&&e(new d(t,r))},t.addEventListener("mouseout",n,!1),new W(t,"mouseout",n,!1)}function Ne(t,e){t.onmouseout=n=>{let r,o;r=n.currentTarget,o=n.relatedTarget,r===t&&r!==o&&!M(r,o)&&e(new d(t,n))}}function Oe(t,e){for(let n of t)n.onmouseout=St(n,t,e)}function St(t,e,n){return r=>{let o,i;if(o=r.currentTarget,i=r.relatedTarget,o===t&&o!==i&&!M(o,i)){for(let a of e)if(i===a)return;n(new d(t,r))}}}function M(t,e){try{if(!e)return!1;for(;e.parentNode;)if((e=e.parentNode)===t)return!0;return!1}catch{return!1}}class d{constructor(e,n){this.element=e,this.event=n,this.i=null,this.h=null}S(){if(this.i===null){let e=Et(this.element);this.i=e.x,this.h=e.y}return this.i}U(){return this.i===null&&this.S(),this.h}}function v(t,e,n){let r=o=>{let i=new d(t,o);n(i)};return t.addEventListener(e,r,!1),new W(t,e,r,!1)}function We(t){return z(t)}function Et(t,e){return z(e).g(Pt(t))}function z(t){let e,n;return e=t.clientX+window.scrollX,n=t.clientY+window.scrollY,new I(e,n)}function Pt(t){let e=t,n=0,r=0;for(;;){let o=e.offsetParent;if(o===null)break;n+=e.offsetLeft,r+=e.offsetTop,e=o}return new I(n,r)}function ze(){return window.scrollY}function je(){return window.scrollX}async function Ut(){if(Q){let t=document.createElement("meta");t.name="viewport",t.content="width=400, initial-scale=1",document.getElementsByTagName("head")[0].appendChild(t)}await Ft(),await Y(),$t()}async function Ft(){try{let t=await chrome.tabs.getCurrent();t&&await chrome.tabs.update(t.id,{autoDiscardable:!1})}catch(t){console.log(t)}}function Ve(t){if(typeof t=="string"&&(t=document.getElementById(t)),!!t)for(;t.childNodes.length>0;)t.childNodes[0].remove()}function Mt(t){return f(void 0,"div",{style:{fontSize:"1px",height:t+"px",width:"1px"}}).o}let j=!1;async function kt(t,e={}){if(!j){const r=async()=>{if((await chrome.runtime.sendMessage({args:[],type:At.A,v:!0}))?.result?.pong!==String(K))throw new Error};try{await r()}catch{console.log("core not ready. retrying..."),await E(1e3);try{await r()}catch{console.log("core not ready. retrying..."),await E(5e3);try{await r()}catch{throw new Error("Cannot connect to core")}}}j=!0}e.type=t,e.v=!0;let n=await chrome.runtime.sendMessage(e);if(n===null)throw new Error("null message response from core");if(n?.C)throw new Error(n.C);return n.result}function qe(t){chrome.runtime.onMessage.addListener((e,n,r)=>{e.type==="stateChange"&&t(e.k)})}const At=new Proxy({},{get(t,e){return e}}),k=new Proxy({},{get(t,e,n){return(...r)=>(r=P(r,void 0,Ct),kt(e,{args:r}))}});let Rt=navigator.language||navigator.userLanguage;function Gt(){let t=["ar","he","fa","ps","ur"],e=Rt.split("-",1)[0];return t.indexOf(e)>=0?"rtl":"ltr"}let V=Gt();function l(){return V!=="rtl"}function $t(){document.getElementsByTagName("html")[0].dir=V}function q(){return l()?"Left":"Right"}function Je(){return l()?"Right":"Left"}function Ht(){return l()?"left":"right"}function Ke(){return l()?"right":"left"}function _t(t,e){l()?t.style.left=e:t.style.right=e}function Qe(t,e){l()?t.style.right=e:t.style.left=e}function J(t,e){l()?t.style.paddingLeft=e:t.style.paddingRight=e}function Ze(t,e){l()?t.style.paddingRight=e:t.style.paddingLeft=e}function Xe(t,e){l()?t.style.marginLeft=e:t.style.marginRight=e}setTimeout(async()=>{await Ut(),await Bt()},1);async function Bt(){Nt()}function Nt(){let{content:t}=f(document.getElementById("contentAreaDiv"),void 0,{style:{paddingTop:"0px",paddingLeft:"0px",paddingBottom:"30px"},children:{st:ot(),ut:rt(h("import")+" / "+h("export")),content:f(void 0,"div",{style:{paddingTop:"14px",["padding"+q()]:"36px"},children:{j:A(!1,h("importUrls"),f(void 0,"div",{style:{},children:{info:f(void 0,"div",{style:{paddingBottom:"10px"},textContent:h("pasteInUrlsInstructions")}),V:f(void 0,"textArea",{style:{width:"90%",maxWidth:"800px",height:"200px"}}),ct:it(h("import"),16,()=>{(async()=>(await k.lt(t.j.V.o.value),await k.ft(),setTimeout(()=>window.close(),100)))()})}})),dt:Mt(16),wt:A(!0,h("exportUrls"),f(void 0,"div",{style:{paddingBottom:"30px"},children:{ht:f(void 0,"div",{style:{paddingBottom:"10px"},textContent:h("exportThenImportNote")}),xt:f(void 0,"textArea",{style:{width:"90%",maxWidth:"800px",height:"500px"},init:async e=>{let r=(await k.getState()).tabGroups;r||(r=[]),e.o.value=r.map(o=>o.tabsMeta.map(i=>{let a=i.url;return S(xt(i.url))!==i.title&&(a+=" | "+dt(i.title)),a+`
`}).join("")).join(`
`)}})}}))}})}})}
