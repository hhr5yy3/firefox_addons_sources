(()=>{"use strict";var e={1241:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.Capture=void 0;const s=i(8033),r=i(2688),n=i(853),o=i(4911);t.Capture=class{constructor(e){this.mediaPreviews=[],this.elementsLength=void 0,this.elementNumber=void 0,this.description="",this.titre="",this.type=r.CaptureType.BASIQUE,this.callback=void 0,this.capture_en_cours=!1,this.listeners=new Map,this.selector=void 0,this.recapturable=!0,this.editable=!0,this.menu=e}startCapture(){this.reinitializeCapture(),this.mediaPreviews=[],this.listeners.set("keydown",this.keydown.bind(this)),this.listeners.set("mousedown",this.mousedown.bind(this)),this.listeners.set("mousemove",this.mousemove.bind(this)),this.listeners.set("mouseup",this.mouseup.bind(this)),this.listeners.forEach(((e,t)=>{document.addEventListener(t,e)})),this.menu.div.style.top="-9999px",this.menu.div.style.right="-9999px",this.capture_en_cours=!0}reinitializeCapture(){this.listeners.forEach(((e,t)=>{document.removeEventListener(t,e)})),this.listeners.clear(),this.menu.div.style.top="10px",this.menu.div.style.right="10px",this.capture_en_cours=!1}capturer(e){this.startCapture(),this.sendCaptureToMenu(new r.ElementCaptureData)}sendCaptureToMenu(e){this.reinitializeCapture(),this.data=e,this.menu.displayCaptureInfos()}sendCaptureToPoplab(e,t){var i,l,a,c,u;if((0,o.clearHighlight)(),this.data instanceof r.ElementCaptureData&&t){this.data.titre=t.titre,this.data.description=t.description,this.data.credit||(this.data.credit=document.URL);const e=[],s=[],r=[],n=[],o=[];null===(i=this.data.images)||void 0===i||i.forEach((i=>{-1!==t.mediasIds.indexOf(i.id)&&e.push(i)})),null===(l=this.data.videos)||void 0===l||l.forEach((e=>{-1!==t.mediasIds.indexOf(e.id)&&s.push(e)})),null===(a=this.data.audios)||void 0===a||a.forEach((e=>{-1!==t.mediasIds.indexOf(e.id)&&r.push(e)})),null===(c=this.data.urls)||void 0===c||c.forEach((e=>{-1!==t.mediasIds.indexOf(e.id)&&n.push(e)})),null===(u=this.data.fichiers)||void 0===u||u.forEach((e=>{-1!==t.mediasIds.indexOf(e.id)&&o.push(e)})),this.data.images=e,this.data.audios=r,this.data.videos=s,this.data.urls=n,this.data.fichiers=o,this.titre=t.titre,this.description=t.description}this.menu.old_capture=this,browser.runtime.sendMessage(new s.BrowserRuntimeMessageForPoplab(this.data instanceof r.ElementCaptureData?n.PoplabObjectType.ELEMENT:n.PoplabObjectType.DOCUMENT,this.type,this.data,e))}mousedown(e){return!0}mousemove(e){return!0}mouseup(e){return!0}keydown(e){return!0}isEmpty(){var e,t;return!(this.titre||this.description||(null===(e=this.data)||void 0===e?void 0:e.titre)||(null===(t=this.data)||void 0===t?void 0:t.description)||0!==this.mediaPreviews.length)}}},4911:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.fromHTML=t.clearHighlight=t.smoothScrollToTargetedHtmlElement=t.hasSameFileTypeMoreThanOnce=t.getCountPerFileType=void 0;const s=i(2688);function r(e){return Object.entries(e.reduce(((e,t)=>{const i=t.type_fichier;return e[i]=(e[i]||0)+1,e}),{})).map((([e,t])=>({typeFichier:e,count:t})))}t.getCountPerFileType=r,t.hasSameFileTypeMoreThanOnce=function(e){const t=r(e);return t.filter((e=>e.count>1)).length>0||2===t.filter((e=>e.typeFichier===s.TypeFichier.IMAGE||e.typeFichier===s.TypeFichier.VIDEO)).length};t.smoothScrollToTargetedHtmlElement=function(e,t=0){const i=document.querySelector(`#${e}`);if(i){const e=function(e){let t=e.parentElement;for(;t;){const e=window.getComputedStyle(t);if("auto"===e.overflowY||"scroll"===e.overflowY)return t;t=t.parentElement}return null}(i);if(e){let s=i.getBoundingClientRect().top+e.scrollTop-t;s>e.scrollHeight-e.getBoundingClientRect().height&&(s=e.scrollHeight-e.getBoundingClientRect().height),l(Math.floor(s),e).then((()=>o(i)))}else{let e=i.getBoundingClientRect().top+window.scrollY-t;const s=function(){const e=document.body,t=document.documentElement;return Math.max(e.scrollHeight,e.offsetHeight,t.clientHeight,t.scrollHeight,t.offsetHeight)-window.innerHeight-40}();e>s&&(e=s),l(Math.floor(e)).then((()=>o(i)))}}};let n=null;function o(e){n&&n.classList.remove("poplab-highlighted"),n=e;let t=document.getElementById("poplab-highlight-stylesheet");t||(t=document.createElement("style"),t.id="poplab-highlight-stylesheet",t.textContent="\n        .poplab-highlighted {\n            border: solid 8px rgb(75, 198, 185);\n        }",document.head.appendChild(t)),setTimeout((()=>{e.classList.add("poplab-highlighted")}),100)}function l(e,t){return t?t.scrollTo({top:e,behavior:"smooth"}):window.scrollTo({top:e,behavior:"smooth"}),new Promise((i=>{const s=()=>{t?Math.floor(t.scrollTop)!==e&&Math.ceil(t.scrollTop)!==e||(t.removeEventListener("scroll",s),i()):Math.floor(window.scrollY)!==e&&Math.ceil(window.scrollY)!==e||(window.removeEventListener("scroll",s),i())};t?(t.removeEventListener("scroll",s),Math.floor(t.scrollTop)===e||Math.ceil(t.scrollTop)===e?i():t.addEventListener("scroll",s)):(window.removeEventListener("scroll",s),Math.floor(window.scrollY)===e||Math.ceil(window.scrollY)===e?i():window.addEventListener("scroll",s))}))}t.clearHighlight=function(){var e;const t=document.getElementById("poplab-highlight-stylesheet");t&&(null===(e=t.parentNode)||void 0===e||e.removeChild(t))},t.fromHTML=function(e){if(!e)return null;const t=document.createElement("template");t.innerHTML=e;const i=t.content.children;return 1===i.length?i[0]:i}},2688:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.DocumentCaptureData=t.ElementCaptureData=t.CaptureData=t.FichierMediaObject=t.ExerciseurMediaObject=t.UrlMediaObject=t.AudioMediaObject=t.VideoMediaObject=t.ImageMediaObject=t.MediaObject=t.TypeFichier=t.CaptureType=void 0;const s=i(4393);var r,n;!function(e){e.BASIQUE="BASIQUE",e.UPLOAD="UPLOAD"}(r||(t.CaptureType=r={})),function(e){e.IMAGE="IMAGE",e.VIDEO="VIDEO",e.AUDIO="AUDIO",e.FICHIER="FICHIER",e.LIEN="LIEN",e.EXERCISEUR="EXERCISEUR"}(n||(t.TypeFichier=n={}));class o{constructor(e,t,i,s,r,n,o){this.id=e,this.url=t,this.type_fichier=i,this.copyright=s,this.file=r,this.editeur=n,this.subTypeFichier=o}}t.MediaObject=o,t.ImageMediaObject=class extends o{constructor(e,t,i,s,r){super(e,t,n.IMAGE,i,s,r)}},t.VideoMediaObject=class extends o{constructor(e,t,i,s,r){super(e,t,n.VIDEO,i,s,r)}},t.AudioMediaObject=class extends o{constructor(e,t,i,s,r){super(e,t,n.AUDIO,i,s,r)}},t.UrlMediaObject=class extends o{constructor(e,t,i,s){super(e,t,n.LIEN,i),this.displayPreview=!1,this.bigPreview=!1,this.label=s}},t.ExerciseurMediaObject=class extends o{constructor(e,t,i){super(e,t,n.EXERCISEUR),this.typeExerciseur=i}},t.FichierMediaObject=class extends o{constructor(e,t,i,s,r){super(e,t,n.FICHIER,void 0,i,void 0,s),this.label=r}};class l{constructor(e,t,i){this.titre=e,this.description=t,this.auteurInitial=i}}t.CaptureData=l;class a extends l{constructor(e){var t,i,r,n,o,l,a;super(null==e?void 0:e.titre,null==e?void 0:e.description,null==e?void 0:e.auteurInitial),this.type=s.ElementType.ELEMENT,this.images=[],this.videos=[],this.audios=[],this.urls=[],this.exerciseurs=[],this.fichiers=[],this.credit=null==e?void 0:e.credit,this.images=null!==(t=null==e?void 0:e.images)&&void 0!==t?t:[],this.videos=null!==(i=null==e?void 0:e.videos)&&void 0!==i?i:[],this.audios=null!==(r=null==e?void 0:e.audios)&&void 0!==r?r:[],this.urls=null!==(n=null==e?void 0:e.urls)&&void 0!==n?n:[],this.exerciseurs=null!==(o=null==e?void 0:e.exerciseurs)&&void 0!==o?o:[],this.fichiers=null!==(l=null==e?void 0:e.fichiers)&&void 0!==l?l:[],this.type=null!==(a=null==e?void 0:e.type)&&void 0!==a?a:s.ElementType.ELEMENT,this.options=null==e?void 0:e.options,this.meta=null==e?void 0:e.meta}setTitre(e){return this.titre=e,this}setDescription(e){return this.description=e,this}setCredit(e){return this.credit=e,this}setImages(e){return this.images=e,this}setVideos(e){return this.videos=e,this}setAudios(e){return this.audios=e,this}setUrls(e){return this.urls=e,this}setExerciseurs(e){return this.exerciseurs=e,this}setType(e){return this.type=e,this}getMedias(){return this.images.concat(this.videos.concat(this.audios.concat(this.fichiers)))}getAllEmbeds(){return this.getMedias().concat(this.urls).concat(this.exerciseurs)}}t.ElementCaptureData=a,t.DocumentCaptureData=class extends l{constructor(e){super(null==e?void 0:e.titre,null==e?void 0:e.description,null==e?void 0:e.auteurInitial),this.elements=[],null==e||e.elements.forEach((e=>this.elements.push(new a(e)))),this.meta=null==e?void 0:e.meta}setTitre(e){return this.titre=e,this}setDescription(e){return this.description=e,this}setElements(e){return this.elements=e,this}}},8033:(e,t)=>{var i,s,r,n,o;Object.defineProperty(t,"__esModule",{value:!0}),t.BrowserContextMenusId=t.MessageOngletDone=t.MessageOnglet=t.MessageOngletType=t.BrowserRuntimeResponse=t.BrowserRuntimeMessageSearchArborescenceWithSelectionnable=t.BrowserRuntimeMessageSearchArborescence=t.BrowserRuntimeMessageGetRecentArborescenceWithSelectionnable=t.BrowserRuntimeMessageGetRecentArborescence=t.BrowserRuntimeMessageForPoplab=t.BrowserRuntimeMessage=t.BrowserRuntimeMessageEventSubType=t.BrowserRuntimeMessageEventType=void 0,function(e){e.STATUS="status",e.CONNECT="connect",e.ENVOYER_SUR_POPLAB="envoyer_sur_poplab",e.CAPTURE_TAB="captureTab",e.GET_RECENT_ARBORESCENCE="getRecentHierarchies",e.SEARCH_ARBORESCENCE="searchArborescence"}(i||(t.BrowserRuntimeMessageEventType=i={})),function(e){e.WITH_SELECTIONNABLE="WithSelectionnable"}(s||(t.BrowserRuntimeMessageEventSubType=s={}));class l{constructor(e,t,i){this.type=e,this.subType=t,this.idp=i}}t.BrowserRuntimeMessage=l,t.BrowserRuntimeMessageForPoplab=class extends l{constructor(e,t,s,r){super(i.ENVOYER_SUR_POPLAB),this.type_item_poplab=e,this.type_capture=t,this.data=s,this.destination=r}},t.BrowserRuntimeMessageGetRecentArborescence=class extends l{constructor(){super(i.GET_RECENT_ARBORESCENCE)}},t.BrowserRuntimeMessageGetRecentArborescenceWithSelectionnable=class extends l{constructor(){super(i.GET_RECENT_ARBORESCENCE,s.WITH_SELECTIONNABLE)}};class a extends l{constructor(e,t,i){super(t,i),this.value=e}}t.BrowserRuntimeMessageSearchArborescence=class extends a{constructor(e){super(e,i.SEARCH_ARBORESCENCE)}},t.BrowserRuntimeMessageSearchArborescenceWithSelectionnable=class extends a{constructor(e){super(e,i.SEARCH_ARBORESCENCE,s.WITH_SELECTIONNABLE)}},function(e){e.INTERDIT="interdit",e.DECONNECTE="déconnecté",e.CONNECTE="connecté",e.ENVOYE="envoyé"}(r||(t.BrowserRuntimeResponse=r={})),function(e){e.STOP_CAPTURE="stopCapture",e.CAPTURER_LIEN="capturerLien",e.CAPTURER_IMAGE="capturerImage",e.CAPTURER_VIDEO="capturerVideo",e.TOGGLE_CAPTURE="toggleCapture",e.START_CAPTURE="startCapture",e.UPLOAD_FRIGO_DONE="uploadFrigoDone",e.CANCEL_UPLOAD="cancelUpload",e.REFRESH_CAPTURE="refreshCapture"}(n||(t.MessageOngletType=n={}));class c{constructor(e,t,i){this.first_name=void 0,this.provenance=void 0,this.type=e,this.first_name=t,this.provenance=i}}t.MessageOnglet=c,t.MessageOngletDone=class extends c{constructor(e,t){super(e),this.documentId=t}},function(e){e.SE_DECONNECTER="se-deconnecter",e.VOIR_FRIGO="voir-frigo",e.ENVOYER_LIEN="envoyer-lien",e.ENVOYER_IMAGE="envoyer-image",e.ENVOYER_VIDEO="envoyer-video"}(o||(t.BrowserContextMenusId=o={}))},4393:(e,t)=>{var i,s,r,n;Object.defineProperty(t,"__esModule",{value:!0}),t.Editeur=t.ElementType=t.ExerciseurType=t.PoplabElementCreationRequest=void 0,t.PoplabElementCreationRequest=class{constructor(e,t){var s,n,o;this.titre=null!==(s=e.titre)&&void 0!==s?s:"",this.description=null!==(n=e.description)&&void 0!==n?n:"",this.type=e.type,this.options={isnew:!0,separator:!1},this.type!==r.SECTION||this.titre||(this.options.separator=!0),this.credits=null!==(o=e.credit)&&void 0!==o?o:"",this.webAuteurInitial=e.auteurInitial,this.imageEmbed=e.images[0]?{url:e.images[0].url,type:i.IMAGE}:void 0,this.videoEmbed=e.videos[0]?{url:e.videos[0].url,type:i.VIDEO}:void 0,this.audioEmbed=e.audios[0]?{url:e.audios[0].url,type:i.AUDIO}:void 0,this.lienEmbed=e.urls[0]?{url:e.urls[0].url,label:e.urls[0].label,displayPreview:e.urls[0].displayPreview,bigPreview:e.urls[0].bigPreview,type:i.LIEN}:void 0,this.exerciseur=e.exerciseurs[0]?{url:e.exerciseurs[0].url,exerciseurType:e.exerciseurs[0].typeExerciseur,type:i.EXERCISEUR}:void 0,t&&(this.document=t),this.meta=e.meta}},function(e){e.LIEN="LIEN",e.IMAGE="IMAGE",e.VIDEO="VIDEO",e.AUDIO="AUDIO",e.FICHIER="FICHIER",e.EXERCISEUR="EXERCISEUR"}(i||(i={})),function(e){e.QUIZLET="QUIZLET",e.LEARNINGAPPS="LEARNINGAPPS",e.GENIALLY="GENIALLY",e.BOOKWIDGETS="BOOKWIDGETS",e.EDUPOOL="EDUPOOL",e.BELIN="BELIN"}(s||(t.ExerciseurType=s={})),function(e){e.ELEMENT="element",e.SECTION="section"}(r||(t.ElementType=r={})),function(e){e.BELIN="https://www.belin-education.com/"}(n||(t.Editeur=n={}))},853:(e,t)=>{var i;Object.defineProperty(t,"__esModule",{value:!0}),t.PoplabObjectType=void 0,function(e){e.ELEMENT="ELEMENT",e.DOCUMENT="DOCUMENT"}(i||(t.PoplabObjectType=i={}))}},t={};function i(s){var r=t[s];if(void 0!==r)return r.exports;var n=t[s]={exports:{}};return e[s](n,n.exports,i),n.exports}(()=>{const e=i(1241);e.Capture})()})();