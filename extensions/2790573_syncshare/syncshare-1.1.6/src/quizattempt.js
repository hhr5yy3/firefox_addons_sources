(()=>{"use strict";var e,t={6194:function(e,t,n){var i=this&&this.__awaiter||function(e,t,n,i){return new(n||(n=Promise))((function(s,o){function r(e){try{l(i.next(e))}catch(e){o(e)}}function a(e){try{l(i.throw(e))}catch(e){o(e)}}function l(e){var t;e.done?s(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(r,a)}l((i=i.apply(e,t||[])).next())}))},s=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.MagicButtonRegistry=void 0;const o=s(n(4643)),r=n(8319),a=s(n(2293)),l=s(n(8515)),c=s(n(3150));t.MagicButtonRegistry=class{constructor(){this.instances=new Set,this.doubleClickListener=()=>this.toggleMagicButtons()}init(e){return i(this,void 0,void 0,(function*(){const t=yield e.publishToBackground(o.default.GetSettings),{magicButtonsState:n}=yield c.default.storage.local.get({magicButtonsState:{visibilityOverridden:!1,buttonsVisible:!0}});this.buttonsVisible=n.buttonsVisible,this.visibilityOverridden=n.visibilityOverridden,(0,r.isSettings)(t)?this.applySettings(t):a.default.warn("MagicButtonRegistry: Got invalid settings object.",t),e.listen(o.default.SettingsUpdated,(e=>{(0,r.isSettings)(e)?this.applySettings(e):a.default.warn("MagicButtonRegistry: Could not update settings.",e)})),a.default.info("MagicButtonRegistry: Initialized")}))}applySettings(e){this.setupButtonsVisibility(e.hideWidgetByDefault),this.setupHotkey(e.widgetToggleHotkey),this.setupDoubleClick(e.widgetToggleDoubleClick)}setupButtonsVisibility(e){if(!this.visibilityOverridden){this.buttonsVisible=!e;for(const e of this.instances)this.buttonsVisible?e.show():e.hide()}}setupHotkey(e){if(this.toggleHotkey){if(this.toggleHotkey===e)return;l.default.unbind(this.toggleHotkey)}(0,l.default)(e,{keyup:!0,keydown:!0},((e,t)=>{if(!e.repeat&&"keydown"===e.type)return this.toggleMagicButtons(),!1})),this.toggleHotkey=e}setupDoubleClick(e){!e&&this.toggleDoubleClick?window.removeEventListener("dblclick",this.doubleClickListener):e&&!this.toggleDoubleClick&&window.addEventListener("dblclick",this.doubleClickListener),this.toggleDoubleClick=e}toggleMagicButtons(){this.visibilityOverridden=!0;for(const e of this.instances)e.toggleVisibility();this.buttonsVisible=!this.buttonsVisible,c.default.storage.local.set({magicButtonsState:{visibilityOverridden:this.visibilityOverridden,buttonsVisible:this.buttonsVisible}})}register(e){this.instances.add(e),this.buttonsVisible?e.show():e.hide()}}},3603:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.Parser=t.ControlWrapper=void 0;const i=n(7684),s=n(1132),o=n(8431),r=n(42),a=n(8359),l=n(5193);class c{constructor(e){this.options=[],this.control=e,this.parent=(0,r.checkNotNull)(this.control.parentElement,"Control's parent is missing"),this.control.childNodes.forEach((e=>{e instanceof HTMLOptionElement&&""!==(0,s.strip)(e.value)&&this.options.push((0,s.strip)(e.innerText))}))}setOption(e){if(0===this.options.length)return;let t=this.options.indexOf(e);if(-1===t){const n=(0,s.fuzzyMatch)(e,this.options);if(null===n)return;t=n.index}this.control.value=t.toString()}getOptions(){return this.options}getUserInput(){const e=parseInt(this.control.value),t=isNaN(e)?"":this.options[e],n=(0,i.getStateFromClassList)(this.parent),s=(0,i.getStateFromClassList)(this.control);let o;return o=n===s?n:n==i.State.Unknown?s:s==i.State.Unknown?n:i.State.Unknown,{option:t,state:o}}createWidgetContainer(){const e=document.createElement("span");return this.parent.appendChild(e),e}}t.ControlWrapper=c;class u{constructor(e){this.anchor=[],this.images=[];const t=(0,r.checkNotNull)(e.querySelector(".text"),"Missing .text"),n=(0,r.checkNotNull)(e.querySelector(".control > select"),"Missing .control");this.wrapper=new c(n),this.text=t.innerHTML;const i=(0,s.strip)(t.innerText);""!==i&&this.anchor.push(i),t.querySelectorAll("img").forEach((e=>{const t=(0,o.fromImageElementLazy)(e);this.images.push(t),this.anchor.push((0,l.hashQuestionImage)(t));const n=(0,s.extractFilenameFromUrl)(t.src);n&&this.anchor.push(n)}))}serializeToJson(){return{html:this.text,images:this.images,userInput:this.wrapper.getUserInput()}}setOption(e){this.wrapper.setOption(e)}createWidgetContainer(){return this.wrapper.createWidgetContainer()}getOptions(){return this.wrapper.getOptions()}getAnchor(){return this.anchor}}class d extends i.Question{constructor(e){super(e),this.subquestions=[],this.formulation=new i.QTextWrapper(e),(0,r.checkNotNull)(this.container.querySelector("table.answer"),"Missing .answer table").querySelectorAll("tr").forEach((e=>{this.subquestions.push(new u(e))}))}serializeToJSON(){return Object.assign(Object.assign({},super.serializeToJSON()),{formulation:this.formulation.getFormulation(),subquestions:this.subquestions.map((e=>e.serializeToJson())),options:this.subquestions[0].getOptions(),feedback:this.getFeedback()})}createWidgetAnchor(e){const t=(0,a.fuzzyAnchor)(e,this.subquestions.map((e=>e.getAnchor())));if(-1===t)return null;const n=this.subquestions[t];return{onApply:e=>n.setOption(e),container:n.createWidgetContainer()}}getFeedback(){const e=this.container.querySelector("div.feedback");return e instanceof HTMLDivElement?e.innerHTML:null}}t.Parser=d},388:function(e,t,n){var i=this&&this.__createBinding||(Object.create?function(e,t,n,i){void 0===i&&(i=n);var s=Object.getOwnPropertyDescriptor(t,n);s&&!("get"in s?!t.__esModule:s.writable||s.configurable)||(s={enumerable:!0,get:function(){return t[n]}}),Object.defineProperty(e,i,s)}:function(e,t,n,i){void 0===i&&(i=n),e[i]=t[n]}),s=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),o=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)"default"!==n&&Object.prototype.hasOwnProperty.call(e,n)&&i(t,e,n);return s(t,e),t};Object.defineProperty(t,"__esModule",{value:!0}),t.Parser=void 0;const r=n(7684),a=o(n(8494)),l=o(n(8366)),c=o(n(3603)),u=n(8431),d=n(42);var h;function f(e){const t=(0,d.checkNotNull)(e.match(/sub(\d+)/),"Could not parse subquestion's index");return parseInt(t[1])}!function(e){e.Shortanswer="sa",e.MultichoiceSingle="mc_single",e.MultichoiceSeveral="mc_several",e.Combobox="cb"}(h||(h={}));class p extends a.ContainerWrapper{constructor(e){super(e),this.index=f(this.answerOptions[0].getControl().name),this.__type=this.multipleAnswersAllowed?h.MultichoiceSeveral:h.MultichoiceSingle}serializeToJSON(){return{index:this.index,__type:this.__type,options:this.getOptions(),feedback:this.getFeedback()}}createWidgetAnchor(e){return super.createWidgetAnchor(e)}getFeedback(){const e=this.container.nextElementSibling;return null===e||-1===e.className.indexOf("outcome")?null:e.outerHTML}}class g extends l.ControlWrapper{constructor(e){super(e),this.__type=h.Shortanswer,this.index=f(e.name)}serializeToJSON(){return{index:this.index,__type:this.__type,userInput:this.getUserInput(),feedback:this.getFeedback()}}createWidgetAnchor(){return super.createWidgetAnchor()}getFeedback(){const e=this.control.parentElement;if(null===e)return null;const t=e.querySelector("span.feedbackspan");return null===t?null:t.outerHTML}}class m extends c.ControlWrapper{constructor(e){super(e),this.__type=h.Combobox,this.index=f(e.name)}serializeToJSON(){return{index:this.index,__type:this.__type,options:this.getOptions(),userInput:this.getUserInput(),feedback:this.getFeedback()}}createWidgetAnchor(){return{onApply:e=>super.setOption(e),container:super.createWidgetContainer()}}getFeedback(){const e=this.control.parentElement;if(null===e)return null;const t=e.querySelector("span.feedbackspan");return null===t?null:t.outerHTML}}class b extends r.Question{constructor(e){super(e),this.formulationImages=[],this.subquestions=new Map;const t=(0,d.checkNotNull)(this.container.querySelector("div.formulation"),"Missing .formulation");t.querySelectorAll("img").forEach((e=>{const t=(0,u.fromImageElementLazy)(e);this.formulationImages.push(t)})),this.formulation=t.innerHTML,this.container.querySelectorAll("div.answer, table.answer").forEach((e=>{const t=new p(e);this.subquestions.set(t.index,t)})),this.container.querySelectorAll("span.subquestion > select").forEach((e=>{const t=new m(e);this.subquestions.set(t.index,t)})),this.container.querySelectorAll("span.subquestion > input").forEach((e=>{const t=new g(e);this.subquestions.set(t.index,t)}))}serializeToJSON(){const e=[];for(const t of this.subquestions.values())e.push(t.serializeToJSON());return Object.assign(Object.assign({},super.serializeToJSON()),{formulation:{html:this.formulation,images:this.formulationImages},subquestions:e})}createWidgetAnchor(e){const t=this.subquestions.get(e.index);return void 0===t||t.__type!=e.__type?null:t.createWidgetAnchor(e.anchor)}}t.Parser=b},8494:function(e,t,n){var i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.Parser=t.ContainerWrapper=void 0;const s=n(7684),o=n(1132),r=n(42),a=n(8431),l=i(n(2293)),c=n(8359),u=n(5193);class d{constructor(e){this.images=[],this.anchor=[],this.control=e,this.parent=(0,r.checkNotNull)(e.parentElement,"AnswerOption: Missing control's parent element");const t=(0,r.checkNotNull)(e.labels,"AnswerOption: Control is hidden");let n,i;if(0==t.length){const t=(0,r.checkNotNull)(e.getAttribute("aria-labelledby"),"AnswerOption: Control doesn't have aria-labelledby"),i=t.replace(":","\\:");n=(0,r.checkNotNull)(this.parent.querySelector("#"+i),`AnswerOption: Label '${t}' not found`)}else n=t[0];const s=n.querySelector(".answernumber");if(null!==s){const e=(0,r.checkNotNull)(n.lastChild,"AnswerOption: Label doesn't have children");if(s===e)throw Error("AnswerOption: Label contains only number");e instanceof HTMLElement?(i=(0,o.strip)(e.innerText),this.textHtml=e.innerHTML):(i=(0,o.strip)(e.textContent||""),this.textHtml=i)}else i=(0,o.strip)(n.innerText),this.textHtml=n.innerHTML;""!==i&&this.anchor.push(i),n.querySelectorAll("img").forEach((e=>{const t=(0,a.fromImageElementLazy)(e);this.images.push(t),this.anchor.push((0,u.hashQuestionImage)(t));const n=(0,o.extractFilenameFromUrl)(t.src);n&&this.anchor.push(n)}))}getControl(){return this.control}serializeToJson(){return{html:this.textHtml,images:this.images,userInput:{checked:this.control.checked,state:(0,s.getStateFromClassList)(this.parent)}}}createWidgetContainer(){const e=document.createElement("span");return this.parent.insertBefore(e,this.control.nextSibling),e}setChecked(e){this.control.checked=e}getAnchor(){return this.anchor}}class h{constructor(e){this.answerOptions=[],this.container=e;const t=e.querySelectorAll('input[type="radio"]'),n=e.querySelectorAll('input[type="checkbox"]');if(t.length>0)this.multipleAnswersAllowed=!1,t.forEach((e=>{e instanceof HTMLInputElement&&this.answerOptions.push(new d(e))}));else{if(!(n.length>0))throw Error("Could not parse multichoice question: input elements are not found");this.multipleAnswersAllowed=!0,n.forEach((e=>{e instanceof HTMLInputElement&&this.answerOptions.push(new d(e))}))}}getOptions(){return this.answerOptions.map((e=>e.serializeToJson()))}createWidgetAnchor(e){if(this.multipleAnswersAllowed){const t=(0,c.fuzzyAnchor)(e,this.answerOptions.map((e=>e.getAnchor())));if(-1===t)return null;const n=this.answerOptions[t];return{onApply:e=>{const t=e.checked;void 0!==t?n.setChecked(t):l.default.warn("Multichoice (checkbox): Could not autofill solution: missing checked flag")},container:n.createWidgetContainer()}}{const e=document.createElement("span");this.container.appendChild(e);const t=e=>{var t;const n=e.anchor;if(void 0===n)return void l.default.warn("Multichoice (radio): Could not autofill solution: missing anchor");const i=(0,c.fuzzyAnchor)(n,this.answerOptions.map((e=>e.getAnchor())));-1!==i&&(null===(t=this.answerOptions[i])||void 0===t||t.setChecked(!0))};return{onApply:t,container:e}}}}t.ContainerWrapper=h;class f extends s.Question{constructor(e){super(e);const t=(0,r.checkNotNull)(this.container.querySelector("div.answer"),"Missing .answer");this.wrapper=new h(t),this.formulation=new s.QTextWrapper(e)}serializeToJSON(){return Object.assign(Object.assign({},super.serializeToJSON()),{formulation:this.formulation.getFormulation(),options:this.wrapper.getOptions(),feedback:this.getFeedback(),single:!this.wrapper.multipleAnswersAllowed})}createWidgetAnchor(e){return this.wrapper.createWidgetAnchor(e)}getFeedback(){const e=this.container.querySelector("div.feedback");return e instanceof HTMLDivElement?e.innerHTML:null}}t.Parser=f},7684:function(e,t,n){var i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.Question=t.QTextWrapper=t.isSolution=t.getStateFromClassList=t.State=void 0;const s=n(2843),o=i(n(3150)),r=n(8431),a=n(42),l=i(n(2678)),c=n(4781);var u;!function(e){e[e.Unknown=-1]="Unknown",e[e.Incorrect=0]="Incorrect",e[e.PartiallyCorrect=1]="PartiallyCorrect",e[e.Correct=2]="Correct"}(u=t.State||(t.State={})),t.getStateFromClassList=function(e){const t=e.classList;return t.contains("incorrect")?u.Incorrect:t.contains("prtiallycorrect")?u.PartiallyCorrect:t.contains("correct")?u.Correct:u.Unknown},t.isSolution=function(e){return(0,a.isObject)(e)&&"anchor"in e},t.QTextWrapper=class{constructor(e){this.formulationImages=[];const t=(0,a.checkNotNull)(e.querySelector(".qtext"),"Missing .qtext");this.formulation=t.innerHTML,t.querySelectorAll("img").forEach((e=>{const t=(0,r.fromImageElementLazy)(e);this.formulationImages.push(t)}))}getFormulation(){return{html:this.formulation,images:this.formulationImages}}},t.Question=class{constructor(e){this.grade=[];const t=e.classList;if(t.length<4)throw Error("Invalid question container: class list doesnt contain required data");const n=(0,a.checkIfInstance)(e.querySelector("input.questionflagpostdata"),HTMLInputElement,"Question doesn't have details block"),i=new URL("a://a/a?"+n.value),s=(0,a.checkNotNull)(i.searchParams.get("qid"),"Question doesn't have an id");this.id=parseInt(s),this.__type=t[1],this.behavior=t[2],this.state=t[3];const o=(0,a.checkNotNull)(e.querySelector("div.info"),"Could not locate .info block"),r=(0,a.checkNotNull)(o.querySelector("div.grade"),"Could not locate .grade");for(const e of r.innerText.matchAll(/[0-9]\d*([.,]\d+)?/g))this.grade.push(parseFloat(e[0]));this.container=e}handleSolution(e,t){function n(e){const t={backColor:"rgba(228,225,237,0.44)",frontColor:"#5D616C"};switch(e){case u.Incorrect:t.backColor="rgba(255,221,227,0.87)",t.frontColor="#F93A5B";break;case u.PartiallyCorrect:t.backColor="rgba(254,245,212,0.67)",t.frontColor="#FA9A0F";break;case u.Correct:t.backColor="rgba(225,238,227,0.73)",t.frontColor="#27993A"}return t}const i=[],r=e.suggestions,d=e.submissions,h=e.suggestionsLock,f=this.createWidgetAnchor(e.anchor);if(!f)return;if((0,a.isObject)(h)){const e=()=>{var e;return null===(e=window.open(h.actionUrl,"_blank"))||void 0===e?void 0:e.focus()};i.push({label:o.default.i18n.getMessage("magicMenuSuggestions"),icon:{name:["fa","fa-bolt"],alignRight:!1},subMenu:[{label:h.message,icon:{name:["fa","fa-lock"],alignRight:!0}},{label:h.actionText,icon:{name:["fa","fa-external-link"],alignRight:!0},action:e}]})}if(r&&r.length>0){const e={label:o.default.i18n.getMessage("magicMenuSuggestions"),icon:{name:["fa","fa-bolt"],alignRight:!1},subMenu:[]};r.forEach((t=>{var i;null===(i=e.subMenu)||void 0===i||i.push({label:t.label,icon:Object.assign({alignRight:!0,text:100*t.confidence+"%"},n(t.correctness)),action:()=>f.onApply(t.data)})})),i.push(e)}if(d&&(null==d?void 0:d.length)>0){const e={label:o.default.i18n.getMessage("magicMenuSubmissions"),icon:{name:["fa","fa-bar-chart"],alignRight:!1},subMenu:[]};d.forEach((t=>{var i;null===(i=e.subMenu)||void 0===i||i.push({label:t.label,icon:Object.assign({alignRight:!0,text:t.count.toString()},n(t.correctness)),action:()=>f.onApply(t.data)})})),i.push(e)}const p=f.container.attachShadow({mode:"closed"}),g=new l.default,m=new s.ContextMenu(i),b=(0,c.getFontAwesomeLink)();b?p.appendChild(b):g.element.innerText="[s]",m.attach(g,f.container),p.appendChild(g.element),t.register(g)}serializeToJSON(){return{id:this.id,__type:this.__type,behavior:this.behavior,state:this.state,grade:this.grade}}}},168:function(e,t,n){var i=this&&this.__createBinding||(Object.create?function(e,t,n,i){void 0===i&&(i=n);var s=Object.getOwnPropertyDescriptor(t,n);s&&!("get"in s?!t.__esModule:s.writable||s.configurable)||(s={enumerable:!0,get:function(){return t[n]}}),Object.defineProperty(e,i,s)}:function(e,t,n,i){void 0===i&&(i=n),e[i]=t[n]}),s=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),o=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)"default"!==n&&Object.prototype.hasOwnProperty.call(e,n)&&i(t,e,n);return s(t,e),t},r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const a=o(n(3603)),l=o(n(388)),c=o(n(8494)),u=o(n(8366)),d=r(n(2293)),h=n(1742);t.default=class{parse(e){try{switch(e.classList[1]){case h.QuestionType.Match:return new a.Parser(e);case h.QuestionType.Multianswer:return new l.Parser(e);case h.QuestionType.Multichoice:case h.QuestionType.MultichoiceSet:case h.QuestionType.TrueFalse:return new c.Parser(e);case h.QuestionType.Shortanswer:case h.QuestionType.Numerical:return new u.Parser(e);default:d.default.warn("Unknown question type:",e.classList[1])}}catch(e){d.default.error(e,"Could not parse question")}return null}}},8366:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.Parser=t.ControlWrapper=void 0;const i=n(7684),s=n(42);class o{constructor(e){this.control=e}createWidgetAnchor(){const e=(0,s.checkNotNull)(this.control.parentElement,"Missing control's parent"),t=document.createElement("span");return e.appendChild(t),{container:t,onApply:e=>this.control.value=e}}getUserInput(){return{value:this.control.value,state:(0,i.getStateFromClassList)(this.control)}}}t.ControlWrapper=o;class r extends i.Question{constructor(e){super(e);const t=(0,s.checkNotNull)(this.container.querySelector("span.answer > input"),"Missing input field");this.wrapper=new o(t),this.formulation=new i.QTextWrapper(e)}createWidgetAnchor(){return this.wrapper.createWidgetAnchor()}serializeToJSON(){return Object.assign(Object.assign({},super.serializeToJSON()),{formulation:this.formulation.getFormulation(),userInput:this.wrapper.getUserInput(),feedback:this.getFeedback()})}getFeedback(){const e=this.container.querySelector("div.feedback");return e instanceof HTMLDivElement?e.innerHTML:null}}t.Parser=r},856:function(e,t,n){var i=this&&this.__createBinding||(Object.create?function(e,t,n,i){void 0===i&&(i=n);var s=Object.getOwnPropertyDescriptor(t,n);s&&!("get"in s?!t.__esModule:s.writable||s.configurable)||(s={enumerable:!0,get:function(){return t[n]}}),Object.defineProperty(e,i,s)}:function(e,t,n,i){void 0===i&&(i=n),e[i]=t[n]}),s=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),o=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)"default"!==n&&Object.prototype.hasOwnProperty.call(e,n)&&i(t,e,n);return s(t,e),t},r=this&&this.__awaiter||function(e,t,n,i){return new(n||(n=Promise))((function(s,o){function r(e){try{l(i.next(e))}catch(e){o(e)}}function a(e){try{l(i.throw(e))}catch(e){o(e)}}function l(e){var t;e.done?s(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(r,a)}l((i=i.apply(e,t||[])).next())}))},a=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const l=a(n(168)),c=a(n(2293)),u=n(7684),d=a(n(313)),h=a(n(4643)),f=n(42),p=n(5029),g=a(n(6685)),m=a(n(9423)),b=a(n(4828)),y=a(n(3487)),v=a(n(8056)),w=a(n(6324)),_=a(n(7939)),O=n(6194),S=a(n(6039)),M=a(n(3150)),k=o(n(7464)),x=a(n(5740));n(6302).HeadHunter.printAnnounce();class C{constructor(e){this.bus=e,this.questions=[]}get meta(){return this._meta}init(){return r(this,void 0,void 0,(function*(){const e=new S.default,t=new p.MultiSource;t.add(new v.default,1),t.add(new _.default,2),t.add(new w.default,3),t.add(new b.default,4),t.add(new y.default,5),t.add(new g.default,6),t.add(new m.default,1),yield e.load(),yield t.load();const n=new p.MultiSource;n.add(t,1),n.add(e,2),e.get("attemptId")!==t.get("attemptId")&&(yield M.default.storage.local.remove("magicButtonsState"),c.default.info("QuizPage: Magic buttons state invalidated"));const i=new k.default(t,e);(yield i.invalidate())&&(c.default.info("QuizPage: Attempt context invalidated"),new x.default(k.PARALLEL_ATTEMPTS_WARNING).show()),this._meta={host:n.get("host"),courseId:n.get("courseId"),courseName:n.get("courseName"),quizId:n.get("quizId"),quizName:n.get("quizName"),attemptId:n.get("attemptId"),moodleId:n.get("moodleId")},e.saveAttemptData(this._meta),this.magicButtonRegistry=new O.MagicButtonRegistry,yield this.magicButtonRegistry.init(this.bus);const s=new l.default;document.querySelectorAll("div.que").forEach((e=>{if(!(e instanceof HTMLDivElement))return;const t=s.parse(e);t&&this.questions.push(t)}))}))}processAttempt(){for(const e of this.questions)this.bus.publishToBackground(h.default.SolutionRequest,{questionId:e.id,questionType:e.__type,quizMeta:this._meta}).then((t=>{if(t)if((0,f.isArray)(t))for(const n of t)(0,u.isSolution)(n)?e.handleSolution(n,this.magicButtonRegistry):c.default.warn("Invalid solution response: unrecognized object",n);else c.default.error("Invalid solution response: expected an array but got something else",t)})).catch((e=>{c.default.error(e,"Error during solution request")}));window.addEventListener("beforeunload",(e=>{this.bus.publishToBackground(h.default.QuizAttemptData,{quizMeta:this._meta,questions:this.questions.map((e=>e.serializeToJSON()))})}))}processReview(){const e=document.querySelector("table.quizreviewsummary");this.bus.publishToBackground(h.default.QuizReviewData,{quizMeta:this._meta,reviewSummary:(null==e?void 0:e.innerHTML)||null,questions:this.questions.map((e=>e.serializeToJSON()))})}}!function(){r(this,void 0,void 0,(function*(){const e=new d.default,t=new C(e);yield t.init(),c.default.info("QuizPage: Checking page for compatibility...");let n=!0;for(const[e,i]of Object.entries(t.meta))null===t.meta[e]&&(c.default.warn(`QuizPage: Missing required parameter '${e}'`),n=!1);if(n)if(c.default.info("QuizPage: Yay, page can be served ^_^"),document.querySelector("#page-mod-quiz-review")){c.default.info("QuizPage: Serving as a review"),e.publishToBackground(h.default.ReviewPageOpened,t.meta);try{t.processReview()}catch(e){c.default.error(e,"Error occurred while serving page")}}else{c.default.info("QuizPage: Serving as an attempt"),e.publishToBackground(h.default.AttemptPageOpened,t.meta);try{t.processAttempt()}catch(e){c.default.error(e,"Error occurred while serving page")}}else c.default.info("QuizPage: Sorry, page is not compatible.")}))}()},6324:function(e,t,n){var i=this&&this.__awaiter||function(e,t,n,i){return new(n||(n=Promise))((function(s,o){function r(e){try{l(i.next(e))}catch(e){o(e)}}function a(e){try{l(i.throw(e))}catch(e){o(e)}}function l(e){var t;e.done?s(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(r,a)}l((i=i.apply(e,t||[])).next())}))},s=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const o=s(n(573));class r extends o.default{load(){return i(this,void 0,void 0,(function*(){const e=document.querySelector("a.endtestlink.aalink");if(e instanceof HTMLAnchorElement){const t=new URL(e.href),n=t.searchParams.get("cmid"),i=t.searchParams.get("attempt");n&&(this.data.quizId=parseInt(n)),i&&(this.data.attemptId=parseInt(i))}}))}}t.default=r},4781:function(e,t,n){var i=this&&this.__awaiter||function(e,t,n,i){return new(n||(n=Promise))((function(s,o){function r(e){try{l(i.next(e))}catch(e){o(e)}}function a(e){try{l(i.throw(e))}catch(e){o(e)}}function l(e){var t;e.done?s(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(r,a)}l((i=i.apply(e,t||[])).next())}))},s=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.loadExtensionStyle=t.getExtensionStyle=t.getStyleLink=t.getFontAwesomeLink=void 0;const o=s(n(3150));function r(e){const t=document.createElement("link");return t.setAttribute("rel","stylesheet"),t.setAttribute("href",e),t}t.getFontAwesomeLink=function(){const e=document.head.querySelector('link[href$="/all"]');return null!==e?r(e.href):null},t.getStyleLink=r,t.getExtensionStyle=function(e){return r(o.default.runtime.getURL(e))},t.loadExtensionStyle=function(e){return i(this,void 0,void 0,(function*(){const t=document.createElement("style"),n=o.default.runtime.getURL("").slice(0,-1),i=yield fetch(o.default.runtime.getURL(e),{method:"GET"}),s=yield i.text();return t.innerHTML=s.replace(/{extension-url}/g,n),t}))}},8431:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.fromImageElementLazy=void 0;const i=n(5193);t.fromImageElementLazy=function(e){const t={src:"",alt:e.alt,data:""};return e.src.startsWith("data:")?t.src=(0,i.hashString)(e.src).toString():t.src=e.src,t}},5193:(e,t)=>{function n(e){return e.replace(/^ +| +$|\\n|\n/g,"")}function i(e){let t,n,i=0;if(0===e.length)return i;for(t=0;t<e.length;t++)n=e.charCodeAt(t),i=(i<<5)-i+n,i|=0;return i}Object.defineProperty(t,"__esModule",{value:!0}),t.hashQuestionImage=t.hashString=t.cleanString=void 0,t.cleanString=n,t.hashString=i,t.hashQuestionImage=function(e){const t=e.src.lastIndexOf("/"),s={fn:n(-1!==t?e.src.slice(t+1):e.src),alt:e.alt};return i(JSON.stringify(s)).toString()}},8359:function(e,t,n){var i=this&&this.__createBinding||(Object.create?function(e,t,n,i){void 0===i&&(i=n);var s=Object.getOwnPropertyDescriptor(t,n);s&&!("get"in s?!t.__esModule:s.writable||s.configurable)||(s={enumerable:!0,get:function(){return t[n]}}),Object.defineProperty(e,i,s)}:function(e,t,n,i){void 0===i&&(i=n),e[i]=t[n]}),s=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),o=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)"default"!==n&&Object.prototype.hasOwnProperty.call(e,n)&&i(t,e,n);return s(t,e),t};Object.defineProperty(t,"__esModule",{value:!0}),t.fuzzyAnchor=void 0;const r=o(n(1811));t.fuzzyAnchor=function(e,t){if(0===t.length)return-1;let n=!1,i=-1,s=1/0;for(let o=0;o<t.length;o++){const a=t[o];let l=1/0;e:for(const t of e)for(const e of a){const n=r.distance(t,e);if(n<l&&(l=n),0==n)break e}if(0==l)return o;l<s?(i=o,s=l,n=!1):l===s&&(n=!0)}return n?-1:i}},7927:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.default=class{constructor(){this._visible=!0,this._element=this.createElement()}get visible(){return this._visible}get element(){return this._element}hide(){this.element.style.visibility="hidden",this._visible=!1}show(){this.element.style.visibility="visible",this._visible=!0}toggleVisibility(){this._visible?this.hide():this.show()}}},2843:function(e,t,n){var i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.ContextMenu=void 0;const s=i(n(7187)),o=n(4781),r=i(n(313)),a=document.createElement("div"),l=a.attachShadow({mode:"closed"}),c=(0,o.getExtensionStyle)("/css/context-menu.css"),u=(0,o.getFontAwesomeLink)();null!==u&&l.append(u),l.append(c),document.body.appendChild(a),new r.default;class d extends s.default{get button(){return this._button}constructor(e){var t;super(),this._button=null,this.isShown=!1,this.menu=document.createElement("ul"),this.menu.classList.add("syncshare-cm"),this.menu.hidden=!0,this.constructMenu(this.menu,e),l.appendChild(this.menu),window.addEventListener("resize",(()=>this.hide())),document.addEventListener("click",(e=>{e.target!=this.buttonContainer&&this.hide()})),window.addEventListener("scroll",(()=>this.hide())),null===(t=document.querySelector("#page"))||void 0===t||t.addEventListener("scroll",(()=>this.hide()))}constructMenu(e,t){for(const n of t){const t=this.constructOption(n);if(t.addEventListener("click",(e=>{e.stopPropagation(),n.subMenu||(this.hide(),this.emit("OptionClick",n),n.action&&n.action(n))})),e.appendChild(t),n.subMenu){const e=document.createElement("ul");e.classList.add("sub-menu"),t.appendChild(e),this.constructMenu(e,n.subMenu)}}}constructOption(e){const t=document.createElement("li");t.classList.add("menu-item");const n=document.createTextNode(e.label),i=document.createElement("span");if(i.classList.add("item-label"),i.appendChild(n),t.appendChild(i),e.icon){const n=document.createElement("span"),s=e.icon;if(s.frontColor&&(n.style.color=s.frontColor),s.backColor&&(n.style.backgroundColor=s.backColor),s.name&&!s.text)n.classList.add("icon","fa-fw",...s.name);else if(s.text&&!s.name){const e=document.createTextNode(s.text);n.appendChild(e)}if(s.alignRight){const e=document.createElement("div");e.classList.add("postfix"),n.classList.add("content"),e.appendChild(n),t.appendChild(e)}else n.classList.add("prefix"),t.insertBefore(n,i)}if(e.subMenu&&e.subMenu.length>0){const e=document.createElement("div");e.classList.add("postfix");const n=document.createElement("span");n.classList.add("icon","fa","fa-fw","fa-angle-right","arrow-icon"),e.appendChild(n),t.appendChild(e)}return t}show(e,t){if(this.isShown)return;const{innerWidth:n,innerHeight:i}=window,{offsetWidth:s,offsetHeight:o}=this.menu;let r="0",a="0";this.menu.classList.remove("left"),this.menu.classList.remove("top"),e>=n/4*3&&this.menu.classList.add("left"),t>=i/4*3&&this.menu.classList.add("top"),e>=n-s&&(r="-100%"),t>=i-o&&(a="-100%"),this.menu.style.left=e+"px",this.menu.style.top=t+"px",this.menu.style.transform=`translate(${r}, ${a})`,this.menu.hidden=!1,this.isShown=!0,this.emit("MenuShown")}hide(){this.isShown&&(this.menu.hidden=!0,this.isShown=!1,this.emit("MenuHidden"))}attach(e,t){this._button=e,this.buttonContainer=t,e.element.addEventListener("click",(e=>{e.preventDefault(),this.show(e.clientX,e.clientY)}))}}t.ContextMenu=d},2678:function(e,t,n){var i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const s=i(n(7927));class o extends s.default{createElement(){const e=document.createElement("span");return e.classList.add("icon","fa","fa-magic","fa-fw"),e.style.cursor="pointer",e}}t.default=o}},n={};function i(e){var s=n[e];if(void 0!==s)return s.exports;var o=n[e]={exports:{}};return t[e].call(o.exports,o,o.exports,i),o.exports}i.m=t,e=[],i.O=(t,n,s,o)=>{if(!n){var r=1/0;for(u=0;u<e.length;u++){for(var[n,s,o]=e[u],a=!0,l=0;l<n.length;l++)(!1&o||r>=o)&&Object.keys(i.O).every((e=>i.O[e](n[l])))?n.splice(l--,1):(a=!1,o<r&&(r=o));if(a){e.splice(u--,1);var c=s();void 0!==c&&(t=c)}}return t}o=o||0;for(var u=e.length;u>0&&e[u-1][2]>o;u--)e[u]=e[u-1];e[u]=[n,s,o]},i.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return i.d(t,{a:t}),t},i.d=(e,t)=>{for(var n in t)i.o(t,n)&&!i.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:t[n]})},i.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),i.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},i.j=867,(()=>{var e={867:0};i.O.j=t=>0===e[t];var t=(t,n)=>{var s,o,[r,a,l]=n,c=0;if(r.some((t=>0!==e[t]))){for(s in a)i.o(a,s)&&(i.m[s]=a[s]);if(l)var u=l(i)}for(t&&t(n);c<r.length;c++)o=r[c],i.o(e,o)&&e[o]&&e[o][0](),e[o]=0;return i.O(u)},n=self.webpackChunksyncshare_extension=self.webpackChunksyncshare_extension||[];n.forEach(t.bind(null,0)),n.push=t.bind(null,n.push.bind(n))})();var s=i.O(void 0,[351],(()=>i(856)));s=i.O(s)})();