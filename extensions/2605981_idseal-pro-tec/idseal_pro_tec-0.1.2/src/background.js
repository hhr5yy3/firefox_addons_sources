function ProcessBlockedCookie(e,s){browser.tabs.get(s,function(t){ProcessSendingQueue("Cookie%"+e+"%"),Block(e,s,t.windowId)})}function GetUrlFromTabId(e,s){browser.webNavigation.getFrame({tabId:e,frameId:0},function(e){var t=getRootDomain(e.url);s(t)})}browser.webRequest.onBeforeSendHeaders.addListener(function(e){if(TrackingBlocker){if(204==e.statusCode||205==e.statusCode)return;if(-1===e.tabId)return{requestHeaders:e.requestHeaders};0===e.frameId&&-1===e.parentFrameId&&"main_frame"===e.type&&delete blockedTabData[e.tabId];var s=getRootDomain(__PRIMARY_DOMAIN_STORAGE[e.tabId]),t=getRootDomain(e.url);if("main_frame"===e.type)return{requestHeaders:e.requestHeaders};if(IsDomainWhitelisted(s,"tracking"))return{requestHeaders:e.responseHeaders};for(var o=0;o<hardCodedWhitelist.length;o++)if(e.url.includes(hardCodedWhitelist[o]))return{responseHeaders:e.responseHeaders};if(s===t)return{requestHeaders:e.requestHeaders};if("script"===e.type||"other"===e.type||"xmlhttprequest"===e.type||"object"===e.type||"sub_frame"===e.type||"image"===e.type)for(o=0;o<e.requestHeaders.length;o++){if(TrackingBlocker&&"cookie"===e.requestHeaders[o].name.toLowerCase()&&(e.requestHeaders.splice(o,1),--o),TrackingBlocker&&"user-agent"===e.requestHeaders[o].name.toLowerCase()){let s=UserAgents[Math.floor(Math.random()*UserAgents.length)];e.requestHeaders[o].value=s}TrackingBlocker&&"accept-language"===e.requestHeaders[o].name.toLowerCase()&&(e.requestHeaders[o].value="en-US,en;q=0.8")}}return{requestHeaders:e.requestHeaders}},{urls:["*://*/*"]},["blocking","requestHeaders"]),browser.webRequest.onHeadersReceived.addListener(function(e){if(TrackingBlocker){if(204==e.statusCode||205==e.statusCode)return;if(-1===e.tabId)return{responseHeaders:e.responseHeaders};var s=getRootDomain(__PRIMARY_DOMAIN_STORAGE[e.tabId]),t=getRootDomain(e.url);if(IsDomainWhitelisted(s,"tracking"))return{responseHeaders:e.responseHeaders};if("main_frame"===e.type)return{responseHeaders:e.responseHeaders};if(e.url.includes(hardCodedWhitelist[0]))return{responseHeaders:e.responseHeaders};if(s===t)return{responseHeaders:e.responseHeaders};if("script"===e.type||"other"===e.type||"xmlhttprequest"===e.type||"object"===e.type||"sub_frame"===e.type||"image"===e.type)for(var o=0;o<e.responseHeaders.length;o++)"set-cookie"===e.responseHeaders[o].name.toLowerCase()&&(AlreadyBlocked(e.tabId,t)||ProcessBlockedCookie(t,e.tabId),e.responseHeaders.splice(o,1),--o)}return{responseHeaders:e.responseHeaders}},{urls:["*://*/*"]},["blocking","responseHeaders"]),browser.webNavigation.onCompleted.addListener(function(e){TrackingBlocker&&0===e.frameId&&GetUrlFromTabId(e.tabId,function(s){InjectScript(e.tabId,s)})});var getRootDomain=function(e){if(void 0!==e){var s=eRoot(e);return new URL("http://"+s).hostname}};