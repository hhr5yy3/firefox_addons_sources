var pt=Object.defineProperty;var lt=(U,F,v)=>F in U?pt(U,F,{enumerable:!0,configurable:!0,writable:!0,value:v}):U[F]=v;var $=(U,F,v)=>lt(U,typeof F!="symbol"?F+"":F,v);(function(){"use strict";function U(){throw new Error("Cycle detected")}function F(){if(Q>1)Q--;else{for(var s,e=!1;ae!==void 0;){var n=ae;for(ae=void 0,Ce++;n!==void 0;){var t=n.o;if(n.o=void 0,n.f&=-3,!(8&n.f)&&Ke(n))try{n.c()}catch(i){e||(s=i,e=!0)}n=t}}if(Ce=0,Q--,e)throw s}}var v=void 0,ae=void 0,Q=0,Ce=0,fe=0;function Je(s){if(v!==void 0){var e=s.n;if(e===void 0||e.t!==v)return e={i:0,S:s,p:v.s,n:void 0,t:v,e:void 0,x:void 0,r:e},v.s!==void 0&&(v.s.n=e),v.s=e,s.n=e,32&v.f&&s.S(e),e;if(e.i===-1)return e.i=0,e.n!==void 0&&(e.n.p=e.p,e.p!==void 0&&(e.p.n=e.n),e.p=v.s,e.n=void 0,v.s.n=e,v.s=e),e}}function O(s){this.v=s,this.i=0,this.n=void 0,this.t=void 0}O.prototype.h=function(){return!0},O.prototype.S=function(s){this.t!==s&&s.e===void 0&&(s.x=this.t,this.t!==void 0&&(this.t.e=s),this.t=s)},O.prototype.U=function(s){if(this.t!==void 0){var e=s.e,n=s.x;e!==void 0&&(e.x=n,s.e=void 0),n!==void 0&&(n.e=e,s.x=void 0),s===this.t&&(this.t=n)}},O.prototype.subscribe=function(s){var e=this;return he(function(){var n=e.value,t=32&this.f;this.f&=-33;try{s(n)}finally{this.f|=t}})},O.prototype.valueOf=function(){return this.value},O.prototype.toString=function(){return this.value+""},O.prototype.toJSON=function(){return this.value},O.prototype.peek=function(){return this.v},Object.defineProperty(O.prototype,"value",{get:function(){var s=Je(this);return s!==void 0&&(s.i=this.i),this.v},set:function(s){if(v instanceof V&&function(){throw new Error("Computed cannot have side-effects")}(),s!==this.v){Ce>100&&U(),this.v=s,this.i++,fe++,Q++;try{for(var e=this.t;e!==void 0;e=e.x)e.t.N()}finally{F()}}}});function ie(s){return new O(s)}function Ke(s){for(var e=s.s;e!==void 0;e=e.n)if(e.S.i!==e.i||!e.S.h()||e.S.i!==e.i)return!0;return!1}function Ze(s){for(var e=s.s;e!==void 0;e=e.n){var n=e.S.n;if(n!==void 0&&(e.r=n),e.S.n=e,e.i=-1,e.n===void 0){s.s=e;break}}}function Ye(s){for(var e=s.s,n=void 0;e!==void 0;){var t=e.p;e.i===-1?(e.S.U(e),t!==void 0&&(t.n=e.n),e.n!==void 0&&(e.n.p=t)):n=e,e.S.n=e.r,e.r!==void 0&&(e.r=void 0),e=t}s.s=n}function V(s){O.call(this,void 0),this.x=s,this.s=void 0,this.g=fe-1,this.f=4}(V.prototype=new O).h=function(){if(this.f&=-3,1&this.f)return!1;if((36&this.f)==32||(this.f&=-5,this.g===fe))return!0;if(this.g=fe,this.f|=1,this.i>0&&!Ke(this))return this.f&=-2,!0;var s=v;try{Ze(this),v=this;var e=this.x();(16&this.f||this.v!==e||this.i===0)&&(this.v=e,this.f&=-17,this.i++)}catch(n){this.v=n,this.f|=16,this.i++}return v=s,Ye(this),this.f&=-2,!0},V.prototype.S=function(s){if(this.t===void 0){this.f|=36;for(var e=this.s;e!==void 0;e=e.n)e.S.S(e)}O.prototype.S.call(this,s)},V.prototype.U=function(s){if(this.t!==void 0&&(O.prototype.U.call(this,s),this.t===void 0)){this.f&=-33;for(var e=this.s;e!==void 0;e=e.n)e.S.U(e)}},V.prototype.N=function(){if(!(2&this.f)){this.f|=6;for(var s=this.t;s!==void 0;s=s.x)s.t.N()}},V.prototype.peek=function(){if(this.h()||U(),16&this.f)throw this.v;return this.v},Object.defineProperty(V.prototype,"value",{get:function(){1&this.f&&U();var s=Je(this);if(this.h(),s!==void 0&&(s.i=this.i),16&this.f)throw this.v;return this.v}});function Xe(s){var e=s.u;if(s.u=void 0,typeof e=="function"){Q++;var n=v;v=void 0;try{e()}catch(t){throw s.f&=-2,s.f|=8,ke(s),t}finally{v=n,F()}}}function ke(s){for(var e=s.s;e!==void 0;e=e.n)e.S.U(e);s.x=void 0,s.s=void 0,Xe(s)}function Fs(s){if(v!==this)throw new Error("Out-of-order effect");Ye(this),v=s,this.f&=-2,8&this.f&&ke(this),F()}function re(s){this.x=s,this.u=void 0,this.s=void 0,this.o=void 0,this.f=32}re.prototype.c=function(){var s=this.S();try{if(8&this.f||this.x===void 0)return;var e=this.x();typeof e=="function"&&(this.u=e)}finally{s()}},re.prototype.S=function(){1&this.f&&U(),this.f|=1,this.f&=-9,Xe(this),Ze(this),Q++;var s=v;return v=this,Fs.bind(this,s)},re.prototype.N=function(){2&this.f||(this.f|=2,this.o=ae,ae=this)},re.prototype.d=function(){this.f|=8,1&this.f||ke(this)};function he(s){var e=new re(s);try{e.c()}catch(n){throw e.d(),n}return e.d.bind(e)}class ge extends Error{}ge.prototype.name="InvalidTokenError";function Ls(s){return decodeURIComponent(atob(s).replace(/(.)/g,(e,n)=>{let t=n.charCodeAt(0).toString(16).toUpperCase();return t.length<2&&(t="0"+t),"%"+t}))}function Us(s){let e=s.replace(/-/g,"+").replace(/_/g,"/");switch(e.length%4){case 0:break;case 2:e+="==";break;case 3:e+="=";break;default:throw new Error("base64 string is not of the correct length")}try{return Ls(e)}catch{return atob(e)}}function js(s,e){if(typeof s!="string")throw new ge("Invalid token specified: must be a string");e||(e={});const n=e.header===!0?0:1,t=s.split(".")[n];if(typeof t!="string")throw new ge(`Invalid token specified: missing part #${n+1}`);let i;try{i=Us(t)}catch(a){throw new ge(`Invalid token specified: invalid base64 for part #${n+1} (${a.message})`)}try{return JSON.parse(i)}catch(a){throw new ge(`Invalid token specified: invalid json for part #${n+1} (${a.message})`)}}var Qe=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function oe(s){return s&&s.__esModule&&Object.prototype.hasOwnProperty.call(s,"default")?s.default:s}function $s(s){if(s.__esModule)return s;var e=s.default;if(typeof e=="function"){var n=function t(){return this instanceof t?Reflect.construct(e,arguments,this.constructor):e.apply(this,arguments)};n.prototype=e.prototype}else n={};return Object.defineProperty(n,"__esModule",{value:!0}),Object.keys(s).forEach(function(t){var i=Object.getOwnPropertyDescriptor(s,t);Object.defineProperty(n,t,i.get?i:{enumerable:!0,get:function(){return s[t]}})}),n}var Re={exports:{}};const Bs=s=>typeof crypto<"u"&&typeof crypto.getRandomValues=="function"?()=>{const e=crypto.getRandomValues(new Uint8Array(1))[0];return(e>=s?e%s:e).toString(s)}:()=>Math.floor(Math.random()*s).toString(s),es=(s=7,e=!1)=>Array.from({length:s},Bs(e?16:36)).join("");Re.exports=es,Re.exports.default=es;var qs=Re.exports;const Ae=oe(qs);var Gs=()=>`uid::${Ae(7)}`,zs=(s,e=["endpointName","fingerprint"])=>typeof s=="object"&&s!==null&&e.every(n=>n in s),Vs=s=>{try{const e=JSON.parse(s);return zs(e)?e:null}catch{return null}},Ws=()=>{let s=[];return{add:(...e)=>{s=[...s,...e]},remove:e=>{s=typeof e=="string"?s.filter(n=>n.message.transactionId!==e):s.filter(n=>!e.includes(n))},entries:()=>s}},pe=class{static toBackground(s,e){return s.postMessage(e)}static toExtensionContext(s,e){return s.postMessage(e)}},Hs=Object.defineProperty,Js=Object.defineProperties,Ks=Object.getOwnPropertyDescriptors,ss=Object.getOwnPropertySymbols,Zs=Object.prototype.hasOwnProperty,Ys=Object.prototype.propertyIsEnumerable,ns=(s,e,n)=>e in s?Hs(s,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):s[e]=n,G=(s,e)=>{for(var n in e||(e={}))Zs.call(e,n)&&ns(s,n,e[n]);if(ss)for(var n of ss(e))Ys.call(e,n)&&ns(s,n,e[n]);return s},Oe=(s,e)=>Js(s,Ks(e)),Xs=/^((?:background$)|devtools|popup|options|content-script|window)(?:@(\d+)(?:\.(\d+))?)?$/,Ne=s=>{const[,e,n,t]=s.match(Xs)||[];return{context:e,tabId:+n,frameId:t?+t:void 0}},ye=({context:s,tabId:e,frameId:n})=>["background","popup","options"].includes(s)?s:`${s}@${e}${n?`.${n}`:""}`;const Qs=[{property:"name",enumerable:!1},{property:"message",enumerable:!1},{property:"stack",enumerable:!1},{property:"code",enumerable:!0}],Me=Symbol(".toJSON was called"),en=s=>{s[Me]=!0;const e=s.toJSON();return delete s[Me],e},ts=({from:s,seen:e,to_:n,forceEnumerable:t,maxDepth:i,depth:a})=>{const r=n||(Array.isArray(s)?[]:{});if(e.push(s),a>=i)return r;if(typeof s.toJSON=="function"&&s[Me]!==!0)return en(s);for(const[g,o]of Object.entries(s)){if(typeof Buffer=="function"&&Buffer.isBuffer(o)){r[g]="[object Buffer]";continue}if(o!==null&&typeof o=="object"&&typeof o.pipe=="function"){r[g]="[object Stream]";continue}if(typeof o!="function"){if(!o||typeof o!="object"){r[g]=o;continue}if(!e.includes(s[g])){a++,r[g]=ts({from:s[g],seen:[...e],forceEnumerable:t,maxDepth:i,depth:a});continue}r[g]="[Circular]"}}for(const{property:g,enumerable:o}of Qs)typeof s[g]=="string"&&Object.defineProperty(r,g,{value:s[g],enumerable:t?!0:o,configurable:!0,writable:!0});return r};function sn(s,e={}){const{maxDepth:n=Number.POSITIVE_INFINITY}=e;return typeof s=="object"&&s!==null?ts({from:s,seen:[],forceEnumerable:!0,maxDepth:n,depth:0}):typeof s=="function"?`[Function: ${s.name||"anonymous"}]`:s}let as=()=>({events:{},emit(s,...e){(this.events[s]||[]).forEach(n=>n(...e))},on(s,e){return(this.events[s]=this.events[s]||[]).push(e),()=>this.events[s]=(this.events[s]||[]).filter(n=>n!==e)}});var nn=(s,e,n)=>{const t=Ae(),i=new Map,a=new Map,r=g=>{if(g.destination.context===s&&!g.destination.frameId&&!g.destination.tabId){n==null||n(g);const{transactionId:o,messageID:l,messageType:d}=g,x=()=>{const _=i.get(o);if(_){const{err:b,data:S}=g;if(b){const P=b,Y=self[P.name],X=new(typeof Y=="function"?Y:Error)(P.message);for(const z in P)X[z]=P[z];_.reject(X)}else _.resolve(S);i.delete(o)}},I=async()=>{let _,b,S=!1;try{const P=a.get(l);if(typeof P=="function")_=await P({sender:g.origin,id:l,data:g.data,timestamp:g.timestamp});else throw S=!0,new Error(`[webext-bridge] No handler registered in '${s}' to accept messages with id '${l}'`)}catch(P){b=P}finally{if(b&&(g.err=sn(b)),r(Oe(G({},g),{messageType:"reply",data:_,origin:{context:s,tabId:null},destination:g.origin,hops:[]})),b&&!S)throw _}};switch(d){case"reply":return x();case"message":return I()}}return g.hops.push(`${s}::${t}`),e(g)};return{handleMessage:r,endTransaction:g=>{const o=i.get(g);o==null||o.reject("Transaction was ended before it could complete"),i.delete(g)},sendMessage:(g,o,l="background")=>{const d=typeof l=="string"?Ne(l):l,x="Bridge#sendMessage ->";if(!d.context)throw new TypeError(`${x} Destination must be any one of known destinations`);return new Promise((I,_)=>{const b={messageID:g,data:o,destination:d,messageType:"message",transactionId:Ae(),origin:{context:s,tabId:null},hops:[],timestamp:Date.now()};i.set(b.transactionId,{resolve:I,reject:_});try{r(b)}catch(S){i.delete(b.transactionId),_(S)}})},onMessage:(g,o)=>(a.set(g,o),()=>a.delete(g))}},ee=class{constructor(s,e){this.endpointRuntime=s,this.streamInfo=e,this.emitter=as(),this.isClosed=!1,this.handleStreamClose=()=>{this.isClosed||(this.isClosed=!0,this.emitter.emit("closed",!0),this.emitter.events={})},ee.initDone||(s.onMessage("__crx_bridge_stream_transfer__",n=>{const{streamId:t,streamTransfer:i,action:a}=n.data,r=ee.openStreams.get(t);r&&!r.isClosed&&(a==="transfer"&&r.emitter.emit("message",i),a==="close"&&(ee.openStreams.delete(t),r.handleStreamClose()))}),ee.initDone=!0),ee.openStreams.set(this.streamInfo.streamId,this)}get info(){return this.streamInfo}send(s){if(this.isClosed)throw new Error("Attempting to send a message over closed stream. Use stream.onClose(<callback>) to keep an eye on stream status");this.endpointRuntime.sendMessage("__crx_bridge_stream_transfer__",{streamId:this.streamInfo.streamId,streamTransfer:s,action:"transfer"},this.streamInfo.endpoint)}close(s){s&&this.send(s),this.handleStreamClose(),this.endpointRuntime.sendMessage("__crx_bridge_stream_transfer__",{streamId:this.streamInfo.streamId,streamTransfer:null,action:"close"},this.streamInfo.endpoint)}onMessage(s){return this.getDisposable("message",s)}onClose(s){return this.getDisposable("closed",s)}getDisposable(s,e){const n=this.emitter.on(s,e);return Object.assign(n,{dispose:n,close:n})}},xe=ee;xe.initDone=!1,xe.openStreams=new Map;var tn=s=>{const e=new Map,n=new Map,t=as();s.onMessage("__crx_bridge_stream_open__",r=>new Promise(g=>{const{sender:o,data:l}=r,{channel:d}=l;let x=!1,I=()=>{};const _=()=>{const b=n.get(d);typeof b=="function"?(b(new xe(s,Oe(G({},l),{endpoint:o}))),x&&I(),g(!0)):x||(x=!0,I=t.on("did-change-stream-callbacks",_))};_()}));async function i(r,g){if(e.has(r))throw new Error("webext-bridge: A Stream is already open at this channel");const o=typeof g=="string"?Ne(g):g,l={streamId:Ae(),channel:r,endpoint:o},d=new xe(s,l);return d.onClose(()=>e.delete(r)),await s.sendMessage("__crx_bridge_stream_open__",l,o),e.set(r,d),d}function a(r,g){if(n.has(r))throw new Error("webext-bridge: This channel has already been claimed. Stream allows only one-on-one communication");n.set(r,g),t.emit("did-change-stream-callbacks")}return{openStream:i,onOpenStreamChannel:a}},is={exports:{}};(function(s,e){(function(n,t){t(s)})(typeof globalThis<"u"?globalThis:typeof self<"u"?self:Qe,function(n){if(typeof globalThis!="object"||typeof chrome!="object"||!chrome||!chrome.runtime||!chrome.runtime.id)throw new Error("This script should only be loaded in a browser extension.");if(typeof globalThis.browser>"u"||Object.getPrototypeOf(globalThis.browser)!==Object.prototype){const t="The message port closed before a response was received.",i="Returning a Promise is the preferred way to send a reply from an onMessage/onMessageExternal listener, as the sendResponse will be removed from the specs (See https://developer.mozilla.org/docs/Mozilla/Add-ons/WebExtensions/API/runtime/onMessage)",a=r=>{const g={alarms:{clear:{minArgs:0,maxArgs:1},clearAll:{minArgs:0,maxArgs:0},get:{minArgs:0,maxArgs:1},getAll:{minArgs:0,maxArgs:0}},bookmarks:{create:{minArgs:1,maxArgs:1},get:{minArgs:1,maxArgs:1},getChildren:{minArgs:1,maxArgs:1},getRecent:{minArgs:1,maxArgs:1},getSubTree:{minArgs:1,maxArgs:1},getTree:{minArgs:0,maxArgs:0},move:{minArgs:2,maxArgs:2},remove:{minArgs:1,maxArgs:1},removeTree:{minArgs:1,maxArgs:1},search:{minArgs:1,maxArgs:1},update:{minArgs:2,maxArgs:2}},browserAction:{disable:{minArgs:0,maxArgs:1,fallbackToNoCallback:!0},enable:{minArgs:0,maxArgs:1,fallbackToNoCallback:!0},getBadgeBackgroundColor:{minArgs:1,maxArgs:1},getBadgeText:{minArgs:1,maxArgs:1},getPopup:{minArgs:1,maxArgs:1},getTitle:{minArgs:1,maxArgs:1},openPopup:{minArgs:0,maxArgs:0},setBadgeBackgroundColor:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0},setBadgeText:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0},setIcon:{minArgs:1,maxArgs:1},setPopup:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0},setTitle:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0}},browsingData:{remove:{minArgs:2,maxArgs:2},removeCache:{minArgs:1,maxArgs:1},removeCookies:{minArgs:1,maxArgs:1},removeDownloads:{minArgs:1,maxArgs:1},removeFormData:{minArgs:1,maxArgs:1},removeHistory:{minArgs:1,maxArgs:1},removeLocalStorage:{minArgs:1,maxArgs:1},removePasswords:{minArgs:1,maxArgs:1},removePluginData:{minArgs:1,maxArgs:1},settings:{minArgs:0,maxArgs:0}},commands:{getAll:{minArgs:0,maxArgs:0}},contextMenus:{remove:{minArgs:1,maxArgs:1},removeAll:{minArgs:0,maxArgs:0},update:{minArgs:2,maxArgs:2}},cookies:{get:{minArgs:1,maxArgs:1},getAll:{minArgs:1,maxArgs:1},getAllCookieStores:{minArgs:0,maxArgs:0},remove:{minArgs:1,maxArgs:1},set:{minArgs:1,maxArgs:1}},devtools:{inspectedWindow:{eval:{minArgs:1,maxArgs:2,singleCallbackArg:!1}},panels:{create:{minArgs:3,maxArgs:3,singleCallbackArg:!0},elements:{createSidebarPane:{minArgs:1,maxArgs:1}}}},downloads:{cancel:{minArgs:1,maxArgs:1},download:{minArgs:1,maxArgs:1},erase:{minArgs:1,maxArgs:1},getFileIcon:{minArgs:1,maxArgs:2},open:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0},pause:{minArgs:1,maxArgs:1},removeFile:{minArgs:1,maxArgs:1},resume:{minArgs:1,maxArgs:1},search:{minArgs:1,maxArgs:1},show:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0}},extension:{isAllowedFileSchemeAccess:{minArgs:0,maxArgs:0},isAllowedIncognitoAccess:{minArgs:0,maxArgs:0}},history:{addUrl:{minArgs:1,maxArgs:1},deleteAll:{minArgs:0,maxArgs:0},deleteRange:{minArgs:1,maxArgs:1},deleteUrl:{minArgs:1,maxArgs:1},getVisits:{minArgs:1,maxArgs:1},search:{minArgs:1,maxArgs:1}},i18n:{detectLanguage:{minArgs:1,maxArgs:1},getAcceptLanguages:{minArgs:0,maxArgs:0}},identity:{launchWebAuthFlow:{minArgs:1,maxArgs:1}},idle:{queryState:{minArgs:1,maxArgs:1}},management:{get:{minArgs:1,maxArgs:1},getAll:{minArgs:0,maxArgs:0},getSelf:{minArgs:0,maxArgs:0},setEnabled:{minArgs:2,maxArgs:2},uninstallSelf:{minArgs:0,maxArgs:1}},notifications:{clear:{minArgs:1,maxArgs:1},create:{minArgs:1,maxArgs:2},getAll:{minArgs:0,maxArgs:0},getPermissionLevel:{minArgs:0,maxArgs:0},update:{minArgs:2,maxArgs:2}},pageAction:{getPopup:{minArgs:1,maxArgs:1},getTitle:{minArgs:1,maxArgs:1},hide:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0},setIcon:{minArgs:1,maxArgs:1},setPopup:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0},setTitle:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0},show:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0}},permissions:{contains:{minArgs:1,maxArgs:1},getAll:{minArgs:0,maxArgs:0},remove:{minArgs:1,maxArgs:1},request:{minArgs:1,maxArgs:1}},runtime:{getBackgroundPage:{minArgs:0,maxArgs:0},getPlatformInfo:{minArgs:0,maxArgs:0},openOptionsPage:{minArgs:0,maxArgs:0},requestUpdateCheck:{minArgs:0,maxArgs:0},sendMessage:{minArgs:1,maxArgs:3},sendNativeMessage:{minArgs:2,maxArgs:2},setUninstallURL:{minArgs:1,maxArgs:1}},sessions:{getDevices:{minArgs:0,maxArgs:1},getRecentlyClosed:{minArgs:0,maxArgs:1},restore:{minArgs:0,maxArgs:1}},storage:{local:{clear:{minArgs:0,maxArgs:0},get:{minArgs:0,maxArgs:1},getBytesInUse:{minArgs:0,maxArgs:1},remove:{minArgs:1,maxArgs:1},set:{minArgs:1,maxArgs:1}},managed:{get:{minArgs:0,maxArgs:1},getBytesInUse:{minArgs:0,maxArgs:1}},sync:{clear:{minArgs:0,maxArgs:0},get:{minArgs:0,maxArgs:1},getBytesInUse:{minArgs:0,maxArgs:1},remove:{minArgs:1,maxArgs:1},set:{minArgs:1,maxArgs:1}}},tabs:{captureVisibleTab:{minArgs:0,maxArgs:2},create:{minArgs:1,maxArgs:1},detectLanguage:{minArgs:0,maxArgs:1},discard:{minArgs:0,maxArgs:1},duplicate:{minArgs:1,maxArgs:1},executeScript:{minArgs:1,maxArgs:2},get:{minArgs:1,maxArgs:1},getCurrent:{minArgs:0,maxArgs:0},getZoom:{minArgs:0,maxArgs:1},getZoomSettings:{minArgs:0,maxArgs:1},goBack:{minArgs:0,maxArgs:1},goForward:{minArgs:0,maxArgs:1},highlight:{minArgs:1,maxArgs:1},insertCSS:{minArgs:1,maxArgs:2},move:{minArgs:2,maxArgs:2},query:{minArgs:1,maxArgs:1},reload:{minArgs:0,maxArgs:2},remove:{minArgs:1,maxArgs:1},removeCSS:{minArgs:1,maxArgs:2},sendMessage:{minArgs:2,maxArgs:3},setZoom:{minArgs:1,maxArgs:2},setZoomSettings:{minArgs:1,maxArgs:2},update:{minArgs:1,maxArgs:2}},topSites:{get:{minArgs:0,maxArgs:0}},webNavigation:{getAllFrames:{minArgs:1,maxArgs:1},getFrame:{minArgs:1,maxArgs:1}},webRequest:{handlerBehaviorChanged:{minArgs:0,maxArgs:0}},windows:{create:{minArgs:0,maxArgs:1},get:{minArgs:1,maxArgs:2},getAll:{minArgs:0,maxArgs:1},getCurrent:{minArgs:0,maxArgs:1},getLastFocused:{minArgs:0,maxArgs:1},remove:{minArgs:1,maxArgs:1},update:{minArgs:2,maxArgs:2}}};if(Object.keys(g).length===0)throw new Error("api-metadata.json has not been included in browser-polyfill");class o extends WeakMap{constructor(m,h=void 0){super(h),this.createItem=m}get(m){return this.has(m)||this.set(m,this.createItem(m)),super.get(m)}}const l=p=>p&&typeof p=="object"&&typeof p.then=="function",d=(p,m)=>(...h)=>{r.runtime.lastError?p.reject(new Error(r.runtime.lastError.message)):m.singleCallbackArg||h.length<=1&&m.singleCallbackArg!==!1?p.resolve(h[0]):p.resolve(h)},x=p=>p==1?"argument":"arguments",I=(p,m)=>function(y,...T){if(T.length<m.minArgs)throw new Error(`Expected at least ${m.minArgs} ${x(m.minArgs)} for ${p}(), got ${T.length}`);if(T.length>m.maxArgs)throw new Error(`Expected at most ${m.maxArgs} ${x(m.maxArgs)} for ${p}(), got ${T.length}`);return new Promise((A,w)=>{if(m.fallbackToNoCallback)try{y[p](...T,d({resolve:A,reject:w},m))}catch(c){console.warn(`${p} API method doesn't seem to support the callback parameter, falling back to call it without a callback: `,c),y[p](...T),m.fallbackToNoCallback=!1,m.noCallback=!0,A()}else m.noCallback?(y[p](...T),A()):y[p](...T,d({resolve:A,reject:w},m))})},_=(p,m,h)=>new Proxy(m,{apply(y,T,A){return h.call(T,p,...A)}});let b=Function.call.bind(Object.prototype.hasOwnProperty);const S=(p,m={},h={})=>{let y=Object.create(null),T={has(w,c){return c in p||c in y},get(w,c,k){if(c in y)return y[c];if(!(c in p))return;let E=p[c];if(typeof E=="function")if(typeof m[c]=="function")E=_(p,p[c],m[c]);else if(b(h,c)){let R=I(c,h[c]);E=_(p,p[c],R)}else E=E.bind(p);else if(typeof E=="object"&&E!==null&&(b(m,c)||b(h,c)))E=S(E,m[c],h[c]);else if(b(h,"*"))E=S(E,m[c],h["*"]);else return Object.defineProperty(y,c,{configurable:!0,enumerable:!0,get(){return p[c]},set(R){p[c]=R}}),E;return y[c]=E,E},set(w,c,k,E){return c in y?y[c]=k:p[c]=k,!0},defineProperty(w,c,k){return Reflect.defineProperty(y,c,k)},deleteProperty(w,c){return Reflect.deleteProperty(y,c)}},A=Object.create(p);return new Proxy(A,T)},P=p=>({addListener(m,h,...y){m.addListener(p.get(h),...y)},hasListener(m,h){return m.hasListener(p.get(h))},removeListener(m,h){m.removeListener(p.get(h))}}),Y=new o(p=>typeof p!="function"?p:function(h){const y=S(h,{},{getContent:{minArgs:0,maxArgs:0}});p(y)});let X=!1;const z=new o(p=>typeof p!="function"?p:function(h,y,T){let A=!1,w,c=new Promise(q=>{w=function(j){X||(console.warn(i,new Error().stack),X=!0),A=!0,q(j)}}),k;try{k=p(h,y,w)}catch(q){k=Promise.reject(q)}const E=k!==!0&&l(k);if(k!==!0&&!E&&!A)return!1;const R=q=>{q.then(j=>{T(j)},j=>{let He;j&&(j instanceof Error||typeof j.message=="string")?He=j.message:He="An unexpected error occurred",T({__mozWebExtensionPolyfillReject__:!0,message:He})}).catch(j=>{console.error("Failed to send onMessage rejected reply",j)})};return R(E?k:c),!0}),We=({reject:p,resolve:m},h)=>{r.runtime.lastError?r.runtime.lastError.message===t?m():p(new Error(r.runtime.lastError.message)):h&&h.__mozWebExtensionPolyfillReject__?p(new Error(h.message)):m(h)},te=(p,m,h,...y)=>{if(y.length<m.minArgs)throw new Error(`Expected at least ${m.minArgs} ${x(m.minArgs)} for ${p}(), got ${y.length}`);if(y.length>m.maxArgs)throw new Error(`Expected at most ${m.maxArgs} ${x(m.maxArgs)} for ${p}(), got ${y.length}`);return new Promise((T,A)=>{const w=We.bind(null,{resolve:T,reject:A});y.push(w),h.sendMessage(...y)})},u={devtools:{network:{onRequestFinished:P(Y)}},runtime:{onMessage:P(z),onMessageExternal:P(z),sendMessage:te.bind(null,"sendMessage",{minArgs:1,maxArgs:3})},tabs:{sendMessage:te.bind(null,"sendMessage",{minArgs:2,maxArgs:3})}},f={clear:{minArgs:1,maxArgs:1},get:{minArgs:1,maxArgs:1},set:{minArgs:1,maxArgs:1}};return g.privacy={network:{"*":f},services:{"*":f},websites:{"*":f}},S(r,u,g)};n.exports=a(chrome)}else n.exports=globalThis.browser})})(is);var an=is.exports;const rn=oe(an);var le=Ws(),N=new Map,se=new Map,Te=new Map,rs=(s,e)=>(se.set(s,(se.get(s)||new Set).add(e)),()=>{const n=se.get(s);n!=null&&n.delete(e)&&(n==null?void 0:n.size)===0&&se.delete(s)}),gs=(s,e)=>{Te.set(s,(Te.get(s)||new Set).add(e))},W=s=>({withFingerprint:e=>{const n=i=>({and:()=>i}),t={aboutIncomingMessage:i=>{const a=N.get(s);return pe.toExtensionContext(a.port,{status:"incoming",message:i}),n(t)},aboutSuccessfulDelivery:i=>{const a=N.get(s);return pe.toExtensionContext(a.port,{status:"delivered",receipt:i}),n(t)},aboutMessageUndeliverability:(i,a)=>{const r=N.get(s);return(r==null?void 0:r.fingerprint)===e&&pe.toExtensionContext(r.port,{status:"undeliverable",resolvedDestination:i,message:a}),n(t)},whenDeliverableTo:i=>{const a=()=>{const r=N.get(s);if((r==null?void 0:r.fingerprint)===e&&N.has(i))return pe.toExtensionContext(r.port,{status:"deliverable",deliverableTo:i}),!0};if(!a()){const r=rs(i,a);gs(e,r)}return n(t)},aboutSessionEnded:i=>{const a=N.get(s);return(a==null?void 0:a.fingerprint)===e&&pe.toExtensionContext(a.port,{status:"terminated",fingerprint:i}),n(t)}};return t}}),gn=Gs(),ve=nn("background",s=>{var e;if(s.origin.context==="background"&&["content-script","devtools "].includes(s.destination.context)&&!s.destination.tabId)throw new TypeError("When sending messages from background page, use @tabId syntax to target specific tab");const n=ye(G(G({},s.origin),s.origin.context==="window"&&{context:"content-script"})),t=ye(Oe(G(G({},s.destination),s.destination.context==="window"&&{context:"content-script"}),{tabId:s.destination.tabId||s.origin.tabId}));s.destination.tabId=null,s.destination.frameId=null;const i=()=>N.get(t),a=()=>N.get(n),r=()=>{var g;W(t).withFingerprint(i().fingerprint).aboutIncomingMessage(s);const o={message:s,to:i().fingerprint,from:{endpointId:n,fingerprint:(g=a())==null?void 0:g.fingerprint}};s.messageType==="message"&&le.add(o),s.messageType==="reply"&&le.remove(s.messageID),a()&&W(n).withFingerprint(a().fingerprint).aboutSuccessfulDelivery(o)};(e=i())!=null&&e.port?r():s.messageType==="message"&&(s.origin.context==="background"?rs(t,r):a()&&W(n).withFingerprint(a().fingerprint).aboutMessageUndeliverability(t,s).and().whenDeliverableTo(t))},s=>{const e=ye(G(G({},s.origin),s.origin.context==="window"&&{context:"content-script"})),n=N.get(e),t={message:s,to:gn,from:{endpointId:e,fingerprint:n.fingerprint}};W(e).withFingerprint(n.fingerprint).aboutSuccessfulDelivery(t)});rn.runtime.onConnect.addListener(s=>{var e;const n=Vs(s.name);if(!n)return;n.endpointName||(n.endpointName=ye({context:"content-script",tabId:s.sender.tab.id,frameId:s.sender.frameId}));const{tabId:t,frameId:i}=Ne(n.endpointName);N.set(n.endpointName,{fingerprint:n.fingerprint,port:s}),(e=se.get(n.endpointName))==null||e.forEach(a=>a()),se.delete(n.endpointName),gs(n.fingerprint,()=>{const a=le.entries().filter(r=>r.to===n.fingerprint);le.remove(a),a.forEach(r=>{r.from.endpointId==="background"?ve.endTransaction(r.message.transactionId):W(r.from.endpointId).withFingerprint(r.from.fingerprint).aboutSessionEnded(n.fingerprint)})}),s.onDisconnect.addListener(()=>{var a,r;((a=N.get(n.endpointName))==null?void 0:a.fingerprint)===n.fingerprint&&N.delete(n.endpointName),(r=Te.get(n.fingerprint))==null||r.forEach(g=>g()),Te.delete(n.fingerprint)}),s.onMessage.addListener(a=>{var r,g;if(a.type==="sync"){const o=[...N.values()].map(d=>d.fingerprint),l=a.pendingResponses.filter(d=>o.includes(d.to));le.add(...l),a.pendingResponses.filter(d=>!o.includes(d.to)).forEach(d=>W(n.endpointName).withFingerprint(n.fingerprint).aboutSessionEnded(d.to)),a.pendingDeliveries.forEach(d=>W(n.endpointName).withFingerprint(n.fingerprint).whenDeliverableTo(d));return}a.type==="deliver"&&((g=(r=a.message)==null?void 0:r.origin)!=null&&g.context)&&(a.message.origin.tabId=t,a.message.origin.frameId=i,ve.handleMessage(a.message))})});var{sendMessage:De,onMessage:B}=ve;tn(ve);var os={exports:{}};(function(s,e){(function(n,t){t(s)})(typeof globalThis<"u"?globalThis:typeof self<"u"?self:Qe,function(n){if(!(globalThis.chrome&&globalThis.chrome.runtime&&globalThis.chrome.runtime.id))throw new Error("This script should only be loaded in a browser extension.");if(globalThis.browser&&globalThis.browser.runtime&&globalThis.browser.runtime.id)n.exports=globalThis.browser;else{const t="The message port closed before a response was received.",i=a=>{const r={alarms:{clear:{minArgs:0,maxArgs:1},clearAll:{minArgs:0,maxArgs:0},get:{minArgs:0,maxArgs:1},getAll:{minArgs:0,maxArgs:0}},bookmarks:{create:{minArgs:1,maxArgs:1},get:{minArgs:1,maxArgs:1},getChildren:{minArgs:1,maxArgs:1},getRecent:{minArgs:1,maxArgs:1},getSubTree:{minArgs:1,maxArgs:1},getTree:{minArgs:0,maxArgs:0},move:{minArgs:2,maxArgs:2},remove:{minArgs:1,maxArgs:1},removeTree:{minArgs:1,maxArgs:1},search:{minArgs:1,maxArgs:1},update:{minArgs:2,maxArgs:2}},browserAction:{disable:{minArgs:0,maxArgs:1,fallbackToNoCallback:!0},enable:{minArgs:0,maxArgs:1,fallbackToNoCallback:!0},getBadgeBackgroundColor:{minArgs:1,maxArgs:1},getBadgeText:{minArgs:1,maxArgs:1},getPopup:{minArgs:1,maxArgs:1},getTitle:{minArgs:1,maxArgs:1},openPopup:{minArgs:0,maxArgs:0},setBadgeBackgroundColor:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0},setBadgeText:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0},setIcon:{minArgs:1,maxArgs:1},setPopup:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0},setTitle:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0}},browsingData:{remove:{minArgs:2,maxArgs:2},removeCache:{minArgs:1,maxArgs:1},removeCookies:{minArgs:1,maxArgs:1},removeDownloads:{minArgs:1,maxArgs:1},removeFormData:{minArgs:1,maxArgs:1},removeHistory:{minArgs:1,maxArgs:1},removeLocalStorage:{minArgs:1,maxArgs:1},removePasswords:{minArgs:1,maxArgs:1},removePluginData:{minArgs:1,maxArgs:1},settings:{minArgs:0,maxArgs:0}},commands:{getAll:{minArgs:0,maxArgs:0}},contextMenus:{remove:{minArgs:1,maxArgs:1},removeAll:{minArgs:0,maxArgs:0},update:{minArgs:2,maxArgs:2}},cookies:{get:{minArgs:1,maxArgs:1},getAll:{minArgs:1,maxArgs:1},getAllCookieStores:{minArgs:0,maxArgs:0},remove:{minArgs:1,maxArgs:1},set:{minArgs:1,maxArgs:1}},devtools:{inspectedWindow:{eval:{minArgs:1,maxArgs:2,singleCallbackArg:!1}},panels:{create:{minArgs:3,maxArgs:3,singleCallbackArg:!0},elements:{createSidebarPane:{minArgs:1,maxArgs:1}}}},downloads:{cancel:{minArgs:1,maxArgs:1},download:{minArgs:1,maxArgs:1},erase:{minArgs:1,maxArgs:1},getFileIcon:{minArgs:1,maxArgs:2},open:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0},pause:{minArgs:1,maxArgs:1},removeFile:{minArgs:1,maxArgs:1},resume:{minArgs:1,maxArgs:1},search:{minArgs:1,maxArgs:1},show:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0}},extension:{isAllowedFileSchemeAccess:{minArgs:0,maxArgs:0},isAllowedIncognitoAccess:{minArgs:0,maxArgs:0}},history:{addUrl:{minArgs:1,maxArgs:1},deleteAll:{minArgs:0,maxArgs:0},deleteRange:{minArgs:1,maxArgs:1},deleteUrl:{minArgs:1,maxArgs:1},getVisits:{minArgs:1,maxArgs:1},search:{minArgs:1,maxArgs:1}},i18n:{detectLanguage:{minArgs:1,maxArgs:1},getAcceptLanguages:{minArgs:0,maxArgs:0}},identity:{launchWebAuthFlow:{minArgs:1,maxArgs:1}},idle:{queryState:{minArgs:1,maxArgs:1}},management:{get:{minArgs:1,maxArgs:1},getAll:{minArgs:0,maxArgs:0},getSelf:{minArgs:0,maxArgs:0},setEnabled:{minArgs:2,maxArgs:2},uninstallSelf:{minArgs:0,maxArgs:1}},notifications:{clear:{minArgs:1,maxArgs:1},create:{minArgs:1,maxArgs:2},getAll:{minArgs:0,maxArgs:0},getPermissionLevel:{minArgs:0,maxArgs:0},update:{minArgs:2,maxArgs:2}},pageAction:{getPopup:{minArgs:1,maxArgs:1},getTitle:{minArgs:1,maxArgs:1},hide:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0},setIcon:{minArgs:1,maxArgs:1},setPopup:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0},setTitle:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0},show:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0}},permissions:{contains:{minArgs:1,maxArgs:1},getAll:{minArgs:0,maxArgs:0},remove:{minArgs:1,maxArgs:1},request:{minArgs:1,maxArgs:1}},runtime:{getBackgroundPage:{minArgs:0,maxArgs:0},getPlatformInfo:{minArgs:0,maxArgs:0},openOptionsPage:{minArgs:0,maxArgs:0},requestUpdateCheck:{minArgs:0,maxArgs:0},sendMessage:{minArgs:1,maxArgs:3},sendNativeMessage:{minArgs:2,maxArgs:2},setUninstallURL:{minArgs:1,maxArgs:1}},sessions:{getDevices:{minArgs:0,maxArgs:1},getRecentlyClosed:{minArgs:0,maxArgs:1},restore:{minArgs:0,maxArgs:1}},storage:{local:{clear:{minArgs:0,maxArgs:0},get:{minArgs:0,maxArgs:1},getBytesInUse:{minArgs:0,maxArgs:1},remove:{minArgs:1,maxArgs:1},set:{minArgs:1,maxArgs:1}},managed:{get:{minArgs:0,maxArgs:1},getBytesInUse:{minArgs:0,maxArgs:1}},sync:{clear:{minArgs:0,maxArgs:0},get:{minArgs:0,maxArgs:1},getBytesInUse:{minArgs:0,maxArgs:1},remove:{minArgs:1,maxArgs:1},set:{minArgs:1,maxArgs:1}}},tabs:{captureVisibleTab:{minArgs:0,maxArgs:2},create:{minArgs:1,maxArgs:1},detectLanguage:{minArgs:0,maxArgs:1},discard:{minArgs:0,maxArgs:1},duplicate:{minArgs:1,maxArgs:1},executeScript:{minArgs:1,maxArgs:2},get:{minArgs:1,maxArgs:1},getCurrent:{minArgs:0,maxArgs:0},getZoom:{minArgs:0,maxArgs:1},getZoomSettings:{minArgs:0,maxArgs:1},goBack:{minArgs:0,maxArgs:1},goForward:{minArgs:0,maxArgs:1},highlight:{minArgs:1,maxArgs:1},insertCSS:{minArgs:1,maxArgs:2},move:{minArgs:2,maxArgs:2},query:{minArgs:1,maxArgs:1},reload:{minArgs:0,maxArgs:2},remove:{minArgs:1,maxArgs:1},removeCSS:{minArgs:1,maxArgs:2},sendMessage:{minArgs:2,maxArgs:3},setZoom:{minArgs:1,maxArgs:2},setZoomSettings:{minArgs:1,maxArgs:2},update:{minArgs:1,maxArgs:2}},topSites:{get:{minArgs:0,maxArgs:0}},webNavigation:{getAllFrames:{minArgs:1,maxArgs:1},getFrame:{minArgs:1,maxArgs:1}},webRequest:{handlerBehaviorChanged:{minArgs:0,maxArgs:0}},windows:{create:{minArgs:0,maxArgs:1},get:{minArgs:1,maxArgs:2},getAll:{minArgs:0,maxArgs:1},getCurrent:{minArgs:0,maxArgs:1},getLastFocused:{minArgs:0,maxArgs:1},remove:{minArgs:1,maxArgs:1},update:{minArgs:2,maxArgs:2}}};if(Object.keys(r).length===0)throw new Error("api-metadata.json has not been included in browser-polyfill");class g extends WeakMap{constructor(f,p=void 0){super(p),this.createItem=f}get(f){return this.has(f)||this.set(f,this.createItem(f)),super.get(f)}}const o=u=>u&&typeof u=="object"&&typeof u.then=="function",l=(u,f)=>(...p)=>{a.runtime.lastError?u.reject(new Error(a.runtime.lastError.message)):f.singleCallbackArg||p.length<=1&&f.singleCallbackArg!==!1?u.resolve(p[0]):u.resolve(p)},d=u=>u==1?"argument":"arguments",x=(u,f)=>function(m,...h){if(h.length<f.minArgs)throw new Error(`Expected at least ${f.minArgs} ${d(f.minArgs)} for ${u}(), got ${h.length}`);if(h.length>f.maxArgs)throw new Error(`Expected at most ${f.maxArgs} ${d(f.maxArgs)} for ${u}(), got ${h.length}`);return new Promise((y,T)=>{if(f.fallbackToNoCallback)try{m[u](...h,l({resolve:y,reject:T},f))}catch(A){console.warn(`${u} API method doesn't seem to support the callback parameter, falling back to call it without a callback: `,A),m[u](...h),f.fallbackToNoCallback=!1,f.noCallback=!0,y()}else f.noCallback?(m[u](...h),y()):m[u](...h,l({resolve:y,reject:T},f))})},I=(u,f,p)=>new Proxy(f,{apply(m,h,y){return p.call(h,u,...y)}});let _=Function.call.bind(Object.prototype.hasOwnProperty);const b=(u,f={},p={})=>{let m=Object.create(null),h={has(T,A){return A in u||A in m},get(T,A,w){if(A in m)return m[A];if(!(A in u))return;let c=u[A];if(typeof c=="function")if(typeof f[A]=="function")c=I(u,u[A],f[A]);else if(_(p,A)){let k=x(A,p[A]);c=I(u,u[A],k)}else c=c.bind(u);else if(typeof c=="object"&&c!==null&&(_(f,A)||_(p,A)))c=b(c,f[A],p[A]);else if(_(p,"*"))c=b(c,f[A],p["*"]);else return Object.defineProperty(m,A,{configurable:!0,enumerable:!0,get(){return u[A]},set(k){u[A]=k}}),c;return m[A]=c,c},set(T,A,w,c){return A in m?m[A]=w:u[A]=w,!0},defineProperty(T,A,w){return Reflect.defineProperty(m,A,w)},deleteProperty(T,A){return Reflect.deleteProperty(m,A)}},y=Object.create(u);return new Proxy(y,h)},S=u=>({addListener(f,p,...m){f.addListener(u.get(p),...m)},hasListener(f,p){return f.hasListener(u.get(p))},removeListener(f,p){f.removeListener(u.get(p))}}),P=new g(u=>typeof u!="function"?u:function(p){const m=b(p,{},{getContent:{minArgs:0,maxArgs:0}});u(m)}),Y=new g(u=>typeof u!="function"?u:function(p,m,h){let y=!1,T,A=new Promise(E=>{T=function(R){y=!0,E(R)}}),w;try{w=u(p,m,T)}catch(E){w=Promise.reject(E)}const c=w!==!0&&o(w);if(w!==!0&&!c&&!y)return!1;const k=E=>{E.then(R=>{h(R)},R=>{let q;R&&(R instanceof Error||typeof R.message=="string")?q=R.message:q="An unexpected error occurred",h({__mozWebExtensionPolyfillReject__:!0,message:q})}).catch(R=>{console.error("Failed to send onMessage rejected reply",R)})};return k(c?w:A),!0}),X=({reject:u,resolve:f},p)=>{a.runtime.lastError?a.runtime.lastError.message===t?f():u(new Error(a.runtime.lastError.message)):p&&p.__mozWebExtensionPolyfillReject__?u(new Error(p.message)):f(p)},z=(u,f,p,...m)=>{if(m.length<f.minArgs)throw new Error(`Expected at least ${f.minArgs} ${d(f.minArgs)} for ${u}(), got ${m.length}`);if(m.length>f.maxArgs)throw new Error(`Expected at most ${f.maxArgs} ${d(f.maxArgs)} for ${u}(), got ${m.length}`);return new Promise((h,y)=>{const T=X.bind(null,{resolve:h,reject:y});m.push(T),p.sendMessage(...m)})},We={devtools:{network:{onRequestFinished:S(P)}},runtime:{onMessage:S(Y),onMessageExternal:S(Y),sendMessage:z.bind(null,"sendMessage",{minArgs:1,maxArgs:3})},tabs:{sendMessage:z.bind(null,"sendMessage",{minArgs:2,maxArgs:3})}},te={clear:{minArgs:1,maxArgs:1},get:{minArgs:1,maxArgs:1},set:{minArgs:1,maxArgs:1}};return r.privacy={network:{"*":te},services:{"*":te},websites:{"*":te}},b(a,We,r)};n.exports=i(chrome)}})})(os);var on=os.exports;const C=oe(on);var Fe={exports:{}};const ps=s=>typeof s=="object"&&s!==null,ls=Symbol("skip"),ms=s=>ps(s)&&!(s instanceof RegExp)&&!(s instanceof Error)&&!(s instanceof Date),Le=(s,e,n,t=new WeakMap)=>{if(n={deep:!1,target:{},...n},t.has(s))return t.get(s);t.set(s,n.target);const{target:i}=n;delete n.target;const a=r=>r.map(g=>ms(g)?Le(g,e,n,t):g);if(Array.isArray(s))return a(s);for(const[r,g]of Object.entries(s)){const o=e(r,g,s);if(o===ls)continue;let[l,d,{shouldRecurse:x=!0}={}]=o;l!=="__proto__"&&(n.deep&&x&&ms(d)&&(d=Array.isArray(d)?a(d):Le(d,e,n,t)),i[l]=d)}return i};Fe.exports=(s,e,n)=>{if(!ps(s))throw new TypeError(`Expected an object, got \`${s}\` (${typeof s})`);return Le(s,e,n)},Fe.exports.mapObjectSkip=ls;var ds=Fe.exports;const cs=oe(ds),pn=/[\p{Lu}]/u,ln=/[\p{Ll}]/u,us=/^[\p{Lu}](?![\p{Lu}])/gu,fs=/([\p{Alpha}\p{N}_]|$)/u,Ue=/[_.\- ]+/,mn=new RegExp("^"+Ue.source),hs=new RegExp(Ue.source+fs.source,"gu"),As=new RegExp("\\d+"+fs.source,"gu"),dn=(s,e,n,t)=>{let i=!1,a=!1,r=!1,g=!1;for(let o=0;o<s.length;o++){const l=s[o];g=o>2?s[o-3]==="-":!0,i&&pn.test(l)?(s=s.slice(0,o)+"-"+s.slice(o),i=!1,r=a,a=!0,o++):a&&r&&ln.test(l)&&(!g||t)?(s=s.slice(0,o-1)+"-"+s.slice(o-1),r=a,a=!1,i=!0):(i=e(l)===l&&n(l)!==l,r=a,a=n(l)===l&&e(l)!==l)}return s},cn=(s,e)=>(us.lastIndex=0,s.replace(us,n=>e(n))),un=(s,e)=>(hs.lastIndex=0,As.lastIndex=0,s.replace(hs,(n,t)=>e(t)).replace(As,n=>e(n)));function fn(s,e){if(!(typeof s=="string"||Array.isArray(s)))throw new TypeError("Expected the input to be `string | string[]`");if(e={pascalCase:!1,preserveConsecutiveUppercase:!1,...e},Array.isArray(s)?s=s.map(a=>a.trim()).filter(a=>a.length).join("-"):s=s.trim(),s.length===0)return"";const n=e.locale===!1?a=>a.toLowerCase():a=>a.toLocaleLowerCase(e.locale),t=e.locale===!1?a=>a.toUpperCase():a=>a.toLocaleUpperCase(e.locale);return s.length===1?Ue.test(s)?"":e.pascalCase?t(s):n(s):(s!==n(s)&&(s=dn(s,n,t,e.preserveConsecutiveUppercase)),s=s.replace(mn,""),s=e.preserveConsecutiveUppercase?cn(s,n):n(s),e.pascalCase&&(s=t(s.charAt(0))+s.slice(1)),un(s,t))}class hn extends Map{constructor(e={}){if(super(),!(e.maxSize&&e.maxSize>0))throw new TypeError("`maxSize` must be a number greater than 0");if(typeof e.maxAge=="number"&&e.maxAge===0)throw new TypeError("`maxAge` must be a number greater than 0");this.maxSize=e.maxSize,this.maxAge=e.maxAge||Number.POSITIVE_INFINITY,this.onEviction=e.onEviction,this.cache=new Map,this.oldCache=new Map,this._size=0}_emitEvictions(e){if(typeof this.onEviction=="function")for(const[n,t]of e)this.onEviction(n,t.value)}_deleteIfExpired(e,n){return typeof n.expiry=="number"&&n.expiry<=Date.now()?(typeof this.onEviction=="function"&&this.onEviction(e,n.value),this.delete(e)):!1}_getOrDeleteIfExpired(e,n){if(this._deleteIfExpired(e,n)===!1)return n.value}_getItemValue(e,n){return n.expiry?this._getOrDeleteIfExpired(e,n):n.value}_peek(e,n){const t=n.get(e);return this._getItemValue(e,t)}_set(e,n){this.cache.set(e,n),this._size++,this._size>=this.maxSize&&(this._size=0,this._emitEvictions(this.oldCache),this.oldCache=this.cache,this.cache=new Map)}_moveToRecent(e,n){this.oldCache.delete(e),this._set(e,n)}*_entriesAscending(){for(const e of this.oldCache){const[n,t]=e;this.cache.has(n)||this._deleteIfExpired(n,t)===!1&&(yield e)}for(const e of this.cache){const[n,t]=e;this._deleteIfExpired(n,t)===!1&&(yield e)}}get(e){if(this.cache.has(e)){const n=this.cache.get(e);return this._getItemValue(e,n)}if(this.oldCache.has(e)){const n=this.oldCache.get(e);if(this._deleteIfExpired(e,n)===!1)return this._moveToRecent(e,n),n.value}}set(e,n,{maxAge:t=this.maxAge}={}){const i=typeof t=="number"&&t!==Number.POSITIVE_INFINITY?Date.now()+t:void 0;this.cache.has(e)?this.cache.set(e,{value:n,expiry:i}):this._set(e,{value:n,expiry:i})}has(e){return this.cache.has(e)?!this._deleteIfExpired(e,this.cache.get(e)):this.oldCache.has(e)?!this._deleteIfExpired(e,this.oldCache.get(e)):!1}peek(e){if(this.cache.has(e))return this._peek(e,this.cache);if(this.oldCache.has(e))return this._peek(e,this.oldCache)}delete(e){const n=this.cache.delete(e);return n&&this._size--,this.oldCache.delete(e)||n}clear(){this.cache.clear(),this.oldCache.clear(),this._size=0}resize(e){if(!(e&&e>0))throw new TypeError("`maxSize` must be a number greater than 0");const n=[...this._entriesAscending()],t=n.length-e;t<0?(this.cache=new Map(n),this.oldCache=new Map,this._size=n.length):(t>0&&this._emitEvictions(n.slice(0,t)),this.oldCache=new Map(n.slice(t)),this.cache=new Map,this._size=0),this.maxSize=e}*keys(){for(const[e]of this)yield e}*values(){for(const[,e]of this)yield e}*[Symbol.iterator](){for(const e of this.cache){const[n,t]=e;this._deleteIfExpired(n,t)===!1&&(yield[n,t.value])}for(const e of this.oldCache){const[n,t]=e;this.cache.has(n)||this._deleteIfExpired(n,t)===!1&&(yield[n,t.value])}}*entriesDescending(){let e=[...this.cache];for(let n=e.length-1;n>=0;--n){const t=e[n],[i,a]=t;this._deleteIfExpired(i,a)===!1&&(yield[i,a.value])}e=[...this.oldCache];for(let n=e.length-1;n>=0;--n){const t=e[n],[i,a]=t;this.cache.has(i)||this._deleteIfExpired(i,a)===!1&&(yield[i,a.value])}}*entriesAscending(){for(const[e,n]of this._entriesAscending())yield[e,n.value]}get size(){if(!this._size)return this.oldCache.size;let e=0;for(const n of this.oldCache.keys())this.cache.has(n)||e++;return Math.min(this._size+e,this.maxSize)}entries(){return this.entriesAscending()}forEach(e,n=this){for(const[t,i]of this.entriesAscending())e.call(n,i,t,this)}get[Symbol.toStringTag](){return JSON.stringify([...this.entriesAscending()])}}const An=(s,e)=>s.some(n=>typeof n=="string"?n===e:(n.lastIndex=0,n.test(e))),je=new hn({maxSize:1e5}),ys=s=>typeof s=="object"&&s!==null&&!(s instanceof RegExp)&&!(s instanceof Error)&&!(s instanceof Date),xs=(s,e)=>{if(!ys(s))return s;e={deep:!1,pascalCase:!1,...e};const{exclude:n,pascalCase:t,stopPaths:i,deep:a}=e,r=new Set(i),g=o=>(l,d)=>{if(a&&ys(d)){const x=o===void 0?l:`${o}.${l}`;r.has(x)||(d=cs(d,g(x)))}if(!(n&&An(n,l))){const x=t?`${l}_`:l;if(je.has(x))l=je.get(x);else{const I=fn(l,{pascalCase:t,locale:!1});l.length<100&&je.set(x,I),l=I}}return[l,d]};return cs(s,g(void 0))};function H(s,e){return Array.isArray(s)?Object.keys(s).map(n=>xs(s[n],e)):xs(s,e)}class be extends Error{constructor(n,t,i){const a=n.status||n.status===0?n.status:"",r=n.statusText||"",g=`${a} ${r}`.trim(),o=g?`status code ${g}`:"an unknown error";super(`Request failed with ${o}: ${t.method} ${t.url}`);$(this,"response");$(this,"request");$(this,"options");this.name="HTTPError",this.response=n,this.request=t,this.options=i}}class Ts extends Error{constructor(n){super(`Request timed out: ${n.method} ${n.url}`);$(this,"request");this.name="TimeoutError",this.request=n}}const me=s=>s!==null&&typeof s=="object",we=(...s)=>{for(const e of s)if((!me(e)||Array.isArray(e))&&e!==void 0)throw new TypeError("The `options` argument must be an object");return $e({},...s)},vs=(s={},e={})=>{const n=new globalThis.Headers(s),t=e instanceof globalThis.Headers,i=new globalThis.Headers(e);for(const[a,r]of i.entries())t&&r==="undefined"||r===void 0?n.delete(a):n.set(a,r);return n};function _e(s,e,n){return Object.hasOwn(e,n)&&e[n]===void 0?[]:$e(s[n]??[],e[n]??[])}const bs=(s={},e={})=>({beforeRequest:_e(s,e,"beforeRequest"),beforeRetry:_e(s,e,"beforeRetry"),afterResponse:_e(s,e,"afterResponse"),beforeError:_e(s,e,"beforeError")}),$e=(...s)=>{let e={},n={},t={};for(const i of s)if(Array.isArray(i))Array.isArray(e)||(e=[]),e=[...e,...i];else if(me(i)){for(let[a,r]of Object.entries(i))me(r)&&a in e&&(r=$e(e[a],r)),e={...e,[a]:r};me(i.hooks)&&(t=bs(t,i.hooks),e.hooks=t),me(i.headers)&&(n=vs(n,i.headers),e.headers=n)}return e},yn=(()=>{let s=!1,e=!1;const n=typeof globalThis.ReadableStream=="function",t=typeof globalThis.Request=="function";if(n&&t)try{e=new globalThis.Request("https://empty.invalid",{body:new globalThis.ReadableStream,method:"POST",get duplex(){return s=!0,"half"}}).headers.has("Content-Type")}catch(i){if(i instanceof Error&&i.message==="unsupported BodyInit type")return!1;throw i}return s&&!e})(),xn=typeof globalThis.AbortController=="function",Tn=typeof globalThis.ReadableStream=="function",vn=typeof globalThis.FormData=="function",ws=["get","post","put","patch","head","delete"],bn={json:"application/json",text:"text/*",formData:"multipart/form-data",arrayBuffer:"*/*",blob:"*/*"},Be=2147483647,_s=Symbol("stop"),wn={json:!0,parseJson:!0,stringifyJson:!0,searchParams:!0,prefixUrl:!0,retry:!0,timeout:!0,hooks:!0,throwHttpErrors:!0,onDownloadProgress:!0,fetch:!0},_n={method:!0,headers:!0,body:!0,mode:!0,credentials:!0,cache:!0,redirect:!0,referrer:!0,referrerPolicy:!0,integrity:!0,keepalive:!0,signal:!0,window:!0,dispatcher:!0,duplex:!0,priority:!0},Sn=s=>ws.includes(s)?s.toUpperCase():s,Ss={limit:2,methods:["get","put","head","delete","options","trace"],statusCodes:[408,413,429,500,502,503,504],afterStatusCodes:[413,429,503],maxRetryAfter:Number.POSITIVE_INFINITY,backoffLimit:Number.POSITIVE_INFINITY,delay:s=>.3*2**(s-1)*1e3},En=(s={})=>{if(typeof s=="number")return{...Ss,limit:s};if(s.methods&&!Array.isArray(s.methods))throw new Error("retry.methods must be an array");if(s.statusCodes&&!Array.isArray(s.statusCodes))throw new Error("retry.statusCodes must be an array");return{...Ss,...s}};async function In(s,e,n,t){return new Promise((i,a)=>{const r=setTimeout(()=>{n&&n.abort(),a(new Ts(s))},t.timeout);t.fetch(s,e).then(i).catch(a).then(()=>{clearTimeout(r)})})}async function Pn(s,{signal:e}){return new Promise((n,t)=>{e&&(e.throwIfAborted(),e.addEventListener("abort",i,{once:!0}));function i(){clearTimeout(a),t(e.reason)}const a=setTimeout(()=>{e==null||e.removeEventListener("abort",i),n()},s)})}const Cn=(s,e)=>{const n={};for(const t in e)!(t in _n)&&!(t in wn)&&!(t in s)&&(n[t]=e[t]);return n};class Se{constructor(e,n={}){$(this,"request");$(this,"abortController");$(this,"_retryCount",0);$(this,"_input");$(this,"_options");var t,i;if(this._input=e,this._options={...n,headers:vs(this._input.headers,n.headers),hooks:bs({beforeRequest:[],beforeRetry:[],beforeError:[],afterResponse:[]},n.hooks),method:Sn(n.method??this._input.method),prefixUrl:String(n.prefixUrl||""),retry:En(n.retry),throwHttpErrors:n.throwHttpErrors!==!1,timeout:n.timeout??1e4,fetch:n.fetch??globalThis.fetch.bind(globalThis)},typeof this._input!="string"&&!(this._input instanceof URL||this._input instanceof globalThis.Request))throw new TypeError("`input` must be a string, URL, or Request");if(this._options.prefixUrl&&typeof this._input=="string"){if(this._input.startsWith("/"))throw new Error("`input` must not begin with a slash when using `prefixUrl`");this._options.prefixUrl.endsWith("/")||(this._options.prefixUrl+="/"),this._input=this._options.prefixUrl+this._input}if(xn){this.abortController=new globalThis.AbortController;const a=this._options.signal??this._input.signal;a==null||a.addEventListener("abort",()=>{this.abortController.abort(a.reason)}),this._options.signal=this.abortController.signal}if(yn&&(this._options.duplex="half"),this._options.json!==void 0&&(this._options.body=((i=(t=this._options).stringifyJson)==null?void 0:i.call(t,this._options.json))??JSON.stringify(this._options.json),this._options.headers.set("content-type",this._options.headers.get("content-type")??"application/json")),this.request=new globalThis.Request(this._input,this._options),this._options.searchParams){const r="?"+(typeof this._options.searchParams=="string"?this._options.searchParams.replace(/^\?/,""):new URLSearchParams(this._options.searchParams).toString()),g=this.request.url.replace(/(?:\?.*?)?(?=#|$)/,r);(vn&&this._options.body instanceof globalThis.FormData||this._options.body instanceof URLSearchParams)&&!(this._options.headers&&this._options.headers["content-type"])&&this.request.headers.delete("content-type"),this.request=new globalThis.Request(new globalThis.Request(g,{...this.request}),this._options)}}static create(e,n){const t=new Se(e,n),i=async()=>{if(typeof t._options.timeout=="number"&&t._options.timeout>Be)throw new RangeError(`The \`timeout\` option cannot be greater than ${Be}`);await Promise.resolve();let g=await t._fetch();for(const o of t._options.hooks.afterResponse){const l=await o(t.request,t._options,t._decorateResponse(g.clone()));l instanceof globalThis.Response&&(g=l)}if(t._decorateResponse(g),!g.ok&&t._options.throwHttpErrors){let o=new be(g,t.request,t._options);for(const l of t._options.hooks.beforeError)o=await l(o);throw o}if(t._options.onDownloadProgress){if(typeof t._options.onDownloadProgress!="function")throw new TypeError("The `onDownloadProgress` option must be a function");if(!Tn)throw new Error("Streams are not supported in your environment. `ReadableStream` is missing.");return t._stream(g.clone(),t._options.onDownloadProgress)}return g},r=t._options.retry.methods.includes(t.request.method.toLowerCase())?t._retry(i):i();for(const[g,o]of Object.entries(bn))r[g]=async()=>{t.request.headers.set("accept",t.request.headers.get("accept")||o);const d=(await r).clone();if(g==="json"){if(d.status===204||(await d.clone().arrayBuffer()).byteLength===0)return"";if(n.parseJson)return n.parseJson(await d.text())}return d[g]()};return r}_calculateRetryDelay(e){if(this._retryCount++,this._retryCount>this._options.retry.limit||e instanceof Ts)throw e;if(e instanceof be){if(!this._options.retry.statusCodes.includes(e.response.status))throw e;const t=e.response.headers.get("Retry-After")??e.response.headers.get("RateLimit-Reset")??e.response.headers.get("X-RateLimit-Reset")??e.response.headers.get("X-Rate-Limit-Reset");if(t&&this._options.retry.afterStatusCodes.includes(e.response.status)){let i=Number(t)*1e3;Number.isNaN(i)?i=Date.parse(t)-Date.now():i>=Date.parse("2024-01-01")&&(i-=Date.now());const a=this._options.retry.maxRetryAfter??i;return i<a?i:a}if(e.response.status===413)throw e}const n=this._options.retry.delay(this._retryCount);return Math.min(this._options.retry.backoffLimit,n)}_decorateResponse(e){return this._options.parseJson&&(e.json=async()=>this._options.parseJson(await e.text())),e}async _retry(e){try{return await e()}catch(n){const t=Math.min(this._calculateRetryDelay(n),Be);if(this._retryCount<1)throw n;await Pn(t,{signal:this._options.signal});for(const i of this._options.hooks.beforeRetry)if(await i({request:this.request,options:this._options,error:n,retryCount:this._retryCount})===_s)return;return this._retry(e)}}async _fetch(){for(const t of this._options.hooks.beforeRequest){const i=await t(this.request,this._options);if(i instanceof Request){this.request=i;break}if(i instanceof Response)return i}const e=Cn(this.request,this._options),n=this.request;return this.request=n.clone(),this._options.timeout===!1?this._options.fetch(n,e):In(n,e,this.abortController,this._options)}_stream(e,n){const t=Number(e.headers.get("content-length"))||0;let i=0;return e.status===204?(n&&n({percent:1,totalBytes:t,transferredBytes:i},new Uint8Array),new globalThis.Response(null,{status:e.status,statusText:e.statusText,headers:e.headers})):new globalThis.Response(new globalThis.ReadableStream({async start(a){const r=e.body.getReader();n&&n({percent:0,transferredBytes:0,totalBytes:t},new Uint8Array);async function g(){const{done:o,value:l}=await r.read();if(o){a.close();return}if(n){i+=l.byteLength;const d=t===0?0:i/t;n({percent:d,transferredBytes:i,totalBytes:t},l)}a.enqueue(l),await g()}await g()}}),{status:e.status,statusText:e.statusText,headers:e.headers})}}/*! MIT License © Sindre Sorhus */const qe=s=>{const e=(n,t)=>Se.create(n,we(s,t));for(const n of ws)e[n]=(t,i)=>Se.create(t,we(s,i,{method:n}));return e.create=n=>qe(we(n)),e.extend=n=>(typeof n=="function"&&(n=n(s??{})),qe(we(s,n))),e.stop=_s,e},Es=qe();var Ee=function(){return Ee=Object.assign||function(e){for(var n,t=1,i=arguments.length;t<i;t++){n=arguments[t];for(var a in n)Object.prototype.hasOwnProperty.call(n,a)&&(e[a]=n[a])}return e},Ee.apply(this,arguments)};typeof SuppressedError=="function"&&SuppressedError;function kn(s){return s.toLowerCase()}var Rn=[/([a-z0-9])([A-Z])/g,/([A-Z])([A-Z][a-z])/g],On=/[^A-Z0-9]+/gi;function Nn(s,e){e===void 0&&(e={});for(var n=e.splitRegexp,t=n===void 0?Rn:n,i=e.stripRegexp,a=i===void 0?On:i,r=e.transform,g=r===void 0?kn:r,o=e.delimiter,l=o===void 0?" ":o,d=Is(Is(s,t,"$1\0$2"),a,"\0"),x=0,I=d.length;d.charAt(x)==="\0";)x++;for(;d.charAt(I-1)==="\0";)I--;return d.slice(x,I).split("\0").map(g).join(l)}function Is(s,e,n){return e instanceof RegExp?s.replace(e,n):e.reduce(function(t,i){return t.replace(i,n)},s)}function Mn(s,e){return e===void 0&&(e={}),Nn(s,Ee({delimiter:"."},e))}function Dn(s,e){return e===void 0&&(e={}),Mn(s,Ee({delimiter:"_"},e))}const Fn=$s(Object.freeze(Object.defineProperty({__proto__:null,snakeCase:Dn},Symbol.toStringTag,{value:"Module"}))),Ln=ds,{snakeCase:Un}=Fn;var jn=function(s,e){return e=Object.assign({deep:!0,exclude:[],parsingOptions:{}},e),Ln(s,function(n,t){return[$n(e.exclude,n)?n:Un(n,e.parsingOptions),t]},e)};function $n(s,e){return s.some(function(n){return typeof n=="string"?n===e:n.test(e)})}const Bn=oe(jn),Ge=s=>Math.min(4,Math.max(1,Math.floor(s/1800))),L=s=>C.i18n.getMessage(s),de=[0,6],Ps=[{tagId:0,title:L("plant_tag_0"),deleted:!1},{tagId:1,title:L("plant_tag_1"),deleted:!1},{tagId:2,title:L("plant_tag_2"),deleted:!1},{tagId:3,title:L("plant_tag_3"),deleted:!1},{tagId:4,title:L("plant_tag_4"),deleted:!1},{tagId:5,title:L("plant_tag_5"),deleted:!1},{tagId:6,title:L("plant_tag_6"),deleted:!1},{tagId:7,title:L("plant_tag_7"),deleted:!1}],Ie=[31,32,40,42,43,44,48,49,50,51,52,53,54,55,56,59,60,61,66,70,73,77,78,86,88,89,90,91,92,93,94,95,16,106,107,108,109,110,111,112,113,114],qn=async()=>{var t,i,a,r;const s=await C.storage.local.get(null),e=(s.grownTree||[]).map(({plant:g,syncState:o})=>{var l;return{syncStatus:o==="Success"?"Succeeded":"Failed",plant:{...H(g,{deep:!0}),treeTypeGid:((l=g.trees[0])==null?void 0:l.tree_type)||0}}}),n={version:2,allowList:s.whiteList||[],blockList:s.blackList||[],growingPlant:s.planting?{...H(s.planting.plant,{deep:!0}),treeTypeGid:((t=s.planting.plant.trees[0])==null?void 0:t.tree_type)||1}:null,resultPlant:null,plantRecords:e,siteBlockingMode:s.isWhitelistMode?"Allow":"Block",user:s.user?{id:s.user.user_id,name:s.user.user_name,avatarUrl:((i=s.profile)==null?void 0:i.avatar_url)||null,healthTreeCount:((a=s.profile)==null?void 0:a.health_count)||0,deadTreeCount:((r=s.profile)==null?void 0:r.death_count)||0,coin:s.coin||0,boostEndTime:null,boostStartTime:null,boostRate:null,rememberToken:s.user.remember_token}:null,serverRegion:"Global",tags:s.tag?H(s.tag,{deep:!0}):Ps,unlockedPlantIds:s.purchasedProducts?s.purchasedProducts.map(({gid:g})=>g):de,selectedPlantIndex:s.currentTreeIndex||0,selectedPlantingDuration:s.lastTreeTime||600,canShowNoAccountCTA:!0,lastSyncedAt:new Date("2013-01-01").toISOString(),isInChinaMigration:!1};await C.storage.local.set(n),await C.storage.local.remove(["currentTreeIndex","coin","DefaultTAG","IDtemp","blackList","whiteList","isWhitelistMode","lastTreeTagId","lastTreeTime","lastTreeType","lastUpdateTime","grownTree","tempNote","tempTag","tag","purchasedProducts","profile"])},Gn=async()=>{const s=await C.storage.local.get(null),e={version:2.1,unlockedPlantIds:s.unlockedPlantIds.length<de.length?de:s.unlockedPlantIds};await C.storage.local.set(e)},zn=async()=>{const e={version:3,tags:(await C.storage.local.get(null)).tags.map(n=>n.deleted===void 0?{...n,deleted:!1}:n)};await C.storage.local.set(e)},Pe=async s=>await C.storage.local.get(s),ce=async s=>{await C.storage.local.set(s)},J=async s=>(await C.storage.local.get({[s]:null}))[s],ue=async(s,e)=>{if(typeof e=="function"){const n=e(await J(s));return await C.storage.local.set({[s]:n})}return await C.storage.local.set({[s]:e})},Vn=async()=>{const s=await J("version")||1;s<2&&await qn(),s<2.1&&await Gn(),s<3&&await zn()};let M=Es.create();const Wn={Global:"https://auth.seekrtech.com",China:"https://auth.upwardsware.com"};let ne=null;function Hn(){M=M.extend({hooks:{beforeRetry:[]}}),ne=null}function Cs(s){M=M.extend({headers:{Authorization:`Bearer ${s}`}})}function ks(s){if(Rs(s.serverRegion),s.accessToken&&Cs(s.accessToken),s.refreshToken){let e="";e=Wn[s.serverRegion],ne=()=>Es.post("oauth/tokens",{prefixUrl:e,json:{grant_type:"refresh_token",refresh_token:s.refreshToken}}).json(),M=M.extend({retry:{statusCodes:[403,408,413,429,500,502,503,504]},hooks:{beforeRetry:[async({request:n,error:t})=>{if(t instanceof be&&t.response.status===403){const i=await ne();n.headers.set("Authorization",`Bearer ${i.access_token}`),Cs(i.access_token),await ce({accessToken:i.access_token})}}]}})}}function Rs(s){let e="";switch(s){case"Global":e="https://c88fef96.forestapp.cc/api/v1";break;case"China":e="https://forest-china.upwardsware.com/api/v1";break}M=M.extend({prefixUrl:e})}const Jn=async()=>{const s=await M.get("tags").json();return H(s.tags,{deep:!0})},Kn=async()=>(await M.get("tree_types/unlocked").json()).map(({gid:e})=>e),Zn=async s=>{const e=await M.get(`users/${s}/boost`).json();return H(e,{deep:!0})},Yn=async s=>{const e=await M.get(`users/${s}`).json();return H(e)},Xn=async s=>{const e=await M.post("plants",{json:{plant:Bn(s,{deep:!0})}}).json();return H(e,{deep:!0})},Os=async s=>{const e=await Yn(s),[n,t,i]=await Promise.all([Zn(s),Jn(),Kn()]);let a=t;return t.findIndex(({tagId:r})=>r===0)<0&&(a=[{title:L("plant_tag_0"),tagId:0,deleted:!1},...a]),a=a.filter(({deleted:r})=>r===!1),{user:{...e,...n},tags:a,unlockedPlantIds:i}},D={GET_POPUP_PROPS:"GET_POPUP_PROPS",GET_CONTENT_PROPS:"GET_CONTENT_PROPS",GET_OPTIONS_PROPS:"GET_OPTIONS_PROPS",START_PLANTING:"START_PLANTING",GIVE_UP:"GIVE_UP",BACK_TO_IDLE:"BACK_TO_IDLE",UPDATE_PLANTING_STATUS:"UPDATE_PLANTING_STATUS",MODIFY_PLANT_INDEX:"MODIFY_PLANT_INDEX",UPDATE_PLANT:"UPDATE_PLANT",UPDATE_PLANT_AND_TIME_REMAINING:"UPDATE_PLANT_AND_TIME_REMAINING",MODIFY_TARGET_DURATION:"MODIFY_TARGET_DURATION",UPDATE_CONTENT_SCRIPT_SITE_BLOCKING_MODE:"UPDATE_CONTENT_SCRIPT_SITE_BLOCKING_MODE",OPTIONS_PAGE_REVALIDATE_SITE_LIST:"OPTIONS_PAGE_REVALIDATE_SITE_LIST",RELOAD_OPTIONS_PAGE:"RELOAD_OPTIONS_PAGE",UPDATE_VIEW:"UPDATE_VIEW",SET_BACKGROUND_SERVER_REGION:"SET_BACKGROUND_SERVER_REGION"};async function Ns(s){const e=s==="SUCCESS";e&&await C.notifications.create({type:"basic",title:L("notification_title_on_success"),message:L("notification_text_on_success"),iconUrl:"/logo/128.png"});const{growingPlant:n,user:t}=await Pe(["growingPlant","user"]);if(n===null)return;const i=new Date,a=(new Date(n.endTime).getTime()-new Date(n.startTime).getTime())/1e3,r=(i.getTime()-new Date(n.startTime).getTime())/1e3,g={...n,isSuccess:e,...e===!1&&{endTime:i.toISOString()},updatedAt:i.toISOString(),trees:Qn(a,e?a:r,n.treeTypeGid)};if(ce({growingPlant:null,resultPlant:g}),t){try{const l=await Xn(g);await ue("plantRecords",d=>[{plant:l,syncStatus:"Succeeded"},...d])}catch{await ue("plantRecords",d=>[{plant:g,syncStatus:"Failed"},...d])}const o=await Os(t.id).catch(()=>null);o&&await ce(o)}else await ue("plantRecords",o=>[{plant:g,syncStatus:"Pending"},...o])}function Qn(s,e,n){const t=e<s,i=Ge(s),a=Ge(e),r=a===1&&t?0:a,g=[...Array(r)].map((l,d)=>({isDead:!1,phase:d+4,treeType:n})),o=[...Array(i-r)].map(()=>({isDead:!0,phase:8,treeType:n}));return[...g,...o]}const K=[{id:0,phaseType:"Seven",images:{1:"/images/plants/0/1.png",2:"/images/plants/0/2.png",3:"/images/plants/0/3.png",4:"/images/plants/0/4.png",5:"/images/plants/0/5.png",6:"/images/plants/0/6.png",7:"/images/plants/0/7.png",Christmas:"/images/plants/0/Christmas.png",dead:"/images/plants/0/dead.png"}},{id:1,phaseType:"Seven",images:{1:"/images/plants/1/1.png",2:"/images/plants/1/2.png",3:"/images/plants/1/3.png",4:"/images/plants/1/4.png",5:"/images/plants/1/5.png",6:"/images/plants/1/6.png",7:"/images/plants/1/7.png",Christmas:"/images/plants/1/Christmas.png",dead:"/images/plants/1/dead.png"}},{id:10,phaseType:"Seven",images:{1:"/images/plants/10/1.png",2:"/images/plants/10/2.png",3:"/images/plants/10/3.png",4:"/images/plants/10/4.png",5:"/images/plants/10/5.png",6:"/images/plants/10/6.png",7:"/images/plants/10/7.png",dead:"/images/plants/10/dead.png"}},{id:100,phaseType:"Seven",images:{1:"/images/plants/100/1.png",2:"/images/plants/100/2.png",3:"/images/plants/100/3.png",4:"/images/plants/100/4.png",5:"/images/plants/100/5.png",6:"/images/plants/100/6.png",7:"/images/plants/100/7.png",dead:"/images/plants/100/dead.png"}},{id:101,phaseType:"Seven",images:{1:"/images/plants/101/1.png",2:"/images/plants/101/2.png",3:"/images/plants/101/3.png",4:"/images/plants/101/4.png",5:"/images/plants/101/5.png",6:"/images/plants/101/6.png",7:"/images/plants/101/7.png",dead:"/images/plants/101/dead.png"}},{id:103,phaseType:"Seven",images:{1:"/images/plants/103/1.png",2:"/images/plants/103/2.png",3:"/images/plants/103/3.png",4:"/images/plants/103/4.png",5:"/images/plants/103/5.png",6:"/images/plants/103/6.png",7:"/images/plants/103/7.png",dead:"/images/plants/103/dead.png"}},{id:104,phaseType:"Four",images:{1:"/images/plants/104/1.png",2:"/images/plants/104/2.png",3:"/images/plants/104/3.png",4:"/images/plants/104/4.png",dead:"/images/plants/104/dead.png"}},{id:105,phaseType:"Four",images:{1:"/images/plants/105/1.png",2:"/images/plants/105/2.png",3:"/images/plants/105/3.png",4:"/images/plants/105/4.png",dead:"/images/plants/105/dead.png"}},{id:106,phaseType:"Four",images:{1:"/images/plants/106/1.png",2:"/images/plants/106/2.png",3:"/images/plants/106/3.png",4:"/images/plants/106/4.png",dead:"/images/plants/106/dead.png"}},{id:107,phaseType:"Seven",images:{1:"/images/plants/107/1.png",2:"/images/plants/107/2.png",3:"/images/plants/107/3.png",4:"/images/plants/107/4.png",5:"/images/plants/107/5.png",6:"/images/plants/107/6.png",7:"/images/plants/107/7.png",dead:"/images/plants/107/dead.png"}},{id:108,phaseType:"Four",images:{1:"/images/plants/108/1.png",2:"/images/plants/108/2.png",3:"/images/plants/108/3.png",4:"/images/plants/108/4.png",dead:"/images/plants/108/dead.png"}},{id:109,phaseType:"Four",images:{1:"/images/plants/109/1.png",2:"/images/plants/109/2.png",3:"/images/plants/109/3.png",4:"/images/plants/109/4.png",dead:"/images/plants/109/dead.png"}},{id:11,phaseType:"Four",images:{1:"/images/plants/11/1.png",2:"/images/plants/11/2.png",3:"/images/plants/11/3.png",4:"/images/plants/11/4.png",dead:"/images/plants/11/dead.png"}},{id:110,phaseType:"Seven",images:{1:"/images/plants/110/1.png",2:"/images/plants/110/2.png",3:"/images/plants/110/3.png",4:"/images/plants/110/4.png",5:"/images/plants/110/5.png",6:"/images/plants/110/6.png",7:"/images/plants/110/7.png",dead:"/images/plants/110/dead.png"}},{id:111,phaseType:"Seven",images:{1:"/images/plants/111/1.png",2:"/images/plants/111/2.png",3:"/images/plants/111/3.png",4:"/images/plants/111/4.png",5:"/images/plants/111/5.png",6:"/images/plants/111/6.png",7:"/images/plants/111/7.png",dead:"/images/plants/111/dead.png"}},{id:112,phaseType:"Seven",images:{1:"/images/plants/112/1.png",2:"/images/plants/112/2.png",3:"/images/plants/112/3.png",4:"/images/plants/112/4.png",5:"/images/plants/112/5.png",6:"/images/plants/112/6.png",7:"/images/plants/112/7.png",dead:"/images/plants/112/dead.png"}},{id:113,phaseType:"Four",images:{1:"/images/plants/113/1.png",2:"/images/plants/113/2.png",3:"/images/plants/113/3.png",4:"/images/plants/113/4.png",dead:"/images/plants/113/dead.png"}},{id:114,phaseType:"Four",images:{1:"/images/plants/114/1.png",2:"/images/plants/114/2.png",3:"/images/plants/114/3.png",4:"/images/plants/114/4.png",dead:"/images/plants/114/dead.png"}},{id:12,phaseType:"Seven",images:{1:"/images/plants/12/1.png",2:"/images/plants/12/2.png",3:"/images/plants/12/3.png",4:"/images/plants/12/4.png",5:"/images/plants/12/5.png",6:"/images/plants/12/6.png",7:"/images/plants/12/7.png",dead:"/images/plants/12/dead.png"}},{id:13,phaseType:"Four",images:{1:"/images/plants/13/1.png",2:"/images/plants/13/2.png",3:"/images/plants/13/3.png",4:"/images/plants/13/4.png",dead:"/images/plants/13/dead.png"}},{id:14,phaseType:"Four",images:{1:"/images/plants/14/1.png",2:"/images/plants/14/2.png",3:"/images/plants/14/3.png",4:"/images/plants/14/4.png",dead:"/images/plants/14/dead.png"}},{id:15,phaseType:"Seven",images:{1:"/images/plants/15/1.png",2:"/images/plants/15/2.png",3:"/images/plants/15/3.png",4:"/images/plants/15/4.png",5:"/images/plants/15/5.png",6:"/images/plants/15/6.png",7:"/images/plants/15/7.png",dead:"/images/plants/15/dead.png"}},{id:16,phaseType:"Four",images:{1:"/images/plants/16/1.png",2:"/images/plants/16/2.png",3:"/images/plants/16/3.png",4:"/images/plants/16/4.png",dead:"/images/plants/16/dead.png"}},{id:18,phaseType:"Four",images:{1:"/images/plants/18/1.png",2:"/images/plants/18/2.png",3:"/images/plants/18/3.png",4:"/images/plants/18/4.png",dead:"/images/plants/18/dead.png"}},{id:19,phaseType:"Seven",images:{1:"/images/plants/19/1.png",2:"/images/plants/19/2.png",3:"/images/plants/19/3.png",4:"/images/plants/19/4.png",5:"/images/plants/19/5.png",6:"/images/plants/19/6.png",7:"/images/plants/19/7.png",dead:"/images/plants/19/dead.png"}},{id:2,phaseType:"Seven",images:{1:"/images/plants/2/1.png",2:"/images/plants/2/2.png",3:"/images/plants/2/3.png",4:"/images/plants/2/4.png",5:"/images/plants/2/5.png",6:"/images/plants/2/6.png",7:"/images/plants/2/7.png",Christmas:"/images/plants/2/Christmas.png",dead:"/images/plants/2/dead.png"}},{id:20,phaseType:"Seven",images:{1:"/images/plants/20/1.png",2:"/images/plants/20/2.png",3:"/images/plants/20/3.png",4:"/images/plants/20/4.png",5:"/images/plants/20/5.png",6:"/images/plants/20/6.png",7:"/images/plants/20/7.png",dead:"/images/plants/20/dead.png"}},{id:21,phaseType:"Seven",images:{1:"/images/plants/21/1.png",2:"/images/plants/21/2.png",3:"/images/plants/21/3.png",4:"/images/plants/21/4.png",5:"/images/plants/21/5.png",6:"/images/plants/21/6.png",7:"/images/plants/21/7.png",dead:"/images/plants/21/dead.png"}},{id:22,phaseType:"Four",images:{1:"/images/plants/22/1.png",2:"/images/plants/22/2.png",3:"/images/plants/22/3.png",4:"/images/plants/22/4.png",dead:"/images/plants/22/dead.png"}},{id:23,phaseType:"Seven",images:{1:"/images/plants/23/1.png",2:"/images/plants/23/2.png",3:"/images/plants/23/3.png",4:"/images/plants/23/4.png",5:"/images/plants/23/5.png",6:"/images/plants/23/6.png",7:"/images/plants/23/7.png",dead:"/images/plants/23/dead.png"}},{id:24,phaseType:"Seven",images:{1:"/images/plants/24/1.png",2:"/images/plants/24/2.png",3:"/images/plants/24/3.png",4:"/images/plants/24/4.png",5:"/images/plants/24/5.png",6:"/images/plants/24/6.png",7:"/images/plants/24/7.png",dead:"/images/plants/24/dead.png"}},{id:25,phaseType:"Four",images:{1:"/images/plants/25/1.png",2:"/images/plants/25/2.png",3:"/images/plants/25/3.png",4:"/images/plants/25/4.png",dead:"/images/plants/25/dead.png"}},{id:26,phaseType:"Four",images:{1:"/images/plants/26/1.png",2:"/images/plants/26/2.png",3:"/images/plants/26/3.png",4:"/images/plants/26/4.png",dead:"/images/plants/26/dead.png"}},{id:27,phaseType:"Seven",images:{1:"/images/plants/27/1.png",2:"/images/plants/27/2.png",3:"/images/plants/27/3.png",4:"/images/plants/27/4.png",5:"/images/plants/27/5.png",6:"/images/plants/27/6.png",7:"/images/plants/27/7.png",dead:"/images/plants/27/dead.png"}},{id:28,phaseType:"Seven",images:{1:"/images/plants/28/1.png",2:"/images/plants/28/2.png",3:"/images/plants/28/3.png",4:"/images/plants/28/4.png",5:"/images/plants/28/5.png",6:"/images/plants/28/6.png",7:"/images/plants/28/7.png",dead:"/images/plants/28/dead.png"}},{id:29,phaseType:"Four",images:{1:"/images/plants/29/1.png",2:"/images/plants/29/2.png",3:"/images/plants/29/3.png",4:"/images/plants/29/4.png",dead:"/images/plants/29/dead.png"}},{id:3,phaseType:"Seven",images:{1:"/images/plants/3/1.png",2:"/images/plants/3/2.png",3:"/images/plants/3/3.png",4:"/images/plants/3/4.png",5:"/images/plants/3/5.png",6:"/images/plants/3/6.png",7:"/images/plants/3/7.png",Christmas:"/images/plants/3/Christmas.png",dead:"/images/plants/3/dead.png"}},{id:30,phaseType:"Seven",images:{1:"/images/plants/30/1.png",2:"/images/plants/30/2.png",3:"/images/plants/30/3.png",4:"/images/plants/30/4.png",5:"/images/plants/30/5.png",6:"/images/plants/30/6.png",7:"/images/plants/30/7.png",dead:"/images/plants/30/dead.png"}},{id:31,phaseType:"Seven",images:{1:"/images/plants/31/1.png",2:"/images/plants/31/2.png",3:"/images/plants/31/3.png",4:"/images/plants/31/4.png",5:"/images/plants/31/5.png",6:"/images/plants/31/6.png",7:"/images/plants/31/7.png",dead:"/images/plants/31/dead.png"}},{id:32,phaseType:"Four",images:{1:"/images/plants/32/1.png",2:"/images/plants/32/2.png",3:"/images/plants/32/3.png",4:"/images/plants/32/4.png",dead:"/images/plants/32/dead.png"}},{id:33,phaseType:"Four",images:{1:"/images/plants/33/1.png",2:"/images/plants/33/2.png",3:"/images/plants/33/3.png",4:"/images/plants/33/4.png",dead:"/images/plants/33/dead.png"}},{id:34,phaseType:"Seven",images:{1:"/images/plants/34/1.png",2:"/images/plants/34/2.png",3:"/images/plants/34/3.png",4:"/images/plants/34/4.png",5:"/images/plants/34/5.png",6:"/images/plants/34/6.png",7:"/images/plants/34/7.png",dead:"/images/plants/34/dead.png"}},{id:35,phaseType:"Seven",images:{1:"/images/plants/35/1.png",2:"/images/plants/35/2.png",3:"/images/plants/35/3.png",4:"/images/plants/35/4.png",5:"/images/plants/35/5.png",6:"/images/plants/35/6.png",7:"/images/plants/35/7.png",dead:"/images/plants/35/dead.png"}},{id:36,phaseType:"Seven",images:{1:"/images/plants/36/1.png",2:"/images/plants/36/2.png",3:"/images/plants/36/3.png",4:"/images/plants/36/4.png",5:"/images/plants/36/5.png",6:"/images/plants/36/6.png",7:"/images/plants/36/7.png",dead:"/images/plants/36/dead.png"}},{id:37,phaseType:"Seven",images:{1:"/images/plants/37/1.png",2:"/images/plants/37/2.png",3:"/images/plants/37/3.png",4:"/images/plants/37/4.png",5:"/images/plants/37/5.png",6:"/images/plants/37/6.png",7:"/images/plants/37/7.png",dead:"/images/plants/37/dead.png"}},{id:38,phaseType:"Four",images:{1:"/images/plants/38/1.png",2:"/images/plants/38/2.png",3:"/images/plants/38/3.png",4:"/images/plants/38/4.png",dead:"/images/plants/38/dead.png"}},{id:39,phaseType:"Four",images:{1:"/images/plants/39/1.png",2:"/images/plants/39/2.png",3:"/images/plants/39/3.png",4:"/images/plants/39/4.png",dead:"/images/plants/39/dead.png"}},{id:4,phaseType:"Seven",images:{1:"/images/plants/4/1.png",2:"/images/plants/4/2.png",3:"/images/plants/4/3.png",4:"/images/plants/4/4.png",5:"/images/plants/4/5.png",6:"/images/plants/4/6.png",7:"/images/plants/4/7.png",Christmas:"/images/plants/4/Christmas.png",dead:"/images/plants/4/dead.png"}},{id:40,phaseType:"Seven",images:{1:"/images/plants/40/1.png",2:"/images/plants/40/2.png",3:"/images/plants/40/3.png",4:"/images/plants/40/4.png",5:"/images/plants/40/5.png",6:"/images/plants/40/6.png",7:"/images/plants/40/7.png",dead:"/images/plants/40/dead.png"}},{id:41,phaseType:"Seven",images:{1:"/images/plants/41/1.png",2:"/images/plants/41/2.png",3:"/images/plants/41/3.png",4:"/images/plants/41/4.png",5:"/images/plants/41/5.png",6:"/images/plants/41/6.png",7:"/images/plants/41/7.png",dead:"/images/plants/41/dead.png"}},{id:42,phaseType:"Seven",images:{1:"/images/plants/42/1.png",2:"/images/plants/42/2.png",3:"/images/plants/42/3.png",4:"/images/plants/42/4.png",5:"/images/plants/42/5.png",6:"/images/plants/42/6.png",7:"/images/plants/42/7.png",dead:"/images/plants/42/dead.png"}},{id:43,phaseType:"Seven",images:{1:"/images/plants/43/1.png",2:"/images/plants/43/2.png",3:"/images/plants/43/3.png",4:"/images/plants/43/4.png",5:"/images/plants/43/5.png",6:"/images/plants/43/6.png",7:"/images/plants/43/7.png",dead:"/images/plants/43/dead.png"}},{id:44,phaseType:"Seven",images:{1:"/images/plants/44/1.png",2:"/images/plants/44/2.png",3:"/images/plants/44/3.png",4:"/images/plants/44/4.png",5:"/images/plants/44/5.png",6:"/images/plants/44/6.png",7:"/images/plants/44/7.png",dead:"/images/plants/44/dead.png"}},{id:45,phaseType:"Four",images:{1:"/images/plants/45/1.png",2:"/images/plants/45/2.png",3:"/images/plants/45/3.png",4:"/images/plants/45/4.png",dead:"/images/plants/45/dead.png"}},{id:46,phaseType:"Four",images:{1:"/images/plants/46/1.png",2:"/images/plants/46/2.png",3:"/images/plants/46/3.png",4:"/images/plants/46/4.png",dead:"/images/plants/46/dead.png"}},{id:47,phaseType:"Four",images:{1:"/images/plants/47/1.png",2:"/images/plants/47/2.png",3:"/images/plants/47/3.png",4:"/images/plants/47/4.png",dead:"/images/plants/47/dead.png"}},{id:48,phaseType:"Four",images:{1:"/images/plants/48/1.png",2:"/images/plants/48/2.png",3:"/images/plants/48/3.png",4:"/images/plants/48/4.png",dead:"/images/plants/48/dead.png"}},{id:49,phaseType:"Four",images:{1:"/images/plants/49/1.png",2:"/images/plants/49/2.png",3:"/images/plants/49/3.png",4:"/images/plants/49/4.png",dead:"/images/plants/49/dead.png"}},{id:5,phaseType:"Seven",images:{1:"/images/plants/5/1.png",2:"/images/plants/5/2.png",3:"/images/plants/5/3.png",4:"/images/plants/5/4.png",5:"/images/plants/5/5.png",6:"/images/plants/5/6.png",7:"/images/plants/5/7.png",Christmas:"/images/plants/5/Christmas.png",dead:"/images/plants/5/dead.png"}},{id:50,phaseType:"Four",images:{1:"/images/plants/50/1.png",2:"/images/plants/50/2.png",3:"/images/plants/50/3.png",4:"/images/plants/50/4.png",dead:"/images/plants/50/dead.png"}},{id:51,phaseType:"Four",images:{1:"/images/plants/51/1.png",2:"/images/plants/51/2.png",3:"/images/plants/51/3.png",4:"/images/plants/51/4.png",dead:"/images/plants/51/dead.png"}},{id:52,phaseType:"Four",images:{1:"/images/plants/52/1.png",2:"/images/plants/52/2.png",3:"/images/plants/52/3.png",4:"/images/plants/52/4.png",dead:"/images/plants/52/dead.png"}},{id:53,phaseType:"Four",images:{1:"/images/plants/53/1.png",2:"/images/plants/53/2.png",3:"/images/plants/53/3.png",4:"/images/plants/53/4.png",dead:"/images/plants/53/dead.png"}},{id:54,phaseType:"Four",images:{1:"/images/plants/54/1.png",2:"/images/plants/54/2.png",3:"/images/plants/54/3.png",4:"/images/plants/54/4.png",dead:"/images/plants/54/dead.png"}},{id:55,phaseType:"Four",images:{1:"/images/plants/55/1.png",2:"/images/plants/55/2.png",3:"/images/plants/55/3.png",4:"/images/plants/55/4.png",dead:"/images/plants/55/dead.png"}},{id:56,phaseType:"Seven",images:{1:"/images/plants/56/1.png",2:"/images/plants/56/2.png",3:"/images/plants/56/3.png",4:"/images/plants/56/4.png",5:"/images/plants/56/5.png",6:"/images/plants/56/6.png",7:"/images/plants/56/7.png",dead:"/images/plants/56/dead.png"}},{id:57,phaseType:"Seven",images:{1:"/images/plants/57/1.png",2:"/images/plants/57/2.png",3:"/images/plants/57/3.png",4:"/images/plants/57/4.png",5:"/images/plants/57/5.png",6:"/images/plants/57/6.png",7:"/images/plants/57/7.png",dead:"/images/plants/57/dead.png"}},{id:58,phaseType:"Four",images:{1:"/images/plants/58/1.png",2:"/images/plants/58/2.png",3:"/images/plants/58/3.png",4:"/images/plants/58/4.png",dead:"/images/plants/58/dead.png"}},{id:59,phaseType:"Seven",images:{1:"/images/plants/59/1.png",2:"/images/plants/59/2.png",3:"/images/plants/59/3.png",4:"/images/plants/59/4.png",5:"/images/plants/59/5.png",6:"/images/plants/59/6.png",7:"/images/plants/59/7.png",dead:"/images/plants/59/dead.png"}},{id:6,phaseType:"Four",images:{1:"/images/plants/6/1.png",2:"/images/plants/6/2.png",3:"/images/plants/6/3.png",4:"/images/plants/6/4.png",dead:"/images/plants/6/dead.png"}},{id:60,phaseType:"Four",images:{1:"/images/plants/60/1.png",2:"/images/plants/60/2.png",3:"/images/plants/60/3.png",4:"/images/plants/60/4.png",dead:"/images/plants/60/dead.png"}},{id:61,phaseType:"Four",images:{1:"/images/plants/61/1.png",2:"/images/plants/61/2.png",3:"/images/plants/61/3.png",4:"/images/plants/61/4.png",dead:"/images/plants/61/dead.png"}},{id:62,phaseType:"Seven",images:{1:"/images/plants/62/1.png",2:"/images/plants/62/2.png",3:"/images/plants/62/3.png",4:"/images/plants/62/4.png",5:"/images/plants/62/5.png",6:"/images/plants/62/6.png",7:"/images/plants/62/7.png",dead:"/images/plants/62/dead.png"}},{id:63,phaseType:"Seven",images:{1:"/images/plants/63/1.png",2:"/images/plants/63/2.png",3:"/images/plants/63/3.png",4:"/images/plants/63/4.png",5:"/images/plants/63/5.png",6:"/images/plants/63/6.png",7:"/images/plants/63/7.png",dead:"/images/plants/63/dead.png"}},{id:64,phaseType:"Four",images:{1:"/images/plants/64/1.png",2:"/images/plants/64/2.png",3:"/images/plants/64/3.png",4:"/images/plants/64/4.png",dead:"/images/plants/64/dead.png"}},{id:65,phaseType:"Four",images:{1:"/images/plants/65/1.png",2:"/images/plants/65/2.png",3:"/images/plants/65/3.png",4:"/images/plants/65/4.png",dead:"/images/plants/65/dead.png"}},{id:66,phaseType:"Seven",images:{1:"/images/plants/66/1.png",2:"/images/plants/66/2.png",3:"/images/plants/66/3.png",4:"/images/plants/66/4.png",5:"/images/plants/66/5.png",6:"/images/plants/66/6.png",7:"/images/plants/66/7.png",dead:"/images/plants/66/dead.png"}},{id:67,phaseType:"Four",images:{1:"/images/plants/67/1.png",2:"/images/plants/67/2.png",3:"/images/plants/67/3.png",4:"/images/plants/67/4.png",dead:"/images/plants/67/dead.png"}},{id:68,phaseType:"Four",images:{1:"/images/plants/68/1.png",2:"/images/plants/68/2.png",3:"/images/plants/68/3.png",4:"/images/plants/68/4.png",dead:"/images/plants/68/dead.png"}},{id:69,phaseType:"Four",images:{1:"/images/plants/69/1.png",2:"/images/plants/69/2.png",3:"/images/plants/69/3.png",4:"/images/plants/69/4.png",dead:"/images/plants/69/dead.png"}},{id:7,phaseType:"Seven",images:{1:"/images/plants/7/1.png",2:"/images/plants/7/2.png",3:"/images/plants/7/3.png",4:"/images/plants/7/4.png",5:"/images/plants/7/5.png",6:"/images/plants/7/6.png",7:"/images/plants/7/7.png",dead:"/images/plants/7/dead.png"}},{id:70,phaseType:"Seven",images:{1:"/images/plants/70/1.png",2:"/images/plants/70/2.png",3:"/images/plants/70/3.png",4:"/images/plants/70/4.png",5:"/images/plants/70/5.png",6:"/images/plants/70/6.png",7:"/images/plants/70/7.png",dead:"/images/plants/70/dead.png"}},{id:71,phaseType:"Seven",images:{1:"/images/plants/71/1.png",2:"/images/plants/71/2.png",3:"/images/plants/71/3.png",4:"/images/plants/71/4.png",5:"/images/plants/71/5.png",6:"/images/plants/71/6.png",7:"/images/plants/71/7.png",dead:"/images/plants/71/dead.png"}},{id:72,phaseType:"Four",images:{1:"/images/plants/72/1.png",2:"/images/plants/72/2.png",3:"/images/plants/72/3.png",4:"/images/plants/72/4.png",dead:"/images/plants/72/dead.png"}},{id:73,phaseType:"Seven",images:{1:"/images/plants/73/1.png",2:"/images/plants/73/2.png",3:"/images/plants/73/3.png",4:"/images/plants/73/4.png",5:"/images/plants/73/5.png",6:"/images/plants/73/6.png",7:"/images/plants/73/7.png",dead:"/images/plants/73/dead.png"}},{id:74,phaseType:"Four",images:{1:"/images/plants/74/1.png",2:"/images/plants/74/2.png",3:"/images/plants/74/3.png",4:"/images/plants/74/4.png",dead:"/images/plants/74/dead.png"}},{id:75,phaseType:"Seven",images:{1:"/images/plants/75/1.png",2:"/images/plants/75/2.png",3:"/images/plants/75/3.png",4:"/images/plants/75/4.png",5:"/images/plants/75/5.png",6:"/images/plants/75/6.png",7:"/images/plants/75/7.png",dead:"/images/plants/75/dead.png"}},{id:76,phaseType:"Four",images:{1:"/images/plants/76/1.png",2:"/images/plants/76/2.png",3:"/images/plants/76/3.png",4:"/images/plants/76/4.png",dead:"/images/plants/76/dead.png"}},{id:77,phaseType:"Seven",images:{1:"/images/plants/77/1.png",2:"/images/plants/77/2.png",3:"/images/plants/77/3.png",4:"/images/plants/77/4.png",5:"/images/plants/77/5.png",6:"/images/plants/77/6.png",7:"/images/plants/77/7.png",dead:"/images/plants/77/dead.png"}},{id:78,phaseType:"Seven",images:{1:"/images/plants/78/1.png",2:"/images/plants/78/2.png",3:"/images/plants/78/3.png",4:"/images/plants/78/4.png",5:"/images/plants/78/5.png",6:"/images/plants/78/6.png",7:"/images/plants/78/7.png",dead:"/images/plants/78/dead.png"}},{id:79,phaseType:"Seven",images:{1:"/images/plants/79/1.png",2:"/images/plants/79/2.png",3:"/images/plants/79/3.png",4:"/images/plants/79/4.png",5:"/images/plants/79/5.png",6:"/images/plants/79/6.png",7:"/images/plants/79/7.png",dead:"/images/plants/79/dead.png"}},{id:8,phaseType:"Seven",images:{1:"/images/plants/8/1.png",2:"/images/plants/8/2.png",3:"/images/plants/8/3.png",4:"/images/plants/8/4.png",5:"/images/plants/8/5.png",6:"/images/plants/8/6.png",7:"/images/plants/8/7.png",dead:"/images/plants/8/dead.png"}},{id:80,phaseType:"Four",images:{1:"/images/plants/80/1.png",2:"/images/plants/80/2.png",3:"/images/plants/80/3.png",4:"/images/plants/80/4.png",dead:"/images/plants/80/dead.png"}},{id:81,phaseType:"Four",images:{1:"/images/plants/81/1.png",2:"/images/plants/81/2.png",3:"/images/plants/81/3.png",4:"/images/plants/81/4.png",dead:"/images/plants/81/dead.png"}},{id:82,phaseType:"Seven",images:{1:"/images/plants/82/1.png",2:"/images/plants/82/2.png",3:"/images/plants/82/3.png",4:"/images/plants/82/4.png",5:"/images/plants/82/5.png",6:"/images/plants/82/6.png",7:"/images/plants/82/7.png",dead:"/images/plants/82/dead.png"}},{id:83,phaseType:"Seven",images:{1:"/images/plants/83/1.png",2:"/images/plants/83/2.png",3:"/images/plants/83/3.png",4:"/images/plants/83/4.png",5:"/images/plants/83/5.png",6:"/images/plants/83/6.png",7:"/images/plants/83/7.png",dead:"/images/plants/83/dead.png"}},{id:84,phaseType:"Seven",images:{1:"/images/plants/84/1.png",2:"/images/plants/84/2.png",3:"/images/plants/84/3.png",4:"/images/plants/84/4.png",5:"/images/plants/84/5.png",6:"/images/plants/84/6.png",7:"/images/plants/84/7.png",dead:"/images/plants/84/dead.png"}},{id:85,phaseType:"Seven",images:{1:"/images/plants/85/1.png",2:"/images/plants/85/2.png",3:"/images/plants/85/3.png",4:"/images/plants/85/4.png",5:"/images/plants/85/5.png",6:"/images/plants/85/6.png",7:"/images/plants/85/7.png",dead:"/images/plants/85/dead.png"}},{id:86,phaseType:"Seven",images:{1:"/images/plants/86/1.png",2:"/images/plants/86/2.png",3:"/images/plants/86/3.png",4:"/images/plants/86/4.png",5:"/images/plants/86/5.png",6:"/images/plants/86/6.png",7:"/images/plants/86/7.png",dead:"/images/plants/86/dead.png"}},{id:87,phaseType:"Seven",images:{1:"/images/plants/87/1.png",2:"/images/plants/87/2.png",3:"/images/plants/87/3.png",4:"/images/plants/87/4.png",5:"/images/plants/87/5.png",6:"/images/plants/87/6.png",7:"/images/plants/87/7.png",dead:"/images/plants/87/dead.png"}},{id:88,phaseType:"Four",images:{1:"/images/plants/88/1.png",2:"/images/plants/88/2.png",3:"/images/plants/88/3.png",4:"/images/plants/88/4.png",dead:"/images/plants/88/dead.png"}},{id:89,phaseType:"Four",images:{1:"/images/plants/89/1.png",2:"/images/plants/89/2.png",3:"/images/plants/89/3.png",4:"/images/plants/89/4.png",dead:"/images/plants/89/dead.png"}},{id:9,phaseType:"Seven",images:{1:"/images/plants/9/1.png",2:"/images/plants/9/2.png",3:"/images/plants/9/3.png",4:"/images/plants/9/4.png",5:"/images/plants/9/5.png",6:"/images/plants/9/6.png",7:"/images/plants/9/7.png",dead:"/images/plants/9/dead.png"}},{id:90,phaseType:"Four",images:{1:"/images/plants/90/1.png",2:"/images/plants/90/2.png",3:"/images/plants/90/3.png",4:"/images/plants/90/4.png",dead:"/images/plants/90/dead.png"}},{id:91,phaseType:"Four",images:{1:"/images/plants/91/1.png",2:"/images/plants/91/2.png",3:"/images/plants/91/3.png",4:"/images/plants/91/4.png",dead:"/images/plants/91/dead.png"}},{id:92,phaseType:"Four",images:{1:"/images/plants/92/1.png",2:"/images/plants/92/2.png",3:"/images/plants/92/3.png",4:"/images/plants/92/4.png",dead:"/images/plants/92/dead.png"}},{id:93,phaseType:"Four",images:{1:"/images/plants/93/1.png",2:"/images/plants/93/2.png",3:"/images/plants/93/3.png",4:"/images/plants/93/4.png",dead:"/images/plants/93/dead.png"}},{id:94,phaseType:"Four",images:{1:"/images/plants/94/1.png",2:"/images/plants/94/2.png",3:"/images/plants/94/3.png",4:"/images/plants/94/4.png",dead:"/images/plants/94/dead.png"}},{id:95,phaseType:"Seven",images:{1:"/images/plants/95/1.png",2:"/images/plants/95/2.png",3:"/images/plants/95/3.png",4:"/images/plants/95/4.png",5:"/images/plants/95/5.png",6:"/images/plants/95/6.png",7:"/images/plants/95/7.png",dead:"/images/plants/95/dead.png"}},{id:96,phaseType:"Seven",images:{1:"/images/plants/96/1.png",2:"/images/plants/96/2.png",3:"/images/plants/96/3.png",4:"/images/plants/96/4.png",5:"/images/plants/96/5.png",6:"/images/plants/96/6.png",7:"/images/plants/96/7.png",dead:"/images/plants/96/dead.png"}},{id:97,phaseType:"Seven",images:{1:"/images/plants/97/1.png",2:"/images/plants/97/2.png",3:"/images/plants/97/3.png",4:"/images/plants/97/4.png",5:"/images/plants/97/5.png",6:"/images/plants/97/6.png",7:"/images/plants/97/7.png",dead:"/images/plants/97/dead.png"}},{id:98,phaseType:"Seven",images:{1:"/images/plants/98/1.png",2:"/images/plants/98/2.png",3:"/images/plants/98/3.png",4:"/images/plants/98/4.png",5:"/images/plants/98/5.png",6:"/images/plants/98/6.png",7:"/images/plants/98/7.png",dead:"/images/plants/98/dead.png"}},{id:99,phaseType:"Seven",images:{1:"/images/plants/99/1.png",2:"/images/plants/99/2.png",3:"/images/plants/99/3.png",4:"/images/plants/99/4.png",5:"/images/plants/99/5.png",6:"/images/plants/99/6.png",7:"/images/plants/99/7.png",dead:"/images/plants/99/dead.png"}}];async function et(){const{growingPlant:s,selectedPlantIndex:e,unlockedPlantIds:n,serverRegion:t,selectedPlantingDuration:i,accessToken:a,refreshToken:r}=await Pe(["unlockedPlantIds","selectedPlantIndex","growingPlant","serverRegion","selectedPlantingDuration","accessToken","refreshToken"]),g=(()=>{const d=K[e].id;return n.includes(d)===!1&&Ie.includes(d)?0:e})(),[o,l]=s===null?["Idle",null]:Math.round((new Date(s.endTime).getTime()-Date.now())/1e3)>0?["Started",s.endTime]:["Succeeded",null];return{plantIndex:g,plantingStatus:o,timerResumable:l,unlockedPlantIds:n,serverRegion:t,selectedPlantingDuration:i,accessToken:a,refreshToken:r}}async function st(){const s=await J("user");if(s!==null)try{const e=await Os(s.id);ce(e)}catch(e){if(e instanceof be&&e.response.status===403){const n=await J("plantRecords");await ce({accessToken:null,refreshToken:null,user:null,tags:Ps,unlockedPlantIds:de,plantRecords:n.filter(({plant:t})=>t.id===void 0)}),await C.runtime.openOptionsPage(),De(D.RELOAD_OPTIONS_PAGE,null,"options").catch(()=>{})}}}class nt{constructor(e,n){this.unlockedPlantIds=e,this.plantIndexSignal=n}next(e){e||(e=this.plantIndexSignal.value);const n=e+1;if(n===K.length){this.plantIndexSignal.value=0;return}const t=K[n].id;if(this.unlockedPlantIds.includes(t)===!1&&Ie.includes(t))return this.next(n);this.plantIndexSignal.value=n}prev(e){e||(e=this.plantIndexSignal.value);const n=e-1;if(n<0){const i=K.length-1,a=K[i].id;if(this.unlockedPlantIds.includes(a)===!1&&Ie.includes(a))return this.prev(i);this.plantIndexSignal.value=i;return}const t=K[n];if(this.unlockedPlantIds.includes(t.id)===!1&&Ie.includes(t.id))return this.prev(n);this.plantIndexSignal.value=n}updateUnlockedPlantIds(e){this.unlockedPlantIds=e}}function ze({unlockedPlantIds:s,plantIndex:e,plantingStatus:n,timeRemaining:t,targetDuration:i}){const a=K[e],r=function(){return n==="Failed"?a.images.dead:n==="Started"?a.images[tt(t,i,a.phaseType)]:a.phaseType==="Four"?a.images[4]:a.images[Ge(t)+3]}();return{id:a.id,image:r,isLocked:s.includes(a.id)===!1}}function tt(s,e,n){const t=e-s,i=n==="Four"?4:Math.max(Math.floor(e/1800)+3,4);return t<e?Math.floor(i*t/e)||1:i}const at=chrome.runtime.getManifest();function Ms(s){return C.browserAction.setIcon(s)}async function it(){const[s]=at.content_scripts||[],e=s==null?void 0:s.js;e&&(await C.tabs.query({url:s.matches})).forEach(t=>{t.status!=="complete"||!t.id||C.tabs.executeScript(t.id,{file:e[0]}).catch(()=>{console.error("failed to execute content script",t)})})}async function Ds(...[s,e]){const n=await C.tabs.query({url:["https://*/*","http://*/*"]}),t=[];n.forEach(i=>{i.status!=="complete"||!i.id||t.push(De(s,e,{tabId:i.id,context:"content-script"}).catch(()=>{}))}),await Promise.all(t)}function rt({tickSignal:s,initialTargetDuration:e,onTimeUp:n,resumable:t}){let i,a=!1;const r=ie(e),g=ie(e);r.subscribe(S=>{ue("selectedPlantingDuration",S)}),he(()=>{g.value=r.value}),he(()=>{s.value,a&&_()});const o=600,l=7200;let d=0;function x(S){const P=r.value;switch(S){case"Increase":if(P===l)return;r.value=P===l?l:P+300;break;case"Decrease":if(P===o)return;r.value=P===o?o:P-300;break}}function I(S){d=new Date(S).getTime(),a=!0,i=window.setInterval(_,1e3)}function _(){const S=Math.round((d-Date.now())/1e3);if(S<0){n(),g.value=0,b();return}g.value=S}function b(){window.clearInterval(i),i=void 0,a=!1,g.value=r.value}return t&&I(t),{timeRemainingSignal:g,targetDurationSignal:r,setTargetTime:x,start:I,stop:b}}const Ve="refresh-token";C.alarms.onAlarm.addListener(s=>{s.name===Ve&&(ne==null||ne())}),chrome.runtime.onStartup.addListener(()=>{console.log("Forest web extension started!"),Pe(["accessToken","refreshToken","serverRegion"]).then(s=>{ks({accessToken:s.accessToken??null,refreshToken:s.refreshToken??null,serverRegion:s.serverRegion}),st()})}),chrome.runtime.onInstalled.addListener(s=>{console.log("Forest web extension has been installed! reason:",s.reason),it()});let Z=de;const gt=ie(Date.now());async function ot(){await Vn();const s=await et();Z=s.unlockedPlantIds,ks({accessToken:s.accessToken??null,refreshToken:s.refreshToken??null,serverRegion:s.serverRegion});const e=ie(s.plantingStatus),n=ie(s.plantIndex),t=new nt(Z,n),i=rt({initialTargetDuration:s.selectedPlantingDuration,resumable:s.timerResumable,onTimeUp:()=>{e.value="Succeeded"},tickSignal:gt});B(D.MODIFY_TARGET_DURATION,({data:a})=>{i.setTargetTime(a.method)}),B(D.MODIFY_PLANT_INDEX,({data:a})=>{switch(a){case"Next":t.next();break;case"Prev":t.prev();break}}),B(D.START_PLANTING,({data:a})=>{e.value="Started";const r=i.timeRemainingSignal.value,g=new Date,o=new Date(g.getTime()+r*1e3).toISOString(),l={treeTypeGid:a.plantId,startTime:g.toISOString(),endTime:o,tag:0,note:""};ue("growingPlant",l),i.start(o)}),B(D.BACK_TO_IDLE,()=>{e.value="Idle"}),B(D.GIVE_UP,()=>{e.value="Failed"}),B(D.GET_POPUP_PROPS,async()=>{const a=await J("siteBlockingMode"),r=await J(a==="Allow"?"allowList":"blockList"),g=i.timeRemainingSignal.value,o=i.targetDurationSignal.value,l=e.value;return{plant:ze({unlockedPlantIds:Z,plantIndex:n.value,plantingStatus:l,targetDuration:o,timeRemaining:g}),siteBlockingMode:a,plantingStatus:l,timeRemaining:g,siteList:r}}),B(D.GET_CONTENT_PROPS,async()=>{const a=await J("siteBlockingMode"),r=i.timeRemainingSignal.value,g=e.value,o=ze({unlockedPlantIds:Z,plantIndex:n.value,plantingStatus:g,targetDuration:i.targetDurationSignal.value,timeRemaining:r});return{siteBlockingMode:a,plantingStatus:g,timeRemaining:r,plant:o}}),B(D.GET_OPTIONS_PROPS,async()=>({...await Pe(["allowList","blockList","user","serverRegion"]),plantingStatus:e.value})),B(D.SET_BACKGROUND_SERVER_REGION,({data:a})=>{Rs(a.serverRegion)}),e.subscribe(a=>{switch(a){case"Succeeded":Ms({path:"/logo/dotted.png"}),Ns("SUCCESS");break;case"Failed":i.stop(),Ns("FAIL");break;case"Idle":{Ms({path:"/logo/128.png"});break}}Ds(D.UPDATE_PLANTING_STATUS,a)}),he(()=>{const a=ze({unlockedPlantIds:Z,plantIndex:n.value,plantingStatus:e.value,targetDuration:i.targetDurationSignal.value,timeRemaining:i.timeRemainingSignal.value});De(D.UPDATE_VIEW,{plant:a,timeRemaining:i.timeRemainingSignal.value,plantingStatus:e.value},"popup").catch(()=>{}),Ds(D.UPDATE_VIEW,{plant:a,timeRemaining:i.timeRemainingSignal.value,plantingStatus:e.value})}),C.storage.onChanged.addListener(a=>{var r,g;if((r=a.accessToken)!=null&&r.newValue){const o=a.accessToken.newValue,{exp:l}=js(o),d=new Date(l*1e3);chrome.alarms.create(Ve,{when:d.getTime()-10*1e3})}((g=a.refreshToken)==null?void 0:g.newValue)===null&&(chrome.alarms.clear(Ve),Hn()),a.unlockedPlantIds&&(Z=a.unlockedPlantIds.newValue,t.updateUnlockedPlantIds(Z))})}ot().catch(s=>{console.error(s)})})();
