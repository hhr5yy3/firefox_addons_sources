import{r as d}from"./cplx-M4JPizzD.js";import{$ as m}from"./cplx-BbAh7E-i.js";import{u as p}from"./cplx-B42KOvrD.js";import{t as y}from"./cplx-DEt7CUyc.js";import{h as g}from"./cplx-CWPpH3dB.js";import{j as l,r as A,b as w,D as C}from"./cplx-Cdcyb6EG.js";import{e as R}from"./cplx-2ekRUlSR.js";import{l as T}from"./cplx-AFeO3sEC.js";class a{static extractQuery(t){return t.query_str}static extractAnswer(t){const e=l.safeParse(t.text);return e.answer||l.safeParse(e[e.length-1].content.answer).answer}static extractWebResults(t){const e=l.safeParse(t.text),r=e.web_results;return r??l.safeParse(e[e.length-1].content.answer).web_results}static getModelName(t){var e;return((e=T.find(r=>r.code===t))==null?void 0:e.label)||t}static formatWebResults(t){return t.map((e,r)=>`[${r+1}] [${e.name}](${e.url})`).join(`  
`)}static formatAnswerWithCitations(t){const{query:e,answer:r,modelName:s,formattedWebResults:n,includeQuery:i}=t;return[`# ${e}`,"",`# Answer (${s}):`,r,"","# Citations:",n].slice(-(i?0:4)).join(`  
`)}static trimReferences(t,e){return e.forEach((r,s)=>{const n=`\\[${s+1}\\]`;t=t.replace(new RegExp(n,"g"),"")}),t}static formatAnswerWithoutCitations(t){const{query:e,answer:r,modelName:s,includeQuery:n}=t;return[`# ${e}`,"",`# Answer (${s}):`,r].slice(-(n?0:1)).join(`  
`)}static exportMessage({message:t,includeCitations:e,includeQuery:r}){const s=a.extractQuery(t),n=a.extractAnswer(t),i=a.extractWebResults(t),c=a.formatWebResults(i),u=a.getModelName(t.display_model);if(e)return a.formatAnswerWithCitations({query:s,answer:n,modelName:u,formattedWebResults:c,includeQuery:r??!0});const h=a.trimReferences(n,i);return a.formatAnswerWithoutCitations({query:s,answer:h,modelName:u,includeQuery:r??!0})}static exportThread({threadJSON:t,includeCitations:e,messageIndex:r}){return r!=null&&t[r]!=null?a.exportMessage({message:t[r],includeCitations:e,includeQuery:!1}):t.map(s=>a.exportMessage({message:s,includeCitations:e})).join(`  
---  


`)}}function j(){const o=A().pathname.split("/").pop()||"",{isFetching:t,refetch:e}=p({...g.threadInfo(o),enabled:!1}),r=d.useCallback(async()=>(await e()).data,[e]);return{isFetching:t,copyMessage:async function({messageBlockIndex:n,withCitations:i,onComplete:c}){try{i?await M({messageBlockIndex:n}):await W({messageBlockIndex:n,fetchFn:r}),c==null||c()}catch(u){y({title:"❌ Failed to copy message",description:u instanceof Error?u.message:"Unknown error occurred"})}},copyThread:async function({withCitations:n,onComplete:i}){n?await x({fetchFn:r}):await E({fetchFn:r}),i==null||i()},getContent:async function({withCitations:n,messageBlockIndex:i}){const c=await r();if(c==null)throw new Error("Failed to fetch thread info");return a.exportThread({threadJSON:c,includeCitations:n,messageIndex:i})}}}async function M({messageBlockIndex:o}){m(`[data-cplx-component="${w.THREAD.MESSAGE.BLOCK}"][data-index="${o}"] [data-cplx-component="${w.THREAD.MESSAGE.TEXT_COL_CHILD.BOTTOM_BAR}"] ${C.THREAD.MESSAGE.BOTTOM_BAR_CHILD.COPY_BUTTON}`).trigger("click")}async function W({messageBlockIndex:o,fetchFn:t}){return f({messageBlockIndex:o,fetchFn:t,withCitations:!1})}async function x({fetchFn:o}){return f({fetchFn:o,withCitations:!0})}async function E({fetchFn:o}){return f({fetchFn:o,withCitations:!1})}async function f({withCitations:o,messageBlockIndex:t,fetchFn:e}){if(e==null)throw new Error("Fetch function not provided");const r=await e();if(r==null)throw new Error("Failed to fetch thread info");const s=a.exportThread({threadJSON:r,includeCitations:o,messageIndex:t}),[,n]=await R(()=>navigator.clipboard.writeText(s))();if(n)throw console.error(n),new Error("Please click/focus on the page while copying!")}export{j as u};
