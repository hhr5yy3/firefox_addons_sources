import{Keybindings,bookmark_node_default,initUpgrading,loading_dots_default,popup_bookmarks_default,popup_dialog_default,popup_new_tab_shortcuts_default,reactiveUpgrading,scroll_box_default,select_field_default,select_input_default,showUpgradingScreen,text_field_default,text_input_default,toggle_field_default,upgrade_screen_default}from"../chunk-76OYADB3.js";import{BKM_OTHER_ID,BKM_ROOT_ID,BTN_ICONS,Bookmarks,ButtonTypes,COLOR_NAMES,COLOR_OPTS,CONTAINER_ICON_OPTS,CONTAINER_ID,Containers,DOMAIN_RE,DnD,DndPointerModeNames,DropType,FOLDER_NAME_DATA_RE,History,Info,MediaState,Menu,Mouse,NEWID,NOID,NavItemTypeNames,Notifications,PANEL_ICON_OPTS,PRE_SCROLL,Permissions,RGB_COLORS,Search,Selection,Settings,SetupPage,Sidebar,Snapshots,Store,Styles,SubPanelType,TabStatus,Tabs,Windows,bg,cloneObject,closeContainerPopup,closeNewTabShortcutsPopup,closePanelPopup,closePreview,closePreviewInline,closePreviewPopup,closeSiteConfigPopup,connectTo,createGroupUrl,err,favicons_fg_exports,findLastIndex,finishConfirmation,getDomainOf,getFavPlaceholder,getFavicon,getRandomFrom,info,initFavicons,initPopups,ipc_exports,isBookmarksPanel,isHistoryPanel,isNavBtn,isNavPanel,isNavSpace,isTabsPanel,loadFavicons,openPanelPopup,reactive,reactive2,registerActions,resetMode,resetTargetTab,set,setInstanceType,setInstanceType2,setTargetTab,setWinId,setWinId2,setupConnectionListener,setupGlobalMessageListener,sleep,state,translate,uid,updateObject,updateWebReqHandlers}from"../chunk-4KZVVU6Z.js";import"../chunk-FF3JOXTG.js";import{createApp,reactive as reactive8,shallowReactive}from"/vendor/vue.runtime.esm-browser.prod.js";import{defineComponent as _defineComponent29}from"/vendor/vue.runtime.esm-browser.prod.js";import{unref as _unref26,openBlock as _openBlock29,createBlock as _createBlock12,createCommentVNode as _createCommentVNode24,Transition as _Transition4,withCtx as _withCtx11,createVNode as _createVNode15,createElementBlock as _createElementBlock29,vShow as _vShow4,withDirectives as _withDirectives5,renderList as _renderList15,Fragment as _Fragment15,resolveDynamicComponent as _resolveDynamicComponent,createElementVNode as _createElementVNode25,withModifiers as _withModifiers20}from"/vendor/vue.runtime.esm-browser.prod.js";import{ref as ref16,computed as computed19,onMounted as onMounted14,nextTick as nextTick4}from"/vendor/vue.runtime.esm-browser.prod.js";import{defineComponent as _defineComponent}from"/vendor/vue.runtime.esm-browser.prod.js";import{unref as _unref,toDisplayString as _toDisplayString,createElementVNode as _createElementVNode,withModifiers as _withModifiers,openBlock as _openBlock,createElementBlock as _createElementBlock}from"/vendor/vue.runtime.esm-browser.prod.js";var _hoisted_1={class:"msg"},_hoisted_2={class:"ctrls"},popup_confirm_default=_defineComponent({__name:"popup.confirm",setup(__props){return(_ctx,_cache)=>(_openBlock(),_createElementBlock("div",{class:"Confirm popup-container",onClick:_cache[3]||(_cache[3]=$event=>finishConfirmation(!1))},[_createElementVNode("div",{class:"popup",onClick:_cache[2]||(_cache[2]=_withModifiers(()=>{},["stop"]))},[_createElementVNode("h2",null,_toDisplayString(_unref(translate)("confirm.warn_title")),1),_createElementVNode("div",_hoisted_1,_toDisplayString(reactive.confirm?.msg),1),_createElementVNode("div",_hoisted_2,[_createElementVNode("div",{class:"btn",onClick:_cache[0]||(_cache[0]=$event=>finishConfirmation(!0))},_toDisplayString(_unref(translate)("btn.yes")),1),_createElementVNode("div",{class:"btn",onClick:_cache[1]||(_cache[1]=$event=>finishConfirmation(!1))},_toDisplayString(_unref(translate)("btn.no")),1)])])]))}});import{defineComponent as _defineComponent2}from"/vendor/vue.runtime.esm-browser.prod.js";import{createElementVNode as _createElementVNode2,openBlock as _openBlock2,createElementBlock as _createElementBlock2,toDisplayString as _toDisplayString2,renderList as _renderList,Fragment as _Fragment,unref as _unref2,createCommentVNode as _createCommentVNode,Transition as _Transition,withCtx as _withCtx,createVNode as _createVNode,withModifiers as _withModifiers2,normalizeClass as _normalizeClass,normalizeStyle as _normalizeStyle,vShow as _vShow,withDirectives as _withDirectives}from"/vendor/vue.runtime.esm-browser.prod.js";import{ref,reactive as reactive3,computed,nextTick,onMounted}from"/vendor/vue.runtime.esm-browser.prod.js";var _hoisted_12=["data-active"],_hoisted_22={class:"container"},_hoisted_3={key:0,class:"sub-menu-box"},_hoisted_4={class:"sub-menu"},_hoisted_5={class:"scroll-box"},_hoisted_6=_createElementVNode2("div",{class:"icon-box"},[_createElementVNode2("svg",{class:"icon -rotate90"},[_createElementVNode2("use",{"xlink:href":"#icon_expand"})])],-1),_hoisted_7={class:"label -header"},_hoisted_8=_createElementVNode2("div",{class:"opt","data-separator":!0},null,-1),_hoisted_9=["data-selected","data-separator","data-inactive","data-color","title","onMousedown","onMouseup"],_hoisted_10={key:0,class:"icon-box"},_hoisted_11=["data-img"],_hoisted_122=["xlink:href"],_hoisted_13=["src"],_hoisted_14={key:2,class:"icon"},_hoisted_15=["xlink:href"],_hoisted_16={class:"label"},_hoisted_17=["data-width","data-selected","data-separator","data-color","data-inactive","title","onMousedown","onMouseup"],_hoisted_18=["data-img"],_hoisted_19=["xlink:href"],_hoisted_20=["src"],_hoisted_21={key:2,class:"icon"},_hoisted_222=["xlink:href"],_hoisted_23=["data-selected","data-separator","data-inactive","data-color","title","onMousedown","onMouseup"],_hoisted_24={key:0,class:"icon-box"},_hoisted_25=["data-img"],_hoisted_26=["xlink:href"],_hoisted_27=["src"],_hoisted_28={key:2,class:"icon"},_hoisted_29=["xlink:href"],_hoisted_30={class:"label"},_hoisted_31={key:1,class:"icon-box"},_hoisted_32=_createElementVNode2("svg",{class:"icon -rotate-90"},[_createElementVNode2("use",{"xlink:href":"#icon_expand"})],-1),_hoisted_33=[_hoisted_32],_hoisted_34=["data-active","onMouseup"],_hoisted_35={key:0,class:"flag-icon"},_hoisted_36=["xlink:href"],_hoisted_37=["src"],_hoisted_38={class:"container"},_hoisted_39={key:0,class:"sub-menu-box"},_hoisted_40={class:"sub-menu"},_hoisted_41={class:"scroll-box"},_hoisted_42=_createElementVNode2("div",{class:"icon-box"},[_createElementVNode2("svg",{class:"icon -rotate90"},[_createElementVNode2("use",{"xlink:href":"#icon_expand"})])],-1),_hoisted_43={class:"label -header"},_hoisted_44=_createElementVNode2("div",{class:"opt","data-separator":!0},null,-1),_hoisted_45=["data-selected","data-separator","data-inactive","data-color","title","onMousedown","onMouseup"],_hoisted_46={key:0,class:"icon-box"},_hoisted_47=["data-img"],_hoisted_48=["xlink:href"],_hoisted_49=["src"],_hoisted_50={key:2,class:"icon"},_hoisted_51=["xlink:href"],_hoisted_52={class:"label"},_hoisted_53=["data-width","data-selected","data-separator","data-color","data-inactive","title","onMousedown","onMouseup"],_hoisted_54=["data-img"],_hoisted_55=["xlink:href"],_hoisted_56=["src"],_hoisted_57={key:2,class:"icon"},_hoisted_58=["xlink:href"],_hoisted_59=["data-selected","data-separator","data-inactive","data-color","title","onMousedown","onMouseup"],_hoisted_60={key:0,class:"icon-box"},_hoisted_61=["data-img"],_hoisted_62=["xlink:href"],_hoisted_63=["src"],_hoisted_64={key:2,class:"icon"},_hoisted_65=["xlink:href"],_hoisted_66={class:"label"},_hoisted_67={key:1,class:"icon-box"},_hoisted_68=_createElementVNode2("svg",{class:"icon -rotate-90"},[_createElementVNode2("use",{"xlink:href":"#icon_expand"})],-1),_hoisted_69=[_hoisted_68],_hoisted_70=["data-active","onMouseup"],_hoisted_71={key:0,class:"flag-icon"},_hoisted_72=["xlink:href"],_hoisted_73=["src"],popup_context_menu_default=_defineComponent2({__name:"popup.context-menu",setup(__props,{expose:__expose}){let lastPhase="tack",tickEl=ref(null),tackEl=ref(null),state2=reactive3({tickActive:!1,tackActive:!1,tickBlocks:[],tackBlocks:[],tickPosStyle:{transform:"translateY(0px) translateX(0px)",bottom:""},tackPosStyle:{transform:"translateY(0px) translateX(0px)",bottom:""},selected:-1,sub:null}),isActive=computed(()=>state2.tickActive||state2.tackActive),tickAll=computed(()=>state2.tickBlocks.reduce((a,v)=>a.concat(v.opts),[])),tackAll=computed(()=>state2.tackBlocks.reduce((a,v)=>a.concat(v.opts),[]));onMounted(()=>{Menu.onOpen((blocks,x=0,y=0)=>{let boxH=document.body.offsetHeight;state2.selected=-1,lastPhase==="tack"?(state2.tickBlocks=blocks,state2.tickActive=!0,state2.tackActive=!1,lastPhase="tick",nextTick(()=>{if(!tickEl.value)return;let isLowerThanViewport=tickEl.value.offsetHeight<boxH,isAbovePointer=tickEl.value.offsetHeight+y>=boxH&&isLowerThanViewport;y=getY(tickEl.value.offsetHeight,y,isAbovePointer),x=getX(tickEl.value.offsetWidth,x),state2.tickPosStyle.transform=`translateY(${y}px) translateX(${x}px)`,state2.tickPosStyle.bottom=isAbovePointer?"0px":""})):(state2.tackBlocks=blocks,state2.tackActive=!0,state2.tickActive=!1,lastPhase="tack",nextTick(()=>{if(!tackEl.value)return;let isLowerThanViewport=tackEl.value.offsetHeight<boxH,isAbovePointer=tackEl.value.offsetHeight+y>=boxH&&isLowerThanViewport;y=getY(tackEl.value.offsetHeight,y,isAbovePointer),x=getX(tackEl.value.offsetWidth,x),state2.tackPosStyle.transform=`translateY(${y}px) translateX(${x}px)`,state2.tackPosStyle.bottom=isAbovePointer?"0px":""}))}),Menu.onClose(()=>{state2.tickActive=!1,state2.tackActive=!1,state2.sub=null})});function onMouseDown(e,opt){Mouse.setTarget("menu.option",opt.label)}function onMouseUp(e,opt){Mouse.isTarget("menu.option",opt.label)&&(e.button===0&&!e.altKey?activateOption(opt):(e.button===1||e.button===0&&e.altKey)&&activateOption(opt,!0))}let scrollConf={behavior:"smooth",top:0};function scrollToOption(opt){let query=`.opt[title="${opt.tooltip??opt.label}"]`,optEl=document.querySelector(query);if(!optEl)return;let scrollEl;if(optEl.parentElement?.className==="scroll-box")scrollEl=optEl.parentElement;else{let query2=`.CtxMenu ${state2.tickActive?".tick":".tack"} .scroll-container`;scrollEl=document.querySelector(query2)}if(!scrollEl)return;let sR=scrollEl.getBoundingClientRect(),bR=optEl.getBoundingClientRect(),pH=scrollEl.offsetHeight,pS=scrollEl.scrollTop,bH=optEl.offsetHeight,bY=bR.top-sR.top+pS;if(bY<pS+PRE_SCROLL){if(pS>0){let y=bY-PRE_SCROLL;y<0&&(y=0),scrollConf.top=y,scrollEl.scroll(scrollConf)}}else bY+bH>pS+pH-PRE_SCROLL&&(scrollConf.top=bY+bH-pH+PRE_SCROLL,scrollEl.scroll(scrollConf))}function selectOption(dir){if(!dir)return;let opts;if(state2.sub?opts=state2.sub.opts:opts=state2.tickActive?tickAll.value:tackAll.value,state2.selected<0){dir>0?state2.selected=0:state2.selected=opts.length-1,scrollToOption(opts[state2.selected]);return}if(state2.selected>=0){let i=state2.selected+dir;for(;opts[i]&&(opts[i].type==="separator"||opts[i].inactive);)i+=dir;if(i<0||i>=opts.length)return;state2.selected=i,scrollToOption(opts[i])}}function activateOption(opt,altMode){if(!opt){if(state2.selected<0)return;let opts;if(state2.sub?opts=state2.sub.opts:opts=state2.tickActive?tickAll.value:tackAll.value,opt=opts[state2.selected],!opt)return}return opt.inactive?!1:(altMode&&opt.onAltClick&&opt.onAltClick(),!altMode&&opt.onClick&&opt.onClick(),opt.sub?(state2.selected=-1,state2.sub={type:"list",name:opt.label,opts:opt.sub},!1):(Menu.close(),Selection.resetSelection(),!opt.keepSearching&&Search.rawValue&&Search.stop(),!0))}function closeSubMenu(){state2.sub=null}function getX(menuWidth,x){let maxX=Sidebar.width-menuWidth-2;return x>maxX?maxX:x}function getY(menuH,y,isAbovePointer){let boxH=document.body.offsetHeight;return menuH>=boxH?0:isAbovePointer&&menuH>y?boxH-16:y}function btnWidth(opts){let len=opts.reduce((a,v)=>v.constructor===String?a:a+1,0);return len<=5?"norm":len===6?"3":len===8?"4":"wrap"}function isSelected(opt){let opts;return state2.sub?opts=state2.sub.opts:opts=state2.tickActive?tickAll.value:tackAll.value,opts[state2.selected]===opt}let publicInterface={selectOption,activateOption};return __expose(publicInterface),Menu.registerComponent(publicInterface),(_ctx,_cache)=>(_openBlock2(),_createElementBlock2("div",{class:"CtxMenu","data-active":isActive.value,onMousedown:_cache[2]||(_cache[2]=_withModifiers2(()=>{},["stop"])),onMouseup:_cache[3]||(_cache[3]=_withModifiers2(()=>{},["stop"]))},[_createVNode(_Transition,{name:"menu",type:"transition",persisted:""},{default:_withCtx(()=>[_withDirectives(_createElementVNode2("div",_hoisted_22,[_createElementVNode2("div",{class:"box tick",ref_key:"tickEl",ref:tickEl,style:_normalizeStyle(state2.tickPosStyle)},[_createVNode(scroll_box_default,null,{default:_withCtx(()=>[_createVNode(_Transition,{name:"sub-menu",type:"transition"},{default:_withCtx(()=>[state2.sub?(_openBlock2(),_createElementBlock2("div",_hoisted_3,[_createElementVNode2("div",_hoisted_4,[_createElementVNode2("div",_hoisted_5,[_createElementVNode2("div",{class:"opt",onClick:closeSubMenu},[_hoisted_6,_createElementVNode2("div",_hoisted_7,_toDisplayString2(state2.sub.name),1)]),_hoisted_8,(_openBlock2(!0),_createElementBlock2(_Fragment,null,_renderList(state2.sub.opts,opt=>(_openBlock2(),_createElementBlock2("div",{class:"opt","data-selected":isSelected(opt),"data-separator":opt.type==="separator","data-inactive":opt.inactive,"data-color":opt.color?opt.color:!1,title:opt.tooltip??opt.label,onMousedown:$event=>onMouseDown($event,opt),onMouseup:$event=>onMouseUp($event,opt)},[_unref2(Settings).state.ctxMenuRenderIcons?(_openBlock2(),_createElementBlock2("div",_hoisted_10,[opt.badge?(_openBlock2(),_createElementBlock2("svg",{key:0,class:"badge","data-img":!!opt.img},[_createElementVNode2("use",{"xlink:href":"#"+opt.badge},null,8,_hoisted_122)],8,_hoisted_11)):_createCommentVNode("v-if",!0),opt.img?(_openBlock2(),_createElementBlock2("img",{key:1,class:"icon",src:opt.img},null,8,_hoisted_13)):opt.icon?(_openBlock2(),_createElementBlock2("svg",_hoisted_14,[_createElementVNode2("use",{"xlink:href":"#"+opt.icon},null,8,_hoisted_15)])):_createCommentVNode("v-if",!0)])):_createCommentVNode("v-if",!0),_createElementVNode2("div",_hoisted_16,_toDisplayString2(opt.label),1)],40,_hoisted_9))),256))])])])):_createCommentVNode("v-if",!0)]),_:1}),(_openBlock2(!0),_createElementBlock2(_Fragment,null,_renderList(state2.tickBlocks,group=>(_openBlock2(),_createElementBlock2("div",{class:_normalizeClass(`${group.type}-group`)},[group.type==="inline"?(_openBlock2(!0),_createElementBlock2(_Fragment,{key:0},_renderList(group.opts,opt=>(_openBlock2(),_createElementBlock2("div",{class:"icon-opt","data-width":btnWidth(group.opts),"data-selected":isSelected(opt),"data-separator":opt.type==="separator","data-color":opt.color?opt.color:!1,"data-inactive":opt.inactive,title:opt.tooltip??opt.label,onMousedown:$event=>onMouseDown($event,opt),onMouseup:$event=>onMouseUp($event,opt)},[opt.badge?(_openBlock2(),_createElementBlock2("svg",{key:0,class:"badge","data-img":!!opt.img},[_createElementVNode2("use",{"xlink:href":"#"+opt.badge},null,8,_hoisted_19)],8,_hoisted_18)):_createCommentVNode("v-if",!0),opt.img?(_openBlock2(),_createElementBlock2("img",{key:1,class:"icon",src:opt.img},null,8,_hoisted_20)):(_openBlock2(),_createElementBlock2("svg",_hoisted_21,[_createElementVNode2("use",{"xlink:href":"#"+opt.icon},null,8,_hoisted_222)]))],40,_hoisted_17))),256)):_createCommentVNode("v-if",!0),group.type==="list"?(_openBlock2(!0),_createElementBlock2(_Fragment,{key:1},_renderList(group.opts,opt=>(_openBlock2(),_createElementBlock2("div",{class:"opt","data-selected":isSelected(opt),"data-separator":opt.type==="separator","data-inactive":opt.inactive,"data-color":opt.color?opt.color:!1,title:opt.tooltip??opt.label,onMousedown:$event=>onMouseDown($event,opt),onMouseup:$event=>onMouseUp($event,opt)},[_unref2(Settings).state.ctxMenuRenderIcons?(_openBlock2(),_createElementBlock2("div",_hoisted_24,[opt.badge?(_openBlock2(),_createElementBlock2("svg",{key:0,class:"badge","data-img":!!opt.img},[_createElementVNode2("use",{"xlink:href":"#"+opt.badge},null,8,_hoisted_26)],8,_hoisted_25)):_createCommentVNode("v-if",!0),opt.img?(_openBlock2(),_createElementBlock2("img",{key:1,class:"icon",src:opt.img},null,8,_hoisted_27)):opt.icon?(_openBlock2(),_createElementBlock2("svg",_hoisted_28,[_createElementVNode2("use",{"xlink:href":"#"+opt.icon},null,8,_hoisted_29)])):_createCommentVNode("v-if",!0)])):_createCommentVNode("v-if",!0),_createElementVNode2("div",_hoisted_30,_toDisplayString2(opt.label),1),opt.sub?(_openBlock2(),_createElementBlock2("div",_hoisted_31,_hoisted_33)):_createCommentVNode("v-if",!0),opt.flag?.icon?(_openBlock2(),_createElementBlock2("div",{key:2,class:"flag-btn","data-active":!!opt.flag.active,onMousedown:_cache[0]||(_cache[0]=_withModifiers2(()=>{},["stop"])),onMouseup:_withModifiers2($event=>opt.flag?.onClick?.(opt),["stop"])},[opt.flag.icon.startsWith("#")?(_openBlock2(),_createElementBlock2("svg",_hoisted_35,[_createElementVNode2("use",{"xlink:href":opt.flag.icon},null,8,_hoisted_36)])):(_openBlock2(),_createElementBlock2("img",{key:1,class:"flag-icon",src:opt.flag.icon},null,8,_hoisted_37))],40,_hoisted_34)):_createCommentVNode("v-if",!0)],40,_hoisted_23))),256)):_createCommentVNode("v-if",!0)],2))),256))]),_:1})],4)],512),[[_vShow,state2.tickActive]])]),_:1}),_createVNode(_Transition,{name:"menu",type:"transition",persisted:""},{default:_withCtx(()=>[_withDirectives(_createElementVNode2("div",_hoisted_38,[_createElementVNode2("div",{class:"box tack",ref_key:"tackEl",ref:tackEl,style:_normalizeStyle(state2.tackPosStyle)},[_createVNode(scroll_box_default,null,{default:_withCtx(()=>[_createVNode(_Transition,{name:"sub-menu",type:"transition"},{default:_withCtx(()=>[state2.sub?(_openBlock2(),_createElementBlock2("div",_hoisted_39,[_createElementVNode2("div",_hoisted_40,[_createElementVNode2("div",_hoisted_41,[_createElementVNode2("div",{class:"opt",onClick:closeSubMenu},[_hoisted_42,_createElementVNode2("div",_hoisted_43,_toDisplayString2(state2.sub.name),1)]),_hoisted_44,(_openBlock2(!0),_createElementBlock2(_Fragment,null,_renderList(state2.sub.opts,opt=>(_openBlock2(),_createElementBlock2("div",{class:"opt","data-selected":isSelected(opt),"data-separator":opt.type==="separator","data-inactive":opt.inactive,"data-color":opt.color?opt.color:!1,title:opt.tooltip??opt.label,onMousedown:$event=>onMouseDown($event,opt),onMouseup:$event=>onMouseUp($event,opt)},[_unref2(Settings).state.ctxMenuRenderIcons?(_openBlock2(),_createElementBlock2("div",_hoisted_46,[opt.badge?(_openBlock2(),_createElementBlock2("svg",{key:0,class:"badge","data-img":!!opt.img},[_createElementVNode2("use",{"xlink:href":"#"+opt.badge},null,8,_hoisted_48)],8,_hoisted_47)):_createCommentVNode("v-if",!0),opt.img?(_openBlock2(),_createElementBlock2("img",{key:1,class:"icon",src:opt.img},null,8,_hoisted_49)):opt.icon?(_openBlock2(),_createElementBlock2("svg",_hoisted_50,[_createElementVNode2("use",{"xlink:href":"#"+opt.icon},null,8,_hoisted_51)])):_createCommentVNode("v-if",!0)])):_createCommentVNode("v-if",!0),_createElementVNode2("div",_hoisted_52,_toDisplayString2(opt.label),1)],40,_hoisted_45))),256))])])])):_createCommentVNode("v-if",!0)]),_:1}),(_openBlock2(!0),_createElementBlock2(_Fragment,null,_renderList(state2.tackBlocks,group=>(_openBlock2(),_createElementBlock2("div",{class:_normalizeClass(`${group.type}-group`)},[group.type==="inline"?(_openBlock2(!0),_createElementBlock2(_Fragment,{key:0},_renderList(group.opts,opt=>(_openBlock2(),_createElementBlock2("div",{class:"icon-opt","data-width":btnWidth(group.opts),"data-selected":isSelected(opt),"data-separator":opt.type==="separator","data-color":opt.color?opt.color:!1,"data-inactive":opt.inactive,title:opt.tooltip??opt.label,onMousedown:$event=>onMouseDown($event,opt),onMouseup:$event=>onMouseUp($event,opt)},[opt.badge?(_openBlock2(),_createElementBlock2("svg",{key:0,class:"badge","data-img":!!opt.img},[_createElementVNode2("use",{"xlink:href":"#"+opt.badge},null,8,_hoisted_55)],8,_hoisted_54)):_createCommentVNode("v-if",!0),opt.img?(_openBlock2(),_createElementBlock2("img",{key:1,class:"icon",src:opt.img},null,8,_hoisted_56)):(_openBlock2(),_createElementBlock2("svg",_hoisted_57,[_createElementVNode2("use",{"xlink:href":"#"+opt.icon},null,8,_hoisted_58)]))],40,_hoisted_53))),256)):_createCommentVNode("v-if",!0),group.type==="list"?(_openBlock2(!0),_createElementBlock2(_Fragment,{key:1},_renderList(group.opts,(opt,i)=>(_openBlock2(),_createElementBlock2("div",{class:"opt",key:opt.label,"data-selected":isSelected(opt),"data-separator":opt.type==="separator","data-inactive":opt.inactive,"data-color":opt.color?opt.color:!1,title:opt.tooltip??opt.label,onMousedown:$event=>onMouseDown($event,opt),onMouseup:$event=>onMouseUp($event,opt)},[_unref2(Settings).state.ctxMenuRenderIcons?(_openBlock2(),_createElementBlock2("div",_hoisted_60,[opt.badge?(_openBlock2(),_createElementBlock2("svg",{key:0,class:"badge","data-img":!!opt.img},[_createElementVNode2("use",{"xlink:href":"#"+opt.badge},null,8,_hoisted_62)],8,_hoisted_61)):_createCommentVNode("v-if",!0),opt.img?(_openBlock2(),_createElementBlock2("img",{key:1,class:"icon",src:opt.img},null,8,_hoisted_63)):opt.icon?(_openBlock2(),_createElementBlock2("svg",_hoisted_64,[_createElementVNode2("use",{"xlink:href":"#"+opt.icon},null,8,_hoisted_65)])):_createCommentVNode("v-if",!0)])):_createCommentVNode("v-if",!0),_createElementVNode2("div",_hoisted_66,_toDisplayString2(opt.label),1),opt.sub?(_openBlock2(),_createElementBlock2("div",_hoisted_67,_hoisted_69)):_createCommentVNode("v-if",!0),opt.flag?.icon?(_openBlock2(),_createElementBlock2("div",{key:2,class:"flag-btn","data-active":!!opt.flag.active,onMousedown:_cache[1]||(_cache[1]=_withModifiers2(()=>{},["stop"])),onMouseup:_withModifiers2($event=>opt.flag?.onClick?.(opt),["stop"])},[opt.flag.icon.startsWith("#")?(_openBlock2(),_createElementBlock2("svg",_hoisted_71,[_createElementVNode2("use",{"xlink:href":opt.flag.icon},null,8,_hoisted_72)])):(_openBlock2(),_createElementBlock2("img",{key:1,class:"flag-icon",src:opt.flag.icon},null,8,_hoisted_73))],40,_hoisted_70)):_createCommentVNode("v-if",!0)],40,_hoisted_59))),128)):_createCommentVNode("v-if",!0)],2))),256))]),_:1})],4)],512),[[_vShow,state2.tackActive]])]),_:1})],40,_hoisted_12))}});import{defineComponent as _defineComponent3}from"/vendor/vue.runtime.esm-browser.prod.js";import{unref as _unref3,toDisplayString as _toDisplayString3,openBlock as _openBlock3,createElementBlock as _createElementBlock3,createCommentVNode as _createCommentVNode2}from"/vendor/vue.runtime.esm-browser.prod.js";var _hoisted_110={class:"drag-image",id:"drag_image"},_hoisted_210={key:0,class:"drag-image-title"},_hoisted_310={key:1,class:"drag-image-info"},dnd_tooltip_default=_defineComponent3({__name:"dnd-tooltip",setup(__props){return(_ctx,_cache)=>(_openBlock3(),_createElementBlock3("div",_hoisted_110,[_unref3(DnD).reactive.dragTooltipTitle?(_openBlock3(),_createElementBlock3("div",_hoisted_210,_toDisplayString3(_unref3(DnD).reactive.dragTooltipTitle),1)):_createCommentVNode2("v-if",!0),_unref3(DnD).reactive.dragTooltipInfo?(_openBlock3(),_createElementBlock3("div",_hoisted_310,_toDisplayString3(_unref3(DnD).reactive.dragTooltipInfo),1)):_createCommentVNode2("v-if",!0)]))}});import{defineComponent as _defineComponent5}from"/vendor/vue.runtime.esm-browser.prod.js";import{unref as _unref5,renderList as _renderList2,Fragment as _Fragment2,openBlock as _openBlock5,createElementBlock as _createElementBlock5,createVNode as _createVNode2}from"/vendor/vue.runtime.esm-browser.prod.js";import{computed as computed3}from"/vendor/vue.runtime.esm-browser.prod.js";import{defineComponent as _defineComponent4}from"/vendor/vue.runtime.esm-browser.prod.js";import{unref as _unref4,createElementVNode as _createElementVNode3,normalizeStyle as _normalizeStyle2,openBlock as _openBlock4,createElementBlock as _createElementBlock4,createCommentVNode as _createCommentVNode3,withModifiers as _withModifiers3,vShow as _vShow2,withDirectives as _withDirectives2,toDisplayString as _toDisplayString4,vModelText as _vModelText,createStaticVNode as _createStaticVNode}from"/vendor/vue.runtime.esm-browser.prod.js";import{computed as computed2}from"/vendor/vue.runtime.esm-browser.prod.js";var _hoisted_111=["id","data-pin","data-active","data-loading","data-pending","data-selected","data-audible","data-muted","data-paused","data-discarded","data-updated","data-lvl","data-group","data-parent","data-folded","data-color","data-colorized","data-unread","data-edit","data-preview","title","draggable"],_hoisted_211=["data-dnd-id"],_hoisted_311={class:"body"},_hoisted_410={key:1,class:"flash-fx"},_hoisted_510={key:2,class:"unread-mark"},_hoisted_610=["src"],_hoisted_74={key:1,class:"fav-icon"},_hoisted_82=["xlink:href"],_hoisted_92=_createElementVNode3("svg",{class:"exp-icon"},[_createElementVNode3("use",{"xlink:href":"#icon_expand"})],-1),_hoisted_102=[_hoisted_92],_hoisted_112=_createElementVNode3("div",{class:"badge"},null,-1),_hoisted_123={key:3,class:"progress-spinner"},_hoisted_132={key:4,class:"progress-spinner"},_hoisted_142=_createElementVNode3("use",{"xlink:href":"#icon_hourglass"},null,-1),_hoisted_152=[_hoisted_142],_hoisted_162={key:5,class:"child-count"},_hoisted_172=_createStaticVNode('<svg class="audio-icon -loud"><use xlink:href="#icon_loud_badge"></use></svg><svg class="audio-icon -mute"><use xlink:href="#icon_mute_badge"></use></svg><svg class="audio-icon -pause"><use xlink:href="#icon_pause_12"></use></svg>',3),_hoisted_202=[_hoisted_172],_hoisted_212={key:4,class:"t-box"},_hoisted_223={key:1,class:"title"},_hoisted_232=_createElementVNode3("svg",{class:"close-icon"},[_createElementVNode3("use",{"xlink:href":"#icon_remove"})],-1),_hoisted_242=[_hoisted_232],_hoisted_252={key:6,class:"ctx"},tab_default=_defineComponent4({__name:"tab",props:{tabId:{},iconOnly:{type:Boolean}},setup(__props){let props=__props,tab=Tabs.byId[props.tabId],tabColor=computed2(()=>tab.reactive.customColor?RGB_COLORS[tab.customColor]:Settings.state.colorizeTabsBranches&&tab.reactive.branchColor&&(tab.reactive.isParent||tab.reactive.lvl>0)?tab.reactive.branchColor:Settings.state.colorizeTabs&&tab.reactive.color?tab.reactive.color:""),favPlaceholder=computed2(()=>tab.reactive.warn?"#icon_warn":getFavPlaceholder(tab.reactive.url));function shouldBeConvertedToGroup(){return tab.isParent&&!tab.folded&&!tab.isGroup&&Settings.state.autoGroupOnClose&&(tab.lvl===0||!Settings.state.autoGroupOnClose0Lvl)}function convertToGroup(){browser.tabs.update(tab.id,{url:createGroupUrl(tab.title)}).catch(()=>{})}let closeLock=!1,tempLockCloseBtnTimeout;function tempLockCloseBtn(){closeLock=!0,clearTimeout(tempLockCloseBtnTimeout),tempLockCloseBtnTimeout=setTimeout(()=>{closeLock=!1},1e3)}function onMouseDownClose(e){if(!closeLock){if(Mouse.setTarget("tab.close",tab.id),Menu.isOpen){Menu.close();return}if(Tabs.editableTabId===tab.id)tab.reactive.customTitle=tab.title;else if(e.button===0){if(shouldBeConvertedToGroup())return convertToGroup();Tabs.removeTabs([tab.id])}else if(e.button===1){if(Settings.state.tabCloseMiddleClick==="close"){if(shouldBeConvertedToGroup())return convertToGroup();Tabs.removeTabs([tab.id])}else Settings.state.tabCloseMiddleClick==="discard"&&Tabs.discardTabs([tab.id]);e.preventDefault()}else e.button===2&&Tabs.removeBranches([tab.id]);tempLockCloseBtn()}}function onMouseUpClose(e){Mouse.resetTarget(),Mouse.stopLongClick(),Mouse.stopMultiSelection(),Selection.resetSelection()}function onMouseDown(e){if(Mouse.setTarget("tab",tab.id),Settings.state.previewTabs&&(clearTimeout(state.mouseEnterTimeout),(state.mode===3||state.mode!==1&&state.status===1)&&closePreviewPopup()),!(Menu.isOpen&&(Menu.close(),e.button===0))&&!tab.reactive.customTitleEdit)if(e.button===0){if(e.ctrlKey){tab.sel?Selection.deselectTab(tab.id):Selection.selectTab(tab.id);return}if(e.shiftKey){Settings.state.shiftSelAct&&!Selection.isSet()&&Selection.selectTab(Tabs.activeId),Selection.isSet()?tab&&Selection.selectTabsRange(tab):Selection.selectTab(tab.id),e.preventDefault();return}Selection.isSet()&&!tab.sel&&Selection.resetSelection(),!Selection.isSet()&&!Settings.state.activateOnMouseUp&&activate(),Mouse.startLongClick(e,"tab",tab.id,longClickFeedback)}else if(e.button===1){e.preventDefault(),Mouse.blockWheel();let selectedTabs=Selection.isTabs()?Selection.get():[];if(Selection.resetSelection(),selectedTabs.includes(tab.id)||selectedTabs.push(tab.id),e.ctrlKey){if(Settings.state.tabMiddleClickCtrl==="discard"){Tabs.discardTabs(selectedTabs);return}else if(Settings.state.tabMiddleClickCtrl==="duplicate"){Tabs.duplicateTabs([tab.id]);return}else if(Settings.state.tabMiddleClickCtrl==="dup_child"){Tabs.duplicateTabs([tab.id],!0);return}else if(Settings.state.tabMiddleClickCtrl==="edit_title"){Tabs.editTabTitle([tab.id]);return}}if(e.shiftKey){if(Settings.state.tabMiddleClickShift==="discard"){Tabs.discardTabs(selectedTabs);return}else if(Settings.state.tabMiddleClickShift==="duplicate"){Tabs.duplicateTabs([tab.id]);return}else if(Settings.state.tabMiddleClickShift==="dup_child"){Tabs.duplicateTabs([tab.id],!0);return}else if(Settings.state.tabMiddleClickShift==="edit_title"){Tabs.editTabTitle([tab.id]);return}}Settings.state.multipleMiddleClose&&Settings.state.tabMiddleClick==="close"?Mouse.startMultiSelection(e,tab.id,selectedTabs):Settings.state.tabMiddleClick==="close"?shouldBeConvertedToGroup()?convertToGroup():Tabs.removeTabs(selectedTabs):Settings.state.tabMiddleClick==="discard"?Tabs.discardTabs(selectedTabs):Settings.state.tabMiddleClick==="duplicate"?Tabs.duplicateTabs([tab.id]):Settings.state.tabMiddleClick==="dup_child"&&Tabs.duplicateTabs([tab.id],!0)}else e.button===2&&(!Settings.state.ctxMenuNative&&!tab.sel&&(Selection.resetSelection(),Mouse.startMultiSelection(e,tab.id)),Mouse.startLongClick(e,"tab",tab.id,longClickFeedback))}function longClickFeedback(){Tabs.triggerFlashAnimation(tab)}function onMouseUp(e){let sameTarget=Mouse.isTarget("tab",tab.id),sameTargetType=Mouse.isTarget("tab");if(Mouse.resetTarget(),Mouse.stopLongClick(),Mouse.isLocked())return Mouse.resetClickLock(120);if(!Mouse.longClickApplied&&!tab.reactive.customTitleEdit){if(e.button===0){let withoutMods=!e.ctrlKey&&!e.shiftKey;sameTarget&&(withoutMods&&Selection.resetSelection(),Settings.state.activateOnMouseUp&&withoutMods&&activate(),Settings.state.tabsSecondClickActPrev&&tab.id===Tabs.activeId&&withoutMods&&!activating&&Tabs.tabFlip()),activating=!1}else if(e.button===1){let preselectedTabs=Mouse.stopMultiSelection();if(e.ctrlKey&&Settings.state.tabMiddleClickCtrl!=="none"||e.shiftKey&&Settings.state.tabMiddleClickShift!=="none")return;if(Settings.state.multipleMiddleClose&&Settings.state.tabMiddleClick==="close"&&sameTargetType){Selection.isSet()||select();let selectedTabs=Selection.get();selectedTabs.length===1&&preselectedTabs?.length&&(selectedTabs=preselectedTabs),Tabs.removeTabs(selectedTabs)}}else if(e.button===2){if(e.ctrlKey||e.shiftKey)return;let inMultiSelectionMode=Mouse.multiSelectionMode;if(Mouse.stopMultiSelection(),inMultiSelectionMode&&!Settings.state.autoMenuMultiSel&&Selection.getLength()>1||closeLock||Menu.isBlocked())return;!Selection.isSet()&&!Settings.state.ctxMenuNative&&select(),Settings.state.ctxMenuNative||Menu.open(1,e.clientX,e.clientY)}}}function onCtxMenu(e){if(Mouse.isLocked()||!Settings.state.ctxMenuNative||e.ctrlKey||e.shiftKey||Mouse.longClickApplied){Mouse.resetClickLock(),e.stopPropagation(),e.preventDefault();return}if(!e.ctrlKey&&!e.shiftKey&&!tab.sel&&Selection.resetSelection(),Menu.isBlocked()){e.stopPropagation(),e.preventDefault();return}browser.menus.overrideContext({context:"tab",tabId:tab.id}),Selection.isSet()||select(),Menu.open(1),Mouse.stopLongClick()}function onDoubleClick(){if(tab.reactive.customTitleEdit)return;let dc=Settings.state.tabDoubleClick;dc==="reload"?Tabs.reloadTabs([tab.id]):dc==="duplicate"?Tabs.duplicateTabs([tab.id]):dc==="dup_child"?Tabs.duplicateTabs([tab.id],!0):dc==="pin"?Tabs.repinTabs([tab.id]):dc==="mute"?Tabs.remuteTabs([tab.id]):dc==="clear_cookies"?Tabs.clearTabsCookies([tab.id]):dc==="exp"&&tab.isParent?Tabs.toggleBranch(tab.id):dc==="new_after"?Tabs.createTabAfter(tab.id):dc==="new_child"&&!tab.pinned?Tabs.createChildTab(tab.id):dc==="close"?shouldBeConvertedToGroup()?convertToGroup():Tabs.removeTabs([tab.id]):dc==="edit_title"&&Tabs.editTabTitle([tab.id])}function onDragStart(e){if(Mouse.isLocked()){Mouse.resetClickLock(),e.stopPropagation(),e.preventDefault();return}if(Menu.close(),Selection.isSet()||Selection.selectTabsBranch(tab),Mouse.stopLongClick(),Sidebar.updateBounds(),Settings.state.previewTabs)if(clearTimeout(state.mouseEnterTimeout),clearTimeout(state.mouseLeaveTimeout),state.mode===1)closePreviewInline();else if(state.status===1){e.stopPropagation(),e.preventDefault();return}else closePreviewPopup();let toDrag=[tab.id],dragItems=[],pinned=tab.pinned,uriList=[],links=[],urlTitleList=[];for(let tab2 of Tabs.list)(Settings.state.tabsTree&&!pinned&&toDrag.includes(tab2.parentId)||Selection.includes(tab2.id))&&(uriList.push(tab2.url),links.push(`<a href="${tab2.url}>${tab2.title}</a>`),urlTitleList.push(tab2.url),urlTitleList.push(tab2.title),toDrag.push(tab2.id),dragItems.push({id:tab2.id,url:tab2.url,title:tab2.title,parentId:tab2.parentId,container:tab2.cookieStoreId}));let dragInfo={type:1,items:dragItems,windowId:Windows.id,incognito:Windows.incognito,panelId:tab.panelId,pinnedTabs:pinned,x:e.clientX,y:e.clientY};if(DnD.start(dragInfo,1),e.dataTransfer){let dragImgEl=document.getElementById("drag_image");if(e.dataTransfer.setData("application/x-sidebery-dnd",JSON.stringify(dragInfo)),Settings.state.dndOutside==="data"?!e.altKey:e.altKey){let uris=uriList.join(`\r
`);e.dataTransfer.setData("text/x-moz-url",urlTitleList.join(`\r
`)),e.dataTransfer.setData("text/uri-list",uris),e.dataTransfer.setData("text/plain",uris),e.dataTransfer.setData("text/html",links.join(`\r
`))}dragImgEl&&e.dataTransfer.setDragImage(dragImgEl,-3,-3),e.dataTransfer.effectAllowed="copyMove"}}function onMouseEnter(e){if(Settings.state.tabWarmupOnHover)if(tab.active){let successorTabId=tab.successorTabId;successorTabId&&Tabs.byId[successorTabId]&&browser.tabs.warmup(successorTabId).catch(err2=>err("Tab.onMouseEnter: Warmup successor tab",err2))}else browser.tabs.warmup(tab.id).catch(err2=>err("Tab.onMouseEnter: Warmup hovered tab",err2));Settings.state.previewTabs&&setTargetTab(props.tabId,e.clientY)}function onMouseLeave(){Settings.state.previewTabs&&resetTargetTab(props.tabId)}function onAudioMouseDown(e,tab2){e.button===0?tab2.mediaPaused?Tabs.playTabMedia(tab2.id):Tabs.remuteTabs([tab2.id]):e.button===1?tab2.mediaPaused?Tabs.playTabMedia(tab2.id):Tabs.pauseTabMedia(tab2.id):e.button===2&&tab2.mediaPaused&&(tab2.reactive.mediaPaused=tab2.mediaPaused=!1,Sidebar.updateMediaStateOfPanelDebounced(100,tab2.panelId,tab2))}function select(){!tab.pinned&&tab.isParent&&tab.folded?Selection.selectTabsBranch(tab):Selection.selectTab(tab.id)}let activating=!1;function activate(){Mouse.longClickApplied||(Search.rawValue&&(Search.stop(),Selection.resetSelection()),tab.id!==Tabs.activeId&&(activating=!0,browser.tabs.update(tab.id,{active:!0})))}function onExpandMouseDown(){Mouse.setTarget("tab.expand",tab.id),Settings.state.previewTabs&&(clearTimeout(state.mouseEnterTimeout),state.mode!==1&&state.status===1&&closePreviewPopup())}function onExpandMouseUp(e){let sameTarget=Mouse.isTarget("tab.expand",tab.id);Mouse.resetTarget(),e.button===0&&(e.stopPropagation(),sameTarget&&(Menu.close(),Selection.resetSelection(),Tabs.toggleBranch(tab.id))),e.button===2&&!e.ctrlKey&&!e.shiftKey&&sameTarget&&(Selection.resetSelection(),Selection.selectTabsBranch(tab))}function onError(){tab.reactive.favIconUrl=tab.favIconUrl=void 0}function onCustomTitleBlur(){Tabs.editableTabId=NOID,tab.reactive.customTitleEdit=!1,Tabs.saveCustomTitle(tab.id)}function onCustomTitlteKD(e){let titleEl=e.target;if(e.key==="Enter")e.preventDefault(),titleEl.blur();else if(e.key==="Escape"){let tab2=Tabs.byId[Tabs.editableTabId];tab2&&(titleEl.textContent=tab2.title),titleEl.blur(),e.preventDefault()}}return(_ctx,_cache)=>(_openBlock4(),_createElementBlock4("div",{class:"Tab",id:"tab"+_unref4(tab).id,"data-pin":!!_ctx.iconOnly,"data-active":_unref4(tab).reactive.active,"data-loading":_unref4(tab).reactive.status===_unref4(TabStatus).Loading,"data-pending":_unref4(tab).reactive.status===_unref4(TabStatus).Pending,"data-selected":_unref4(tab).reactive.sel,"data-audible":_unref4(tab).reactive.mediaAudible,"data-muted":_unref4(tab).reactive.mediaMuted,"data-paused":_unref4(tab).reactive.mediaPaused,"data-discarded":_unref4(tab).reactive.discarded,"data-updated":_unref4(tab).reactive.updated,"data-lvl":_unref4(tab).reactive.lvl,"data-group":_unref4(tab).reactive.isGroup,"data-parent":_unref4(tab).reactive.isParent,"data-folded":_unref4(tab).reactive.folded&&!_unref4(Search).reactive.value,"data-color":_unref4(tab).reactive.containerColor,"data-colorized":!!tabColor.value,"data-unread":_unref4(tab).reactive.unread,"data-edit":_unref4(tab).reactive.customTitleEdit,"data-preview":_unref4(tab).reactive.preview,title:_unref4(tab).reactive.tooltip,draggable:!_unref4(tab).reactive.customTitleEdit,onDragstart:onDragStart,onContextmenu:_withModifiers3(onCtxMenu,["stop"]),onMousedown:_withModifiers3(onMouseDown,["stop"]),onMouseup:_withModifiers3(onMouseUp,["stop"]),onMouseenter:_withModifiers3(onMouseEnter,["stop"]),onMouseleave:onMouseLeave,onDblclick:_withModifiers3(onDoubleClick,["prevent","stop"])},[_createElementVNode3("div",{class:"dnd-layer","data-dnd-type":"tab","data-dnd-id":_unref4(tab).id},null,8,_hoisted_211),_createElementVNode3("div",_hoisted_311,[tabColor.value?(_openBlock4(),_createElementBlock4("div",{key:0,class:"color-layer",style:_normalizeStyle2({"--tab-color":tabColor.value})},null,4)):_createCommentVNode3("v-if",!0),_unref4(tab).reactive.flash?(_openBlock4(),_createElementBlock4("div",_hoisted_410)):_createCommentVNode3("v-if",!0),_unref4(tab).reactive.unread?(_openBlock4(),_createElementBlock4("div",_hoisted_510)):_createCommentVNode3("v-if",!0),_createElementVNode3("div",{class:"fav",onDragstart:_cache[1]||(_cache[1]=_withModifiers3(()=>{},["stop","prevent"]))},[_unref4(tab).reactive.favIconUrl?(_openBlock4(),_createElementBlock4("img",{key:0,class:"fav-icon",src:_unref4(tab).reactive.favIconUrl,onError,draggable:"false"},null,40,_hoisted_610)):(_openBlock4(),_createElementBlock4("svg",_hoisted_74,[_createElementVNode3("use",{"xlink:href":favPlaceholder.value},null,8,_hoisted_82)])),_unref4(tab).reactive.isParent?(_openBlock4(),_createElementBlock4("div",{key:2,class:"exp",onDblclick:_cache[0]||(_cache[0]=_withModifiers3(()=>{},["prevent","stop"])),onMousedown:_withModifiers3(onExpandMouseDown,["stop"]),onMouseup:onExpandMouseUp},_hoisted_102,32)):_createCommentVNode3("v-if",!0),_hoisted_112,_unref4(Settings).state.animations?_withDirectives2((_openBlock4(),_createElementBlock4("div",_hoisted_123,null,512)),[[_vShow2,_unref4(tab).reactive.status===_unref4(TabStatus).Loading]]):_withDirectives2((_openBlock4(),_createElementBlock4("svg",_hoisted_132,_hoisted_152,512)),[[_vShow2,_unref4(tab).reactive.status===_unref4(TabStatus).Loading]]),_unref4(tab).reactive.folded&&_unref4(tab).reactive.branchLen?(_openBlock4(),_createElementBlock4("div",_hoisted_162,_toDisplayString4(_unref4(tab).reactive.branchLen),1)):_createCommentVNode3("v-if",!0)],32),_unref4(tab).reactive.mediaAudible||_unref4(tab).reactive.mediaMuted||_unref4(tab).reactive.mediaPaused?(_openBlock4(),_createElementBlock4("div",{key:3,class:"audio",onMousedown:_cache[2]||(_cache[2]=_withModifiers3(()=>{},["stop","prevent"])),onMouseup:_cache[3]||(_cache[3]=_withModifiers3($event=>onAudioMouseDown($event,_unref4(tab)),["stop"]))},_hoisted_202,32)):_createCommentVNode3("v-if",!0),_ctx.iconOnly?_createCommentVNode3("v-if",!0):(_openBlock4(),_createElementBlock4("div",_hoisted_212,[_unref4(tab).reactive.customTitleEdit?_withDirectives2((_openBlock4(),_createElementBlock4("input",{key:0,class:"custom-title-input","onUpdate:modelValue":_cache[4]||(_cache[4]=$event=>_unref4(tab).reactive.customTitle=$event),autocomplete:"off",autocorrect:"off",autocapitalize:"off",spellcheck:"false",tabindex:"-1",onBlur:onCustomTitleBlur,onKeydown:onCustomTitlteKD},null,544)),[[_vModelText,_unref4(tab).reactive.customTitle]]):(_openBlock4(),_createElementBlock4("div",_hoisted_223,_toDisplayString4(_unref4(tab).reactive.customTitle??_unref4(tab).reactive.title),1))])),!_ctx.iconOnly&&_unref4(Settings).state.tabRmBtn!=="none"?(_openBlock4(),_createElementBlock4("div",{key:5,class:"close",onMousedown:_withModifiers3(onMouseDownClose,["stop"]),onMouseup:_withModifiers3(onMouseUpClose,["stop"]),onContextmenu:_cache[5]||(_cache[5]=_withModifiers3(()=>{},["stop","prevent"]))},_hoisted_242,32)):_createCommentVNode3("v-if",!0),_unref4(tab).reactive.containerColor?(_openBlock4(),_createElementBlock4("div",_hoisted_252)):_createCommentVNode3("v-if",!0)])],40,_hoisted_111))}});var _hoisted_113=["data-empty","data-dnd-end","data-dnd-id"],_hoisted_213=["data-targeted"],bar_pinned_tabs_default=_defineComponent5({__name:"bar.pinned-tabs",props:{panel:{}},setup(__props){let props=__props,pinnedTabs=computed3(()=>props.panel?props.panel.reactive.pinnedTabIds:Tabs.reactive.pinnedIds),dropId=computed3(()=>{let tab=Tabs.list[DnD.reactive.dstIndex];return!tab||!tab.pinned||props.panel&&tab.panelId!==props.panel.id?NOID:tab.id}),dropToEnd=computed3(()=>DnD.reactive.dstPin&&dropId.value===NOID),iconOnly=computed3(()=>!(Settings.state.pinnedTabsList&&(Settings.state.pinnedTabsPosition==="panel"||Settings.state.pinnedTabsPosition==="top"))),onWheel=Mouse.getWheelDebouncer(2,e=>{if(Settings.state.pinnedTabsPosition!=="panel"&&Settings.state.scrollThroughTabs!=="none"){let globaly=Settings.state.scrollThroughTabs==="global"!==e.shiftKey,cyclic=Settings.state.scrollThroughTabsCyclic!==e.ctrlKey;e.deltaY>0&&Tabs.switchTab(globaly,cyclic,1,!0),e.deltaY<0&&Tabs.switchTab(globaly,cyclic,-1,!0)}});function onDrop(){DnD.reactive.dstType=1,DnD.reactive.dstPin=!0}return(_ctx,_cache)=>(_openBlock5(),_createElementBlock5("div",{class:"PinnedTabsBar",tabindex:"-1","data-empty":pinnedTabs.value.length===0,"data-dnd-end":dropToEnd.value,"data-dnd-type":"pinned-bar","data-dnd-id":_ctx.panel?.id??_unref5(NOID),onWheel:_cache[0]||(_cache[0]=(...args)=>_unref5(onWheel)&&_unref5(onWheel)(...args)),onDrop},[(_openBlock5(!0),_createElementBlock5(_Fragment2,null,_renderList2(pinnedTabs.value,id=>(_openBlock5(),_createElementBlock5("div",{class:"tab-wrapper",key:id,"data-targeted":_unref5(DnD).reactive.dstPin&&dropId.value===id},[_createVNode2(tab_default,{tabId:id,iconOnly:iconOnly.value},null,8,["tabId","iconOnly"])],8,_hoisted_213))),128))],40,_hoisted_113))}});import{defineComponent as _defineComponent7}from"/vendor/vue.runtime.esm-browser.prod.js";import{renderList as _renderList4,Fragment as _Fragment4,openBlock as _openBlock7,createElementBlock as _createElementBlock7,createElementVNode as _createElementVNode5,createCommentVNode as _createCommentVNode5,createBlock as _createBlock,TransitionGroup as _TransitionGroup,withCtx as _withCtx2,createVNode as _createVNode3,unref as _unref7}from"/vendor/vue.runtime.esm-browser.prod.js";import{computed as computed4,ref as ref2,watch}from"/vendor/vue.runtime.esm-browser.prod.js";import{defineComponent as _defineComponent6}from"/vendor/vue.runtime.esm-browser.prod.js";import{createElementVNode as _createElementVNode4,openBlock as _openBlock6,createElementBlock as _createElementBlock6,createCommentVNode as _createCommentVNode4,toDisplayString as _toDisplayString5,withModifiers as _withModifiers4,renderList as _renderList3,Fragment as _Fragment3,normalizeStyle as _normalizeStyle3,unref as _unref6}from"/vendor/vue.runtime.esm-browser.prod.js";var _hoisted_114=["data-lvl","data-timeout"],_hoisted_214={key:0,class:"icon"},_hoisted_312={key:0},_hoisted_411=["xlink:href"],_hoisted_511=["src"],_hoisted_611={class:"title"},_hoisted_75={key:1,class:"details-list"},_hoisted_83={class:"details-msg"},_hoisted_93=["data-progress-unknown"],_hoisted_103=_createElementVNode4("div",{class:"progress-bar"},[_createElementVNode4("div",{class:"progress-bar-value"})],-1),_hoisted_115=[_hoisted_103],_hoisted_124={key:3,class:"ctrls"},_hoisted_133={class:"label"},_hoisted_143={key:1,class:"separator"},_hoisted_153=["data-icon","title","onClick"],_hoisted_163={key:0},_hoisted_173=["xlink:href"],_hoisted_182={key:1,class:"label"},_hoisted_192=_createElementVNode4("div",{class:"separator"},null,-1),_hoisted_203=["title"],_hoisted_215=_createElementVNode4("svg",{class:"-close"},[_createElementVNode4("use",{"xlink:href":"#icon_close"})],-1),_hoisted_224=[_hoisted_215],popup_notification_default=_defineComponent6({__name:"popup.notification",props:{notification:{},index:{}},setup(__props){let props=__props;function getProgressPercent(info2){return{"--percent":`${info2.progress?.percent??0}%`}}function onMouseDown(){!props.notification.ctrl&&!props.notification.controls&&onHideMouseDown()}function onHideMouseDown(){Notifications.reactive.list.splice(props.index,1),Notifications.reactive.list.length||Notifications.restartTimers(),Notifications.setHiddenRecently()}function onCtrlMouseDown(e,index,cb){e.button===0&&cb&&(cb(),Notifications.reactive.list.splice(index,1),Notifications.setHiddenRecently())}function getTimeoutCSSVar(info2){if(info2.timeout)return{"--timeout":`${info2.timeout+200}ms`}}return(_ctx,_cache)=>_ctx.notification?(_openBlock6(),_createElementBlock6("div",{class:"notification",key:_ctx.notification.id,"data-lvl":_ctx.notification.lvl,"data-timeout":!!_ctx.notification.timer,style:_normalizeStyle3(getTimeoutCSSVar(_ctx.notification)),onMousedown:_cache[4]||(_cache[4]=_withModifiers4($event=>onMouseDown(),["left"]))},[_createElementVNode4("div",{class:"header",onMousedown:_cache[0]||(_cache[0]=_withModifiers4($event=>onHideMouseDown(),["middle"]))},[_ctx.notification.icon?(_openBlock6(),_createElementBlock6("div",_hoisted_214,[_ctx.notification.icon[0]==="#"?(_openBlock6(),_createElementBlock6("svg",_hoisted_312,[_createElementVNode4("use",{"xlink:href":_ctx.notification.icon},null,8,_hoisted_411)])):(_openBlock6(),_createElementBlock6("img",{key:1,src:_ctx.notification.icon},null,8,_hoisted_511))])):_createCommentVNode4("v-if",!0),_createElementVNode4("div",_hoisted_611,_toDisplayString5(_ctx.notification.title),1)],32),_ctx.notification.details?(_openBlock6(),_createElementBlock6("div",{key:0,class:"details",onMousedown:_cache[1]||(_cache[1]=_withModifiers4($event=>onHideMouseDown(),["middle"]))},_toDisplayString5(_ctx.notification.details),33)):_createCommentVNode4("v-if",!0),_ctx.notification.detailsList?.length?(_openBlock6(),_createElementBlock6("div",_hoisted_75,[(_openBlock6(!0),_createElementBlock6(_Fragment3,null,_renderList3(_ctx.notification.detailsList,msg=>(_openBlock6(),_createElementBlock6("div",_hoisted_83,_toDisplayString5(msg),1))),256))])):_createCommentVNode4("v-if",!0),_ctx.notification.progress?(_openBlock6(),_createElementBlock6("div",{key:2,class:"progress","data-progress-unknown":_ctx.notification.progress.percent===-1,style:_normalizeStyle3(getProgressPercent(_ctx.notification))},_hoisted_115,12,_hoisted_93)):_createCommentVNode4("v-if",!0),_ctx.notification.ctrl||_ctx.notification.controls?(_openBlock6(),_createElementBlock6("div",_hoisted_124,[_ctx.notification.ctrl?(_openBlock6(),_createElementBlock6("div",{key:0,class:"ctrl",onClick:_cache[2]||(_cache[2]=$event=>onCtrlMouseDown($event,_ctx.index,_ctx.notification?.callback))},[_createElementVNode4("div",_hoisted_133,_toDisplayString5(_ctx.notification.ctrl),1)])):_createCommentVNode4("v-if",!0),_ctx.notification.ctrl?(_openBlock6(),_createElementBlock6("div",_hoisted_143)):_createCommentVNode4("v-if",!0),(_openBlock6(!0),_createElementBlock6(_Fragment3,null,_renderList3(_ctx.notification.controls,ctrl=>(_openBlock6(),_createElementBlock6(_Fragment3,{key:ctrl.label},[_createElementVNode4("div",{class:"ctrl","data-icon":!!ctrl.icon,title:ctrl.label,onClick:$event=>onCtrlMouseDown($event,_ctx.index,ctrl.callback)},[ctrl.icon?(_openBlock6(),_createElementBlock6("svg",_hoisted_163,[_createElementVNode4("use",{"xlink:href":ctrl.icon},null,8,_hoisted_173)])):ctrl.label?(_openBlock6(),_createElementBlock6("div",_hoisted_182,_toDisplayString5(ctrl.label),1)):_createCommentVNode4("v-if",!0)],8,_hoisted_153),_hoisted_192],64))),128)),_ctx.notification.unconcealed?_createCommentVNode4("v-if",!0):(_openBlock6(),_createElementBlock6("div",{key:2,class:"ctrl","data-icon":"true",title:_unref6(translate)("notif.hide_tooltip"),onClick:_cache[3]||(_cache[3]=$event=>onHideMouseDown())},_hoisted_224,8,_hoisted_203))])):_createCommentVNode4("v-if",!0)],44,_hoisted_114)):_createCommentVNode4("v-if",!0)}});var _hoisted_116={class:"indicators",key:"ind"},_hoisted_216=_createElementVNode5("div",{class:"ring"},null,-1),_hoisted_313=[_hoisted_216],popup_notifications_default=_defineComponent7({__name:"popup.notifications",setup(__props){let activeNotificationIndex=ref2(0),restNotificationsVisible=ref2(!1),activeNotif=computed4(()=>Notifications.reactive.list[activeNotificationIndex.value]??null),restNotifications=computed4(()=>{let pre=Notifications.reactive.list.slice(0,activeNotificationIndex.value),post=Notifications.reactive.list.slice(activeNotificationIndex.value+1);return pre.concat(post)});watch(Notifications.reactive.list,()=>{activeNotificationIndex.value=Notifications.reactive.list.length-1});function onMouseEnter(){showRestNotifications()}function onMouseLeave(){hideRestNotifications()}function showRestNotifications(){clearTimeout(hideRestNotificationsTimeout),restNotificationsVisible.value=!0}let hideRestNotificationsTimeout;function hideRestNotifications(){clearTimeout(hideRestNotificationsTimeout),hideRestNotificationsTimeout=setTimeout(()=>{restNotificationsVisible.value=!1},250)}return(_ctx,_cache)=>(_openBlock7(),_createElementBlock7("div",{class:"Notifications",onMouseenter:_cache[0]||(_cache[0]=$event=>(_unref7(Notifications).resetTimers(),onMouseEnter())),onMouseleave:_cache[1]||(_cache[1]=$event=>(_unref7(Notifications).restartTimers(),onMouseLeave()))},[_createVNode3(_TransitionGroup,{name:"notification",tag:"div"},{default:_withCtx2(()=>[restNotifications.value.length&&!restNotificationsVisible.value?(_openBlock7(),_createElementBlock7("div",_hoisted_116,[(_openBlock7(!0),_createElementBlock7(_Fragment4,null,_renderList4(restNotifications.value.length,i=>(_openBlock7(),_createElementBlock7("div",{class:"indicator",key:i},_hoisted_313))),128))])):_createCommentVNode5("v-if",!0),restNotificationsVisible.value?(_openBlock7(!0),_createElementBlock7(_Fragment4,{key:1},_renderList4(restNotifications.value,(n,i)=>(_openBlock7(),_createBlock(popup_notification_default,{key:n.id,notification:n,index:i},null,8,["notification","index"]))),128)):_createCommentVNode5("v-if",!0),activeNotif.value?(_openBlock7(),_createBlock(popup_notification_default,{key:activeNotif.value.id,notification:activeNotif.value,index:activeNotificationIndex.value},null,8,["notification","index"])):_createCommentVNode5("v-if",!0)]),_:1})],32))}});import{defineComponent as _defineComponent9}from"/vendor/vue.runtime.esm-browser.prod.js";import{unref as _unref9,renderList as _renderList5,Fragment as _Fragment5,openBlock as _openBlock9,createElementBlock as _createElementBlock9,createBlock as _createBlock2,withModifiers as _withModifiers6,createElementVNode as _createElementVNode7,createCommentVNode as _createCommentVNode7,normalizeStyle as _normalizeStyle4,Transition as _Transition2,withCtx as _withCtx3,createVNode as _createVNode4}from"/vendor/vue.runtime.esm-browser.prod.js";import{ref as ref3,computed as computed6,onMounted as onMounted2,watch as watch2}from"/vendor/vue.runtime.esm-browser.prod.js";import{defineComponent as _defineComponent8}from"/vendor/vue.runtime.esm-browser.prod.js";import{unref as _unref8,createElementVNode as _createElementVNode6,openBlock as _openBlock8,createElementBlock as _createElementBlock8,createCommentVNode as _createCommentVNode6,withModifiers as _withModifiers5,toDisplayString as _toDisplayString6,createStaticVNode as _createStaticVNode2}from"/vendor/vue.runtime.esm-browser.prod.js";import{computed as computed5}from"/vendor/vue.runtime.esm-browser.prod.js";var _hoisted_117=["id","data-updated","data-active","data-index","data-color","data-sel","data-empty","data-audible","data-paused","data-muted","data-drop-mode","title"],_hoisted_217=["data-dnd-type","data-dnd-id"],_hoisted_314=["src"],_hoisted_412={key:1,class:"icon"},_hoisted_512=["xlink:href"],_hoisted_612=_createElementVNode6("div",{class:"badge"},null,-1),_hoisted_76=_createStaticVNode2('<svg class="-audible"><use xlink:href="#icon_loud_badge"></use></svg><svg class="-paused"><use xlink:href="#icon_pause_12"></use></svg><svg class="-muted"><use xlink:href="#icon_mute_badge"></use></svg>',3),_hoisted_104=[_hoisted_76],_hoisted_118={class:"name-box"},_hoisted_125={class:"name"},_hoisted_134={key:3,class:"len"},_hoisted_144=["id","data-active","data-index","data-color","data-type","data-sel","data-unloaded","data-drop-mode","title"],_hoisted_154=["data-dnd-type","data-dnd-id"],_hoisted_164={key:0,class:"bookmarks-badge-icon"},_hoisted_174=_createElementVNode6("use",{"xlink:href":"#icon_bookmarks_badge"},null,-1),_hoisted_183=[_hoisted_174],_hoisted_193=["src"],_hoisted_204={key:2,class:"icon"},_hoisted_218=["xlink:href"],_hoisted_225=_createElementVNode6("div",{class:"badge"},null,-1),_hoisted_233={class:"name-box"},_hoisted_243={class:"name"},_hoisted_253={key:3,class:"len"},_hoisted_262=["id","data-type","data-sel","data-drop-mode","title"],_hoisted_272=["data-dnd-type","data-dnd-id"],_hoisted_282=["src"],_hoisted_292={key:1,class:"icon"},_hoisted_302=["xlink:href"],_hoisted_315={class:"name-box"},_hoisted_322={class:"name"},_hoisted_332=["data-type","data-sel","data-drop-mode"],_hoisted_342=["data-dnd-type","data-dnd-id"],nav_item_default=_defineComponent8({__name:"nav-item",props:{item:{},dndType:{},inlineIndex:{}},emits:["dragstart","drop","mousedown","mouseup","contextmenu"],setup(__props,{emit:__emit}){let emit=__emit,props=__props,bookmarksBadge=props.item.type===1&&(props.item.iconSVG!=="icon_bookmarks"||!!props.item.iconIMG),isUpdated=computed5(()=>isTabsPanel(props.item)?Sidebar.reactive.activePanelId!==props.item.id&&props.item.reactive.updated:!1);function dropPointerMode(id){if(id===DnD.items[0]?.id)return"none";let srcIsNavItem=DnD.srcType===31||DnD.srcType===32||DnD.srcType===3,dstIsNavItem=DnD.reactive.dstType===31||DnD.reactive.dstType===32||DnD.reactive.dstType===3,dstId=Sidebar.reactive.nav[DnD.reactive.dstIndex];if(dstIsNavItem&&dstId===id){if(srcIsNavItem){if(DnD.srcIndex!==-1&&DnD.reactive.dstIndex!==-1){if(DnD.reactive.dstIndex<DnD.srcIndex)return"before";if(DnD.reactive.dstIndex===DnD.srcIndex)return"none";if(DnD.reactive.dstIndex>DnD.srcIndex)return"after"}return"before"}else if(DnD.reactive.dstType!==3||id==="add_tp")return"in"}return"none"}function muteTabs(){isNavPanel(props.item)&&isTabsPanel(props.item)&&Tabs.muteAudibleTabsOfPanel(props.item.id)}function unmuteTabs(){isNavPanel(props.item)&&isTabsPanel(props.item)&&Tabs.unmuteAudibleTabsOfPanel(props.item.id)}function pauseMedia(){isNavPanel(props.item)&&isTabsPanel(props.item)&&Tabs.pauseTabsMediaOfPanel(props.item.id)}function playMedia(){isNavPanel(props.item)&&isTabsPanel(props.item)&&Tabs.playTabsMediaOfPanel(props.item.id)}function activateAudibleTab(){if(!isNavPanel(props.item)||!isTabsPanel(props.item))return;let mediaTab,findMedia=t=>t.audible||t.mutedInfo?.muted||t.mediaPaused;if(Settings.state.pinnedTabsPosition==="panel"&&(mediaTab=props.item.pinnedTabs.find(findMedia)),mediaTab||(mediaTab=props.item.tabs.find(findMedia)),!mediaTab)return;let history=Tabs.getActiveTabsHistory(),prevTabId=history.actTabs[history.actTabs.length-1];mediaTab.id!==Tabs.activeId?browser.tabs.update(mediaTab.id,{active:!0}):prevTabId&&browser.tabs.update(prevTabId,{active:!0})}function onAudioMouseDown(e,panel){e.stopPropagation(),panel.reactive.mediaState===1?e.button===0?muteTabs():e.button===1?pauseMedia():e.button===2&&activateAudibleTab():panel.reactive.mediaState===-1?e.button===0?unmuteTabs():e.button===1?pauseMedia():e.button===2&&activateAudibleTab():panel.reactive.mediaState===2&&(e.button===0?playMedia():e.button===1?Tabs.resetPausedMediaState(props.item.id):e.button===2&&activateAudibleTab())}return(_ctx,_cache)=>isTabsPanel(_ctx.item)?(_openBlock8(),_createElementBlock8("div",{key:0,class:"nav-item",draggable:"true","data-class":"panel","data-type":"tabs",id:"nav"+_ctx.item.id,"data-updated":isUpdated.value,"data-active":_unref8(Sidebar).reactive.activePanelId===props.item.id,"data-index":_ctx.inlineIndex,"data-color":_ctx.item.reactive.color,"data-sel":_ctx.item.id===_unref8(Sidebar).reactive.selectedNavId,"data-empty":_ctx.item.reactive.allDiscarded,"data-audible":_ctx.item.reactive.mediaState===_unref8(MediaState).Audible,"data-paused":_ctx.item.reactive.mediaState===_unref8(MediaState).Paused,"data-muted":_ctx.item.reactive.mediaState===_unref8(MediaState).Muted,"data-drop-mode":dropPointerMode(_ctx.item.id),title:_ctx.item.reactive.tooltip||_ctx.item.reactive.name,onDragstart:_cache[2]||(_cache[2]=$event=>emit("dragstart",$event)),onDrop:_cache[3]||(_cache[3]=$event=>emit("drop",$event)),onMousedown:_cache[4]||(_cache[4]=_withModifiers5($event=>emit("mousedown",$event),["stop"])),onMouseup:_cache[5]||(_cache[5]=_withModifiers5($event=>emit("mouseup",$event),["stop"])),onContextmenu:_cache[6]||(_cache[6]=_withModifiers5($event=>emit("contextmenu",$event),["stop"]))},[_createElementVNode6("div",{class:"dnd-layer","data-dnd-type":_ctx.dndType,"data-dnd-id":_ctx.item.id},null,8,_hoisted_217),_ctx.item.reactive.iconIMG?(_openBlock8(),_createElementBlock8("img",{key:0,class:"icon",src:_ctx.item.reactive.iconIMG},null,8,_hoisted_314)):_ctx.item.reactive.iconSVG?(_openBlock8(),_createElementBlock8("svg",_hoisted_412,[_createElementVNode6("use",{"xlink:href":"#"+_ctx.item.reactive.iconSVG},null,8,_hoisted_512)])):_createCommentVNode6("v-if",!0),_hoisted_612,_ctx.item.reactive.mediaState!==_unref8(MediaState).Silent?(_openBlock8(),_createElementBlock8("div",{key:2,class:"audio",onMousedown:_cache[0]||(_cache[0]=$event=>onAudioMouseDown($event,_ctx.item)),onMouseup:_cache[1]||(_cache[1]=_withModifiers5(()=>{},["stop"]))},_hoisted_104,32)):_createCommentVNode6("v-if",!0),_createElementVNode6("div",_hoisted_118,[_createElementVNode6("div",_hoisted_125,_toDisplayString6(_ctx.item.reactive.name),1)]),_unref8(Settings).state.navBtnCount&&(_ctx.item.reactive.filteredLen??_ctx.item.reactive.len)?(_openBlock8(),_createElementBlock8("div",_hoisted_134,_toDisplayString6(_ctx.item.reactive.filteredLen??_ctx.item.reactive.len),1)):_createCommentVNode6("v-if",!0)],40,_hoisted_117)):isNavPanel(_ctx.item)?(_openBlock8(),_createElementBlock8("div",{key:1,class:"nav-item",draggable:"true","data-class":"panel",id:"nav"+_ctx.item.id,"data-active":_unref8(Sidebar).reactive.activePanelId===props.item.id,"data-index":_ctx.inlineIndex,"data-color":_ctx.item.reactive.color,"data-type":_unref8(NavItemTypeNames)[_ctx.item.type]??_ctx.item.type,"data-sel":_ctx.item.id===_unref8(Sidebar).reactive.selectedNavId,"data-unloaded":_ctx.item.reactive.ready===!1,"data-drop-mode":dropPointerMode(_ctx.item.id),title:_ctx.item.reactive.tooltip||_ctx.item.reactive.name,onDragstart:_cache[7]||(_cache[7]=$event=>emit("dragstart",$event)),onDrop:_cache[8]||(_cache[8]=$event=>emit("drop",$event)),onMousedown:_cache[9]||(_cache[9]=_withModifiers5($event=>emit("mousedown",$event),["stop"])),onMouseup:_cache[10]||(_cache[10]=_withModifiers5($event=>emit("mouseup",$event),["stop"])),onContextmenu:_cache[11]||(_cache[11]=_withModifiers5($event=>emit("contextmenu",$event),["stop"]))},[_createElementVNode6("div",{class:"dnd-layer","data-dnd-type":_ctx.dndType,"data-dnd-id":_ctx.item.id},null,8,_hoisted_154),_unref8(bookmarksBadge)?(_openBlock8(),_createElementBlock8("svg",_hoisted_164,_hoisted_183)):_createCommentVNode6("v-if",!0),_ctx.item.reactive.iconIMG?(_openBlock8(),_createElementBlock8("img",{key:1,class:"icon",src:_ctx.item.reactive.iconIMG},null,8,_hoisted_193)):_ctx.item.reactive.iconSVG?(_openBlock8(),_createElementBlock8("svg",_hoisted_204,[_createElementVNode6("use",{"xlink:href":"#"+_ctx.item.reactive.iconSVG},null,8,_hoisted_218)])):_createCommentVNode6("v-if",!0),_hoisted_225,_createElementVNode6("div",_hoisted_233,[_createElementVNode6("div",_hoisted_243,_toDisplayString6(_ctx.item.reactive.name),1)]),_unref8(Settings).state.navBtnCount&&(_ctx.item.reactive.filteredLen??_ctx.item.reactive.len)?(_openBlock8(),_createElementBlock8("div",_hoisted_253,_toDisplayString6(_ctx.item.reactive.filteredLen??_ctx.item.reactive.len),1)):_createCommentVNode6("v-if",!0)],40,_hoisted_144)):isNavBtn(_ctx.item)?(_openBlock8(),_createElementBlock8("div",{key:2,class:"nav-item",draggable:"true","data-class":"btn",id:_ctx.item.id,"data-type":_unref8(NavItemTypeNames)[_ctx.item.type]??_ctx.item.type,"data-sel":_ctx.item.id===_unref8(Sidebar).reactive.selectedNavId,"data-drop-mode":dropPointerMode(_ctx.item.id),title:_ctx.item.tooltip||_ctx.item.name,onDragstart:_cache[12]||(_cache[12]=$event=>emit("dragstart",$event)),onDrop:_cache[13]||(_cache[13]=$event=>emit("drop",$event)),onMousedown:_cache[14]||(_cache[14]=_withModifiers5($event=>emit("mousedown",$event),["stop"])),onMouseup:_cache[15]||(_cache[15]=_withModifiers5($event=>emit("mouseup",$event),["stop"])),onContextmenu:_cache[16]||(_cache[16]=_withModifiers5($event=>emit("contextmenu",$event),["stop"]))},[_createElementVNode6("div",{class:"dnd-layer","data-dnd-type":_ctx.dndType,"data-dnd-id":_ctx.item.id},null,8,_hoisted_272),_ctx.item.iconIMG?(_openBlock8(),_createElementBlock8("img",{key:0,class:"icon",src:_ctx.item.iconIMG},null,8,_hoisted_282)):_ctx.item.iconSVG?(_openBlock8(),_createElementBlock8("svg",_hoisted_292,[_createElementVNode6("use",{"xlink:href":"#"+_ctx.item.iconSVG},null,8,_hoisted_302)])):_createCommentVNode6("v-if",!0),_createElementVNode6("div",_hoisted_315,[_createElementVNode6("div",_hoisted_322,_toDisplayString6(_ctx.item.name),1)])],40,_hoisted_262)):isNavSpace(_ctx.item)?(_openBlock8(),_createElementBlock8("div",{key:3,class:"nav-item",draggable:"true","data-class":"space","data-type":_unref8(NavItemTypeNames)[_ctx.item.type]??_ctx.item.type,"data-sel":_ctx.item.id===_unref8(Sidebar).reactive.selectedNavId,"data-drop-mode":dropPointerMode(_ctx.item.id),onDragstart:_cache[17]||(_cache[17]=$event=>emit("dragstart",$event)),onDrop:_cache[18]||(_cache[18]=$event=>emit("drop",$event)),onMousedown:_cache[19]||(_cache[19]=$event=>emit("mousedown",$event)),onMouseup:_cache[20]||(_cache[20]=$event=>emit("mouseup",$event)),onContextmenu:_cache[21]||(_cache[21]=$event=>emit("contextmenu",$event))},[_createElementVNode6("div",{class:"dnd-layer","data-dnd-type":_ctx.dndType,"data-dnd-id":_ctx.item.id},null,8,_hoisted_342)],40,_hoisted_332)):_createCommentVNode6("v-if",!0)}});var _hoisted_119=["data-overflowed","data-hidden-panels-bar","data-layout"],_hoisted_219={key:0,class:"static-btns"},_hoisted_316=["data-offset-side"],MIN_INLINE_STATIC_BTNS_LEN=1,bar_navigation_default=_defineComponent9({__name:"bar.navigation",setup(__props){let HIDDEN_PANELS_BTN={id:"hidden_panels_btn",class:2,type:104,iconSVG:"icon_expand",name:translate("nav.show_hidden_tooltip"),tooltip:translate("nav.show_hidden_tooltip")},droppedOnPanel=!1,el=ref3(null),isInline=Settings.state.navBarLayout==="horizontal"&&Settings.state.navBarInline,layout="none";Settings.state.navBarLayout==="horizontal"?layout=Settings.state.navBarInline?"inline":"wrap":Settings.state.navBarLayout==="vertical"&&(layout=Settings.state.navBarSide);let nav=computed6(()=>{let ids=Sidebar.reactive.nav;if(!ids.length)return;let nav2={visibleItems:[]},inlineMax=0,staticHiddenPanelsBtnIndex=-1,lastPanelIndex=-1;for(let id of ids){let panel=Sidebar.panelsById[id];if(panel){if(isTabsPanel(panel)){if(panel.reactive.hidden||Settings.state.hideEmptyPanels&&panel.reactive.empty||Settings.state.hideDiscardedTabPanels&&panel.reactive.allDiscarded){nav2.hiddenPanels||(nav2.hiddenPanels=[]),nav2.hiddenPanels.push(panel);continue}}else if(panel.reactive.hidden){nav2.hiddenPanels||(nav2.hiddenPanels=[]),nav2.hiddenPanels.push(panel);continue}lastPanelIndex=nav2.visibleItems.push(panel)-1}else if(!isInline){let isSpace=id.startsWith("sp-"),isDelimiter=id.startsWith("sd-"),isSearch=id==="search";if(id==="hdn"){staticHiddenPanelsBtnIndex=nav2.visibleItems.length;continue}if(isSearch&&Settings.state.searchBarMode!=="dynamic")continue;if(isSpace)nav2.visibleItems.push({id,class:3,type:200});else if(isDelimiter)nav2.visibleItems.push({id,class:3,type:201});else{let type=ButtonTypes[id];if(!type)continue;let name=translate(`nav.btn_${id}`);nav2.visibleItems.push({id,class:2,type,name,iconSVG:BTN_ICONS[id]})}}}if(!isInline&&nav2.hiddenPanels?.length&&(staticHiddenPanelsBtnIndex!==-1?nav2.visibleItems.splice(staticHiddenPanelsBtnIndex,0,HIDDEN_PANELS_BTN):lastPanelIndex!==-1?nav2.visibleItems.splice(lastPanelIndex+1,0,HIDDEN_PANELS_BTN):nav2.visibleItems.push(HIDDEN_PANELS_BTN)),isInline){let horNavWidth=Sidebar.reactive.horNavWidth,navBtnWidth=Sidebar.reactive.navBtnWidth,navBtnMargin=Sidebar.reactive.navBtnMargin;nav2.visibleStaticButtons=[],nav2.hiddenStaticButtons=[],inlineMax=~~((horNavWidth-navBtnMargin)/(navBtnWidth+navBtnMargin));let hasHiddenPanels=!!nav2.hiddenPanels?.length,visLen=nav2.visibleItems.length,max=inlineMax-visLen;hasHiddenPanels&&max--,max<MIN_INLINE_STATIC_BTNS_LEN&&(max=MIN_INLINE_STATIC_BTNS_LEN);for(let i=ids.length;i--;){let id=ids[i];if(id==="settings"||id==="search"||id==="add_tp"||id==="collapse"||id==="create_snapshot"||id==="remute_audio_tabs"){if(nav2.hiddenPanels?.find(ni=>ni.id===id))continue;let name=translate(`nav.btn_${id}`),type=ButtonTypes[id];if(!type)continue;let btn={id,class:2,type,iconSVG:BTN_ICONS[id],name};nav2.visibleStaticButtons.length<max?nav2.visibleStaticButtons.unshift(btn):nav2.hiddenStaticButtons.unshift(btn)}}(hasHiddenPanels||nav2.hiddenStaticButtons.length)&&nav2.visibleStaticButtons.unshift(HIDDEN_PANELS_BTN),nav2.visibleItemsMax=inlineMax-nav2.visibleStaticButtons.length;let spLen=0;for(let item of nav2.visibleItems)isNavSpace(item)&&spLen++;nav2.inlineOverflowed=nav2.visibleItems.length-spLen>=nav2.visibleItemsMax}return nav2});watch2(()=>nav.value?.hiddenPanels?.length,newHiddenLen=>{!newHiddenLen&&Sidebar.reactive.hiddenPanelsPopup&&(Sidebar.reactive.hiddenPanelsPopup=!1)}),onMounted2(()=>{el.value&&Settings.state.navBarLayout==="horizontal"&&(Sidebar.registerHorizontalNavBarEl(el.value),Sidebar.reactive.horNavWidth=el.value.offsetWidth)});function getBtnInlineIndex(index){if(!isInline)return-1;let visMax=nav.value?.visibleItemsMax;if(!visMax)return-1;let visItems=nav.value?.visibleItems,activePanelId=Sidebar.reactive.activePanelId,activeIndex=visItems.findIndex(btn=>btn.id===activePanelId);activeIndex===-1&&(activeIndex=0);let halfCap=Math.floor(visMax/2),len=visItems?.length??0;return visMax>=len||halfCap>activeIndex&&index<visMax?index:activeIndex+halfCap>=len?index<len-visMax?-1:index-(len-visMax):(index-=activeIndex-halfCap,visMax%2||index--,index>=0&&index<visMax?index:-1)}let onNavWheel=Mouse.getWheelDebouncer(2,e=>{if(Settings.state.navSwitchPanelsWheel){if(e.deltaY>0)return Sidebar.switchPanel(1,!0);if(e.deltaY<0)return Sidebar.switchPanel(-1,!0)}});function onDrop(e){droppedOnPanel||(DnD.reactive.dstType=0),droppedOnPanel=!1}function onNavCtxMenu(e,item){if(!Settings.state.ctxMenuNative||e.ctrlKey||e.shiftKey){e.stopPropagation(),e.preventDefault();return}let panel=Sidebar.panelsById[item.id];if(!panel){e.preventDefault();return}Menu.blockCtxMenu();let nativeCtx={showDefaults:!1};browser.menus.overrideContext(nativeCtx);let type;panel.type===1?type=8:panel.type===2?type=7:type=9,Selection.isSet()||Selection.selectNavItem(panel.id),Menu.open(type)}async function onNavMouseDown(e,item){if(isNavSpace(item))return Mouse.resetTarget();if(Mouse.setTarget("nav",item.id),Menu.close(),Selection.resetSelection(),e.button===1){if(item.type===2){let panel=Sidebar.panelsById[item.id];if(!isTabsPanel(panel))return;if(Settings.state.navTabsPanelMidClickAction==="rm_all"){let toRemove=panel.tabs.map(t=>t.id);Settings.state.pinnedTabsPosition==="panel"&&panel.pinnedTabs.forEach(t=>toRemove.push(t.id)),toRemove.length&&Tabs.removeTabs(toRemove)}if(Settings.state.navTabsPanelMidClickAction==="rm_rmp"&&Sidebar.removePanel(panel.id,{tabsMode:"close"}),Settings.state.navTabsPanelMidClickAction==="hide"&&Sidebar.hidePanel(panel.id),Settings.state.navTabsPanelMidClickAction==="rm_act_tab"){let actTab=Tabs.byId[Tabs.activeId];actTab&&actTab.panelId===item.id&&!actTab.pinned&&Tabs.removeTabs([Tabs.activeId])}if(Settings.state.navTabsPanelMidClickAction==="discard"){let ids=panel.tabs.map(t=>t.id);ids.length&&Tabs.discardTabs(ids)}if(Settings.state.navTabsPanelMidClickAction==="bookmark"&&Sidebar.bookmarkTabsPanel(panel.id,!0),Settings.state.navTabsPanelMidClickAction==="bkm_rmp"&&(await Sidebar.bookmarkTabsPanel(panel.id,!0,!0),Sidebar.removePanel(panel.id,{tabsMode:"close"})),Settings.state.navTabsPanelMidClickAction==="convert"&&Sidebar.convertToBookmarksPanel(panel),Settings.state.navTabsPanelMidClickAction==="conv_hide"){let bookmarksPanel=await Sidebar.convertToBookmarksPanel(panel);bookmarksPanel&&Sidebar.hidePanel(bookmarksPanel.id)}}if(item.type===1){let panel=Sidebar.panelsById[item.id];if(!isBookmarksPanel(panel))return;if(Settings.state.navBookmarksPanelMidClickAction==="convert"){let panelId=await Sidebar.convertToTabsPanel(panel,!0);Sidebar.panelsById[panelId]?.hidden&&Sidebar.showPanel(panelId)}}if(item.type===105&&SetupPage.open("snapshots"),item.type===106){let pausedTabs=[],audibleTabs=[];for(let tab of Tabs.list)tab.mediaPaused?pausedTabs.push(tab):tab.audible&&audibleTabs.push(tab);audibleTabs.length?Tabs.pauseAllAudibleTabsMedia():pausedTabs.length===1&&Tabs.playAllPausedTabsMedia()}item.type===107&&collapseAll(),item.type===101&&addTabsPanel(!0)}}function onNavMouseUp(e,item,inHiddenBar){if(isNavSpace(item)||!Mouse.isTarget("nav",item.id))return;let isTabs=item.type===2,isBookmarks=item.type===1,isHiddenPanels=item.type===104,isSettings=item.type===100,isSearch=item.type===103,isCreateSnapshot=item.type===105,isRemuteAudioTabs=item.type===106,isAddTP=item.type===101,panel=Sidebar.panelsById[item.id];if(e.button===0){let isSwitchingPanel=!!panel&&Sidebar.activePanelId!==item.id;if(isHiddenPanels){Sidebar.reactive.hiddenPanelsPopup?Sidebar.closeHiddenPanelsPopup():Sidebar.openHiddenPanelsPopup();return}if(inHiddenBar&&Sidebar.closeHiddenPanelsPopup(isSwitchingPanel),isAddTP)return addTabsPanel();if(isSettings)return e.altKey?(SetupPage.copyDevtoolsUrl(),browser.tabs.create({})):SetupPage.open();if(isSearch)return Search.toggleBar();if(isCreateSnapshot)return Snapshots.createSnapshot();if(isRemuteAudioTabs)return Tabs.remuteAudibleTabs();if(item.type===107&&collapseAll(),isSwitchingPanel)return Sidebar.reactive.hiddenPanelsPopup&&(Sidebar.reactive.hiddenPanelsPopup=!1),Sidebar.switchToPanel(item.id);if(isBookmarks&&Settings.state.navActBookmarksPanelLeftClickAction==="scroll")return Sidebar.scrollPanelToEdge();if(isTabs&&panel){if(Settings.state.navActTabsPanelLeftClickAction==="new_tab")return Tabs.createTabInPanel(panel);if(Settings.state.navActTabsPanelLeftClickAction==="scroll")return Sidebar.scrollPanelToEdge()}}else if(e.button===2){if(e.stopPropagation(),Settings.state.ctxMenuNative)return;if(Selection.isSet())return Selection.resetSelection();if(isRemuteAudioTabs)return Tabs.switchToFirstAudibleTab();if(isSettings&&Tabs.pringDbgInfo(!e.altKey),!Sidebar.panelsById[item.id])return;let type;item.type===1?type=8:item.type===2?type=7:type=9,Selection.selectNavItem(item.id),Menu.open(type,e.clientX,e.clientY)}}function onNavDragStart(e,item){Menu.close(),Selection.resetSelection();let panel=Sidebar.panelsById[item.id],isTabsPanel2=isTabsPanel(panel),isBookmarksPanel2=isBookmarksPanel(panel),dndType;isTabsPanel2?dndType=31:isBookmarksPanel2?dndType=32:dndType=3,(isTabsPanel2||isBookmarksPanel2)&&Sidebar.updateBounds(),Selection.selectNavItem(item.id);let contentList=[],dragItems=[],dragInfo={type:dndType,items:dragItems,windowId:Windows.id,incognito:Windows.incognito,pinnedTabs:!1,x:e.clientX,y:e.clientY,index:Sidebar.reactive.nav.indexOf(item.id)};if(isTabsPanel(panel)){dragInfo.panelId=panel.id;for(let tab of panel.tabs)contentList.push(tab.title),contentList.push(tab.url),contentList.push(""),dragItems.push({id:tab.id,url:tab.url,title:tab.title,parentId:tab.parentId,container:tab.cookieStoreId})}else dragItems.push({id:item.id});if(DnD.start(dragInfo,3),e.dataTransfer){e.dataTransfer.setData("application/x-sidebery-dnd",JSON.stringify(dragInfo)),(Settings.state.dndOutside==="data"?!e.altKey:e.altKey)&&e.dataTransfer.setData("text/plain",contentList.join(`\r
`));let dragImgEl=document.getElementById("drag_image");dragImgEl&&e.dataTransfer.setDragImage(dragImgEl,-3,-3),e.dataTransfer.effectAllowed="move"}}function onNavItemDrop(item){droppedOnPanel=!0}async function addTabsPanel(silent){let index=findLastIndex(Sidebar.reactive.nav,id=>{let panel2=Sidebar.panelsById[id];return isTabsPanel(panel2)});index!==-1&&index++,index===-1&&(index=Sidebar.reactive.nav.indexOf("add_tp")),index===-1&&(index=0);let panel;if(silent){let name=Sidebar.getPanelAutoName(2);panel=Sidebar.createTabsPanel({name,color:getRandomFrom(COLOR_NAMES)}),Sidebar.addPanel(index,panel),Sidebar.recalcPanels(),Sidebar.recalcTabsPanels(),Sidebar.saveSidebar(300)}else{let result=await openPanelPopup({type:2},index);if(!result)return;panel=Sidebar.panelsById[result]}panel&&(Sidebar.activatePanel(panel.id),Tabs.createTabInPanel(panel))}function collapseAll(){let activePanel=Sidebar.panelsById[Sidebar.activePanelId];if(activePanel)if(isTabsPanel(activePanel)){let tabs=[];for(let rTab of activePanel.tabs){let tab=Tabs.byId[rTab.id];tab&&tab.lvl===0&&tabs.push(tab)}Tabs.foldAllInactiveBranches(tabs)}else isBookmarksPanel(activePanel)&&Bookmarks.collapseAllBookmarks(activePanel.id)}return(_ctx,_cache)=>(_openBlock9(),_createElementBlock9("div",{class:"NavigationBar",id:"nav_bar",ref_key:"el",ref:el,tabindex:"-1","data-overflowed":nav.value?.inlineOverflowed,"data-hidden-panels-bar":_unref9(Sidebar).reactive.hiddenPanelsPopup,"data-layout":_unref9(layout),onDrop},[_createElementVNode7("div",{class:"main-items",onWheel:_cache[0]||(_cache[0]=_withModifiers6((...args)=>_unref9(onNavWheel)&&_unref9(onNavWheel)(...args),["stop","prevent"]))},[(_openBlock9(!0),_createElementBlock9(_Fragment5,null,_renderList5(nav.value?.visibleItems,(item,i)=>(_openBlock9(),_createBlock2(nav_item_default,{key:item.id,item,inlineIndex:getBtnInlineIndex(i),dndType:"nav-item",onDragstart:$event=>onNavDragStart($event,item),onDrop:$event=>onNavItemDrop(item),onMousedown:$event=>onNavMouseDown($event,item),onMouseup:$event=>onNavMouseUp($event,item),onContextmenu:$event=>onNavCtxMenu($event,item)},null,8,["item","inlineIndex","onDragstart","onDrop","onMousedown","onMouseup","onContextmenu"]))),128))],32),nav.value?.visibleStaticButtons?(_openBlock9(),_createElementBlock9("div",_hoisted_219,[(_openBlock9(!0),_createElementBlock9(_Fragment5,null,_renderList5(nav.value.visibleStaticButtons,(item,i)=>(_openBlock9(),_createBlock2(nav_item_default,{key:item.id,item,dndType:"nav-item",onDragstart:$event=>onNavDragStart($event,item),onDrop:$event=>onNavItemDrop(item),onMousedown:$event=>onNavMouseDown($event,item),onMouseup:$event=>onNavMouseUp($event,item),onContextmenu:$event=>onNavCtxMenu($event,item)},null,8,["item","onDragstart","onDrop","onMousedown","onMouseup","onContextmenu"]))),128))])):_createCommentVNode7("v-if",!0),_createVNode4(_Transition2,{name:"hidden-panels"},{default:_withCtx3(()=>[_unref9(Sidebar).reactive.hiddenPanelsPopup?(_openBlock9(),_createElementBlock9("div",{key:0,class:"hidden-panels-popup-layer","data-dnd-type":"hidden-layer",style:_normalizeStyle4({"--offset":`${_unref9(Sidebar).reactive.hiddenPanelsPopupOffset}px`}),onMousedown:_cache[3]||(_cache[3]=$event=>_unref9(Sidebar).closeHiddenPanelsPopup())},[_createElementVNode7("div",{class:"hidden-panels-popup","data-offset-side":_unref9(Sidebar).reactive.hiddenPanelsPopupOffsetSide},[_createElementVNode7("div",{class:"hidden-panels-popup-content",onMousedown:_cache[1]||(_cache[1]=_withModifiers6(()=>{},["stop"])),onMouseup:_cache[2]||(_cache[2]=_withModifiers6(()=>{},["stop"]))},[nav.value?.inlineOverflowed?(_openBlock9(!0),_createElementBlock9(_Fragment5,{key:0},_renderList5(nav.value?.visibleItems.filter((_,i)=>getBtnInlineIndex(i)===-1),item=>(_openBlock9(),_createBlock2(nav_item_default,{key:item.id,item,dndType:"hidden-panel",onDragstart:$event=>onNavDragStart($event,item),onDrop:$event=>onNavItemDrop(item),onMousedown:$event=>onNavMouseDown($event,item),onMouseup:$event=>onNavMouseUp($event,item,!0),onContextmenu:$event=>onNavCtxMenu($event,item)},null,8,["item","onDragstart","onDrop","onMousedown","onMouseup","onContextmenu"]))),128)):_createCommentVNode7("v-if",!0),(_openBlock9(!0),_createElementBlock9(_Fragment5,null,_renderList5(nav.value?.hiddenPanels,item=>(_openBlock9(),_createBlock2(nav_item_default,{key:item.id,item,dndType:"hidden-panel",onDragstart:$event=>onNavDragStart($event,item),onDrop:$event=>onNavItemDrop(item),onMousedown:$event=>onNavMouseDown($event,item),onMouseup:$event=>onNavMouseUp($event,item,!0),onContextmenu:$event=>onNavCtxMenu($event,item)},null,8,["item","onDragstart","onDrop","onMousedown","onMouseup","onContextmenu"]))),128)),(_openBlock9(!0),_createElementBlock9(_Fragment5,null,_renderList5(nav.value?.hiddenStaticButtons,item=>(_openBlock9(),_createBlock2(nav_item_default,{key:item.id,item,dndType:"nav-item",onDragstart:$event=>onNavDragStart($event,item),onDrop:$event=>onNavItemDrop(item),onMousedown:$event=>onNavMouseDown($event,item),onMouseup:$event=>onNavMouseUp($event,item,!0),onContextmenu:$event=>onNavCtxMenu($event,item)},null,8,["item","onDragstart","onDrop","onMousedown","onMouseup","onContextmenu"]))),128))],32)],8,_hoisted_316)],36)):_createCommentVNode7("v-if",!0)]),_:1})],40,_hoisted_119))}});import{defineComponent as _defineComponent10}from"/vendor/vue.runtime.esm-browser.prod.js";import{unref as _unref10,toDisplayString as _toDisplayString7,openBlock as _openBlock10,createElementBlock as _createElementBlock10,createCommentVNode as _createCommentVNode8,renderList as _renderList6,Fragment as _Fragment6,createElementVNode as _createElementVNode8,withModifiers as _withModifiers7,withCtx as _withCtx4,createVNode as _createVNode5,createBlock as _createBlock3}from"/vendor/vue.runtime.esm-browser.prod.js";import{computed as computed7}from"/vendor/vue.runtime.esm-browser.prod.js";var _hoisted_120=["data-ready"],_hoisted_220={key:0},_hoisted_317={class:"list"},_hoisted_413=["data-no-screenshot","data-selected"],_hoisted_513=["onClick"],_hoisted_613={class:"window-title"},_hoisted_77=["src","onLoad"],popup_windows_default=_defineComponent10({__name:"popup.windows",setup(__props){let isReady=computed7(()=>!Windows.reactive.choosing||!Windows.reactive.choosing.length?!1:Windows.reactive.choosing[0].screen?Windows.reactive.choosing.reduce((o,w)=>o&&!!w.loaded,!0):!0);function onScreenLoad(index){if(!Windows.reactive.choosing)return;let win=Windows.reactive.choosing[index];Windows.reactive.choosing.splice(index,1,{...win,loaded:!0})}function normalizeWinTitle(title){return Settings.state.markWindow&&Settings.state.markWindowPreface?title.replace(Settings.state.markWindowPreface,""):title}function cancel(){Windows.reactive.choosing&&(Windows.reactive.choosing=Windows.reactive.choosing.map(w=>({...w,loaded:!1})),setTimeout(()=>{Windows.reactive.choosing=null},120))}return(_ctx,_cache)=>(_openBlock10(),_createElementBlock10("div",{class:"WindowsPopup popup-container","data-ready":isReady.value,onClick:cancel},[_createElementVNode8("div",{class:"popup",onClick:_cache[0]||(_cache[0]=_withModifiers7(()=>{},["stop"]))},[_unref10(Windows).reactive.choosingTitle?(_openBlock10(),_createElementBlock10("h2",_hoisted_220,_toDisplayString7(_unref10(Windows).reactive.choosingTitle),1)):_createCommentVNode8("v-if",!0),_createElementVNode8("div",_hoisted_317,[_createVNode5(scroll_box_default,null,{default:_withCtx4(()=>[(_openBlock10(!0),_createElementBlock10(_Fragment6,null,_renderList6(_unref10(Windows).reactive.choosing,(win,i)=>(_openBlock10(),_createElementBlock10("div",{class:"box",key:win.id,"data-no-screenshot":!win.screen,"data-selected":win.sel},[_createElementVNode8("div",{class:"win",onClick:_withModifiers7(win.choose,["stop"])},[_createElementVNode8("div",_hoisted_613,_toDisplayString7(normalizeWinTitle(win.title)),1),win.screen?(_openBlock10(),_createElementBlock10("img",{key:0,src:win.screen,onLoad:$event=>onScreenLoad(i)},null,40,_hoisted_77)):_createCommentVNode8("v-if",!0)],8,_hoisted_513)],8,_hoisted_413))),128))]),_:1})]),_unref10(Windows).reactive.choosing?.length?_createCommentVNode8("v-if",!0):(_openBlock10(),_createBlock3(loading_dots_default,{key:1})),_createElementVNode8("div",{class:"ctrls"},[_createElementVNode8("div",{class:"btn -warn",onClick:cancel},"Cancel")])])],8,_hoisted_120))}});import{defineComponent as _defineComponent15}from"/vendor/vue.runtime.esm-browser.prod.js";import{openBlock as _openBlock15,createBlock as _createBlock5,createCommentVNode as _createCommentVNode11,unref as _unref13,createVNode as _createVNode6,normalizeStyle as _normalizeStyle6,createElementBlock as _createElementBlock15,renderList as _renderList8,Fragment as _Fragment8,createElementVNode as _createElementVNode12,withCtx as _withCtx6,withModifiers as _withModifiers8}from"/vendor/vue.runtime.esm-browser.prod.js";import{ref as ref6,onMounted as onMounted5}from"/vendor/vue.runtime.esm-browser.prod.js";import{defineComponent as _defineComponent11}from"/vendor/vue.runtime.esm-browser.prod.js";import{toDisplayString as _toDisplayString8,createElementVNode as _createElementVNode9,openBlock as _openBlock11,createElementBlock as _createElementBlock11,createCommentVNode as _createCommentVNode9,createBlock as _createBlock4,Transition as _Transition3,withCtx as _withCtx5}from"/vendor/vue.runtime.esm-browser.prod.js";var _hoisted_121=["data-loading"],_hoisted_221={key:0,class:"perm-warn"},_hoisted_318={class:"perm-warn-msg"},_hoisted_414={key:2,class:"msg"},panel_placeholder_default=_defineComponent11({__name:"panel-placeholder",props:{isLoading:{type:Boolean},isMsg:{type:Boolean},isNotPerm:{type:Boolean},perm:{},permMsg:{},msg:{}},setup(__props){let props=__props;async function requestPermission(){if(props.perm)try{await Permissions.request(props.perm)}catch{SetupPage.open(props.perm)}}return(_ctx,_cache)=>(_openBlock11(),_createBlock4(_Transition3,{name:"panel-placeholder"},{default:_withCtx5(()=>[props.isLoading||_ctx.isMsg||_ctx.isNotPerm?(_openBlock11(),_createElementBlock11("div",{key:0,class:"PanelPlaceholder","data-loading":_ctx.isLoading},[_ctx.isNotPerm&&_ctx.perm?(_openBlock11(),_createElementBlock11("div",_hoisted_221,[_createElementVNode9("div",_hoisted_318,_toDisplayString8(_ctx.permMsg),1),_createElementVNode9("div",{class:"btn perm-warn-btn",onClick:requestPermission},"Grant permissions")])):props.isLoading?(_openBlock11(),_createBlock4(loading_dots_default,{key:1})):props.isMsg?(_openBlock11(),_createElementBlock11("div",_hoisted_414,_toDisplayString8(props.msg),1)):_createCommentVNode9("v-if",!0)],8,_hoisted_121)):_createCommentVNode9("v-if",!0)]),_:1}))}});import{defineComponent as _defineComponent12}from"/vendor/vue.runtime.esm-browser.prod.js";import{unref as _unref11,createElementVNode as _createElementVNode10,normalizeClass as _normalizeClass2,openBlock as _openBlock12,createElementBlock as _createElementBlock12,createCommentVNode as _createCommentVNode10,renderList as _renderList7,Fragment as _Fragment7}from"/vendor/vue.runtime.esm-browser.prod.js";import{computed as computed8}from"/vendor/vue.runtime.esm-browser.prod.js";var _hoisted_126=["data-new-tab-bar-position","data-sel"],_hoisted_226=["title","data-color"],_hoisted_319=_createElementVNode10("div",{class:"dnd-layer",draggable:"true"},null,-1),_hoisted_415=["xlink:href"],_hoisted_514={key:0,class:"-badge"},_hoisted_614=_createElementVNode10("use",{"xlink:href":"#icon_plus_badge"},null,-1),_hoisted_78=[_hoisted_614],_hoisted_84=["title","data-br","data-wide","data-color","onMousedown","onMouseup","onDragstart"],_hoisted_94=_createElementVNode10("div",{class:"dnd-layer",draggable:"true"},null,-1),_hoisted_105={key:0,class:"-icon"},_hoisted_1110=["xlink:href"],_hoisted_127={key:1,class:"-icon"},_hoisted_135=["xlink:href"],_hoisted_145=["src"],_hoisted_155=_createElementVNode10("svg",{class:"-badge"},[_createElementVNode10("use",{"xlink:href":"#icon_plus_badge"})],-1),bar_new_tab_default=_defineComponent12({__name:"bar.new-tab",props:{panel:{type:Object,required:!0}},setup(__props){let props=__props,defaultBtn=computed8(()=>{let btn={id:"default"},contianer=Containers.reactive.byId[props.panel.reactive.newTabCtx];return contianer?(btn.containerId=contianer.id,btn.containrtName=contianer.name,btn.icon="#"+contianer.icon):btn.icon="#icon_plus",btn.tooltip=createTooltip(btn),btn}),btns=computed8(()=>{let btns2=[],ids={},rawBtns=props.panel.reactive.newTabBtns,container,afterSep=!1;for(let conf of rawBtns){if(conf===""){btns2.push({id:""}),afterSep||(afterSep=!0);continue}if(ids[conf])continue;ids[conf]=conf,container=void 0;let btn={id:conf},parts=conf.split(",");afterSep&&(btn.wide=!0);for(let part of parts){part=part.trim();let domain=DOMAIN_RE.exec(part)?.[2];if(domain){btn.url=part,btn.domain=domain,btn.title=btn.url;continue}if(!container&&(container=Object.values(Containers.reactive.byId).find(c=>c.name===part),container&&!Windows.incognito)){btn.containerId=container.id,btn.containrtName=container.name,btn.title||(btn.title=container.name);continue}}btn.domain&&(btn.icon=reactive2.byDomains[btn.domain]),!btn.icon&&btn.url&&(btn.icon=getFavPlaceholder(btn.url)),!btn.icon&&container&&(btn.icon="#"+container.icon),btn.tooltip=createTooltip(btn),btn.title&&btns2.push(btn)}return btns2});function createTooltip(btn){let tooltip=translate("newTabBar.new_tab");return btn.containrtName&&(tooltip+=translate("newTabBar.in_container_prefix")+btn.containrtName+translate("newTabBar.in_container_postfix")),btn.url&&(tooltip+=": "+btn.url),Settings.state.newTabMiddleClickAction==="new_child"?tooltip+=`
`+translate("newTabBar.mid_child"):(tooltip+=`
`+translate("newTabBar.mid_reopen"),btn.containrtName?tooltip+=translate("newTabBar.in_container_prefix")+btn.containrtName+translate("newTabBar.in_container_postfix"):btn.url||(tooltip+=translate("newTabBar.in_default_container")),btn.url&&(tooltip+=": "+btn.url)),tooltip}function onNewTabMouseDown(e,btn){e.stopPropagation(),Mouse.setTarget("tab.new","tab.new"),Menu.close(),e.button===1?(e.preventDefault(),Mouse.blockWheel()):e.button===2&&!Settings.state.ctxMenuNative&&!props.panel.selNewTab&&Selection.resetSelection()}function onNewTabMouseUp(e,btn){if(Selection.isSet()&&Mouse.isTarget("tab"))return;e.stopPropagation();let sameTarget=Mouse.isTarget("tab.new","tab.new");if(Mouse.resetTarget(),Mouse.stopLongClick(),!sameTarget){Mouse.stopMultiSelection(),Selection.resetSelection();return}if(e.button===0){if(e.ctrlKey){Mouse.blockWheel();let actTab=Tabs.byId[Tabs.activeId];actTab&&!actTab.pinned&&actTab.panelId===props.panel.id?Tabs.createChildTab(actTab.id,btn?.url,btn?.containerId):Tabs.createTabInPanel(props.panel,{url:btn?.url,cookieStoreId:btn?.containerId});return}if(e.altKey){applyBtnRules(btn);return}Selection.isSet()&&!props.panel.selNewTab&&Selection.resetSelection(),Tabs.createTabInPanel(props.panel,{url:btn?.url,cookieStoreId:btn?.containerId})}else if(e.button===1)if(Settings.state.newTabMiddleClickAction==="new_child"){let actTab=Tabs.byId[Tabs.activeId];actTab&&!actTab.pinned&&actTab.panelId===props.panel.id?Tabs.createChildTab(actTab.id,btn?.url,btn?.containerId):Tabs.createTabInPanel(props.panel,{url:btn?.url,cookieStoreId:btn?.containerId})}else Settings.state.newTabMiddleClickAction==="reopen"&&applyBtnRules(btn);else if(e.button===2){if(e.ctrlKey||e.shiftKey||Windows.incognito||Menu.isBlocked())return;!Selection.isSet()&&!Settings.state.ctxMenuNative&&Selection.selectNewTabBtn(props.panel.id),Settings.state.ctxMenuNative||Menu.open(6,e.clientX,e.clientY)}}function onNewTabCtxMenu(e){let sameTarget=Mouse.isCtxTarget("tab.new");if(Mouse.resetCtxTarget(),!sameTarget){e.stopPropagation(),e.preventDefault();return}if(Windows.incognito){e.preventDefault(),e.stopPropagation();return}if(e.stopPropagation(),Mouse.isLocked()||!Settings.state.ctxMenuNative||e.ctrlKey||e.shiftKey){Mouse.resetClickLock(),e.stopPropagation(),e.preventDefault();return}if(!e.ctrlKey&&!e.shiftKey&&!props.panel.selNewTab&&Selection.resetSelection(),Menu.isBlocked()){e.stopPropagation(),e.preventDefault();return}let nativeCtx={showDefaults:!1};browser.menus.overrideContext(nativeCtx),Selection.isSet()||Selection.selectNewTabBtn(props.panel.id),Menu.open(6)}async function applyBtnRules(btn){let targetTabs=[];if(Selection.isTabs()){let ids=Selection.get();for(let tab of Tabs.list)ids.includes(tab.id)&&targetTabs.push(tab)}else{let activeTab=Tabs.byId[Tabs.activeId];activeTab&&targetTabs.push(activeTab)}if(Selection.isSet()&&Selection.resetSelection(),!targetTabs.length||targetTabs.some(t=>t.panelId!==props.panel.id))return;let targetContainerId=btn?.containerId??CONTAINER_ID,toReopen=[];for(let tab of targetTabs)if(tab.cookieStoreId===targetContainerId&&btn?.url)await browser.tabs.update(tab.id,{url:btn.url});else if(tab.cookieStoreId!==targetContainerId){let info2=cloneObject(tab);btn?.url&&(info2.url=btn.url),info2.url==="about:blank"&&(info2.url="about:newtab"),toReopen.push(info2)}if(toReopen.length>0){let dst={containerId:targetContainerId,panelId:props.panel.id},idsMap={};bg("disableAutoReopening",targetContainerId,1e3);try{await Tabs.reopen(toReopen,dst,idsMap)}catch(err2){err("NewTabBar: Cannot reopen tabs",err2)}bg("enableAutoReopening",Object.values(idsMap))}}function onDragStart(e,btn){Menu.close(),Selection.resetSelection(),Sidebar.updateBounds();let dragInfo={type:11,items:[{id:NEWID,container:btn.containerId,title:"New tab",url:btn.url}],windowId:Windows.id,incognito:Windows.incognito,pinnedTabs:!1,x:e.clientX,y:e.clientY};if(DnD.start(dragInfo,1),e.dataTransfer){e.dataTransfer.setData("application/x-sidebery-dnd",JSON.stringify(dragInfo));let dragImgEl=document.getElementById("drag_image");dragImgEl&&e.dataTransfer.setDragImage(dragImgEl,-3,-3),e.dataTransfer.effectAllowed="move"}}return(_ctx,_cache)=>(_openBlock12(),_createElementBlock12("div",{class:"new-tab-btns",tabindex:"-1","data-new-tab-bar-position":_unref11(Settings).state.newTabBarPosition,"data-sel":__props.panel.reactive.selNewTab},[_createElementVNode10("div",{class:"new-tab-btn",title:defaultBtn.value.tooltip,"data-color":defaultBtn.value.containerId&&_unref11(Containers).reactive.byId[defaultBtn.value.containerId]?.color,onMousedown:_cache[0]||(_cache[0]=$event=>onNewTabMouseDown($event,defaultBtn.value)),onMouseup:_cache[1]||(_cache[1]=$event=>onNewTabMouseUp($event,defaultBtn.value)),onDragstart:_cache[2]||(_cache[2]=$event=>onDragStart($event,defaultBtn.value)),onContextmenu:onNewTabCtxMenu},[_hoisted_319,(_openBlock12(),_createElementBlock12("svg",{class:_normalizeClass2({"-icon":!!defaultBtn.value.containerId})},[_createElementVNode10("use",{"xlink:href":defaultBtn.value.icon},null,8,_hoisted_415)],2)),defaultBtn.value.containerId?(_openBlock12(),_createElementBlock12("svg",_hoisted_514,_hoisted_78)):_createCommentVNode10("v-if",!0)],40,_hoisted_226),(_openBlock12(!0),_createElementBlock12(_Fragment7,null,_renderList7(btns.value,btn=>(_openBlock12(),_createElementBlock12("div",{class:"new-tab-btn -custom",title:btn.tooltip,"data-br":!btn.title,"data-wide":btn.wide,"data-color":btn.containerId&&_unref11(Containers).reactive.byId[btn.containerId]?.color,onMousedown:$event=>onNewTabMouseDown($event,btn),onMouseup:$event=>onNewTabMouseUp($event,btn),onDragstart:$event=>onDragStart($event,btn),onContextmenu:onNewTabCtxMenu},[_hoisted_94,!btn.domain&&btn.containerId?(_openBlock12(),_createElementBlock12("svg",_hoisted_105,[_createElementVNode10("use",{"xlink:href":btn.icon},null,8,_hoisted_1110)])):btn.icon&&btn.icon[0]==="#"?(_openBlock12(),_createElementBlock12("svg",_hoisted_127,[_createElementVNode10("use",{"xlink:href":btn.icon},null,8,_hoisted_135)])):btn.icon?(_openBlock12(),_createElementBlock12("img",{key:2,class:"-icon",src:btn.icon},null,8,_hoisted_145)):_createCommentVNode10("v-if",!0),_hoisted_155],40,_hoisted_84))),256))],8,_hoisted_126))}});import{defineComponent as _defineComponent13}from"/vendor/vue.runtime.esm-browser.prod.js";import{unref as _unref12,createElementVNode as _createElementVNode11,vShow as _vShow3,normalizeStyle as _normalizeStyle5,withDirectives as _withDirectives3,openBlock as _openBlock13,createElementBlock as _createElementBlock13}from"/vendor/vue.runtime.esm-browser.prod.js";import{onMounted as onMounted3,ref as ref4}from"/vendor/vue.runtime.esm-browser.prod.js";var _hoisted_128=["data-pointer","data-hover","data-lvl"],_hoisted_227=["data-expanding"],dnd_pointer_default=_defineComponent13({__name:"dnd-pointer",props:{panelId:{},subPanel:{type:Boolean}},setup(__props){let props=__props,pointerEl=ref4(null);return onMounted3(()=>DnD.initPointer(pointerEl.value,props.panelId)),(_ctx,_cache)=>_withDirectives3((_openBlock13(),_createElementBlock13("div",{class:"pointer",ref_key:"pointerEl",ref:pointerEl,style:_normalizeStyle5({"--pointer-left":`${_unref12(DnD).reactive.pointerLeft}px`}),"data-pointer":_unref12(DndPointerModeNames)[_unref12(DnD).reactive.pointerMode],"data-hover":_unref12(DnD).reactive.pointerHover,"data-lvl":_unref12(DnD).reactive.pointerLvl},[_createElementVNode11("div",{class:"arrow","data-expanding":_unref12(DnD).reactive.pointerExpanding,onAnimationend:_cache[0]||(_cache[0]=(...args)=>_unref12(DnD).onPointerExpanded&&_unref12(DnD).onPointerExpanded(...args))},null,40,_hoisted_227)],12,_hoisted_128)),[[_vShow3,_ctx.subPanel===_unref12(Sidebar).reactive.subPanelActive]])}});import{defineComponent as _defineComponent14}from"/vendor/vue.runtime.esm-browser.prod.js";import{renderSlot as _renderSlot,openBlock as _openBlock14,createElementBlock as _createElementBlock14}from"/vendor/vue.runtime.esm-browser.prod.js";import{ref as ref5,onMounted as onMounted4,onBeforeUpdate,onUpdated}from"/vendor/vue.runtime.esm-browser.prod.js";var animated_tab_list_default=_defineComponent14({__name:"animated-tab-list",props:{panel:{}},setup(__props){let rootEl=ref5(null),prevPositions=new Map,prevChildren=[],children=[],enabled=!1,scrollEl=null,props=__props;function getChildEls(){let elsCollection=rootEl.value?.children;return elsCollection?Array.from(elsCollection):[]}onMounted4(()=>{enabled=Settings.state.animations});let viewportHeight=0;onBeforeUpdate(()=>{if(!enabled||!Tabs.ready)return;let fullTabHeight=Sidebar.tabHeight+Sidebar.tabMargin;if(scrollEl=props.panel.scrollEl,!!scrollEl){viewportHeight=scrollEl.offsetHeight,prevChildren=getChildEls();for(let i=0;i<prevChildren.length;i++){let el=prevChildren[i];el.classList.contains("Tab")?(prevPositions.set(el,i*fullTabHeight),el.__sdbr_isTab=!0):prevPositions.set(el,el.getBoundingClientRect().top)}}}),onUpdated(()=>{if(!enabled||!scrollEl||!Tabs.ready)return;children=getChildEls();let fullTabHeight=Sidebar.tabHeight+Sidebar.tabMargin,added=[],moved=[];for(let i=0;i<children.length;i++){let child=children[i],prevIndex=prevChildren.indexOf(child);child.__sdbr_index=i,prevIndex===-1?(added.push(child),child.style.transitionDuration="0s",child.classList.add("-hidden")):prevIndex!==i&&moved.push(child)}if(added.length||moved.length){let moveAnimated=[];if(moved.length){let scrollTop=scrollEl.scrollTop;for(let el of moved){let index=el.__sdbr_index;if(index===void 0)continue;let prevPosition=prevPositions.get(el);if(prevPosition===void 0)break;let prevTop=prevPosition,top;if(el.__sdbr_isTab||el.classList.contains("Tab")){if(top=index*fullTabHeight,prevTop-scrollTop<-fullTabHeight&&top-scrollTop<-fullTabHeight||prevTop-scrollTop>viewportHeight+fullTabHeight&&top-scrollTop>viewportHeight+fullTabHeight)continue}else top=el.getBoundingClientRect().top;moveAnimated.push(el);let dy=prevTop-top;el.style.transform=`translateY(${dy}px)`,el.style.transitionDuration="0s"}}if(forceReflow(),moveAnimated.length){for(let el of moveAnimated)el.style.transform="",el.style.transitionDuration="";forceUpdateHoverState(moveAnimated[moveAnimated.length-1])}if(added.length)for(let el of added)el.style.transitionDuration="",el.classList.remove("-hidden")}prevPositions.clear()});let waitingTransitionEnd;function forceUpdateHoverState(el){waitingTransitionEnd&&waitingTransitionEnd.el.removeEventListener("transitionend",waitingTransitionEnd.cb);let cb=()=>{el.removeEventListener("transitionend",cb),waitingTransitionEnd=void 0,window.requestAnimationFrame(()=>{el.style.left="-1px",forceReflow(),el.style.left=""})};el.addEventListener("transitionend",cb),waitingTransitionEnd={el,cb}}function forceReflow(){document.body.offsetHeight}return(_ctx,_cache)=>(_openBlock14(),_createElementBlock14("div",{class:"AnimatedTabList",ref_key:"rootEl",ref:rootEl},[_renderSlot(_ctx.$slots,"default")],512))}});var _hoisted_129={class:"bottom-space",key:-9999999},_hoisted_228={key:2,class:"bottom-bar-space"},panel_tabs_default=_defineComponent15({__name:"panel.tabs",props:{panel:{}},setup(__props){let props=__props,scrollBox=ref6(null),bottomBarSpaceNeeded=Settings.state.subPanelRecentlyClosedBar||Settings.state.subPanelBookmarks||Settings.state.subPanelHistory,scrollBoxEl=null;onMounted5(()=>{scrollBox.value&&(Sidebar.setPanelScrollBox(props.panel.id,scrollBox.value),scrollBoxEl=scrollBox.value.getScrollBox(),scrollBoxEl&&Sidebar.setPanelEls(props.panel.id,{scrollBox:scrollBoxEl}))});function onDrop(){DnD.reactive.dstType=1}function onMouseDown(e){if(Mouse.setTarget("panel",props.panel.id),!e.target.draggable&&!Selection.isSet()){if(e.button===0){if(Menu.isOpen){Menu.close();return}let la=Settings.state.tabsPanelLeftClickAction;if(la==="prev")return Sidebar.switchPanel(-1);if(la==="expand"){if(!Settings.state.tabsTree)return;let targetTab=Tabs.list.find(t=>t.active);return!targetTab||(targetTab.isParent||(targetTab=Tabs.byId[targetTab.parentId]),!targetTab)?void 0:Tabs.toggleBranch(targetTab.id)}if(la==="tab"){Tabs.createTabInPanel(props.panel);return}if(la==="parent"){if(!Settings.state.tabsTree)return;let activeTab=Tabs.list.find(t=>t.active);if(!activeTab||!Tabs.byId[activeTab.parentId])return;browser.tabs.update(activeTab.parentId,{active:!0})}}if(e.button===1){e.preventDefault();let ma=Settings.state.tabsPanelMiddleClickAction;if(ma==="tab"&&Tabs.createTabInPanel(props.panel),ma==="undo"&&Tabs.undoRmTab(),ma==="rm_act_tab"){let actTab=Tabs.byId[Tabs.activeId];actTab&&actTab.panelId===props.panel.id&&!actTab.pinned&&Tabs.removeTabs([Tabs.activeId])}}if(e.button===2){Menu.blockCtxMenu();let ra=Settings.state.tabsPanelRightClickAction;if(ra==="next")return Sidebar.switchPanel(1);if(ra==="expand"){if(!Settings.state.tabsTree)return;let targetTab=Tabs.list.find(t=>t.active);return!targetTab||(targetTab.isParent||(targetTab=Tabs.byId[targetTab.parentId]),!targetTab)?void 0:Tabs.toggleBranch(targetTab.id)}if(ra==="parent"){if(!Settings.state.tabsTree)return;let activeTab=Tabs.list.find(t=>t.active);if(!activeTab||!Tabs.byId[activeTab.parentId])return;browser.tabs.update(activeTab.parentId,{active:!0})}}}}function onRightMouseUp(e){if(!Mouse.isTarget("tab.close")){if(Mouse.resetTarget(),Mouse.isLocked())return Mouse.resetClickLock();Settings.state.tabsPanelRightClickAction==="menu"&&(Selection.isSet()||(e.stopPropagation(),!Settings.state.ctxMenuNative&&(Selection.selectNavItem(props.panel.id),Menu.open(7,e.clientX,e.clientY))))}}function onNavCtxMenu(e){let sameTarget=Mouse.isCtxTarget("panel",props.panel.id);if(Mouse.resetCtxTarget(),!sameTarget){e.stopPropagation(),e.preventDefault();return}if(Mouse.isLocked()||!Settings.state.ctxMenuNative||e.ctrlKey||e.shiftKey||Selection.isSet()){Mouse.resetClickLock(),e.stopPropagation(),e.preventDefault();return}let nativeCtx={showDefaults:!1};browser.menus.overrideContext(nativeCtx),Selection.isSet()||Selection.selectNavItem(props.panel.id),Menu.open(7)}function onDoubleClick(e){if(!Mouse.isTarget("panel",props.panel.id)||Settings.state.tabsPanelLeftClickAction!=="none")return;let da=Settings.state.tabsPanelDoubleClickAction;if(da==="tab")return Tabs.createTabInPanel(props.panel);if(da==="collapse"){let topLvlTabs=props.panel.tabs.filter(t=>t.lvl===0);if(topLvlTabs.length)return Tabs.foldAllInactiveBranches(topLvlTabs)}da==="undo"&&Tabs.undoRmTab()}let onWheel=Mouse.getWheelDebouncer(2,e=>{if(e.deltaY!==0&&Tabs.blockedScrollPosition&&Tabs.resetScrollRetainer(props.panel),Sidebar.scrollAreaRightX&&e.clientX>Sidebar.scrollAreaRightX||Sidebar.scrollAreaLeftX&&e.clientX<Sidebar.scrollAreaLeftX)return;let stt=Settings.state.scrollThroughTabs,presel=stt==="psp"||stt==="psg",glob=stt==="global"||stt==="psg";if(!(!presel&&Selection.isSet())&&stt!=="none"){if(scrollBoxEl&&Settings.state.scrollThroughTabsExceptOverflow&&scrollBoxEl.scrollHeight>scrollBoxEl.offsetHeight)return;e.preventDefault();let globaly=glob!==e.shiftKey,cyclic=Settings.state.scrollThroughTabsCyclic!==e.ctrlKey;e.deltaY!==0&&Mouse.blockWheel(1),presel?e.deltaY>0?Tabs.switchTabWithPreselect(globaly,cyclic,1):e.deltaY<0&&Tabs.switchTabWithPreselect(globaly,cyclic,-1):e.deltaY>0?Tabs.switchTab(globaly,cyclic,1,!1):e.deltaY<0&&Tabs.switchTab(globaly,cyclic,-1,!1)}});function onMouseLeave(){Tabs.blockedScrollPosition&&Tabs.resetScrollRetainer(props.panel)}return(_ctx,_cache)=>(_openBlock15(),_createElementBlock15("div",{class:"TabsPanel",onWheel:_cache[0]||(_cache[0]=(...args)=>_unref13(onWheel)&&_unref13(onWheel)(...args)),onContextmenu:_withModifiers8(onNavCtxMenu,["stop"]),onMousedown:onMouseDown,onMouseup:_withModifiers8(onRightMouseUp,["right"]),onMouseleave:onMouseLeave,onDblclick:onDoubleClick,onDrop},[_ctx.panel.reactive.pinnedTabIds.length?(_openBlock15(),_createBlock5(bar_pinned_tabs_default,{key:0,panel:_ctx.panel},null,8,["panel"])):_createCommentVNode11("v-if",!0),_createVNode6(scroll_box_default,{ref_key:"scrollBox",ref:scrollBox,preScroll:_unref13(PRE_SCROLL)},{default:_withCtx6(()=>[_createVNode6(dnd_pointer_default,{panelId:_ctx.panel.id,subPanel:!1},null,8,["panelId"]),_createVNode6(animated_tab_list_default,{panel:_ctx.panel},{default:_withCtx6(()=>[_unref13(Tabs).reactive.inlinePreviewPinnedImg?(_openBlock15(),_createElementBlock15("div",{key:0,class:"tab-preview",style:_normalizeStyle6({"--bgi":_unref13(Tabs).reactive.inlinePreviewPinnedImg})},null,4)):_createCommentVNode11("v-if",!0),_unref13(Settings).state.previewTabs&&(_unref13(Settings).state.previewTabsMode==="i"||_unref13(Settings).state.previewTabsPageModeFallback==="i")?(_openBlock15(!0),_createElementBlock15(_Fragment8,{key:1},_renderList8(_ctx.panel.reactive.visibleTabIds,id=>(_openBlock15(),_createElementBlock15(_Fragment8,{key:id},[_createVNode6(tab_default,{tabId:id},null,8,["tabId"]),_unref13(Tabs).reactive.inlinePreviewTabId===id?(_openBlock15(),_createElementBlock15("div",{key:0,class:"tab-preview",style:_normalizeStyle6({"--bgi":_unref13(Tabs).byId[id]?.previewImg})},null,4)):_createCommentVNode11("v-if",!0)],64))),128)):(_openBlock15(!0),_createElementBlock15(_Fragment8,{key:2},_renderList8(_ctx.panel.reactive.visibleTabIds,id=>(_openBlock15(),_createBlock5(tab_default,{key:id,tabId:id},null,8,["tabId"]))),128)),_unref13(Settings).state.showNewTabBtns&&_unref13(Settings).state.newTabBarPosition==="after_tabs"?(_openBlock15(),_createBlock5(bar_new_tab_default,{key:3,panel:_ctx.panel},null,8,["panel"])):_createCommentVNode11("v-if",!0),_createElementVNode12("div",{class:"tab-space-filler",style:_normalizeStyle6({"--filler-height":`${_ctx.panel.reactive.scrollRetainerHeight}px`})},null,4),(_openBlock15(),_createElementBlock15("div",_hoisted_129))]),_:1},8,["panel"])]),_:1},8,["preScroll"]),_unref13(Settings).state.showNewTabBtns&&_unref13(Settings).state.newTabBarPosition==="bottom"?(_openBlock15(),_createBlock5(bar_new_tab_default,{key:1,panel:_ctx.panel},null,8,["panel"])):_createCommentVNode11("v-if",!0),_unref13(bottomBarSpaceNeeded)?(_openBlock15(),_createElementBlock15("div",_hoisted_228)):_createCommentVNode11("v-if",!0),_createVNode6(panel_placeholder_default,{isMsg:!!_unref13(Search).reactive.rawValue&&_ctx.panel.reactive.filteredLen===0,msg:_unref13(translate)("panel.nothing_found")},null,8,["isMsg","msg"])],32))}});import{defineComponent as _defineComponent18}from"/vendor/vue.runtime.esm-browser.prod.js";import{createVNode as _createVNode7,renderList as _renderList9,Fragment as _Fragment9,openBlock as _openBlock18,createElementBlock as _createElementBlock18,createBlock as _createBlock6,createCommentVNode as _createCommentVNode13,withCtx as _withCtx7,unref as _unref15,withModifiers as _withModifiers10}from"/vendor/vue.runtime.esm-browser.prod.js";import{ref as ref7,reactive as reactive4,computed as computed11,watch as watch3,onMounted as onMounted6,nextTick as nextTick2}from"/vendor/vue.runtime.esm-browser.prod.js";import{defineComponent as _defineComponent16}from"/vendor/vue.runtime.esm-browser.prod.js";import{createElementVNode as _createElementVNode13,openBlock as _openBlock16,createElementBlock as _createElementBlock16,toDisplayString as _toDisplayString9,withModifiers as _withModifiers9}from"/vendor/vue.runtime.esm-browser.prod.js";import{computed as computed9}from"/vendor/vue.runtime.esm-browser.prod.js";var _hoisted_130=["id","data-selected","data-open","title"],_hoisted_229={class:"body"},_hoisted_320={class:"line"},_hoisted_416={class:"fav"},_hoisted_515={key:0},_hoisted_615=_createElementVNode13("use",{"xlink:href":"#icon_ff"},null,-1),_hoisted_79=[_hoisted_615],_hoisted_85=["src"],_hoisted_95={class:"title"},_hoisted_106={class:"line"},_hoisted_1111={class:"info"},_hoisted_1210={class:"info -end"},bookmark_card_default=_defineComponent16({__name:"bookmark-card",props:{node:{},panelId:{}},setup(__props){let props=__props,favicon=computed9(()=>props.node.url?getFavicon(props.node.url):""),tooltip=computed9(()=>props.node.url?`${props.node.title}
---
${props.node.url}`:"");function getFolder(node){let folderName=Bookmarks.reactive.byId[node.parentId]?.title??"???";if(folderName.length>36){let folderNameExec=FOLDER_NAME_DATA_RE.exec(folderName);if(folderNameExec)return folderNameExec[1]}return folderName}function getDate(node){let time=node.dateAdded;if(!time)return"???";let dt=new Date(time),day=`${dt.getDate()}`.padStart(2,"0"),hr=`${dt.getHours()}`.padStart(2,"0"),min=`${dt.getMinutes()}`.padStart(2,"0");return`${day}, ${hr}:${min}`}async function onMouseDown(e){if(Mouse.setTarget("bookmark",props.node.id),Menu.close(),e.button===0){if(e.ctrlKey){props.node.sel?Selection.deselectBookmark(props.node.id):Selection.selectBookmark(props.node.id);return}if(e.shiftKey){Selection.isSet()?Selection.selectBookmarksRange(props.node):Selection.selectBookmark(props.node.id);return}}else if(e.button===1){if(e.preventDefault(),Selection.isBookmarks()&&(Selection.resetSelection(),!Search.rawValue))return;let action=Settings.state.bookmarksMidClickAction;if(action==="open_in_new"){let conf=Bookmarks.getMouseOpeningConf(e.button);await Bookmarks.open([props.node.id],conf.dst,conf.useActiveTab,conf.activateFirstTab),conf.removeBookmark&&Bookmarks.removeBookmarks([props.node.id],{noNotif:!0})}else action==="edit"?Bookmarks.editBookmarkNode(props.node):action==="delete"&&Bookmarks.removeBookmarks([props.node.id])}else e.button===2&&!Settings.state.ctxMenuNative&&!props.node.sel&&(Selection.resetSelection(),Mouse.startMultiSelection(e,props.node.id))}function onMouseUp(e){if(e.button===0){if(!Mouse.isTarget("bookmark",props.node.id)||e.ctrlKey||e.shiftKey)return;if(Selection.isBookmarks())return Selection.resetSelection();if(Settings.state.activateOpenBookmarkTab&&props.node.isOpen){let tab=Tabs.list.find(t=>t.url===props.node.url);if(tab){browser.tabs.update(tab.id,{active:!0});return}}if(props.node.type==="bookmark"&&props.node.url){let conf=Bookmarks.getMouseOpeningConf(e.button);Bookmarks.open([props.node.id],conf.dst,conf.useActiveTab,conf.activateFirstTab),conf.removeBookmark&&Bookmarks.removeBookmarks([props.node.id],{noNotif:!0})}}else if(e.button===2){if(e.ctrlKey||e.shiftKey)return;Mouse.stopMultiSelection(),Settings.state.ctxMenuNative||(Selection.isSet()||Selection.selectBookmark(props.node.id),Menu.open(2,e.clientX,e.clientY))}}function onCtxMenu(e){if(!Settings.state.ctxMenuNative||e.ctrlKey||e.shiftKey){e.stopPropagation(),e.preventDefault();return}!e.ctrlKey&&!e.shiftKey&&!props.node.sel&&Selection.resetSelection();let nativeCtx={context:"bookmark",bookmarkId:props.node.id};browser.menus.overrideContext(nativeCtx),Selection.isBookmarks()||Selection.selectBookmark(props.node.id),Menu.open(2)}function onDragStart(e){Menu.close(),Selection.isSet()||Selection.selectBookmark(props.node.id),Sidebar.updateBounds();let id=props.node.id,url=props.node.url??"",dragInfo={type:2,items:[{id,url,title:props.node.title,parentId:props.node.parentId}],windowId:Windows.id,incognito:Windows.incognito,panelId:"bookmarks",x:e.clientX,y:e.clientY};if(DnD.start(dragInfo,2),e.dataTransfer){e.dataTransfer.setData("application/x-sidebery-dnd",JSON.stringify(dragInfo)),(Settings.state.dndOutside==="data"?!e.altKey:e.altKey)&&(e.dataTransfer.setData("text/uri-list",url),e.dataTransfer.setData("text/plain",url));let dragImgEl=document.getElementById("drag_image");dragImgEl&&e.dataTransfer.setDragImage(dragImgEl,-3,-3),e.dataTransfer.effectAllowed="copyMove"}}return(_ctx,_cache)=>(_openBlock16(),_createElementBlock16("div",{class:"BookmarkCard",id:"bookmark"+_ctx.panelId+_ctx.node.id,"data-selected":_ctx.node.sel,"data-open":_ctx.node.isOpen,title:tooltip.value,onMousedown:_withModifiers9(onMouseDown,["stop"]),onMouseup:_withModifiers9(onMouseUp,["stop"]),onContextmenu:_withModifiers9(onCtxMenu,["stop"])},[_createElementVNode13("div",{class:"dnd-layer",draggable:"true","data-dnd-type":"panel","data-dnd-id":"bookmarks",onDragstart:onDragStart},null,32),_createElementVNode13("div",_hoisted_229,[_createElementVNode13("div",_hoisted_320,[_createElementVNode13("div",_hoisted_416,[favicon.value?(_openBlock16(),_createElementBlock16("img",{key:1,src:favicon.value},null,8,_hoisted_85)):(_openBlock16(),_createElementBlock16("svg",_hoisted_515,_hoisted_79))]),_createElementVNode13("div",_hoisted_95,_toDisplayString9(_ctx.node.title),1)]),_createElementVNode13("div",_hoisted_106,[_createElementVNode13("div",_hoisted_1111,_toDisplayString9(getFolder(_ctx.node)),1),_createElementVNode13("div",_hoisted_1210,_toDisplayString9(getDate(_ctx.node)),1)])])],40,_hoisted_130))}});import{defineComponent as _defineComponent17}from"/vendor/vue.runtime.esm-browser.prod.js";import{unref as _unref14,toDisplayString as _toDisplayString10,createElementVNode as _createElementVNode14,openBlock as _openBlock17,createElementBlock as _createElementBlock17}from"/vendor/vue.runtime.esm-browser.prod.js";import{computed as computed10}from"/vendor/vue.runtime.esm-browser.prod.js";var _hoisted_131=["id","data-folded","data-sel"],_hoisted_230={class:"body"},_hoisted_321={class:"title"},_hoisted_417={class:"len"},_hoisted_516=_createElementVNode14("svg",{class:"expand"},[_createElementVNode14("use",{"xlink:href":"#icon_expand"})],-1),sub_list_title_default=_defineComponent17({__name:"sub-list-title",props:{title:{},expanded:{type:Boolean},len:{}},emits:["click"],setup(__props,{emit:__emit}){let props=__props,emit=__emit,id=computed10(()=>"header"+props.title);return(_ctx,_cache)=>(_openBlock17(),_createElementBlock17("div",{class:"SubListTitle",id:id.value,"data-folded":!_ctx.expanded,"data-sel":_unref14(Sidebar).reactive.selectedHeader===id.value,onClick:_cache[0]||(_cache[0]=$event=>emit("click",$event))},[_createElementVNode14("div",_hoisted_230,[_createElementVNode14("div",_hoisted_321,_toDisplayString10(_ctx.title),1),_createElementVNode14("div",_hoisted_417,_toDisplayString10(_ctx.len),1),_hoisted_516])],8,_hoisted_131))}});var _hoisted_136=["data-view-mode"],_hoisted_231={key:0,class:"bookmarks-tree"},_hoisted_323={key:1,class:"bookmarks-history"},_hoisted_418=["data-folded"],_hoisted_517={key:0,class:"group-list"},DEACTIVATION_DELAY=2e3,panel_bookmarks_default=_defineComponent18({__name:"panel.bookmarks",props:{panel:{}},setup(__props,{expose:__expose}){let scrollBoxEl,props=__props,scrollBox=ref7(null),state2=reactive4({unrendered:!1,expandedHistoryGroups:[!0,!0],treeScrollTop:0,historyScrollTop:0,domainsScrollTop:0}),isActive=computed11(()=>props.panel.id===Sidebar.reactive.activePanelId),isFiltering=computed11(()=>!!Search.reactive.value),tree=computed11(()=>props.panel.reactive.filteredBookmarks??props.panel.reactive.bookmarks??[]);function bookmarksWalker(nodes,list){for(let node of nodes)node.url&&node.title&&list.push(node),node.children&&bookmarksWalker(node.children,list)}let history=computed11(()=>{let output=[],group,lastT="",dt,i=0,bookmarksList=props.panel.reactive.filteredBookmarks??[];for(props.panel.reactive.filteredBookmarks||(bookmarksWalker(props.panel.reactive.bookmarks,bookmarksList),bookmarksList.sort((a,b)=>(b.dateAdded??0)-(a.dateAdded??0)));i<bookmarksList.length;i++){let b=bookmarksList[i],date;b.dateAdded!==void 0?(dt=new Date(b.dateAdded),date=`${translate(`time.month_${dt.getMonth()}`)}, ${dt.getFullYear()}`):date="???",lastT!==date&&(lastT=date,group={id:b.id,title:lastT,list:[],ctime:-1},output.push(group)),group&&group.list.push(b)}return output});function getBounds(){let result=[],groupIndex=0,expandedGroupPadding,headerHeight=0,headerHalf=0,headerQuarter=0,bookmarkHeight=0,bookmarkHalf=0,bookmarkQuarter=0,overallHeight=0;for(let group of history.value){if(!headerHeight){let el=document.getElementById(`header${group.title}`);if(!el)return[];if(headerHeight=el.offsetHeight,headerHalf=headerHeight>>1,headerQuarter=(headerHalf>>1)+2,!headerHeight)return[]}if(groupIndex>0&&state2.expandedHistoryGroups[groupIndex-1]){if(expandedGroupPadding===void 0){let groupEl=document.getElementById(`header${group.title}`)?.parentElement;groupEl&&(expandedGroupPadding=groupEl.offsetTop-overallHeight)}expandedGroupPadding&&(overallHeight+=expandedGroupPadding)}result.push({type:3,id:"header"+group.title,index:-1,lvl:0,in:!1,folded:!1,parent:-1,start:overallHeight,top:overallHeight+headerQuarter,center:overallHeight+headerHalf,bottom:overallHeight+headerHalf+headerQuarter,end:overallHeight+headerHeight}),overallHeight+=headerHeight;for(let bookmark of group.list)if(state2.expandedHistoryGroups[groupIndex]){if(!bookmarkHeight){let el=document.getElementById(`bookmark${props.panel.id}${bookmark.id}`);if(!el)return[];if(bookmarkHeight=el.offsetHeight,bookmarkHalf=bookmarkHeight>>1,bookmarkQuarter=(bookmarkHalf>>1)+2,!bookmarkHeight)return[]}result.push({type:2,id:bookmark.id,index:bookmark.index,lvl:0,in:!1,folded:!1,parent:bookmark.parentId,start:overallHeight,top:overallHeight+bookmarkQuarter,center:overallHeight+bookmarkHalf,bottom:overallHeight+bookmarkHalf+bookmarkQuarter,end:overallHeight+bookmarkHeight}),overallHeight+=bookmarkHeight}groupIndex++}return result}let activationTimeout,deactivationTimeout;watch3(isActive,(c,p)=>{clearTimeout(activationTimeout),clearTimeout(deactivationTimeout),c&&!p&&state2.unrendered&&(activationTimeout=setTimeout(()=>{state2.unrendered=!1,nextTick2(()=>{let prevScrollPosition=Sidebar.scrollPositions[props.panel.id];scrollBoxEl&&prevScrollPosition&&(scrollBoxEl.scrollTop=prevScrollPosition)})},120)),!c&&p&&!state2.unrendered&&(deactivationTimeout=setTimeout(()=>{scrollBoxEl?.scrollTop&&(Sidebar.scrollPositions[props.panel.id]=scrollBoxEl?.scrollTop),state2.unrendered=!0},DEACTIVATION_DELAY))}),onMounted6(()=>{props.panel.component=publicInterface,scrollBox.value&&(Sidebar.setPanelScrollBox(props.panel.id,scrollBox.value),scrollBoxEl=scrollBox.value.getScrollBox()??void 0,scrollBoxEl&&Sidebar.setPanelEls(props.panel.id,{scrollBox:scrollBoxEl})),props.panel.id!==Sidebar.activePanelId&&(state2.unrendered=!0)});function onDrop(){DnD.reactive.dstType=2,DnD.reactive.dstParentId===-1&&(DnD.reactive.dstParentId=BKM_OTHER_ID)}function onRightMouseUp(e){Selection.isSet()||(e.stopPropagation(),!Settings.state.ctxMenuNative&&(Selection.selectNavItem(props.panel.id),Menu.open(8,e.clientX,e.clientY)))}function onNavCtxMenu(e){if(!Settings.state.ctxMenuNative||e.ctrlKey||e.shiftKey){e.stopPropagation(),e.preventDefault();return}let nativeCtx={showDefaults:!1};browser.menus.overrideContext(nativeCtx),Selection.isSet()||Selection.selectNavItem(props.panel.id),Menu.open(8)}function toggleHistoryGroup(e,index){if(e&&e.altKey){let value=!state2.expandedHistoryGroups[index];for(let i=0;i<history.value.length;i++)state2.expandedHistoryGroups[i]=value}else state2.expandedHistoryGroups[index]=!state2.expandedHistoryGroups[index]}function toggleGroupById(id){let index=history.value.findIndex(g=>id==="header"+g.title);index!==-1&&toggleHistoryGroup(null,index)}let publicInterface={getBounds,toggleGroupById};return __expose(publicInterface),(_ctx,_cache)=>(_openBlock18(),_createElementBlock18("div",{class:"BookmarksPanel","data-view-mode":_ctx.panel.viewMode,onContextmenu:_withModifiers10(onNavCtxMenu,["stop"]),onMouseup:_withModifiers10(onRightMouseUp,["right"]),onDrop},[_createVNode7(scroll_box_default,{ref_key:"scrollBox",ref:scrollBox},{default:_withCtx7(()=>[!state2.unrendered&&_ctx.panel.reactive.viewMode==="tree"?(_openBlock18(),_createElementBlock18("div",_hoisted_231,[_createVNode7(dnd_pointer_default,{panelId:_ctx.panel.id,subPanel:!1},null,8,["panelId"]),(_openBlock18(!0),_createElementBlock18(_Fragment9,null,_renderList9(tree.value,node=>(_openBlock18(),_createBlock6(bookmark_node_default,{class:"root-node",key:node.id,node,panelId:_ctx.panel.id},null,8,["node","panelId"]))),128))])):_createCommentVNode13("v-if",!0),!state2.unrendered&&_ctx.panel.reactive.viewMode==="history"?(_openBlock18(),_createElementBlock18("div",_hoisted_323,[(_openBlock18(!0),_createElementBlock18(_Fragment9,null,_renderList9(history.value,(group,i)=>(_openBlock18(),_createElementBlock18("div",{class:"group",key:group.id,"data-folded":!state2.expandedHistoryGroups[i]&&!isFiltering.value,"data-dnd-type":"panel","data-dnd-id":"bookmarks"},[_createVNode7(sub_list_title_default,{title:group.title,len:group.list.length,expanded:!!state2.expandedHistoryGroups[i]||isFiltering.value,onClick:$event=>toggleHistoryGroup($event,i)},null,8,["title","len","expanded","onClick"]),state2.expandedHistoryGroups[i]||isFiltering.value?(_openBlock18(),_createElementBlock18("div",_hoisted_517,[(_openBlock18(!0),_createElementBlock18(_Fragment9,null,_renderList9(group.list,bookmark=>(_openBlock18(),_createBlock6(bookmark_card_default,{key:bookmark.id,node:bookmark,panelId:_ctx.panel.id},null,8,["node","panelId"]))),128))])):_createCommentVNode13("v-if",!0)],8,_hoisted_418))),128))])):_createCommentVNode13("v-if",!0)]),_:1},512),_createVNode7(panel_placeholder_default,{isLoading:(state2.unrendered||!_ctx.panel.reactive.ready)&&isActive.value,isNotPerm:!_unref15(Permissions).reactive.bookmarks,permMsg:_unref15(translate)("panel.bookmarks.req_perm"),perm:"bookmarks",isMsg:!tree.value.length,msg:_unref15(translate)("panel.nothing")},null,8,["isLoading","isNotPerm","permMsg","isMsg","msg"])],40,_hoisted_136))}});import{defineComponent as _defineComponent20}from"/vendor/vue.runtime.esm-browser.prod.js";import{unref as _unref17,renderList as _renderList11,Fragment as _Fragment11,openBlock as _openBlock20,createElementBlock as _createElementBlock20,createVNode as _createVNode8,createBlock as _createBlock8,createCommentVNode as _createCommentVNode15,toDisplayString as _toDisplayString12,createElementVNode as _createElementVNode16,withCtx as _withCtx8}from"/vendor/vue.runtime.esm-browser.prod.js";import{ref as ref9,computed as computed13,reactive as reactive5,onMounted as onMounted7}from"/vendor/vue.runtime.esm-browser.prod.js";import{defineComponent as _defineComponent19}from"/vendor/vue.runtime.esm-browser.prod.js";import{unref as _unref16,createElementVNode as _createElementVNode15,openBlock as _openBlock19,createElementBlock as _createElementBlock19,createCommentVNode as _createCommentVNode14,withModifiers as _withModifiers11,toDisplayString as _toDisplayString11,createTextVNode as _createTextVNode,renderList as _renderList10,Fragment as _Fragment10,resolveComponent as _resolveComponent,createBlock as _createBlock7}from"/vendor/vue.runtime.esm-browser.prod.js";import{ref as ref8,computed as computed12}from"/vendor/vue.runtime.esm-browser.prod.js";var _hoisted_137=["id"],_hoisted_234=["title","data-sel"],_hoisted_324={class:"title-line"},_hoisted_419=["title"],_hoisted_518={key:0},_hoisted_616=_createElementVNode15("use",{"xlink:href":"#icon_ff"},null,-1),_hoisted_710=[_hoisted_616],_hoisted_86=["src"],_hoisted_96={class:"title"},_hoisted_107={class:"url-line"},_hoisted_1112={class:"url"},_hoisted_1211={class:"inltm"},_hoisted_138={class:"time"},_hoisted_146={class:"more"},__default__={name:"HistoryItem"},history_item_default=_defineComponent19({...__default__,props:{visit:{}},setup(__props){let moreActive=ref8(!1),props=__props,favicon=computed12(()=>reactive2.byDomains[props.visit.domain]);function onMouseDown(e,visit){if(Mouse.setTarget("history",visit.id),Menu.close(),e.button===0){if(e.ctrlKey){visit.reactive.sel?Selection.deselectHistory(visit.id):Selection.selectHistory(visit.id);return}}else e.button===1?(e.preventDefault(),Mouse.blockWheel()):e.button===2&&!Settings.state.ctxMenuNative&&!visit.reactive.sel&&Selection.resetSelection()}function onMouseUp(e,visit){let sameTarget=Mouse.isTarget("history",visit.id);if(Mouse.resetTarget(),Mouse.stopLongClick(),!!sameTarget){if(e.button===0||e.button===1){if(Selection.isHistory()&&!Search.rawValue)return Selection.resetSelection();if(e.button===1&&Settings.state.historyMidClickAction==="forget_visit")return History.deleteVisits([visit.id]);let conf=History.getMouseOpeningConf(e.button);Search.rawValue&&conf.activateFirstTab&&(Search.stop(),Selection.resetSelection()),History.open(visit,conf.dst,conf.useActiveTab,conf.activateFirstTab)}if(e.button===2){if(e.ctrlKey||e.shiftKey||Menu.isBlocked())return;!Selection.isSet()&&!Settings.state.ctxMenuNative&&Selection.selectHistory(visit.id),Settings.state.ctxMenuNative||Menu.open(3,e.clientX,e.clientY)}}}function onMoreClick(){moreActive.value=!0}function onFavMouseDown(e,visit){if(!visit.url)return;let domain=getDomainOf(visit.url);domain!==visit.url&&(Selection.resetSelection(),Search.showBar(),Search.onOutsideSearchInput(domain))}function onCtxMenu(e,visit){if(Mouse.isLocked()||!Settings.state.ctxMenuNative||e.ctrlKey||e.shiftKey){Mouse.resetClickLock(),e.stopPropagation(),e.preventDefault();return}if(!e.ctrlKey&&!e.shiftKey&&!visit.reactive.sel&&Selection.resetSelection(),Menu.isBlocked()){e.stopPropagation(),e.preventDefault();return}browser.menus.overrideContext({showDefaults:!1}),Selection.isSet()||Selection.selectHistory(visit.id),Menu.open(3)}function onDragStart(e,visit){Menu.close(),Selection.isSet()||Selection.selectHistory(visit.id),Sidebar.updateBounds();let dragInfo={type:5,items:[{id:visit.id,url:visit.url,title:visit.title}],windowId:Windows.id,x:e.clientX,y:e.clientY};if(DnD.start(dragInfo),e.dataTransfer){let url=visit.decodedUrl??"",dragImgEl=document.getElementById("drag_image");e.dataTransfer.setData("application/x-sidebery-dnd",JSON.stringify(dragInfo)),(Settings.state.dndOutside==="data"?!e.altKey:e.altKey)&&(e.dataTransfer.setData("text/uri-list",url),e.dataTransfer.setData("text/plain",url)),dragImgEl&&e.dataTransfer.setDragImage(dragImgEl,-3,-3),e.dataTransfer.effectAllowed="copyMove"}}return(_ctx,_cache)=>{let _component_HistoryItem=_resolveComponent("HistoryItem",!0);return _openBlock19(),_createElementBlock19("div",{class:"item",id:"history"+_ctx.visit.id},[_createElementVNode15("div",{class:"body",title:_ctx.visit.reactive.tooltip,"data-sel":_ctx.visit.reactive.sel,onMousedown:_cache[1]||(_cache[1]=_withModifiers11($event=>onMouseDown($event,_ctx.visit),["stop"])),onMouseup:_cache[2]||(_cache[2]=_withModifiers11($event=>onMouseUp($event,_ctx.visit),["stop"])),onContextmenu:_cache[3]||(_cache[3]=_withModifiers11($event=>onCtxMenu($event,_ctx.visit),["stop"])),draggable:"true",onDragstart:_cache[4]||(_cache[4]=$event=>onDragStart($event,_ctx.visit))},[_createElementVNode15("div",_hoisted_324,[_createElementVNode15("div",{class:"fav",title:_unref16(translate)("panel.history.fav_tooltip"),onMousedown:_cache[0]||(_cache[0]=_withModifiers11($event=>onFavMouseDown($event,_ctx.visit),["stop"]))},[favicon.value?(_openBlock19(),_createElementBlock19("img",{key:1,src:favicon.value},null,8,_hoisted_86)):(_openBlock19(),_createElementBlock19("svg",_hoisted_518,_hoisted_710))],40,_hoisted_419),_createElementVNode15("div",_hoisted_96,_toDisplayString11(_ctx.visit.reactive.title),1)]),_createElementVNode15("div",_hoisted_107,[_createElementVNode15("div",_hoisted_1112,[_createTextVNode(_toDisplayString11(_ctx.visit.decodedUrl),1),_createElementVNode15("div",_hoisted_1211,"-"+_toDisplayString11(_ctx.visit.timeStr),1)]),_createElementVNode15("div",_hoisted_138,_toDisplayString11(_ctx.visit.timeStr),1)])],40,_hoisted_234),_ctx.visit.reactive.moreVisits?(_openBlock19(),_createElementBlock19(_Fragment10,{key:0},[!moreActive.value&&!_unref16(Search).reactive.rawValue?(_openBlock19(),_createElementBlock19("div",{key:0,class:"body -more",onClick:onMoreClick},[_createElementVNode15("div",_hoisted_146,_toDisplayString11(_unref16(translate)("panel.history.show_more"))+" "+_toDisplayString11(_ctx.visit.reactive.moreVisits.length),1)])):(_openBlock19(!0),_createElementBlock19(_Fragment10,{key:1},_renderList10(_ctx.visit.reactive.moreVisits,visitId=>(_openBlock19(),_createBlock7(_component_HistoryItem,{key:visitId,visit:_unref16(History).byId[visitId]},null,8,["visit"]))),128))],64)):_createCommentVNode14("v-if",!0)],8,_hoisted_137)}}});var _hoisted_139={class:"HistoryPanel panel"},_hoisted_235={key:0,class:"history-groups"},_hoisted_325=["data-folded"],_hoisted_420={key:0,class:"group-list"},_hoisted_519=["data-loading","data-all-loaded"],panel_history_default=_defineComponent20({__name:"panel.history",props:{isSubPanel:{type:Boolean}},setup(__props){let props=__props,scrollBox=ref9(null),state2=reactive5({expandedHistoryDays:[!0],historyLoading:!1,allLoaded:!1});onMounted7(()=>{scrollBox.value&&(Sidebar.subPanelActive&&Sidebar.subPanelType===3?History.subPanelScrollEl=scrollBox.value.getScrollBox():History.panelScrollEl=scrollBox.value.getScrollBox())});let isHidden=computed13(()=>!props.isSubPanel&&Sidebar.reactive.subPanelActive&&Sidebar.reactive.subPanelType===3),isFiltering=computed13(()=>!!Search.reactive.value);function toggleHistoryGroup(e,index){if(e.altKey){let value=!state2.expandedHistoryDays[index];for(let i=0;i<History.reactive.days.length;i++)state2.expandedHistoryDays[i]=value}else state2.expandedHistoryDays[index]=!state2.expandedHistoryDays[index]}async function onScrollBottom(){state2.historyLoading||History.allLoaded||isFiltering.value||History.ready&&(state2.historyLoading=!0,await sleep(250),await History.loadMore(),state2.historyLoading=!1,History.allLoaded&&(state2.allLoaded=!0))}return(_ctx,_cache)=>(_openBlock20(),_createElementBlock20("div",_hoisted_139,[_createVNode8(scroll_box_default,{ref_key:"scrollBox",ref:scrollBox,onBottom:onScrollBottom},{default:_withCtx8(()=>[isHidden.value?_createCommentVNode15("v-if",!0):(_openBlock20(),_createElementBlock20("div",_hoisted_235,[(_openBlock20(!0),_createElementBlock20(_Fragment11,null,_renderList11(_unref17(History).reactive.days,(day,i)=>(_openBlock20(),_createElementBlock20("div",{class:"group",key:day.title,"data-folded":!state2.expandedHistoryDays[i]&&!isFiltering.value},[_createVNode8(sub_list_title_default,{title:day.title,len:day.visits.length,expanded:!!state2.expandedHistoryDays[i]||isFiltering.value,onClick:$event=>toggleHistoryGroup($event,i)},null,8,["title","len","expanded","onClick"]),state2.expandedHistoryDays[i]||isFiltering.value?(_openBlock20(),_createElementBlock20("div",_hoisted_420,[(_openBlock20(!0),_createElementBlock20(_Fragment11,null,_renderList11(day.visits,visitId=>(_openBlock20(),_createBlock8(history_item_default,{key:visitId,visit:_unref17(History).byId[visitId]},null,8,["visit"]))),128))])):_createCommentVNode15("v-if",!0)],8,_hoisted_325))),128)),_createElementVNode16("div",{class:"controls","data-loading":state2.historyLoading,"data-all-loaded":state2.allLoaded},[_createElementVNode16("div",{class:"note",onClick:onScrollBottom},_toDisplayString12(_unref17(translate)("panel.history.load_more")),1)],8,_hoisted_519),state2.historyLoading?(_openBlock20(),_createBlock8(loading_dots_default,{key:0})):_createCommentVNode15("v-if",!0)]))]),_:1},512),_createVNode8(panel_placeholder_default,{isLoading:_unref17(History).reactive.loading,isNotPerm:!_unref17(Permissions).reactive.history,permMsg:_unref17(translate)("panel.history.req_perm"),perm:"history",isMsg:!_unref17(History).reactive.days.length,msg:_unref17(translate)("panel.nothing")},null,8,["isLoading","isNotPerm","permMsg","isMsg","msg"])]))}});import{defineComponent as _defineComponent21}from"/vendor/vue.runtime.esm-browser.prod.js";import{unref as _unref18,createElementVNode as _createElementVNode17,openBlock as _openBlock21,createElementBlock as _createElementBlock21,withModifiers as _withModifiers12,toDisplayString as _toDisplayString13,vModelText as _vModelText2,withDirectives as _withDirectives4,createCommentVNode as _createCommentVNode16}from"/vendor/vue.runtime.esm-browser.prod.js";import{ref as ref10,onMounted as onMounted8}from"/vendor/vue.runtime.esm-browser.prod.js";var _hoisted_140=["data-showed","data-active","data-focused","data-filled"],_hoisted_236=_createElementVNode17("svg",null,[_createElementVNode17("use",{"xlink:href":"#icon_search"})],-1),_hoisted_326=[_hoisted_236],_hoisted_421={class:"placeholder"},_hoisted_520=_createElementVNode17("svg",null,[_createElementVNode17("use",{"xlink:href":"#icon_remove"})],-1),_hoisted_617=[_hoisted_520],bar_search_default=_defineComponent21({__name:"bar.search",setup(__props){let textEl=ref10(null);onMounted8(()=>{textEl.value&&Search.registerInputEl(textEl.value)});function onClearBtnMouseDown(e){Search.rawValue?Search.onOutsideSearchInput(""):(Search.hideBar(),e.preventDefault())}function onClearBtnMouseUp(){Search.focus()}function onKD(e){Search.shortcuts.bookmarks&&Search.shortcuts.bookmarks.key===e.key&&Search.shortcuts.bookmarks.ctrl===e.ctrlKey&&Search.shortcuts.bookmarks.alt===e.altKey&&Search.shortcuts.bookmarks.meta===e.metaKey?(e.preventDefault(),e.stopPropagation(),Search.bookmarks()):Search.shortcuts.history&&Search.shortcuts.history.key===e.key&&Search.shortcuts.history.ctrl===e.ctrlKey&&Search.shortcuts.history.alt===e.altKey&&Search.shortcuts.history.meta===e.metaKey&&(e.preventDefault(),e.stopPropagation(),Search.history()),Search.rawValue&&(e.code==="KeyA"&&e.ctrlKey&&e.shiftKey?(e.preventDefault(),Search.selectAll()):e.key==="ArrowDown"?(e.preventDefault(),Search.next()):e.key==="ArrowUp"?(e.preventDefault(),Search.prev()):e.key==="Enter"&&!e.altKey?(e.preventDefault(),Search.enter()):e.key==="ContextMenu"&&(e.preventDefault(),Search.menu()))}let inputTimeout;function onInput(e){Search.rawValue=e.target?.value??"",clearTimeout(inputTimeout),inputTimeout=setTimeout(()=>{Search.search(e.target?.value)},Search.INPUT_TIMEOUT)}function onChange(e){Search.search(Search.rawValue)}function onFocus(e){Search.reactive.barIsActive=!0,Search.reactive.barIsFocused=!0}function onBlur(e){Search.reactive.barIsActive=!1,Search.reactive.barIsFocused=!1}return(_ctx,_cache)=>(_openBlock21(),_createElementBlock21("div",{class:"SearchBar",id:"search_bar","data-showed":_unref18(Settings).state.searchBarMode==="static"||_unref18(Search).reactive.barIsShowed,"data-active":_unref18(Search).reactive.barIsActive,"data-focused":_unref18(Search).reactive.barIsFocused,"data-filled":!!_unref18(Search).reactive.rawValue},[_createElementVNode17("div",{class:"search-icon",onMousedown:_cache[0]||(_cache[0]=_withModifiers12(()=>{},["stop","prevent"])),onMouseup:_cache[1]||(_cache[1]=_withModifiers12(()=>{},["stop","prevent"]))},_hoisted_326,32),_createElementVNode17("div",_hoisted_421,_toDisplayString13(_unref18(translate)("bar.search.placeholder")),1),_withDirectives4(_createElementVNode17("input",{class:"input",ref_key:"textEl",ref:textEl,autocomplete:"off",autocorrect:"off",autocapitalize:"off",spellcheck:"false",tabindex:"-1","onUpdate:modelValue":_cache[2]||(_cache[2]=$event=>_unref18(Search).reactive.rawValue=$event),onInputPassive:onInput,onFocus,onBlur,onChange,onKeydown:onKD},null,544),[[_vModelText2,_unref18(Search).reactive.rawValue]]),_unref18(Settings).state.searchBarMode==="dynamic"||_unref18(Search).reactive.rawValue?(_openBlock21(),_createElementBlock21("div",{key:0,class:"clear-btn",onMousedown:_withModifiers12(onClearBtnMouseDown,["stop"]),onMouseup:_withModifiers12(onClearBtnMouseUp,["stop"])},_hoisted_617,32)):_createCommentVNode16("v-if",!0)],8,_hoisted_140))}});import{defineComponent as _defineComponent22}from"/vendor/vue.runtime.esm-browser.prod.js";import{toDisplayString as _toDisplayString14,createElementVNode as _createElementVNode18,unref as _unref19,createVNode as _createVNode9,openBlock as _openBlock22,createElementBlock as _createElementBlock22,createCommentVNode as _createCommentVNode17,normalizeClass as _normalizeClass3,withModifiers as _withModifiers13}from"/vendor/vue.runtime.esm-browser.prod.js";import{ref as ref11,computed as computed14,onMounted as onMounted9}from"/vendor/vue.runtime.esm-browser.prod.js";var _hoisted_141={class:"field"},_hoisted_237={class:"field-label"},_hoisted_327={class:"field"},_hoisted_422={class:"field-label"},_hoisted_521={class:"field"},_hoisted_618={class:"field-label"},_hoisted_711={class:"ctrls"},popup_panel_config_default=_defineComponent22({__name:"popup.panel-config",setup(__props){let TABS_PANEL_ICON_OPTS=[{value:"icon_tabs",icon:"#icon_tabs"},...PANEL_ICON_OPTS],BOOKMARKS_PANEL_ICON_OPTS=[{value:"icon_bookmarks",icon:"#icon_bookmarks"},...PANEL_ICON_OPTS],titleInput=ref11(null);onMounted9(()=>{titleInput.value?.focus()});let valid=computed14(()=>reactive.panelConfigPopup?!!reactive.panelConfigPopup.config.name:!1),panelExists=computed14(()=>reactive.panelConfigPopup?!!Sidebar.panelsById[reactive.panelConfigPopup.config.id]:!1),popupTitle=computed14(()=>{if(!reactive.panelConfigPopup)return"";let popup=reactive.panelConfigPopup;return isTabsPanel(popup.config)?translate("popup.tabs_panel.title"):isBookmarksPanel(popup.config)?translate("popup.bookmarks_panel.title"):""}),iconsOpts=computed14(()=>{if(!reactive.panelConfigPopup)return[];let popup=reactive.panelConfigPopup;return isTabsPanel(popup.config)?TABS_PANEL_ICON_OPTS:isBookmarksPanel(popup.config)?BOOKMARKS_PANEL_ICON_OPTS:[]});function onTitleKD(e){e.key==="Enter"&&(e.preventDefault(),onSave())}function openFullConfig(){!reactive.panelConfigPopup||!panelExists.value||(SetupPage.open(`settings_nav.${reactive.panelConfigPopup.config.id}`),reactive.panelConfigPopup.done(null),reactive.panelConfigPopup=null)}function onSave(){if(!reactive.panelConfigPopup)return;let popup=reactive.panelConfigPopup;if(!valid.value)return;let panel=Sidebar.panelsById[popup.config.id];if(panel)updateObject(panel,popup.config,["name","iconSVG","color"]),panel.reactive.name=panel.name,panel.reactive.color=panel.color,panel.reactive.iconSVG=panel.iconSVG,panel.reactive.hidden=panel.hidden,panel.reactive.tooltip=Sidebar.getPanelTooltip(panel),Sidebar.saveSidebar();else{let isTabsPanel2=isTabsPanel(popup.config),isBookmarksPanel2=isBookmarksPanel(popup.config);if(isTabsPanel2)panel=Sidebar.createTabsPanel(popup.config);else if(isBookmarksPanel2)panel=Sidebar.createBookmarksPanel(popup.config);else return;panel.reactive.name=panel.name,panel.reactive.color=panel.color,panel.reactive.iconSVG=panel.iconSVG,panel.reactive.hidden=panel.hidden,popup.index!==void 0&&popup.index>=0?panel.index=popup.index:panel.index===-1&&(isTabsPanel2?panel.index=findLastIndex(Sidebar.reactive.nav,id=>isTabsPanel(Sidebar.panelsById[id])):isBookmarksPanel2&&(panel.index=findLastIndex(Sidebar.reactive.nav,id=>isBookmarksPanel(Sidebar.panelsById[id]))),panel.index===-1?panel.index=Sidebar.reactive.nav.length:panel.index++),panel.id||(panel.id=uid()),Sidebar.panelsById[panel.id]=panel,Sidebar.reactive.nav.splice(panel.index,0,panel.id),Sidebar.recalcPanels(),isTabsPanel2?Sidebar.recalcTabsPanels():isBookmarksPanel2&&Sidebar.recalcBookmarksPanels(),Sidebar.saveSidebar(300)}Settings.state.updateSidebarTitle&&Sidebar.activePanelId===panel.id&&Sidebar.updateSidebarTitle(),reactive.panelConfigPopup.done(panel.id),reactive.panelConfigPopup=null}function onCancel(){reactive.panelConfigPopup&&(reactive.panelConfigPopup.done(null),reactive.panelConfigPopup=null)}return(_ctx,_cache)=>(_openBlock22(),_createElementBlock22("div",{class:"PanelConfigPopup popup-container",onClick:onCancel},[reactive.panelConfigPopup?(_openBlock22(),_createElementBlock22("div",{key:0,class:"popup",onClick:_cache[3]||(_cache[3]=_withModifiers13(()=>{},["stop"]))},[_createElementVNode18("h2",null,_toDisplayString14(popupTitle.value),1),_createElementVNode18("div",_hoisted_141,[_createElementVNode18("div",_hoisted_237,_toDisplayString14(_unref19(translate)("popup.common.name_label")),1),_createVNode9(text_input_default,{class:"input",ref_key:"titleInput",ref:titleInput,value:reactive.panelConfigPopup.config.name,"onUpdate:value":_cache[0]||(_cache[0]=$event=>reactive.panelConfigPopup.config.name=$event),or:"Panel name",tabindex:"-1",line:!0,onKeydown:onTitleKD},null,8,["value"])]),_createElementVNode18("div",_hoisted_327,[_createElementVNode18("div",_hoisted_422,_toDisplayString14(_unref19(translate)("popup.common.icon_label")),1),_createVNode9(select_input_default,{class:"input",value:reactive.panelConfigPopup.config.iconSVG,"onUpdate:value":_cache[1]||(_cache[1]=$event=>reactive.panelConfigPopup.config.iconSVG=$event),opts:iconsOpts.value,color:reactive.panelConfigPopup.config.color},null,8,["value","opts","color"])]),_createElementVNode18("div",_hoisted_521,[_createElementVNode18("div",_hoisted_618,_toDisplayString14(_unref19(translate)("popup.common.color_label")),1),_createVNode9(select_input_default,{class:"input",value:reactive.panelConfigPopup.config.color,"onUpdate:value":_cache[2]||(_cache[2]=$event=>reactive.panelConfigPopup.config.color=$event),opts:_unref19(COLOR_OPTS),icon:"#"+reactive.panelConfigPopup.config.iconSVG},null,8,["value","opts","icon"])]),_createElementVNode18("div",_hoisted_711,[panelExists.value?(_openBlock22(),_createElementBlock22("div",{key:0,class:"btn -wide",onClick:openFullConfig},_toDisplayString14(_unref19(translate)("popup.common.btn_more")),1)):_createCommentVNode17("v-if",!0),panelExists.value?(_openBlock22(),_createElementBlock22("div",{key:1,class:_normalizeClass3(["btn",{"-inactive":!valid.value}]),onClick:onSave},_toDisplayString14(_unref19(translate)("btn.save")),3)):(_openBlock22(),_createElementBlock22("div",{key:2,class:_normalizeClass3(["btn",{"-inactive":!valid.value}]),onClick:onSave},_toDisplayString14(_unref19(translate)("btn.create")),3)),_createElementVNode18("div",{class:"btn -warn",onClick:onCancel},_toDisplayString14(_unref19(translate)("btn.cancel")),1)])])):_createCommentVNode17("v-if",!0)]))}});import{defineComponent as _defineComponent23}from"/vendor/vue.runtime.esm-browser.prod.js";import{unref as _unref20,toDisplayString as _toDisplayString15,createElementVNode as _createElementVNode19,createVNode as _createVNode10,openBlock as _openBlock23,createElementBlock as _createElementBlock23,createCommentVNode as _createCommentVNode18,normalizeClass as _normalizeClass4,withModifiers as _withModifiers14}from"/vendor/vue.runtime.esm-browser.prod.js";import{ref as ref12,computed as computed15,onMounted as onMounted10}from"/vendor/vue.runtime.esm-browser.prod.js";var _hoisted_147={class:"field"},_hoisted_238={class:"field-label"},_hoisted_328={class:"field"},_hoisted_423={class:"field-label"},_hoisted_522={class:"field"},_hoisted_619={class:"field-label"},_hoisted_712={class:"ctrls"},popup_container_config_default=_defineComponent23({__name:"popup.container-config",setup(__props){let titleInput=ref12(null),container=computed15(()=>reactive.containerConfigPopup?Containers.reactive.byId[reactive.containerConfigPopup.id]??null:null),valid=computed15(()=>reactive.containerConfigPopup?!!reactive.containerConfigPopup.name:!1);onMounted10(()=>{titleInput.value?.focus()});function onTitleKD(e){e.key==="Enter"&&(e.preventDefault(),onSave())}function openFullConfig(){!reactive.containerConfigPopup||!container.value||(SetupPage.open(`settings_containers.${reactive.containerConfigPopup.id}`),reactive.containerConfigPopup.done(null),reactive.containerConfigPopup=null)}async function onSave(){if(!reactive.containerConfigPopup)return;let popup=reactive.containerConfigPopup;if(!valid.value)return;let container2=Containers.reactive.byId[reactive.containerConfigPopup.id];container2?(container2.name=reactive.containerConfigPopup.name,container2.icon=reactive.containerConfigPopup.icon,container2.color=reactive.containerConfigPopup.color,await browser.contextualIdentities.update(container2.id,{name:reactive.containerConfigPopup.name,icon:reactive.containerConfigPopup.icon,color:reactive.containerConfigPopup.color})):container2=await Containers.create(popup.name,popup.color,popup.icon),reactive.containerConfigPopup.done(container2.id),reactive.containerConfigPopup=null}function onCancel(){reactive.containerConfigPopup&&(reactive.containerConfigPopup.done(null),reactive.containerConfigPopup=null)}return(_ctx,_cache)=>(_openBlock23(),_createElementBlock23("div",{class:"ContainerConfigPopup popup-container",onClick:onCancel},[reactive.containerConfigPopup?(_openBlock23(),_createElementBlock23("div",{key:0,class:"popup",onClick:_cache[3]||(_cache[3]=_withModifiers14(()=>{},["stop"]))},[_createElementVNode19("h2",null,_toDisplayString15(_unref20(translate)("popup.container.title")),1),_createElementVNode19("div",_hoisted_147,[_createElementVNode19("div",_hoisted_238,_toDisplayString15(_unref20(translate)("popup.common.name_label")),1),_createVNode10(text_input_default,{class:"input",ref_key:"titleInput",ref:titleInput,value:reactive.containerConfigPopup.name,"onUpdate:value":_cache[0]||(_cache[0]=$event=>reactive.containerConfigPopup.name=$event),or:_unref20(translate)("popup.container.name_placeholder"),tabindex:"-1",line:!0,onKeydown:onTitleKD},null,8,["value","or"])]),_createElementVNode19("div",_hoisted_328,[_createElementVNode19("div",_hoisted_423,_toDisplayString15(_unref20(translate)("popup.common.icon_label")),1),_createVNode10(select_input_default,{class:"input",value:reactive.containerConfigPopup.icon,"onUpdate:value":_cache[1]||(_cache[1]=$event=>reactive.containerConfigPopup.icon=$event),opts:_unref20(CONTAINER_ICON_OPTS),color:reactive.containerConfigPopup.color},null,8,["value","opts","color"])]),_createElementVNode19("div",_hoisted_522,[_createElementVNode19("div",_hoisted_619,_toDisplayString15(_unref20(translate)("popup.common.color_label")),1),_createVNode10(select_input_default,{class:"input",value:reactive.containerConfigPopup.color,"onUpdate:value":_cache[2]||(_cache[2]=$event=>reactive.containerConfigPopup.color=$event),opts:_unref20(COLOR_OPTS),icon:"#"+reactive.containerConfigPopup.icon},null,8,["value","opts","icon"])]),_createElementVNode19("div",_hoisted_712,[container.value?(_openBlock23(),_createElementBlock23("div",{key:0,class:"btn -wide",onClick:openFullConfig},_toDisplayString15(_unref20(translate)("popup.common.btn_more")),1)):_createCommentVNode18("v-if",!0),container.value?(_openBlock23(),_createElementBlock23("div",{key:1,class:_normalizeClass4(["btn",{"-inactive":!valid.value}]),onClick:onSave},_toDisplayString15(_unref20(translate)("btn.save")),3)):(_openBlock23(),_createElementBlock23("div",{key:2,class:_normalizeClass4(["btn",{"-inactive":!valid.value}]),onClick:onSave},_toDisplayString15(_unref20(translate)("btn.create")),3)),_createElementVNode19("div",{class:"btn -warn",onClick:onCancel},_toDisplayString15(_unref20(translate)("btn.cancel")),1)])])):_createCommentVNode18("v-if",!0)]))}});import{defineComponent as _defineComponent24}from"/vendor/vue.runtime.esm-browser.prod.js";import{unref as _unref21,toDisplayString as _toDisplayString16,createElementVNode as _createElementVNode20,createVNode as _createVNode11,withModifiers as _withModifiers15,openBlock as _openBlock24,createElementBlock as _createElementBlock24,createCommentVNode as _createCommentVNode19}from"/vendor/vue.runtime.esm-browser.prod.js";import{ref as ref13,onMounted as onMounted11}from"/vendor/vue.runtime.esm-browser.prod.js";var _hoisted_148={class:"field"},_hoisted_239={class:"field-label"},_hoisted_329={class:"ctrls"},popup_group_config_default=_defineComponent24({__name:"popup.group-config",setup(__props){let titleInput=ref13(null),doNotShowAgain=ref13(!Settings.state.showNewGroupConf);onMounted11(()=>{titleInput.value?.focus(),titleInput.value?.selectAll()});function onTitleKD(e){e.key==="Enter"&&(e.preventDefault(),onOk())}function onOk(){reactive.groupConfigPopup&&(doNotShowAgain.value!==!Settings.state.showNewGroupConf&&(Settings.state.showNewGroupConf=!doNotShowAgain.value,Settings.saveDebounced(150)),reactive.groupConfigPopup.done(1),reactive.groupConfigPopup=null)}function onCancel(){reactive.groupConfigPopup&&(reactive.groupConfigPopup.done(2),reactive.groupConfigPopup=null)}return(_ctx,_cache)=>(_openBlock24(),_createElementBlock24("div",{class:"GroupConfigPopup popup-container",onClick:onCancel},[reactive.groupConfigPopup?(_openBlock24(),_createElementBlock24("div",{key:0,class:"popup",onClick:_cache[2]||(_cache[2]=_withModifiers15(()=>{},["stop"]))},[_createElementVNode20("h2",null,_toDisplayString16(_unref21(translate)("popup.group_config.popup_title")),1),_createElementVNode20("div",_hoisted_148,[_createElementVNode20("div",_hoisted_239,_toDisplayString16(_unref21(translate)("popup.group_config.title")),1),_createVNode11(text_input_default,{class:"input",ref_key:"titleInput",ref:titleInput,value:reactive.groupConfigPopup.config.title,"onUpdate:value":_cache[0]||(_cache[0]=$event=>reactive.groupConfigPopup.config.title=$event),or:_unref21(translate)("popup.group_config.title_placeholder"),tabindex:"-1",line:!0,onKeydown:onTitleKD},null,8,["value","or"])]),_createVNode11(toggle_field_default,{class:"-no-separator",label:"popup.group_config.do_not_show_again",value:doNotShowAgain.value,"onUpdate:value":_cache[1]||(_cache[1]=$event=>doNotShowAgain.value=$event)},null,8,["value"]),_createElementVNode20("div",_hoisted_329,[_createElementVNode20("div",{class:"btn",onClick:onOk},_toDisplayString16(_unref21(translate)("btn.create")),1),_createElementVNode20("div",{class:"btn -warn",onClick:onCancel},_toDisplayString16(_unref21(translate)("btn.cancel")),1)])])):_createCommentVNode19("v-if",!0)]))}});import{defineComponent as _defineComponent25}from"/vendor/vue.runtime.esm-browser.prod.js";import{unref as _unref22,toDisplayString as _toDisplayString17,createElementVNode as _createElementVNode21,renderList as _renderList12,Fragment as _Fragment12,openBlock as _openBlock25,createElementBlock as _createElementBlock25,createCommentVNode as _createCommentVNode20,createBlock as _createBlock9,createVNode as _createVNode12,normalizeClass as _normalizeClass5,withModifiers as _withModifiers16}from"/vendor/vue.runtime.esm-browser.prod.js";import{ref as ref14,computed as computed16}from"/vendor/vue.runtime.esm-browser.prod.js";var _hoisted_149={key:0,class:"popup"},_hoisted_240=_createElementVNode21("div",{class:"space"},null,-1),_hoisted_330={class:"note"},_hoisted_424={key:0,class:"match-options"},_hoisted_523=["title","data-active","onClick"],_hoisted_620={class:"label"},_hoisted_713=_createElementVNode21("div",{class:"space"},null,-1),_hoisted_87=_createElementVNode21("div",{class:"space"},null,-1),_hoisted_97={class:"sub-field"},_hoisted_108=_createElementVNode21("div",{class:"space"},null,-1),_hoisted_1113={class:"ctrls"},popup_site_config_default=_defineComponent25({__name:"popup.site-config",setup(__props){let matchOptions=ref14(null),matchTextField=ref14(!1),matchString=ref14(""),reopenInContainerId=ref14("none"),moveToPanelId=ref14("none"),moveToPanelTopLvlOnly=ref14(!0),existedRules=ref14(!1),saveBtnActive=computed16(()=>{if(!reactive.siteConfigPopup||!matchString.value.trim())return!1;let reopen=reopenInContainerId.value!=="none",move=moveToPanelId.value!=="none";return reopen||move||existedRules.value}),availableContainerOpts=computed16(()=>{if(!reactive.siteConfigPopup)return[];let result=[{value:"none",color:"inactive",icon:"#icon_none",title:"Not set"}];for(let c of Object.values(Containers.reactive.byId))result.push({value:c.id,color:c.color,icon:"#"+c.icon,title:c.name,tooltip:c.name});return result}),availablePanelOpts=computed16(()=>{if(!reactive.siteConfigPopup)return[];let result=[{value:"none",color:"inactive",icon:"#icon_none",title:"Not set"}];for(let p of Sidebar.panels){if(!isTabsPanel(p))continue;let opt={value:p.id,color:p.color,title:p.name};p.iconIMG?opt.icon=p.iconIMG:opt.icon="#"+p.iconSVG,result.push(opt)}return result});function init(){if(!reactive.siteConfigPopup)return;let url=reactive.siteConfigPopup.url,urlInfo=parseURL(url),isHTTP=urlInfo.scheme.startsWith("http"),options=[],isCustomOptActive=urlInfo.hostParts.length<=1||!isHTTP;if(options.push({id:"custom",name:"custom",value:"",active:isCustomOptActive}),isCustomOptActive)matchTextField.value=!0;else{let rePrefix="/^https?://([0-9A-Za-z-]{1,63}\\.)*",len=urlInfo.hostParts.length-1;for(let i=len;i-- >0;){let hostParts=urlInfo.hostParts.slice(i),host=hostParts.join("."),reHost=hostParts.join("\\.")+"/",isActive=i===0;options.push({id:host,name:host,value:rePrefix+reHost,active:i===0}),isActive&&(matchString.value=rePrefix+reHost)}}matchOptions.value=options.reverse(),findExistedRules()}async function onReopenContainerUpd(value){value!=="none"&&!Permissions.reactive.webData&&(reopenInContainerId.value="none",await Permissions.request("<all_urls>")&&(reopenInContainerId.value=value))}let foundReopenRule,foundMoveRule;function findExistedRules(){let prevFoundReopenRule=foundReopenRule,prevFoundMoveRule=foundMoveRule,activeOption=matchOptions.value?.find(opt=>opt.active),hostName=activeOption?.name;if(hostName&&activeOption?.id!=="custom"){let urlExample=`https://${hostName}`;foundReopenRule=findReopenRule(urlExample),foundMoveRule=findMoveToPanelRule(urlExample),existedRules.value=!0}else foundReopenRule=void 0,foundMoveRule=void 0,existedRules.value=!1;foundReopenRule?reopenInContainerId.value=foundReopenRule.container.id:prevFoundReopenRule&&(reopenInContainerId.value="none"),foundMoveRule?(moveToPanelId.value=foundMoveRule.panel.id,moveToPanelTopLvlOnly.value=!!foundMoveRule.rule.topLvlOnly):prevFoundMoveRule&&(moveToPanelId.value="none",moveToPanelTopLvlOnly.value=!0)}function findReopenRule(url){for(let container of Object.values(Containers.reactive.byId))for(let rule of container.reopenRules){if(!container.reopenRulesActive||rule.type===2)continue;let re=parseUrlRuleRE(rule.url);if(re&&re.test(url))return{rule,container};if(url===rule.url)return{rule,container}}}function findMoveToPanelRule(url){for(let panel of Sidebar.panels)if(isTabsPanel(panel))for(let rule of panel.moveRules){if(rule.containerId!==void 0||!rule.url)continue;let re=parseUrlRuleRE(rule.url);if(re&&re.test(url))return{rule,panel};if(url===rule.url)return{rule,panel}}}function parseUrlRuleRE(url){if(url.startsWith("/")&&url.endsWith("/"))try{return new RegExp(url.slice(1,-1))}catch{return}}function parseURL(url){let sParts=url.split("://"),pParts=sParts[sParts.length-1]?.split("/"),hostParts=pParts.shift()?.split(".")??[];return{scheme:sParts[0],hostParts,pathParts:pParts}}function switchMatchOption(opt){matchOptions.value?.forEach(o=>o.active=o.id===opt.id),matchTextField.value=opt.id==="custom",opt.value&&(matchString.value=opt.value),findExistedRules()}function validateMatchString(value){if(value=value.trim(),value.startsWith("/")&&value.endsWith("/"))try{new RegExp(value.slice(1,-1))}catch{return!1}else if(!value)return!1;return!0}function checkUrl(url,matchString2){if(matchString2=matchString2.trim(),matchString2.startsWith("/")&&matchString2.endsWith("/"))try{return new RegExp(matchString2.slice(1,-1)).test(url)}catch{return!1}else return url.includes(matchString2)}function onSave(){if(!reactive.siteConfigPopup)return;let tab=Tabs.byId[reactive.siteConfigPopup.tabId],match=matchString.value.trim(),matchIsOk=validateMatchString(match),matchOption=matchOptions.value?.find(opt=>opt.id!=="custom"&&opt.active),rContainer=Containers.reactive.byId[reopenInContainerId.value],mPanel=Sidebar.panelsById[moveToPanelId.value],mPanelTopLvlOnly=moveToPanelTopLvlOnly.value,saveContainers=!1,savePanels=!1,reopenTab=!1,moveTab=!1;if(matchIsOk){if(foundReopenRule&&foundReopenRule.container.id!==rContainer?.id){let container=foundReopenRule.container,rule=foundReopenRule.rule,index=container.reopenRules.findIndex(r=>r.id===rule.id);index!==-1&&container.reopenRules.splice(index,1),container.reopenRules.length||(container.reopenRulesActive=!1),saveContainers=!0}if(foundMoveRule&&foundMoveRule.panel.id!==mPanel?.id){let panel=foundMoveRule.panel,rule=foundMoveRule.rule,index=panel.moveRules.findIndex(r=>r.id===rule.id);index!==-1&&panel.moveRules.splice(index,1),savePanels=!0}if(rContainer){let ruleConfig={id:uid(),active:!0,type:1,url:match};rContainer.reopenRules.length?rContainer.reopenRulesActive||(rContainer.reopenRules.forEach(rule=>rule.active=!1),rContainer.reopenRulesActive=!0):rContainer.reopenRulesActive=!0,rContainer.reopenRules.push(ruleConfig),matchOption?.name&&(ruleConfig.name=matchOption.name),saveContainers=!0,tab&&tab.cookieStoreId!==rContainer.id&&(reopenTab=!0)}if(isTabsPanel(mPanel)){let ruleConfig={id:uid(),active:!0};ruleConfig.url=match,ruleConfig.topLvlOnly=mPanelTopLvlOnly,matchOption?.name&&(ruleConfig.name=matchOption.name),mPanel.moveRules.push(ruleConfig),savePanels=!0,tab&&tab.panelId!==mPanel.id&&!reopenTab&&(moveTab=!0)}if(saveContainers&&Containers.saveContainers(120),savePanels&&(Tabs.recalcMoveRules(),Sidebar.saveSidebar(120)),tab&&checkUrl(tab.url,match)&&(rContainer&&reopenTab&&Tabs.reopenInContainer([tab.id],rContainer.id),isTabsPanel(mPanel)&&moveTab)){let items=Tabs.getTabsInfo([tab.id]),src={windowId:Windows.id,panelId:tab.panelId,pinned:tab.pinned};Tabs.move(items,src,{panelId:mPanel.id,index:mPanel.nextTabIndex})}closeSiteConfigPopup()}}function onCancel(){reactive.siteConfigPopup&&closeSiteConfigPopup()}return init(),(_ctx,_cache)=>(_openBlock25(),_createElementBlock25("div",{class:"SiteConfigPopup popup-container",onMousedown:_withModifiers16(onCancel,["stop","self"]),onMouseup:_cache[4]||(_cache[4]=_withModifiers16(()=>{},["stop"]))},[reactive.siteConfigPopup?(_openBlock25(),_createElementBlock25("div",_hoisted_149,[_createElementVNode21("h2",null,_toDisplayString17(_unref22(translate)("popup.url_rules.title")),1),_hoisted_240,_createElementVNode21("div",_hoisted_330,_toDisplayString17(_unref22(translate)("popup.url_rules.match_label")),1),matchOptions.value&&matchOptions.value.length>1?(_openBlock25(),_createElementBlock25("div",_hoisted_424,[(_openBlock25(!0),_createElementBlock25(_Fragment12,null,_renderList12(matchOptions.value,opt=>(_openBlock25(),_createElementBlock25("div",{class:"match-option",key:opt.id,title:opt.name,"data-active":opt.active,onClick:$event=>switchMatchOption(opt)},[_createElementVNode21("div",_hoisted_620,_toDisplayString17(opt.name),1)],8,_hoisted_523))),128))])):_createCommentVNode20("v-if",!0),matchTextField.value?(_openBlock25(),_createBlock9(text_field_default,{key:1,class:"matchString -no-separator",value:matchString.value,"onUpdate:value":_cache[0]||(_cache[0]=$event=>matchString.value=$event),label:"popup.url_rules.custom_match_placeholder",or:"---",line:!0},null,8,["value"])):_createCommentVNode20("v-if",!0),_hoisted_713,_createVNode12(select_field_default,{class:"-no-separator",label:"popup.url_rules.reopen_label",noneOpt:"-",value:reopenInContainerId.value,"onUpdate:value":[_cache[1]||(_cache[1]=$event=>reopenInContainerId.value=$event),onReopenContainerUpd],opts:availableContainerOpts.value,inline:!1,folded:!0},null,8,["value","opts"]),_hoisted_87,_createVNode12(select_field_default,{class:"-no-separator",label:"popup.url_rules.move_label",noneOpt:"-",value:moveToPanelId.value,"onUpdate:value":_cache[2]||(_cache[2]=$event=>moveToPanelId.value=$event),opts:availablePanelOpts.value,inline:!1,folded:!0},null,8,["value","opts"]),_createElementVNode21("div",_hoisted_97,[_createVNode12(toggle_field_default,{class:"-no-separator",label:"popup.url_rules.move_top_lvl_label",inactive:moveToPanelId.value==="none",value:moveToPanelTopLvlOnly.value,"onUpdate:value":_cache[3]||(_cache[3]=$event=>moveToPanelTopLvlOnly.value=$event)},null,8,["inactive","value"])]),_hoisted_108,_createElementVNode21("div",_hoisted_1113,[_createElementVNode21("div",{class:_normalizeClass5(["btn",{"-inactive":!saveBtnActive.value}]),onClick:onSave},_toDisplayString17(_unref22(translate)("btn.save")),3),_createElementVNode21("div",{class:"btn",onClick:onCancel},_toDisplayString17(_unref22(translate)("btn.cancel")),1)])])):_createCommentVNode20("v-if",!0)],32))}});import{defineComponent as _defineComponent28}from"/vendor/vue.runtime.esm-browser.prod.js";import{unref as _unref25,createElementVNode as _createElementVNode24,toDisplayString as _toDisplayString20,openBlock as _openBlock28,createBlock as _createBlock11,createCommentVNode as _createCommentVNode23,withModifiers as _withModifiers19,createElementBlock as _createElementBlock28}from"/vendor/vue.runtime.esm-browser.prod.js";import{computed as computed18}from"/vendor/vue.runtime.esm-browser.prod.js";import{defineComponent as _defineComponent26}from"/vendor/vue.runtime.esm-browser.prod.js";import{unref as _unref23,renderList as _renderList13,Fragment as _Fragment13,openBlock as _openBlock26,createElementBlock as _createElementBlock26,createElementVNode as _createElementVNode22,createCommentVNode as _createCommentVNode21,withModifiers as _withModifiers17,toDisplayString as _toDisplayString18,withCtx as _withCtx9,createVNode as _createVNode13}from"/vendor/vue.runtime.esm-browser.prod.js";import{reactive as reactive6,onMounted as onMounted12}from"/vendor/vue.runtime.esm-browser.prod.js";var _hoisted_150={class:"ClosedTabsSubPanel"},_hoisted_241={class:"closed-tabs-container"},_hoisted_331=["id","title","data-lvl","data-parent","onDragstart","onMousedown","onMouseup"],_hoisted_425={class:"body"},_hoisted_524=_createElementVNode22("div",{class:"flash-fx"},null,-1),_hoisted_621={key:0,class:"fav-icon"},_hoisted_714=["xlink:href"],_hoisted_88=["src"],_hoisted_98={class:"t-box"},_hoisted_109={class:"title"},_hoisted_1114=["onMousedown","onMouseup"],_hoisted_1212=_createElementVNode22("svg",null,[_createElementVNode22("use",{"xlink:href":"#icon_tree_struct"})],-1),_hoisted_1310=[_hoisted_1212],_hoisted_1410=["data-color"],_hoisted_156={key:0,class:"nothing-placeholder"},_hoisted_165={class:"msg"},sub_panel_closed_tabs_default=_defineComponent26({__name:"sub-panel.closed-tabs",setup(__props){let state2=reactive6({active:!1,navOffset:0});onMounted12(()=>{state2.active||Selection.isSet()&&Selection.resetSelection(),Menu.isOpen&&Menu.close()});function onTabMouseDown(e,tab){Mouse.setTarget("closedTab",tab.id),e.button===1?e.preventDefault():e.button===2&&(e.stopPropagation(),e.preventDefault())}function onTabMouseUp(e,tab){let sameTarget=Mouse.isTarget("closedTab",tab.id);if(Mouse.resetTarget(),e.button===2){e.stopPropagation(),e.preventDefault();return}sameTarget&&openTabs(tab,e.button===1||e.button===0&&e.ctrlKey,e.shiftKey)}function onTabContextMenu(e){e.stopPropagation(),e.preventDefault()}function onBranchMouseDown(e,tab){Mouse.setTarget("closedTab.branch",tab.id),e.stopPropagation()}function onBranchMouseUp(e,tab){let sameTarget=Mouse.isTarget("closedTab.branch",tab.id);Mouse.resetTarget(),e.stopPropagation(),sameTarget&&openTabs(tab,!0,!0)}function onTabDragStart(e,tab){Sidebar.updateBounds();let toDrag=[tab.id],dragItems=[],uriList=[],links=[],urlTitleList=[],branch=getBranch(tab);for(let tab2 of branch)uriList.push(tab2.url),links.push(`<a href="${tab2.url}>${tab2.title}</a>`),urlTitleList.push(tab2.url),urlTitleList.push(tab2.title),toDrag.push(tab2.id),dragItems.push({id:tab2.id,url:tab2.url,title:tab2.title,parentId:tab2.parentId,container:tab2.containerId});let dragInfo={type:1,items:dragItems,windowId:Windows.id,incognito:Windows.incognito,panelId:Sidebar.activePanelId,x:e.clientX,y:e.clientY,copy:!0,inheritContainer:!0};if(DnD.start(dragInfo,1),e.dataTransfer){let dragImgEl=document.getElementById("drag_image");if(e.dataTransfer.setData("application/x-sidebery-dnd",JSON.stringify(dragInfo)),Settings.state.dndOutside==="data"?!e.altKey:e.altKey){let uris=uriList.join(`\r
`);e.dataTransfer.setData("text/x-moz-url",urlTitleList.join(`\r
`)),e.dataTransfer.setData("text/uri-list",uris),e.dataTransfer.setData("text/plain",uris),e.dataTransfer.setData("text/html",links.join(`\r
`))}dragImgEl&&e.dataTransfer.setDragImage(dragImgEl,-3,-3),e.dataTransfer.effectAllowed="copyMove"}}function getBranch(rootTab){let branch=[rootTab],startIndex=Tabs.recentlyRemoved.findIndex(t=>t.id===rootTab.id);if(startIndex===-1)return branch;for(let i=startIndex+1;i<Tabs.recentlyRemoved.length;i++){let tab=Tabs.recentlyRemoved[i];if(!tab||rootTab.lvl>=tab.lvl)break;branch.push(tab)}return branch}async function openTabs(targetTab,inactive,branch){targetTab.isParent||(branch=!1),branch&&(inactive=!0);let tabsBranch=getBranch(targetTab),rcTabs=branch?tabsBranch:[targetTab],panelId=Sidebar.activePanelId,panel=Sidebar.panelsById[panelId];if(!isTabsPanel(panel))return;let dst={panelId,discarded:inactive,index:Tabs.getIndexForNewTab(panel),parentId:Tabs.getParentForNewTab(panel)},tabsToOpen=[];for(let rct of rcTabs)tabsToOpen.push({id:rct.id,title:rct.title,url:rct.url,container:rct.containerId,parentId:rct.parentId});!inactive&&tabsToOpen.length&&(tabsToOpen[0].active=!0),await Tabs.open(tabsToOpen,dst),rcTabs.length===1&&tabsBranch.forEach(t=>t.lvl--);for(let tab of rcTabs){let index=Tabs.recentlyRemoved.findIndex(t=>t.id===tab.id);index!==-1&&Tabs.recentlyRemoved.splice(index,1)}Tabs.recentlyRemoved.length||Sidebar.closeSubPanel(),Tabs.reactive.recentlyRemovedLen=Tabs.recentlyRemoved.length}return(_ctx,_cache)=>(_openBlock26(),_createElementBlock26("div",_hoisted_150,[_createVNode13(scroll_box_default,null,{default:_withCtx9(()=>[_createElementVNode22("div",_hoisted_241,[(_openBlock26(!0),_createElementBlock26(_Fragment13,null,_renderList13(_unref23(Tabs).recentlyRemoved,rmt=>(_openBlock26(),_createElementBlock26("div",{class:"closed-tab",id:"rmt"+rmt.id,key:rmt.id,title:rmt.url,"data-lvl":rmt.lvl,"data-parent":rmt.isParent,draggable:"true",onDragstart:$event=>onTabDragStart($event,rmt),onMousedown:$event=>onTabMouseDown($event,rmt),onMouseup:$event=>onTabMouseUp($event,rmt),onContextmenu:onTabContextMenu},[_createElementVNode22("div",_hoisted_425,[_hoisted_524,_createElementVNode22("div",{class:"fav",onDragstart:_cache[0]||(_cache[0]=_withModifiers17(()=>{},["stop","prevent"]))},[rmt.favIconUrl?_createCommentVNode21("v-if",!0):(_openBlock26(),_createElementBlock26("svg",_hoisted_621,[_createElementVNode22("use",{"xlink:href":rmt.favPlaceholder},null,8,_hoisted_714)])),rmt.favIconUrl?(_openBlock26(),_createElementBlock26("img",{key:1,class:"fav-icon",src:rmt.favIconUrl,draggable:"false"},null,8,_hoisted_88)):_createCommentVNode21("v-if",!0)],32),_createElementVNode22("div",_hoisted_98,[_createElementVNode22("div",_hoisted_109,_toDisplayString18(rmt.title),1)]),_createElementVNode22("div",{class:"branch-btn",onMousedown:$event=>onBranchMouseDown($event,rmt),onMouseup:$event=>onBranchMouseUp($event,rmt)},_hoisted_1310,40,_hoisted_1114),rmt.containerColor?(_openBlock26(),_createElementBlock26("div",{key:0,class:"container-mark","data-color":rmt.containerColor},null,8,_hoisted_1410)):_createCommentVNode21("v-if",!0)])],40,_hoisted_331))),128))])]),_:1}),_unref23(Tabs).reactive.recentlyRemovedLen===0?(_openBlock26(),_createElementBlock26("div",_hoisted_156,[_createElementVNode22("div",_hoisted_165,_toDisplayString18(_unref23(translate)("panel.nothing")),1)])):_createCommentVNode21("v-if",!0)]))}});import{defineComponent as _defineComponent27}from"/vendor/vue.runtime.esm-browser.prod.js";import{unref as _unref24,createVNode as _createVNode14,renderList as _renderList14,Fragment as _Fragment14,openBlock as _openBlock27,createElementBlock as _createElementBlock27,createBlock as _createBlock10,createElementVNode as _createElementVNode23,withCtx as _withCtx10,createCommentVNode as _createCommentVNode22,withModifiers as _withModifiers18,toDisplayString as _toDisplayString19}from"/vendor/vue.runtime.esm-browser.prod.js";import{reactive as reactive7,computed as computed17,onMounted as onMounted13,ref as ref15,nextTick as nextTick3}from"/vendor/vue.runtime.esm-browser.prod.js";var _hoisted_151={class:"content"},_hoisted_244={class:"bookmarks-tree"},_hoisted_333={key:1,class:"loading-screen"},_hoisted_426={key:0,class:"nav"},_hoisted_525=["data-inactive"],_hoisted_622=_createElementVNode23("svg",null,[_createElementVNode23("use",{"xlink:href":"#icon_expand"})],-1),_hoisted_715={class:"title-block"},_hoisted_89=["title"],_hoisted_99=["data-inactive"],_hoisted_1010=_createElementVNode23("svg",null,[_createElementVNode23("use",{"xlink:href":"#icon_expand"})],-1),sub_panel_bookmarks_default=_defineComponent27({__name:"sub-panel.bookmarks",props:{bookmarksPanel:{}},setup(__props){let scrollBox=ref15(null),rootTitle=translate("sub_panel.bookmarks_panel.root_title"),state2=reactive7({active:!1,loading:!1,permitted:Permissions.reactive.bookmarks,rootFolderId:NOID,rootFolderTitle:""}),props=__props,hostPanel=computed17(()=>{let panel=Sidebar.panelsById[Sidebar.reactive.activePanelId];return isTabsPanel(panel)?panel:null});onMounted13(()=>{open()});let tree=computed17(()=>{let panel=props.bookmarksPanel;return panel.reactive.filteredBookmarks??panel.reactive.bookmarks??Bookmarks.reactive.tree}),bookmarksLoading=!1;function open(){bookmarksLoading||(Bookmarks.reactive.tree.length?(state2.active=!state2.active,checkRootFolder(),setPanelEls(),updateRootTree()):(state2.active=!0,bookmarksLoading=!0,loadBookmarks().then(()=>{bookmarksLoading=!1,props.bookmarksPanel.ready=!0,checkRootFolder(),setPanelEls(),updateRootTree(),Search.rawValue&&Search.search()})),state2.active||Selection.isSet()&&Selection.resetSelection(),Menu.isOpen&&Menu.close())}function checkRootFolder(){let id=props.bookmarksPanel.rootId;if(id===void 0||id===NOID||id===BKM_ROOT_ID)return;Bookmarks.reactive.byId[id]||(props.bookmarksPanel.rootId=BKM_ROOT_ID)}function updateRootTree(){let panel=props.bookmarksPanel,folder=Bookmarks.reactive.byId[panel.rootId];if(folder)for(let i=panel.reactive.rootOffset;i--&&folder;){if(folder.parentId===BKM_ROOT_ID){folder=void 0;break}folder=Bookmarks.reactive.byId[folder.parentId]}state2.rootFolderId=folder?.id??BKM_ROOT_ID,state2.rootFolderTitle=folder?.title??rootTitle,panel.reactive.bookmarks=folder?.children??Bookmarks.reactive.tree}function setPanelEls(){if(scrollBox.value){props.bookmarksPanel.scrollComponent=scrollBox.value;let scrollBoxEl=scrollBox.value.getScrollBox()??void 0;scrollBoxEl&&(props.bookmarksPanel.scrollEl=scrollBoxEl)}}async function loadBookmarks(){state2.loading=!0,await Bookmarks.load(),state2.loading=!1}function goUp(){state2.rootFolderId!==BKM_ROOT_ID&&(props.bookmarksPanel.reactive.rootOffset++,updateRootTree(),DnD.items.length&&nextTick3(()=>Sidebar.updateBounds()))}function goDown(){props.bookmarksPanel.reactive.rootOffset--,props.bookmarksPanel.reactive.rootOffset<0&&(props.bookmarksPanel.reactive.rootOffset=0),checkRootFolder(),updateRootTree(),DnD.items.length&&nextTick3(()=>Sidebar.updateBounds())}function onDrop(){if(DnD.reactive.dstType=2,DnD.reactive.dstParentId===-1){let panel=props.bookmarksPanel;panel.rootId!==NOID&&panel.rootId!==BKM_ROOT_ID?DnD.reactive.dstParentId=panel.rootId:DnD.reactive.dstParentId=BKM_OTHER_ID}}return(_ctx,_cache)=>(_openBlock27(),_createElementBlock27("div",{class:"BookmarksSubPanel",onDrop},[_createElementVNode23("div",_hoisted_151,[tree.value&&!state2.loading&&_unref24(Permissions).reactive.bookmarks&&hostPanel.value?(_openBlock27(),_createBlock10(scroll_box_default,{key:0,ref_key:"scrollBox",ref:scrollBox},{default:_withCtx10(()=>[_createElementVNode23("div",_hoisted_244,[_createVNode14(dnd_pointer_default,{panelId:_ctx.bookmarksPanel.id,subPanel:!0},null,8,["panelId"]),(_openBlock27(!0),_createElementBlock27(_Fragment14,null,_renderList14(tree.value,node=>(_openBlock27(),_createBlock10(bookmark_node_default,{class:"root-node",key:node.id,node,panelId:hostPanel.value.id},null,8,["node","panelId"]))),128))])]),_:1},512)):state2.loading?(_openBlock27(),_createElementBlock27("div",_hoisted_333,[_createVNode14(loading_dots_default)])):_createCommentVNode22("v-if",!0),_createVNode14(panel_placeholder_default,{isNotPerm:!_unref24(Permissions).reactive.bookmarks,permMsg:_unref24(translate)("panel.bookmarks.req_perm"),perm:"bookmarks",isMsg:!tree.value.length&&!!_unref24(Bookmarks).reactive.tree.length,msg:_unref24(translate)("panel.nothing")},null,8,["isNotPerm","permMsg","isMsg","msg"])]),state2.active&&!state2.loading&&props.bookmarksPanel.rootId!==_unref24(NOID)&&props.bookmarksPanel.rootId!==_unref24(BKM_ROOT_ID)?(_openBlock27(),_createElementBlock27("div",_hoisted_426,[_createElementVNode23("div",{class:"up-btn","data-inactive":state2.rootFolderId===_unref24(BKM_ROOT_ID),onClick:goUp},[_createElementVNode23("div",{class:"dnd-layer",onDragenter:_withModifiers18(goUp,["stop"])},null,32),_hoisted_622],8,_hoisted_525),_createElementVNode23("div",_hoisted_715,[state2.rootFolderTitle?(_openBlock27(),_createElementBlock27("div",{key:0,class:"title",title:state2.rootFolderTitle},_toDisplayString19(state2.rootFolderTitle),9,_hoisted_89)):_createCommentVNode22("v-if",!0)]),_createElementVNode23("div",{class:"down-btn","data-inactive":_ctx.bookmarksPanel.reactive.rootOffset<=0,onClick:goDown},[_createElementVNode23("div",{class:"dnd-layer",onDragenter:_withModifiers18(goDown,["stop"])},null,32),_hoisted_1010],8,_hoisted_99)])):_createCommentVNode22("v-if",!0)],32))}});var _hoisted_157=["data-active","data-search-active"],_hoisted_245={class:"sub-panel"},_hoisted_334={class:"header"},_hoisted_427={class:"title"},sub_panel_default=_defineComponent28({__name:"sub-panel",setup(__props){let titles={0:"",1:translate("sub_panel.rct_panel.title"),2:translate("sub_panel.bookmarks_panel.title"),3:translate("sub_panel.history_panel.title")},isRecentlyClosedTabs=computed18(()=>Sidebar.reactive.subPanelType===1),isBookmarks=computed18(()=>Sidebar.reactive.subPanelType===2),isHistory=computed18(()=>Sidebar.reactive.subPanelType===3);function onDrop(){DnD.reactive.dstType=1}function onDragEnter(){Search.rawValue&&Search.stop(),Sidebar.closeSubPanel()}function onOverlayClick(){Search.rawValue&&Search.stop(),Sidebar.closeSubPanel()}function onMouseUp(e){Selection.isSet()&&Selection.resetSelection(),Menu.isOpen&&Menu.close();let panel=Sidebar.subPanelHost;e.button===2&&!Settings.state.ctxMenuNative&&panel&&(Selection.selectNavItem(panel.id),Menu.open(7,e.clientX,e.clientY))}return(_ctx,_cache)=>(_openBlock28(),_createElementBlock28("div",{class:"SubPanel","data-active":_unref25(Sidebar).reactive.subPanelActive,"data-search-active":_unref25(Search).reactive.barIsActive,onWheel:_cache[0]||(_cache[0]=_withModifiers19(()=>{},["stop"])),onMousedown:_cache[1]||(_cache[1]=_withModifiers19(()=>{},["stop"])),onMouseup:_withModifiers19(onMouseUp,["stop"]),onDblclick:_cache[2]||(_cache[2]=_withModifiers19(()=>{},["stop"]))},[_createElementVNode24("div",{class:"overlay","data-dnd-type":"tab",onDragenter:onDragEnter,onClick:onOverlayClick,onDrop},null,32),_createElementVNode24("div",_hoisted_245,[_createElementVNode24("div",_hoisted_334,[_createElementVNode24("div",_hoisted_427,_toDisplayString20(titles[_unref25(Sidebar).reactive.subPanelType]),1)]),isRecentlyClosedTabs.value?(_openBlock28(),_createBlock11(sub_panel_closed_tabs_default,{key:0})):isBookmarks.value&&_unref25(Sidebar).subPanels.bookmarks?(_openBlock28(),_createBlock11(sub_panel_bookmarks_default,{key:1,bookmarksPanel:_unref25(Sidebar).subPanels.bookmarks},null,8,["bookmarksPanel"])):isHistory.value?(_openBlock28(),_createBlock11(panel_history_default,{key:2,isSubPanel:!0})):_createCommentVNode23("v-if",!0)])],40,_hoisted_157))}});var _hoisted_158=["data-native-scrollbar","data-native-scrollbars-thin","data-native-scrollbars-left","data-theme","data-density","data-frame-color-scheme","data-toolbar-color-scheme","data-act-el-color-scheme","data-popup-color-scheme","data-animations","data-pinned-tabs-position","data-pinned-tabs-list","data-tabs-tree-lvl-marks","data-tabs-close-btn","data-drag","data-nav-inline","data-nav-layout","data-search","data-sticky-bookmarks","data-colorized-branches"],_hoisted_246={key:0,class:"top-horizontal-box"},_hoisted_335={class:"main-box"},_hoisted_428={key:0,class:"left-vertical-box"},_hoisted_526={class:"central-box"},_hoisted_623=["data-drop-target-bookmarks"],_hoisted_716=["data-disabled"],_hoisted_810=_createElementVNode25("svg",null,[_createElementVNode25("use",{"xlink:href":"#icon_trash"})],-1),_hoisted_910=[_hoisted_810],_hoisted_1011=["data-disabled"],_hoisted_1115=_createElementVNode25("div",{class:"dnd-layer","data-dnd-type":"bspb"},null,-1),_hoisted_1213=_createElementVNode25("svg",null,[_createElementVNode25("use",{"xlink:href":"#icon_bookmarks"})],-1),_hoisted_1311=[_hoisted_1115,_hoisted_1213],_hoisted_1411=["data-disabled"],_hoisted_159=_createElementVNode25("svg",null,[_createElementVNode25("use",{"xlink:href":"#icon_clock"})],-1),_hoisted_166=[_hoisted_159],_hoisted_175={key:1,class:"right-vertical-box"},sidebar_default=_defineComponent29({__name:"sidebar",setup(__props){let rootEl=ref16(null),panelBoxEl=ref16(null),rrc=ref16(0),animations=Settings.state.animations?Settings.state.animationSpeed||"fast":"none",pinnedTabsBarTop=Settings.state.pinnedTabsPosition==="top",pinnedTabsBarLeft=Settings.state.pinnedTabsPosition==="left",pinnedTabsBarRight=Settings.state.pinnedTabsPosition==="right",navBarHorizontal=Settings.state.navBarLayout==="horizontal",navBarVertical=Settings.state.navBarLayout==="vertical",navBarLayout=navBarVertical?Settings.state.navBarSide:Settings.state.navBarLayout,navBarLeft=navBarVertical&&Settings.state.navBarSide==="left",navBarRight=navBarVertical&&Settings.state.navBarSide==="right",bottomBar=Settings.state.subPanelRecentlyClosedBar||Settings.state.subPanelBookmarks||Settings.state.subPanelHistory;function recalcStaticVars(){animations=Settings.state.animations?Settings.state.animationSpeed||"fast":"none",pinnedTabsBarTop=Settings.state.pinnedTabsPosition==="top",pinnedTabsBarLeft=Settings.state.pinnedTabsPosition==="left",pinnedTabsBarRight=Settings.state.pinnedTabsPosition==="right",navBarHorizontal=Settings.state.navBarLayout==="horizontal",navBarVertical=Settings.state.navBarLayout==="vertical",navBarLayout=navBarVertical?Settings.state.navBarSide:Settings.state.navBarLayout,navBarLeft=navBarVertical&&Settings.state.navBarSide==="left",navBarRight=navBarVertical&&Settings.state.navBarSide==="right",bottomBar=Settings.state.subPanelRecentlyClosedBar||Settings.state.subPanelBookmarks||Settings.state.subPanelHistory}Sidebar.reMountSidebar=()=>{Sidebar.rememberActivePanelScrollPosition(),recalcStaticVars(),rrc.value++,nextTick4(updSidebarEls)};let activePanel=computed19(()=>Sidebar.panelsById[Sidebar.reactive.activePanelId]),panels=computed19(()=>{let output=[];for(let id of Sidebar.reactive.nav){let panel=Sidebar.panelsById[id];panel&&output.push(panel)}return output});function updSidebarEls(){panelBoxEl.value&&Sidebar.setPanelsBoxEl(panelBoxEl.value),rootEl.value&&Sidebar.registerRootEl(rootEl.value),Sidebar.recalcElementSizes(),Sidebar.recalcSidebarSize(),Sidebar.restoreActivePanelScrollPosition()}onMounted14(()=>{updSidebarEls(),document.addEventListener("keyup",onDocumentKeyup)});function getPanelComponent(panel){if(panel.type===2)return panel_tabs_default;if(panel.type===1)return panel_bookmarks_default;if(panel.type===4)return panel_history_default}function onFocusIn(e){}function onFocusOut(e){e.explicitOriginalTarget===e.target&&!DnD.reactive.isStarted&&(Menu.isOpen&&Menu.close(),Selection.resetSelection(),Sidebar.reactive.hiddenPanelsPopup&&Sidebar.closeHiddenPanelsPopup(!0))}function onDocumentKeyup(e){if(e.code==="Escape"){if(Menu.isOpen){Menu.close();return}Selection.isSet()&&Selection.resetSelection(),reactive.confirm&&(reactive.confirm=null),Windows.reactive.choosing&&Windows.closeWindowsPopup(),Bookmarks.reactive.popup?.close&&Bookmarks.reactive.popup.close(),reactive.panelConfigPopup&&closePanelPopup(),reactive.containerConfigPopup&&closeContainerPopup(),reactive.groupConfigPopup&&(reactive.groupConfigPopup.done(2),reactive.groupConfigPopup=null),reactive.dialog&&reactive.dialog.result(null),Sidebar.reactive.hiddenPanelsPopup&&Sidebar.closeHiddenPanelsPopup(),reactive.newTabShortcutsPopup&&closeNewTabShortcutsPopup(),Search.reactive.barIsShowed&&Settings.state.searchBarMode==="dynamic"?Search.stop():Search.rawValue&&Search.stop(),Sidebar.subPanelActive&&Sidebar.closeSubPanel()}e.code==="Enter"&&reactive.confirm?.ok&&reactive.confirm.ok()}let lastDir,onWheel=Mouse.getWheelDebouncer(1,e=>{if(Menu.isOpen&&Menu.close(),e.deltaX!==0)Mouse.blockWheel(2);else return;if(Settings.state.hScrollAction==="switch_panels"){let dir=e.deltaX>0?1:-1,restartDebouncer=Settings.state.onePanelSwitchPerScroll&&(lastDir===void 0||lastDir===dir);return lastDir=dir,Sidebar.switchPanel(dir,!0,!1,restartDebouncer)}else if(Settings.state.hScrollAction==="switch_act_tabs"){if(e.deltaX>0)return Tabs.switchToRecentlyActiveTab(1,1);if(e.deltaX<0)return Tabs.switchToRecentlyActiveTab(1,-1)}}),leaveTimeout,subPanelTimeout;function onMouseEnter(){Mouse.mouseIn=!0,Sidebar.switchPanelBackResetTimeout(),leaveTimeout&&(clearTimeout(leaveTimeout),leaveTimeout=void 0),clearTimeout(subPanelTimeout)}function onMouseLeave(){if((state.status===2||state.status===1)&&closePreview(),DnD.dragEndedRecently)return;Mouse.mouseIn=!1,Mouse.stopResizing();let activePanel2=Sidebar.panelsById[Sidebar.activePanelId];if(!isTabsPanel(activePanel2)&&activePanel2?.tempMode&&!Search.rawValue&&Sidebar.switchPanelBack(300),!Bookmarks.reactive.popup&&(Mouse.multiSelectionMode&&(leaveTimeout=setTimeout(()=>{Mouse.stopMultiSelection()},250)),Sidebar.subPanelActive&&!Search.rawValue&&!Menu.isOpen&&!DnD.items.length&&(clearTimeout(subPanelTimeout),subPanelTimeout=setTimeout(()=>{Sidebar.closeSubPanel()},300)),Sidebar.switchOnMouseLeave&&Sidebar.switchPanelOnMouseLeave(),Tabs.activateSelectedOnMouseLeave&&Selection.isTabs())){Tabs.activateSelectedOnMouseLeave=!1;let id=Selection.get()[0],targetTab=Tabs.byId[id];if(!targetTab||targetTab.id===Tabs.activeId)return Selection.resetSelection();browser.tabs.update(id,{active:!0}).catch(err2=>{err("MouseLeave: Cannot activate tab on mouseleave:",err2)})}}function onMouseDown(e){Selection.resetSelection(),e.button===1&&(Mouse.blockWheel(),e.preventDefault())}function onMouseUp(e){Mouse.resetClickLock(120),e.button===0&&!e.ctrlKey&&!e.shiftKey&&(Menu.close(),Selection.resetSelection(),Sidebar.reactive.hiddenPanelsPopup&&Sidebar.closeHiddenPanelsPopup());let inMultiSelectionMode=Mouse.multiSelectionMode;if(inMultiSelectionMode&&Mouse.stopMultiSelection(),e.button===1){if(!Settings.state.multipleMiddleClose||inMultiSelectionMode&&!Settings.state.autoMenuMultiSel&&Selection.getLength()>1)return;Tabs.removeTabs(Selection.get())}else if(e.button===2){let type;if(Selection.isBookmarks()&&(type=2),Selection.isTabs()&&(type=1),type===void 0||inMultiSelectionMode&&!Settings.state.autoMenuMultiSel&&Selection.getLength()>1)return;Menu.open(type,e.clientX,e.clientY)}}function getPanelPos(i,panelId){if(panelId===Sidebar.reactive.activePanelId)return"center";if(i===-1)return"right";let activePanel2=Sidebar.panelsById[Sidebar.activePanelId];return activePanel2&&i>activePanel2.index?"right":"left"}let onBSPBDragLeaveTimeout;function onBSPBDragLeave(){Sidebar.subPanelActive&&(DnD.reactive.dstType=2),clearTimeout(onBSPBDragLeaveTimeout),onBSPBDragLeaveTimeout=setTimeout(()=>{Sidebar.subPanelActive&&Sidebar.updateBounds()},120)}return(_ctx,_cache)=>(_openBlock29(),_createElementBlock29("div",{class:"root Sidebar",id:"root",ref_key:"rootEl",ref:rootEl,key:rrc.value,"data-native-scrollbar":_unref26(Settings).state.nativeScrollbars,"data-native-scrollbars-thin":_unref26(Settings).state.nativeScrollbarsThin,"data-native-scrollbars-left":_unref26(Settings).state.nativeScrollbarsLeft,"data-theme":_unref26(Settings).state.theme,"data-density":_unref26(Settings).state.density,"data-frame-color-scheme":_unref26(Styles).reactive.frameColorScheme,"data-toolbar-color-scheme":_unref26(Styles).reactive.toolbarColorScheme,"data-act-el-color-scheme":_unref26(Styles).reactive.actElColorScheme,"data-popup-color-scheme":_unref26(Styles).reactive.popupColorScheme,"data-animations":_unref26(animations),"data-pinned-tabs-position":_unref26(Settings).state.pinnedTabsPosition,"data-pinned-tabs-list":_unref26(Settings).state.pinnedTabsList,"data-tabs-tree-lvl-marks":_unref26(Settings).state.tabsLvlDots,"data-tabs-close-btn":_unref26(Settings).state.tabRmBtn,"data-drag":_unref26(DnD).reactive.isStarted,"data-nav-inline":_unref26(Settings).state.navBarInline,"data-nav-layout":_unref26(navBarLayout),"data-search":!!_unref26(Search).reactive.value,"data-sticky-bookmarks":_unref26(Settings).state.pinOpenedBookmarksFolder,"data-colorized-branches":_unref26(Settings).state.colorizeTabsBranches,onDragend:_cache[5]||(_cache[5]=(...args)=>_unref26(DnD).onDragEnd&&_unref26(DnD).onDragEnd(...args)),onDragenter:_cache[6]||(_cache[6]=(...args)=>_unref26(DnD).onDragEnter&&_unref26(DnD).onDragEnter(...args)),onDragleave:_cache[7]||(_cache[7]=(...args)=>_unref26(DnD).onDragLeave&&_unref26(DnD).onDragLeave(...args)),onDragover:_cache[8]||(_cache[8]=_withModifiers20((...args)=>_unref26(DnD).onDragMove&&_unref26(DnD).onDragMove(...args),["prevent"])),onDrop:_cache[9]||(_cache[9]=_withModifiers20((...args)=>_unref26(DnD).onDrop&&_unref26(DnD).onDrop(...args),["stop","prevent"])),onContextmenu:_cache[10]||(_cache[10]=_withModifiers20(()=>{},["stop","prevent"])),onMouseenter:onMouseEnter,onMouseleave:onMouseLeave,onMousedown:onMouseDown,onMouseup:onMouseUp,onMousemovePassive:_cache[11]||(_cache[11]=(...args)=>_unref26(Mouse).onMouseMove&&_unref26(Mouse).onMouseMove(...args)),onFocusin:onFocusIn,onFocusout:onFocusOut},[_createVNode15(_Transition4,{name:"popup",type:"transition"},{default:_withCtx11(()=>[reactive.confirm?(_openBlock29(),_createBlock12(popup_confirm_default,{key:0})):_createCommentVNode24("v-if",!0)]),_:1}),_createVNode15(_Transition4,{name:"popup",type:"transition"},{default:_withCtx11(()=>[_unref26(Windows).reactive.choosing?(_openBlock29(),_createBlock12(popup_windows_default,{key:0})):_createCommentVNode24("v-if",!0)]),_:1}),_createVNode15(_Transition4,{name:"popup",type:"transition"},{default:_withCtx11(()=>[_unref26(Bookmarks).reactive.popup?(_openBlock29(),_createBlock12(popup_bookmarks_default,{key:0})):_createCommentVNode24("v-if",!0)]),_:1}),_createVNode15(_Transition4,{name:"popup",type:"transition"},{default:_withCtx11(()=>[reactive.panelConfigPopup?(_openBlock29(),_createBlock12(popup_panel_config_default,{key:0})):_createCommentVNode24("v-if",!0)]),_:1}),_createVNode15(_Transition4,{name:"popup",type:"transition"},{default:_withCtx11(()=>[reactive.containerConfigPopup?(_openBlock29(),_createBlock12(popup_container_config_default,{key:0})):_createCommentVNode24("v-if",!0)]),_:1}),_createVNode15(_Transition4,{name:"popup",type:"transition"},{default:_withCtx11(()=>[reactive.groupConfigPopup?(_openBlock29(),_createBlock12(popup_group_config_default,{key:0})):_createCommentVNode24("v-if",!0)]),_:1}),_createVNode15(_Transition4,{name:"popup",type:"transition"},{default:_withCtx11(()=>[reactive.dialog?(_openBlock29(),_createBlock12(popup_dialog_default,{key:0,dialog:reactive.dialog},null,8,["dialog"])):_createCommentVNode24("v-if",!0)]),_:1}),_createVNode15(_Transition4,{name:"popup",type:"transition"},{default:_withCtx11(()=>[reactive.newTabShortcutsPopup?(_openBlock29(),_createBlock12(popup_new_tab_shortcuts_default,{key:0})):_createCommentVNode24("v-if",!0)]),_:1}),_createVNode15(_Transition4,{name:"popup",type:"transition"},{default:_withCtx11(()=>[reactive.siteConfigPopup?(_openBlock29(),_createBlock12(popup_site_config_default,{key:0})):_createCommentVNode24("v-if",!0)]),_:1}),_createVNode15(popup_context_menu_default),_createVNode15(dnd_tooltip_default),_createVNode15(popup_notifications_default),_unref26(navBarHorizontal)?(_openBlock29(),_createElementBlock29("div",_hoisted_246,[_createVNode15(bar_navigation_default,{class:"-top"})])):_createCommentVNode24("v-if",!0),_unref26(navBarHorizontal)?_withDirectives5((_openBlock29(),_createBlock12(bar_search_default,{key:1},null,512)),[[_vShow4,_unref26(Settings).state.searchBarMode!=="none"]]):_createCommentVNode24("v-if",!0),_createElementVNode25("div",_hoisted_335,[_unref26(pinnedTabsBarLeft)||_unref26(navBarLeft)?(_openBlock29(),_createElementBlock29("div",_hoisted_428,[_unref26(pinnedTabsBarLeft)?(_openBlock29(),_createBlock12(bar_pinned_tabs_default,{key:0})):_createCommentVNode24("v-if",!0),_unref26(navBarLeft)?(_openBlock29(),_createBlock12(bar_navigation_default,{key:1,class:"-vert"})):_createCommentVNode24("v-if",!0)])):_createCommentVNode24("v-if",!0),_createElementVNode25("div",_hoisted_526,[_unref26(pinnedTabsBarTop)?(_openBlock29(),_createBlock12(bar_pinned_tabs_default,{key:0})):_createCommentVNode24("v-if",!0),_unref26(navBarHorizontal)?_createCommentVNode24("v-if",!0):_withDirectives5((_openBlock29(),_createBlock12(bar_search_default,{key:1},null,512)),[[_vShow4,_unref26(Settings).state.searchBarMode!=="none"]]),_createElementVNode25("div",{class:"panel-box",ref_key:"panelBoxEl",ref:panelBoxEl,onWheelPassive:_cache[0]||(_cache[0]=(...args)=>_unref26(onWheel)&&_unref26(onWheel)(...args))},[(_openBlock29(!0),_createElementBlock29(_Fragment15,null,_renderList15(panels.value,(panel,i)=>(_openBlock29(),_createBlock12(_resolveDynamicComponent(getPanelComponent(panel)),{class:"panel",key:panel.id,"data-pos":getPanelPos(i,panel.id),panel},null,8,["data-pos","panel"]))),128))],544),_createVNode15(_Transition4,{name:"bottom-bar"},{default:_withCtx11(()=>[_unref26(bottomBar)&&isTabsPanel(activePanel.value)?(_openBlock29(),_createElementBlock29("div",{key:0,class:"BottomBar",onDragover:_cache[4]||(_cache[4]=_withModifiers20(()=>{},["prevent","stop"])),"data-drop-target-bookmarks":_unref26(DnD).reactive.dstType===_unref26(DropType).BookmarksSubPanelBtn&&_unref26(DnD).reactive.dstPanelId===activePanel.value.id},[_unref26(Settings).state.subPanelRecentlyClosedBar?(_openBlock29(),_createElementBlock29("div",{key:0,class:"tool-btn","data-disabled":!_unref26(Tabs).reactive.recentlyRemovedLen,onClick:_cache[1]||(_cache[1]=$event=>_unref26(Sidebar).openSubPanel(_unref26(SubPanelType).RecentlyClosedTabs,activePanel.value))},_hoisted_910,8,_hoisted_716)):_createCommentVNode24("v-if",!0),_unref26(Settings).state.subPanelBookmarks?(_openBlock29(),_createElementBlock29("div",{key:1,class:"tool-btn -bookmarks","data-disabled":!isTabsPanel(activePanel.value),onDragleave:onBSPBDragLeave,onClick:_cache[2]||(_cache[2]=$event=>_unref26(Sidebar).openSubPanel(_unref26(SubPanelType).Bookmarks,activePanel.value))},_hoisted_1311,40,_hoisted_1011)):_createCommentVNode24("v-if",!0),_unref26(Settings).state.subPanelHistory?(_openBlock29(),_createElementBlock29("div",{key:2,class:"tool-btn","data-disabled":!isTabsPanel(activePanel.value),onClick:_cache[3]||(_cache[3]=$event=>_unref26(Sidebar).openSubPanel(_unref26(SubPanelType).History,activePanel.value))},_hoisted_166,8,_hoisted_1411)):_createCommentVNode24("v-if",!0)],40,_hoisted_623)):_createCommentVNode24("v-if",!0)]),_:1}),_createVNode15(sub_panel_default)]),_unref26(pinnedTabsBarRight)||_unref26(navBarRight)?(_openBlock29(),_createElementBlock29("div",_hoisted_175,[_unref26(pinnedTabsBarRight)?(_openBlock29(),_createBlock12(bar_pinned_tabs_default,{key:0})):_createCommentVNode24("v-if",!0),_unref26(navBarRight)?(_openBlock29(),_createBlock12(bar_navigation_default,{key:1,class:"-vert"})):_createCommentVNode24("v-if",!0)])):_createCommentVNode24("v-if",!0)]),_unref26(reactiveUpgrading).status?(_openBlock29(),_createBlock12(upgrade_screen_default,{key:2})):_createCommentVNode24("v-if",!0)],40,_hoisted_158))}});async function main(){Info.setInstanceType(2),setInstanceType2(2),setInstanceType(2);let ts=performance.now();if(info("Init start"),registerActions({reloadTab:Tabs.reloadTab,queryTab:Tabs.queryTab,getTabs:Tabs.getTabs,getTabsTreeData:Tabs.getTabsTreeData,moveTabsToThisWin:Tabs.moveToThisWin,openTabs:Tabs.open,handleReopening:Tabs.handleReopening,getActivePanelConfig:Sidebar.getActivePanelConfig,stopDrag:DnD.reset,getGroupInfo:Tabs.getGroupInfo,loadFavicons,setFavicon:set,onOutsideSearchInput:Search.onOutsideSearchInput,onOutsideSearchNext:Search.next,onOutsideSearchPrev:Search.prev,onOutsideSearchEnter:Search.enter,onOutsideSearchSelectAll:Search.selectAll,onOutsideSearchMenu:Search.menu,onOutsideSearchExit:Search.onOutsideSearchExit,onOutsideSearchBookmarks:Search.bookmarks,onOutsideSearchHistory:Search.history,notifyAboutNewSnapshot:Snapshots.notifyAboutNewSnapshot,notifyAboutWrongProxyAuthData:Notifications.notifyAboutWrongProxyAuthData,notify:Notifications.notify,isDropEventConsumed:DnD.isDropEventConsumed,storageChanged:Store.storageChangeListener,connectTo,getSearchQuery:Search.getSearchQuery,updWindowPreface:Windows.updWindowPreface}),await Promise.all([Windows.loadWindowInfo(),Settings.loadSettings(),Containers.load(),Permissions.loadPermissions(),Info.loadVersionInfo()]),setWinId2(Windows.id),setWinId(Windows.id),setupGlobalMessageListener(),setupConnectionListener(),Containers.reactive=shallowReactive(Containers.reactive),Sidebar.initSidebar(reactive8),initPopups(reactive8),Windows.reactive=reactive8(Windows.reactive),initFavicons(reactive8),Bookmarks.reactive=reactive8(Bookmarks.reactive),Tabs.initTabs(reactive8),DnD.reactive=reactive8(DnD.reactive),Permissions.reactive=reactive8(Permissions.reactive),Notifications.reactive=reactive8(Notifications.reactive),History.initHistory(reactive8),Search.reactive=reactive8(Search.reactive),Styles.reactive=reactive8(Styles.reactive),initUpgrading(reactive8),Sidebar.updateFontSize(),createApp(sidebar_default).mount("#root_container"),Info.isMajorUpgrade())return showUpgradingScreen();Settings.setupSettingsChangeListener(),Permissions.setupListeners(),Windows.setupWindowsListeners(),Containers.setupContainersListeners(),Sidebar.setupListeners(),Settings.state.sidebarCSS&&Styles.loadCustomSidebarCSS(),Styles.initColorScheme(),await Sidebar.loadPanels();let actPanel=Sidebar.panelsById[Sidebar.activePanelId],initBookmarks=!Settings.state.loadBookmarksOnDemand||isBookmarksPanel(actPanel),initHistory=!Settings.state.loadHistoryOnDemand||isHistoryPanel(actPanel);connectTo(0),Sidebar.hasTabs?await Tabs.load():await Tabs.loadInShadowMode(),Sidebar.hasBookmarks&&initBookmarks&&Bookmarks.load(),Sidebar.hasHistory&&initHistory&&History.load(),updateWebReqHandlers(),Menu.loadCtxMenu(),Menu.setupListeners(),Styles.setupListeners(),loadFavicons(),Keybindings.loadKeybindings(),Keybindings.setupListeners(),Search.init(),Settings.state.updateSidebarTitle&&Sidebar.updateSidebarTitle(0),window.getSideberyState=()=>({IPC:ipc_exports,Info,Settings,Containers,Sidebar,Windows,Favicons:favicons_fg_exports,Bookmarks,Tabs,DnD,Permissions,Notifications,History,Search,Styles,Menu,Snapshots}),Settings.state.previewTabs&&resetMode(),info(`Init end: ${performance.now()-ts}ms`)}main();
