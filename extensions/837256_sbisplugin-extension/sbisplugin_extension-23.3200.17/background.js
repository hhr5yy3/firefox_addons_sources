(()=>{"use strict";var e={82:function(e,t,n){var o=this&&this.__awaiter||function(e,t,n,o){return new(n||(n=Promise))((function(i,s){function r(e){try{c(o.next(e))}catch(e){s(e)}}function a(e){try{c(o.throw(e))}catch(e){s(e)}}function c(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(r,a)}c((o=o.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0});const i=n(499);var s,r;!function(e){e[e.SUCCESS=0]="SUCCESS",e[e.PROGRESS=1]="PROGRESS",e[e.FAIL=2]="FAIL"}(s||(s={})),function(e){e.RUN_DOWNLOADED_FILE="RUN_DOWNLOADED_FILE",e.SHOW_DOWNLOADED_FILE="SHOW_DOWNLOADED_FILE"}(r||(r={}));const a="saby_plugin_notice";let c;t.default=class{constructor(e=!1){this._apiObject=e?browser:chrome}isAction(e){return"extension_action"===e}processAction(e,t){var n;return o(this,void 0,void 0,(function*(){const o=JSON.parse(e),d=(null===(n=o.payload)||void 0===n?void 0:n.lang)||i.UI_LANG.RU;if(o.type===r.RUN_DOWNLOADED_FILE){const e=yield this._getDownloadItems({filenameRegex:o.payload.filename,orderBy:["-startTime"],exists:!0,state:"complete",startedAfter:o.payload.timeStamp});if(e.length>0){const n=e.shift(),r=n.id,h=n.filename.replace(/\\/g,"/").split("/").pop(),l={type:"basic",iconUrl:this._apiObject.runtime.getURL("sbisPlugin-logo-48.png"),priority:2,title:(0,i.getLocalizedString)("СБИС Плагин",d),message:(0,i.getLocalizedString)("Пожалуйста, нажмите на уведомление, чтобы запустить установку",d),buttons:[{title:(0,i.getLocalizedString)("Установить",d)}],requireInteraction:!0},u=e=>{e===a&&(this._apiObject.downloads.open(r),this._apiObject.notifications.onClicked.removeListener(u),this._apiObject.notifications.onButtonClicked.removeListener(u),c=null,t({status:s.SUCCESS,actionGuid:o.actionGuid,data:{filename:h,downloadId:r}}),this._apiObject.notifications.clear(a))};return c&&(this._apiObject.notifications.onClicked.removeListener(c),this._apiObject.notifications.onButtonClicked.removeListener(c)),void this._apiObject.notifications.clear(a,(()=>{this._apiObject.notifications.create(a,l,(()=>{this._apiObject.notifications.onClicked.addListener(u),chrome.notifications.onButtonClicked.addListener(u),c=u,t({status:s.PROGRESS,actionGuid:o.actionGuid,data:{filename:h,downloadId:r}})}))}))}}if(o.type===r.SHOW_DOWNLOADED_FILE){if(o.payload.downloadId)return this._apiObject.downloads.show(o.payload.downloadId),t({status:s.SUCCESS,actionGuid:o.actionGuid});const e=yield this._getDownloadItems({filenameRegex:o.payload.filename,orderBy:["-startTime"],exists:!0,startedAfter:o.payload.timeStamp});if(e.length>0){const n=e.shift(),r=n.id,c=n.filename.replace(/\\/g,"/").split("/").pop(),h={type:"basic",iconUrl:this._apiObject.runtime.getURL("sbisPlugin-logo-48.png"),priority:2,title:(0,i.getLocalizedString)("СБИС Плагин",d),message:(0,i.getLocalizedString)("Пожалуйста, запустите файл $filename$ в появившемся окне",d).replace("$filename$",c)};return this._apiObject.notifications.clear(a,(()=>{this._apiObject.notifications.create(a,h,(()=>{this._apiObject.downloads.show(r)}))})),t({status:s.SUCCESS,actionGuid:o.actionGuid,data:{filename:c,downloadId:r}})}}return t({status:s.FAIL,actionGuid:o.actionGuid})}))}_getDownloadItems(e){return new Promise((t=>{this._apiObject.downloads.search(e,t)}))}}},116:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.CONNECTION_STATE=void 0;const o=n(249);var i;!function(e){e[e.UNKNOWN=-1]="UNKNOWN",e[e.OPEN=0]="OPEN",e[e.CLOSED=1]="CLOSED"}(i=t.CONNECTION_STATE||(t.CONNECTION_STATE={}));const s=e=>{};t.default=class{constructor(){this.connectionState=i.UNKNOWN,this.onDisconnect=null,this.onMessage=s,this.onBroadcast=s,this.queries={},this._port=null,this._receiveMessageFromNmh=this._receiveMessageFromNmh.bind(this)}connectToNmh(e){if(this._port)e&&e();else{try{this._port=chrome.runtime.connectNative("ru.tensor.sbis_plugin_nmh")}catch(e){return o.default.error("Native Messaging Host connection fail ("+e.name+") : "+e.message),void(this.onDisconnect&&this.onDisconnect())}o.default.log("Native Messaging Host connection successful"),this.connectionState=i.OPEN,e&&e(),this._port.onMessage.addListener(this._receiveMessageFromNmh),this._port.onDisconnect.addListener((()=>{var e;this.connectionState=i.CLOSED,o.default.log("Native Messaging Host disconnected outside"),this._port=null,this.onBroadcast({id:-1,cmd:"error",data:"Native Messaging Host is crashed"}),"Native host has exited."===(null===(e=chrome.runtime.lastError)||void 0===e?void 0:e.message)&&this.connectToNmh(),this.onDisconnect&&this.onDisconnect()}))}}sendMessageToNmh(e){if(!this._port)return this.connectToNmh(),void this.onMessage({tab_id:e.tab_id,id:e.id,cmd:"error",data:"Send message to NMH fail. NMHPort is unavailable"});e.type="FROM_BACKGROUND_SCRIPT_TO_NMH",o.default.log(e);try{this._port.postMessage(e)}catch(t){o.default.error("Send message to NMH fail ("+t.name+") : "+t.message),this.onMessage({tab_id:e.tab_id,id:e.id,cmd:"error",data:"Send message to NMH fail"})}}sendCleanMessageToNmh(e){var t;null===(t=this._port)||void 0===t||t.postMessage(e)}hasPort(){return!!this._port}disconnectFromNmh(){this._port&&(o.default.log("Native Messaging Host disconnect"),this._port.disconnect(),this._port=null)}_receiveMessageFromNmh(e,t){if(e.hasOwnProperty("parts")&&parseInt(e.parts,10)>1){this.queries.hasOwnProperty(e.parts_id)||(this.queries[e.parts_id]=[]);const t=e.parts_id;if(this.queries[t].push(e),this.queries[t].length===parseInt(e.parts,10)){const n={cmd:e.cmd,id:e.id,tab_id:e.tab_id,data:""};this.queries[t].forEach((e=>{n.data+=e.data})),this.onMessage(n),delete this.queries[t]}}else this.onMessage(e)}}},789:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0});const o=n(116),i=e=>{};t.default=class{constructor(e){this.onConnect=i,this.onDisconnect=null,this._onPluginConnected=null,this._nmhPort=e,this._nmhPort.onDisconnect=()=>{this.onDisconnect&&this.onDisconnect()}}connectService(){return new Promise((e=>{this._nmhPort.connectToNmh((()=>{this._nmhPort.sendMessageToNmh({cmd:"connect",data:"ws://127.0.0.1:8201",id:-2,origin:"https://online.sbis.ru",tab_id:-2,type:"FROM_CONTENT_SCRIPT_TO_BACKGROUND"}),this._onPluginConnected=()=>{e(!0)}}))}))}parsePingMessage(e){if(-2===e.id&&"message"===e.cmd){const t=JSON.parse(e.data),n=t.data;if("event"===t.type&&"needReconnect"===n.eventName){const e=n.data.Port;return void this._connectPlugin(e)}}if(-3!==e.id);else{if("message"===e.cmd){const t=JSON.parse(e.data);"event"===t.type&&"connected"===t.data.eventName&&(this._onPluginConnected&&this._onPluginConnected(),this.onConnect({tab_id:-1,id:-3,cmd:"plugin_connected",data:""}))}"disconnect"===e.cmd&&this.onDisconnect&&this.onDisconnect()}}isPingMessage(e){return-2===e.id||-3===e.id}_connectPlugin(e){this._nmhPort.connectionState===o.CONNECTION_STATE.OPEN&&this._nmhPort.sendMessageToNmh({cmd:"connect",data:"ws://127.0.0.1:"+e,id:-3,origin:"https://online.sbis.ru",tab_id:-3,type:"FROM_CONTENT_SCRIPT_TO_BACKGROUND"})}}},147:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0});const o=n(249),i=e=>{};t.default=class{constructor(){this.onQuery=i,this.contentTabs=new Map,this._receiveMessageFromContent=this._receiveMessageFromContent.bind(this),chrome.runtime.onMessage.addListener(this._receiveMessageFromContent)}checkTab(e){return"number"==typeof e&&this.contentTabs.has(e)}checkTabListOnEmpty(){return 0===this.contentTabs.size}addTab(e,t){this.contentTabs.set(e,t)}removeTab(e){this.contentTabs.delete(e)}broadcastMessage(e){this.contentTabs.forEach(((t,n)=>{e.tab_id=n,this.sendMessage(e)}))}sendToAllTabs(e){this.broadcastMessage(e)}sendMessage(e){if(this.checkTab(e.tab_id)){e.type="FROM_BACKGROUND_SCRIPT_TO_CONTENT_SCRIPT",o.default.log(e);try{chrome.tabs.sendMessage(e.tab_id,e)}catch(e){o.default.error("Send message to content fail ("+e.name+") : "+e.message)}}else o.default.log("received data from NMH is bad")}_receiveMessageFromContent(e,t,n){e.tab_id=t.tab.id,e.origin=new URL(t.url).origin,n({tab_id:t.tab.id}),this.checkTab(t.tab.id)||(o.default.log("Create tab: id="+t.tab.id+"; url="+t.tab.url),this.addTab(t.tab.id,t.tab.url)),this.onQuery(e)}}},499:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.getLocalizedString=t.UI_LANG=void 0;const n={"СБИС Плагин":"Saby Plugin","Пожалуйста, нажмите на уведомление, чтобы запустить установку":"Please click on the notification to start the installation",Установить:"Install","Пожалуйста, запустите файл $filename$ в появившемся окне":"Please run the file $filename$ in the window that appears"};var o;!function(e){e.EN="en",e.RU="ru"}(o=t.UI_LANG||(t.UI_LANG={})),t.getLocalizedString=(e,t)=>{let i;return t===o.EN&&(i=n[e]),i||e}},439:function(e,t,n){var o=this&&this.__awaiter||function(e,t,n,o){return new(n||(n=Promise))((function(i,s){function r(e){try{c(o.next(e))}catch(e){s(e)}}function a(e){try{c(o.throw(e))}catch(e){s(e)}}function c(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(r,a)}c((o=o.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0}),t.AM_TAB_ID=void 0;const i=n(249),s=n(194);t.AM_TAB_ID=-5;class r{constructor(e,t,n=0,o=0){this.type=e,this.site=t,this.timeFrom=n,this.timeTo=o}}function a(){let e=(new Date).getTime();return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(t=>{const n=(e+16*Math.random())%16|0;return e=Math.floor(e/16),("x"===t?n:3&n|8).toString(16)}))}t.default=class{constructor(e,t){this.urlCache=[],this.urlToSend=[],this.connId=-5,this.port=8201,this.needConnect=!0,this.sendIntervalId=null,this.isChromeExtension=e,this._nmhPort=t,this.onUpdatedListener=this.onUpdatedListener.bind(this),this.onActivatedListener=this.onActivatedListener.bind(this),this.onFocusChangedListener=this.onFocusChangedListener.bind(this),e?chrome.runtime.getPlatformInfo((e=>{e.os.search("linux")>-1&&(this.nmhSendFunction=this.trySend,this.start())})):-1!==window.navigator.platform.search("Linux")&&(this.nmhSendFunction=this.trySend,this.start())}trySend(e){if(i.default.info("messageFromAmToNmh "+JSON.stringify(e)),this._nmhPort.connectToNmh(),this._nmhPort.hasPort())try{this._nmhPort.sendCleanMessageToNmh(e)}catch(e){i.default.log("failSend "+JSON.stringify(e))}else i.default.log("null nmhPort")}setNmhSendFunction(e){this.nmhSendFunction=e}isAmMessage(e){return e.tab_id===t.AM_TAB_ID}messageFromNmhToAm(e){if(i.default.info("messageFromNmhToAm "+JSON.stringify(e)),!e.hasOwnProperty("cmd"))return;if("connect"===e.cmd)return void(e.id===this.connId&&(this.needConnect=!1,i.default.logStore("подключение успешно")));if("disconnect"===e.cmd)return void(e.id===this.connId&&this.tryReconnect());if("error"===e.cmd)return void this.tryReconnect();if("message"!==e.cmd)return;const t=JSON.parse(e.data);if(!t.hasOwnProperty("type")||!t.hasOwnProperty("data"))return;let n=t.data;if("event"===t.type){if(n.hasOwnProperty("eventName")&&"needReconnect"===n.eventName&&n.hasOwnProperty("data")){const e=n.data;e.hasOwnProperty("Port")&&(this.port=e.Port,this.tryReconnect(),i.default.logStore(`Подключение к порту ${this.port}, ИД подключения ${this.connId}`),this.nmhSendFunction(this._composeConnectMessage())),i.default.logStore("needReconnect без указания нового порта")}}else if("answer"===t.type)n=JSON.parse(n),n.hasOwnProperty("result")&&null===n.result&&(i.default.logStore("успешная отправка"),this.urlToSend=[]);else if("error"===t.type&&n.hasOwnProperty("error")&&n.hasOwnProperty("errorType")&&"RPC_ERROR"===n.errorType){const e=n.error;i.default.logStore("RPC_ERROR "+JSON.stringify(e))}}start(){i.default.logStore("Запуск ActivityMonitor"),chrome.tabs.onUpdated.addListener(this.onUpdatedListener),chrome.tabs.onActivated.addListener(this.onActivatedListener),chrome.windows.onFocusChanged.Filters=["normal","devtools"],chrome.windows.onFocusChanged.addListener(this.onFocusChangedListener),this.sendIntervalId=setInterval((()=>this.sendUrls()),3e5)}stop(){i.default.logStore("Остановка ActivityMonitor"),chrome.tabs.onUpdated.removeListener(this.onUpdatedListener),chrome.tabs.onActivated.removeListener(this.onActivatedListener),chrome.windows.onFocusChanged.removeListener(this.onFocusChangedListener),this.sendIntervalId&&clearInterval(this.sendIntervalId)}tryReconnect(){this.needConnect=!0,this.connId--}onURLChanged(e){const t=Math.floor(Date.now()/1e3),n=this._siteFromUrl(e);if(this.urlCache.length){const e=this.urlCache[this.urlCache.length-1];if(e.timeTo=t,e.site===n.site)return}n.timeFrom=t,this.urlCache.push(n),i.default.info(n.site)}sendUrls(){return o(this,void 0,void 0,(function*(){if(this.urlCache.length){const e=Math.floor(Date.now()/1e3),t=this.urlCache[this.urlCache.length-1];t.timeTo=e,this.urlToSend=this.urlToSend.concat(this.urlCache.filter((e=>e.timeFrom<e.timeTo))),this.urlCache=[new r(t.type,t.site,e,e)]}this.urlToSend.length&&(this.needConnect&&(i.default.logStore(`Подключение к порту ${this.port}, ИД подключения ${this.connId}`),this.nmhSendFunction(this._composeConnectMessage()),yield(1e3,new Promise((e=>setTimeout(e,1e3)))),this.needConnect)||(i.default.logStore(`Отправка ${this.urlToSend.length} записей`),this.nmhSendFunction(this._composeMessage())))}))}getTabId(){return t.AM_TAB_ID}_composeConnectMessage(){return{type:"FROM_BACKGROUND_SCRIPT_TO_NMH",cmd:"connect",tab_id:t.AM_TAB_ID,id:this.connId,part:1,parts:1,parts_id:a(),data:"ws://127.0.0.1:"+this.port}}_urlsToRecordSetTimestamp(){return{s:[{n:"Type",t:"Число целое"},{n:"Name",t:"Строка"},{n:"Description",t:"Строка"},{n:"Begin",t:"Число целое"},{n:"End",t:"Число целое"}],f:0,d:this.urlToSend.map((e=>[e.type,e.site,"",e.timeFrom,e.timeTo])),_type:"recordset"}}_composeMessage(){return{type:"FROM_BACKGROUND_SCRIPT_TO_NMH",cmd:"message",tab_id:t.AM_TAB_ID,id:this.connId,part:1,parts:1,parts_id:a(),data:JSON.stringify({accessToken:null,protoVersion:1,queryId:a(),serviceGuid:"3e3b1954-6cf1-472e-93a1-8b14ca1faab6",lang:"ru-RU",moduleName:"ActivityMonitor",moduleVersion:"1.1.0.0",query:JSON.stringify({jsonrpc:"2.0",protocol:5,method:"ActivityMonitor.UrlFromExtension",params:{browser:this.isChromeExtension?"chrome":"firefox",urls:this._urlsToRecordSetTimestamp()},id:this.connId})})}}onUpdatedListener(e,t,n){"loading"===t.status&&n.active&&(this.onURLChanged(n.url),this.isChromeExtension&&"chrome://extensions/SbisPluginExtension/save_logs"===n.url&&i.default.logsLoaded.then((()=>{var e,t;e=`SBISPluginExtension_${chrome.runtime.getManifest().version}_logs.txt`,t=JSON.stringify(i.default.logs),chrome.downloads.download({filename:e,saveAs:!0,url:`data:text/plain,${t}`})})))}onActivatedListener(e){e.tabId!==chrome.tabs.TAB_ID_NONE&&chrome.tabs.get(e.tabId,(e=>{this.onURLChanged(e.url)}))}onFocusChangedListener(e){if(e===chrome.windows.WINDOW_ID_NONE){const e={populate:!1};this.isChromeExtension&&(e.windowTypes=["normal","devtools"]),chrome.windows.getCurrent(e,(e=>{"devtools"===e.type&&this.onURLChanged("devtools")}))}else chrome.tabs.query({active:!0,windowId:e},(e=>{var t;this.onURLChanged(null===(t=e[0])||void 0===t?void 0:t.url)}))}_siteFromUrl(e){if(this.isChromeExtension){if(!e||"devtools"===e)return new r(0,"Инструмент разработчика в браузере")}else if(!e)return new r(0,"firefox");const t=new URL(e);return this.isChromeExtension||"about:"!==t.protocol||"devtools-toolbox"!==t.pathname?"file:"===t.protocol?new r(0,"Просмотр файлов в браузере"):"http:"!==t.protocol&&"https:"!==t.protocol?new r(0,this.isChromeExtension?"chrome":"firefox"):new r(1,s.default.toUnicode(t.hostname)):new r(0,"Инструмент разработчика в браузере")}}},481:function(e,t,n){var o=this&&this.__awaiter||function(e,t,n,o){return new(n||(n=Promise))((function(i,s){function r(e){try{c(o.next(e))}catch(e){s(e)}}function a(e){try{c(o.throw(e))}catch(e){s(e)}}function c(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(r,a)}c((o=o.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0}),t.start=void 0;const i=n(249),s=n(789),r="ALARM_PING";function a(){chrome.alarms.create(r,{delayInMinutes:.05})}function c(){chrome.alarms.clear(r)}("undefined"==typeof window?self:window).SPDebug=e=>{i.default.debugMode=e},t.start=function(e,t,n,i){const d=new s.default(n);n.onMessage=n=>{d.isPingMessage(n)?d.parsePingMessage(n):e.isAmMessage(n)?e.messageFromNmhToAm(n):t.sendMessage(n)},n.onBroadcast=e=>{t.broadcastMessage(e)},t.onQuery=e=>o(this,void 0,void 0,(function*(){i.isAction(e.cmd)?i.processAction(e.data,(n=>{n&&t.sendMessage({id:e.id,tab_id:e.tab_id,cmd:"extension_action_result",data:JSON.stringify(n)})})):n.sendMessageToNmh(e)})),d.onDisconnect=()=>{c(),a(),e.tryReconnect()},d.onConnect=e=>{t.sendToAllTabs(e)},chrome.alarms.onAlarm.addListener((e=>{if(e.name===r){const e=2e3;Promise.race([d.connectService(),new Promise((t=>{setTimeout((()=>t(!1)),e)}))]).then((e=>{if(e)return c();a()}))}})),a()},chrome.runtime.onStartup.addListener((()=>{i.default.deleteOldLogs().then((()=>{i.default.logStore("startup")}))}))},249:function(e,t){var n=this&&this.__awaiter||function(e,t,n,o){return new(n||(n=Promise))((function(i,s){function r(e){try{c(o.next(e))}catch(e){s(e)}}function a(e){try{c(o.throw(e))}catch(e){s(e)}}function c(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(r,a)}c((o=o.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0});const o="SbisPluginTransport:NMH:background:";function i(e){return"number"==typeof e?i(new Date(e)):`${e.getFullYear()}-${("0"+(e.getMonth()+1)).slice(-2)}-${("0"+e.getDate()).slice(-2)} ${("0"+e.getHours()).slice(-2)}:${("0"+e.getMinutes()).slice(-2)}:${("0"+e.getSeconds()).slice(-2)}`}t.default=new class{constructor(){this.debugMode=!1,this.logs=[],this.logsLoaded=new Promise((e=>{chrome.storage.local.get(["logs"],(t=>{t.hasOwnProperty("logs")?this.logs=t.logs:this.logs=[],e()}))}))}log(e){this.debugMode&&console.log(o+ +new Date,e)}error(e){this.debugMode&&console.error(o+ +new Date,e)}info(e){this.debugMode&&console.info(o+ +new Date,e)}logStore(e){const t=Date.now(),n=`${i(t)} ${t/1e3} ${"string"==typeof e?e:JSON.stringify(e)}`;this.debugMode&&console.log(o+n),this.logsLoaded.then((()=>{this.logs.push({time:t,message:n}),this._saveLogsToStorage()}))}deleteOldLogs(){return n(this,void 0,void 0,(function*(){const e=Date.now()-864e6;yield this.logsLoaded;const t=this.logs.length;this.logs=this.logs.filter((t=>t.time>e));const n=this.logs.length-t;n&&this.logStore({msg:`deleteOldLogs: удалено ${n} записей старше ${i(e)}, осталось ${this.logs.length}`})}))}_saveLogsToStorage(){this.logs&&(this.logs.splice(0,this.logs.length-1e3),chrome.storage.local.set({logs:this.logs}))}}},194:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0});const n=function(){const e={};e.utf16={decode:function(e){for(var t,n,o=[],i=0,s=e.length;i<s;){if(55296==(63488&(t=e.charCodeAt(i++)))){if(n=e.charCodeAt(i++),55296!=(64512&t)||56320!=(64512&n))throw new RangeError("UTF-16(decode): Illegal UTF-16 sequence");t=((1023&t)<<10)+(1023&n)+65536}o.push(t)}return o},encode:function(e){for(var t,n=[],o=0,i=e.length;o<i;){if(55296==(63488&(t=e[o++])))throw new RangeError("UTF-16(encode): Illegal UTF-16 value");t>65535&&(t-=65536,n.push(String.fromCharCode(t>>>10&1023|55296)),t=56320|1023&t),n.push(String.fromCharCode(t))}return n.join("")}};var t=36,o=2147483647;function i(e,t){return e+22+75*(e<26)-((0!=t)<<5)}function s(e,n,o){var i;for(e=o?Math.floor(e/700):e>>1,e+=Math.floor(e/n),i=0;e>455;i+=t)e=Math.floor(e/35);return Math.floor(i+36*e/(e+38))}return e.decode=function(n,i){var r,a,c,d,h,l,u,f,g,m,p,_,v,b,w=[],y=[],C=n.length;for(r=128,c=0,d=72,(h=n.lastIndexOf("-"))<0&&(h=0),l=0;l<h;++l){if(i&&(y[w.length]=n.charCodeAt(l)-65<26),n.charCodeAt(l)>=128)throw new RangeError("Illegal input >= 0x80");w.push(n.charCodeAt(l))}for(u=h>0?h+1:0;u<C;){for(f=c,g=1,m=t;;m+=t){if(u>=C)throw RangeError("punycode_bad_input(1)");if((p=(b=n.charCodeAt(u++))-48<10?b-22:b-65<26?b-65:b-97<26?b-97:t)>=t)throw RangeError("punycode_bad_input(2)");if(p>Math.floor((o-c)/g))throw RangeError("punycode_overflow(1)");if(c+=p*g,p<(_=m<=d?1:m>=d+26?26:m-d))break;if(g>Math.floor(o/(t-_)))throw RangeError("punycode_overflow(2)");g*=t-_}if(d=s(c-f,a=w.length+1,0===f),Math.floor(c/a)>o-r)throw RangeError("punycode_overflow(3)");r+=Math.floor(c/a),c%=a,i&&y.splice(c,0,n.charCodeAt(u-1)-65<26),w.splice(c,0,r),c++}if(i)for(c=0,v=w.length;c<v;c++)y[c]&&(w[c]=String.fromCharCode(w[c]).toUpperCase().charCodeAt(0));return e.utf16.encode(w)},e.encode=function(n,r){var a,c,d,h,l,u,f,g,m,p,_,v;r&&(v=e.utf16.decode(n));var b=(n=e.utf16.decode(n.toLowerCase())).length;if(r)for(u=0;u<b;u++)v[u]=n[u]!=v[u];var w,y=[];for(a=128,c=0,l=72,u=0;u<b;++u)n[u]<128&&y.push(String.fromCharCode(v?(w=n[u],(w-=(w-97<26)<<5)+((!v[u]&&w-65<26)<<5)):n[u]));for(d=h=y.length,h>0&&y.push("-");d<b;){for(f=o,u=0;u<b;++u)(_=n[u])>=a&&_<f&&(f=_);if(f-a>Math.floor((o-c)/(d+1)))throw RangeError("punycode_overflow (1)");for(c+=(f-a)*(d+1),a=f,u=0;u<b;++u){if((_=n[u])<a&&++c>o)return Error("punycode_overflow(2)");if(_==a){for(g=c,m=t;!(g<(p=m<=l?1:m>=l+26?26:m-l));m+=t)y.push(String.fromCharCode(i(p+(g-p)%(t-p),0))),g=Math.floor((g-p)/(t-p));y.push(String.fromCharCode(i(g,r&&v[u]?1:0))),l=s(c,d+1,d==h),c=0,++d}}++c,++a}return y.join("")},e.toASCII=function(e){for(var t=e.split("."),o=[],i=0;i<t.length;++i){var s=t[i];o.push(s.match(/[^A-Za-z0-9-]/)?"xn--"+n.encode(s):s)}return o.join(".")},e.toUnicode=function(e){for(var t=e.split("."),o=[],i=0;i<t.length;++i){var s=t[i];o.push(s.match(/^xn--/)?n.decode(s.slice(4)):s)}return o.join(".")},e}();t.default=n}},t={};function n(o){var i=t[o];if(void 0!==i)return i.exports;var s=t[o]={exports:{}};return e[o].call(s.exports,s,s.exports,n),s.exports}(()=>{const e=n(481),t=n(439),o=n(147),i=n(116),s=n(249),r=n(82),a=new i.default,c=new t.default(!1,a),d=new o.default;(0,e.start)(c,d,a,new r.default(!0)),chrome.tabs.onRemoved.addListener((e=>{d.checkTab(e)&&(s.default.log("Remove tab: id="+e),d.removeTab(e),a.sendMessageToNmh({tab_id:e,id:-1,cmd:"disconnect",data:""}),d.checkTabListOnEmpty()&&a.disconnectFromNmh())})),chrome.tabs.query({url:["*://addons.mozilla.org/*/sbisplugin-extension*"]},(e=>{e.forEach((e=>{chrome.windows.get(e.windowId,{populate:!0},(t=>{var n;1===(null===(n=null==t?void 0:t.tabs)||void 0===n?void 0:n.length)&&chrome.windows.remove(e.windowId)}))}))}))})()})();