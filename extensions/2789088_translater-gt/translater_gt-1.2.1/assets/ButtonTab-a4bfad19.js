import{ak as M,al as ye,L as $,S as K,i as W,s as V,t as m,g as b,B as C,T as Ee,k as X,C as De,D as A,E as ee,o as T,F as G,e as P,G as N,b as v,l as U,f as Be,H as z,I as J,J as Q,K as te,h as k,r as re,M as Ce,v as Z,N as ue,O as ie,P as x,Q as H,w as Ne,x as fe,R as de,U as Ve,W as Se,_ as qe,c as S,m as L,$ as Me,j as I,X as B,a1 as pe,a3 as Ue,n as Y,am as xe,Y as Le,a as D,d as q,Z as Ie,an as He,a0 as Fe}from"./vendor-56a33bfc.js";import{p as F,B as Oe,I as j,m as Ke,w as We,x as Xe,y as Ze}from"./index-672f1a32.js";import{a as je,g as ne}from"./browserApi-b02d1f59.js";const Ge=({sourceLang:o,targetLang:e,orig:n,trans:t})=>{const s=M(F);if(!s.historyEnable)return;const l={sourceLang:o,targetLang:e,orig:n,trans:t,time:Date.now()};s.history=[l,...s.history],s.history.length>=s.historyLength&&(s.history=s.history.slice(0,s.historyLength)),F.set(s)},ze={textToTranslate:null,selectedText:null,translated:null,pending:!1,error:!1,sourceLang:"auto",hostname:null,isInTextField:!1,selectedElemRect:null,selectedEndCoord:null,cacheTranslate:[],cacheTTS:[],audioContextSource:null,cacheIndex:-1},y=$(ze),Je=ye(y,o=>o.selectedText);ye(y,o=>o.sourceLang);const Qe=async(o,e,n)=>{try{const t={sourceLang:o,targetLang:e,selectedText:n};return await chrome.runtime.sendMessage({type:"getTranslate",content:t})}catch(t){throw console.error("Error occurred while fetching translation: ",t),t}},Ye=async()=>{const o=M(y),e=M(F),n={},t=e.targetLang,s=o.selectedText,l=o.sourceLang;let a;const i=o.cacheTranslate.find(r=>r.sentences.orig===s&&r.targetLang===t&&r.sourceLang===l);return i?(a=i,y.update(r=>({...r,sourceLang:i.src})),F.update(r=>({...r,targetLang:i.targetLang}))):(a=await Qe(l,t,s),["orig","trans","translit","src_translit"].forEach(r=>{n[r]=a.sentences.reduce((c,u)=>c+=u[r]??"","")}),a.sentences=n,a.targetLang=t,y.update(r=>({...r,cacheTranslate:[...r.cacheTranslate,a],sourceLang:r.sourceLang==="auto"?a.src:r.sourceLang,cacheIndex:-1})),Ge({sourceLang:a.src,targetLang:t,orig:n.orig,trans:n.trans})),a},Re=()=>{y.update(o=>({...o,selectedText:null,sourceLang:"auto",targetLang:je(),translated:{sourceLang:"auto",spell:{},ld_result:{srclangs:["auto"]},sentences:{orig:"",trans:""}},cacheIndex:0}))};async function $e(){if(!M(y).selectedText){Re();return}y.update(e=>({...e,pending:!0,error:!1}));try{const e=await Ye();y.update(n=>({...n,translated:e}))}catch(e){y.update(n=>({...n,error:e}))}y.update(e=>({...e,pending:!1}))}Je.subscribe(o=>{o?$e():Re()});const et=o=>{const e=n=>{o&&!n.composedPath().includes(o)&&o.dispatchEvent(new CustomEvent("click_outside"))};return document.addEventListener("mousedown",e,!0),{destroy(){document.removeEventListener("mousedown",e,!0)}}};function tt(o){let e,n,t,s;const l=o[5].default,a=G(l,o,o[4],null);let i=[o[2]],r={};for(let c=0;c<i.length;c+=1)r=A(r,i[c]);return{c(){e=P(se),a&&a.c(),N(se)(e,r)},m(c,u){v(c,e,u),a&&a.m(e,null),n=!0,t||(s=[U(e,"click_outside",o[6]),Be(et.call(null,e))],t=!0)},p(c,u){a&&a.p&&(!n||u&16)&&z(a,l,c,c[4],n?Q(l,c[4],u,null):J(c[4]),null),N(se)(e,r=te(i,[u&4&&c[2]]))},i(c){n||(m(a,c),n=!0)},o(c){b(a,c),n=!1},d(c){c&&k(e),a&&a.d(c),t=!1,re(s)}}}function nt(o){let e,n=tt(o);return{c(){n&&n.c()},m(t,s){n&&n.m(t,s),e=!0},p(t,[s]){n.p(t,s)},i(t){e||(m(n,t),e=!0)},o(t){b(n,t),e=!1},d(t){n&&n.d(t)}}}const Ae="listbox-context",ce=()=>Ce(Ae);let se="div";function st(o,e,n){const t=["value"];let s=C(e,t),l,{$$slots:a={},$$scope:i}=e,{value:r}=e;const c=Ee(),u=$({listboxOpen:!1,activeOptionIndex:null,buttonRef:null,optionsRef:[],value:r,select(f){n(3,r=f),c("change")}});X(o,u,f=>n(0,l=f)),De(Ae,u);const d=()=>{T(u,l.listboxOpen=!1,l)};return o.$$set=f=>{e=A(A({},e),ee(f)),n(2,s=C(e,t)),"value"in f&&n(3,r=f.value),"$$scope"in f&&n(4,i=f.$$scope)},o.$$.update=()=>{o.$$.dirty&8&&T(u,l.value=r,l)},[l,u,s,r,i,a,d]}class lt extends K{constructor(e){super(),W(this,e,st,nt,V,{value:3})}}const E={First:"first",Prev:"prev",Next:"next",Last:"last"},R={Space:"Space",Enter:"Enter",Escape:"Escape",ArrowUp:"ArrowUp",ArrowRight:"ArrowRight",ArrowDown:"ArrowDown",ArrowLeft:"ArrowLeft",Home:"Home",End:"End",PageUp:"PageUp",PageDown:"PageDown",Tab:"Tab"};function Pe({action:o,items:e,currentActiveIndex:n}){let t,s=n??-1;switch(o){case E.First:t=e.findIndex(l=>!l.disabled);break;case E.Prev:t=e.findLastIndex((l,a)=>a<s&&!l.disabled);break;case E.Next:t=e.findIndex((l,a)=>a>s&&!l.disabled);break;case E.Last:t=e.findLastIndex(l=>!l.disabled);break}return t===-1?n:t}function le(o){let e,n,t,s;const l=o[8].default,a=G(l,o,o[7],null);let i=[{"aria-haspopup":"listbox"},o[2],o[6]],r={};for(let c=0;c<i.length;c+=1)r=A(r,i[c]);return{c(){e=P(o[0]),a&&a.c(),N(o[0])(e,r)},m(c,u){v(c,e,u),a&&a.m(e,null),o[9](e),n=!0,t||(s=[U(e,"click",o[4]),U(e,"keydown",o[5])],t=!0)},p(c,u){a&&a.p&&(!n||u&128)&&z(a,l,c,c[7],n?Q(l,c[7],u,null):J(c[7]),null),N(c[0])(e,r=te(i,[{"aria-haspopup":"listbox"},c[2],u&64&&c[6]]))},i(c){n||(m(a,c),n=!0)},o(c){b(a,c),n=!1},d(c){c&&k(e),a&&a.d(c),o[9](null),t=!1,re(s)}}}function ot(o){let e=o[0],n,t,s=o[0]&&le(o);return{c(){s&&s.c(),n=Z()},m(l,a){s&&s.m(l,a),v(l,n,a),t=!0},p(l,[a]){l[0]?e?V(e,l[0])?(s.d(1),s=le(l),e=l[0],s.c(),s.m(n.parentNode,n)):s.p(l,a):(s=le(l),e=l[0],s.c(),s.m(n.parentNode,n)):e&&(s.d(1),s=null,e=l[0])},i(l){t||(m(s,l),t=!0)},o(l){b(s,l),t=!1},d(l){l&&k(n),s&&s.d(l)}}}function at(o,e,n){const t=["as"];let s=C(e,t),l,{$$slots:a={},$$scope:i}=e,{as:r="button"}=e,c={tabindex:r==="button"?0:-1,type:r==="button"?"button":void 0};const u=ce();X(o,u,_=>n(1,l=_));const d=()=>{T(u,l.listboxOpen=!l.listboxOpen,l)},f=_=>{l.optionsRef[_].focus({preventScroll:!0}),l.optionsRef[_].scrollIntoView({block:"nearest"})},g=_=>{const p=Pe({action:_,items:l.optionsRef,currentActiveIndex:l.activeOptionIndex});f(p),T(u,l.activeOptionIndex=p,l)},O=async _=>{switch(_.code){case R.Space:case R.Enter:case R.ArrowDown:_.preventDefault(),_.stopPropagation(),T(u,l.listboxOpen=!0,l),await ue(),l.value||g(E.First);break;case R.ArrowUp:_.preventDefault(),_.stopPropagation(),T(u,l.listboxOpen=!0,l),await ue(),l.value||g(E.Last);break}};function w(_){ie[_?"unshift":"push"](()=>{l.buttonRef=_,u.set(l)})}return o.$$set=_=>{e=A(A({},e),ee(_)),n(6,s=C(e,t)),"as"in _&&n(0,r=_.as),"$$scope"in _&&n(7,i=_.$$scope)},[r,l,c,u,d,O,s,i,a,w]}class rt extends K{constructor(e){super(),W(this,e,at,ot,V,{as:0})}}function ge(o){let e,n=it(o);return{c(){n&&n.c()},m(t,s){n&&n.m(t,s),e=!0},p(t,s){n.p(t,s)},i(t){e||(m(n,t),e=!0)},o(t){b(n,t),e=!1},d(t){n&&n.d(t)}}}function it(o){let e,n,t,s,l;const a=o[5].default,i=G(a,o,o[4],null);let r=[{role:"listbox"},{tabindex:"0"},o[3]],c={};for(let u=0;u<r.length;u+=1)c=A(c,r[u]);return{c(){e=P(oe),i&&i.c(),N(oe)(e,c)},m(u,d){v(u,e,d),i&&i.m(e,null),t=!0,s||(l=U(e,"keydown",o[2]),s=!0)},p(u,d){i&&i.p&&(!t||d&16)&&z(i,a,u,u[4],t?Q(a,u[4],d,null):J(u[4]),null),N(oe)(e,c=te(r,[{role:"listbox"},{tabindex:"0"},d&8&&u[3]]))},i(u){t||(m(i,u),u&&Ne(()=>{t&&(n||(n=fe(e,de,{duration:150,y:-10},!0)),n.run(1))}),t=!0)},o(u){b(i,u),u&&(n||(n=fe(e,de,{duration:150,y:-10},!1)),n.run(0)),t=!1},d(u){u&&k(e),i&&i.d(u),u&&n&&n.end(),s=!1,l()}}}function ct(o){let e,n,t=o[0].listboxOpen&&ge(o);return{c(){t&&t.c(),e=Z()},m(s,l){t&&t.m(s,l),v(s,e,l),n=!0},p(s,[l]){s[0].listboxOpen?t?(t.p(s,l),l&1&&m(t,1)):(t=ge(s),t.c(),m(t,1),t.m(e.parentNode,e)):t&&(x(),b(t,1,1,()=>{t=null}),H())},i(s){n||(m(t),n=!0)},o(s){b(t),n=!1},d(s){s&&k(e),t&&t.d(s)}}}let oe="ul";function ut(o,e,n){const t=[];let s=C(e,t),l,{$$slots:a={},$$scope:i}=e;const r=ce();X(o,r,f=>n(0,l=f));const c=f=>{l.optionsRef[f].focus({preventScroll:!0}),l.optionsRef[f].scrollIntoView({block:"nearest"})},u=f=>{const g=Pe({action:f,items:l.optionsRef,currentActiveIndex:l.activeOptionIndex});c(g),T(r,l.activeOptionIndex=g,l)},d=f=>{switch(f.code){case R.ArrowUp:f.preventDefault(),f.stopPropagation(),u(E.Prev);break;case R.ArrowDown:f.preventDefault(),f.stopPropagation(),u(E.Next);break;case R.PageUp:case R.Home:f.preventDefault(),f.stopPropagation(),u(E.First);break;case R.End:case R.PageDown:f.preventDefault(),f.stopPropagation(),u(E.Last);break;case R.Escape:f.preventDefault(),f.stopPropagation(),T(r,l.listboxOpen=!1,l),l.buttonRef.focus({preventScroll:!0}),T(r,l.activeOptionIndex=null,l);break;case R.Tab:f.preventDefault(),f.stopPropagation();break}};return o.$$set=f=>{e=A(A({},e),ee(f)),n(3,s=C(e,t)),"$$scope"in f&&n(4,i=f.$$scope)},[l,r,d,s,i,a]}class ft extends K{constructor(e){super(),W(this,e,ut,ct,V,{})}}const dt=o=>({selected:o&2}),_e=o=>({selected:o[1]});function pt(o){let e,n,t,s,l,a;const i=o[10].default,r=G(i,o,o[9],_e);let c=[{"aria-selected":n=o[1]===!0?o[1]:void 0},{role:"option"},{tabindex:t=o[2]?0:-1},o[6]],u={};for(let d=0;d<c.length;d+=1)u=A(u,c[d]);return{c(){e=P(ae),r&&r.c(),N(ae)(e,u)},m(d,f){v(d,e,f),r&&r.m(e,null),o[11](e),s=!0,l||(a=[U(e,"click",o[4]),U(e,"keypress",o[5])],l=!0)},p(d,f){r&&r.p&&(!s||f&514)&&z(r,i,d,d[9],s?Q(i,d[9],f,dt):J(d[9]),_e),N(ae)(e,u=te(c,[(!s||f&2&&n!==(n=d[1]===!0?d[1]:void 0))&&{"aria-selected":n},{role:"option"},(!s||f&4&&t!==(t=d[2]?0:-1))&&{tabindex:t},f&64&&d[6]]))},i(d){s||(m(r,d),s=!0)},o(d){b(r,d),s=!1},d(d){d&&k(e),r&&r.d(d),o[11](null),l=!1,re(a)}}}function gt(o){let e,n=pt(o);return{c(){n&&n.c()},m(t,s){n&&n.m(t,s),e=!0},p(t,[s]){n.p(t,s)},i(t){e||(m(n,t),e=!0)},o(t){b(n,t),e=!1},d(t){n&&n.d(t)}}}let ae="li";function _t(o,e,n){let t,s;const l=["value"];let a=C(e,l),i,{$$slots:r={},$$scope:c}=e,{value:u}=e,d;const f=ce();X(o,f,p=>n(8,i=p));const g=async p=>{i.select(p),T(f,i.value=p,i),T(f,i.listboxOpen=!1,i),i.buttonRef.focus({preventScroll:!0}),T(f,i.activeOptionIndex=null,i)},O=()=>{g(u)},w=p=>{(p.code==="Space"||p.code==="Enter")&&g(u)};Ve(()=>{T(f,i.optionsRef=[...i.optionsRef,d],i),t&&(T(f,i.activeOptionIndex=i.optionsRef.indexOf(d),i),d.focus({preventScroll:!0}),d.scrollIntoView({block:"nearest"}))}),Se(()=>{T(f,i.optionsRef=i.optionsRef.filter(p=>p!==d),i)});function _(p){ie[p?"unshift":"push"](()=>{d=p,n(0,d)})}return o.$$set=p=>{e=A(A({},e),ee(p)),n(6,a=C(e,l)),"value"in p&&n(7,u=p.value),"$$scope"in p&&n(9,c=p.$$scope)},o.$$.update=()=>{o.$$.dirty&384&&n(1,t=i.value===u),o.$$.dirty&257&&n(2,s=i.activeOptionIndex!==null?i.optionsRef[i.activeOptionIndex]===d:!1)},[d,t,s,f,O,w,a,u,i,c,r,_]}class mt extends K{constructor(e){super(),W(this,e,_t,gt,V,{value:7})}}const bt=`<svg xmlns="http://www.w3.org/2000/svg" fill="currentColor" height="20" viewBox="0 -960 960 960" width="20"><path d="M728.17-91.079q-12.786 0-21.401-8.643t-8.615-21.42q0-6.013 2.266-11.961 2.265-5.949 6.041-9.667 43.385-43.384 67.308-99.192 23.923-55.808 23.923-120.451 0-63.664-23.923-119.78-23.923-56.115-67.308-99.5-3.776-3.745-6.041-9.738-2.266-5.994-2.266-11.987 0-12.735 8.643-21.35 8.643-8.616 21.42-8.616 6.013 0 11.638 2.603 5.625 2.602 9.375 6.32 51.692 51.692 80.076 119.154 28.385 67.461 28.385 142.918 0 76.388-28.385 143.542-28.384 67.153-80.076 118.846-3.761 3.717-9.402 6.32-5.641 2.602-11.658 2.602ZM622.967-196.232q-12.736 0-21.351-8.643-8.615-8.643-8.615-21.42 0-6.013 2.602-11.638 2.603-5.625 6.321-9.374 22.923-22.924 35.5-52.347 12.577-29.423 12.577-62.577 0-33.154-12.885-62.577-12.885-29.423-35.192-52.347-4.462-3.76-6.693-9.401-2.23-5.641-2.23-11.658 0-12.786 8.643-21.401t21.42-8.615q6.013 0 11.961 2.23 5.949 2.231 9.667 6.693 30.733 30.726 48.02 71.055 17.287 40.329 17.287 86.021t-17.287 86.021q-17.287 40.329-48.02 71.055-3.746 4.462-9.739 6.692-5.993 2.231-11.986 2.231Zm-522.966 96.231V-160q47.822 0 94.604-5.615 46.781-5.616 91.705-22.77 4.615-1.923 4.231-7.116-.385-5.192-6.924-6.731-46.769-18.384-75.192-58.615-28.424-40.23-28.424-90.076v-75.23h147.692q5.385 0 8.847-3.462 3.461-3.461 3.461-8.846v-103.845h121.153q6.924 0 10.578-5.578 3.654-5.577.577-11.731l-108-219.846q-5.692-11.154-1.73-22.615 3.961-11.461 15.115-17.538 11.153-6.077 22.999-1.923 11.846 4.154 17.538 15.307l108.384 220.231q17.692 36.153-3.071 69.922-20.764 33.769-61.39 33.769H400v46.154q0 29.154-20.423 49.577t-49.576 20.423H240v16q0 35.769 23.039 62.269 23.038 26.5 57.577 35.5l12 3q35.769 9.231 39.422 46.923 3.654 37.692-31.192 54.615-56.153 27.615-117.076 37.73-60.923 10.116-123.769 10.116Z"/></svg>
`;function me(o,e,n){const t=o.slice();return t[0]=e[n],t}function ht(o){let e,n;return{c(){e=new xe(!1),n=Z(),e.a=n},m(t,s){e.m(bt,t,s),v(t,n,s)},p:Y,d(t){t&&(k(n),e.d())}}}function vt(o){let e,n;return e=new Oe({props:{round:!0,tooltip:{title:o[0].name},$$slots:{default:[ht]},$$scope:{ctx:o}}}),{c(){S(e.$$.fragment)},m(t,s){L(e,t,s),n=!0},p(t,s){const l={};s&1&&(l.tooltip={title:t[0].name}),s&512&&(l.$$scope={dirty:s,ctx:t}),e.$set(l)},i(t){n||(m(e.$$.fragment,t),n=!0)},o(t){b(e.$$.fragment,t),n=!1},d(t){I(e,t)}}}function be(o){let e,n,t;return n=new j({props:{d:Ke}}),{c(){e=P("span"),S(n.$$.fragment),D(e,"class","absolute left-0 pl-3 text-blue-600")},m(s,l){v(s,e,l),L(n,e,null),t=!0},i(s){t||(m(n.$$.fragment,s),t=!0)},o(s){b(n.$$.fragment,s),t=!1},d(s){s&&k(e),I(n)}}}function kt(o){let e,n,t=o[0].name+"",s,l,a,i,r=o[8]&&be();return{c(){r&&r.c(),e=B(),n=P("span"),s=Le(t),a=B(),D(n,"class",l=o[8]?"text-blue-600 font-medium":"")},m(c,u){r&&r.m(c,u),v(c,e,u),v(c,n,u),q(n,s),v(c,a,u),i=!0},p(c,u){c[8]?r?u&256&&m(r,1):(r=be(),r.c(),m(r,1),r.m(e.parentNode,e)):r&&(x(),b(r,1,1,()=>{r=null}),H()),(!i||u&2)&&t!==(t=c[0].name+"")&&Ie(s,t),(!i||u&256&&l!==(l=c[8]?"text-blue-600 font-medium":""))&&D(n,"class",l)},i(c){i||(m(r),i=!0)},o(c){b(r),i=!1},d(c){c&&(k(e),k(n),k(a)),r&&r.d(c)}}}function he(o){let e,n;return e=new mt({props:{class:`
					relative
					w-full
					h-full
					pl-10
					py-1
					pr-3
					flex
					items-center
					whitespace-nowrap
					hover:bg-gray-800/10
					dark:hover:bg-gray-200/10
					aria-selected:bg-blue-600/10
					aria-selected:dark:bg-blue-400/10
					focus:bg-gray-800/10
					focus:dark:bg-gray-200/10
					focus-within:outline-0
					cursor-default
				`,value:o[0],$$slots:{default:[kt,({selected:t})=>({8:t}),({selected:t})=>t?256:0]},$$scope:{ctx:o}}}),{c(){S(e.$$.fragment)},m(t,s){L(e,t,s),n=!0},p(t,s){const l={};s&2&&(l.value=t[0]),s&770&&(l.$$scope={dirty:s,ctx:t}),e.$set(l)},i(t){n||(m(e.$$.fragment,t),n=!0)},o(t){b(e.$$.fragment,t),n=!1},d(t){I(e,t)}}}function wt(o){let e,n,t=pe(o[1]),s=[];for(let a=0;a<t.length;a+=1)s[a]=he(me(o,t,a));const l=a=>b(s[a],1,1,()=>{s[a]=null});return{c(){for(let a=0;a<s.length;a+=1)s[a].c();e=Z()},m(a,i){for(let r=0;r<s.length;r+=1)s[r]&&s[r].m(a,i);v(a,e,i),n=!0},p(a,i){if(i&258){t=pe(a[1]);let r;for(r=0;r<t.length;r+=1){const c=me(a,t,r);s[r]?(s[r].p(c,i),m(s[r],1)):(s[r]=he(c),s[r].c(),m(s[r],1),s[r].m(e.parentNode,e))}for(x(),r=t.length;r<s.length;r+=1)l(r);H()}},i(a){if(!n){for(let i=0;i<t.length;i+=1)m(s[i]);n=!0}},o(a){s=s.filter(Boolean);for(let i=0;i<s.length;i+=1)b(s[i]);n=!1},d(a){a&&k(e),Ue(s,a)}}}function Tt(o){let e,n,t,s;return e=new rt({props:{as:"div",$$slots:{default:[vt]},$$scope:{ctx:o}}}),t=new ft({props:{class:`
			absolute
			w-max
			left-0
			py-1
			mt-1
			max-h-72
			overflow-auto
			text-sm
			select-none
			bg-white
			dark:bg-gray-900
			border
			border-gray-100
			dark:border-gray-800
			rounded-xl
			shadow-lg
			z-10
			scrollbar
		`,$$slots:{default:[wt]},$$scope:{ctx:o}}}),{c(){S(e.$$.fragment),n=B(),S(t.$$.fragment)},m(l,a){L(e,l,a),v(l,n,a),L(t,l,a),s=!0},p(l,a){const i={};a&513&&(i.$$scope={dirty:a,ctx:l}),e.$set(i);const r={};a&514&&(r.$$scope={dirty:a,ctx:l}),t.$set(r)},i(l){s||(m(e.$$.fragment,l),m(t.$$.fragment,l),s=!0)},o(l){b(e.$$.fragment,l),b(t.$$.fragment,l),s=!1},d(l){l&&k(n),I(e,l),I(t,l)}}}function yt(o){let e,n,t;function s(a){o[4](a)}let l={class:"relative",$$slots:{default:[Tt]},$$scope:{ctx:o}};return o[0]!==void 0&&(l.value=o[0]),e=new lt({props:l}),ie.push(()=>qe(e,"value",s)),e.$on("change",o[5]),{c(){S(e.$$.fragment)},m(a,i){L(e,a,i),t=!0},p(a,[i]){const r={};i&515&&(r.$$scope={dirty:i,ctx:a}),!n&&i&1&&(n=!0,r.value=a[0],Me(()=>n=!1)),e.$set(r)},i(a){t||(m(e.$$.fragment,a),t=!0)},o(a){b(e.$$.fragment,a),t=!1},d(a){I(e,a)}}}function St(o,e,n){let t;X(o,F,c=>n(3,t=c));let{voices:s}=e,{voice:l}=e,{lang:a}=e;function i(c){l=c,n(0,l)}const r=()=>{T(F,t.ttsVoiceByLang[a]=l.name,t)};return o.$$set=c=>{"voices"in c&&n(1,s=c.voices),"voice"in c&&n(0,l=c.voice),"lang"in c&&n(2,a=c.lang)},[l,s,a,t,i,r]}class Lt extends K{constructor(e){super(),W(this,e,St,yt,V,{voices:1,voice:0,lang:2})}}class It{#e=window.speechSynthesis;#t=null;status=$({waiting:!1,speaking:!1,error:!1});stop(){this.#e.cancel()}#n(){const{audioContextSource:e}=M(y);e&&e.stop(),this.#e.speaking&&this.stop()}speak({text:e="sample text-to-speech text",voice:n=null}){this.status.update(t=>({...t,waiting:!0})),this.#n(),this.#t=new SpeechSynthesisUtterance(e),this.#t.voice=n,this.#t.onstart=()=>{this.status.update(t=>({...t,waiting:!1,speaking:!0}))},this.#t.onend=()=>{this.status.update(t=>({...t,speaking:!1}))},this.#t.onerror=({error:t})=>{["canceled","interrupted"].includes(t)||console.error(`An error has occurred with the speech synthesis: ${t}`),this.status.update(s=>({...s,waiting:!1,speaking:!1}))},this.#e.speak(this.#t)}}class Ot{#e=null;status=$({waiting:!1,speaking:!1,error:!1});async#t({lang:e,text:n}){try{const t={lang:e,text:n};return await chrome.runtime.sendMessage({type:"getTranslateTTS",content:t})}catch(t){throw console.error("Error occurred while fetching translation: ",t),t}}async#n(e){this.status.update(l=>({...l,waiting:!1,speaking:!0}));const n=new Uint8Array(e).buffer,t=new AudioContext,s=await t.decodeAudioData(n);this.#e=t.createBufferSource(),this.#e.buffer=s,this.#e.connect(t.destination),this.#e.start(),this.#e.onended=()=>{this.status.update(l=>({...l,speaking:!1}))},y.update(l=>({...l,audioContextSource:this.#e}))}stop(){this.#e&&this.#e.stop()}#s(){const{audioContextSource:e}=M(y);window.speechSynthesis.speaking&&window.speechSynthesis.cancel(),e&&e.stop()}async speak({text:e="",lang:n="en"}){this.status.update(a=>({...a,waiting:!0})),this.#s();const{cacheTTS:t}=M(y),s=t.find(a=>a.lang===n&&a.text===e);if(s){this.#n(s.data);return}const l=await this.#t({lang:n,text:e});l.status?(this.#n(l.data),y.update(a=>({...a,cacheTTS:[...a.cacheTTS,{lang:n,text:e,data:l.data}]}))):this.status.update(a=>({...a,waiting:!1,error:!0}))}}const Ht=async()=>new Promise(o=>{let e=speechSynthesis.getVoices();if(e.length>0)o(e);else{const n=setInterval(()=>{e=speechSynthesis.getVoices(),e.length>0&&(clearInterval(n),o(e))},100);setTimeout(()=>{e.length===0&&(clearInterval(n),o([]))},1e3)}}),Ft=(o,e)=>e?e.filter(n=>n.lang.startsWith(o)):[],Rt=(o,e)=>{const n=new It,t=new Ot;return e.find(l=>l.lang.startsWith(o))?n:t};function At(o){let e,n;return e=new j({props:{d:We}}),{c(){S(e.$$.fragment)},m(t,s){L(e,t,s),n=!0},i(t){n||(m(e.$$.fragment,t),n=!0)},o(t){b(e.$$.fragment,t),n=!1},d(t){I(e,t)}}}function Pt(o){let e,n;return e=new j({props:{d:Xe}}),{c(){S(e.$$.fragment)},m(t,s){L(e,t,s),n=!0},i(t){n||(m(e.$$.fragment,t),n=!0)},o(t){b(e.$$.fragment,t),n=!1},d(t){I(e,t)}}}function Et(o){let e;return{c(){e=P("div"),D(e,"class","animate-spin w-5 h-5 rounded-full border-[2px] border-gray-200 border-r-blue-600 dark:border-gray-600 dark:border-r-blue-600 ")},m(n,t){v(n,e,t)},i:Y,o:Y,d(n){n&&k(e)}}}function Dt(o){let e,n;return e=new j({props:{d:Ze}}),{c(){S(e.$$.fragment)},m(t,s){L(e,t,s),n=!0},i(t){n||(m(e.$$.fragment,t),n=!0)},o(t){b(e.$$.fragment,t),n=!1},d(t){I(e,t)}}}function Bt(o){let e,n,t,s;const l=[Dt,Et,Pt,At],a=[];function i(r,c){return r[4]?.error?0:r[4]?.waiting?1:r[4]?.speaking?2:3}return e=i(o),n=a[e]=l[e](o),{c(){n.c(),t=Z()},m(r,c){a[e].m(r,c),v(r,t,c),s=!0},p(r,c){let u=e;e=i(r),e!==u&&(x(),b(a[u],1,1,()=>{a[u]=null}),H(),n=a[e],n||(n=a[e]=l[e](r),n.c()),m(n,1),n.m(t.parentNode,t))},i(r){s||(m(n),s=!0)},o(r){b(n),s=!1},d(r){r&&k(t),a[e].d(r)}}}function ve(o){let e,n;return e=new Lt({props:{lang:o[1],voice:o[6],voices:o[2]}}),{c(){S(e.$$.fragment)},m(t,s){L(e,t,s),n=!0},p(t,s){const l={};s&2&&(l.lang=t[1]),s&64&&(l.voice=t[6]),s&4&&(l.voices=t[2]),e.$set(l)},i(t){n||(m(e.$$.fragment,t),n=!0)},o(t){b(e.$$.fragment,t),n=!1},d(t){I(e,t)}}}function Ct(o){let e,n,t,s;e=new Oe({props:{disabled:o[4]?.error||!o[0],round:!0,tooltip:{title:o[7]},$$slots:{default:[Bt]},$$scope:{ctx:o}}}),e.$on("click",o[8]);let l=o[2].length&&o[3]&&ve(o);return{c(){S(e.$$.fragment),n=B(),l&&l.c(),t=Z()},m(a,i){L(e,a,i),v(a,n,i),l&&l.m(a,i),v(a,t,i),s=!0},p(a,[i]){const r={};i&17&&(r.disabled=a[4]?.error||!a[0]),i&128&&(r.tooltip={title:a[7]}),i&8208&&(r.$$scope={dirty:i,ctx:a}),e.$set(r),a[2].length&&a[3]?l?(l.p(a,i),i&12&&m(l,1)):(l=ve(a),l.c(),m(l,1),l.m(t.parentNode,t)):l&&(x(),b(l,1,1,()=>{l=null}),H())},i(a){s||(m(e.$$.fragment,a),m(l),s=!0)},o(a){b(e.$$.fragment,a),b(l),s=!1},d(a){a&&(k(n),k(t)),I(e,a),l&&l.d(a)}}}function Nt(o,e,n){let t,s,l,a,i=Y,r=()=>(i(),i=He(O,h=>n(4,a=h)),O);X(o,F,h=>n(10,l=h)),o.$$.on_destroy.push(()=>i());let{text:c}=e,{lang:u}=e,{voices:d}=e,{selectLang:f=!0}=e,g,O;const w=()=>{g.speak({text:c,lang:u,voice:s})},_=()=>{g&&g.stop()},p=()=>{a.waiting||(a.speaking?_():w())};return Se(_),o.$$set=h=>{"text"in h&&n(0,c=h.text),"lang"in h&&n(1,u=h.lang),"voices"in h&&n(2,d=h.voices),"selectLang"in h&&n(3,f=h.selectLang)},o.$$.update=()=>{o.$$.dirty&16&&n(7,t=a?.error?ne("tooltip_listen_language_is_not_support"):a?.speaking?ne("tooltip_listen_stop"):ne("tooltip_listen_to_the_text")),o.$$.dirty&1030&&n(6,s=l.ttsVoiceByLang&&l.ttsVoiceByLang[u]?d.find(h=>h.name===l.ttsVoiceByLang[u]):d[0]),o.$$.dirty&518&&u&&(n(9,g=Rt(u,d)),r(n(5,O=g.status)))},[c,u,d,f,a,O,s,t,p,g,l]}class Kt extends K{constructor(e){super(),W(this,e,Nt,Ct,V,{text:0,lang:1,voices:2,selectLang:3})}}function ke(o){let e,n,t;return n=new j({props:{d:o[3]}}),{c(){e=P("span"),S(n.$$.fragment),D(e,"class","mr-2")},m(s,l){v(s,e,l),L(n,e,null),t=!0},p(s,l){const a={};l&8&&(a.d=s[3]),n.$set(a)},i(s){t||(m(n.$$.fragment,s),t=!0)},o(s){b(n.$$.fragment,s),t=!1},d(s){s&&k(e),I(n)}}}function we(o){let e;return{c(){e=P("span"),D(e,"class","mr-2")},m(n,t){v(n,e,t),e.innerHTML=o[5]},p(n,t){t&32&&(e.innerHTML=n[5])},d(n){n&&k(e)}}}function Te(o){let e,n,t;return n=new j({props:{d:o[3]}}),{c(){e=P("span"),S(n.$$.fragment),D(e,"class","ml-2")},m(s,l){v(s,e,l),L(n,e,null),t=!0},p(s,l){const a={};l&8&&(a.d=s[3]),n.$set(a)},i(s){t||(m(n.$$.fragment,s),t=!0)},o(s){b(n.$$.fragment,s),t=!1},d(s){s&&k(e),I(n)}}}function Vt(o){let e,n,t,s,l,a,i,r,c,u,d,f=o[3]&&ke(o),g=o[5]&&we(o);const O=o[8].default,w=G(O,o,o[7],null);let _=o[4]&&Te(o);return{c(){e=P("button"),f&&f.c(),n=B(),g&&g.c(),t=B(),s=P("span"),l=Le(o[0]),a=B(),w&&w.c(),i=B(),_&&_.c(),D(e,"class",r="px-3 py-1 inline-flex items-center justify-start whitespace-nowrap rounded-full select-none "+(o[2]?"text-sm":"text-base")+" text-gray-900 dark:text-gray-200 "+(o[1]?"bg-sky-200 dark:bg-sky-900":"hover:bg-gray-800/10 dark:hover:bg-gray-200/10")+" focus-visible:outline focus-visible:outline-2 focus-visible:outline-gray-800/20 focus-visible:dark:outline-gray-200/20 transition-colors "+o[6]),D(e,"type","button")},m(p,h){v(p,e,h),f&&f.m(e,null),q(e,n),g&&g.m(e,null),q(e,t),q(e,s),q(s,l),q(e,a),w&&w.m(e,null),q(e,i),_&&_.m(e,null),c=!0,u||(d=U(e,"click",o[9]),u=!0)},p(p,[h]){p[3]?f?(f.p(p,h),h&8&&m(f,1)):(f=ke(p),f.c(),m(f,1),f.m(e,n)):f&&(x(),b(f,1,1,()=>{f=null}),H()),p[5]?g?g.p(p,h):(g=we(p),g.c(),g.m(e,t)):g&&(g.d(1),g=null),(!c||h&1)&&Ie(l,p[0]),w&&w.p&&(!c||h&128)&&z(w,O,p,p[7],c?Q(O,p[7],h,null):J(p[7]),null),p[4]?_?(_.p(p,h),h&16&&m(_,1)):(_=Te(p),_.c(),m(_,1),_.m(e,null)):_&&(x(),b(_,1,1,()=>{_=null}),H()),(!c||h&70&&r!==(r="px-3 py-1 inline-flex items-center justify-start whitespace-nowrap rounded-full select-none "+(p[2]?"text-sm":"text-base")+" text-gray-900 dark:text-gray-200 "+(p[1]?"bg-sky-200 dark:bg-sky-900":"hover:bg-gray-800/10 dark:hover:bg-gray-200/10")+" focus-visible:outline focus-visible:outline-2 focus-visible:outline-gray-800/20 focus-visible:dark:outline-gray-200/20 transition-colors "+p[6]))&&D(e,"class",r)},i(p){c||(m(f),m(w,p),m(_),c=!0)},o(p){b(f),b(w,p),b(_),c=!1},d(p){p&&k(e),f&&f.d(),g&&g.d(),w&&w.d(p),_&&_.d(),u=!1,d()}}}function qt(o,e,n){let{$$slots:t={},$$scope:s}=e,{label:l=""}=e,{active:a=!1}=e,{small:i=!1}=e,{icon:r=""}=e,{iconRight:c=""}=e,{iconRaw:u=""}=e,{class:d=""}=e;function f(g){Fe.call(this,o,g)}return o.$$set=g=>{"label"in g&&n(0,l=g.label),"active"in g&&n(1,a=g.active),"small"in g&&n(2,i=g.small),"icon"in g&&n(3,r=g.icon),"iconRight"in g&&n(4,c=g.iconRight),"iconRaw"in g&&n(5,u=g.iconRaw),"class"in g&&n(6,d=g.class),"$$scope"in g&&n(7,s=g.$$scope)},[l,a,i,r,c,u,d,s,t,f]}class Wt extends K{constructor(e){super(),W(this,e,qt,Vt,V,{label:0,active:1,small:2,icon:3,iconRight:4,iconRaw:5,class:6})}}export{Wt as B,E as F,R as K,lt as L,Kt as T,rt as a,ft as b,et as c,mt as d,Ht as e,Ft as f,Pe as g,$e as h,bt as i,Re as r,y as s};
