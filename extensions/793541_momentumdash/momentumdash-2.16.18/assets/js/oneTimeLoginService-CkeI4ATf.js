import{i as e}from"./icon-alert-mvI7iJMO.js";import{a as o}from"./authService-BcSP4pRZ.js";const t=new class{constructor(){this.oneTimeLoginInProgress=!1}startOneTimeLogin(){this.oneTimeLoginInProgress=!0;const e=Date.now(),o=Number(localStorage.getItem("oneTimeLoginStarted")??0);if(o&&o>e-1e4)throw new Error("Another login is currently being processed.");localStorage.setItem("oneTimeLoginStarted",String(e))}finalizeOneTimeLogin(){this.oneTimeLoginInProgress=!1}async loginWithOneTimeLoginResponse(e){try{await o.onSuccessfulAuthResponse(e,{keepPreviousUserData:!!e.legacy,migrateLegacy:!!e.legacy})}catch(t){throw await chrome.runtime.sendMessage({type:"oneTimeLogin:response",payload:{success:!1,errorMessage:t}}),t}finally{localStorage.removeItem("oneTimeLoginStarted")}}async redeemOnetimePassword(o){const{otp:t,otpUuid:n,email:i,...a}=o,r={type:"oneTimeLogin",payload:{otp:t,otpUuid:n,email:i},openNewTab:!0,updateSenderTab:!1};return{...(await e.post("user/authenticate",r)).data,...a,email:i}}};export{t as o};