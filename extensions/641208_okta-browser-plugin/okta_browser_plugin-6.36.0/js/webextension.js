Okta.WebExtension=function(i,e,t){var a=PLUGIN_VERSIONS.currentVersion;var r=Okta._okta;var n=r.compose;var o=r.delay;var s=r.extend;var d=r.isString;var u=Okta.Q;var g=Okta.Constants.StorageOktaAccountAllowListKey;var c=Okta.fn.action.updateBadge;var l=Okta.fn.action.getUserPinned;var f=Okta.fn.action.openPopup;var v=Okta.Events;var p=s({},v);var m=Okta.fn.base.curry2;var k=Okta.fn.base.always;var O=Okta.fn.url.getMonitoredSitesApiMatchPatterns;var b=n(Okta.fn.url.isOktaPluginHomePagePath,Okta.fn.url.hrefToUrlParts);var P=75;var w=Okta.fn.script;var h=Okta.fn.cookies.getCookies;var T=Okta.fn.browserType;var I=T.isSafari(t);var L=T.isSafariWebExt(t);var S=T.isFirefox(t);var C=T.isChrome(t);var M=new Okta.AuthenticationMonitor(i,e);var A=new Okta.Logging(i,e);var y=chrome.tabs.sendMessage;var U=Okta.Constants.ModalEvents;var F=new Okta.SuppressPwdSave;var N=new Okta.MyPagesMenu(i);var B=new Okta.Onboarding(t);var E=new Okta.Tabs(t);var R=new Okta.API(i,e);var x=new Okta.BasicAuth(i,e);var D=Okta.EventTracker(i,{getBrowserType:()=>Promise.resolve(t),getBackgroundVersion:()=>Promise.resolve(a)},R);var W=new Okta.RequestHeaders(a,t,i,R,D);var z=new Okta.RuntimeMessage;var _=m(ee);var q=chrome.runtime.onConnect;var G=chrome.runtime.onInstalled;var V=chrome.webRequest.onCompleted;var j=chrome.tabs.onCreated;var H=chrome.tabs.onUpdated;var K=chrome.tabs.onRemoved;var Q={};var J=C?new Okta.OinSubmissionTester:undefined;var X=Okta.CryptoManager(self);var Y=1e3;function Z(e){return/^http/.test(e)}function $(e){var t=e.tabId;var a=e.frameId;if(a==0){F.deleteSuppressTab(t,true)}if(!Z(e.url)){console.log("Skipped url: "+e.url);return}return E.getTab(t).then(function e(t){if(!t||!Z(t.url)){return}w.injectPreloadScript(t.id,a)})}function ee(e,t){p.trigger("messageFromContent",{msg:t,tabId:e.sender&&e.sender.tab?e.sender.tab.id:-1,frameId:e.sender?e.sender.frameId:0,portInfo:{port:e}})}function te(){o(function(){M.initialize()},Y)}function ae(){if(S){return window&&window.navigator&&window.navigator.userAgent&&parseInt(window.navigator.userAgent.toLowerCase().split("firefox/").pop())>=P}return!I&&!L}function re(e,t){var a="Okta.WebExtension::frameModuleMessageHandler: ";e.data=e.data||{};switch(e.action){case U.ACTIONS.PROMPT_AUTOFILL:{if(t.frameId>0){Log.info(a+"send promptAutoFill message to top doc");e.data.frameId=t.frameId;y(t.tab.id,e,{frameId:0})}else{Log.warn(a+"do not send promptAutoFill message when sender is not iframe")}break}case U.ACTIONS.AUTOFILL:{var r=e.data.frameId;if(r>0){Log.info(a+"send autoFill message to target iframe");y(t.tab.id,e,{frameId:r})}else{Log.warn(a+"missing target frameId, do not send autoFill message")}break}default:Log.warn(a+"unknown action");break}}p.getType=k(t);p.getBackgroundVersion=k(a);p.post=function e(t){if(!t.portInfo.port.isDisconnected){t.portInfo.port.postMessage(t.msg)}};p.injectContentScript=w.injectContentScript;p.openTab=E.openTab;p.sendMsgToCurrentTab=E.sendMsgToCurrentTab;p.openTabForAccountChooser=E.openTabForAccountChooser;p.openPermissionsPage=E.openPermissionsPage;p.openOktaNewtab=E.openOktaNewtab;p.servePopover=E.servePopover;p.closeTab=E.closeTab;p.highlightAndRefreshTab=E.highlightAndRefreshTab;p.openSettingsPage=E.openSettingsPage;p.getTabInfo=E.getTabInfo;p.getCookies=h;p.isInstalledByUser=B.isInstalledByUser;p.getOrgsWithSessionCookies=B.getOrgsWithSessionCookies;p.setUninstallURL=B.setUninstallURL;p.tryOktaPersonalPasswordlessPostInstall=B.tryOktaPersonalPasswordlessPostInstall;p.updateBadge=c;l&&(p.getUserPinned=l);f&&(p.openPopup=f);p.getLocalStorageUsage=i.getStorageUsage;if(L){chrome.webNavigation.onCompleted.addListener($)}else{chrome.webNavigation.onDOMContentLoaded.addListener($)}q.addListener(function e(t){t.onMessage.addListener(_(t));t.onDisconnect.addListener(function(){t.isDisconnected=true})});G&&G.addListener(function(e){var t=e&&e.reason;if(t!=="install"){return}p.trigger("postInstall")});V&&V.addListener(te,{urls:O(),types:["xmlhttprequest"]});j&&j.addListener(function(n){return u.all([i.getDBGPluginSettings(),i.getNewTab()]).spread(function(e,t){var a=e&&e.NTEFlag;var r=t&&t.enableNTE;if(C&&a&&r&&n.pendingUrl==="chrome://newtab/"){chrome.tabs.update({url:chrome.runtime.getURL("shared/newtab/Newtab.html")})}})});H&&H.addListener(function(e,t,a){if(!t||!t.url){return u()}if(a&&a.url&&b(a.url)){Q={};Q[e]=a.url;return u()}if(Q[e]){delete Q[e];return i.clearWaitingForTabs()}});K&&K.addListener(function(e){if(!Q[e]){return u()}delete Q[e];return i.clearWaitingForTabs()});if(!!ae()){p.suppressSavePassword=F.turnOffSavePasswordFeature;p.hasPrivacyPermissions=F.hasPrivacyPermissions;p.getPasswordSavingDetails=F.getPasswordSavingDetails;p.requestPrivacyPermissions=F.requestPrivacyPermissions}p.showMyPagesMenu=function(e){e?N.createMenu():N.destroyMenu()};i.readMultiAccount();chrome.storage.onChanged.addListener(function(e,t){if(t!=="local"){return}if(e["DBG_PLUGIN_SETTINGS"]||e[g]){return i.readMultiAccount()}});M.initialize(false);N.initializeMenu();F.initialize();x.initialize(t);W.initialize();z.init(U.IFRAME_MODULE,re);if(J){J.init(i,z,R,A)}p.getAccessTokenFromBackground=function(e,t){var a="Okta.WebExtension::getAccessTokenFromBackground: ";try{var r=e.sdkOptions;var n=e.options;var o=Okta.Auth(r,i,R,X,p);return o.token.getWithoutPromptFromBackground(n,W,t).fail(function(e){var t=d(e)?e:e.code||e.message||""+e;Log.info(a+"error: {0}",t);return{errorCode:t}})}catch(e){var s=""+e;Log.error(a+"exception: {0}",s);return{errorCode:s}}};return p};