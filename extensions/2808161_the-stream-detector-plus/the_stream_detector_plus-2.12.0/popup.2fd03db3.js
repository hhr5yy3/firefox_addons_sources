let e,t,a,r,o,n,l,i;function d(e,t,a,r){Object.defineProperty(e,t,{get:a,set:r,enumerable:!0,configurable:!0})}function m(e){return e&&e.__esModule?e.default:e}var s="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self?self:"undefined"!=typeof window?window:"undefined"!=typeof global?global:{},c={},u={},p=s.parcelRequire8014;null==p&&((p=function(e){if(e in c)return c[e].exports;if(e in u){var t=u[e];delete u[e];var a={id:e,exports:{}};return c[e]=a,t.call(a.exports,a,a.exports),a.exports}var r=Error("Cannot find module '"+e+"'");throw r.code="MODULE_NOT_FOUND",r}).register=function(e,t){u[e]=t},s.parcelRequire8014=p),p.register("h9keA",function(e,t){"use strict";d(e.exports,"register",()=>a,e=>a=e),d(e.exports,"resolve",()=>r,e=>r=e);var a,r,o={};a=function(e){for(var t=Object.keys(e),a=0;a<t.length;a++)o[t[a]]=e[t[a]]},r=function(e){var t=o[e];if(null==t)throw Error("Could not resolve bundle with id "+e);return t}}),p("h9keA").register(JSON.parse('{"7G7CI":"popup.2fd03db3.js","dJ8x0":"icon-dark-96.4236c605.png"}'));const g=async e=>new Promise(t=>chrome.storage.local.get(e,a=>{Object.prototype.hasOwnProperty.call(a,e)?t(a[e]):t(null)})),f=async e=>new Promise(t=>chrome.storage.local.set(e,()=>t())),h=async e=>new Promise(t=>chrome.storage.local.remove(e,()=>t())),y=async(e,t)=>{if("copyMethod"===e.target.id&&"url"!==e.target.value&&"tableForm"!==e.target.value&&"kodiUrl"!==e.target.value&&!e.target.value.startsWith("user")){let t="customCommand"+e.target.value;await g(t)&&(document.getElementById("customCommand").value=await g(t)||"")}if("regexCommand"===e.target.id)await f({[e.target.id]:e.target.value});else if("customCommand"===e.target.id)await f({[e.target.id+document.getElementById("copyMethod").value]:e.target.value?.trim()});else if("textarea"===e.target.tagName.toLowerCase())await f({[e.target.id]:e.target.value?.split("\n").filter(e=>e)});else if("checkbox"===e.target.type)await f({[e.target.id]:e.target.checked});else if("text"===e.target.type&&e.target.value?.trim().length===0)await h(e.target.id);else if("radio"===e.target.type&&t.length>0)for(let a of t)a.name===e.target.name&&await f({[a.id]:document.getElementById(a.id).checked});else await f({[e.target.id]:e.target.value?.trim()});chrome.runtime.sendMessage({options:!0})};var w={};w=new URL(p("h9keA").resolve("dJ8x0"),import.meta.url).toString(),chrome.browserAction=chrome.browserAction||chrome.action;const E=chrome.runtime.getURL("").startsWith("chrome-extension://"),b=chrome.i18n.getMessage,x=document.getElementById("popupUrlList");let C=[];const I=e=>{let t=new Date(e);return`${t.toLocaleDateString()} ${t.toLocaleTimeString()}`},v=e=>{let t=Math.floor(Math.log(e)/Math.log(1024));return parseFloat((e/1024**t).toFixed(2))+" "+["B","KB","MB","GB","TB"][t]},B=e=>{let t=chrome.runtime.getURL("").startsWith("chrome-extension://")?{url:e.url}:{headers:e.headers?.filter(e=>"referer"===e.name.toLowerCase())||[],incognito:e.tabData?.incognito||!1,url:e.url};chrome.downloads.download(t,t=>void 0===t&&chrome.notifications.create("error",{type:"basic",iconUrl:m(w),title:b("notifDownErrorTitle"),message:b("notifDownErrorText")+e.filename}))},k=async r=>{let n={urls:[],filenames:[],methodIncomp:!1};for(let o of r){let r,l,i,d;let m=o.url,{filename:s}=o;(i=await g("copyMethod")||"url").startsWith("user")&&await g("userCommand"+i.at(-1))===null&&(i="url",l=!0),"url"===i?r=m:"tableForm"===i?r=`${m} | ${e&&o.tabData?.title&&!m.includes(o.tabData.title)?o.tabData.title:o.hostname} | ${I(o.timeStamp)}`:"kodiUrl"===i?r=m:"ffmpeg"===i?r="ffmpeg":"streamlink"===i?r="streamlink":"mpv"===i?r="mpv":"ytdlp"===i?(r="yt-dlp --no-part --restrict-filenames",await g("multithreadPref")&&await g("multithreadAmount")&&(r+=` -N ${await g("multithreadAmount")}`),await g("downloaderPref")&&await g("downloaderCommand")&&(r+=` --downloader "${await g("downloaderCommand")}"`)):"hlsdl"===i?r="hlsdl -b -c":"nm3u8dl"===i?r=`N_m3u8DL-RE "${m}"`:i.startsWith("user")&&(r=await g("userCommand"+i.at(-1)));let c=`customCommand${i}`;if(await g("customCommandPref")&&await g(c)&&(r+=` ${await g(c)}`),await g("proxyPref")&&await g("proxyCommand")&&("ffmpeg"===i?r+=` -http_proxy "${await g("proxyCommand")}"`:"streamlink"===i?r+=` --http-proxy "${await g("proxyCommand")}"`:"ytdlp"===i?r+=` --proxy "${await g("proxyCommand")}"`:"hlsdl"===i?r+=` -p "${await g("proxyCommand")}"`:"nm3u8dl"===i?r+=` --custom-proxy "${await g("proxyCommand")}"`:i.startsWith("user")&&(r=r.replace(RegExp("%proxy%","g"),await g("proxyCommand")))),await g("headersPref")){let e=o.headers.find(e=>"user-agent"===e.name.toLowerCase());e=e?e.value:navigator.userAgent;let t=o.headers.find(e=>"cookie"===e.name.toLowerCase()||"set-cookie"===e.name.toLowerCase());t&&(t=t.value.replace(RegExp('"',"g"),"'"));let a=o.headers.find(e=>"referer"===e.name.toLowerCase());a=a?a.value:o.originUrl||o.documentUrl||o.initiator||o.tabData?.url,(a?.startsWith("about:")||a?.startsWith("chrome:"))&&(a=void 0),e?"kodiUrl"===i?r+=`|User-Agent=${encodeURIComponent(e)}`:"ffmpeg"===i?r+=` -user_agent "${e}"`:"streamlink"===i?r+=` --http-header "User-Agent=${e}"`:"ytdlp"===i?r+=` --user-agent "${e}"`:"hlsdl"===i?r+=` -u "${e}"`:"nm3u8dl"===i?r+=` --header "User-Agent: ${e}"`:i.startsWith("user")&&(r=r.replace(RegExp("%useragent%","g"),e)):i.startsWith("user")&&(r=r.replace(RegExp("%useragent%","g"),"")),t?"kodiUrl"===i?(e?r+="&":r+="|",r+=`Cookie=${encodeURIComponent(t)}`):"ffmpeg"===i?r+=` -headers "Cookie: ${t}"`:"streamlink"===i?r+=` --http-header "Cookie=${t}"`:"ytdlp"===i?r+=` --add-header "Cookie:${t}"`:"hlsdl"===i?r+=` -h "Cookie:${t}"`:"nm3u8dl"===i?r+=` --header "Cookie: ${t}"`:i.startsWith("user")&&(r=r.replace(RegExp("%cookie%","g"),t)):"ytdlp"===i?await g("noCookies")===!1&&(E?r+=" --cookies-from-browser chrome":r+=" --cookies-from-browser firefox"):i.startsWith("user")&&(r=r.replace(RegExp("%cookie%","g"),"")),a?"kodiUrl"===i?(e||t?r+="&":r+="|",r+=`Referer=${encodeURIComponent(a)}`):"ffmpeg"===i?r+=` -referer "${a}"`:"streamlink"===i?r+=` --http-header "Referer=${a}"`:"ytdlp"===i?r+=` --referer "${a}"`:"hlsdl"===i?r+=` -h "Referer:${a}"`:"mpv"===i?r+=` --referrer="${a}"`:"nm3u8dl"===i?r+=` --header "Referer: ${a}"`:i.startsWith("user")&&(r=r.replace(RegExp("%referer%","g"),a)):i.startsWith("user")&&(r=r.replace(RegExp("%referer%","g"),""))}i.startsWith("user")&&(o.documentUrl||o.originUrl||o.initiator||o.tabData?.url)?r=r.replace(RegExp("%origin%","g"),o.documentUrl||o.originUrl||o.initiator||o.tabData?.url):i.startsWith("user")&&(r=r.replace(RegExp("%origin%","g"),"")),i.startsWith("user")&&o.tabData?.title?r=r.replace(RegExp("%tabtitle%","g"),o.tabData.title.replace(/[/\\?%*:|"<>]/g,"_")):i.startsWith("user")&&(r=r.replace(RegExp("%tabtitle%","g"),"")),t&&o.tabData?.title?d=o.tabData.title:-1!==(d=s).indexOf(".")&&((d=d.split(".")).pop(),d=d.join(".")),d=d.replace(/[/\\?%*:|"<>]/g,"_");let u=await g("fileExtension")||"ts",p=I(o.timeStamp).replace(/[/\\?%*:|"<>]/g,"_");if((await g("webTitlesBrandingRM")).forEach(e=>{d=d.replace(e,"")}),d=d.trim(),"ffmpeg"===i?(r+=` -i "${m}" -c copy "${d}`,a&&(r+=` ${p}`),r+=`.${u}"`):"mpv"===i?r+=` "${m}"`:"streamlink"===i?(await g("streamlinkOutput")==="file"&&(r+=` -o "${d}`,a&&(r+=` ${p}`),r+=`.${u}"`),r+=` "${m}" best`):"ytdlp"===i?((t&&o.tabData?.title||a)&&(r+=` --output "${d}`,a&&(r+=" %(epoch)s"),r+='.%(ext)s"'),r+=` "${m}"`):"hlsdl"===i?(r+=` -o "${d}`,a&&(r+=` ${p}`),r+=`.${u}" "${m}"`):"nm3u8dl"===i?(r+=` --save-name "${d}`,a&&(r+=` ${p}`),r+='"'):i.startsWith("user")&&(r=(r=(r=r.replace(RegExp("%url%","g"),m)).replace(RegExp("%filename%","g"),s)).replace(RegExp("%timestamp%","g"),p)),i.startsWith("user")&&await g("regexCommandPref")){let e=await g("regexCommand"),t=await g("regexReplace");r=r.replace(RegExp(e,"g"),t||"")}n.urls.push(r),n.filenames.push(s),n.methodIncomp=l}try{if(navigator.clipboard?.writeText)navigator.clipboard.writeText(n.urls.join(o));else{let e=document.createElement("textarea");e.style.position="absolute",e.style.left="-5454px",e.style.top="-5454px",document.body.appendChild(e),e.value=n.urls.join(o),e.select(),document.execCommand("copy"),document.body.removeChild(e)}await g("notifPref")===!1&&chrome.notifications.create("copy",{type:"basic",iconUrl:m(w),title:b("notifCopiedTitle"),message:(n.methodIncomp?b("notifIncompCopiedText"):b("notifCopiedText"))+n.filenames.join(o)})}catch(e){chrome.notifications.create("error",{type:"basic",iconUrl:m(w),title:b("notifErrorTitle"),message:b("notifErrorText")+e})}},$=e=>{r&&("files"===e.category||"custom"===e.category)?B(e):k([e])},D=e=>{chrome.runtime.sendMessage({delete:[e],previous:document.getElementById("tabPrevious").checked})},R=()=>Array.from(document.getElementById("popupUrlList").getElementsByTagName("tr")).map(e=>e.id),U=()=>{let e=R(),t=C.filter(t=>e.includes(t.requestId));k(t)},L=()=>{let e=R(),t=C.filter(t=>e.includes(t.requestId));chrome.runtime.sendMessage({delete:t,previous:document.getElementById("tabPrevious").checked})},P=async()=>{let t=t=>{for(let a of(document.getElementById("copyAll").disabled=!1,document.getElementById("clearList").disabled=!1,document.getElementById("filterInput").disabled=!1,document.getElementById("headers").style.display="",t)){let t=document.createElement("tr");if(t.id=a.requestId,t.className="urlEntry","popup"===document.body.id){let e=document.createElement("td");e.textContent=("files"===a.category||"custom"===a.category)&&r?"\uD83D\uDD3D "+a.type.toUpperCase():a.type.toUpperCase(),t.appendChild(e)}let o=document.createElement("td");o.className="urlCell";let n=document.createElement("a");if(n.textContent=a.filename,n.href=a.url,o.onclick=e=>{e.preventDefault(),$(a)},n.onclick=e=>{e.preventDefault(),e.stopPropagation(),$(a)},n.title=a.url,o.appendChild(n),t.appendChild(o),"popup"===document.body.id){let r=document.createElement("td"),o=a.headers.find(e=>"content-length"===e.name.toLowerCase());("files"===a.category||"custom"===a.category)&&o&&0!==Number(o.value)?(r.textContent=v(o.value),r.title=o.value):r.textContent="-",t.appendChild(r);let n=document.createElement("td");n.textContent=e&&a.tabData?.title&&!a.url.includes(a.tabData.title)?a.tabData.title:a.hostname,n.title=a.documentUrl||a.originUrl||a.initiator||a.tabData.url,t.appendChild(n);let l=document.createElement("td");l.textContent=I(a.timeStamp),t.appendChild(l)}let l=document.createElement("td"),i=document.createElement("a");i.textContent="✖",i.href="",i.style.textDecoration="none",i.onclick=e=>{e.preventDefault(),e.stopPropagation(),D(a)},l.onclick=e=>{e.preventDefault(),D(a)},i.onfocus=()=>o.style.textDecoration="line-through",i.onblur=()=>o.style.textDecoration="initial",l.onmouseover=()=>o.style.textDecoration="line-through",l.onmouseout=()=>o.style.textDecoration="initial",l.style.cursor="pointer",l.title=b("deleteTooltip"),l.appendChild(i),t.appendChild(l),x.appendChild(t)}},a=()=>{document.getElementById("copyAll").disabled=!0,document.getElementById("clearList").disabled=!0,document.getElementById("filterInput").value||(document.getElementById("filterInput").disabled=!0),document.getElementById("headers").style.display="none";let e=document.createElement("tr"),t=document.createElement("td");t.colSpan=document.getElementsByTagName("th").length,t.textContent=b("placeholderCell"),e.appendChild(t),x.appendChild(e)},o=await g("urlStorage"),i=await g("urlStorageRestore");if(o.length||i.length){let e=document.getElementById("filterInput").value.toLowerCase();chrome.tabs.query({active:!0,currentWindow:!0},r=>{document.getElementById("tabThis").checked?C=o?o.filter(e=>e.tabId===r[0].id):[]:document.getElementById("tabAll").checked?C=o?o.filter(e=>e.tabData?.incognito===r[0].incognito):[]:document.getElementById("tabPrevious").checked&&(C=i||[]),C=C.length&&C.reverse(),e&&(C=C.length&&C.filter(t=>t.filename.toLowerCase().includes(e)||t.tabData?.title?.toLowerCase().includes(e)||t.type.toLowerCase().includes(e)||t.hostname.toLowerCase().includes(e))),n&&C.length>l&&(C.length=l),x.innerHTML="",C.length?t(C):a()})}else x.innerHTML="",a()},T=e=>{"radio"===e.target.type&&P(),y(e,document.getElementsByClassName("option"))},A=async()=>{e=await g("titlePref"),t=await g("filenamePref"),a=await g("timestampPref"),r=await g("downloadDirectPref"),o=await g("newline"),n=await g("recentPref"),l=await g("recentAmount"),i=await g("noRestorePref");let d=document.getElementsByClassName("option");for(let e of d)e.onchange=e=>T(e),await g(e.id)!==null&&("checkbox"===document.getElementById(e.id).type||"radio"===document.getElementById(e.id).type?document.getElementById(e.id).checked=await g(e.id):document.getElementById(e.id).value=await g(e.id))};document.addEventListener("DOMContentLoaded",async()=>{"popup"===document.body.id&&(chrome.browserAction.setBadgeBackgroundColor({color:"silver"}),chrome.browserAction.setBadgeText({text:""}),chrome.runtime.connect({name:"popup"})),await A();let e=document.getElementsByTagName("label");for(let t of e)t.textContent=b(t.htmlFor);let t=document.getElementsByTagName("option");for(let e of t)e.textContent||(e.textContent=b(e.value));document.getElementById("copyAll").onclick=e=>{e.preventDefault(),U()},document.getElementById("clearList").onclick=e=>{e.preventDefault(),L()},document.getElementById("openOptions").onclick=e=>{e.preventDefault(),chrome.runtime.openOptionsPage()},document.getElementById("filterInput").onkeyup=()=>{P(),document.getElementById("filterInput").value?(document.getElementById("clearFilterInput").disabled=!1,document.getElementById("clearFilterInput").style.cursor="pointer"):(document.getElementById("clearFilterInput").disabled=!0,document.getElementById("clearFilterInput").style.cursor="default")},document.getElementById("filterInput").value?(document.getElementById("clearFilterInput").disabled=!1,document.getElementById("clearFilterInput").style.cursor="pointer"):(document.getElementById("clearFilterInput").disabled=!0,document.getElementById("clearFilterInput").style.cursor="default"),document.getElementById("clearFilterInput").onclick=()=>{document.getElementById("filterInput").value="",f({filterInput:""}),P(),document.getElementById("clearFilterInput").style.cursor="default"},i&&(document.getElementById("tabPrevious").checked&&(document.getElementById("tabAll").checked=!0),document.getElementById("tabPrevious").parentElement.style.display="none"),P(),chrome.runtime.onMessage.addListener(e=>{e.urlStorage&&P(),"sidebar"===document.body.id&&e.options&&A()})});