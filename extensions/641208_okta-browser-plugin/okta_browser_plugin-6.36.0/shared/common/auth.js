Okta.Auth=function(c,d,s,h,f){var e=Okta._okta;const i=e.extend,t=e.clone,l=e.find,o=Okta.fn.authUtil.getDefaultOAuthParams,a=Okta.fn.authUtil.toQueryParams,u=Okta.fn.authUtil.getOAuthUrls,k=Okta.fn.authUtil.convertOAuthParamsToQueryParams,g=Okta.fn.authUtil.validateAuthorizationCodeResponse,m=Okta.fn.authUtil.validateOptions,p=Okta.fn.authUtil.decodeToken,E=Okta.fn.authUtil.createTokenStorageDict,v=Okta.Q;e=Okta.Constants.AuthOptions.PKCE;const w=e.DEFAULT_CODE_CHALLENGE_METHOD,O=e.MIN_VERIFIER_LENGTH,_=e.MAX_VERIFIER_LENGTH,n={};function U(e,n){e=t(e)||{};const r=o(c);return i(r,e),r.codeChallengeMethod||(r.codeChallengeMethod=w),r.responseType="code",e=c.oktaDomain,s.getOktaUnauthenticatedRequest(e+"/.well-known/openid-configuration").then(function(e){const t=e.code_challenge_methods_supported||[];if(-1===t.indexOf(r.codeChallengeMethod))throw new Error("Invalid code_challenge_method");r.openIdConfig=e}).then(function(){const e=function(e){let t=e||"";return t.length<O&&(t+=h.generateRandomString(O-t.length)),encodeURIComponent(t).slice(0,_)}(r.codeVerifier);var t={codeVerifier:e,redirectUri:r.redirectUri};return d.setPKCEMeta(t,n).then(function(){return h.computeChallenge(e)})}).then(function(e){return i({},r,{codeChallenge:e})})}function C(e,t){const n=v.defer();function r(e){if(e.data&&e.data.state===t)return e.origin!==c.url?n.reject(new Error("The request does not match client configuration")):void n.resolve(e.data)}var o,i,a;return o=window,i="message",a=r,o.addEventListener?o.addEventListener(i,a):o.attachEvent("on"+i,a),n.promise.timeout(e||12e4,new Error("OAuth flow timed out")).fin(function(){var e,t,n;e=window,t="message",n=r,e.removeEventListener?e.removeEventListener(t,n):e.detachEvent("on"+t,n)})}function y(a,o,u,i){return u=u||{},v().then(function(){if(g(o,a),o.code)return t=a,n=o.code,r=u,e=i,d.getPKCEMeta(e).then(function(e){e={clientId:t.clientId,authorizationCode:n,codeVerifier:e.codeVerifier,redirectUri:e.redirectUri};return m(e),s.getAccessToken(r.tokenUrl,{client_id:e.clientId,redirect_uri:e.redirectUri,grant_type:"authorization_code",code:e.authorizationCode,code_verifier:e.codeVerifier})}).fin(function(){d.clearPKCEMeta(e)});throw new Error("authorize message does not have code");var t,n,r,e}).then(function(e){const t=["access_token","id_token"];return c.canUseRefreshToken&&t.push("refresh_token"),n=e,r=u,o=a,i=t,function(e,t){if(!e||!t)return v(void 0);var n=p(t),t=n.payload.iss;const r=n.header.kid;if(!e.jwks_uri)throw new Error("jwks_url is not in "+t+"./well-known/openid-configuration");return s.getOktaUnauthenticatedRequest(e.jwks_uri).then(function(e){e=l(e.keys,function(e){return e.kid==r});if(e)return e;throw new Error("The key id, "+r+", was not found in the server's keys")})}(o.openIdConfig,n.id_token).then(function(e){return E(n,{storage:d,browser:f,expectedResponseTypes:i,cryptoManager:h,idTokenValidation:{jwksKey:e,ignoreSignature:o.ignoreSignature,expectedClientId:o.clientId||c.clientId,expectedIssuer:r.issuer,expectedNonce:o.nonce}}).then(function(e){return Log.debug("successfully got token for domain {0}",c.oktaDomain),e})});var n,r,o,i})}function r(e,i){return i=i||{},U(e=e||{}).then(function(t){const n=u(c);var e=k(t),e=n.authorizeUrl+"?"+a(e);const r=C(i.timeout,t.state),o=function(e){const t=document.createElement("iframe");return t.style.display="none",t.src=e,document.body.appendChild(t)}(e);return r.then(function(e){return y(t,e,n)}).fin(function(e){return document.body.contains(o)&&o.parentElement.removeChild(o),e})})}return n.token={},n.token.getWithoutPrompt=function(e){if(!c.url)throw new Error("missing url in sdkOptions");return e=e||{},r(i({prompt:"none"},e.oauth),e)},n.token.getWithoutPromptFromBackground=function(e,t,n){if(!c.url)throw new Error("missing url in sdkOptions");e=e||{};var r,o,e=i({prompt:"none"},e.oauth);return r=t,U(e||{},o=n).then(function(t){const n=u(c);var e=k(t),e=n.authorizeUrl+"?"+a(e);return v.all([r.getPluginAuthorizeResponseParams(t),s.getManualRedirectRequest(e)]).spread(function(e){return r.modifyHeadersBeforeGetAccessToken(n,c).then(function(){return y(t,e,n,o)})})})},n};