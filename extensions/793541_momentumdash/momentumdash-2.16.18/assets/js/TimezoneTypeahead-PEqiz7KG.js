import e from"./LocationTypeahead-B5uIFZgK.js";import{Z as t,o as a}from"./icon-alert-mvI7iJMO.js";import{g as o}from"./globalKeyEventManager-FFJ3_dcn.js";import"./SoftFocus-BUhesXB-.js";import"./SmoothReflow-CBWUjKVT.js";import"./allComponentsMounted-C3UsG_cA.js";import"./localStorage-C5mLf9Kt.js";import"./preload-helper-DmNsytk6.js";import"./string-VUUyAM1F.js";const n=t.map((({name:e,id:t})=>{const a=e.includes("-"),o=e.substring(3),n=o.replace(":",""),[i,s]=o.substring(1).split(":");return{name:e,shortName:e,offset:(60*i+s)*(a?-1:1),searchable:n,timeZoneId:t}}));const i=a({name:"TimezoneTypeahead",components:{LocationTypeahead:e},props:{value:{type:Object,required:!0},componentFieldWarnings:{type:Array,default:()=>[]}},data:()=>({warning:!1,loadingTimezone:!1}),computed:{transformedValue(){return{name:this.value.timeZoneName,...this.value}}},watch:{componentFieldWarnings(e){e.includes("timeZoneId")&&(this.warning=!0),setTimeout((()=>this.warning=!1),1e3)}},created(){o.registerEventListener("closeResults","keyup",27,(()=>{this.$refs.typeahead.clear()}))},destroyed(){o.removeEventListener("closeResults","keyup",27)},methods:{async getTimezone({shortName:e,name:t,latitude:a,longitude:o,offset:n=0,timeZoneId:i=""}={}){if(this.$emit("input",{shortName:e,timeZoneName:t,offset:n,timeZoneId:i}),void 0===arguments[0].timeZoneId){this.loadingTimezone=!0;try{const{data:{name:n,offset:i}}=await this.$xhr.get(`/timezones:search?latitude=${a}&longitude=${o}`);this.$emit("input",{shortName:e,name:name,offset:i,timeZoneId:n,timeZoneName:t})}catch(s){console.error(s)}finally{this.loadingTimezone=!1}}},interceptUtcSearch(e){var t;const a=e.toLowerCase().trim();if(a.includes("utc")||a.includes("gmt")){const e=(null==(t=a.replace(":","").match(/(\d|-|\+)+/))?void 0:t[0])||"",o=m.utils.fuzzyFilter(e,n,"searchable");if(o.length)return o}}}},(function(){var e=this,t=e._self._c;return t("div",[t("div",{staticClass:"label-wrapper"},[t("label",[e._v("Location")]),e.loadingTimezone?t("div",{staticClass:"loading-icon",attrs:{"data-test":"loading-timezone"}}):e._e()]),t("location-typeahead",{ref:"typeahead",class:{pulse:e.warning},attrs:{"before-fetch-results":e.interceptUtcSearch,value:e.transformedValue,type:"timezone"},on:{input:e.getTimezone}})],1)}),[],!1,null,"d1de99f8").exports;export{i as default};