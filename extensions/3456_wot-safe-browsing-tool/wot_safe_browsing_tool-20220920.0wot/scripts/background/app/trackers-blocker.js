var _extends=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var s=arguments[e];for(var i in s)Object.prototype.hasOwnProperty.call(s,i)&&(t[i]=s[i])}return t};class TrackerBlocker{constructor(t){this.extensionId=webextApi.runtime.getURL("").split("://")[1].slice(0,-1),this.store=t;const e=t.getState();this._trackersList=void 0,this._allowList=e.trackerBlockerData.allowList,this._blockAll=e.trackerBlockerData.allBlocked,this.listener=t=>{if(t&&t.url)try{const e=getCleanDomain(t.url),s=this.trackersList[e];if(!s)return{cancel:!1};const i=t.originUrl;let r=t.initiator;if(r=r||i,!r||r.includes(this.extensionId))return{cancel:!1};r=getCleanDomain(r||i),this.store.dispatch(trackerDetected(_extends({},s,{initiator:r})));const l=!this.allowList[s.name];return l&&incrementUserStatisticsData(USER_STATS_DIGITAL_TRACKER_BLOCKED),{cancel:l}}catch(t){return{}}},this.startListener()}get allowList(){return this._allowList||(this._allowList=_extends({},this.store.getState().trackerBlockerData.allowList)),this._allowList}flush(){this._trackersList=void 0,this._blockAll=void 0,this.flushAllowList(),this.startListener()}flushAllowList(){this._allowList=void 0}get blockAll(){return void 0===this._blockAll&&(this._blockAll=_extends({},this.store.getState().trackerBlockerData.allBlocked)),this._blockAll}get trackersList(){return this._trackersList||(this._trackersList=this.store.getState().trackerBlockerData.list),this._trackersList}startListener(){this.clearListener(),webextApi.webRequest.onBeforeRequest.addListener(this.listener,{urls:["*://*/*"]},["blocking"])}clearListener(){webextApi.webRequest.onBeforeRequest.removeListener(this.listener)}}