// Copyright 2023 OneTab Ltd.  All rights reserved.
const A="1.83",gt=!1,xt=!1,yt=!1,mt=!1,bt=!1,Lt=!0,k=!!navigator.userAgent.match(/Mobile/i),St="about:",vt="about:blank",Ct="https://www.one-tab.com",Et=!1,j=!1,G=!1;async function g(){return new Promise((t,e)=>{document.readyState==="complete"?t():document.addEventListener("readystatechange",n=>{document.readyState==="complete"&&t()})})}function Dt(t){return x(void 0,"div",{id:"headerText",style:{paddingTop:"40px",paddingBottom:"20px",[`padding${wt()}`]:"240px",fontSize:"16px",color:"var(--text-color-weak)",fontWeight:"300",borderBottom:"1px dashed var(--dash-color)",marginBottom:"10px"},textContent:t}).o}function Tt(){return createLightDarkPicture({style:{width:416/2+"px",height:114/2+"px",position:"absolute",top:"16px",[`${ht()}`]:"19px"}},t=>`images/top-left-logo-${t?"light":"dark"}${s()?"":"-rtl"}.png`)}function It(t,e,n){let r=document.createElement("div"),o=document.createElement("div");R(o,"30px"),o.style.position="relative";let i=document.createElement("img");i.src=t?"images/twister-open.png":"images/twister-closed"+(s()?"":"-rtl")+".png",i.style.width=48/2+"px",i.style.height=50/2+"px",i.style.position="absolute",pt(i,"0px"),i.style.top="0px",o.textContent=e,o.style.fontSize="16px",o.style.cursor="pointer",r.appendChild(o),o.appendChild(i);let c=document.createElement("div");R(c,"30px"),c.style.paddingTop="10px",c.appendChild(n.o),c.style.display=t?"block":"none",r.appendChild(c),o.onclick=()=>{t=!t,i.src=t?"images/twister-open.png":"images/twister-closed"+(s()?"":"-rtl")+".png",c.style.display=t?"block":"none"};let l={D:n.o};return Object.assign(l,n),l.o=r,l}function Mt(t,e,n,r){let o=document.createElement("div");o.style.fontSize=e+"px",o.className="clickable";let i=document.createElement("span");if(r){let c=document.createElement("span");c.textContent=I("newExclamation")+" ",i.appendChild(c)}return typeof t=="string"?i.appendChild(document.createTextNode(t)):i.appendChild(t),i.style.verticalAlign="middle",i.onclick=c=>{n(i)},o.appendChild(i),o}const L=chrome.runtime.getURL("onetab.html"),S=L.substring(0,L.length-"onetab.html".length);let v=!1;async function Pt(){return v?(await chrome.permissions.getAll()).permissions.includes("tabGroups")&&chrome.tabGroups:!1}async function Ft(){if(!v||G)return!1;try{return await chrome.permissions.request({permissions:["tabGroups"]})}catch(t){return console.log('chrome.permissions.request for "tabGroups" permission failed with error:'),console.log(t),!1}}function Ut(t){let e=C(t);return e.toLowerCase().startsWith("www.")?e.substring("www.".length):e}function C(t){return t?(t.indexOf("//")===0&&(t="http:"+t),t.indexOf("://")===-1&&(t="http://"+t),t=t.substring(t.indexOf("://")+"://".length),t.indexOf("/")!==-1&&(t=t.substring(0,t.indexOf("/"))),t.indexOf(":")!==-1&&(t=t.substring(0,t.indexOf(":"))),t.indexOf("?")!==-1&&(t=t.substring(0,t.indexOf("?"))),t.indexOf("#")!==-1&&(t=t.substring(0,t.indexOf("#"))),t.toLowerCase()):"undefined"}function Rt(t){return t.indexOf("://")===-1?"https://":(t=t.substring(0,t.indexOf("://")+"://".length),t.toLowerCase())}let E=["com","co.uk","org.uk","net","org","de","ru","info","xyz","nl"];function At(t){let e=C(t);try{for(let n in E){let r="."+E[n];if(W(e,r)){for(e=e.substring(0,e.length-r.length);e.indexOf(".")!==-1;)e=e.substring(e.indexOf(".")+1);e=e+r;break}}return e.indexOf("www.")===0&&(e=e.substring("www.".length)),e}catch{return e}}function O(t){t.noCacheRandom=$()}function $(){return new Date().getTime()+Math.round(Math.random()*1e4)+""}async function kt(t,e){O(e);let n=JSON.stringify(e);return await(await B(t,n)).json()}async function B(t,e){let n={};e?(n.method="POST",n.body=e):n.method="GET",n.headers=new Headers,n.headers.append("Content-Type","text/json");let r=await fetch(t,n);if(r.status===200)return r;throw new Error("http response code"+r.status)}function jt(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,t=>{let e=Math.random()*16|0;return(t=="x"?e:e&3|8).toString(16)})}const H="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz-_".split("");function N(t,e){let n=H,r=[],o=0;for(e=e||n.length,t=t||22,o=0;o<t;o++)r[o]=n[0|Math.random()*e];return r.join("")}function _(){return N()}function Gt(){return _()}function Ot(t){return t==null?"":t.replace(/^\s+/,"").replace(/\s+$/,"")}function $t(t,e){return t?.length>e&&(t=t.substring(0,e)+"…"),t}function Bt(...t){return(e,n)=>t.reduce((r,o)=>r||o(e,n),0)}function Ht(t){return(e,n)=>t(e)-t(n)}function Nt(t){return(e,n)=>t(n)-t(e)}const _t=(t,e)=>!!e.starred-!!t.starred||t.starred&&e.starred&&e.starredDate-t.starredDate||e.createDate-t.createDate;function Wt(t){return t||(t=""),t.replace(/[\x00-\x1F\x7F-\x9F]/g,"")}function W(t,e){return t?t.indexOf(e,t.length-e.length)!==-1:!1}const z={restoreWindow:"newWindow",pinnedTabs:"ignore",startupLaunch:"displayOneTab",restoreRemoval:"default",duplicates:"allow",pinned:"true"};function zt(t,e){return e[t]?e[t]:z[t]}function Vt(t,e,n){t.parentNode&&t.remove(),e.insertBefore(t,n===void 0||n>=e.children.length||e.children.length===0?null:e.children[Math.max(0,n)])}function V(t,e){return X("div",t,e)}function X(t,e,n){return x(void 0,t,e,n)}function x(t,e,n,r){let o=e===void 0?t:document.createElement(e),i={},c={};if(n){n.style&&Object.assign(o.style,n.style);for(let a of Object.keys(n))a!=="style"&&a!=="children"&&a!=="child"&&a!=="init"&&(o[a]=n[a]),(a==="role"||a==="placeholder")&&o.setAttribute(a,n[a]);if(n.children){let a=Object.entries(n.children);for(const[d,f]of a)f instanceof HTMLElement?o.appendChild(f):(o.appendChild(f?.p?.o??f.o),f.u&&(Object.assign(c,f.u),c[d]=f));for(const[d,f]of a)i[d]=f,c[d]=f}if(n.l){let a=n.l;i.l=a,o.appendChild(a instanceof HTMLElement?a:a?.p?.o??a.o)}}e!==void 0&&t&&t.appendChild(o);let l={o,u:c};return Object.assign(l,i),r&&Object.assign(l,r),n?.init&&n.init(l),l}const D="about:reader?url=";function Xt(t){return t?t.indexOf(":")===-1?"https://"+t:t.indexOf(D)===0?decodeURIComponent(t.substring(D.length)):t.startsWith(`${S}placeholder.html?`)?new URLSearchParams(t.substring(t.indexOf("?"))).get("url"):t:""}function qt(t){let e=t.match(/\d+/);if(e)return parseInt(e[0])}const T=[...new Array(30)].map((t,e)=>parseInt(10+Math.pow(1.6,e)));function*q(t){let e=0;for(;T.slice(0,e).reduce((n,r)=>n+r,0)<t;)yield T[e++]}async function Jt(t,e,n){let r=0;for(let o of q(t)){if(await n(r))return;await y(o),r+=o}throw new Error(`Timeout waiting for condition ${e}`)}function I(t){let e=chrome.i18n.getMessage(t);return e||(console.log("No translation available for: "+t),t)}function Kt(t,e,n){return e&&((t||"").toLowerCase().startsWith("file:")||J(t))?n?`data:text/html, <html><body><div id="placeholderUrl">${t}</div></body></html>`:`${S}placeholder.html?url=${encodeURI(t)}`:t}async function Yt(){try{return j||!0}catch(t){return console.log(t),!0}}function J(t){for(let e of K)if(t.startsWith(e))return!0;return!!(!t||t===""||t.startsWith("chrome-devtools:"))}const K=["javascript:","about:",...["chrome://","edge://","data:"].filter(t=>!0),...["edge://","chrome://"].map(t=>["newtab","new-tab-page","print","network-error","badcastcrash","inducebrowsercrashforrealz","crash","crashdump","kill","hang","shorthang","gpuclean","gpucrash","gpuhang","memory-exhaust","memory-pressure-critical","memory-pressure-moderate","ppapiflashcrash","ppapiflashhang","quit","restart"].map(e=>`${t}${e}/`)).flat()];async function y(t){return new Promise(e=>setTimeout(e,t))}class Y{async put(e,n){await chrome.storage.local.set({[e]:n})}async get(e){return(await chrome.storage.local.get([e]))[e]}async remove(e){return await chrome.storage.local.remove(e)}}const Q=new Y;function w(){return Q}const Z="undefined-34LKmiHxP3Mu48u8qrDaHf";function m(t,e,n){return Array.isArray(t)?t.map(r=>m(r,e,n)):typeof t=="object"&&t!==null?Object.fromEntries(Object.entries(t).map(([r,o])=>[r,m(o,e,n)])):t===e?n:t}const Qt="c",Zt="e",te="tg";class tt{async put(e,n){await chrome.storage.session.set({[e]:n})}async get(e){return(await chrome.storage.session.get([e]))[e]}async getAll(){return await chrome.storage.session.get(null)}async remove(e){return await chrome.storage.session.remove(e)}async clearAll(){await chrome.storage.session.clear()}}class et{async put(e,n){await w().put("sessionStore",{...await this.getAll(),[e]:n})}async get(e){return(await this.getAll())[e]}async getAll(){return await w().get("sessionStore")??{}}async remove(e){let n=await this.getAll();delete n[e],await w().put("sessionStore",n)}async clearAll(){await w().remove("sessionStore")}}const nt=chrome.storage.session?new tt:new et;function ee(){return nt}function ne(){return navigator.userAgent.includes(" Edg/")}async function re(t){let[e]=await chrome.tabs.query({windowId:t.windowId,active:!0});e&&e.id!==t.id?(await chrome.tabs.update(t.id,{active:!0}),await chrome.tabs.update(e.id,{active:!0})):console.log("No active tab found")}function oe(t,e){let n,r;return arguments.length===1?(n=t,r=n!==void 0):(r=t,n=e),r?[n]:[]}function ie({id:t,display:e,marginTop:n="16px",marginBottom:r="16px",marginLeft:o=0,marginRight:i=0,color:c="var(--border-color)",I:l,P:a,F:d}={}){return V({...t&&{id:t},...a&&{className:"hideIfInLastSection"},...d&&{className:"hideIfInLastSubsection"},style:{...e&&{display:e},marginTop:n,marginBottom:r,marginLeft:o,marginRight:i,borderBottom:`1px solid ${c}`,...l}})}function ae(t){return[`
`,"\v","\f","\r","","\u2028","\u2029"].some(e=>e===t)}const rt=["\v","\f","\r","","\u2028","\u2029"];function ce(t){return t?(t=t.replaceAll(`\r
`,`
`),rt.forEach(e=>t=t.replaceAll(e,`
`)),t):""}class p{constructor(e,n){this.x=e,this.y=n}g(e){return new p(this.x-e.x,this.y-e.y)}}class M{constructor(e,n,r,o){this.m=e,this.type=n,this.listener=r,this.L=o}remove(){this.m.removeEventListener(this.type,this.listener,this.L)}}function se(t,e){t.onmousemove=n=>{e(new u(t,n))}}function ue(t,e){t.onmousedown=n=>{e(new u(t,n))}}function le(t,e){t.onmouseover=n=>{e(new u(t,n))}}function fe(t,e){t.onmouseup=n=>{e(new u(t,n))}}function de(t,e){t.onmouseout=n=>{e(new u(t,n))}}function we(t,e){t.onclick=n=>{e(new u(t,n))}}function he(t,e){t.ondblclick=n=>{e(new u(t,n))}}function pe(t,e){h(t,"click",e)}function ge(t,e){h(t,"dblclick",e)}function xe(t,e){return h(t,"mouseover",e)}function ye(t,e){return h(t,"mouseup",e)}function me(t,e){let n;return n=r=>{let o,i;o=r.currentTarget,i=r.relatedTarget,o===t&&o!==i&&!b(o,i)&&e(new u(t,r))},t.addEventListener("mouseout",n,!1),new M(t,"mouseout",n,!1)}function be(t,e){t.onmouseout=n=>{let r,o;r=n.currentTarget,o=n.relatedTarget,r===t&&r!==o&&!b(r,o)&&e(new u(t,n))}}function Le(t,e){for(let n of t)n.onmouseout=ot(n,t,e)}function ot(t,e,n){return r=>{let o,i;if(o=r.currentTarget,i=r.relatedTarget,o===t&&o!==i&&!b(o,i)){for(let c of e)if(i===c)return;n(new u(t,r))}}}function b(t,e){try{if(!e)return!1;for(;e.parentNode;)if((e=e.parentNode)===t)return!0;return!1}catch{return!1}}class u{constructor(e,n){this.element=e,this.event=n,this.i=null,this.h=null}S(){if(this.i===null){let e=it(this.element);this.i=e.x,this.h=e.y}return this.i}U(){return this.i===null&&this.S(),this.h}}function h(t,e,n){let r=o=>{let i=new u(t,o);n(i)};return t.addEventListener(e,r,!1),new M(t,e,r,!1)}function Se(t){return P(t)}function it(t,e){return P(e).g(at(t))}function P(t){let e,n;return e=t.clientX+window.scrollX,n=t.clientY+window.scrollY,new p(e,n)}function at(t){let e=t,n=0,r=0;for(;;){let o=e.offsetParent;if(o===null)break;n+=e.offsetLeft,r+=e.offsetTop,e=o}return new p(n,r)}function ve(){return window.scrollY}function Ce(){return window.scrollX}async function Ee(){if(k){let t=document.createElement("meta");t.name="viewport",t.content="width=400, initial-scale=1",document.getElementsByTagName("head")[0].appendChild(t)}await ct(),await g(),dt()}async function ct(){try{let t=await chrome.tabs.getCurrent();t&&await chrome.tabs.update(t.id,{autoDiscardable:!1})}catch(t){console.log(t)}}function De(t){if(typeof t=="string"&&(t=document.getElementById(t)),!!t)for(;t.childNodes.length>0;)t.childNodes[0].remove()}function Te(t){return x(void 0,"div",{style:{fontSize:"1px",height:t+"px",width:"1px"}}).o}let F=!1;async function st(t,e={}){if(!F){const r=async()=>{if((await chrome.runtime.sendMessage({args:[],type:ut.A,v:!0}))?.result?.pong!==String(A))throw new Error};try{await r()}catch{console.log("core not ready. retrying..."),await y(1e3);try{await r()}catch{console.log("core not ready. retrying..."),await y(5e3);try{await r()}catch{throw new Error("Cannot connect to core")}}}F=!0}e.type=t,e.v=!0;let n=await chrome.runtime.sendMessage(e);if(n===null)throw new Error("null message response from core");if(n?.C)throw new Error(n.C);return n.result}function Ie(t){chrome.runtime.onMessage.addListener((e,n,r)=>{e.type==="stateChange"&&t(e.k)})}const ut=new Proxy({},{get(t,e){return e}}),Me=new Proxy({},{get(t,e,n){return(...r)=>(r=m(r,void 0,Z),st(e,{args:r}))}});let lt=navigator.language||navigator.userLanguage;function ft(){let t=["ar","he","fa","ps","ur"],e=lt.split("-",1)[0];return t.indexOf(e)>=0?"rtl":"ltr"}let U=ft();function s(){return U!=="rtl"}function dt(){document.getElementsByTagName("html")[0].dir=U}function wt(){return s()?"Left":"Right"}function Pe(){return s()?"Right":"Left"}function ht(){return s()?"left":"right"}function Fe(){return s()?"right":"left"}function pt(t,e){s()?t.style.left=e:t.style.right=e}function Ue(t,e){s()?t.style.right=e:t.style.left=e}function R(t,e){s()?t.style.paddingLeft=e:t.style.paddingRight=e}function Re(t,e){s()?t.style.paddingRight=e:t.style.paddingLeft=e}function Ae(t,e){s()?t.style.marginLeft=e:t.style.marginRight=e}(async()=>{await g();const t=document.getElementById("copyButton");let n=new URLSearchParams(window.location.search).get("url"),r=document.getElementById("urlInput");r.value=n;let o=decodeURIComponent(n);["/","\\"].forEach(i=>{o.includes(i)&&(o=o.substring(o.lastIndexOf(i)+1))}),document.title=o,document.getElementById("filename").textContent=o,t.onclick=i=>{r.select(),navigator.clipboard.writeText(r.value)}})(),(async()=>(await g(),[...document.querySelectorAll("[data-m]")].forEach(t=>t.textContent=I(t.dataset.m))))();
