(self.webpackChunkyoroi=self.webpackChunkyoroi||[]).push([[2322],{33913:(e,t,a)=>{"use strict";a.d(t,{UZ:()=>n});var r=a(27216);class n extends r.Z{static get defaultMessage(){return"Passphrase doesn't match"}constructor(){super(n.defaultMessage)}}},87315:(e,t,a)=>{"use strict";function r(e){if(e.startingFrom.level+1<e.addressing.startLevel)throw new Error("derivePublicByAddressing keyLevel < startLevel");let t=e.startingFrom.key;for(let a=e.startingFrom.level-e.addressing.startLevel+1;a<e.addressing.path.length;a++)t=t.derive(e.addressing.path[a]);return t}function n(e){if(e.startingFrom.level+1<e.addressing.startLevel)throw new Error("derivePrivateByAddressing keyLevel < startLevel");let t=e.startingFrom.key;for(let a=e.startingFrom.level-e.addressing.startLevel+1;a<e.addressing.path.length;a++)t=t.derive(e.addressing.path[a]);return t}a.d(t,{c:()=>r,r:()=>n}),a(86335)},5557:(e,t,a)=>{"use strict";a.d(t,{FB:()=>s}),a(20116);var r=a(2991),n=a.n(r);a(3649),a(54804),a(94198),a(97657);const i=2147483648;function s(e){return`m/${n()(e).call(e,(e=>e%i+(e>=i?"'":""))).join("/")}`}},52760:(e,t,a)=>{"use strict";a.d(t,{_:()=>i,h:()=>s});var r=a(56474),n=a.n(r);const i=n()({BIP32ED25519:0,BIP32:1}),s=n()({Public:0,Private:1})},19187:(e,t,a)=>{"use strict";a.d(t,{w7:()=>P});var r=a(46423),n=a.n(r),i=a(36384),s=a.n(i),o=a(51942),l=a.n(o),d=a(77766),c=a.n(d),u=a(32366),p=a.n(u),h=a(26295),y=a.n(h),w=a(2991),v=a.n(w),f=a(93476),I=a.n(f),T=a(87672),g=a.n(T),m=a(63139),b=a(96486),D=a(21131),k=a(13469),x=a(52974);const C=50;class P{constructor(e){g()(this,"baseFetcher",void 0),g()(this,"getUTXOsForAddresses",(e=>{return(t=this.baseFetcher.getUTXOsForAddresses,async function(e){try{const a=(0,b.chunk)(e.addresses,50),r=v()(a).call(a,(a=>t({addresses:a,network:e.network})));return I().all(r).then((e=>p()(e).call(e,((e,t)=>c()(e).call(e,t)),[])))}catch(e){if(k.Yd.error("batchedFetcher:::batchUTXOsForAddresses error: "+(0,k.n)(e)),e instanceof m.default)throw e;throw new D.fc}})(e);var t})),g()(this,"getTransactionsHistoryForAddresses",(e=>{return(t=this.baseFetcher.getTransactionsHistoryForAddresses,async function(e){try{const a=await async function(a,r){const n=(0,b.chunk)(a,C),i=v()(n).call(n,(async a=>await A([],{...e,addresses:a},t))),s=await I().all(i);return p()(s).call(s,((e,t)=>c()(e).call(e,t)),[])}(e.addresses),r=new(s()),n=[];for(const e of a)r.has(e.hash)||(n.push(e),r.add(e.hash));return n}catch(e){if(k.Yd.error("batchedFetcher::batchGetTransactionsHistoryForAddresses error: "+(0,k.n)(e)),e instanceof m.default)throw e;throw new D.PQ}})(e);var t})),g()(this,"getRecentTransactionHashes",(e=>(0,this.baseFetcher.getRecentTransactionHashes)(e))),g()(this,"getTransactionsByHashes",(e=>{return(t=this.baseFetcher.getTransactionsByHashes,async function(e){var a;const r=v()(a=(0,b.chunk)(e.txHashes,100)).call(a,(a=>t({txHashes:a,network:e.network}))),n=await I().all(r);return p()(n).call(n,((e,t)=>[...e,...t]),[])})(e);var t})),g()(this,"getTransactionSlotsByHashes",(e=>{return(t=this.baseFetcher.getTransactionSlotsByHashes,async function(e){var a;const r=v()(a=(0,b.chunk)(e.txHashes,100)).call(a,(a=>t({txHashes:a,network:e.network}))),n=await I().all(r);return p()(n).call(n,((e,t)=>({...e,...t})),{})})(e);var t})),g()(this,"getRewardHistory",(e=>{return(t=this.baseFetcher.getRewardHistory,async function(e){try{const a=(0,b.chunk)(e.addresses,C),r=v()(a).call(a,(a=>t({network:e.network,addresses:a}))),n=await I().all(r);return l()({},...n)}catch(e){if(k.Yd.error("batchedFetcher::batchGetRewardHistory error: "+(0,k.n)(e)),e instanceof m.default)throw e;throw new D.E8}})(e);var t})),g()(this,"getBestBlock",(e=>this.baseFetcher.getBestBlock(e))),g()(this,"sendTx",(e=>this.baseFetcher.sendTx(e))),g()(this,"getMultiAssetMintMetadata",(async e=>{const{network:t,assets:a}=e,r=(0,b.chunk)(a,100),n=await I().all(v()(r).call(r,(e=>this.baseFetcher.getMultiAssetMintMetadata({network:t,assets:e})))),i={};for(const e of n)for(const[t,a]of y()(e))i[t]=a;return i})),g()(this,"getMultiAssetSupply",(async e=>{const{network:t,assets:a}=e,r=(0,b.chunk)(a,100),n=await I().all(v()(r).call(r,(e=>this.baseFetcher.getMultiAssetSupply({network:t,assets:e})))),i={};for(const e of n)for(const[t,a]of y()(e))i[t]=a;return i})),g()(this,"getAccountState",(e=>{return(t=this.baseFetcher.getAccountState,async function(e){try{const a=(0,b.chunk)(e.addresses,C),r=v()(a).call(a,(a=>t({network:e.network,addresses:a}))),n=await I().all(r);return l()({},...n)}catch(e){if(k.Yd.error("batchedFetcher::batchGetAccountState error: "+(0,k.n)(e)),e instanceof m.default)throw e;throw new D.AH}})(e);var t})),g()(this,"checkAddressesInUse",(e=>{return(t=this.baseFetcher.checkAddressesInUse,async function(e){try{const a=(0,b.chunk)(e.addresses,C),r=v()(a).call(a,(a=>t({network:e.network,addresses:a}))),n=await I().all(r);return p()(n).call(n,((e,t)=>c()(e).call(e,t)),[])}catch(e){if(k.Yd.error("batchedFetcher::batchCheckAddressesInUse error: "+(0,k.n)(e)),e instanceof m.default)throw e;throw new D.HH}})(e);var t})),g()(this,"getPoolInfo",(e=>{return(t=this.baseFetcher.getPoolInfo,async function(e){try{const a=(0,b.chunk)(e.poolIds,C),r=v()(a).call(a,(a=>t({network:e.network,poolIds:a}))),n=await I().all(r);return l()({},...n)}catch(e){if(k.Yd.error("batchedFetcher::batchGetPoolInfo error: "+(0,k.n)(e)),e instanceof m.default)throw e;throw new D.nW}})(e);var t})),g()(this,"getTokenInfo",(e=>{return(t=this.baseFetcher.getTokenInfo,async function(e){try{const a=(0,b.chunk)(e.tokenIds,C),r=v()(a).call(a,(a=>t({network:e.network,tokenIds:a}))),n=await I().all(r);return l()({},...n)}catch(e){if(k.Yd.error("batchedFetcher::batchGetTokenInfo error: "+(0,k.n)(e)),e instanceof m.default)throw e;throw new D.XX}})(e);var t})),g()(this,"getCatalystRoundInfo",(e=>{return(t=this.baseFetcher.getCatalystRoundInfo,async function(e){try{return t(e)}catch(e){if(k.Yd.error("batchedFetcher::batchGetAccountState error: "+(0,k.n)(e)),e instanceof m.default)throw e;throw new D.AH}})(e);var t})),g()(this,"getUtxoData",(e=>{return(t=this.baseFetcher.getUtxoData,async function(e){var a,r;return n()(a=await I().all(v()(r=e.utxos).call(r,(({txHash:a,txIndex:r})=>t({network:e.network,utxos:[{txHash:a,txIndex:r}]}))))).call(a)})(e);var t})),g()(this,"getLatestBlockBySlot",(async e=>this.baseFetcher.getLatestBlockBySlot(e))),g()(this,"getSwapFeeTiers",(async e=>this.baseFetcher.getSwapFeeTiers(e))),this.baseFetcher=e}}async function A(e,t,a){const r=await a(t);if(0===r.length)return e;const n=c()(e).call(e,r);if(r.length===x.Z.wallets.TRANSACTION_REQUEST_SIZE){const e=function(e){const t=[];for(const a of e)null!=a.block_hash&&null!=a.tx_ordinal&&null!=a.height&&t.push({blockHash:a.block_hash,txHash:a.hash,txOrdinal:a.tx_ordinal,height:a.height});if(0===t.length)return;let a=t[0];for(let e=1;e<t.length;e++)(t[e].height>a.height||t[e].height===a.height&&t[e].txOrdinal>a.txOrdinal)&&(a=t[e]);return a}(r);if(void 0===e)throw new Error("_batchHistoryByTransaction only pending/failed tx returned");return await A(n,{...t,after:{block:e.blockHash,tx:e.txHash}},a)}return n}},59927:(e,t,a)=>{"use strict";a.d(t,{o2:()=>g,Gb:()=>T,Qy:()=>m});var r=a(39392),n=a.n(r),i=a(86902),s=a.n(i),o=a(2991),l=a.n(o),d=a(80426),c=a.n(d),u=a(56474),p=a.n(u),h=(a(47197),a(57421)),y=a(87672),w=a.n(y),v=a(77600);class f{static async getAll(e,t){return await(0,h.go)(e,t,f.ownTables[v.gJ.name].name)}static async getBackups(e,t){const a=f.ownTables[v.gJ.name],r=e.getSchema().table(a.name),n=e.select().from(r).where(r[a.properties.IsBackup].eq(!0));return await t.attach(n)}static async getPreferredExplorer(e,t){const a=new(n()),r=await f.getBackups(e,t);for(const e of r)a.set(e.NetworkId,e);const i=f.ownTables[v.gJ.name],o=e.getSchema().table(i.name),l=f.ownTables[v.dE.name],d=e.getSchema().table(l.name),c=e.select().from(o).innerJoin(d,d[l.properties.ExplorerId].eq(o[i.properties.ExplorerId])),u=await t.attach(c);for(const e of u)0!==s()(e.Explorer.Endpoints).length&&a.set(e.Explorer.NetworkId,e.Explorer);return a}}w()(f,"ownTables",p()({[v.gJ.name]:v.gJ,[v.dE.name]:v.dE})),w()(f,"depTables",p()({}));var I=a(20335);async function T(e){var t,a;const r=p()({GetExplorers:f}),i=c()(t=l()(a=s()(r)).call(a,(e=>r[e]))).call(t,(t=>(0,h.Hz)(e.db,t)));return await(0,h.zm)(e.db,i,(async t=>{const a=await r.GetExplorers.getPreferredExplorer(e.db,t),i=await r.GetExplorers.getBackups(e.db,t);if(a.size!==i.length)throw new Error("getSelectedExplorer size mismatch");const s=new(n());for(const e of i){const t=a.get(e.NetworkId);if(null==t)throw new Error("getSelectedExplorer key mismatch");s.set(e.NetworkId,{backup:e,selected:t})}return s}))}async function g(e){var t,a;const r=p()({GetExplorers:f}),i=c()(t=l()(a=s()(r)).call(a,(e=>r[e]))).call(t,(t=>(0,h.Hz)(e.db,t)));return await(0,h.zm)(e.db,i,(async t=>{const a=await r.GetExplorers.getAll(e.db,t),i=new(n());for(const e of a){const t=i.get(e.NetworkId);null==t?i.set(e.NetworkId,[e]):t.push(e)}return i}))}async function m(e){var t,a;const r=p()({ModifyPreferredExplorer:I.h}),n=c()(t=l()(a=s()(r)).call(a,(e=>r[e]))).call(t,(t=>(0,h.Hz)(e.db,t)));return await(0,h.zm)(e.db,n,(async t=>r.ModifyPreferredExplorer.upsert(e.db,t,{ExplorerId:e.explorer.ExplorerId,NetworkId:e.explorer.NetworkId})))}},23307:(e,t,a)=>{"use strict";a.d(t,{Oy:()=>m,jM:()=>b,dj:()=>g});var r=a(86902),n=a.n(r),i=a(2991),s=a.n(i),o=a(80426),l=a.n(o),d=a(56474),c=a.n(d),u=a(57421),p=a(87672),h=a.n(p),y=a(78741);class w{static async getAllMemos(e,t){return await(0,u.go)(e,t,w.ownTables[y.E.name].name)}}h()(w,"ownTables",c()({[y.E.name]:y.E})),h()(w,"depTables",c()({}));var v=a(47197),f=a(39845),I=a(17625);class T{static async upsertMemo(e,t,a){const{TransactionSeed:r}=await T.depTables.GetEncryptionMeta.get(e,t),n=(0,I.a)(a.TransactionHash,r),i={...a,Digest:n};return await(0,u.mX)(e,t,i,T.ownTables[y.E.name].name)}static async deleteMemo(e,t,a){const{TransactionSeed:r}=await T.depTables.GetEncryptionMeta.get(e,t),n=(0,I.a)(a.txHash,r),i=e.getSchema().table(T.ownTables[y.E.name].name),{properties:s}=T.ownTables[y.E.name];await t.attach(e.delete().from(i).where(v.op.and(i[s.Digest].eq(n),i[s.WalletId].eq(a.walletId))))}}async function g(e){var t,a;const r=c()({ModifyTxMemo:T}),i=l()(t=s()(a=n()(r)).call(a,(e=>r[e]))).call(t,(t=>(0,u.Hz)(e.db,t)));return await(0,u.zm)(e.db,i,(async t=>r.ModifyTxMemo.upsertMemo(e.db,t,e.memo)))}async function m(e){var t,a;const r=c()({ModifyTxMemo:T}),i=l()(t=s()(a=n()(r)).call(a,(e=>r[e]))).call(t,(t=>(0,u.Hz)(e.db,t)));return await(0,u.zm)(e.db,i,(async t=>r.ModifyTxMemo.deleteMemo(e.db,t,e.key)))}async function b(e){var t,a;const r=c()({GetTxMemo:w}),i=l()(t=s()(a=n()(r)).call(a,(e=>r[e]))).call(t,(t=>(0,u.Hz)(e.db,t)));return await(0,u.zm)(e.db,i,(async t=>r.GetTxMemo.getAllMemos(e.db,t)))}h()(T,"ownTables",c()({[y.E.name]:y.E})),h()(T,"depTables",c()({GetEncryptionMeta:f.t$}))},51965:(e,t,a)=>{"use strict";a.d(t,{Z:()=>l});var r=a(51938),n=a.n(r),i=a(90649),s=a(84174);function o(e){const t=[];for(let n=0;n<e.length-2;n++){var a,r;t.push([null!==(a=e[n].StartAt)&&void 0!==a?a:(0,i.fail)("createEraBoundaries missing start"),null!==(r=e[n+1].StartAt)&&void 0!==r?r:(0,i.fail)("createEraBoundaries missing end"),e[n+1]])}return t}class l{static toAbsoluteSlotNumber(e,t){var a;let r=null!==(a=e[0].SlotsPerEpoch)&&void 0!==a?a:(0,i.fail)("toAbsoluteSlotNumber missing slots per epoch"),n=0,s=t.epoch;for(const[a,i,d]of o(e)){var l;if(i>t.epoch)break;const e=i-a;n+=r*e,s-=e,r=null!==(l=d.SlotsPerEpoch)&&void 0!==l?l:r}return n+r*s+t.slot}static toRelativeSlotNumber(e,t){var a;let r=null!==(a=e[0].SlotsPerEpoch)&&void 0!==a?a:(0,i.fail)("toRelativeSlotNumber missing slots per epoch"),n=0,s=t;for(const[t,a,i]of o(e)){var l;const e=a-t;if(s<r*e)break;s-=r*e,n+=e,r=null!==(l=i.SlotsPerEpoch)&&void 0!==l?l:r}return{epoch:n+Math.floor(s/r),slot:s%r}}static timeToAbsoluteSlot(e,t){var a,r,s;const l=null!==(a=e[0].GenesisDate)&&void 0!==a?a:(0,i.fail)("timeToAbsoluteSlot missing genesis date");let d=null!==(r=e[0].SlotDuration)&&void 0!==r?r:(0,i.fail)("timeToAbsoluteSlot missing slot duration"),c=null!==(s=e[0].SlotsPerEpoch)&&void 0!==s?s:(0,i.fail)("timeToAbsoluteSlot missing slots per epoch"),u=t.getTime()-new Date(n()(l,10)).getTime(),p=0;for(const[t,a,r]of o(e)){var h,y;const e=a-t;if(u<c*d*1e3*e)break;p+=c*e,u-=c*d*1e3*e,d=null!==(h=r.SlotDuration)&&void 0!==h?h:d,c=null!==(y=r.SlotsPerEpoch)&&void 0!==y?y:c}const w=u/1e3;return p+Math.floor(w/d)}static secondsSinceGenesis(e,t){var a,r;let n=null!==(a=e[0].SlotDuration)&&void 0!==a?a:(0,i.fail)("secondsSinceGenesis missing slot duration"),s=null!==(r=e[0].SlotsPerEpoch)&&void 0!==r?r:(0,i.fail)("secondsSinceGenesis missing slots per epoch"),l=0,d=t;for(const[t,a,r]of o(e)){var c,u;const e=a-t;if(d<s*e)break;l+=s*n*e,d-=s*e,n=null!==(c=r.SlotDuration)&&void 0!==c?c:n,s=null!==(u=r.SlotsPerEpoch)&&void 0!==u?u:s}return l+d*n}static absoluteSlotToTime(e,t){const{GenesisDate:a}=e[0];if(null==a)throw new Error("absoluteSlotToTime missing genesis start date");const r=l.secondsSinceGenesis(e,t),i=new Date(n()(a,10)).getTime()+1e3*r;return new Date(i)}static currentEpochSlots(e){var t;return null!==(t=(0,s.cardanoHaskellConfigCombine)(e).SlotsPerEpoch)&&void 0!==t?t:(0,i.fail)("currentEpochSlots missing slots per epoch")}static currentSlotSeconds(e){var t;return null!==(t=(0,s.cardanoHaskellConfigCombine)(e).SlotDuration)&&void 0!==t?t:(0,i.fail)("currentSlotSeconds missing slot duration")}}},94528:(e,t,a)=>{"use strict";a.d(t,{s:()=>T});var r=a(2991),n=a.n(r),i=a(89400),s=a.n(i),o=a(77766),l=a.n(o),d=a(66419),c=a.n(d),u=a(87672),p=a.n(u),h=a(72741),y=a(81369),w=a(2151),v=a(7559),f=a(57421),I=a(69594);class T{constructor(e,t,a,r,n,i){p()(this,"db",void 0),p()(this,"txHolder",void 0),p()(this,"tables",void 0),p()(this,"derivationTables",void 0),p()(this,"buildSteps",void 0),p()(this,"state",void 0),p()(this,"addConceptualWallet",(e=>this.updateData({conceptualWalletRow:null},c()((0,f.fO)(h.lq)),(async t=>{t.conceptualWalletRow=await h.lq.add(this.db,this.txHolder.tx,e(t))})))),p()(this,"addBip44Wrapper",(e=>this.updateData({bip44WrapperRow:null},c()((0,f.fO)(y._)),(async t=>{t.bip44WrapperRow=await y._.add(this.db,this.txHolder.tx,e(t))})))),p()(this,"addCip1852Wrapper",(e=>this.updateData({cip1852WrapperRow:null},c()((0,f.fO)(w.S)),(async t=>{t.cip1852WrapperRow=await w.S.add(this.db,this.txHolder.tx,e(t))})))),p()(this,"addFromRoot",(e=>this.updateData({root:null},c()((0,f.fO)(v.if)),(async t=>{const{rootInsert:a,tree:r}=e(t);t.root=await v.if.includingParent(this.db,this.txHolder.tx,a,this.derivationTables,0,r)})))),p()(this,"addAdhocPublicDeriver",(e=>this.updateData({publicDeriver:[]},c()((0,f.fO)(v.ai)),(async t=>{t.publicDeriver=[...t.publicDeriver,(await v.ai.add(this.db,this.txHolder.tx,e(t),t.conceptualWalletRow.ConceptualWalletId,this.derivationTables)).publicDeriver]})))),p()(this,"derivePublicDeriver",(e=>this.updateData({publicDeriver:[]},c()((0,f.fO)(v.pf)),(async t=>{const{privateDeriverKeyDerivationId:a,privateDeriverLevel:r,deriverRequest:n}=e(t);t.publicDeriver=[...t.publicDeriver,await(0,I.bR)(this.db,this.txHolder.tx,{DerivePublicDeriverFromKey:v.pf},t.conceptualWalletRow.ConceptualWalletId,n,a,r,this.derivationTables)]})))),this.db=e,this.txHolder=t,this.tables=a,this.buildSteps=r,this.state=n,this.derivationTables=i}updateData(e,t,a){var r,n;const i=this.state;return new T(this.db,this.txHolder,l()(r=this.tables).call(r,t),l()(n=this.buildSteps).call(n,a),{...e,...i},this.derivationTables)}static start(e,t){return new T(e,{tx:null},[],[],{},t)}async commit(){var e;const t=c()([...this.tables,...c()(s()(e=this.derivationTables).call(e))]),a=n()(t).call(t,(e=>this.db.getSchema().table(e)));return await(0,f.zm)(this.db,a,(async e=>{this.txHolder.tx=e;for(const e of this.buildSteps)await e(this.state)})),this.state}}},21233:(e,t,a)=>{"use strict";a.d(t,{q:()=>k});var r=a(86902),n=a.n(r),i=a(2991),s=a.n(i),o=a(80426),l=a.n(o),d=a(56474),c=a.n(d),u=a(57421),p=a(72741),h=(a(27189),a(3577)),y=a(4922),w=a(39845),v=a(97143),f=a(82982),I=a(85339),T=a(75697),g=a(91811),m=a(37495),b=a(84174),D=a(35072);async function k(e){var t,a;const r=c()({RemovePublicDeriver:p.Ip,ModifyConceptualWallet:p.lq,GetPathWithSpecific:w.LY,GetAddress:w.t9,CardanoByronAssociateTxWithIOs:T.X,CardanoShelleyAssociateTxWithIOs:T.K,AssociateTxWithAccountingIOs:I.KN,AssociateTxWithUtxoIOs:f.zb,GetDerivationSpecific:g.n,DeleteAllTransactions:p.OQ,ModifyAddress:v.ad,GetTransaction:w.Ey,FreeBlocks:v.h,GetCertificates:w.CT,ModifyTokenList:v.xx,ModifyUtxoAtSafePoint:D.I,ModifyUtxoDiffToBestBlock:D.j}),i=e.publicDeriver.getDb(),o=l()(t=s()(a=n()(r)).call(a,(e=>r[e]))).call(t,(e=>(0,u.Hz)(i,e)));return await(0,u.zm)(i,[...i.getSchema().tables(),...o],(async t=>{const a=(0,h.JM)(e.publicDeriver);if(null!=a){var o,d;const c=e.publicDeriver.getParent().getNetworkInfo();if(!(0,b.isCardanoHaskell)(c))throw new Error("removePublicDeriver No implementation for wallet removal");await(0,y.$1)(i,t,{GetPathWithSpecific:r.GetPathWithSpecific,GetAddress:r.GetAddress,CardanoByronAssociateTxWithIOs:r.CardanoByronAssociateTxWithIOs,CardanoShelleyAssociateTxWithIOs:r.CardanoShelleyAssociateTxWithIOs,AssociateTxWithUtxoIOs:r.AssociateTxWithUtxoIOs,AssociateTxWithAccountingIOs:r.AssociateTxWithAccountingIOs,GetDerivationSpecific:r.GetDerivationSpecific,DeleteAllTransactions:r.DeleteAllTransactions,ModifyAddress:r.ModifyAddress,GetTransaction:r.GetTransaction,FreeBlocks:r.FreeBlocks,GetCertificates:r.GetCertificates,ModifyTokenList:r.ModifyTokenList},a.getParent().getDerivationTables(),{publicDeriver:a});const u=await(0,m.g_)(t,{GetPathWithSpecific:r.GetPathWithSpecific,GetAddress:r.GetAddress,GetDerivationSpecific:r.GetDerivationSpecific},{publicDeriver:e.publicDeriver},a.getParent().getDerivationTables()),p=s()(o=l()(d=n()(u)).call(d,(e=>u[e]))).call(o,(e=>e.address.AddressId));await r.ModifyAddress.remove(i,t,p)}await D.I.remove(i,t,e.publicDeriver.getPublicDeriverId()),await D.j.removeAll(i,t,e.publicDeriver.getPublicDeriverId()),await r.RemovePublicDeriver.remove(i,t,{publicDeriverId:e.publicDeriver.getPublicDeriverId()}),null!=e.conceptualWallet&&await e.conceptualWallet.rawRemove(i,t)}))}},34654:(e,t,a)=>{"use strict";a.d(t,{fd:()=>m,B8:()=>b});var r=a(36384),n=a.n(r),i=a(51938),s=a.n(i),o=a(93476),l=a.n(o),d=a(2991),c=a.n(d),u=a(96486),p=(a(47197),a(66905)),h=a(94528),y=(a(86335),a(13069)),w=a(52367),v=a(24651),f=a(88903),I=a(52760),T=a(90649);async function g(e,t,a){var r;const n=(0,u.range)(0,p.C4),i=t.derive(p.OC.CHIMERIC_ACCOUNT).derive(p.Iz).to_raw_key(),s=c()(n).call(n,(e=>t.derive(p.OC.EXTERNAL).derive(e).to_raw_key().hash())),o=c()(n).call(n,(e=>t.derive(p.OC.INTERNAL).derive(e).to_raw_key().hash())),d=c()(n).call(n,(t=>({index:t,insert:async r=>await(0,f.Jf)(a,r,i,s[t],e)}))),h=c()(n).call(n,(t=>({index:t,insert:async r=>await(0,f.Jf)(a,r,i,o[t],e)}))),y=c()(r=[0]).call(r,(t=>({index:t,insert:async t=>await(0,f.dh)(a,t,i,e)})));return[{index:p.OC.EXTERNAL,insert:e=>l().resolve({KeyDerivationId:e.keyDerivationId,DisplayCutoff:0}),children:d},{index:p.OC.INTERNAL,insert:e=>l().resolve({KeyDerivationId:e.keyDerivationId,DisplayCutoff:null}),children:h},{index:p.OC.CHIMERIC_ACCOUNT,insert:e=>l().resolve({KeyDerivationId:e.keyDerivationId,DisplayCutoff:null}),children:y}]}async function m(e){if(e.accountIndex<p.yK)throw new Error("createStandardCip1852Wallet needs hardened index");const t=(0,y.x)(e.password,e.rootPk.as_bytes()),a=e.rootPk.derive(p.r7.CIP1852).derive(p.M8.CARDANO).derive(e.accountIndex).to_public();if(null==e.network.BaseConfig[0].ChainNetworkId)throw new Error("createStandardCip1852Wallet missing Byron network id");const r=await g(s()(e.network.BaseConfig[0].ChainNetworkId,10),a,(0,v.dw)(new(n()))),i=[];let o;return o=await h.s.start(e.db,w.lE).addConceptualWallet((t=>({NetworkId:e.network.NetworkId,Name:e.walletName}))).addFromRoot((e=>({rootInsert:{privateKeyInfo:{Hash:t,IsEncrypted:!0,PasswordLastUpdate:null,Type:I._.BIP32ED25519},publicKeyInfo:null,derivationInfo:e=>({PublicKeyId:e.public,PrivateKeyId:e.private,Parent:null,Index:null}),levelInfo:e=>l().resolve({KeyDerivationId:e.keyDerivationId})},tree:e=>({derivationId:e,children:[]})}))).addCip1852Wrapper((e=>({ConceptualWalletId:e.conceptualWalletRow.ConceptualWalletId,SignerLevel:w.CZ.ROOT.level,PublicDeriverLevel:w.CZ.ACCOUNT.level,PrivateDeriverKeyDerivationId:e.root.root.KeyDerivation.KeyDerivationId,PrivateDeriverLevel:i.length,RootKeyDerivationId:e.root.root.KeyDerivation.KeyDerivationId}))).derivePublicDeriver((t=>{const a=t.cip1852WrapperRow.PrivateDeriverKeyDerivationId,n=t.cip1852WrapperRow.PrivateDeriverLevel;if(null==a||null==n)throw new Error("createStandardCip1852Wallet missing private deriver");return{deriverRequest:{decryptPrivateDeriverPassword:e.password,publicDeriverMeta:{name:e.accountName},path:[{index:p.r7.CIP1852,insert:{}},{index:p.M8.CARDANO,insert:{}},{index:e.accountIndex,insert:{}}],initialDerivations:r},privateDeriverKeyDerivationId:a,privateDeriverLevel:n}})).commit(),o}async function b(e){if(e.accountIndex<p.yK)throw new Error("createStandardCip1852Wallet needs hardened index");const t=await g(s()(e.network.BaseConfig[0].ChainNetworkId,10),e.accountPublicKey,(0,v.dw)(new(n())));let a;return a=await h.s.start(e.db,w.lE).addConceptualWallet((t=>({NetworkId:e.network.NetworkId,Name:e.walletName}))).addFromRoot((e=>({rootInsert:{privateKeyInfo:null,publicKeyInfo:null,derivationInfo:e=>({PublicKeyId:e.public,PrivateKeyId:e.private,Parent:null,Index:null}),levelInfo:e=>l().resolve({KeyDerivationId:e.keyDerivationId})},tree:e=>({derivationId:e,children:[]})}))).addCip1852Wrapper((e=>({ConceptualWalletId:e.conceptualWalletRow.ConceptualWalletId,SignerLevel:null,PublicDeriverLevel:w.CZ.ACCOUNT.level,PrivateDeriverKeyDerivationId:null,PrivateDeriverLevel:null,RootKeyDerivationId:e.root.root.KeyDerivation.KeyDerivationId}))).addAdhocPublicDeriver((a=>({parentDerivationId:a.root.root.KeyDerivation.KeyDerivationId,pathStartLevel:1,publicDeriverMeta:{name:e.accountName},pathToPublic:[{index:p.r7.CIP1852,insert:e=>l().resolve({KeyDerivationId:e.keyDerivationId}),publicKey:null,privateKey:null},{index:p.M8.CARDANO,insert:e=>l().resolve({KeyDerivationId:e.keyDerivationId}),publicKey:null,privateKey:null},{index:e.accountIndex,insert:e=>l().resolve({KeyDerivationId:e.keyDerivationId}),publicKey:{Hash:(0,T.bytesToHex)(e.accountPublicKey.as_bytes()),IsEncrypted:!1,PasswordLastUpdate:null,Type:I._.BIP32ED25519},privateKey:null}],initialDerivations:t,hwWalletMetaInsert:{ConceptualWalletId:a.conceptualWalletRow.ConceptualWalletId,...e.hwWalletMetaInsert}}))).commit(),a}},20335:(e,t,a)=>{"use strict";a.d(t,{f:()=>d,h:()=>c});var r=a(56474),n=a.n(r),i=a(87672),s=a.n(i),o=a(77600),l=a(57421);class d{static async upsert(e,t,a){return await(0,l.GB)(e,t,a,d.ownTables[o.gJ.name].name)}}s()(d,"ownTables",n()({[o.gJ.name]:o.gJ})),s()(d,"depTables",n()({}));class c{static async upsert(e,t,a){return await(0,l.t5)(e,t,c.ownTables[o.dE.name].name,c.ownTables[o.dE.name].properties.NetworkId,[a.NetworkId]),await(0,l.GB)(e,t,[a],c.ownTables[o.dE.name].name)}}s()(c,"ownTables",n()({[o.dE.name]:o.dE})),s()(c,"depTables",n()({}))},77600:(e,t,a)=>{"use strict";a.d(t,{dE:()=>o,gJ:()=>l,uT:()=>d});var r=a(56474),n=a.n(r),i=a(47197),s=a(90691);n()({address:"address",transaction:"transaction",pool:"pool",stakeAddress:"stakeAddress",token:"token"});const o={name:"PreferredExplorer",properties:{PreferredExplorerId:"PreferredExplorerId",ExplorerId:"ExplorerId",NetworkId:"NetworkId"}},l={name:"Explorer",properties:{ExplorerId:"ExplorerId",NetworkId:"NetworkId",IsBackup:"IsBackup",Endpoints:"Endpoints",Name:"Name"}},d=e=>{e.createTable(l.name).addColumn(l.properties.ExplorerId,i.Type.INTEGER).addColumn(l.properties.NetworkId,i.Type.INTEGER).addColumn(l.properties.IsBackup,i.Type.BOOLEAN).addColumn(l.properties.Endpoints,i.Type.OBJECT).addColumn(l.properties.Name,i.Type.STRING).addPrimaryKey([l.properties.ExplorerId]).addIndex("Explorer_IsBackup_Index",[l.properties.IsBackup],!1).addForeignKey("Explorer_NetworkId",{local:l.properties.NetworkId,ref:`${s.h6.name}.${s.h6.properties.NetworkId}`,action:i.ConstraintAction.CASCADE}),e.createTable(o.name).addColumn(o.properties.PreferredExplorerId,i.Type.INTEGER).addColumn(o.properties.ExplorerId,i.Type.INTEGER).addColumn(o.properties.NetworkId,i.Type.INTEGER).addPrimaryKey([o.properties.PreferredExplorerId],!0).addUnique("PreferredExplorer_NetworkId_Unique",[o.properties.NetworkId]).addForeignKey("PreferredExplorer_ExplorerId",{local:o.properties.ExplorerId,ref:`${l.name}.${l.properties.ExplorerId}`,action:i.ConstraintAction.CASCADE}).addForeignKey("PreferredExplorer_NetworkId",{local:o.properties.NetworkId,ref:`${s.h6.name}.${s.h6.properties.NetworkId}`,action:i.ConstraintAction.CASCADE})}},78741:(e,t,a)=>{"use strict";a.d(t,{E:()=>n,C:()=>i});var r=a(47197);const n={name:"TxMemo",properties:{WalletId:"WalletId",Content:"Content",Digest:"Digest",TransactionHash:"TransactionHash",LastUpdated:"LastUpdated"}},i=e=>{e.createTable(n.name).addColumn(n.properties.WalletId,r.Type.STRING).addColumn(n.properties.Content,r.Type.STRING).addColumn(n.properties.TransactionHash,r.Type.STRING).addColumn(n.properties.Digest,r.Type.NUMBER).addColumn(n.properties.LastUpdated,r.Type.DATE_TIME).addPrimaryKey([n.properties.WalletId,n.properties.Digest])}},6144:(e,t,a)=>{"use strict";a.d(t,{y:()=>d});var r=a(56474),n=a.n(r),i=a(87672),s=a.n(i),o=a(75809),l=a(57421);class d{static async getAllPrices(e,t){return await(0,l.go)(e,t,d.ownTables[o.x.name].name)}}s()(d,"ownTables",n()({[o.x.name]:o.x})),s()(d,"depTables",n()({}))},34642:(e,t,a)=>{"use strict";a.d(t,{z:()=>d});var r=a(56474),n=a.n(r),i=a(87672),s=a.n(i),o=a(75809),l=a(57421);class d{static async upsertPrices(e,t,a){return await(0,l.GB)(e,t,a,d.ownTables[o.x.name].name)}}s()(d,"ownTables",n()({[o.x.name]:o.x})),s()(d,"depTables",n()({}))},75809:(e,t,a)=>{"use strict";a.d(t,{x:()=>n,D:()=>i});var r=a(47197);const n={name:"PriceData",properties:{From:"From",To:"To",Time:"Time",Price:"Price"}},i=e=>{e.createTable(n.name).addColumn(n.properties.From,r.Type.NUMBER).addColumn(n.properties.To,r.Type.STRING).addColumn(n.properties.Time,r.Type.DATE_TIME).addColumn(n.properties.Price,r.Type.NUMBER).addPrimaryKey([n.properties.From,n.properties.To,n.properties.Time])}},39845:(e,t,a)=>{"use strict";a.d(t,{t$:()=>B,RN:()=>_,Ff:()=>L,t9:()=>O,Ud:()=>M,tu:()=>U,qV:()=>W,q8:()=>H,LY:()=>j,Uq:()=>q,Ey:()=>z,Lq:()=>$,CT:()=>V,V7:()=>Z,YT:()=>Y,qr:()=>J});var r=a(56474),n=a.n(r),i=a(47302),s=a.n(i),o=a(89400),l=a.n(o),d=a(69301),c=a.n(d),u=a(66419),p=a.n(u),h=a(77766),y=a.n(h),w=a(97093),v=a.n(w),f=a(39392),I=a.n(f),T=a(32366),g=a.n(T),m=a(2991),b=a.n(m),D=a(86902),k=a.n(D),x=a(78914),C=a.n(x),P=a(87672),A=a.n(P),E=a(47197),S=a.n(E),K=a(38079),G=a(90691),N=a(17625),R=a(57421);class B{static async getOrInitial(e,t,a){var r;const n=await(0,R.HI)(e,t,0,B.ownTables[G.VZ.name].name,B.ownTables[G.VZ.name].properties.EncryptionMetaId);if(null==n)return a;const i={...n};return C()(r=k()(i)).call(r,(e=>{null==i[e]&&(i[e]=a[e])})),i}static async get(e,t){const a=await(0,R.HI)(e,t,0,B.ownTables[G.VZ.name].name,B.ownTables[G.VZ.name].properties.EncryptionMetaId);if(void 0===a)throw new Error("GetEncryptionMeta::get no encryption meta found");return a}}A()(B,"ownTables",n()({[G.VZ.name]:G.VZ})),A()(B,"depTables",n()({}));class _{static async get(e,t,a){return await(0,R.HI)(e,t,a,_.ownTables[G.tk.name].name,_.ownTables[G.tk.name].properties.KeyId)}}A()(_,"ownTables",n()({[G.tk.name]:G.tk})),A()(_,"depTables",n()({}));class L{static async byIds(e,t,a){return await(0,R.q$)(e,t,L.ownTables[G.x4.name].name,L.ownTables[G.x4.name].properties.BlockId,a)}static async byDigests(e,t,a){return await(0,R.q$)(e,t,L.ownTables[G.x4.name].name,L.ownTables[G.x4.name].properties.Digest,a)}}A()(L,"ownTables",n()({[G.x4.name]:G.x4})),A()(L,"depTables",n()({}));class O{static async getById(e,t,a){return await(0,R.q$)(e,t,O.ownTables[G.vQ.name].name,O.ownTables[G.vQ.name].properties.AddressId,a)}static async getByHash(e,t,a){const{AddressSeed:r}=await O.depTables.GetEncryptionMeta.get(e,t),n=b()(a).call(a,(e=>(0,N.a)(e,r)));return await(0,R.q$)(e,t,O.ownTables[G.vQ.name].name,O.ownTables[G.vQ.name].properties.Digest,n)}static async fromCanonical(e,t,a,r){const n=O.ownTables[G.qG.name],i=e.getSchema().table(n.name),s=O.ownTables[G.vQ.name],o=e.getSchema().table(s.name),l=e.select().from(i).innerJoin(o,E.op.and(i[n.properties.AddressId].eq(o[s.properties.AddressId]),...null!=r?[o[s.properties.Type].in(r)]:[])).where(i[n.properties.KeyDerivationId].in(a)),d=await t.attach(l);return g()(d).call(d,((e,t)=>{const a=e.get(t.AddressMapping.KeyDerivationId)||[];return e.set(t.AddressMapping.KeyDerivationId,[...a,t.Address]),e}),new(I()))}static async getKeyForFamily(e,t,a){const r=await(0,R.HI)(e,t,a,O.ownTables[G.qG.name].name,O.ownTables[G.qG.name].properties.AddressId);return void 0===r?r:r.KeyDerivationId}}A()(O,"ownTables",n()({[G.vQ.name]:G.vQ,[G.qG.name]:G.qG})),A()(O,"depTables",n()({GetEncryptionMeta:B}));class M{static async get(e,t,a,r){const n=M.ownTables[G.aq.name],i=e.getSchema().table(n.name),s=[i[n.properties.Index].eq(r),i[n.properties.Parent].eq(a)],o=e.select().from(i).where(E.op.and(...s)),l=await t.attach(o);return 1===l.length?l[0]:void 0}}A()(M,"ownTables",n()({[G.aq.name]:G.aq})),A()(M,"depTables",n()({}));class U{static async get(e,t,a,r,n){const i=await U.depTables.GetChildIfExists.get(e,t,r,n);if(void 0!==i)return{derivation:i,levelSpecific:await a(i.KeyDerivationId)}}}A()(U,"ownTables",n()({})),A()(U,"depTables",n()({GetChildIfExists:M}));class W{static async get(e,t,a){return await(0,R.HI)(e,t,a,W.ownTables[G.aq.name].name,W.ownTables[G.aq.name].properties.KeyDerivationId)}}A()(W,"ownTables",n()({[G.aq.name]:G.aq})),A()(W,"depTables",n()({}));class H{static async getParentPath(e,t,a){const r=[a.startingKey];for(let n=0;n<a.numLevels;n++){const a=r[r.length-1].Parent;if(null===a)throw new Error("GetDerivationsByPath::getParentPath unexpected end");const n=await H.depTables.GetKeyDerivation.get(e,t,a);if(void 0===n)throw new Error("GetDerivationsByPath::getParentPath parent not found");r.push(n)}return v()(r).call(r)}static async getSinglePath(e,t,a,r){if(0===r.length)throw new Error("GetDerivationsByPath::getSinglePath empty path");let n=a;const i=[];for(const a of r){const s=await H.depTables.GetChildIfExists.get(e,t,n,r[a]);if(void 0===s)throw new Error("GetDerivationsByPath::getSinglePath no path from"+n+" to "+a);i.push(s),n=s.KeyDerivationId}return i}static async getTree(e,t,a,r,n){const i=new(I())([[a,r]]);return await F(e,t,i,n?y()(r).call(r,n):void 0,r.length)}static async allFromRoot(e,t,a){const r=await H.depTables.GetKeyDerivation.get(e,t,a);if(void 0===r)throw new Error("GetDerivationsByPath::getParentPath root not found");const n=[];let i=[r];const s=H.ownTables[G.aq.name],o=e.getSchema().table(s.name);for(;0!==i.length;){n.push(...i);const a=e.select().from(o).where(o[s.properties.Parent].in(b()(i).call(i,(e=>e.KeyDerivationId))));i=await t.attach(a)}return n}}A()(H,"ownTables",n()({[G.aq.name]:G.aq})),A()(H,"depTables",n()({GetChildIfExists:M,GetKeyDerivation:W}));const F=async(e,t,a,r,n)=>{if(r&&n===r.length)return a;const i=H.ownTables[G.aq.name],s=e.getSchema().table(i.name),o=[s[i.properties.Parent].in(p()(c()(a).call(a)))];r&&null!==r[n]&&o.push(s[i.properties.Index].eq(r[n]));const l=e.select().from(s).where(E.op.and(...o)),d=await t.attach(l),u=new(I())(b()(d).call(d,(e=>{if(null==e.Parent)throw new Error("bip44::_getDerivationsByPath Should never happen");const t=a.get(e.Parent);if(null==t)throw new Error("bip44::_getDerivationsByPath Should never happen");if(null===e.Index)throw new Error("bip44::_getDerivationsByPath null child index");return[e.KeyDerivationId,y()(t).call(t,[e.Index])]})));if(0===u.size){if(null==r)return a;throw new Error("bip44::_getDerivationsByPath no result")}return F(e,t,u,r,n+1)};class j{static async getPath(e,t,a,r){const n=await j.depTables.GetDerivationsByPath.getSinglePath(e,t,a.pubDeriverKeyDerivationId,a.pathToLevel),i=n[n.length-1];return{path:n,levelSpecific:await r(i.KeyDerivationId)}}static async getTree(e,t,a,r){const n=await H.getTree(e,t,a.startingDerivation,a.commonPrefix,a.queryPath);return{pathMap:n,rows:await r(p()(c()(n).call(n)))}}}A()(j,"ownTables",n()({})),A()(j,"depTables",n()({GetDerivationsByPath:H}));class q{static async get(e,t,a,r,n){const i=await q.depTables.GetKeyDerivation.get(e,t,a);if(void 0===i)throw new R.md("GetKeyForDerivation::get keyDerivationRow");let s,o;return r&&(s=null===i.PublicKeyId?null:await q.depTables.GetKey.get(e,t,i.PublicKeyId)),n&&(o=null===i.PrivateKeyId?null:await q.depTables.GetKey.get(e,t,i.PrivateKeyId)),{KeyDerivation:i,publicKey:s,privateKey:o}}}A()(q,"ownTables",n()({})),A()(q,"depTables",n()({GetKeyDerivation:W,GetKey:_}));class z{static async fromIds(e,t,a){return await(0,R.q$)(e,t,z.ownTables[G.p5.name].name,z.ownTables[G.p5.name].properties.TransactionId,a.ids)}static async withStatus(e,t,a){const r=z.ownTables[G.p5.name],n=e.getSchema().table(r.name),i=e.select().from(n).where(E.op.and(n[r.properties.TransactionId].in(a.txIds),n[r.properties.Status].in(a.status)));return await t.attach(i)}static async byDigest(e,t,a){const r=z.ownTables[G.p5.name],n=e.getSchema().table(r.name),i=e.select().from(n).where(E.op.and(n[r.properties.TransactionId].in(a.txIds),n[r.properties.Digest].in(a.digests))),s=await t.attach(i),o=new(I());for(const e of s)o.set(e.Hash,e);return o}}A()(z,"ownTables",n()({[G.p5.name]:G.p5})),A()(z,"depTables",n()({}));class ${static async gteHeight(e,t,a){const r=e.getSchema().table($.ownTables[G.p5.name].name),n=e.getSchema().table($.ownTables[G.x4.name].name),i=e.select().from(r).innerJoin(n,r[G.p5.properties.BlockId].eq(n[G.x4.properties.BlockId])).where(E.op.and(n[G.x4.properties.Height].gte(a.height),r[G.p5.properties.TransactionId].in(a.txIds)));return await t.attach(i)}static async firstSuccessTxBefore(e,t,a){const r=e.getSchema().table($.ownTables[G.p5.name].name),n=e.getSchema().table($.ownTables[G.x4.name].name),i=e.select().from(r).innerJoin(n,r[G.p5.properties.BlockId].eq(n[G.x4.properties.BlockId])).orderBy(n[G.x4.properties.Height],S().Order.DESC).orderBy(r[G.p5.properties.Ordinal],S().Order.DESC).where(E.op.and(n[G.x4.properties.Height].lt(a.height),r[G.p5.properties.TransactionId].in(a.txIds),r[G.p5.properties.Status].eq(K.YM.IN_BLOCK))).limit(1),s=await t.attach(i);if(0!==s.length)return s[0]}static async byTime(e,t,a){const r=$.ownTables[G.p5.name],n=$.ownTables[G.x4.name],i=e.getSchema().table(r.name),s=e.getSchema().table(n.name),o=e.select().from(i).leftOuterJoin(s,i[r.properties.BlockId].eq(s[n.properties.BlockId])).orderBy(i[r.properties.LastUpdateTime],S().Order.DESC).orderBy(i[r.properties.Ordinal],S().Order.DESC).where(E.op.and(i[r.properties.TransactionId].in(a.txIds)));null!=a.limit&&o.limit(a.limit),null!=a.skip&&o.skip(a.skip);const l=await t.attach(o);return b()(l).call(l,(e=>null===e.Block.BlockId?{Transaction:e.Transaction,Block:null}:e))}static async withStatus(e,t,a){const r=$.ownTables[G.p5.name],n=$.ownTables[G.x4.name],i=e.getSchema().table(r.name),s=e.getSchema().table(n.name),o=e.select().from(i).leftOuterJoin(s,i[r.properties.BlockId].eq(s[n.properties.BlockId])).orderBy(i[r.properties.LastUpdateTime],S().Order.DESC).where(E.op.and(i[r.properties.TransactionId].in(a.txIds),i[r.properties.Status].in(a.status))),l=await t.attach(o);return b()(l).call(l,(e=>null===e.Block.BlockId?{Transaction:e.Transaction,Block:null}:e))}}A()($,"ownTables",n()({[G.p5.name]:G.p5,[G.x4.name]:G.x4})),A()($,"depTables",n()({}));class V{static async forAddress(e,t,a){var r;const n=V.ownTables[G.H7.name],i=V.ownTables[G.M0.name],s=V.ownTables[G.p5.name],o=V.ownTables[G.x4.name],d=e.getSchema().table(n.name),c=e.getSchema().table(i.name),u=e.getSchema().table(s.name),h=e.getSchema().table(o.name),y=e.select().from(d).innerJoin(c,c[i.properties.CertificateId].eq(d[n.properties.CertificateId])).innerJoin(u,c[i.properties.TransactionId].eq(u[s.properties.TransactionId])).leftOuterJoin(h,u[s.properties.BlockId].eq(h[s.properties.BlockId])).where(d[n.properties.AddressId].in(a.addressIds)).orderBy(h[G.x4.properties.Height],S().Order.DESC).orderBy(u[G.p5.properties.Ordinal],S().Order.DESC).orderBy(u[G.M0.properties.Ordinal],S().Order.DESC),w=await t.attach(y),v=new(I());for(const e of w){const t=v.get(e.Certificate.CertificateId);null==t?v.set(e.Certificate.CertificateId,{relatedAddresses:[e.CertificateAddress],certificate:e.Certificate,transaction:e.Transaction,block:null==e.Block.BlockId?null:e.Block}):t.relatedAddresses.push(e.CertificateAddress)}return b()(r=p()(l()(v).call(v))).call(r,(e=>({...e})))}static async forTransactions(e,t,a){const r=V.ownTables[G.H7.name],n=V.ownTables[G.M0.name],i=e.getSchema().table(r.name),s=e.getSchema().table(n.name),o=e.select().from(s).leftOuterJoin(i,s[n.properties.CertificateId].eq(i[r.properties.CertificateId])).where(s[n.properties.TransactionId].in(a.txIds)),d=await t.attach(o),c=new(I());for(const e of d){const t=c.get(e.Certificate.CertificateId);null==t?c.set(e.Certificate.CertificateId,{relatedAddresses:null==e.CertificateAddress?[]:[e.CertificateAddress],certificate:e.Certificate}):null!=e.CertificateAddress&&t.relatedAddresses.push(e.CertificateAddress)}const u=new(I());for(const e of l()(c).call(c)){const t=u.get(e.certificate.TransactionId);null==t?u.set(e.certificate.TransactionId,[{...e}]):t.push({...e})}return u}}A()(V,"ownTables",n()({[G.H7.name]:G.H7,[G.M0.name]:G.M0,[G.p5.name]:G.p5,[G.x4.name]:G.x4})),A()(V,"depTables",n()({}));class Z{static async get(e,t){return await(0,R.go)(e,t,Z.ownTables[G.h6.name].name)}}A()(Z,"ownTables",n()({[G.h6.name]:G.h6})),A()(Z,"depTables",n()({}));class Y{static async all(e,t){return(0,R.go)(e,t,Y.ownTables[G.jU.name].name)}static async fromIds(e,t,a){return(0,R.q$)(e,t,Y.ownTables[G.jU.name].name,Y.ownTables[G.jU.name].properties.TokenId,a)}static async fromIdentifier(e,t,a){const{TokenSeed:r}=await Y.depTables.GetEncryptionMeta.get(e,t),n=b()(a).call(a,(e=>(0,N.a)(e,r)));return Y.fromDigest(e,t,n)}static async fromDigest(e,t,a){return await(0,R.q$)(e,t,Y.ownTables[G.jU.name].name,Y.ownTables[G.jU.name].properties.Digest,a)}}A()(Y,"ownTables",n()({[G.jU.name]:G.jU})),A()(Y,"depTables",n()({GetEncryptionMeta:B}));class J{static async nextTokenListId(e,t){const a=J.ownTables[G.hB.name],r=e.getSchema().table(a.name),n=e.select().from(r).orderBy(r[G.hB.properties.ListId],S().Order.DESC).limit(1),i=await t.attach(n);return i.length>=1?i[0].ListId+1:0}static async forListId(e,t,a){const r=await(0,R.q$)(e,t,J.ownTables[G.hB.name].name,J.ownTables[G.hB.name].properties.ListId,a.listIds),n=new(I());for(const e of r){var i;const{ListId:t}=e;if(null==t)continue;const a=null!==(i=n.get(t))&&void 0!==i?i:[];a.push(e),s()(a).call(a,((e,t)=>e.TokenListItemId-t.TokenListItemId)),n.set(t,a)}return n}static async join(e,t,a){var r;const n=J.ownTables[G.hB.name],i=J.ownTables[G.jU.name],o=e.getSchema().table(n.name),l=e.getSchema().table(i.name),d=e.select().from(o).innerJoin(l,o[n.properties.TokenId].eq(l[i.properties.TokenId])).where(E.op.and(o[n.properties.ListId].in(a.listIds),l[i.properties.NetworkId].eq(a.networkId))),c=await t.attach(d);return s()(r=[...c]).call(r,((e,t)=>e.TokenList.TokenListItemId-t.TokenList.TokenListItemId))}}A()(J,"ownTables",n()({[G.hB.name]:G.hB,[G.jU.name]:G.jU})),A()(J,"depTables",n()({}))},17625:(e,t,a)=>{"use strict";function r(e,t){let a=void 0===t?2166136261:t;for(let t=0,r=e.length;t<r;t++)a^=e.charCodeAt(t),a+=(a<<1)+(a<<4)+(a<<7)+(a<<8)+(a<<24);return a>>>0}function n(e,t){const a=new ArrayBuffer(8),n=new DataView(a),i=r(e,t),s=r(i.toString(16)+e,t),o=-1048577&i;return n.setInt32(0,o),n.setInt32(4,s),n.getFloat64(0)}a.d(t,{a:()=>n})},97143:(e,t,a)=>{"use strict";a.d(t,{f1:()=>x,ad:()=>P,S7:()=>A,O7:()=>E,HX:()=>S,BP:()=>K,XH:()=>G,lx:()=>N,h:()=>R,Wf:()=>B,$G:()=>_,xx:()=>L});var r=a(56474),n=a.n(r),i=a(47302),s=a.n(i),o=a(59340),l=a.n(o),d=a(39392),c=a.n(d),u=a(32366),p=a.n(u),h=a(89400),y=a.n(h),w=a(46423),v=a.n(w),f=a(2991),I=a.n(f),T=a(87672),g=a.n(T),m=a(90691),b=a(17625),D=a(57421),k=a(39845);class x{static async add(e,t,a){return await(0,D.wf)(e,t,a,x.ownTables[m.tk.name].name)}static async remove(e,t,a){return await(0,D.t5)(e,t,x.ownTables[m.tk.name].name,x.ownTables[m.tk.name].properties.KeyId,a)}static async update(e,t,a){return await(0,D.mX)(e,t,a,x.ownTables[m.tk.name].name)}}g()(x,"ownTables",n()({[m.tk.name]:m.tk})),g()(x,"depTables",n()({}));class C{static async getOrAdd(e,t,a){const r=await C.depTables.GetBlock.byDigests(e,t,[a.Digest]);for(const e of r)if(e.Hash===a.Hash)return e;return await(0,D.wf)(e,t,a,C.ownTables[m.x4.name].name)}}g()(C,"ownTables",n()({[m.x4.name]:m.x4})),g()(C,"depTables",n()({GetBlock:k.Ff}));class P{static async markAsUsed(e,t,a){var r,n;const i=await P.depTables.GetAddress.fromCanonical(e,t,a,void 0);(0,D.GB)(e,t,I()(r=v()(n=[...y()(i).call(i)]).call(n)).call(r,(e=>({...e,IsUsed:!0}))),P.ownTables[m.vQ.name].name)}static async addForeignByHash(e,t,a){const{AddressSeed:r}=await P.depTables.GetEncryptionMeta.get(e,t),n=I()(a).call(a,(e=>(0,b.a)(e.data,r)));return await(0,D.JY)(e,t,I()(a).call(a,((e,t)=>({Digest:n[t],Hash:e.data,Type:e.type,IsUsed:!1}))),P.ownTables[m.vQ.name].name)}static async addFromCanonicalByHash(e,t,a){const r=await P.addForeignByHash(e,t,I()(a).call(a,(e=>({data:e.data,type:e.type}))));return await(0,D.JY)(e,t,I()(a).call(a,((e,t)=>({KeyDerivationId:e.keyDerivationId,AddressId:r[t].AddressId}))),P.ownTables[m.qG.name].name),r}static async remove(e,t,a){return await(0,D.t5)(e,t,P.ownTables[m.vQ.name].name,P.ownTables[m.vQ.name].properties.AddressId,a)}}g()(P,"ownTables",n()({[m.vQ.name]:m.vQ,[m.qG.name]:m.qG})),g()(P,"depTables",n()({GetEncryptionMeta:k.t$,GetAddress:k.t9}));class A{static async upsert(e,t,a){return(await(0,D.GB)(e,t,[a],A.ownTables[m.VZ.name].name))[0]}}g()(A,"ownTables",n()({[m.VZ.name]:m.VZ})),g()(A,"depTables",n()({}));class E{static async add(e,t,a,r,n){const i=null===a.privateKeyInfo?null:await E.depTables.ModifyKey.add(e,t,a.privateKeyInfo),s=null===a.publicKeyInfo?null:await E.depTables.ModifyKey.add(e,t,a.publicKeyInfo),o=await(0,D.wf)(e,t,a.derivationInfo({private:i?i.KeyId:null,public:s?s.KeyId:null}),E.ownTables[m.aq.name].name);return{KeyDerivation:o,specificDerivationResult:await(0,D.wf)(e,t,await a.levelInfo({db:e,tx:t,lockedTables:r,keyDerivationId:o.KeyDerivationId}),n)}}}g()(E,"ownTables",n()({[m.aq.name]:m.aq})),g()(E,"depTables",n()({ModifyKey:x}));class S{static async getOrAdd(e,t,a,r,n,i,s){const o=null==a||null==r?void 0:await S.depTables.GetChildIfExists.get(e,t,a,r);if(void 0!==o){const a=(await(0,D.q$)(e,t,s,S.ownTables[m.aq.name].properties.KeyDerivationId,[o.KeyDerivationId]))[0];if(null==a)throw new D.md("GetOrAddDerivation::getOrAdd no derivation found. Should not happen");return{KeyDerivation:o,specificDerivationResult:a}}return await S.depTables.AddDerivation.add(e,t,n,i,s)}}g()(S,"ownTables",n()({[m.aq.name]:m.aq})),g()(S,"depTables",n()({AddDerivation:E,GetChildIfExists:k.Ud}));class K{static async addNew(e,t,a){const r=null!==a.block?await K.depTables.GetOrAddBlock.getOrAdd(e,t,a.block):null;return{block:r,transaction:await(0,D.wf)(e,t,a.transaction(null!=r?r.BlockId:null),K.ownTables[m.p5.name].name)}}static async updateExisting(e,t,a){const r=null!==a.block?await K.depTables.GetOrAddBlock.getOrAdd(e,t,a.block):null;return{block:r,transaction:await(0,D.mX)(e,t,a.transaction(null!=r?r.BlockId:null),K.ownTables[m.p5.name].name)}}static async updateStatus(e,t,a){await(0,D.mX)(e,t,{...a.transaction,Status:a.status},K.ownTables[m.p5.name].name)}}g()(K,"ownTables",n()({[m.p5.name]:m.p5})),g()(K,"depTables",n()({GetOrAddBlock:C}));class G{static async addNew(e,t,a){const r=await(0,D.wf)(e,t,a.certificate,G.ownTables[m.M0.name].name);return{certificate:r,relatedAddresses:await(0,D.JY)(e,t,a.relatedAddresses(r.CertificateId),G.ownTables[m.H7.name].name)}}}g()(G,"ownTables",n()({[m.M0.name]:m.M0,[m.H7.name]:m.H7})),g()(G,"depTables",n()({}));class N{static async remove(e,t,a){const r=await N.depTables.GetDerivationsByPath.allFromRoot(e,t,a.rootKeyId);await(0,D.t5)(e,t,N.ownTables[m.aq.name].name,N.ownTables[m.aq.name].properties.KeyDerivationId,I()(r).call(r,(e=>e.KeyDerivationId)));const n=p()(r).call(r,((e,t)=>(null!=t.PrivateKeyId&&e.push(t.PrivateKeyId),null!=t.PublicKeyId&&e.push(t.PublicKeyId),e)),[]);await N.depTables.ModifyKey.remove(e,t,n)}}g()(N,"ownTables",n()({[m.aq.name]:m.aq})),g()(N,"depTables",n()({GetDerivationsByPath:k.q8,ModifyKey:x}));class R{static async free(e,t){const a=R.ownTables[m.p5.name],r=R.ownTables[m.x4.name],n=e.getSchema().table(a.name),i=e.getSchema().table(r.name),s=e.select().from(i).leftOuterJoin(n,n[a.properties.BlockId].eq(i[r.properties.BlockId])),o=await t.attach(s),l=p()(o).call(o,((e,t)=>(null==t.Transaction.TransactionId&&e.push(t.Block),e)),[]);await(0,D.t5)(e,t,r.name,r.properties.BlockId,I()(l).call(l,(e=>e.BlockId)))}}g()(R,"ownTables",n()({[m.p5.name]:m.p5,[m.x4.name]:m.x4})),g()(R,"depTables",n()({}));class B{static async upsert(e,t,a){return await(0,D.GB)(e,t,a,B.ownTables[m.h6.name].name)}}g()(B,"ownTables",n()({[m.h6.name]:m.h6})),g()(B,"depTables",n()({}));class _{static async upsert(e,t,a){const r=[];{const{TokenSeed:i}=await _.depTables.GetEncryptionMeta.get(e,t),s=I()(a).call(a,(e=>({Digest:(0,b.a)(e.Identifier,i),...e}))),o=new(c());for(const e of s){var n;const t=null!==(n=o.get(e.Digest))&&void 0!==n?n:new(c());null==t.get(e.NetworkId)&&r.push(e),t.set(e.NetworkId,!0),o.set(e.Digest,t)}}const i=[],s=[],o=new(c());{const a=await _.depTables.GetToken.fromDigest(e,t,I()(r).call(r,(e=>e.Digest)));for(const e of a){var d;const t=null!==(d=o.get(e.Digest))&&void 0!==d?d:new(c());t.set(e.NetworkId,e),o.set(e.Digest,t)}}for(const e of r){var u;const t=null===(u=o.get(e.Digest))||void 0===u?void 0:u.get(e.NetworkId);null==t?s.push(e):l()(t.Metadata)!==l()(e.Metadata)||t.IsNFT!==e.IsNFT?void 0!==e.TokenId?s.push(e):s.push({...e,TokenId:t.TokenId}):i.push(t)}const p=await(0,D.GB)(e,t,s,_.ownTables[m.jU.name].name);return[...i,...p]}}g()(_,"ownTables",n()({[m.jU.name]:m.jU})),g()(_,"depTables",n()({GetEncryptionMeta:k.t$,GetToken:k.YT}));class L{static async upsert(e,t,a){var r;const n=await(0,D.GB)(e,t,a,L.ownTables[m.hB.name].name);return s()(r=[...n]).call(r,((e,t)=>e.TokenListItemId-t.TokenListItemId))}static async remove(e,t,a){return await(0,D.t5)(e,t,L.ownTables[m.hB.name].name,L.ownTables[m.hB.name].properties.ListId,a)}}g()(L,"ownTables",n()({[m.hB.name]:m.hB})),g()(L,"depTables",n()({}))},38079:(e,t,a)=>{"use strict";a.d(t,{hd:()=>i,dq:()=>s,YM:()=>o,cS:()=>l});var r=a(56474),n=a.n(r);const i={Cardano:""},s=n()({CARDANO_LEGACY:0,CARDANO_BASE:1,CARDANO_PTR:2,CARDANO_ENTERPRISE:3,CARDANO_REWARD:4}),o=n()({SUBMITTED:-4,NOT_IN_REMOTE:-3,ROLLBACK_FAIL:-2,FAIL_RESPONSE:-1,PENDING:0,IN_BLOCK:1}),l=n()({SIGNER:0,REWARD_ADDRESS:1,PLEDGE_ADDRESS:2,OPERATOR:3,OWNER:4,POOL_KEY:5})},90691:(e,t,a)=>{"use strict";a.d(t,{h6:()=>s,tk:()=>o,vQ:()=>l,VZ:()=>d,aq:()=>c,x4:()=>u,iU:()=>p,p5:()=>h,M0:()=>y,H7:()=>w,DW:()=>v,qG:()=>f,jU:()=>I,hB:()=>T,hs:()=>g});var r=a(56474),n=a.n(r),i=a(47197);const s={name:"Network",properties:{NetworkId:"NetworkId",NetworkName:"NetworkName",CoinType:"CoinType",Backend:"Backend",BaseConfig:"BaseConfig",Fork:"Fork"}},o={name:"Key",properties:{KeyId:"KeyId",Type:"Type",Hash:"Hash",IsEncrypted:"IsEncrypted",PasswordLastUpdate:"PasswordLastUpdate"}},l={name:"Address",properties:{AddressId:"AddressId",Digest:"Digest",Type:"Type",Hash:"Hash",IsUsed:"IsUsed"}},d={name:"EncryptionMeta",properties:{EncryptionMetaId:"EncryptionMetaId",AddressSeed:"AddressSeed",TransactionSeed:"TransactionSeed",BlockSeed:"BlockSeed",TokenSeed:"TokenSeed"}},c={name:"KeyDerivation",properties:{KeyDerivationId:"KeyDerivationId",PrivateKeyId:"PrivateKeyId",PublicKeyId:"PublicKeyId",Parent:"Parent",Index:"Index"}},u={name:"Block",properties:{BlockId:"BlockId",SlotNum:"SlotNum",Height:"Height",Digest:"Digest",Hash:"Hash",BlockTime:"BlockTime"}},p=n()({CardanoByron:0,CardanoShelley:1}),h={name:"Transaction",properties:{TransactionId:"TransactionId",Type:"Type",Digest:"Digest",Hash:"Hash",BlockId:"BlockId",Ordinal:"Ordinal",LastUpdateTime:"LastUpdateTime",Status:"Status",ErrorMessage:"ErrorMessage",Extra:"Extra"}},y={name:"Certificate",properties:{CertificateId:"CertificateId",TransactionId:"TransactionId",Ordinal:"Ordinal",Kind:"Kind",Payload:"Payload"}},w={name:"CertificateAddress",properties:{CertificateAddressId:"CertificateAddressId",CertificateId:"CertificateId",AddressId:"AddressId",Relation:"Relation"}},v={name:"CanonicalAddress",properties:{CanonicalAddressId:"CanonicalAddressId",KeyDerivationId:"KeyDerivationId"}},f={name:"AddressMapping",properties:{AddressMappingId:"AddressMappingId",KeyDerivationId:"KeyDerivationId",AddressId:"AddressId"}},I={name:"Token",properties:{TokenId:"TokenId",IsNFT:"IsNFT",IsDefault:"IsDefault",NetworkId:"NetworkId",Digest:"Digest",Identifier:"Identifier",Metadata:"Metadata"}},T={name:"TokenList",properties:{TokenListItemId:"TokenListItemId",ListId:"ListId",TokenId:"TokenId",Amount:"Amount"}},g=e=>{e.createTable(s.name).addColumn(s.properties.NetworkId,i.Type.INTEGER).addColumn(s.properties.NetworkName,i.Type.STRING).addColumn(s.properties.CoinType,i.Type.NUMBER).addColumn(s.properties.Backend,i.Type.OBJECT).addColumn(s.properties.BaseConfig,i.Type.OBJECT).addColumn(s.properties.Fork,i.Type.INTEGER).addPrimaryKey([s.properties.NetworkId]),e.createTable(o.name).addColumn(o.properties.KeyId,i.Type.INTEGER).addColumn(o.properties.Type,i.Type.INTEGER).addColumn(o.properties.Hash,i.Type.STRING).addColumn(o.properties.IsEncrypted,i.Type.BOOLEAN).addColumn(o.properties.PasswordLastUpdate,i.Type.DATE_TIME).addPrimaryKey([o.properties.KeyId],!0).addNullable([o.properties.PasswordLastUpdate]),e.createTable(l.name).addColumn(l.properties.AddressId,i.Type.INTEGER).addColumn(l.properties.Digest,i.Type.NUMBER).addColumn(l.properties.Type,i.Type.NUMBER).addColumn(l.properties.Hash,i.Type.STRING).addColumn(l.properties.IsUsed,i.Type.BOOLEAN).addPrimaryKey([l.properties.AddressId],!0).addIndex("Address_Digest_Index",[l.properties.Digest],!1).addIndex("Address_Type_Index",[l.properties.Type],!1),e.createTable(d.name).addColumn(d.properties.EncryptionMetaId,i.Type.INTEGER).addColumn(d.properties.AddressSeed,i.Type.INTEGER).addColumn(d.properties.TransactionSeed,i.Type.INTEGER).addColumn(d.properties.BlockSeed,i.Type.INTEGER).addColumn(d.properties.TokenSeed,i.Type.INTEGER).addPrimaryKey([d.properties.EncryptionMetaId],!1),e.createTable(c.name).addColumn(c.properties.KeyDerivationId,i.Type.INTEGER).addColumn(c.properties.PrivateKeyId,i.Type.INTEGER).addColumn(c.properties.PublicKeyId,i.Type.INTEGER).addColumn(c.properties.Parent,i.Type.INTEGER).addColumn(c.properties.Index,i.Type.INTEGER).addPrimaryKey([c.properties.KeyDerivationId],!0).addForeignKey("KeyDerivation_Parent",{local:c.properties.Parent,ref:`${c.name}.${c.properties.KeyDerivationId}`,timing:i.ConstraintTiming.DEFERRABLE}).addForeignKey("KeyDerivation_PrivateKeyId",{local:c.properties.PrivateKeyId,ref:`${o.name}.${o.properties.KeyId}`}).addForeignKey("KeyDerivation_PublicKeyId",{local:c.properties.PublicKeyId,ref:`${o.name}.${o.properties.KeyId}`}).addNullable([c.properties.PrivateKeyId,c.properties.PublicKeyId,c.properties.Parent,c.properties.Index]),e.createTable(u.name).addColumn(u.properties.BlockId,i.Type.INTEGER).addColumn(u.properties.SlotNum,i.Type.INTEGER).addColumn(u.properties.Height,i.Type.INTEGER).addColumn(u.properties.Digest,i.Type.NUMBER).addColumn(u.properties.Hash,i.Type.STRING).addColumn(u.properties.BlockTime,i.Type.DATE_TIME).addPrimaryKey([u.properties.BlockId],!0).addIndex("Block_Digest_Index",[u.properties.Digest],!1).addIndex("Block_Height_Index",[u.properties.Height],!1),e.createTable(h.name).addColumn(h.properties.TransactionId,i.Type.INTEGER).addColumn(h.properties.Type,i.Type.INTEGER).addColumn(h.properties.Digest,i.Type.NUMBER).addColumn(h.properties.Hash,i.Type.STRING).addColumn(h.properties.BlockId,i.Type.INTEGER).addColumn(h.properties.Ordinal,i.Type.INTEGER).addColumn(h.properties.LastUpdateTime,i.Type.NUMBER).addColumn(h.properties.Status,i.Type.INTEGER).addColumn(h.properties.ErrorMessage,i.Type.STRING).addColumn(h.properties.Extra,i.Type.OBJECT).addPrimaryKey([h.properties.TransactionId],!0).addForeignKey("Transaction_Block",{local:h.properties.BlockId,ref:`${u.name}.${u.properties.BlockId}`}).addNullable([h.properties.BlockId,h.properties.Ordinal,h.properties.ErrorMessage,h.properties.Extra]).addIndex("Transaction_Digest_Index",[h.properties.Digest],!1),e.createTable(v.name).addColumn(v.properties.CanonicalAddressId,i.Type.INTEGER).addColumn(v.properties.KeyDerivationId,i.Type.INTEGER).addPrimaryKey([v.properties.CanonicalAddressId],!0).addForeignKey("CanonicalAddress_KeyDerivation",{local:v.properties.KeyDerivationId,ref:`${c.name}.${c.properties.KeyDerivationId}`,action:i.ConstraintAction.CASCADE}).addIndex("CanonicalAddress_KeyDerivation_Index",[v.properties.KeyDerivationId],!0),e.createTable(f.name).addColumn(f.properties.AddressMappingId,i.Type.INTEGER).addColumn(f.properties.KeyDerivationId,i.Type.INTEGER).addColumn(f.properties.AddressId,i.Type.INTEGER).addPrimaryKey([f.properties.AddressMappingId],!0).addForeignKey("AddressMapping_KeyDerivation",{local:f.properties.KeyDerivationId,ref:`${c.name}.${c.properties.KeyDerivationId}`,action:i.ConstraintAction.CASCADE}).addForeignKey("AddressMapping_Address",{local:f.properties.AddressId,ref:`${l.name}.${l.properties.AddressId}`,action:i.ConstraintAction.CASCADE}).addIndex("AddressMapping_KeyDerivation_Index",[f.properties.KeyDerivationId],!1),e.createTable(y.name).addColumn(y.properties.CertificateId,i.Type.INTEGER).addColumn(y.properties.TransactionId,i.Type.INTEGER).addColumn(y.properties.Ordinal,i.Type.INTEGER).addColumn(y.properties.Kind,i.Type.INTEGER).addColumn(y.properties.Payload,i.Type.STRING).addPrimaryKey([y.properties.CertificateId],!0).addForeignKey("Certificate_Transaction",{local:y.properties.TransactionId,ref:`${h.name}.${h.properties.TransactionId}`,action:i.ConstraintAction.CASCADE}).addIndex("Certificate_Transaction_Index",[y.properties.TransactionId],!1),e.createTable(w.name).addColumn(w.properties.CertificateAddressId,i.Type.INTEGER).addColumn(w.properties.CertificateId,i.Type.INTEGER).addColumn(w.properties.AddressId,i.Type.INTEGER).addColumn(w.properties.Relation,i.Type.INTEGER).addPrimaryKey([w.properties.CertificateAddressId],!0).addForeignKey("CertificateAddress_Certificate",{local:w.properties.CertificateId,ref:`${y.name}.${y.properties.CertificateId}`,action:i.ConstraintAction.CASCADE}).addForeignKey("CertificateAddress_Address",{local:w.properties.AddressId,ref:`${l.name}.${l.properties.AddressId}`}).addIndex("CertificateAddress_Certificate_Index",[w.properties.CertificateId],!1).addIndex("Address_Transaction_Index",[w.properties.AddressId],!1),e.createTable(I.name).addColumn(I.properties.TokenId,i.Type.INTEGER).addColumn(I.properties.NetworkId,i.Type.INTEGER).addColumn(I.properties.IsDefault,i.Type.BOOLEAN).addColumn("IsNFT",i.Type.BOOLEAN).addColumn(I.properties.Identifier,i.Type.STRING).addColumn(I.properties.Digest,i.Type.NUMBER).addColumn(I.properties.Metadata,i.Type.OBJECT).addPrimaryKey([I.properties.TokenId],!0).addForeignKey("Token_Network",{local:I.properties.NetworkId,ref:`${s.name}.${s.properties.NetworkId}`,action:i.ConstraintAction.CASCADE}).addIndex("Token_Digest",[I.properties.Digest],!1),e.createTable(T.name).addColumn(T.properties.TokenListItemId,i.Type.INTEGER).addColumn(T.properties.ListId,i.Type.INTEGER).addColumn(T.properties.TokenId,i.Type.INTEGER).addColumn(T.properties.Amount,i.Type.STRING).addPrimaryKey([T.properties.TokenListItemId],!0).addForeignKey("TokenList_Token",{local:T.properties.TokenId,ref:`${I.name}.${I.properties.TokenId}`}).addIndex("TokenList_ListId",[T.properties.ListId],!1)}},85339:(e,t,a)=>{"use strict";a.d(t,{KN:()=>g});var r=a(56474),n=a.n(r),i=a(39392),s=a.n(i),o=a(2991),l=a.n(o),d=a(36384),c=a.n(d),u=a(66419),p=a.n(u),h=a(87672),y=a.n(h),w=a(96486),v=a(93621),f=a(57421);class I{static async fromAddressIds(e,t,a){const r=I.ownTables[v.Qb.name];return await(0,f.q$)(e,t,r.name,r.properties.AddressId,a.ids)}static async fromTxIds(e,t,a){const r=I.ownTables[v.Qb.name];return await(0,f.q$)(e,t,r.name,r.properties.TransactionId,a.ids)}}y()(I,"ownTables",n()({[v.Qb.name]:v.Qb})),y()(I,"depTables",n()({}));class T{static async fromAddressIds(e,t,a){const r=T.ownTables[v.Gm.name];return await(0,f.q$)(e,t,r.name,r.properties.AddressId,a.ids)}static async fromTxIds(e,t,a){const r=T.ownTables[v.Gm.name];return await(0,f.q$)(e,t,r.name,r.properties.TransactionId,a.ids)}}y()(T,"ownTables",n()({[v.Gm.name]:v.Gm})),y()(T,"depTables",n()({}));class g{static async getTxIdsForAddresses(e,t,a){const r=await g.depTables.GetAccountingInputs.fromAddressIds(e,t,{ids:a.addressIds}),n=await g.depTables.GetAccountingOutputs.fromAddressIds(e,t,{ids:a.addressIds});return p()(new(c())([...l()(r).call(r,(e=>e.TransactionId)),...l()(n).call(n,(e=>e.TransactionId))]))}static async getIOsForTx(e,t,a){var r;const n=l()(r=a.txs).call(r,(e=>e.TransactionId)),i=await g.depTables.GetAccountingInputs.fromTxIds(e,t,{ids:n}),o=await g.depTables.GetAccountingOutputs.fromTxIds(e,t,{ids:n}),d=(0,w.groupBy)(i,(e=>e.TransactionId)),c=(0,w.groupBy)(o,(e=>e.TransactionId)),u=new(s());for(const e of a.txs)u.set(e,{accountingInputs:d[e.TransactionId]||[],accountingOutputs:c[e.TransactionId]||[]});return u}}y()(g,"ownTables",n()({})),y()(g,"depTables",n()({GetAccountingInputs:I,GetAccountingOutputs:T}))},78740:(e,t,a)=>{"use strict";a.d(t,{i:()=>d});var r=a(56474),n=a.n(r),i=a(87672),s=a.n(i),o=a(93621),l=a(57421);class d{static async addIOsToTx(e,t,a){const{accountingInputs:r,accountingOutputs:n}=a;return{accountingInputs:await(0,l.JY)(e,t,r,d.ownTables[o.Qb.name].name),accountingOutputs:await(0,l.JY)(e,t,n,d.ownTables[o.Gm.name].name)}}}s()(d,"ownTables",n()({[o.Qb.name]:o.Qb,[o.Gm.name]:o.Gm})),s()(d,"depTables",n()({}))},93621:(e,t,a)=>{"use strict";a.d(t,{Qb:()=>i,Gm:()=>s,j6:()=>o});var r=a(47197),n=a(90691);const i={name:"AccountingTransactionInput",properties:{AccountingTransactionInputId:"AccountingTransactionInputId",TransactionId:"TransactionId",AddressId:"AddressId",SpendingCounter:"SpendingCounter",IndexInOwnTx:"IndexInOwnTx",TokenListId:"TokenListId"}},s={name:"AccountingTransactionOutput",properties:{AccountingTransactionOutputId:"AccountingTransactionOutputId",TransactionId:"TransactionId",AddressId:"AddressId",OutputIndex:"OutputIndex",TokenListId:"TokenListId"}},o=e=>{e.createTable(i.name).addColumn(i.properties.AccountingTransactionInputId,r.Type.INTEGER).addColumn(i.properties.TransactionId,r.Type.INTEGER).addColumn(i.properties.AddressId,r.Type.INTEGER).addColumn(i.properties.SpendingCounter,r.Type.INTEGER).addColumn(i.properties.IndexInOwnTx,r.Type.INTEGER).addColumn(i.properties.TokenListId,r.Type.INTEGER).addPrimaryKey([i.properties.AccountingTransactionInputId],!0).addForeignKey("AccountingTransactionInput_Transaction",{local:i.properties.TransactionId,ref:`${n.p5.name}.${n.p5.properties.TransactionId}`,action:r.ConstraintAction.CASCADE}).addForeignKey("AccountingTransactionInput_Address",{local:i.properties.AddressId,ref:`${n.vQ.name}.${n.vQ.properties.AddressId}`}),e.createTable(s.name).addColumn(s.properties.AccountingTransactionOutputId,r.Type.INTEGER).addColumn(s.properties.TransactionId,r.Type.INTEGER).addColumn(s.properties.AddressId,r.Type.INTEGER).addColumn(s.properties.OutputIndex,r.Type.INTEGER).addColumn(s.properties.TokenListId,r.Type.INTEGER).addPrimaryKey([s.properties.AccountingTransactionOutputId],!0).addForeignKey("AccountingTransactionOutput_Transaction",{local:s.properties.TransactionId,ref:`${n.p5.name}.${n.p5.properties.TransactionId}`,action:r.ConstraintAction.CASCADE}).addForeignKey("AccountingTransactionOutput_Address",{local:s.properties.AddressId,ref:`${n.vQ.name}.${n.vQ.properties.AddressId}`})}},75697:(e,t,a)=>{"use strict";a.d(t,{X:()=>v,K:()=>f});var r=a(56474),n=a.n(r),i=a(2991),s=a.n(i),o=a(80426),l=a.n(o),d=a(87672),c=a.n(d),u=a(90691),p=a(39845),h=a(85339),y=a(82982);const w=function(e){if(null==e)throw new Error("getOrThrow no tx part found. Should never happen");return e};class v{static async getIOsForTx(e,t,a){var r,n;const i=await v.depTables.AssociateTxWithUtxoIOs.getIOsForTx(e,t,{txs:a.txs}),o=await v.depTables.AssociateToken.join(e,t,{listIds:l()(r=a.txs).call(r,(e=>{var t,a;const r=w(i.get(e));return[...s()(t=r.utxoInputs).call(t,(e=>e.TokenListId)),...s()(a=r.utxoOutputs).call(a,(e=>e.TokenListId))]})),networkId:a.networkId});return s()(n=a.txs).call(n,(e=>({txType:u.iU.CardanoByron,transaction:e,...w(i.get(e)),tokens:s()(o).call(o,(e=>({TokenList:e.TokenList,Token:{TokenId:e.Token.TokenId,Identifier:e.Token.Identifier,NetworkId:e.Token.NetworkId}})))})))}}c()(v,"ownTables",n()({})),c()(v,"depTables",n()({AssociateTxWithUtxoIOs:y.zb,AssociateToken:p.qr}));class f{static async getIOsForTx(e,t,a){var r,n,i;const{depTables:o}=f,d=await o.AssociateTxWithUtxoIOs.getIOsForTx(e,t,{txs:a.txs}),c=await o.AssociateTxWithAccountingIOs.getIOsForTx(e,t,{txs:a.txs}),p=await o.GetCertificates.forTransactions(e,t,{txIds:s()(r=a.txs).call(r,(e=>e.TransactionId))}),h=await v.depTables.AssociateToken.join(e,t,{listIds:l()(n=a.txs).call(n,(e=>{var t,a,r,n;const i=w(d.get(e)),o=w(c.get(e));return[...s()(t=i.utxoInputs).call(t,(e=>e.TokenListId)),...s()(a=i.utxoOutputs).call(a,(e=>e.TokenListId)),...s()(r=o.accountingInputs).call(r,(e=>e.TokenListId)),...s()(n=o.accountingOutputs).call(n,(e=>e.TokenListId))]})),networkId:a.networkId}),y=s()(h).call(h,(e=>({TokenList:e.TokenList,Token:{TokenId:e.Token.TokenId,Identifier:e.Token.Identifier,NetworkId:e.Token.NetworkId}})));return s()(i=a.txs).call(i,(e=>{var t;return{txType:u.iU.CardanoShelley,transaction:e,certificates:null!==(t=p.get(e.TransactionId))&&void 0!==t?t:[],...w(d.get(e)),accountingInputs:w(c.get(e)).accountingInputs,tokens:y}}))}}c()(f,"ownTables",n()({})),c()(f,"depTables",n()({AssociateTxWithUtxoIOs:y.zb,GetCertificates:p.CT,AssociateTxWithAccountingIOs:h.KN,AssociateToken:p.qr}))},68680:(e,t,a)=>{"use strict";a.d(t,{WF:()=>i,eM:()=>s,fG:()=>o});var r=a(47197),n=a(90691);const i={name:"UtxoTransactionInput",properties:{UtxoTransactionInputId:"UtxoTransactionInputId",TransactionId:"TransactionId",AddressId:"AddressId",ParentTxHash:"ParentTxHash",IndexInParentTx:"IndexInParentTx",IndexInOwnTx:"IndexInOwnTx",TokenListId:"TokenListId"}},s={name:"UtxoTransactionOutput",properties:{UtxoTransactionOutputId:"UtxoTransactionOutputId",TransactionId:"TransactionId",AddressId:"AddressId",OutputIndex:"OutputIndex",TokenListId:"TokenListId",IsUnspent:"IsUnspent",ErgoBoxId:"ErgoBoxId",ErgoCreationHeight:"ErgoCreationHeight",ErgoTree:"ErgoTree",ErgoRegisters:"ErgoRegisters"}},o=e=>{e.createTable(i.name).addColumn(i.properties.UtxoTransactionInputId,r.Type.INTEGER).addColumn(i.properties.TransactionId,r.Type.INTEGER).addColumn(i.properties.AddressId,r.Type.INTEGER).addColumn(i.properties.ParentTxHash,r.Type.STRING).addColumn(i.properties.IndexInParentTx,r.Type.INTEGER).addColumn(i.properties.IndexInOwnTx,r.Type.INTEGER).addColumn(s.properties.TokenListId,r.Type.INTEGER).addPrimaryKey([i.properties.UtxoTransactionInputId],!0).addForeignKey("UtxoTransactionInput_Transaction",{local:i.properties.TransactionId,ref:`${n.p5.name}.${n.p5.properties.TransactionId}`,action:r.ConstraintAction.CASCADE}).addForeignKey("UtxoTransactionInput_Address",{local:i.properties.AddressId,ref:`${n.vQ.name}.${n.vQ.properties.AddressId}`}),e.createTable(s.name).addColumn(s.properties.UtxoTransactionOutputId,r.Type.INTEGER).addColumn(s.properties.TransactionId,r.Type.INTEGER).addColumn(s.properties.AddressId,r.Type.INTEGER).addColumn(s.properties.OutputIndex,r.Type.INTEGER).addColumn(s.properties.TokenListId,r.Type.INTEGER).addColumn(s.properties.IsUnspent,r.Type.BOOLEAN).addColumn(s.properties.ErgoBoxId,r.Type.STRING).addColumn(s.properties.ErgoCreationHeight,r.Type.NUMBER).addColumn(s.properties.ErgoTree,r.Type.STRING).addColumn(s.properties.ErgoRegisters,r.Type.STRING).addPrimaryKey([s.properties.UtxoTransactionOutputId],!0).addForeignKey("UtxoTransactionOutput_Transaction",{local:s.properties.TransactionId,ref:`${n.p5.name}.${n.p5.properties.TransactionId}`,action:r.ConstraintAction.CASCADE}).addForeignKey("UtxoTransactionOutput_Address",{local:s.properties.AddressId,ref:`${n.vQ.name}.${n.vQ.properties.AddressId}`}).addNullable([s.properties.ErgoBoxId,s.properties.ErgoCreationHeight,s.properties.ErgoTree,s.properties.ErgoRegisters])}},57421:(e,t,a)=>{"use strict";a.d(t,{v_:()=>m,go:()=>b,JY:()=>D,wf:()=>k,GB:()=>x,mX:()=>C,HI:()=>P,q$:()=>A,t5:()=>E,md:()=>S,zm:()=>K,pS:()=>G,Hz:()=>N,fO:()=>R});var r=a(77766),n=a.n(r),i=a(86902),s=a.n(i),o=a(59340),l=a.n(o),d=a(36384),c=a.n(d),u=a(66419),p=a.n(u),h=a(89400),y=a.n(h),w=a(2991),v=a.n(w),f=a(93476),I=a.n(f),T=a(96486),g=a(27216);async function m(e){return await new(I())(((t,a)=>{e.onsuccess=()=>t(e.result),e.onerror=()=>a()}))}async function b(e,t,a){const r=e.getSchema().table(a),n=e.select().from(r);return await t.attach(n)}async function D(e,t,a,r){var n;const i=e.getSchema().table(r),s=v()(a).call(a,(e=>i.createRow(e)));return await t.attach(y()(n=e.insert().into(i)).call(n,s))}async function k(e,t,a,r){return(await D(e,t,[a],r))[0]}async function x(e,t,a,r){var n;const i=e.getSchema().table(r),s=v()(a).call(a,(e=>i.createRow(e)));return await t.attach(y()(n=e.insertOrReplace().into(i)).call(n,s))}async function C(e,t,a,r){return(await x(e,t,[a],r))[0]}const P=async(e,t,a,r,n)=>{const i=e.getSchema().table(r),s=e.select().from(i).where(i[n].eq(a)),o=await t.attach(s);if(0!==o.length)return o[0]};async function A(e,t,a,r,n){const i=e.getSchema().table(a),s=e.select().from(i).where(i[r].in(n));return await t.attach(s)}async function E(e,t,a,r,n){const i=e.getSchema().table(a);await t.attach(e.delete().from(i).where(i[r].in(n)))}class S extends g.Z{constructor(e="Storage query using stale data"){super(e)}}async function K(e,t,a){const r=e.createTransaction();await r.begin(t);try{const e=await a(r);return await r.commit(),e}catch(e){const a=p()(new(c())(v()(t).call(t,(e=>e.getName())))).join("\n");throw console.error("rolling back Lovefield query for\n"+a+" with error "+l()(e)),await r.rollback(),e}}function G(e,t){var a;return v()(a=p()(y()(t).call(t))).call(a,(t=>e.getSchema().table(t)))}function N(e,t){var a;return v()(a=B(t)).call(a,(t=>e.getSchema().table(t)))}function R(...e){const t=[];for(const a of e)t.push(...B(a));return new(c())(t)}function B(e){var t,a,r,i;if(void 0===e)throw new Error("Found undefined table. Probably a static initialization order issue");const o=v()(t=v()(a=s()(e.ownTables)).call(a,(t=>e.ownTables[t]))).call(t,(e=>e.name));return 0===(0,T.size)(e.depTables)?o:n()(o).call(o,...v()(r=v()(i=s()(e.depTables)).call(i,(t=>e.depTables[t]))).call(r,(e=>B(e))))}},52776:(e,t,a)=>{"use strict";a.d(t,{r:()=>p,S:()=>h});var r=a(56474),n=a.n(r),i=a(2991),s=a.n(i),o=a(87672),l=a.n(o),d=a(47197),c=a(57421),u=a(85029);class p{static forWallet(e,t,a){return(0,c.HI)(e,t,a,p.ownTables[u.lR.name].name,p.ownTables[u.lR.name].properties.PublicDeriverId)}}l()(p,"ownTables",n()({[u.lR.name]:u.lR})),l()(p,"depTables",n()({}));class h{static async forWallet(e,t,a){const r=await(0,c.q$)(e,t,h.ownTables[u.S$.name].name,h.ownTables[u.S$.name].properties.PublicDeriverId,[a]);return s()(r).call(r,(e=>({lastBestBlockHash:e.lastBestBlockHash,spentUtxoIds:e.spentUtxoIds,newUtxos:e.newUtxos})))}static async findLastBestBlockHash(e,t,a,r){const n=h.ownTables[u.S$.name],i=e.getSchema().table(n.name),s=e.select().from(i).where(d.op.and(i[n.properties.PublicDeriverId].eq(a),i[n.properties.lastBestBlockHash].eq(r))),o=await t.attach(s);if(0!==o.length)return{lastBestBlockHash:o[0].lastBestBlockHash,spentUtxoIds:o[0].spentUtxoIds,newUtxos:o[0].newUtxos}}}l()(h,"ownTables",n()({[u.S$.name]:u.S$})),l()(h,"depTables",n()({}))},35072:(e,t,a)=>{"use strict";a.d(t,{I:()=>u,j:()=>p});var r=a(56474),n=a.n(r),i=a(87672),s=a.n(i),o=a(47197),l=a(57421),d=a(85029),c=a(52776);class u{static async addOrReplace(e,t,a,r){const n=await c.r.forWallet(e,t,a);if(n){const i={UtxoAtSafePointId:n.UtxoAtSafePointId,PublicDeriverId:a,UtxoAtSafePoint:r};await(0,l.mX)(e,t,i,u.ownTables[d.lR.name].name)}else await(0,l.wf)(e,t,{PublicDeriverId:a,UtxoAtSafePoint:r},u.ownTables[d.lR.name].name)}static async remove(e,t,a){await(0,l.t5)(e,t,u.ownTables[d.lR.name].name,u.ownTables[d.lR.name].properties.PublicDeriverId,[a])}}s()(u,"ownTables",n()({[d.lR.name]:d.lR})),s()(u,"depTables",n()({}));class p{static async removeAll(e,t,a){const r=p.ownTables[d.S$.name],n=r.name,i=r.properties,s=e.getSchema().table(n);await t.attach(e.delete().from(s).where(s[i.PublicDeriverId].eq(a)))}static async remove(e,t,a,r){const n=p.ownTables[d.S$.name],i=n.name,s=n.properties,l=e.getSchema().table(i);await t.attach(e.delete().from(l).where(o.op.and(l[s.PublicDeriverId].eq(a),l[s.lastBestBlockHash].eq(r))))}static async add(e,t,a,r){await c.S.findLastBestBlockHash(e,t,a,r.lastBestBlockHash)||await(0,l.wf)(e,t,{PublicDeriverId:a,lastBestBlockHash:r.lastBestBlockHash,spentUtxoIds:r.spentUtxoIds,newUtxos:r.newUtxos},p.ownTables[d.S$.name].name)}}s()(p,"ownTables",n()({[d.S$.name]:d.S$})),s()(p,"depTables",n()({}))},85029:(e,t,a)=>{"use strict";a.d(t,{lR:()=>i,S$:()=>s,tZ:()=>o});var r=a(47197),n=a(22261);const i={name:"UtxoAtSafePointTable",properties:{UtxoAtSafePointId:"UtxoAtSafePointId",PublicDeriverId:"PublicDeriverId",UtxoAtSafePoint:"UtxoAtSafePoint"}},s={name:"UtxoDiffToBestBlock",properties:{UtxoDiffToBestBlockId:"UtxoDiffToBestBlockId",PublicDeriverId:"PublicDeriverId",lastBestBlockHash:"lastBestBlockHash",spentUtxoIds:"spentUtxoIds",newUtxos:"newUtxos"}},o=e=>{e.createTable(i.name).addColumn(i.properties.UtxoAtSafePointId,r.Type.INTEGER).addColumn(i.properties.PublicDeriverId,r.Type.INTEGER).addColumn(i.properties.UtxoAtSafePoint,r.Type.OBJECT).addPrimaryKey([i.properties.UtxoAtSafePointId],!0).addForeignKey("UtxoAtSafePoint_PublicDeriver",{local:i.properties.PublicDeriverId,ref:`${n.zq.name}.${n.zq.properties.PublicDeriverId}`}).addIndex("UtxoAtSafePoint_PublicDeriver_Index",[i.properties.PublicDeriverId],!1),e.createTable(s.name).addColumn(s.properties.UtxoDiffToBestBlockId,r.Type.INTEGER).addColumn(s.properties.PublicDeriverId,r.Type.INTEGER).addColumn(s.properties.lastBestBlockHash,r.Type.STRING).addColumn(s.properties.spentUtxoIds,r.Type.OBJECT).addColumn(s.properties.newUtxos,r.Type.OBJECT).addPrimaryKey([s.properties.UtxoDiffToBestBlockId],!0).addForeignKey("UtxoDiffToBestBlock_PublicDeriver",{local:s.properties.PublicDeriverId,ref:`${n.zq.name}.${n.zq.properties.PublicDeriverId}`}).addIndex("UtxoDiffToBestBlock_PublicDeriver_Index",[s.properties.PublicDeriverId],!1).addIndex("UtxoDiffToBestBlock_PublicDeriver_lastBestBlockHash_Index",[s.properties.PublicDeriverId,s.properties.lastBestBlockHash],!0)}},52367:(e,t,a)=>{"use strict";a.d(t,{CZ:()=>b,lE:()=>D,I_:()=>k});var r,n,i,s,o,l=a(77766),d=a.n(l),c=a(80426),u=a.n(c),p=a(86902),h=a.n(p),y=a(2991),w=a.n(y),v=a(39392),f=a.n(v),I=a(56474),T=a.n(I),g=a(5733),m=a(90691);const b=T()({ROOT:{level:0,table:g.Ur,extra:[]},PURPOSE:{level:1,table:g.mb,extra:[]},COIN_TYPE:{level:2,table:g.y4,extra:[]},ACCOUNT:{level:3,table:g.A6,extra:[]},CHAIN:{level:4,table:g.jm,extra:[]},ADDRESS:{level:5,table:m.DW,extra:[m.qG,m.vQ,m.VZ]}}),D=new(f())([...w()(r=w()(n=h()(b)).call(n,(e=>b[e]))).call(r,(e=>[e.level,e.table.name])),...w()(i=u()(s=w()(o=h()(b)).call(o,(e=>b[e]))).call(s,(e=>e.extra))).call(i,((e,t)=>[1e3+t,e.name]))]);function k(e){const t=[];for(const r of e)if(null!=r.children){const e=k(r.children);for(const n of e){var a;t.push({path:d()(a=[r.index]).call(a,n.path),insert:n.insert})}}else t.push({path:[r.index],insert:r.insert});return t}},81369:(e,t,a)=>{"use strict";a.d(t,{_:()=>f,J:()=>I});var r=a(56474),n=a.n(r),i=a(87672),s=a.n(i),o=a(47197),l=a(94536),d=a(21266),c=a(5733),u=a(91811),p=a(90691),h=a(39845),y=a(97143),w=a(52367),v=a(57421);class f{static async add(e,t,a){return await(0,v.wf)(e,t,a,f.ownTables[d.K.name].name)}static async remove(e,t,a){const r=await f.depTables.GetBip44Wrapper.get(e,t,a);if(null==r)throw new Error("ModifyBip44Wrapper::remove Should never happen");await f.depTables.RemoveKeyDerivationTree.remove(e,t,{rootKeyId:r.RootKeyDerivationId})}}s()(f,"ownTables",n()({[d.K.name]:d.K})),s()(f,"depTables",n()({GetBip44Wrapper:l.H,RemoveKeyDerivationTree:y.lx}));class I{static async pop(e,t,a,r){const{derivationLevel:n,...i}=a,s=await(async()=>{if(n===w.CZ.CHAIN.level){const n=(await I.depTables.GetDerivationSpecific.get(e,t,[a.pubDeriverKeyDerivationId],w.CZ.CHAIN.level,r))[0];if(void 0===n)throw new Error("ModifyDisplayCutoff::pop missing chain. Should never happen");return n}if(n===w.CZ.ACCOUNT.level)return(await I.depTables.GetPathWithSpecific.getPath(e,t,{...i,level:w.CZ.CHAIN.level},(async a=>{const n=(await I.depTables.GetDerivationSpecific.get(e,t,[a],w.CZ.CHAIN.level,r))[0];if(void 0===n)throw new Error("ModifyDisplayCutoff::pop missing chain. Should never happen");return n}))).levelSpecific;throw new Error("ModifyDisplayCutoff::pop incorrect pubderiver level")})();if(null===s.DisplayCutoff)throw new Error("ModifyDisplayCutoff::pop should DisplayCutoff==null");const o=s.DisplayCutoff+1,l=await I.depTables.GetChildWithSpecific.get(e,t,(async a=>{const n=(await I.depTables.GetDerivationSpecific.get(e,t,[a],w.CZ.ADDRESS.level,r))[0];if(void 0===n)throw new Error("ModifyDisplayCutoff::pop missing address. Should never happen");return n}),s.KeyDerivationId,o);if(void 0!==l)return await I.set(e,t,{derivationId:s.KeyDerivationId,newIndex:o}),{index:o,row:l.levelSpecific}}static async set(e,t,a){const r=e.getSchema().table(I.ownTables[c.jm.name].name),n=e.update(r).set(r[c.jm.properties.DisplayCutoff],a.newIndex).where(o.op.and(r[c.jm.properties.KeyDerivationId].eq(a.derivationId)));await t.attach(n)}}s()(I,"ownTables",n()({[c.jm.name]:c.jm,[p.DW.name]:p.DW,[p.aq.name]:p.aq})),s()(I,"depTables",n()({GetPathWithSpecific:h.LY,GetChildWithSpecific:h.tu,GetDerivationSpecific:u.n}))},21266:(e,t,a)=>{"use strict";a.d(t,{K:()=>s,I:()=>o});var r=a(22261),n=a(47197),i=a(90691);const s={name:"Bip44Wrapper",properties:{ConceptualWalletId:"ConceptualWalletId",SignerLevel:"SignerLevel",PublicDeriverLevel:"PublicDeriverLevel",PrivateDeriverLevel:"PrivateDeriverLevel",PrivateDeriverKeyDerivationId:"PrivateDeriverKeyDerivationId",RootKeyDerivationId:"RootKeyDerivationId"}},o=e=>{e.createTable(s.name).addColumn(s.properties.ConceptualWalletId,n.Type.INTEGER).addColumn(s.properties.SignerLevel,n.Type.INTEGER).addColumn(s.properties.PublicDeriverLevel,n.Type.INTEGER).addColumn(s.properties.PrivateDeriverLevel,n.Type.INTEGER).addColumn(s.properties.PrivateDeriverKeyDerivationId,n.Type.INTEGER).addColumn(s.properties.RootKeyDerivationId,n.Type.INTEGER).addForeignKey("Bip44Wrapper_ConceptualWallet",{local:s.properties.ConceptualWalletId,ref:`${r.$u.name}.${r.$u.properties.ConceptualWalletId}`}).addForeignKey("Bip44Wrapper_PrivateDeriverKeyDerivation",{local:s.properties.PrivateDeriverKeyDerivationId,ref:`${i.aq.name}.${i.aq.properties.KeyDerivationId}`}).addForeignKey("Bip44Wrapper_RootKeyDerivation",{local:s.properties.RootKeyDerivationId,ref:`${i.aq.name}.${i.aq.properties.KeyDerivationId}`,action:n.ConstraintAction.CASCADE}).addUnique("Bip44Wrapper_ConceptualWallet_Unique",[s.properties.ConceptualWalletId]).addNullable([s.properties.SignerLevel,s.properties.PrivateDeriverLevel,s.properties.PrivateDeriverKeyDerivationId])}},2151:(e,t,a)=>{"use strict";a.d(t,{S:()=>u});var r=a(56474),n=a.n(r),i=a(87672),s=a.n(i),o=a(28423),l=a(88863),d=a(97143),c=a(57421);class u{static async add(e,t,a){return await(0,c.wf)(e,t,a,u.ownTables[l.g.name].name)}static async remove(e,t,a){const r=await u.depTables.GetCip1852Wrapper.get(e,t,a);if(null==r)throw new Error("ModifyCip1852Wrapper::remove Should never happen");await u.depTables.RemoveKeyDerivationTree.remove(e,t,{rootKeyId:r.RootKeyDerivationId})}}s()(u,"ownTables",n()({[l.g.name]:l.g})),s()(u,"depTables",n()({GetCip1852Wrapper:o.k,RemoveKeyDerivationTree:d.lx}))},88863:(e,t,a)=>{"use strict";a.d(t,{g:()=>s,W:()=>o});var r=a(22261),n=a(47197),i=a(90691);const s={name:"Cip1852Wrapper",properties:{ConceptualWalletId:"ConceptualWalletId",SignerLevel:"SignerLevel",PublicDeriverLevel:"PublicDeriverLevel",PrivateDeriverLevel:"PrivateDeriverLevel",PrivateDeriverKeyDerivationId:"PrivateDeriverKeyDerivationId",RootKeyDerivationId:"RootKeyDerivationId"}},o=e=>{e.createTable(s.name).addColumn(s.properties.ConceptualWalletId,n.Type.INTEGER).addColumn(s.properties.SignerLevel,n.Type.INTEGER).addColumn(s.properties.PublicDeriverLevel,n.Type.INTEGER).addColumn(s.properties.PrivateDeriverLevel,n.Type.INTEGER).addColumn(s.properties.PrivateDeriverKeyDerivationId,n.Type.INTEGER).addColumn(s.properties.RootKeyDerivationId,n.Type.INTEGER).addForeignKey("Cip1852Wrapper_ConceptualWallet",{local:s.properties.ConceptualWalletId,ref:`${r.$u.name}.${r.$u.properties.ConceptualWalletId}`}).addForeignKey("Cip1852Wrapper_PrivateDeriverKeyDerivation",{local:s.properties.PrivateDeriverKeyDerivationId,ref:`${i.aq.name}.${i.aq.properties.KeyDerivationId}`}).addForeignKey("Cip1852Wrapper_RootKeyDerivation",{local:s.properties.RootKeyDerivationId,ref:`${i.aq.name}.${i.aq.properties.KeyDerivationId}`,action:n.ConstraintAction.CASCADE}).addUnique("Cip1852Wrapper_ConceptualWallet_Unique",[s.properties.ConceptualWalletId]).addNullable([s.properties.SignerLevel,s.properties.PrivateDeriverLevel,s.properties.PrivateDeriverKeyDerivationId])}},7559:(e,t,a)=>{"use strict";a.d(t,{if:()=>I,pf:()=>T,ai:()=>g});var r=a(56474),n=a.n(r),i=a(3649),s=a.n(i),o=a(89400),l=a.n(o),d=a(66419),c=a.n(d),u=a(87672),p=a.n(u),h=a(97143),y=a(57421),w=a(39845),v=a(72741),f=a(47908);class I{static async excludingParent(e,t,a,r,n){const i=a.derivationId,s=[];for(let o=0;o<a.children.length;o++){const d=r.get(n+1);if(null==d)throw new Error("AddDerivationTree::excludingParent Unknown table queried");const u=await I.depTables.GetOrAddDerivation.getOrAdd(e,t,i,a.children[o].index,{privateKeyInfo:null,publicKeyInfo:null,derivationInfo:e=>({PublicKeyId:e.private,PrivateKeyId:e.public,Parent:i,Index:a.children[o].index}),levelInfo:e=>a.children[o].insert(e)},c()(l()(r).call(r)),d);a.children[o].isUsed&&await h.ad.markAsUsed(e,t,[u.KeyDerivation.KeyDerivationId]);const p=null==a.children[o].children?void 0:await I.excludingParent(e,t,{derivationId:u.KeyDerivation.KeyDerivationId,children:a.children[o].children},r,n+1);s.push({index:a.children[o].index,result:u,children:p})}return s}static async includingParent(e,t,a,r,n,i){const s=r.get(n);if(null==s)throw new Error("AddDerivationTree::includingParent Unknown table queried");const o=await I.depTables.AddDerivation.add(e,t,a,c()(l()(r).call(r)),s);return{root:o,children:await I.excludingParent(e,t,i(o.KeyDerivation.KeyDerivationId),r,n+1)}}static async fromSinglePath(e,t,a,r){let n=a.parentDerivationId;const i=[];for(let s=0;s<a.path.length;s++){const o=r.get(a.pathStartLevel+s);if(null==o)throw new Error("AddDerivationTree::fromSinglePath Unknown table queried");const d=await I.depTables.GetOrAddDerivation.getOrAdd(e,t,n,a.path[s].index,{privateKeyInfo:a.path[s].privateKey,publicKeyInfo:a.path[s].publicKey,derivationInfo:e=>({PublicKeyId:e.private,PrivateKeyId:e.public,Parent:n,Index:a.pathStartLevel+s===0?null:a.path[s].index}),levelInfo:e=>a.path[s].insert(e)},c()(l()(r).call(r)),o);n=d.KeyDerivation.KeyDerivationId,i.push(d)}return i}}p()(I,"ownTables",n()({})),p()(I,"depTables",n()({GetOrAddDerivation:h.HX,AddDerivation:h.O7}));class T{static async add(e,t,a,r,n,i,o){const l=await T.depTables.GetKeyForDerivation.get(e,t,r,!1,!0);if(null==l.privateKey)throw new y.md("DerivePublicDeriverFromKey::add privateKey");const d=a.pathToPublic(l.privateKey);if(0===d.length)throw new Error("DerivePublicDeriverFromKey::add derivedPath");const c=await T.depTables.AddDerivationTree.fromSinglePath(e,t,{parentDerivationId:r,path:s()(d).call(d,0,d.length-1),pathStartLevel:n+1},o),u=await g.depTables.GetPublicDeriver.forWallet(e,t,i);let p;{const s=o.get(n+d.length);if(null==s)throw new Error("DerivePublicDeriverFromKey::add Unknown table queried");p=await T.depTables.AddPublicDeriver.add(e,t,{addLevelRequest:{privateKeyInfo:d[d.length-1].privateKey,publicKeyInfo:d[d.length-1].publicKey,derivationInfo:e=>({PublicKeyId:e.public,PrivateKeyId:e.private,Parent:0===c.length?r:c[c.length-1].KeyDerivation.KeyDerivationId,Index:d[d.length-1].index}),levelInfo:e=>d[d.length-1].insert(e)},derivationTables:o,levelSpecificTableName:s,addPublicDeriverRequest:e=>({ConceptualWalletId:i,KeyDerivationId:e.derivationId,Name:a.publicDeriverMeta.name,Index:u.length,LastSyncInfoId:e.lastSyncInfoId})})}return await T.depTables.AddDerivationTree.excludingParent(e,t,{derivationId:p.publicDeriverResult.KeyDerivationId,children:a.initialDerivations},o,n+d.length),p}}p()(T,"ownTables",n()({})),p()(T,"depTables",n()({GetPublicDeriver:f.oR,AddPublicDeriver:v.So,GetKeyForDerivation:w.Uq,GetOrAddDerivation:h.HX,AddDerivationTree:I}));class g{static async add(e,t,a,r,n){var i;const o=await g.depTables.AddDerivationTree.fromSinglePath(e,t,{parentDerivationId:a.parentDerivationId,path:s()(i=a.pathToPublic).call(i,0,a.pathToPublic.length-1),pathStartLevel:a.pathStartLevel},n),l=n.get(a.pathStartLevel+a.pathToPublic.length-1);if(null==l)throw new Error("AddAdhocPublicDeriver::add Unknown table queried");const d=await g.depTables.GetPublicDeriver.forWallet(e,t,r),c=await g.depTables.AddPublicDeriver.add(e,t,{addLevelRequest:{privateKeyInfo:a.pathToPublic[a.pathToPublic.length-1].privateKey,publicKeyInfo:a.pathToPublic[a.pathToPublic.length-1].publicKey,derivationInfo:e=>({PublicKeyId:e.public,PrivateKeyId:e.private,Parent:0===o.length?a.parentDerivationId:o[o.length-1].KeyDerivation.KeyDerivationId,Index:a.pathToPublic[a.pathToPublic.length-1].index}),levelInfo:e=>a.pathToPublic[a.pathToPublic.length-1].insert(e)},derivationTables:n,levelSpecificTableName:l,addPublicDeriverRequest:e=>({ConceptualWalletId:r,KeyDerivationId:e.derivationId,Name:a.publicDeriverMeta.name,Index:d.length,LastSyncInfoId:e.lastSyncInfoId})});return await g.depTables.AddDerivationTree.excludingParent(e,t,{derivationId:c.publicDeriverResult.KeyDerivationId,children:a.initialDerivations},n,a.pathStartLevel+a.pathToPublic.length-1),{publicDeriver:c,hwWalletMeta:null==a.hwWalletMetaInsert?void 0:await g.depTables.ModifyHwWalletMeta.add(e,t,a.hwWalletMetaInsert)}}}p()(g,"ownTables",n()({})),p()(g,"depTables",n()({GetPublicDeriver:f.oR,AddDerivation:h.O7,AddPublicDeriver:v.So,ModifyHwWalletMeta:v.eT,AddDerivationTree:I}))},5733:(e,t,a)=>{"use strict";a.d(t,{Ur:()=>i,mb:()=>s,y4:()=>o,A6:()=>l,jm:()=>d,A:()=>c});var r=a(90691),n=a(47197);const i={name:"RootDerivation",properties:{RootDerivationId:"RootDerivationId",KeyDerivationId:"KeyDerivationId"}},s={name:"PurposeDerivation",properties:{PurposeDerivationId:"PurposeDerivationId",KeyDerivationId:"KeyDerivationId"}},o={name:"CoinTypeDerivation",properties:{CoinTypeDerivationId:"CoinTypeDerivationId",KeyDerivationId:"KeyDerivationId"}},l={name:"Bip44Account",properties:{Bip44AccountId:"Bip44AccountId",KeyDerivationId:"KeyDerivationId"}},d={name:"Bip44Chain",properties:{Bip44ChainId:"Bip44ChainId",KeyDerivationId:"KeyDerivationId",DisplayCutoff:"DisplayCutoff"}},c=e=>{e.createTable(i.name).addColumn(i.properties.RootDerivationId,n.Type.INTEGER).addColumn(i.properties.KeyDerivationId,n.Type.INTEGER).addPrimaryKey([i.properties.RootDerivationId],!0).addForeignKey("RootDerivation_KeyDerivation",{local:i.properties.KeyDerivationId,ref:`${r.aq.name}.${r.aq.properties.KeyDerivationId}`,action:n.ConstraintAction.CASCADE}),e.createTable(s.name).addColumn(s.properties.PurposeDerivationId,n.Type.INTEGER).addColumn(s.properties.KeyDerivationId,n.Type.INTEGER).addPrimaryKey([s.properties.PurposeDerivationId],!0).addForeignKey("PurposeDerivation_KeyDerivation",{local:s.properties.KeyDerivationId,ref:`${r.aq.name}.${r.aq.properties.KeyDerivationId}`,action:n.ConstraintAction.CASCADE}),e.createTable(o.name).addColumn(o.properties.CoinTypeDerivationId,n.Type.INTEGER).addColumn(o.properties.KeyDerivationId,n.Type.INTEGER).addPrimaryKey([o.properties.CoinTypeDerivationId],!0).addForeignKey("CoinTypeDerivation_KeyDerivation",{local:o.properties.KeyDerivationId,ref:`${r.aq.name}.${r.aq.properties.KeyDerivationId}`,action:n.ConstraintAction.CASCADE}),e.createTable(l.name).addColumn(l.properties.Bip44AccountId,n.Type.INTEGER).addColumn(l.properties.KeyDerivationId,n.Type.INTEGER).addPrimaryKey([l.properties.Bip44AccountId],!0).addForeignKey("Bip44Account_KeyDerivation",{local:l.properties.KeyDerivationId,ref:`${r.aq.name}.${r.aq.properties.KeyDerivationId}`,action:n.ConstraintAction.CASCADE}),e.createTable(d.name).addColumn(d.properties.Bip44ChainId,n.Type.INTEGER).addColumn(d.properties.KeyDerivationId,n.Type.INTEGER).addColumn(d.properties.DisplayCutoff,n.Type.INTEGER).addPrimaryKey([d.properties.Bip44ChainId],!0).addForeignKey("Bip44Chain_KeyDerivation",{local:d.properties.KeyDerivationId,ref:`${r.aq.name}.${r.aq.properties.KeyDerivationId}`,action:n.ConstraintAction.CASCADE}).addNullable([d.properties.DisplayCutoff])}},47908:(e,t,a)=>{"use strict";a.d(t,{sk:()=>c,Th:()=>p,oR:()=>h,NX:()=>y,tV:()=>w});var r=a(56474),n=a.n(r),i=a(87672),s=a.n(i),o=a(22261),l=a(39845),d=a(57421);class c{static async get(e,t,a){const r=c.ownTables[o.$u.name];return await(0,d.HI)(e,t,a,r.name,r.properties.ConceptualWalletId)}}s()(c,"ownTables",n()({[o.$u.name]:o.$u})),s()(c,"depTables",n()({}));class u{static async getLastSyncInfo(e,t,a){return await(0,d.HI)(e,t,a,u.ownTables[o.nc.name].name,u.ownTables[o.nc.name].properties.LastSyncInfoId)}}s()(u,"ownTables",n()({[o.nc.name]:o.nc})),s()(u,"depTables",n()({}));class p{static async getMeta(e,t,a){return await(0,d.HI)(e,t,a,p.ownTables[o.H5.name].name,p.ownTables[o.H5.name].properties.ConceptualWalletId)}}s()(p,"ownTables",n()({[o.H5.name]:o.H5})),s()(p,"depTables",n()({}));class h{static async get(e,t,a){return await(0,d.HI)(e,t,a,h.ownTables[o.zq.name].name,h.ownTables[o.zq.name].properties.PublicDeriverId)}static async forWallet(e,t,a){return await(0,d.q$)(e,t,h.ownTables[o.zq.name].name,h.ownTables[o.zq.name].properties.ConceptualWalletId,[a])}}s()(h,"ownTables",n()({[o.zq.name]:o.zq})),s()(h,"depTables",n()({}));class y{static async get(e,t,a,r,n){const i=await y.depTables.GetPublicDeriver.get(e,t,a);if(void 0===i)throw new d.md("GetKeyForPublicDeriver::get GetPublicDeriver");return{...await y.depTables.GetKeyForDerivation.get(e,t,i.KeyDerivationId,r,n),PublicDeriver:i}}}s()(y,"ownTables",n()({})),s()(y,"depTables",n()({GetKeyForDerivation:l.Uq,GetPublicDeriver:h}));class w{static async forId(e,t,a){const r=await w.depTables.GetPublicDeriver.get(e,t,a);if(void 0===r)throw new d.md("GetLastSyncForPublicDeriver::forId pubDeriverRow");const n=await w.depTables.ReadLastSyncInfo.getLastSyncInfo(e,t,r.LastSyncInfoId);if(void 0===n)throw new d.md("GetLastSyncForPublicDeriver::forId syncInfo");return n}}s()(w,"ownTables",n()({})),s()(w,"depTables",n()({GetPublicDeriver:h,ReadLastSyncInfo:u}))},72741:(e,t,a)=>{"use strict";a.d(t,{Ms:()=>f,OQ:()=>I,So:()=>T,Bo:()=>g,eT:()=>m,lq:()=>b,Ip:()=>D});var r=a(56474),n=a.n(r),i=a(89400),s=a.n(i),o=a(66419),l=a.n(o),d=a(87672),c=a.n(d),u=a(47197),p=a(22261),h=a(57421),y=a(47908),w=a(90691),v=a(97143);class f{static async overrideLastSyncInfo(e,t,a){return await(0,h.mX)(e,t,a,f.ownTables[p.nc.name].name)}static async create(e,t){return await(0,h.wf)(e,t,{BlockHash:null,SlotNum:null,Height:0,Time:null},f.ownTables[p.nc.name].name)}static async remove(e,t,a){await(0,h.t5)(e,t,f.ownTables[p.nc.name].name,f.ownTables[p.nc.name].properties.LastSyncInfoId,a)}}c()(f,"ownTables",n()({[p.nc.name]:p.nc})),c()(f,"depTables",n()({}));class I{static async delete(e,t,a,r=!0){if(await(0,h.t5)(e,t,I.ownTables[w.p5.name].name,I.ownTables[w.p5.name].properties.TransactionId,a.txIds),!r)return;const n=await I.depTables.GetLastSyncForPublicDeriver.forId(e,t,a.publicDeriverId);await I.depTables.ModifyLastSyncInfo.overrideLastSyncInfo(e,t,{LastSyncInfoId:n.LastSyncInfoId,BlockHash:null,SlotNum:null,Height:0,Time:null})}}c()(I,"ownTables",n()({[w.p5.name]:w.p5})),c()(I,"depTables",n()({ModifyLastSyncInfo:f,GetLastSyncForPublicDeriver:y.tV}));class T{static async add(e,t,a){var r;const n=await T.depTables.AddDerivation.add(e,t,a.addLevelRequest,l()(s()(r=a.derivationTables).call(r)),a.levelSpecificTableName),i=await f.create(e,t);return{publicDeriverResult:await(0,h.wf)(e,t,a.addPublicDeriverRequest({derivationId:n.KeyDerivation.KeyDerivationId,lastSyncInfoId:i.LastSyncInfoId}),T.ownTables[p.zq.name].name),levelResult:n}}}c()(T,"ownTables",n()({[p.zq.name]:p.zq})),c()(T,"depTables",n()({AddDerivation:v.O7,ModifyLastSyncInfo:f}));class g{static async rename(e,t,a){const r=e.getSchema().table(g.ownTables[p.zq.name].name),n=e.update(r).set(r[p.zq.properties.Name],a.newName).where(u.op.and(r[p.zq.properties.PublicDeriverId].eq(a.pubDeriverId)));await t.attach(n)}}c()(g,"ownTables",n()({[p.zq.name]:p.zq})),c()(g,"depTables",n()({}));class m{static async add(e,t,a){return await(0,h.wf)(e,t,a,m.ownTables[p.H5.name].name)}}c()(m,"ownTables",n()({[p.H5.name]:p.H5})),c()(m,"depTables",n()({}));class b{static async add(e,t,a){return await(0,h.wf)(e,t,a,b.ownTables[p.$u.name].name)}static async remove(e,t,a){const r=b.ownTables[p.$u.name];await(0,h.t5)(e,t,r.name,r.properties.ConceptualWalletId,a)}static async rename(e,t,a){const r=e.getSchema().table(b.ownTables[p.$u.name].name),n=e.update(r).set(r[p.$u.properties.Name],a.newName).where(u.op.and(r[p.$u.properties.ConceptualWalletId].eq(a.walletId)));await t.attach(n)}}c()(b,"ownTables",n()({[p.$u.name]:p.$u})),c()(b,"depTables",n()({}));class D{static async remove(e,t,a){const r=await D.depTables.GetPublicDeriver.get(e,t,a.publicDeriverId);if(null==r)throw new h.md("RemovePublicDeriver::remove");await(0,h.t5)(e,t,D.ownTables[p.zq.name].name,D.ownTables[p.zq.name].properties.PublicDeriverId,[a.publicDeriverId]),await D.depTables.RemoveKeyDerivationTree.remove(e,t,{rootKeyId:r.KeyDerivationId}),await D.depTables.ModifyLastSyncInfo.remove(e,t,[r.LastSyncInfoId])}}c()(D,"ownTables",n()({[p.zq.name]:p.zq})),c()(D,"depTables",n()({GetPublicDeriver:y.oR,RemoveKeyDerivationTree:v.lx,ModifyLastSyncInfo:f}))},27189:(e,t,a)=>{"use strict";a.d(t,{tT:()=>A,PO:()=>E,J8:()=>K,hx:()=>G});var r=a(52424),n=a.n(r),i=a(86902),s=a.n(i),o=a(2991),l=a.n(o),d=a(80426),c=a.n(d),u=a(56474),p=a.n(u),h=a(87672),y=a.n(h),w=a(26337),v=a.n(w),f=a(86045),I=a.n(f),T=a(63675),g=a(57421),m=a(72741),b=a(47908),D=a(52974),k=a(55343);function x(e,t,a){!function(e,t){if(t.has(e))throw new TypeError("Cannot initialize the same private elements twice on an object")}(e,t),t.set(e,a)}var C=new(n()),P=new(n());class A{constructor(e){return y()(this,"db",void 0),x(this,C,{writable:!0,value:void 0}),x(this,P,{writable:!0,value:void 0}),y()(this,"walletType",void 0),y()(this,"hardwareInfo",void 0),y()(this,"networkInfo",void 0),y()(this,"defaultToken",void 0),y()(this,"getWalletType",(()=>this.walletType)),y()(this,"getHwWalletMeta",(()=>this.hardwareInfo)),y()(this,"rename",(async e=>{var t,a;const r=p()({ModifyConceptualWallet:m.lq}),n=c()(t=l()(a=s()(r)).call(a,(e=>r[e]))).call(t,(e=>(0,g.Hz)(this.db,e)));return await(0,g.zm)(this.db,n,(async t=>{await r.ModifyConceptualWallet.rename(this.db,t,{walletId:v()(this,C),newName:e.newName})}))})),y()(this,"getFullConceptualWalletInfo",(async()=>{var e,t;const a=p()({GetConceptualWallet:b.sk}),r=c()(e=l()(t=s()(a)).call(t,(e=>a[e]))).call(e,(e=>(0,g.Hz)(this.db,e)));return await(0,g.zm)(this.db,r,(async e=>{const t=await a.GetConceptualWallet.get(this.db,e,v()(this,C));if(null==t)throw new g.md("getFullConceptualWalletInfo ConceptualWallet==null");return t}))})),y()(this,"rawRemove",(async(e,t)=>{await E(e,t,this.getConceptualWalletId())})),this.db=e.db,I()(this,C,e.conceptualWalletId),this.walletType=e.walletType,this.hardwareInfo=e.hardwareInfo,this.networkInfo=e.networkInfo,this.defaultToken=e.defaultToken,this}getDb(){return this.db}getNetworkInfo(){return this.networkInfo}getDefaultToken(){return{defaultNetworkId:this.networkInfo.NetworkId,defaultIdentifier:this.defaultToken.Identifier}}getDefaultMultiToken(){return new k.a([],this.getDefaultToken())}getConceptualWalletId(){return v()(this,C)}}async function E(e,t,a){await m.lq.remove(e,t,[a])}function S(e,t){if(e.getWalletType()!==T.j.HARDWARE_WALLET)return!1;const a=e.getHwWalletMeta();return null!=a&&t(a)}function K(e){const t=D.Z.wallets.hardwareWallet.trezorT.VENDOR,a=D.Z.wallets.hardwareWallet.trezorT.MODEL;return S(e,(e=>e.Vendor===t&&e.Model===a))}function G(e){const t=D.Z.wallets.hardwareWallet.ledgerNano.VENDOR;return S(e,(e=>e.Vendor===t))}},63675:(e,t,a)=>{"use strict";a.d(t,{j:()=>i});var r=a(56474),n=a.n(r);a(7559),a(97143),a(39845);const i=n()({WEB_WALLET:0,HARDWARE_WALLET:1})},69594:(e,t,a)=>{"use strict";a.d(t,{bR:()=>E,VV:()=>R,Su:()=>B});var r=a(94473),n=a.n(r),i=a(86902),s=a.n(i),o=a(80426),l=a.n(o),d=a(56474),c=a.n(d),u=a(87672),p=a.n(u),h=a(93476),y=a.n(h),w=a(3649),v=a.n(w),f=a(2991),I=a.n(f),T=a(63675),g=(a(27189),a(57421)),m=a(47908),b=a(17534),D=a(13069),k=a(7559),x=a(97143),C=a(39845),P=a(99546),A=a(90649);async function E(e,t,a,r,n,i,s,o){return await a.DerivePublicDeriverFromKey.add(e,t,{publicDeriverMeta:n.publicDeriverMeta,pathToPublic:e=>{var t,a,r;const i=(0,P.CZ)({privateKeyRow:e,password:n.decryptPrivateDeriverPassword,path:I()(t=n.path).call(t,(e=>e.index))});return[...I()(a=v()(r=n.path).call(r,0,n.path.length-1)).call(a,(e=>({index:e.index,insert:t=>y().resolve({KeyDerivationId:t.keyDerivationId,...e.insert}),privateKey:null,publicKey:null}))),{index:n.path[n.path.length-1].index,insert:e=>y().resolve({KeyDerivationId:e.keyDerivationId,...n.path[n.path.length-1].insert}),privateKey:void 0===n.encryptPublicDeriverPassword?null:{Hash:null===n.encryptPublicDeriverPassword?i.prvKeyHex:(0,D.x)(n.encryptPublicDeriverPassword,(0,A.hexToBytes)(i.prvKeyHex)),IsEncrypted:!0,PasswordLastUpdate:null,Type:e.Type},publicKey:{Hash:i.pubKeyHex,IsEncrypted:!1,PasswordLastUpdate:null,Type:e.Type}}]},initialDerivations:n.initialDerivations},i,s,r,o)}const S=(0,b.Mixin)((e=>class extends e{constructor(...e){super(...e),p()(this,"rawDerivePublicDeriverFromPrivate",(async(e,t,a,r)=>{const n=super.getPrivateDeriverKeyDerivationId(),i=super.getPrivateDeriverLevel();if(null==n||null==i)throw new g.md("rawDerivePublicDeriverFromPrivate no private deriver");return await E(super.getDb(),e,{DerivePublicDeriverFromKey:t.DerivePublicDeriverFromKey},super.getConceptualWalletId(),a,n,i,r)})),p()(this,"derivePublicDeriverFromPrivate",(async e=>{var t,a;const r=this.getDerivationTables(),n=c()({DerivePublicDeriverFromKey:k.pf}),i=l()(t=I()(a=s()(n)).call(a,(e=>n[e]))).call(t,(e=>(0,g.Hz)(super.getDb(),e)));return await(0,g.zm)(super.getDb(),[...i,...(0,g.pS)(super.getDb(),r)],(async t=>this.rawDerivePublicDeriverFromPrivate(t,n,e,r)))}))}})),K=(0,b.Mixin)((e=>class extends e{constructor(...e){super(...e),p()(this,"rawGetPrivateDeriverKey",(async(e,t,a)=>{const r=super.getPrivateDeriverKeyDerivationId();if(null==r)throw new g.md("GetPrivateDeriverKey::getPrivateDeriverKey derivationId=null");const n=await t.GetKeyForDerivation.get(super.getDb(),e,r,!1,!0);if(null==n.privateKey)throw new g.md("GetPrivateDeriverKey::getPrivateDeriverKey privateKey=null");return{keyRow:n.privateKey,keyDerivation:n.KeyDerivation}})),p()(this,"getPrivateDeriverKey",(async e=>{var t,a;const r=c()({GetKeyForDerivation:C.Uq}),n=l()(t=I()(a=s()(r)).call(a,(e=>r[e]))).call(t,(e=>(0,g.Hz)(super.getDb(),e)));return await(0,g.zm)(super.getDb(),n,(async t=>this.rawGetPrivateDeriverKey(t,r,e)))})),p()(this,"rawChangePrivateDeriverPassword",(async(e,t,a)=>{const r=await this.rawGetPrivateDeriverKey(e,{GetKeyForDerivation:t.GetKeyForDerivation},void 0);return(0,P.kQ)(super.getDb(),e,{ModifyKey:t.ModifyKey},{...a,oldKeyRow:r.keyRow})})),p()(this,"changePrivateDeriverPassword",(async e=>{var t,a;const r=c()({GetKeyForDerivation:C.Uq,ModifyKey:x.f1}),n=l()(t=I()(a=s()(r)).call(a,(e=>r[e]))).call(t,(e=>(0,g.Hz)(super.getDb(),e)));return await(0,g.zm)(super.getDb(),n,(async t=>this.rawChangePrivateDeriverPassword(t,r,e)))}))}})),G=(0,b.Mixin)((e=>class extends e{constructor(...e){super(...e),p()(this,"rawAddAdhocPubicDeriver",(async(e,t,a,r)=>await t.AddAdhocPublicDeriver.add(super.getDb(),e,a,super.getConceptualWalletId(),r))),p()(this,"addAdhocPubicDeriver",(async e=>{var t,a;const r=this.getDerivationTables(),n=c()({AddAdhocPublicDeriver:k.ai}),i=l()(t=I()(a=s()(n)).call(a,(e=>n[e]))).call(t,(e=>(0,g.Hz)(super.getDb(),e)));return await(0,g.zm)(super.getDb(),[...i,...(0,g.pS)(super.getDb(),r)],(async t=>this.rawAddAdhocPubicDeriver(t,n,e,r)))}))}}));async function N(e,t){var a,r;const i=c()({GetHwWalletMeta:m.Th,GetConceptualWallet:m.sk,GetNetworks:C.V7,GetToken:C.YT}),o=l()(a=I()(r=s()(i)).call(r,(e=>i[e]))).call(a,(t=>(0,g.Hz)(e,t))),d=await(0,g.zm)(e,o,(async a=>{const r=await i.GetConceptualWallet.get(e,a,t);if(null==r)throw new Error(`refreshConceptualWalletFunctionality no conceptual wallet with id ${t}`);const s=await i.GetHwWalletMeta.getMeta(e,a,t),o=await i.GetNetworks.get(e,a),l=n()(o).call(o,(e=>e.NetworkId===r.NetworkId));if(null==l)throw new Error(`refreshConceptualWalletFunctionality missing network ${r.NetworkId}`);const d=await i.GetToken.all(e,a),c=n()(d).call(d,(e=>e.NetworkId===r.NetworkId));if(null==c)throw new Error(`refreshConceptualWalletFunctionality missing token for ${r.NetworkId}`);return{hardwareInfo:s,fullInfo:r,networkInfo:l,defaultToken:c}})),u=null==d.hardwareInfo?T.j.WEB_WALLET:T.j.HARDWARE_WALLET;return{db:e,conceptualWalletId:t,walletType:u,hardwareInfo:d.hardwareInfo,networkInfo:d.networkInfo,defaultToken:d.defaultToken}}async function R(e,t,a){const r=await N(e,t.ConceptualWalletId);let n=null,i=null,s=a;return null!=t.PrivateDeriverLevel&&null!=t.PrivateDeriverKeyDerivationId?(s=S(s),s=K(s),n=t.PrivateDeriverLevel,i=t.PrivateDeriverKeyDerivationId):s=G(s),new s(e,r,t,n,i)}async function B(e,t,a){const r=await N(e,t.ConceptualWalletId);let n=null,i=null,s=a;return null!=t.PrivateDeriverLevel&&null!=t.PrivateDeriverKeyDerivationId?(s=S(s),s=K(s),n=t.PrivateDeriverLevel,i=t.PrivateDeriverKeyDerivationId):s=G(s),new s(e,r,t,n,i)}},38441:(e,t,a)=>{"use strict";a.d(t,{n:()=>x});var r=a(86902),n=a.n(r),i=a(2991),s=a.n(i),o=a(80426),l=a.n(o),d=a(56474),c=a.n(d),u=a(87672),p=a.n(u),h=a(87326),y=a(11015),w=(a(27189),a(57421)),v=a(47908),f=a(72741),I=a(39845),T=a(3577),g=a(23006),m=a(1499),b=a(96251);class D extends b.BatchedEmurgoUtxoApi{constructor(e){super(D.utxoApiFactory(e))}}p()(D,"utxoApiFactory",(e=>new b.EmurgoUtxoApi(e+"/api/",!0)));var k=a(84174);class x{constructor(e){p()(this,"publicDeriverId",void 0),p()(this,"parent",void 0),p()(this,"derivationId",void 0),p()(this,"pathToPublic",void 0),p()(this,"utxoService",void 0),p()(this,"utxoStorageApi",void 0),p()(this,"getFullPublicDeriverInfo",(async()=>{var e,t;const a=c()({GetPublicDeriver:v.oR}),r=l()(e=s()(t=n()(a)).call(t,(e=>a[e]))).call(e,(e=>(0,w.Hz)(this.getDb(),e)));return await(0,w.zm)(this.getDb(),r,(async e=>{const t=await a.GetPublicDeriver.get(this.getDb(),e,this.publicDeriverId);if(null==t)throw new w.md("getFullPublicDeriverInfo PublicDeriver==null");return t}))})),p()(this,"rawRename",(async(e,t,a)=>await t.ModifyPublicDeriver.rename(this.getDb(),e,{pubDeriverId:this.publicDeriverId,newName:a.newName}))),p()(this,"rename",(async e=>{var t,a;const r=c()({ModifyPublicDeriver:f.Bo}),i=l()(t=s()(a=n()(r)).call(a,(e=>r[e]))).call(t,(e=>(0,w.Hz)(this.getDb(),e)));return await(0,w.zm)(this.getDb(),i,(async t=>this.rawRename(t,r,e)))})),p()(this,"rawGetLastSyncInfo",(async(e,t,a)=>await t.GetLastSyncForPublicDeriver.forId(this.getDb(),e,this.publicDeriverId))),p()(this,"getLastSyncInfo",(async e=>{var t,a;const r=c()({GetLastSyncForPublicDeriver:v.tV}),i=l()(t=s()(a=n()(r)).call(a,(e=>r[e]))).call(t,(e=>(0,w.Hz)(this.getDb(),e)));return await(0,w.zm)(this.getDb(),i,(async t=>this.rawGetLastSyncInfo(t,r,e)))})),p()(this,"getUtxoService",(()=>this.utxoService)),p()(this,"getUtxoStorageApi",(()=>this.utxoStorageApi)),this.publicDeriverId=e.publicDeriverId,this.parent=e.parent,this.pathToPublic=e.pathToPublic,this.derivationId=e.derivationId;const{BackendService:t}=e.parent.getNetworkInfo().Backend;if(!t)throw new Error("missing backend service URL");const a=new D(t);return this.utxoStorageApi=new m.p(this.publicDeriverId),this.utxoService=new g.UtxoService(a,this.utxoStorageApi),this}getDb(){return this.parent.getDb()}getPublicDeriverId(){return this.publicDeriverId}getParent(){return this.parent}isMainnet(){return this.getParent().getNetworkInfo().NetworkId===k.networks.CardanoMainnet.NetworkId}getPathToPublic(){return this.pathToPublic}getDerivationId(){return this.derivationId}static async createPublicDeriver(e,t){return await async function(e,t,a){const r=await async function(e,t){var a,r;const i=c()({GetKeyDerivation:I.qV}),o=l()(a=s()(r=n()(i)).call(r,(e=>i[e]))).call(a,(t=>(0,w.Hz)(e,t)));return await(0,w.zm)(e,o,(async a=>{const r=await i.GetKeyDerivation.get(e,a,t);if(void 0===r)throw new w.md("getKeyDerivation keyDerivationRow");return r}))}(e,t.KeyDerivationId);if(a instanceof h.J){const n=await(0,T.el)({db:e,pubDeriver:t,pubDeriverKeyDerivation:r,conceptualWallet:a,startClass:x});return new(0,n.finalClass)({publicDeriverId:t.PublicDeriverId,parent:a,pathToPublic:n.pathToPublic,derivationId:r.KeyDerivationId})}if(a instanceof y.H){const n=await(0,T.RV)(e,t,r,a,x);return new(0,n.finalClass)({publicDeriverId:t.PublicDeriverId,parent:a,pathToPublic:n.pathToPublic,derivationId:r.KeyDerivationId})}throw new Error("refreshPublicDeriverFunctionality unknown wallet type")}(t.getDb(),e,t)}}},3577:(e,t,a)=>{"use strict";a.d(t,{JM:()=>ae,se:()=>se,Oq:()=>de,Sy:()=>pe,Bq:()=>ve,h5:()=>me,sX:()=>ke,O8:()=>Pe,y9:()=>Se,hy:()=>Le,yB:()=>Ue,lD:()=>He,el:()=>Fe,RV:()=>je});var r=a(36384),n=a.n(r),i=a(3649),s=a.n(i),o=a(78580),l=a.n(o),d=a(94473),c=a.n(d),u=a(77766),p=a.n(u),h=a(44494),y=a.n(h),w=a(86902),v=a.n(w),f=a(56474),I=a.n(f),T=a(80426),g=a.n(T),m=a(20116),b=a.n(m),D=a(2991),k=a.n(D),x=a(39392),C=a.n(x),P=a(87672),A=a.n(P),E=a(17534),S=a(1499),K=a(95667),G=a(99546),N=a(24651),R=a(57421),B=a(47908),_=a(81369),L=a(7559),O=a(91811),M=a(52367),U=a(82982),W=a(39845),H=a(38079),F=a(97143),j=a(40026),q=a(73744),z=a(88903),$=a(21131),V=a(66905),Z=(a(27189),a(86335)),Y=a(84174),J=a(52776),X=a(87315),Q=a(75723);const ee=(0,E.Mixin)((e=>class extends e{})),te=(0,E.Mixin)((e=>class extends e{}));function ae(e){if(e instanceof te)return e}const re=(0,E.Mixin)((e=>class extends e{})),ne=(0,E.Mixin)((e=>class extends e{constructor(...e){super(...e),A()(this,"rawGetAllUtxos",(async(e,t,a,r)=>{var n,i;const s=await this.rawGetAllUtxoAddresses(e,{GetAddress:t.GetAddress,GetPathWithSpecific:t.GetPathWithSpecific,GetDerivationSpecific:t.GetDerivationSpecific},void 0,r),o=this.getUtxoStorageApi();o.setDb(super.getDb()),o.setDbTx(e);const l=await this.getUtxoService().getAvailableUtxos(),d=this.getParent().getNetworkInfo().NetworkId,c=new(C())(k()(n=b()(i=await t.GetToken.fromIdentifier(super.getDb(),e,["",...g()(l).call(l,(({assets:e})=>k()(e).call(e,(e=>e.assetId))))])).call(i,(e=>e.NetworkId===d))).call(n,(e=>[e.Identifier,e]))),u=new(C())(g()(s).call(s,(e=>{var t;return k()(t=e.addrs).call(t,(t=>[t.Hash,{addressing:e.addressing,address:t.Hash}]))})));return k()(l).call(l,(e=>{var t,a;let r;try{r=(0,Q.addressBech32ToHex)(e.receiver)}catch{r=e.receiver}const n=u.get(r);if(null==n)throw new Error("GetAllUtxos::rawGetAllUtxos: Addressing info not found. Should never happen");const i=k()(t=["",...k()(a=e.assets).call(a,(e=>e.assetId))]).call(t,((t,a)=>{let r;return r=0===a?e.amount:e.assets[a-1].amount,{Token:c.get(t)||{TokenId:-1,NetworkId:d,IsDefault:!1,Digest:0,Identifier:t,Metadata:{type:"Cardano",policyId:t.split(".")[0],assetName:t.split(".")[1],numberOfDecimals:0,ticker:null,logo:null,longName:null}},TokenList:{Amount:r.toString()}}}));return{output:{Transaction:{Hash:e.txHash},UtxoTransactionOutput:{OutputIndex:e.txIndex,ErgoBoxId:null,ErgoCreationHeight:null,ErgoTree:null,ErgoRegisters:null},tokens:i},addressing:n.addressing,address:n.address}}))})),A()(this,"rawGetAllUtxosFromOldDb",(async(e,t,a,r)=>{const n=await this.rawGetAllUtxoAddresses(e,{GetAddress:t.GetAddress,GetPathWithSpecific:t.GetPathWithSpecific,GetDerivationSpecific:t.GetDerivationSpecific},void 0,r),i=g()(n).call(n,(e=>{var t;return k()(t=e.addrs).call(t,(e=>e.AddressId))})),s=await t.GetUtxoTxOutputsWithTx.getUtxo(super.getDb(),e,i,this.getParent().getNetworkInfo().NetworkId),o=new(C())(g()(n).call(n,(e=>{var t;return k()(t=e.addrs).call(t,(t=>[t.AddressId,{addressing:e.addressing,address:t.Hash}]))}))),l=[];for(const e of s){const t=o.get(e.UtxoTransactionOutput.AddressId);if(null==t)throw new Error("GetAllUtxos::rawGetAllUtxos: Addressing info not found. Should never happen");l.push({output:e,addressing:t.addressing,address:t.address})}return l})),A()(this,"getAllUtxos",(async e=>{var t,a;const r=this.getParent().getDerivationTables(),n=I()({GetPathWithSpecific:W.LY,GetAddress:W.t9,GetUtxoTxOutputsWithTx:U.NW,GetUtxoAtSafePoint:J.r,GetUtxoDiffToBestBlock:J.S,GetToken:W.YT,GetDerivationSpecific:O.n}),i=g()(t=k()(a=v()(n)).call(a,(e=>n[e]))).call(t,(e=>(0,R.Hz)(super.getDb(),e)));return await(0,R.zm)(super.getDb(),[...i,...(0,R.pS)(super.getDb(),r)],(async e=>this.rawGetAllUtxos(e,n,void 0,r)))})),A()(this,"getAllUtxosFromOldDb",(async e=>{var t,a;const r=this.getParent().getDerivationTables(),n=I()({GetPathWithSpecific:W.LY,GetAddress:W.t9,GetUtxoTxOutputsWithTx:U.NW,GetUtxoAtSafePoint:J.r,GetUtxoDiffToBestBlock:J.S,GetToken:W.YT,GetDerivationSpecific:O.n}),i=g()(t=k()(a=v()(n)).call(a,(e=>n[e]))).call(t,(e=>(0,R.Hz)(super.getDb(),e)));return await(0,R.zm)(super.getDb(),[...i,...(0,R.pS)(super.getDb(),r)],(async e=>this.rawGetAllUtxosFromOldDb(e,n,void 0,r)))})),A()(this,"rawGetAllUtxoAddresses",(async(e,t,a,r)=>{var n,i,s,o,l;return this.getParent().getPublicDeriverLevel()>=M.CZ.CHAIN.level?(0,S.sC)(super.getDb(),e,t,{startingDerivation:super.getDerivationId(),derivationLevel:this.getParent().getPublicDeriverLevel(),commonPrefix:super.getPathToPublic(),queryPath:y()(l=Array(M.CZ.ADDRESS.level-this.getParent().getPublicDeriverLevel())).call(l,null)},r):[...await(0,S.sC)(super.getDb(),e,t,{startingDerivation:super.getDerivationId(),derivationLevel:this.getParent().getPublicDeriverLevel(),commonPrefix:super.getPathToPublic(),queryPath:p()(n=y()(i=Array(M.CZ.ACCOUNT.level-this.getParent().getPublicDeriverLevel())).call(i,null)).call(n,[0,null])},r),...await(0,S.sC)(super.getDb(),e,t,{startingDerivation:super.getDerivationId(),derivationLevel:this.getParent().getPublicDeriverLevel(),commonPrefix:super.getPathToPublic(),queryPath:p()(s=y()(o=Array(M.CZ.ACCOUNT.level-this.getParent().getPublicDeriverLevel())).call(o,null)).call(s,[1,null])},r)]})),A()(this,"getAllUtxoAddresses",(async e=>{var t,a;const r=this.getParent().getDerivationTables(),n=I()({GetPathWithSpecific:W.LY,GetAddress:W.t9,GetDerivationSpecific:O.n}),i=g()(t=k()(a=v()(n)).call(a,(e=>n[e]))).call(t,(e=>(0,R.Hz)(super.getDb(),e)));return await(0,R.zm)(super.getDb(),[...i,...(0,R.pS)(super.getDb(),r)],(async t=>this.rawGetAllUtxoAddresses(t,n,e,r)))}))}})),ie=ne;function se(e){if(e instanceof ie)return e}const oe=(0,E.Mixin)((e=>class extends e{constructor(...e){super(...e),A()(this,"rawGetAllAccountingAddresses",(async(e,t,a,r)=>{if(this.getParent().getPublicDeriverLevel()!==M.CZ.ACCOUNT.level)throw new Error("GetAllAccounting::rawGetAllAccountingAddresses incorrect pubderiver level");return(0,S.sC)(super.getDb(),e,t,{startingDerivation:super.getDerivationId(),derivationLevel:this.getParent().getPublicDeriverLevel(),commonPrefix:super.getPathToPublic(),queryPath:[V.OC.CHIMERIC_ACCOUNT,null]},r)})),A()(this,"getAllAccountingAddresses",(async e=>{var t,a;const r=this.getParent().getDerivationTables(),n=I()({GetPathWithSpecific:W.LY,GetAddress:W.t9,GetDerivationSpecific:O.n}),i=g()(t=k()(a=v()(n)).call(a,(e=>n[e]))).call(t,(e=>(0,R.Hz)(super.getDb(),e)));return await(0,R.zm)(super.getDb(),[...i,...(0,R.pS)(super.getDb(),r)],(async t=>this.rawGetAllAccountingAddresses(t,n,e,r)))})),A()(this,"rawGetStakingKey",(async(e,t,a,r)=>{var n;const i=(await this.rawGetAllAccountingAddresses(e,t,a,r))[0],s=c()(n=i.addrs).call(n,(e=>e.Type===H.dq.CARDANO_REWARD));if(null==s)throw new R.md("GetAllAccounting::rawGetStakingKey no account found at account derivation");return{row:i.row,addressing:i.addressing,addr:s}})),A()(this,"getStakingKey",(async e=>{var t,a;const r=this.getParent().getDerivationTables(),n=I()({GetPathWithSpecific:W.LY,GetAddress:W.t9,GetDerivationSpecific:O.n}),i=g()(t=k()(a=v()(n)).call(a,(e=>n[e]))).call(t,(e=>(0,R.Hz)(super.getDb(),e)));return await(0,R.zm)(super.getDb(),[...i,...(0,R.pS)(super.getDb(),r)],(async t=>this.rawGetStakingKey(t,n,e,r)))}))}})),le=oe;function de(e){if(e instanceof le)return e}const ce=(0,E.Mixin)((e=>class extends e{})),ue=ce;function pe(e){if(e instanceof ue)return e}const he=(0,E.Mixin)((e=>class extends e{constructor(...e){super(...e),A()(this,"rawAddBip44FromPublic",(async(e,t,a,r)=>{const n=await t.GetPublicDeriver.get(super.getDb(),e,super.getPublicDeriverId());if(void 0===n)throw new Error("AddBip44FromPublic::rawAddBip44FromPublic pubDeriver");await t.AddDerivationTree.excludingParent(super.getDb(),e,{derivationId:n.KeyDerivationId,children:a.tree},r,this.getParent().getPublicDeriverLevel());const i=ve(this);null!=i&&await(0,S._k)(e,{GetPathWithSpecific:t.GetPathWithSpecific,GetDerivationSpecific:t.GetDerivationSpecific,GetDerivationsByPath:t.GetDerivationsByPath,ModifyDisplayCutoff:t.ModifyDisplayCutoff,GetKeyDerivation:t.GetKeyDerivation},{publicDeriverLevel:this.getParent().getPublicDeriverLevel(),displayCutoffInstance:i,tree:a.tree},r)})),A()(this,"addBip44FromPublic",(async e=>{var t,a;const r=this.getParent().getDerivationTables(),n=I()({GetPublicDeriver:B.oR,AddDerivationTree:L.if,ModifyDisplayCutoff:_.J,GetDerivationsByPath:W.q8,GetPathWithSpecific:W.LY,GetDerivationSpecific:O.n,GetKeyDerivation:W.qV}),i=g()(t=k()(a=v()(n)).call(a,(e=>n[e]))).call(t,(e=>(0,R.Hz)(super.getDb(),e)));return await(0,R.zm)(super.getDb(),[...i,...(0,R.pS)(super.getDb(),r)],(async t=>this.rawAddBip44FromPublic(t,n,e,r)))}))}})),ye=(0,E.Mixin)((e=>class extends e{constructor(...e){super(...e),A()(this,"rawPopAddress",(async(e,t,a,r)=>{const n=await t.ModifyDisplayCutoff.pop(super.getDb(),e,{pubDeriverKeyDerivationId:super.getDerivationId(),derivationLevel:this.getParent().getPublicDeriverLevel(),pathToLevel:[0]},r);if(void 0===n)throw new $.ke;const i=(await t.GetAddress.fromCanonical(super.getDb(),e,[n.row.KeyDerivationId],void 0)).get(n.row.KeyDerivationId);if(null==i)throw new Error("DisplayCutoffMixin::popAddress should never happen");return{...n,addrs:i}})),A()(this,"popAddress",(async e=>{var t,a;const r=this.getParent().getDerivationTables(),n=I()({ModifyDisplayCutoff:_.J,GetAddress:W.t9}),i=g()(t=k()(a=v()(n)).call(a,(e=>n[e]))).call(t,(e=>(0,R.Hz)(super.getDb(),e)));return await(0,R.zm)(super.getDb(),[...i,...(0,R.pS)(super.getDb(),r)],(async t=>this.rawPopAddress(t,n,e,r)))})),A()(this,"rawGetCutoff",(async(e,t,a,r)=>{const n=this.getParent().getPublicDeriverLevel(),i=(await(async()=>{if(n===M.CZ.CHAIN.level){const a=(await t.GetDerivationSpecific.get(super.getDb(),e,[super.getDerivationId()],M.CZ.CHAIN.level,r))[0];if(void 0===a)throw new Error("DisplayCutoffMixin::rawGetCutoff missing chain. Should never happen");return a}if(n===M.CZ.ACCOUNT.level)return(await t.GetPathWithSpecific.getPath(super.getDb(),e,{pubDeriverKeyDerivationId:super.getDerivationId(),pathToLevel:[0],level:M.CZ.CHAIN.level},(async a=>{const n=(await t.GetDerivationSpecific.get(super.getDb(),e,[a],M.CZ.CHAIN.level,r))[0];if(void 0===n)throw new Error("DisplayCutoffMixin::rawGetCutoff missing chain. Should never happen");return n}))).levelSpecific;throw new Error("DisplayCutoffMixin::rawGetCutoff incorrect pubderiver level")})()).DisplayCutoff;if(null==i)throw new Error("DisplayCutoffMixin::rawGetCutoff null cutoff");return i})),A()(this,"getCutoff",(async e=>{var t,a;const r=this.getParent().getDerivationTables(),n=I()({GetPathWithSpecific:W.LY,GetDerivationSpecific:O.n}),i=g()(t=k()(a=v()(n)).call(a,(e=>n[e]))).call(t,(e=>(0,R.Hz)(super.getDb(),e)));return await(0,R.zm)(super.getDb(),[...i,...(0,R.pS)(super.getDb(),r)],(async t=>this.rawGetCutoff(t,n,e,r)))})),A()(this,"rawSetCutoff",(async(e,t,a)=>{const r=this.getParent().getPublicDeriverLevel(),n=await(async()=>{if(r===M.CZ.CHAIN.level){const a=await t.GetKeyDerivation.get(super.getDb(),e,super.getDerivationId());if(null==a)throw new Error("ModifyDisplayCutoff::pop no derivation row found for chain");return a}if(r===M.CZ.ACCOUNT.level){const a=await t.GetDerivationsByPath.getSinglePath(super.getDb(),e,super.getDerivationId(),[0]);return a[a.length-1]}throw new Error("ModifyDisplayCutoff::pop incorrect pubderiver level")})();await t.ModifyDisplayCutoff.set(super.getDb(),e,{derivationId:n.KeyDerivationId,newIndex:a.newIndex})})),A()(this,"setCutoff",(async e=>{var t,a;const r=I()({ModifyDisplayCutoff:_.J,GetDerivationsByPath:W.q8,GetKeyDerivation:W.qV}),n=g()(t=k()(a=v()(r)).call(a,(e=>r[e]))).call(t,(e=>(0,R.Hz)(super.getDb(),e)));return await(0,R.zm)(super.getDb(),n,(async t=>this.rawSetCutoff(t,r,e)))}))}})),we=ye;function ve(e){if(e instanceof we)return e}const fe=(0,E.Mixin)((e=>class extends e{constructor(...e){super(...e),A()(this,"rawPickReceive",(async(e,t,a,r)=>{var n;const i=b()(n=a.addrs).call(n,(e=>e.Type===H.dq.CARDANO_LEGACY));if(1!==i.length)throw new Error("CardanoBip44PickReceive::rawPickReceive no legacy address found");return{addr:i[0],row:a.row,addressing:a.addressing}})),A()(this,"pickReceive",(async e=>{var t,a;const r=ae(this),n=null==r?new(C()):r.getParent().getDerivationTables(),i=I()({GetPathWithSpecific:W.LY,GetAddress:W.t9,GetDerivationSpecific:O.n}),s=g()(t=k()(a=v()(i)).call(a,(e=>i[e]))).call(t,(e=>(0,R.Hz)(super.getDb(),e)));return await(0,R.zm)(super.getDb(),[...s,...(0,R.pS)(super.getDb(),n)],(async t=>this.rawPickReceive(t,i,e,n)))}))}})),Ie=(0,E.Mixin)((e=>class extends e{constructor(...e){super(...e),A()(this,"rawPickReceive",(async(e,t,a,r)=>{var n,i;const s=await this.rawGetStakingKey(e,t,void 0,r),o=(0,K.unwrapStakingKey)(s.addr.Hash).to_keyhash();if(null==o)throw new Error("Cip1852PickReceive::rawPickReceive internal address is a script");const d=o.to_hex(),c=b()(n=b()(i=a.addrs).call(i,(e=>e.Type===H.dq.CARDANO_BASE))).call(n,(e=>{var t;return l()(t=e.Hash).call(t,d)}));if(1!==c.length)throw new Error("Cip1852PickReceive::rawPickReceive no base address found");return{addr:c[0],row:a.row,addressing:a.addressing}})),A()(this,"pickReceive",(async e=>{var t,a;const r=ae(this),n=null==r?new(C()):r.getParent().getDerivationTables(),i=I()({GetPathWithSpecific:W.LY,GetAddress:W.t9,GetDerivationSpecific:O.n}),s=g()(t=k()(a=v()(i)).call(a,(e=>i[e]))).call(t,(e=>(0,R.Hz)(super.getDb(),e)));return await(0,R.zm)(super.getDb(),[...s,...(0,R.pS)(super.getDb(),n)],(async t=>this.rawPickReceive(t,i,e,n)))}))}})),Te=(0,E.Mixin)((e=>class extends e{})),ge=Te;function me(e){if(e instanceof ge)return e}const be=(0,E.Mixin)((e=>class extends e{constructor(...e){super(...e),A()(this,"rawGetAddressesForChain",(async(e,t,a,r)=>{if(this.getParent().getPublicDeriverLevel()!==M.CZ.ACCOUNT.level)throw new Error("HasUtxoChains::rawGetAddressesForChain incorrect pubderiver level");return(0,S.sC)(super.getDb(),e,t,{startingDerivation:super.getDerivationId(),derivationLevel:this.getParent().getPublicDeriverLevel(),commonPrefix:super.getPathToPublic(),queryPath:[a.chainId,null]},r)})),A()(this,"getAddressesForChain",(async e=>{var t,a;const r=this.getParent().getDerivationTables(),n=I()({GetAddress:W.t9,GetPathWithSpecific:W.LY,GetDerivationSpecific:O.n}),i=g()(t=k()(a=v()(n)).call(a,(e=>n[e]))).call(t,(e=>(0,R.Hz)(super.getDb(),e)));return await(0,R.zm)(super.getDb(),[...i,...(0,R.pS)(super.getDb(),r)],(async t=>this.rawGetAddressesForChain(t,n,e,r)))})),A()(this,"rawNextInternal",(async(e,t,a,r)=>{const n={GetAddress:t.GetAddress,GetPathWithSpecific:t.GetPathWithSpecific,GetDerivationSpecific:t.GetDerivationSpecific},i=await this.rawGetAddressesForChain(e,n,{chainId:V.OC.INTERNAL},r),s=await(0,S.yN)(super.getDb(),e,{GetUtxoTxOutputsWithTx:t.GetUtxoTxOutputsWithTx},{addressesForChain:i,networkId:this.getParent().getNetworkInfo().NetworkId});return null==s.addressInfo?{addressInfo:void 0,index:s.index}:{addressInfo:await this.rawPickReceive(e,n,s.addressInfo,r),index:s.index}})),A()(this,"nextInternal",(async e=>{var t,a;const r=this.getParent().getDerivationTables(),n=I()({GetUtxoTxOutputsWithTx:U.NW,GetAddress:W.t9,GetPathWithSpecific:W.LY,GetDerivationSpecific:O.n}),i=g()(t=k()(a=v()(n)).call(a,(e=>n[e]))).call(t,(e=>(0,R.Hz)(super.getDb(),e)));return await(0,R.zm)(super.getDb(),i,(async t=>this.rawNextInternal(t,n,e,r)))}))}})),De=be;function ke(e){if(e instanceof De)return e}const xe=(0,E.Mixin)((e=>class extends e{constructor(...e){super(...e),A()(this,"rawGetPublicKey",(async(e,t,a)=>{const r=await t.GetKeyForPublicDeriver.get(super.getDb(),e,super.getPublicDeriverId(),!0,!1);if(null==r.publicKey)throw new R.md("GetPublicKey::rawGetPublicKey publicKey");return r.publicKey})),A()(this,"getPublicKey",(async e=>{var t,a;const r=I()({GetKeyForPublicDeriver:B.NX}),n=g()(t=k()(a=v()(r)).call(a,(e=>r[e]))).call(t,(e=>(0,R.Hz)(super.getDb(),e)));return await(0,R.zm)(super.getDb(),n,(async t=>this.rawGetPublicKey(t,r,e)))})),A()(this,"rawChangePubDeriverPassword",(async(e,t,a)=>{const r=await this.rawGetPublicKey(e,{GetKeyForPublicDeriver:t.GetKeyForPublicDeriver},void 0);return(0,G.kQ)(super.getDb(),e,{ModifyKey:t.ModifyKey},{...a,oldKeyRow:r})})),A()(this,"changePubDeriverPassword",(async e=>{var t,a;const r=I()({ModifyKey:F.f1,GetKeyForPublicDeriver:B.NX}),n=g()(t=k()(a=v()(r)).call(a,(e=>r[e]))).call(t,(e=>(0,R.Hz)(super.getDb(),e)));return await(0,R.zm)(super.getDb(),n,(async t=>this.rawChangePubDeriverPassword(t,r,e)))}))}})),Ce=xe;function Pe(e){if(e instanceof Ce)return e}const Ae=(0,E.Mixin)((e=>class extends e{constructor(...e){super(...e),A()(this,"rawGetSigningKey",(async(e,t,a)=>{const r=this.getParent().getSigningLevel();if(null===r)throw new R.md("GetSigningKey::getSigningKey signingLevel=null");const n=this.getParent().getPublicDeriverLevel()-r;if(n<0)throw new R.md("GetSigningKey::getSigningKey levelDifference<0");const i=await t.GetPublicDeriver.get(super.getDb(),e,super.getPublicDeriverId());if(void 0===i)throw new Error("GetSigningKey::getSigningKey pubDeriver");const s=await t.GetKeyDerivation.get(super.getDb(),e,i.KeyDerivationId);if(void 0===s)throw new Error("GetSigningKey::getSigningKey keyDerivation");const o=await t.GetDerivationsByPath.getParentPath(super.getDb(),e,{startingKey:s,numLevels:n}),l=o[0].PrivateKeyId;if(null===l)throw new Error("GetSigningKey::getSigningKey privateKeyId");const d=await t.GetKey.get(super.getDb(),e,l);if(void 0===d)throw new Error("GetSigningKey::getSigningKey privateKeyRow");return{level:r,path:o,row:d}})),A()(this,"getSigningKey",(async e=>{var t,a;const r=I()({GetDerivationsByPath:W.q8,GetPublicDeriver:B.oR,GetKeyDerivation:W.qV,GetKey:W.RN}),n=g()(t=k()(a=v()(r)).call(a,(e=>r[e]))).call(t,(e=>(0,R.Hz)(super.getDb(),e)));return await(0,R.zm)(super.getDb(),n,(async t=>this.rawGetSigningKey(t,r,e)))})),A()(this,"rawChangeSigningKeyPassword",(async(e,t,a)=>{const r=await this.rawGetSigningKey(e,{GetDerivationsByPath:t.GetDerivationsByPath,GetKey:t.GetKey,GetKeyDerivation:t.GetKeyDerivation,GetPublicDeriver:t.GetPublicDeriver},void 0);return(0,G.kQ)(super.getDb(),e,{ModifyKey:t.ModifyKey},{...a,oldKeyRow:r.row})})),A()(this,"changeSigningKeyPassword",(async e=>{var t,a;const r=I()({GetDerivationsByPath:W.q8,GetPublicDeriver:B.oR,GetKeyDerivation:W.qV,GetKey:W.RN,ModifyKey:F.f1}),n=g()(t=k()(a=v()(r)).call(a,(e=>r[e]))).call(t,(e=>(0,R.Hz)(super.getDb(),e)));return await(0,R.zm)(super.getDb(),n,(async t=>this.rawChangeSigningKeyPassword(t,r,e)))})),A()(this,"normalizeKey",(async e=>{var t;const a=s()(t=e.path).call(t,1),r=k()(a).call(a,(e=>{if(null===e.Index)throw new Error("GetSigningKey::normalizeKey null index");return e.Index}));return(0,G.CZ)({privateKeyRow:e.row,password:e.password,path:r})}))}})),Ee=Ae;function Se(e){if(e instanceof Ee)return e}const Ke=(0,E.Mixin)((e=>class extends e{constructor(...e){super(...e),A()(this,"rawScanAccount",(async(e,t,a,r)=>{const i=Z.RustModule.WalletV2.Bip44AccountPublic.new(Z.RustModule.WalletV2.PublicKey.from_hex(a.accountPublicKey),Z.RustModule.WalletV2.DerivationScheme.v2()),s=this.getParent().getNetworkInfo();if(null==s.BaseConfig[0].ByronNetworkId)throw new Error("ScanLegacyCardanoAccountUtxo::rawScanAccount missing Byron network id");const{ByronNetworkId:o}=s.BaseConfig[0];return await(0,q.Mo)({generateInternalAddresses:(0,j.H)(i.bip44_chain(!1),o),generateExternalAddresses:(0,j.H)(i.bip44_chain(!0),o),network:s,lastUsedInternal:a.lastUsedInternal,lastUsedExternal:a.lastUsedExternal,checkAddressesInUse:a.checkAddressesInUse,addByHash:(0,N.dw)(new(n())([...a.internalAddresses,...a.externalAddresses])),type:H.dq.CARDANO_LEGACY})}))}})),Ge=(0,E.Mixin)((e=>class extends e{constructor(...e){super(...e),A()(this,"rawScanAccount",(async(e,t,a,r)=>{const i=await this.rawGetStakingKey(e,t,void 0,r),s=Z.RustModule.WalletV4.Bip32PublicKey.from_hex(a.accountPublicKey),o=(0,X.c)({addressing:i.addressing,startingFrom:{level:this.getParent().getPublicDeriverLevel(),key:s}}),l=this.getParent().getNetworkInfo();return await(0,z.co)({accountPublicKey:a.accountPublicKey,lastUsedInternal:a.lastUsedInternal,lastUsedExternal:a.lastUsedExternal,checkAddressesInUse:a.checkAddressesInUse,network:l,addByHash:(0,N.dw)(new(n())([...a.internalAddresses,...a.externalAddresses])),stakingKey:o.to_raw_key()})}))}})),Ne=(0,E.Mixin)((e=>class extends e{constructor(...e){super(...e),A()(this,"rawScanAddresses",(async(e,t,a,r)=>{const n=await this.rawGetPublicKey(e,{GetKeyForPublicDeriver:t.GetKeyForPublicDeriver},void 0),i=(0,G.IM)(n,null),s=await this.rawGetAddressesForChain(e,{GetAddress:t.GetAddress,GetPathWithSpecific:t.GetPathWithSpecific,GetDerivationSpecific:t.GetDerivationSpecific},{chainId:V.OC.INTERNAL},r),o=await(0,S.yN)(super.getDb(),e,{GetUtxoTxOutputsWithTx:t.GetUtxoTxOutputsWithTx},{addressesForChain:s,networkId:this.getParent().getNetworkInfo().NetworkId}),l=await this.rawGetAddressesForChain(e,{GetAddress:t.GetAddress,GetPathWithSpecific:t.GetPathWithSpecific,GetDerivationSpecific:t.GetDerivationSpecific},{chainId:V.OC.EXTERNAL},r),d=await(0,S.yN)(super.getDb(),e,{GetUtxoTxOutputsWithTx:t.GetUtxoTxOutputsWithTx},{addressesForChain:l,networkId:this.getParent().getNetworkInfo().NetworkId}),c=await this.rawScanAccount(e,{GetAddress:t.GetAddress,GetPathWithSpecific:t.GetPathWithSpecific,GetDerivationSpecific:t.GetDerivationSpecific},{accountPublicKey:i,lastUsedInternal:o.index-1,lastUsedExternal:d.index-1,checkAddressesInUse:a.checkAddressesInUse,internalAddresses:g()(s).call(s,(e=>{var t;return k()(t=e.addrs).call(t,(e=>e.AddressId))})),externalAddresses:g()(l).call(l,(e=>{var t;return k()(t=e.addrs).call(t,(e=>e.AddressId))}))},r);await this.rawAddBip44FromPublic(e,{GetPublicDeriver:t.GetPublicDeriver,AddDerivationTree:t.AddDerivationTree,ModifyDisplayCutoff:t.ModifyDisplayCutoff,GetDerivationsByPath:t.GetDerivationsByPath,GetPathWithSpecific:t.GetPathWithSpecific,GetDerivationSpecific:t.GetDerivationSpecific,GetKeyDerivation:t.GetKeyDerivation},{tree:c},r)})),A()(this,"scanAddresses",(async e=>{var t,a;const r=this.getParent().getDerivationTables(),n=I()({GetKeyForPublicDeriver:B.NX,GetAddress:W.t9,GetPathWithSpecific:W.LY,GetUtxoTxOutputsWithTx:U.NW,ModifyAddress:F.ad,GetPublicDeriver:B.oR,AddDerivationTree:L.if,GetDerivationsByPath:W.q8,ModifyDisplayCutoff:_.J,GetDerivationSpecific:O.n,GetKeyDerivation:W.qV}),i=g()(t=k()(a=v()(n)).call(a,(e=>n[e]))).call(t,(e=>(0,R.Hz)(super.getDb(),e)));return await(0,R.zm)(super.getDb(),[...i,...(0,R.pS)(super.getDb(),r)],(async t=>this.rawScanAddresses(t,n,e,r)))}))}}));(0,E.Mixin)((e=>class extends e{constructor(...e){super(...e),A()(this,"rawScanAddresses",(async(e,t,a,r)=>{const n=await this.rawGetPublicKey(e,{GetKeyForPublicDeriver:t.GetKeyForPublicDeriver},void 0),i=(0,G.IM)(n,null),s=await(0,S.sC)(super.getDb(),e,{GetAddress:t.GetAddress,GetPathWithSpecific:t.GetPathWithSpecific,GetDerivationSpecific:t.GetDerivationSpecific},{startingDerivation:super.getDerivationId(),derivationLevel:this.getParent().getPublicDeriverLevel(),commonPrefix:super.getPathToPublic(),queryPath:[null]},r),o=await(0,S.yN)(super.getDb(),e,{GetUtxoTxOutputsWithTx:t.GetUtxoTxOutputsWithTx},{addressesForChain:s,networkId:this.getParent().getNetworkInfo().NetworkId}),l=await this.rawScanChain(e,{GetAddress:t.GetAddress,GetPathWithSpecific:t.GetPathWithSpecific,GetDerivationSpecific:t.GetDerivationSpecific},{chainPublicKey:i,lastUsedIndex:o.index-1,checkAddressesInUse:a.checkAddressesInUse,addresses:g()(s).call(s,(e=>{var t;return k()(t=e.addrs).call(t,(e=>e.AddressId))}))},r);await this.rawAddBip44FromPublic(e,{GetPublicDeriver:t.GetPublicDeriver,AddDerivationTree:t.AddDerivationTree,ModifyDisplayCutoff:t.ModifyDisplayCutoff,GetDerivationsByPath:t.GetDerivationsByPath,GetPathWithSpecific:t.GetPathWithSpecific,GetDerivationSpecific:t.GetDerivationSpecific,GetKeyDerivation:t.GetKeyDerivation},{tree:l},r)})),A()(this,"scanAddresses",(async e=>{var t,a;const r=this.getParent().getDerivationTables(),n=I()({GetKeyForPublicDeriver:B.NX,GetAddress:W.t9,GetPathWithSpecific:W.LY,GetUtxoTxOutputsWithTx:U.NW,ModifyAddress:F.ad,GetPublicDeriver:B.oR,AddDerivationTree:L.if,GetDerivationsByPath:W.q8,ModifyDisplayCutoff:_.J,GetDerivationSpecific:O.n,GetKeyDerivation:W.qV}),i=g()(t=k()(a=v()(n)).call(a,(e=>n[e]))).call(t,(e=>(0,R.Hz)(super.getDb(),e)));return await(0,R.zm)(super.getDb(),[...i,...(0,R.pS)(super.getDb(),r)],(async t=>this.rawScanAddresses(t,n,e,r)))}))}}));const Re=(0,E.Mixin)((e=>class extends e{constructor(...e){super(...e),A()(this,"rawGetUtxoBalance",(async(e,t,a,r)=>{const n=await this.rawGetAllUtxos(e,{GetAddress:t.GetAddress,GetPathWithSpecific:t.GetPathWithSpecific,GetUtxoTxOutputsWithTx:t.GetUtxoTxOutputsWithTx,GetUtxoAtSafePoint:t.GetUtxoAtSafePoint,GetUtxoDiffToBestBlock:t.GetUtxoDiffToBestBlock,GetToken:t.GetToken,GetDerivationSpecific:t.GetDerivationSpecific},void 0,r);return(0,S.JS)(k()(n).call(n,(e=>e.output)),this.getParent().getDefaultToken())})),A()(this,"getUtxoBalance",(async e=>{var t,a;const r=this.getParent().getDerivationTables(),n=I()({GetPathWithSpecific:W.LY,GetAddress:W.t9,GetUtxoTxOutputsWithTx:U.NW,GetUtxoAtSafePoint:J.r,GetUtxoDiffToBestBlock:J.S,GetToken:W.YT,GetDerivationSpecific:O.n}),i=g()(t=k()(a=v()(n)).call(a,(e=>n[e]))).call(t,(e=>(0,R.Hz)(super.getDb(),e)));return await(0,R.zm)(super.getDb(),[...i,...(0,R.pS)(super.getDb(),r)],(async e=>this.rawGetUtxoBalance(e,n,void 0,r)))}))}})),Be=(0,E.Mixin)((e=>class extends e{})),_e=Be;function Le(e){if(e instanceof _e)return e}const Oe=(0,E.Mixin)((e=>class extends e{constructor(...e){super(...e),A()(this,"getBalance",(async e=>await this.getUtxoBalance(e)))}})),Me=Oe;function Ue(e){if(e instanceof Me)return e}const We={2147485463:async function(e){let t,a=e.startClass;a=ee(a),a=te(a),a=re(a),a=ne(a);{var r,n;const a=I()({GetKeyForPublicDeriver:B.NX}),i=g()(r=k()(n=v()(a)).call(n,(e=>a[e]))).call(r,(t=>(0,R.Hz)(e.db,t)));t=await(0,R.zm)(e.db,i,(async t=>{const r=await a.GetKeyForPublicDeriver.get(e.db,t,e.pubDeriver.PublicDeriverId,!0,!1);if(void 0===r.publicKey)throw new R.md("addTraitsForCardanoBip44 publicKey");return r.publicKey}))}return a=he(a),a=Te(fe(a)),e.conceptualWallet.getPublicDeriverLevel()===M.CZ.CHAIN.level&&(a=ye(a)),e.conceptualWallet.getPublicDeriverLevel()===M.CZ.ACCOUNT.level?(a=ye(a),a=be(a),null!==t&&(a=xe(a),a=Ke(a),a=Ne(a),a=Be(a))):null!==t&&(a=xe(a)),null!==e.conceptualWallet.getSigningLevel()&&(a=Ae(a)),a=Re(a),a=Oe(a),{finalClass:a}}};function He(e){return null!=We[e]}async function Fe(e){const t=e.conceptualWallet.getNetworkInfo().CoinType.toString(),a=We[t];if(null==a)throw new Error(`No trait function found for coin type: ${t}`);const{finalClass:r}=await a(e);let n;{var i,o;const t=I()({GetDerivationsByPath:W.q8}),a=g()(i=k()(o=v()(t)).call(o,(e=>t[e]))).call(i,(t=>(0,R.Hz)(e.db,t)));n=await(0,R.zm)(e.db,a,(async a=>{const r=e.conceptualWallet.getPublicDeriverLevel()-M.CZ.ROOT.level,n=await t.GetDerivationsByPath.getParentPath(e.db,a,{startingKey:e.pubDeriverKeyDerivation,numLevels:r}),i=[];for(const e of s()(n).call(n,1)){if(null==e.Index)throw new Error("addTraitsForBip44Child null index");i.push(e.Index)}return i}))}return{finalClass:r,pathToPublic:n}}async function je(e,t,a,r,n){let i,o,l=n;l=ee(l),l=te(l),l=re(l),l=ne(l),l=ce(oe(l));{var d,c;const a=I()({GetKeyForPublicDeriver:B.NX}),r=g()(d=k()(c=v()(a)).call(c,(e=>a[e]))).call(d,(t=>(0,R.Hz)(e,t)));i=await(0,R.zm)(e,r,(async r=>{const n=await a.GetKeyForPublicDeriver.get(e,r,t.PublicDeriverId,!0,!1);if(void 0===n.publicKey)throw new R.md("addTraitsForCip1852Child publicKey");return n.publicKey}))}if(l=he(l),!(0,Y.isCardanoHaskell)(r.getNetworkInfo()))throw new Error("addTraitsForCip1852Child don't know how to pick receive address");if(l=Te(Ie(l)),r.getPublicDeriverLevel()===M.CZ.CHAIN.level&&(l=ye(l)),r.getPublicDeriverLevel()===M.CZ.ACCOUNT.level){if(l=ye(l),l=be(l),null!==i){if(l=xe(l),!(0,Y.isCardanoHaskell)(r.getNetworkInfo()))throw new Error("addTraitsForCip1852Child don't know how to scan for network");l=Ge(l),l=Ne(l),l=Be(l)}}else null!==i&&(l=xe(l));null!==r.getSigningLevel()&&(l=Ae(l)),l=Re(l),l=Oe(l);{var u,p;const t=I()({GetDerivationsByPath:W.q8}),n=g()(u=k()(p=v()(t)).call(p,(e=>t[e]))).call(u,(t=>(0,R.Hz)(e,t)));o=await(0,R.zm)(e,n,(async n=>{const i=r.getPublicDeriverLevel()-M.CZ.ROOT.level,o=await t.GetDerivationsByPath.getParentPath(e,n,{startingKey:a,numLevels:i}),l=[];for(const e of s()(o).call(o,1)){if(null==e.Index)throw new Error("addTraitsForCip1852Child null index");l.push(e.Index)}return l}))}return{finalClass:l,pathToPublic:o}}},99546:(e,t,a)=>{"use strict";a.d(t,{IM:()=>D,CZ:()=>b,kQ:()=>k}),a(97143);var r=a(13069),n=a(52760),i=a(87672),s=a.n(i),o=a(17534),l=a(86335),d=a(37786),c=a(58334),u=a(90649),p=a(48764).Buffer;class h{constructor(e){s()(this,"key",void 0),this.key=e}toBuffer(){return p.from(this.key.as_bytes())}getType(){return n._.BIP32ED25519}verify(e,t){return l.RustModule.WasmScope((a=>this.key.to_raw_key().verify(e,a.WalletV4.Ed25519Signature.from_bytes(t))))}static fromBuffer(e){const t=l.RustModule.WalletV4.Bip32PublicKey.from_bytes(e);return h.fromV3Key(t)}static fromV3Key(e){return new(T(f(h)))(e)}}class y{constructor(e){s()(this,"key",void 0),this.key=e}toBuffer(){return p.from(this.key.as_bytes())}getType(){return n._.BIP32ED25519}sign(e){return(0,u.hexToBytes)(this.key.to_raw_key().sign(e).to_hex())}toPublic(){const e=this.key.to_public();return h.fromV3Key(e)}static fromBuffer(e){const t=l.RustModule.WalletV4.Bip32PrivateKey.from_bytes(e);return y.fromV3Key(t)}static fromV3Key(e){return new(I(f(y)))(e)}}class w{constructor(e){s()(this,"key",void 0),this.key=e}toBuffer(){return(0,c.decode)(this.key.toBase58())}getType(){return n._.BIP32}verify(e,t){return this.key.verify(e,t)}static fromBuffer(e){const t=(0,d.fromBase58)((0,c.encode)(e));return w.fromBip32(t)}static fromBip32(e){return new(T(f(w)))(e)}}class v{constructor(e){s()(this,"key",void 0),this.key=e}toBuffer(){return(0,c.decode)(this.key.toBase58())}getType(){return n._.BIP32}sign(e){return this.key.sign(e)}toPublic(){const e=(0,d.fromPublicKey)(this.key.publicKey,this.key.chainCode);return w.fromBip32(e)}static fromBuffer(e){const t=(0,d.fromBase58)((0,c.encode)(e));return v.fromBip32(t)}static fromBip32(e){return new(I(f(v)))(e)}}const f=(0,o.Mixin)((e=>class extends e{})),I=(0,o.Mixin)((e=>class extends e{})),T=(0,o.Mixin)((e=>class extends e{}));function g(e,t){if(e instanceof y)return y.fromV3Key(e.key.derive(t));if(e instanceof h)return h.fromV3Key(e.key.derive(t));if(e instanceof v)return v.fromBip32(e.key.derive(t));if(e instanceof w)return w.fromBip32(e.key.derive(t));throw new Error("Unexpected class in deriveKey")}var m=a(33913);function b(e){const t=function(e){const t=D(e.keyRow,e.password);switch(e.keyRow.Type){case n._.BIP32ED25519:if(e.subkind===n.h.Private)return y.fromBuffer((0,u.hexToBytes)(t));if(e.subkind===n.h.Public)return h.fromBuffer((0,u.hexToBytes)(t));throw new Error(`keyRowToClass unexpected subtype ${e.keyRow.Type}-${e.subkind}`);case n._.BIP32:if(e.subkind===n.h.Private)return v.fromBuffer((0,u.hexToBytes)(t));if(e.subkind===n.h.Public)return w.fromBuffer((0,u.hexToBytes)(t));throw new Error(`keyRowToClass unexpected subtype ${e.keyRow.Type}-${e.subkind}`);default:throw new Error(`keyRowToClass unexpected type ${e.keyRow.Type}`)}}({keyRow:e.privateKeyRow,subkind:n.h.Private,password:e.password}),a=function(e){if(e instanceof I)return e}(function(e,t){let a=e;for(let e=0;e<t.length;e++)a=g(a,t[e]);return a}(t,e.path));if(null==a)throw new Error("Should never happen");return{prvKeyHex:(0,u.bytesToHex)(a.toBuffer()),pubKeyHex:(0,u.bytesToHex)(a.toPublic().toBuffer())}}function D(e,t){let a;if(e.IsEncrypted){if(null===t)throw new m.UZ;a=(0,u.bytesToHex)((0,r.A)(t,e.Hash))}else a=e.Hash;return a}async function k(e,t,a,n){const i=D(n.oldKeyRow,n.oldPassword);let s=i;null!==n.newPassword&&(s=(0,r.x)(n.newPassword,(0,u.hexToBytes)(i)));const o={KeyId:n.oldKeyRow.KeyId,Hash:s,IsEncrypted:null!==n.newPassword,PasswordLastUpdate:n.currentTime,Type:n.oldKeyRow.Type};return await a.ModifyKey.update(e,t,o)}},40026:(e,t,a)=>{"use strict";a.d(t,{H:()=>o,c:()=>l});var r=a(2991),n=a.n(r),i=a(86335),s=a(38079);function o(e,t){const a=i.RustModule.WalletV2.BlockchainSettings.from_json({protocol_magic:t});return t=>n()(t).call(t,(t=>e.address_key(i.RustModule.WalletV2.AddressKeyIndex.new(t)).bootstrap_era_address(a).to_base58()))}async function l(e,t,a){return await e({...t,address:{type:s.dq.CARDANO_LEGACY,data:a}}),{KeyDerivationId:t.keyDerivationId}}},88903:(e,t,a)=>{"use strict";a.d(t,{dh:()=>m,Jf:()=>b,co:()=>k});var r=a(93476),n=a.n(r),i=a(51938),s=a.n(i),o=a(51942),l=a.n(o),d=a(32366),c=a.n(d),u=a(2991),p=a.n(u),h=a(46689),y=a(66905),w=a(86335),v=a(38079),f=a(84174),I=a(36018);const T=50;function g(e){return t=>p()(t).call(t,(t=>e.derive(t).to_raw_key().hash().to_bech32(I.a.PAYMENT_KEY_HASH)))}async function m(e,t,a,r){const n=w.RustModule.WalletV4.RewardAddress.new(r,w.RustModule.WalletV4.Credential.from_keyhash(a.hash()));return await e({...t,address:{type:v.dq.CARDANO_REWARD,data:n.to_address().to_hex()}}),{KeyDerivationId:t.keyDerivationId}}async function b(e,t,a,r,n){const i=w.RustModule.WalletV4.EnterpriseAddress.new(n,w.RustModule.WalletV4.Credential.from_keyhash(r));if(null==i)throw new Error("addShelleyUtxoAddress address is not an enterprise address");const s=w.RustModule.WalletV4.BaseAddress.new(n,i.payment_cred(),w.RustModule.WalletV4.Credential.from_keyhash(a.hash()));return await e({...t,address:{type:v.dq.CARDANO_ENTERPRISE,data:i.to_address().to_hex()}}),await e({...t,address:{type:v.dq.CARDANO_BASE,data:s.to_address().to_hex()}}),{KeyDerivationId:t.keyDerivationId}}async function D(e){var t;const a=await(0,h.z)(e.generateAddressFunc,e.lastUsedIndex,y.C4,T,e.checkAddressesInUse,e.network),r=c()(t=(0,f.getCardanoHaskellBaseConfig)(e.network)).call(t,((e,t)=>l()(e,t)),{});return p()(a).call(a,(({address:t,isUsed:a},n)=>({index:n+e.lastUsedIndex+1,insert:async a=>await b(e.addByHash,a,e.stakingKey,w.RustModule.WalletV4.Ed25519KeyHash.from_bech32(t),s()(r.ChainNetworkId,10)),isUsed:a,address:t})))}async function k(e){var t;const a=w.RustModule.WalletV4.Bip32PublicKey.from_hex(e.accountPublicKey),r=c()(t=(0,f.getCardanoHaskellBaseConfig)(e.network)).call(t,((e,t)=>l()(e,t)),{}),i=await async function(e){var t;const a=await D({generateAddressFunc:e.generateExternalAddresses,lastUsedIndex:e.lastUsedExternal,network:e.network,checkAddressesInUse:e.checkAddressesInUse,addByHash:e.addByHash,stakingKey:e.stakingKey}),r=await D({generateAddressFunc:e.generateInternalAddresses,lastUsedIndex:e.lastUsedInternal,network:e.network,checkAddressesInUse:e.checkAddressesInUse,addByHash:e.addByHash,stakingKey:e.stakingKey}),i=p()(t=[0]).call(t,(t=>({index:t,insert:async t=>await m(e.addByHash,t,e.stakingKey,e.chainNetworkId)})));return[{index:y.OC.EXTERNAL,insert:e=>n().resolve({KeyDerivationId:e.keyDerivationId,DisplayCutoff:0}),children:a},{index:y.OC.INTERNAL,insert:e=>n().resolve({KeyDerivationId:e.keyDerivationId,DisplayCutoff:null}),children:r},{index:y.OC.CHIMERIC_ACCOUNT,insert:e=>n().resolve({KeyDerivationId:e.keyDerivationId,DisplayCutoff:null}),children:i}]}({generateInternalAddresses:g(a.derive(y.OC.INTERNAL)),generateExternalAddresses:g(a.derive(y.OC.EXTERNAL)),lastUsedInternal:e.lastUsedInternal,lastUsedExternal:e.lastUsedExternal,network:e.network,checkAddressesInUse:e.checkAddressesInUse,addByHash:e.addByHash,stakingKey:e.stakingKey,chainNetworkId:s()(r.ChainNetworkId,10)});return i}},34786:(e,t,a)=>{"use strict";a.d(t,{Y:()=>S});var r=a(36384),n=a.n(r),i=a(66419),s=a.n(i),o=a(78580),l=a.n(o),d=a(20116),c=a.n(d),u=a(89400),p=a.n(u),h=a(78914),y=a.n(h),w=a(59340),v=a.n(w),f=a(94473),I=a.n(f),T=a(2991),g=a.n(T),m=a(87672),b=a.n(m),D=a(905),k=a(55343),x=a(86335),C=a(95667),P=a(38079),A=a(27649),E=a(90649);class S{constructor(e){b()(this,"receiver",void 0),b()(this,"senderUtxos",void 0),b()(this,"unsignedTx",void 0),b()(this,"changeAddr",void 0),b()(this,"metadata",void 0),b()(this,"networkSettingSnapshot",void 0),b()(this,"neededStakingKeyHashes",void 0),b()(this,"trezorTCatalystRegistrationTxSignData",void 0),b()(this,"ledgerNanoCatalystRegistrationTxSignData",void 0),this.senderUtxos=e.senderUtxos,this.unsignedTx=e.unsignedTx,this.changeAddr=e.changeAddr,this.metadata=e.metadata,this.networkSettingSnapshot=e.networkSettingSnapshot,this.neededStakingKeyHashes=e.neededStakingKeyHashes,this.trezorTCatalystRegistrationTxSignData=e.trezorTCatalystRegistrationTxSignData,this.ledgerNanoCatalystRegistrationTxSignData=e.ledgerNanoCatalystRegistrationTxSignData,this.receiver=e.receiver}txId(){return x.RustModule.WalletV4.FixedTransaction.from_hex(this.unsignedTx.build_tx().to_hex()).transaction_hash().to_hex()}size(){return{full:this.unsignedTx.full_size(),outputs:[...this.unsignedTx.output_sizes()]}}inputs(){var e;const t=this.unsignedTx.build();return g()(e=(0,E.iterateLenGet)(t.inputs())).call(e,(e=>{var t;const a={hash:e.transaction_id().to_hex(),index:e.index()},r=I()(t=this.senderUtxos).call(t,(e=>e.tx_hash===a.hash&&e.tx_index===a.index));if(null==r)throw new Error(`inputs missing senderUtxos input for ${v()(a)}`);return{value:(0,A.Bi)(r,this.networkSettingSnapshot.NetworkId),address:r.receiver}})).toArray()}totalInput(){var e;const t=(0,A.$Z)(this.unsignedTx.get_implicit_input().checked_add(this.unsignedTx.get_explicit_input()),{defaultIdentifier:P.hd.Cardano,defaultNetworkId:this.networkSettingSnapshot.NetworkId});return y()(e=this.changeAddr).call(e,(e=>t.joinSubtractMutable(p()(e)))),t}outputs(){var e;const t=this.unsignedTx.build();return g()(e=(0,E.iterateLenGet)(t.outputs())).call(e,(e=>({value:(0,A.$Z)(e.amount(),{defaultIdentifier:P.hd.Cardano,defaultNetworkId:this.networkSettingSnapshot.NetworkId}),isForeign:!1,address:e.address().to_hex()}))).toArray()}totalOutput(){return(0,A.$Z)(this.unsignedTx.get_explicit_output(),{defaultIdentifier:P.hd.Cardano,defaultNetworkId:this.networkSettingSnapshot.NetworkId})}fee(){var e;const t=new k.a([],{defaultNetworkId:this.networkSettingSnapshot.NetworkId,defaultIdentifier:P.hd.Cardano});return t.add({identifier:P.hd.Cardano,amount:new D.Z((null===(e=this.unsignedTx.get_fee_if_set())||void 0===e?void 0:e.to_str())||"0").plus(this.unsignedTx.get_deposit().to_str()),networkId:this.networkSettingSnapshot.NetworkId}),t}withdrawals(){var e;const t=this.unsignedTx.build().withdrawals();return g()(e=(0,E.iterateLenGetMap)(t).nonNullValue()).call(e,(([e,t])=>({address:e.to_address().to_hex(),amount:new k.a([{identifier:P.hd.Cardano,amount:new D.Z(t.to_str()),networkId:this.networkSettingSnapshot.NetworkId}],{defaultNetworkId:this.networkSettingSnapshot.NetworkId,defaultIdentifier:P.hd.Cardano})}))).toArray()}keyDeregistrations(){var e,t;const a=this.unsignedTx.build().certs();return g()(e=g()(t=(0,E.iterateLenGet)(a)).call(t,(e=>e.as_stake_deregistration())).nonNull()).call(e,(e=>({rewardAddress:x.RustModule.WalletV4.RewardAddress.new(this.networkSettingSnapshot.ChainNetworkId,e.stake_credential()).to_address().to_hex(),refund:new k.a([{identifier:P.hd.Cardano,amount:this.networkSettingSnapshot.KeyDeposit,networkId:this.networkSettingSnapshot.NetworkId}],{defaultNetworkId:this.networkSettingSnapshot.NetworkId,defaultIdentifier:P.hd.Cardano})}))).toArray()}certificates(){var e;return g()(e=(0,E.iterateLenGet)(this.unsignedTx.build().certs())).call(e,(e=>({kind:e.kind(),payloadHex:e.to_hex()}))).toArray()}receiverWithHandle(){var e;return null!==(e=this.receiver)&&void 0!==e?e:null}receivers(e){var t;const a=g()(t=(0,E.iterateLenGet)(this.unsignedTx.build().outputs())).call(t,(e=>(0,C.toHexOrBase58)(e.address()))).toArray();if(!e){var r;const e=g()(r=this.changeAddr).call(r,(e=>e.address));return c()(a).call(a,(t=>!l()(e).call(e,t)))}return a}uniqueSenderAddresses(){var e;return s()(new(n())(g()(e=this.senderUtxos).call(e,(e=>e.receiver))))}isEqual(e){return null!=e&&e instanceof x.RustModule.WalletV4.TransactionBuilder&&(t=e,this.unsignedTx.build().to_hex()===t.build().to_hex());var t}self(){return this.unsignedTx}}},67362:(e,t,a)=>{"use strict";a.d(t,{i:()=>c});var r=a(39392),n=a.n(r),i=a(2991),s=a.n(i),o=a(96486),l=a(13469),d=a(21131);async function c(e){var t,a;const r=await e.getUTXOsForAddresses({addresses:s()(t=e.addresses).call(t,(e=>e.address)),network:e.network}),i=new(n())(s()(a=e.addresses).call(a,(e=>[e.address,{addressing:e.addressing}]))),c=s()(r).call(r,(e=>{const t=i.get(e.receiver);if(null==t)throw new Error(`toSenderUtxos should never happen ${e.receiver}`);return{...e,addressing:t.addressing}}));if((0,o.isEmpty)(r)){const e=new d.x;throw l.Yd.error(`utils::toSenderUtxos ${(0,l.n)(e)}`),e}return c}},55343:(e,t,a)=>{"use strict";a.d(t,{a:()=>C});var r=a(78914),n=a.n(r),i=a(56474),s=a.n(i),o=a(32366),l=a.n(o),d=a(77149),c=a.n(d),u=a(39392),p=a.n(u),h=a(20116),y=a.n(h),w=a(94473),v=a.n(w),f=a(59340),I=a.n(f),T=a(89400),g=a.n(T),m=a(2991),b=a.n(m),D=a(87672),k=a.n(D),x=a(905);class C{static from(e){try{var t;return new C(b()(t=g()(e)).call(t,(({identifier:e,networkId:t,amount:a})=>({identifier:e,networkId:t,amount:new x.O("object"==typeof a?{...a,_isBigNumber:!0}:a)}))),e.defaults)}catch(t){throw console.error("Failed to parse MultiToken from: "+I()(e),t),t}}constructor(e,t){k()(this,"values",void 0),k()(this,"defaults",void 0),k()(this,"_checkNetworkId",(e=>{const t=this.defaults.defaultNetworkId;if(t!==e)throw new Error(`MultiToken network mismatch ${t} - ${e}`)})),k()(this,"get",(e=>{var t,a;return null===(t=v()(a=g()(this)).call(a,(t=>t.identifier===e)))||void 0===t?void 0:t.amount})),k()(this,"createEntry",((e,t)=>({networkId:this.getDefaults().defaultNetworkId,identifier:e,amount:t}))),k()(this,"createDefaultEntry",(e=>this.createEntry(this.getDefaults().defaultIdentifier,e))),k()(this,"add",(e=>{var t;this._checkNetworkId(e.networkId);const a=v()(t=g()(this)).call(t,(t=>t.identifier===e.identifier));return null==a?(g()(this).push(e),this):(a.amount=a.amount.plus(e.amount),this._removeIfZero(e.identifier),this)})),k()(this,"addWithLimitZero",(e=>{var t;this._checkNetworkId(e.networkId);const a=v()(t=g()(this)).call(t,(t=>t.identifier===e.identifier));return null==a?(g()(this).push(e),this):(a.amount=a.amount.plus(e.amount),this._removeIfZeroOrBelow(e.identifier),this)})),k()(this,"_removeIfZero",(e=>{if(e===this.defaults.defaultIdentifier)return;const t=this.get(e);var a;null!=t&&t.eq(0)&&(this.values=y()(a=g()(this)).call(a,(t=>t.identifier!==e)))})),k()(this,"_removeIfZeroOrBelow",(e=>{if(e===this.defaults.defaultIdentifier)return;const t=this.get(e);var a;null!=t&&t.lte(0)&&(this.values=y()(a=g()(this)).call(a,(t=>t.identifier!==e)))})),k()(this,"subtract",(e=>this.add({identifier:e.identifier,amount:e.amount.negated(),networkId:e.networkId}))),k()(this,"subtractWithLimitZero",(e=>this.addWithLimitZero({identifier:e.identifier,amount:e.amount.negated(),networkId:e.networkId}))),k()(this,"joinAddMutable",(e=>{for(const t of g()(e))this.add(t);return this})),k()(this,"joinSubtractMutable",(e=>{for(const t of g()(e))this.subtract(t);return this})),k()(this,"joinSubtractMutableWithLimitZero",(e=>{for(const t of g()(e))this.subtractWithLimitZero(t);return this})),k()(this,"joinAddCopy",(e=>new C(g()(this),this.defaults).joinAddMutable(e))),k()(this,"joinSubtractCopy",(e=>new C(g()(this),this.defaults).joinSubtractMutable(e))),k()(this,"joinSubtractCopyWithLimitZero",(e=>new C(g()(this),this.defaults).joinSubtractMutableWithLimitZero(e))),k()(this,"absCopy",(()=>{var e;return new C(b()(e=g()(this)).call(e,(e=>({...e,amount:e.amount.absoluteValue()}))),this.defaults)})),k()(this,"negatedCopy",(()=>{var e;return new C(b()(e=g()(this)).call(e,(e=>({...e,amount:e.amount.negated()}))),this.defaults)})),k()(this,"getDefault",(()=>this.getDefaultEntry().amount)),k()(this,"getDefaultEntry",(()=>{var e;return y()(e=g()(this)).call(e,(e=>e.networkId===this.defaults.defaultNetworkId&&e.identifier===this.defaults.defaultIdentifier))[0]})),k()(this,"nonDefaultEntries",(()=>{var e;return y()(e=g()(this)).call(e,(e=>!(e.networkId===this.defaults.defaultNetworkId&&e.identifier===this.defaults.defaultIdentifier)))})),k()(this,"asMap",(()=>{var e;return new(p())(b()(e=g()(this)).call(e,(e=>[e.identifier,e.amount])))})),k()(this,"entries",(()=>[...g()(this)])),k()(this,"isEqualTo",(e=>{const t=this.asMap();for(const a of g()(e)){const e=t.get(a.identifier);if(null==e)return!1;if(!e.isEqualTo(a.amount))return!1;t.delete(a.identifier)}return!(t.size>0)})),k()(this,"size",(()=>g()(this).length)),k()(this,"isEmpty",(()=>{var e;return!1===c()(e=g()(this)).call(e,(e=>e.amount.gt(0)))})),k()(this,"toString",(()=>{var e;const t=this.getDefault().toString(),a=l()(e=this.nonDefaultEntries()).call(e,((e,{identifier:t,amount:a})=>({...e,[t]:a})),{});return`MultiToken{amount=${t}, assets=${I()(a)}}`})),this.values=[],this.defaults=s()(t),this.add({identifier:t.defaultIdentifier,networkId:t.defaultNetworkId,amount:new x.O(0)}),n()(e).call(e,(e=>this.add(e)))}getDefaults(){return this.defaults}}},73744:(e,t,a)=>{"use strict";a.d(t,{Mo:()=>u});var r=a(93476),n=a.n(r),i=a(2991),s=a.n(i),o=a(46689),l=a(66905);const d=50;async function c(e){const t=await(0,o.z)(e.generateAddressFunc,e.lastUsedIndex,l.C4,d,e.checkAddressesInUse,e.network);return s()(t).call(t,(({address:t},a)=>({index:a+e.lastUsedIndex+1,insert:async a=>await async function(e,t,a,r){return await e({...t,address:{type:r,data:a}}),{KeyDerivationId:t.keyDerivationId}}(e.addByHash,a,t,e.type)})))}async function u(e){const t=await c({generateAddressFunc:e.generateInternalAddresses,lastUsedIndex:e.lastUsedExternal,checkAddressesInUse:e.checkAddressesInUse,network:e.network,addByHash:e.addByHash,type:e.type}),a=await c({generateAddressFunc:e.generateExternalAddresses,lastUsedIndex:e.lastUsedInternal,checkAddressesInUse:e.checkAddressesInUse,network:e.network,addByHash:e.addByHash,type:e.type});return[{index:l.OC.EXTERNAL,insert:e=>n().resolve({KeyDerivationId:e.keyDerivationId,DisplayCutoff:0}),children:t},{index:l.OC.INTERNAL,insert:e=>n().resolve({KeyDerivationId:e.keyDerivationId,DisplayCutoff:null}),children:a}]}},46689:(e,t,a)=>{"use strict";a.d(t,{z:()=>y});var r=a(77766),n=a.n(r),i=a(2991),s=a.n(i),o=a(36384),l=a.n(o),d=a(32366),c=a.n(d),u=a(3649),p=a.n(u),h=a(96486);async function y(e,t,a,r,n,i){let s=[],o=t,l=!0;for(;l;){const d=await v(s,e,t+1,o+1,a,r,n,i),c=w(d,t+1,o,a);l=o!==c,o=c,s=d}let d=-1;for(let e=0;e<s.length;e++)e>d&&s[e].isUsed&&(d=e);return p()(s).call(s,0,d+a+1)}function w(e,t,a,r){const n=p()(e).call(e,a-t+1,a-t+1+r);return c()(n).call(n,((e,t)=>t.index>e&&t.isUsed?t.index:e),a)}async function v(e,t,a,r,i,o,d,c){if(e.length+a>=r+i)return e;const u=(0,h.range)(e.length+a,e.length+a+o),p=t(u),y=function(e,t,a,r){const i=new(l())(a),o=s()(t).call(t,((e,t)=>({address:e,isUsed:i.has(e),index:r[t]})));return n()(e).call(e,o)}(e,p,await d({network:c,addresses:p}),u);return y}},52974:(e,t,a)=>{"use strict";a.d(t,{Z:()=>i});var r=a(56474),n=a.n(r);const i=n()({wallets:n()({ADDRESS_COPY_TOOLTIP_NOTIFICATION_DURATION:2,WALLET_CREATED_NOTIFICATION_DURATION:8,WALLET_RESTORED_NOTIFICATION_DURATION:8,MAX_ALLOWED_UNUSED_ADDRESSES:20,TRANSACTION_REQUEST_SIZE:50,MAX_RECOVERY_PHRASE_WORD_COUNT:24,WALLET_RECOVERY_PHRASE_WORD_COUNT:15,DAEDALUS_SHELLEY_RECOVERY_PHRASE_WORD_COUNT:24,YOROI_PAPER_RECOVERY_PHRASE_WORD_COUNT:21,MAX_RECENT_TXS_PER_LOAD:20,hardwareWallet:{trezorT:{VENDOR:"trezor.io",MODEL:"T",manifest:{EMAIL:"rnd@emurgo.io",appURL:{CHROME:"https://chrome.google.com/webstore/detail/yoroi/ffnbelfdoeiohenkjibnmadjiehjhajb",FIREFOX:"https://addons.mozilla.org/en-US/firefox/addon/yoroi/"}}},ledgerNano:{DEFAULT_WALLET_NAME:"Yoroi-Ledger",VENDOR:"ledger.com"}}}),forms:n()({FORM_VALIDATION_DEBOUNCE_WAIT:500,FORM_VALIDATION_DEBOUNCE_WAIT_LONGER:1e3})})},74041:(e,t,a)=>{"use strict";a.d(t,{a9:()=>r,fT:()=>n});const r={NORMAL:{low:3,medium:9},STRICT:{low:5,medium:15}},n={LOW:"low",MEDIUM:"medium",HIGH:"high"}},36231:(e,t,a)=>{"use strict";a.d(t,{Z:()=>P,T:()=>A});var r,n,i,s,o,l,d=a(34074),c=a.n(d),u=a(5838),p=a.n(u),h=(a(87672),a(89749)),y=a.n(h),w=(a(18293),a(2991)),v=a.n(w),f=a(22188),I=a(905),T=a(14986),g=a(90691),m=a(38079),b=a(55343),D=a(54901),k=a(15687),x=a(86335),C=a(90649);let P=(r=class e extends T.Z{constructor(e){const{certificates:t,ttl:a,metadata:r,withdrawals:d,isValid:c,...u}=e;super(u),p()(this,"certificates",n,this),p()(this,"withdrawals",i,this),p()(this,"ttl",s,this),p()(this,"metadata",o,this),p()(this,"isValid",l,this),this.certificates=t,this.ttl=a,this.metadata=r,this.withdrawals=d,this.isValid=c}static fromData(t){return new e(t)}static fromAnnotatedTx(t){var a;const{addressLookupMap:r,defaultToken:n,tx:i}=t;if(i.transaction.Type!==g.iU.CardanoShelley)throw new Error(`CardanoShelleyTransaction::${this.constructor.fromAnnotatedTx} tx type incorrect`);const{Extra:s}=i.transaction;if(null==s)throw new Error(`CardanoShelleyTransaction::${this.constructor.fromAnnotatedTx} missing extra data`);return new e({txid:i.transaction.Hash,ordinal:i.transaction.Ordinal,block:i.block,type:i.type,fee:new b.a([{identifier:m.hd.Cardano,amount:new I.Z(s.Fee),networkId:t.network.NetworkId}],n),ttl:null!=s.Ttl?new I.Z(s.Ttl):void 0,metadata:s.Metadata,amount:i.amount.joinAddCopy(i.fee),date:null!=i.block?i.block.BlockTime:new Date(i.transaction.LastUpdateTime),addresses:{from:(0,T.E)({rows:i.utxoInputs,addressLookupMap:r,tokens:i.tokens,defaultToken:n}),to:v()(a=(0,T.E)({rows:i.utxoOutputs,addressLookupMap:r,tokens:i.tokens,defaultToken:n})).call(a,(e=>({...e,isForeign:!1})))},withdrawals:(0,T.E)({rows:i.accountingInputs,addressLookupMap:r,tokens:i.tokens,defaultToken:n}),certificates:i.certificates,state:i.transaction.Status,errorMsg:i.transaction.ErrorMessage,isValid:!!s.IsValid})}isCatalystVotingRegistration(){if(null==this.metadata||(0,C.isEmptyArray)(this.metadata))return!1;const e=(0,D.BB)(this.metadata);let t;try{t=JSON.parse(e)}catch{return!1}return!!t[String(k.UJ.DATA)]}getFeatures(){const e=[];this.withdrawals.length&&e.push("Withdrawal"),this.isCatalystVotingRegistration()&&e.push("CatalystVotingRegistration");for(const t of this.certificates)t.certificate.Kind===x.RustModule.WalletV4.CertificateKind.StakeDelegation&&e.push("StakeDelegation"),t.certificate.Kind===x.RustModule.WalletV4.CertificateKind.StakeRegistration&&e.push("StakeRegistration"),t.certificate.Kind===x.RustModule.WalletV4.CertificateKind.StakeDeregistration&&e.push("StakeDeregistration"),t.certificate.Kind===x.RustModule.WalletV4.CertificateKind.PoolRegistration&&e.push("PoolRegistration"),t.certificate.Kind===x.RustModule.WalletV4.CertificateKind.PoolRetirement&&e.push("PoolRetirement"),t.certificate.Kind===x.RustModule.WalletV4.CertificateKind.GenesisKeyDelegation&&e.push("GenesisKeyDelegation"),t.certificate.Kind===x.RustModule.WalletV4.CertificateKind.MoveInstantaneousRewardsCert&&e.push("MoveInstantaneousRewards");return e}},n=y()(r.prototype,"certificates",[f.observable],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),i=y()(r.prototype,"withdrawals",[f.observable],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),s=y()(r.prototype,"ttl",[f.observable],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),o=y()(r.prototype,"metadata",[f.observable],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),l=y()(r.prototype,"isValid",[f.observable],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),y()(r,"fromData",[f.action],c()(r,"fromData"),r),y()(r,"fromAnnotatedTx",[f.action],c()(r,"fromAnnotatedTx"),r),r);function A(e){var t,a,r;const n={txid:e.txid,block:void 0,type:e.type,amount:b.a.from(e.amount),fee:b.a.from(e.fee),date:new Date(e.date),addresses:{from:v()(t=e.addresses.from).call(t,(({address:e,value:t})=>({address:e,value:b.a.from(t)}))),to:v()(a=e.addresses.to).call(a,(({address:e,value:t,isForeign:a})=>({address:e,isForeign:a,value:b.a.from(t)})))},state:e.state,errorMsg:e.errorMsg,certificates:e.certificates,ttl:e.ttl&&new I.Z("object"==typeof e.ttl?{...e.ttl,_isBigNumber:!0}:e.ttl),metadata:e.metadata,withdrawals:v()(r=e.withdrawals).call(r,(({address:e,value:t})=>({address:e,value:b.a.from(t)}))),isValid:e.isValid};return Object.prototype.hasOwnProperty.call(e,"ordinal")&&(n.ordinal=e.ordinal),"object"==typeof e.block&&null!==e.block&&(n.block={...e.block,BlockTime:new Date(e.block.BlockTime)}),n}},14986:(e,t,a)=>{"use strict";a.d(t,{Z:()=>C,E:()=>P});var r,n,i,s,o,l,d,c,u,p,h,y=a(34074),w=a.n(y),v=a(51942),f=a.n(v),I=a(5838),T=a.n(I),g=(a(87672),a(89749)),m=a.n(g),b=(a(18293),a(22188)),D=a(905),k=a(74041),x=a(55343);let C=(r=class{constructor(e){T()(this,"txid",n,this),T()(this,"block",i,this),T()(this,"type",s,this),T()(this,"amount",o,this),T()(this,"fee",l,this),T()(this,"date",d,this),T()(this,"ordinal",c,this),T()(this,"addresses",u,this),T()(this,"state",p,this),T()(this,"errorMsg",h,this),f()(this,e)}get uniqueKey(){const e=null==this.block?"undefined":this.block.Hash;return`${this.txid}-${this.state}-${e}`}getAssuranceLevelForMode(e,t){return null==this.block||t-this.block.Height<e.low?k.fT.LOW:t-this.block.Height<e.medium?k.fT.MEDIUM:k.fT.HIGH}},n=m()(r.prototype,"txid",[b.observable],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),i=m()(r.prototype,"block",[b.observable],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),s=m()(r.prototype,"type",[b.observable],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),o=m()(r.prototype,"amount",[b.observable],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),l=m()(r.prototype,"fee",[b.observable],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),d=m()(r.prototype,"date",[b.observable],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),c=m()(r.prototype,"ordinal",[b.observable],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),u=m()(r.prototype,"addresses",[b.observable],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return{from:[],to:[]}}}),p=m()(r.prototype,"state",[b.observable],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),h=m()(r.prototype,"errorMsg",[b.observable],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),m()(r.prototype,"uniqueKey",[b.computed],w()(r.prototype,"uniqueKey"),r.prototype),r);const P=e=>{const t=[];for(const a of e.rows){const r=e.addressLookupMap.get(a.AddressId);if(null==r)throw new Error("toAddr address not in map");const n=new x.a([],e.defaultToken);for(const t of e.tokens)t.TokenList.ListId===a.TokenListId&&n.add({identifier:t.Token.Identifier,amount:new D.Z(t.TokenList.Amount),networkId:t.Token.NetworkId});t.push({address:r,value:n})}return t}},89837:(e,t,a)=>{"use strict";a.d(t,{Z:()=>y});var r=a(94473),n=a.n(r),i=a(93476),s=a.n(i),o=a(33032),l=a.n(o),d=a(87672),c=a.n(d),u=a(22188),p=a(96486),h=a(39803);class y extends h.ZP{constructor(...e){super(...e),c()(this,"_apiCalls",[]),c()(this,"_isInvalidated",!0)}execute(...e){if(this._isWaitingForResponse)return this;const t=this._findApiCall(e);if(t&&t!==this._currentApiCall?(this._isInvalidated=!0,this._currentApiCall=t):t||(this._isInvalidated=!0,this._currentApiCall=this._addApiCall(e)),!this._isInvalidated)return this;l()((0,u.action)((()=>{this.isExecuting=!0,t&&(this.result=t.result)})),0);const a=Math.random();return this.currentlyExecuting.add(a),this.promise=new(s())(((t,r)=>{this._method(...e).then((e=>{if(this.currentlyExecuting.has(a))return this.currentlyExecuting.delete(a),l()((0,u.action)((()=>{this.result=e,this._currentApiCall&&(this._currentApiCall.result=e),this.isExecuting=!1,this.wasExecuted=!0,this._isInvalidated=!1,this._isWaitingForResponse=!1,t(e)})),1),e;t(e)})).catch((0,u.action)((e=>{this.currentlyExecuting.has(a)?(this.currentlyExecuting.delete(a),l()((0,u.action)((()=>{this.error=e,this.isExecuting=!1,this.wasExecuted=!0,this._isWaitingForResponse=!1,r(e)})),1)):r(e)})))})),this._isWaitingForResponse=!0,this}invalidate(e={immediately:!1}){return this._isInvalidated=!0,e.immediately&&this._currentApiCall?this.execute(...this._currentApiCall.args):this}removeCacheForCallWith(...e){return(0,p.remove)(this._apiCalls,(t=>(0,p.isEqual)(t.args,e)))}_addApiCall(e){const t={args:e,result:null};return this._apiCalls.push(t),t}_findApiCall(e){var t;return n()(t=this._apiCalls).call(t,(t=>(0,p.isEqual)(t.args,e)))}reset(){super.reset(),this._isInvalidated=!0}}},6697:(e,t,a)=>{"use strict";a.d(t,{j:()=>r});const r={enabled:!1,currency:null}},13069:(e,t,a)=>{"use strict";a.d(t,{x:()=>l,A:()=>d});var r=a(20511),n=a.n(r),i=a(86335),s=a(33913),o=a(90649);function l(e,t){const a=n()({length:64}),r=n()({length:24}),s=(0,o.bytesToHex)(e),l=(0,o.bytesToHex)(t);return i.RustModule.WalletV4.encrypt_with_password(s,a,r,l)}function d(e,t){const a=(0,o.bytesToHex)(e);try{const e=i.RustModule.WalletV4.decrypt_with_password(a,t);return(0,o.hexToBytes)(e)}catch(e){throw new s.UZ}}},35487:(e,t,a)=>{"use strict";a.d(t,{Z:()=>o});var r=a(87672),n=a.n(r),i=a(42238),s=a.n(i);const o=new class{constructor(){n()(this,"ua",void 0),this.ua=(new(s())).getResult()}}},71712:(e,t,a)=>{"use strict";function r(e){var t,a,r,n,i,s;const o=null!==(t=e.additional["default-src"])&&void 0!==t?t:[],l=null!==(a=e.additional["frame-src"])&&void 0!==a?a:[],d=null!==(r=e.additional["object-src"])&&void 0!==r?r:[],c=null!==(n=e.additional["connect-src"])&&void 0!==n?n:[],u=null!==(i=e.additional["style-src"])&&void 0!==i?i:[],p=null!==(s=e.additional["img-src"])&&void 0!==s?s:[];return p.push("https://static.adapools.org/"),p.push("https://ipfs.io/ipfs/"),l.push("https://connect.trezor.io/"),l.push("https://emurgo.github.io/"),l.push("https://www.youtube.com/"),c.push("https://analytics.emurgo-rnd.com/"),c.push("https://api2.amplitude.com"),c.push("https://api.muesliswap.com"),c.push("https://api.handle.me/"),c.push("https://api.unstoppabledomains.com/"),c.push("https://a.cexplorer.io/"),p.push("https://img.cexplorer.io/"),p.push("https://corsproxy.io/"),c.push("https://aggregator.muesliswap.com/"),c.push("https://onchain2.muesliswap.com/"),[`default-src 'self' ${o.join(" ")};`,`frame-src ${l.join(" ")};`,"script-src 'self' 'wasm-unsafe-eval';",`object-src 'self' ${d.join(" ")};`,`connect-src ${c.join(" ")};`,`style-src * 'unsafe-inline' 'self' ${u.join(" ")} blob:;`,`img-src 'self' ${p.join(" ")} https: data: ;`].join(" ")}a.r(t),a.d(t,{genCSP:()=>r,injectedScripts:()=>n});const n=["cardanoApiInject.js","initialInject.js"]},10108:(e,t,a)=>{"use strict";a.d(t,{k:()=>H,_:()=>F});var r=a(39392),n=a.n(r),i=a(86902),s=a.n(i),o=a(32366),l=a.n(o),d=a(59340),c=a.n(d),u=a(39291),p=a.n(u),h=a(20116),y=a.n(h),w=a(2991),v=a.n(w),f=a(93476),I=a.n(f),T=a(94473),g=a.n(T),m=a(3577),b=a(49871),D=a(45918),k=a(74041),x=a(1499),C=a(38079),P=a(66905),A=a(37495),E=a(4922),S=a(27189),K=a(87326),G=a(84174),N=a(905),R=a(27649),B=a(55343),_=a(86335),L=a(79562),O=a(84698),M=a(74429),U=a(19008),W=a(72499);async function H(e){const t=await(0,O.z)();let a=await(0,U.M)(t);if(null!=e){if("number"!=typeof e)throw new Error(`Invalid public deriver ID type in request: ${e} (${typeof e})`);const t=g()(a).call(a,(t=>t.getPublicDeriverId()===e));a=t?[t]:[]}const r=await I().all(v()(a).call(a,(async e=>{try{return await async function(e){var t,a,r,n,i;await _.RustModule.load();const o=e.getPublicDeriverId(),d=e.getParent(),u=await d.getFullConceptualWalletInfo(),h=d.getNetworkInfo(),w=(0,S.hx)(d),f=(0,S.J8)(d),I=w||f,T=w?"ledger":f?"trezor":"mnemonic",g=(0,m.se)(e);if(null==g)throw new Error("unexpected missing asGetAllUtxos result");const L=await g.getAllUtxos(),O=y()(t=(0,R.ue)(L)).call(t,(e=>e.assets.length>0)),U=await(0,W.xZ)(h.NetworkId),H=v()(O).call(O,(e=>{try{const t=_.RustModule.WalletV4.TransactionOutput.new(_.RustModule.WalletV4.Address.from_hex(p()("0").call("0",114)),(0,R.Dw)(e));return new N.Z(_.RustModule.WalletV4.min_ada_for_output(t,_.RustModule.WalletV4.DataCost.new_coins_per_byte(_.RustModule.WalletV4.BigNum.from_str(U.coinsPerUtxoByte))).to_str())}catch(t){return console.error(`Failed to calculate min-required ADA for utxo: ${c()(e)}`,t),new N.Z("0")}})),F=l()(H).call(H,((e,t)=>e.plus(t)),new N.Z("0")),j=d.getDefaultMultiToken().defaults.defaultIdentifier,q=new B.a([{identifier:j,amount:F,networkId:h.NetworkId}],{defaultNetworkId:h.NetworkId,defaultIdentifier:j}),z=(0,m.O8)(e);if(null==z)throw new Error("unexpected missing asGetPublicKey result");const $=await z.getPublicKey(),V=await(0,b.T)(z),Z=await(0,D.WH)(e);if(null==Z)throw new Error("unexpected missing receive address");const Y=(null===(a=await(null===(n=(0,m.y9)(e))||void 0===n?void 0:n.getSigningKey()))||void 0===a||null===(r=a.row.PasswordLastUpdate)||void 0===r?void 0:r.toISOString())||null,J=(0,m.Sy)(e);if(null==J)throw new Error("unexpected missing asGetAllAccounting result");const X=await J.getStakingKey(),Q=(0,m.sX)(e);if(null==Q)throw new Error("unexpected missing asHasUtxoChains result");const ee=[],te=[],ae=[];for(const t of s()(C.dq)){const a=C.dq[t];ee[a]=await(0,A.XN)({publicDeriver:e,type:a}),te[a]=await(0,x.cP)({publicDeriver:Q,chainsRequest:{chainId:P.OC.EXTERNAL},type:a}),ae[a]=await(0,x.cP)({publicDeriver:Q,chainsRequest:{chainId:P.OC.INTERNAL},type:a})}const re=await(0,A.Hk)(e),ne=(0,m.JM)(e);if(null==ne)throw new Error("unexpected missing asHasLevels result");const ie=await(0,E.Jr)({publicDeriver:ne}),se=await g.getAllUtxoAddresses(),oe=(0,m.yB)(e);if(null==oe)throw new Error("unexpected missing asGetBalance result");const le=await oe.getBalance();return{publicDeriverId:o,conceptualWalletId:d.getConceptualWalletId(),utxos:L,transactions:[],networkId:h.NetworkId,name:u.Name,type:T,isHardware:I,hardwareWalletDeviceId:null===(i=d.hardwareInfo)||void 0===i?void 0:i.DeviceId,plate:V,publicKey:$.Hash,receiveAddress:Z,pathToPublic:z.pathToPublic,signingKeyUpdateDate:Y,stakingAddressing:{addressing:X.addressing},stakingAddress:X.addr.Hash,publicDeriverLevel:ne.getParent().getPublicDeriverLevel(),lastSyncInfo:await e.getLastSyncInfo(),balance:le,assetDeposits:q,defaultTokenId:j,assuranceMode:k.a9.NORMAL,allAddressesByType:ee,foreignAddresses:ie,externalAddressesByType:te,internalAddressesByType:ae,allAddresses:re,allUtxoAddresses:se,isBip44Wallet:d instanceof K.J,isTestnet:(0,G.isTestnet)(h),isCardanoHaskell:(0,G.isCardanoHaskell)(h),isRefreshing:M.X.has(o),submittedTransactions:[]}}(e)}catch(t){return console.error("failed to load wallet state for public deriver id "+e.publicDeriverId,t),null}}))),i=y()(r).call(r,(e=>null!=e));try{await async function(e){const t=new(n());for(const a of e)t.set(a.publicDeriverId,a);const a=await(0,L._W)();for(const e of a){const a=t.get(e.publicDeriverId);a&&a.submittedTransactions.push(e)}}(i)}catch(e){console.error("getWalletsState:batchLoadSubmittedTransactions error:",e)}return i}async function F(e){var t;const a=e.getPublicDeriverId(),r=await e.getParent().getFullConceptualWalletInfo(),n=e.getParent().getNetworkInfo(),i=(0,S.hx)(e.getParent()),o=(0,S.J8)(e.getParent()),l=i||o,d=i?"ledger":o?"trezor":"mnemonic",c=new B.a([],{defaultNetworkId:n.NetworkId,defaultIdentifier:""}),u=[],p=[],h=[];for(const e of s()(C.dq)){const t=C.dq[e];u[t]=[],p[t]=[],h[t]=[]}const y=(0,m.Sy)(e);if(null==y)throw new Error("unexpected missing asGetAllAccounting result");const w=await y.getStakingKey();return{publicDeriverId:a,conceptualWalletId:e.getParent().getConceptualWalletId(),utxos:[],transactions:[],networkId:n.NetworkId,name:r.Name,type:d,isHardware:l,hardwareWalletDeviceId:null===(t=e.getParent().hardwareInfo)||void 0===t?void 0:t.DeviceId,plate:{ImagePart:"",TextPart:""},publicKey:"",receiveAddress:{addr:{AddressId:0,Digest:0,Type:0,Hash:"",IsUsed:!1},row:{CanonicalAddressId:0,KeyDerivationId:0},addressing:{path:[],startLevel:0}},pathToPublic:[],signingKeyUpdateDate:null,stakingAddressing:{addressing:w.addressing},stakingAddress:w.addr.Hash,publicDeriverLevel:0,lastSyncInfo:{LastSyncInfoId:0,Time:null,SlotNum:null,BlockHash:null,Height:0},balance:c,assetDeposits:c,defaultTokenId:"",assuranceMode:k.a9.NORMAL,allAddressesByType:u,foreignAddresses:[],externalAddressesByType:p,internalAddressesByType:h,allAddresses:{utxoAddresses:[],accountingAddresses:[]},allUtxoAddresses:[],isBip44Wallet:e.getParent()instanceof K.J,isTestnet:(0,G.isTestnet)(n),isCardanoHaskell:(0,G.isCardanoHaskell)(n),isRefreshing:!0,submittedTransactions:[]}}},62198:(e,t,a)=>{"use strict";a.d(t,{k:()=>s,X:()=>o});var r=a(56474),n=a.n(r),i=a(90578);const s=n()({typeTag:"get-historical-coin-prices",handle:async e=>await(0,i.ud)(e)}),o=n()({typeTag:"refresh-current-coin-price",handle:async e=>{(0,i.FC)("UI")}})},87639:(e,t,a)=>{"use strict";a.d(t,{ln:()=>P,Xm:()=>A,aV:()=>E,FS:()=>S,RX:()=>K,U9:()=>G,b:()=>N,oZ:()=>R,MH:()=>B});var r=a(2991),n=a.n(r),i=a(86902),s=a.n(i),o=a(33032),l=a.n(o),d=a(93476),c=a.n(d),u=a(56474),p=a.n(u),h=a(58905),y=a(18689),w=a(12565),v=a(3577),f=a(43577),I=a(24558),T=a(49871),g=a(63371),m=a(86335),b=a(27649),D=a(90649),k=a(13469),x=a(60274);function C(e,t,a){(0,y.B9)(e,{type:"connector_rpc_response",uid:t,return:a,protocol:"cardano"})}const P=p()({typeTag:"connect-response",handle:async e=>{var t;const{tabId:a}=e;if(null==a)return;const r=await(0,h.AO)(a);var n,i;null!=(null==r||null===(t=r.status)||void 0===t?void 0:t.requestType)&&(!0===e.accepted?((0,h.dl)(null==r||null===(n=r.status)||void 0===n?void 0:n.requestType,e.publicDeriverId,e.auth,a),r.status={publicDeriverId:e.publicDeriverId,auth:e.auth},await(0,h.h3)(a,r)):((0,h.dl)(null==r||null===(i=r.status)||void 0===i?void 0:i.requestType,null,null,a),await(0,h.jF)(a)))}}),A=p()({typeTag:"connect-auth-entry",handle:async e=>{const t=await(0,w.A)(e.publicDeriverId),a=(0,v.O8)(t);if(null==a)throw new Error("unexpected missing asGetPublicKey result");const r=await(0,T.T)(a);try{return await(0,I.Zj)({appAuthID:e.appAuthID,deriver:t,checksum:r,password:e.password})}catch(e){return{error:e.message}}}}),E=p()({typeTag:"user-sign-confirm",handle:async e=>{const t=await(0,h.AO)(e.tabId);if(null==t)return void console.error("Handling user sign confirmation but lost connection to dApp site.");const a=t.pendingSigns[String(e.uid)];if(!a)return void console.error("Handling user sign confirmation but signing request is unexpectedly missing..");const r=await(0,h._T)(e.tabId,!1);switch(a.request.type){case"tx/cardano":{var n;let t;try{let a;if(e.password)a=await(0,f.nH)(r,e.password,e.tx);else{if(!e.witnessSetHex)throw new Error("missing password or witness from connector dialog");a=e.witnessSetHex}t={ok:a}}catch(e){t={err:"transaction signing failed"}}if("cardano-tx"!==a.continuationData.type)return void C(e.tabId,e.uid,{err:"unexpected error"});const{tx:i,returnTx:s}=a.continuationData;if(null==(null===(n=t)||void 0===n?void 0:n.ok))C(e.tabId,e.uid,t);else{const a=t.ok;if(s){const t=m.RustModule.WasmScope((e=>{try{return e.WalletV4.FixedTransaction.from_hex(i).witness_set().to_hex()}catch{return null}})),r=null!=t,n=null==t?a:(0,b.b9)(t,a);m.RustModule.WasmScope((t=>{let a;r?(a=t.WalletV4.FixedTransaction.from_hex(i),a.set_witness_set((0,D.hexToBytes)(n))):a=t.WalletV4.FixedTransaction.new((0,D.hexToBytes)(i),(0,D.hexToBytes)(n),!0),C(e.tabId,e.uid,{ok:a.to_hex()})}))}else C(e.tabId,e.uid,{ok:a})}}break;case"data":{if("cardano-data"!==a.continuationData.type)return void C(e.tabId,e.uid,{err:"unexpected error"});const{address:t,payload:n}=a.continuationData;let i;if(""!==e.password)try{i=await(0,x.mO)(r,e.password,t,n)}catch(t){return k.Yd.error(`error when signing data ${t}`),void C(e.tabId,e.uid,{err:{code:g.y.DATA_SIGN_PROOF_GENERATION,info:t.message}})}else{const{signedMessageData:t}=e;if(null==t)throw new Error("unexpected user signed confirmation: missing hardware wallet signing response");i=await(0,x.vX)(t.addressFieldHex,t.signatureHex,n,t.signingPublicKeyHex)}C(e.tabId,e.uid,{ok:i})}break;case"tx-reorg/cardano":{if("cardano-reorg-tx"!==a.continuationData.type)return void C(e.tabId,e.uid,{err:"unexpected error"});const{isCBOR:t}=a.continuationData,r=await(0,f.Mk)([...e.tx],t);C(e.tabId,e.uid,{ok:r})}}delete t.pendingSigns[String(e.uid)],await(0,h.h3)(e.tabId,t)}}),S=p()({typeTag:"user-sign-reject",handle:async e=>{const t=await(0,h.AO)(e.tabId),a=null==t?void 0:t.pendingSigns[String(e.uid)];if(t&&a){var r;const n="data"===(null===(r=a.request)||void 0===r?void 0:r.type)?g.y.DATA_SIGN_USER_DECLINED:g.CO.USER_DECLINED;C(e.tabId,e.uid,{err:{code:n,info:"User rejected"}}),delete t.pendingSigns[String(e.uid)],await(0,h.h3)(e.tabId,t)}else console.error(`couldn't find tabId: ${e.tabId}`)}}),K=p()({typeTag:"sign-error",handle:async e=>{const t=await(0,h.AO)(e.tabId),a=null==t?void 0:t.pendingSigns[String(e.uid)];if(t&&a){var r;const n="data"===(null===(r=a.request)||void 0===r?void 0:r.type)?g.y.DATA_SIGN_PROOF_GENERATION:g.CO.PROOF_GENERATION;C(e.tabId,e.uid,{err:{code:n,info:`utxo error: ${e.errorType} (${e.data})`}}),delete t.pendingSigns[String(e.uid)],await(0,h.h3)(e.tabId,t)}else console.error(`couldn't find tabId: ${e.tabId}`)}}),G=p()({typeTag:"tx_sign_window_retrieve_data",handle:async()=>{await new(c())((e=>{l()(e,1)}));const e=await(0,h.Y7)();for(const a of s()(e)){const r=e[a];for(const e of s()(r.pendingSigns)){const n=r.pendingSigns[e];if(!n.openedWindow){var t;if(n.openedWindow=!0,await(0,h.h3)(Number(a),r),null==(null===(t=r.status)||void 0===t?void 0:t.publicDeriverId))throw new Error("no public deriver set for request");return{publicDeriverId:r.status.publicDeriverId,sign:n.request,tabId:Number(a),requesterUrl:r.url}}}}return null}}),N=p()({typeTag:"connect_retrieve_data",handle:async()=>{const e=await(0,h.Y7)();for(const a of s()(e)){var t;const r=e[a];if(null!==(t=r.status)&&void 0!==t&&t.requestType)return r.status.openedWindow=!0,{url:r.url,appAuthID:r.appAuthID,imgBase64Url:r.imgBase64Url,tabId:Number(a)}}return null}}),R=p()({typeTag:"remove_wallet_from_whitelist",handle:async e=>{const t=await(0,h.Y7)();for(const a of s()(t))if(t[a].url===e.url){(0,y.B9)(Number(a),{type:"disconnect"});break}}}),B=p()({typeTag:"get_connected_sites",handle:async()=>{var e;const t=await(0,h.Y7)();return{sites:n()(e=s()(t)).call(e,(e=>t[e].url))}}})},72499:(e,t,a)=>{"use strict";a.d(t,{Zc:()=>P,xZ:()=>A,sI:()=>E});var r=a(52424),n=a.n(r),i=a(20116),s=a.n(i),o=a(94473),l=a.n(o),d=a(59340),c=a.n(d),u=a(11128),p=a.n(u),h=a(86902),y=a.n(h),w=a(26337),v=a.n(w),f=a(86045),I=a.n(f),T=a(56474),g=a.n(T),m=a(16944),b=a(84174),D=a(79562);const k=g()({CardanoMainnet:{epoch:504,startTimestamp:1723931091e3},CardanoPreprodTestnet:{epoch:162,startTimestamp:17240256e5},CardanoPreviewTestnet:{epoch:665,startTimestamp:1724112e6},CardanoSanchoTestnet:{epoch:431,startTimestamp:172402742e4}});b.networks;var x=new(n());class C{constructor(e){var t,a,r;r={writable:!0,value:void 0},function(e,t){if(t.has(e))throw new TypeError("Cannot initialize the same private elements twice on an object")}(t=this,a=x),a.set(t,r),I()(this,x,e)}getNetworkKey(){for(const e of y()(b.networks))if(b.networks[e].NetworkId===v()(this,x))return e;throw new Error("nonexistent network id")}getNetwork(){const e=(0,b.getNetworkById)(v()(this,x));if(!e)throw new Error("unexpectedly missing network");return e}getConfig(){return(0,b.getCardanoHaskellBaseConfigCombined)((0,b.getNetworkById)(v()(this,x)))}getEpochData(){const{SlotsPerEpoch:e,SlotDuration:t}=this.getConfig();if(null==e||null==t)throw new Error("unexpectedly missing epoch length data");const{epoch:a,startTimestamp:r}=k[this.getNetworkKey()],n=p()()-r;return{currentEpoch:a+Math.floor(n/(e*t*1e3))}}getDefaultProtocolParameters(){const{currentEpoch:e}=this.getEpochData(),t=this.getConfig();if(!(t.LinearFee&&t.CoinsPerUtxoByte&&t.PoolDeposit&&t.KeyDeposit))throw new Error("unexpectedly missing config parameters");return{linearFee:{constant:t.LinearFee.constant,coefficient:t.LinearFee.coefficient},coinsPerUtxoByte:t.CoinsPerUtxoByte,poolDeposit:t.PoolDeposit,keyDeposit:t.KeyDeposit,epoch:e}}getCacheStorage(){return(0,D.Wd)("PROTOCOL_PARAMETERS_"+v()(this,x),c(),JSON.parse,null)}async getCachedProtocolParameters(e,t){const a=this.getCacheStorage(),r=await a.get();return r?l()(r).call(r,(a=>t?a.epoch<=e:a.epoch===e)):null}async cacheProtocolParameters(e){const t=this.getCacheStorage();let a=await t.get();a||(a=[]),a=s()(a).call(a,(({epoch:t})=>t>e.epoch)),a.push(e),await t.set(a)}async fetchProtocolParametersFromNetwork(){const{BackendServiceZero:e}=this.getNetwork().Backend,t=new m.ProtocolParametersApi(e),a=await t.getParameters();return function(e){var t,a,r,n;const i=/^\d+$/;return"string"==typeof(null==e||null===(t=e.linearFee)||void 0===t?void 0:t.constant)&&i.test(null==e||null===(a=e.linearFee)||void 0===a?void 0:a.constant)&&"string"==typeof(null==e||null===(r=e.linearFee)||void 0===r?void 0:r.coefficient)&&i.test(null==e||null===(n=e.linearFee)||void 0===n?void 0:n.coefficient)&&"string"==typeof(null==e?void 0:e.coinsPerUtxoByte)&&i.test(null==e?void 0:e.coinsPerUtxoByte)&&"string"==typeof(null==e?void 0:e.poolDeposit)&&i.test(null==e?void 0:e.poolDeposit)&&"string"==typeof(null==e?void 0:e.keyDeposit)&&i.test(null==e?void 0:e.keyDeposit)&&"number"==typeof e.epoch}(a)?(await this.cacheProtocolParameters(a),a):null}async getProtocolParameters(){const{currentEpoch:e}=this.getEpochData(),t=await this.getCachedProtocolParameters(e,!1);if(t)return t;try{const e=await this.fetchProtocolParametersFromNetwork();if(e)return e}catch(t){console.error("failed to fetch protocol parameters for network %s epoch $S:",v()(this,x),e,t)}return await this.getCachedProtocolParameters(e,!0)||this.getDefaultProtocolParameters()}}const P=g()({typeTag:"get-protocol-parameters",handle:async e=>{const t=new C(e.networkId);return await t.getProtocolParameters()}}),A=e=>P.handle({networkId:e});async function E(e,t){const a=new C(e);null!=t&&null!=await a.getCachedProtocolParameters(t,!1)||await a.fetchProtocolParametersFromNetwork()}},57096:(e,t,a)=>{"use strict";a.d(t,{I:()=>b});var r=a(89400),n=a.n(r),i=a(86902),s=a.n(i),o=a(2991),l=a.n(o),d=a(80426),c=a.n(d),u=a(56474),p=a.n(u),h=a(37872),y=a(84174),w=a(79562),v=a(26333),f=a(4922),I=a(57421),T=a(41058),g=a(39845),m=a(97143);const b=p()({typeTag:"get-cardano-assets",handle:async e=>{const t=await(0,h.zA)();if(e){var a,r;const i=(0,y.getNetworkById)(e.networkId),o=p()({ModifyToken:m.$G,GetToken:g.YT}),d=c()(a=l()(r=s()(o)).call(r,(e=>o[e]))).call(a,(e=>(0,I.Hz)(t,e))),u=await(0,T.s)(new w.ZP),h=await(0,I.zm)(t,d,(a=>(0,f.pV)(t,a,o,e.tokenIds,u.getTokenInfo,u.getMultiAssetMintMetadata,u.getMultiAssetSupply,i)));return[...n()(h).call(h)]}return await(0,v.r)({db:t})}})},12565:(e,t,a)=>{"use strict";a.d(t,{A:()=>i});var r=a(37872),n=a(19008);async function i(e){const t=await(0,r.zA)();for(const a of await(0,n.M)(t))if(a.getPublicDeriverId()===e)return a;throw new Error(`missing public deriver ${e}`)}},84698:(e,t,a)=>{"use strict";a.d(t,{z:()=>Be});var r=a(85412),n=a(47197),i=a(51942),s=a.n(i),o=a(11128),l=a.n(o),d=a(3649),c=a.n(d),u=a(20116),p=a.n(u),h=a(39969),y=a.n(h),w=a(89400),v=a.n(w),f=a(46423),I=a.n(f),T=a(86902),g=a.n(T),m=a(2991),b=a.n(m),D=a(80426),k=a.n(D),x=a(56474),C=a.n(x),P=a(93476),A=a.n(P),E=a(55835),S=a(57421),K=a(39845),G=a(97143),N=a(20335),R=a(90691),B=a(5733),_=a(21266),L=a(88863),O=a(68680),M=a(93621),U=a(22261),W=a(78741),H=a(75809),F=a(77600),j=a(85029),q=a(52760),z=a(84174),$=a(83349);const V="yoroi-schema",Z=()=>new(A())((e=>{const t=indexedDB.deleteDatabase(V);t.onsuccess=()=>e(),t.onerror=()=>e()})),Y=async e=>{const t=await J(e);return await(async e=>{var t,a;const r=C()({GetEncryptionMeta:K.t$,ModifyEncryptionMeta:G.S7}),n=k()(t=b()(a=g()(r)).call(a,(e=>r[e]))).call(t,(t=>(0,S.Hz)(e,t)));await(0,S.zm)(e,n,(async t=>{const a={AddressSeed:E.randomBytes(4).readUInt32BE(0),TransactionSeed:E.randomBytes(4).readUInt32BE(0),BlockSeed:E.randomBytes(4).readUInt32BE(0),TokenSeed:E.randomBytes(4).readUInt32BE(0)},n=await r.GetEncryptionMeta.getOrInitial(e,t,{...a,EncryptionMetaId:0});await r.ModifyEncryptionMeta.upsert(e,t,{...n,EncryptionMetaId:0})}))})(t),await(async e=>{var t,a;const r=C()({GetEncryptionMeta:K.t$,ModifyEncryptionMeta:G.S7,ModifyNetworks:G.Wf}),n=k()(t=b()(a=g()(r)).call(a,(e=>r[e]))).call(t,(t=>(0,S.Hz)(e,t)));await(0,S.zm)(e,n,(async t=>{var a;return r.ModifyNetworks.upsert(e,t,b()(a=g()(z.networks)).call(a,(e=>z.networks[e])))}))})(t),await(async e=>{var t,a;const r=C()({GetEncryptionMeta:K.t$,ModifyEncryptionMeta:G.S7,ModifyExplorers:N.f}),n=k()(t=b()(a=g()(r)).call(a,(e=>r[e]))).call(t,(t=>(0,S.Hz)(e,t)));await(0,S.zm)(e,n,(async t=>{var a;return r.ModifyExplorers.upsert(e,t,I()(a=[...v()($.S).call($.S)]).call(a))}))})(t),await(async e=>{var t,a;const r=C()({ModifyToken:G.$G}),n=k()(t=b()(a=g()(r)).call(a,(e=>r[e]))).call(t,(t=>(0,S.Hz)(e,t)));await(0,S.zm)(e,n,(async t=>r.ModifyToken.upsert(e,t,z.defaultAssets)))})(t),t},J=async e=>{const t=n.schema.create(V,18);let a;(0,R.hs)(t),(0,U.uh)(t),(0,B.A)(t),(0,_.I)(t),(0,L.W)(t),(0,O.fG)(t),(0,M.j6)(t),(0,W.C)(t),(0,H.D)(t),(0,F.uT)(t),(0,j.tZ)(t);try{a=await t.connect({storeType:e,onUpgrade:Q})}catch(t){if(201===t.code)return await async function(e){const t=t=>new Error(`Error when fixing ${e}: ${t}`),a=new(y())(e).searchParams,[r,n]=String(a.get("p0")).split(".");if(n!=="pk"+r)throw t("unexpected key name");const i=r+"Id",s=a.get("p1"),o=(e,a)=>new(A())(((r,n)=>{e.onerror=e=>{n(t(a))},e.onsuccess=t=>{r(e.result)}})),l=(await o(window.indexedDB.open("yoroi-schema"),"could not open DB")).transaction([r],"readwrite").objectStore(r),d=await o(l.getAll(),"could not get all objects"),u=p()(d).call(d,(e=>String(e.value[i])===s));for(const e of c()(u).call(u,1))await o(l.delete(e.id),"could not delete duplicate object")}(t.message),J(e);throw t}return a},X={};async function Q(e){const t=e.getVersion();if(0===t)return;const a=await e.dump();if(1===t)return s()(X,a),await e.dropTable("TxAddresses"),await e.dropTable("Txs"),void await e.dropTable("Addresses");if(2===t)return await Z(),void window.location.reload();if(3===t&&0===g()(a).length)return await Z(),void window.location.reload();if(t>=3&&t<=4&&await e.addTableColumn("Cip1852Wrapper","RootKeyDerivationId",1),6===t||7===t){const t=e.getRawTransaction().objectStore("TxMemo");await(0,S.v_)(t.clear())}t>=3&&t<=9&&(await e.dropTableColumn("Bip44Wrapper","Bip44WrapperId"),await e.dropTableColumn("Cip1852Wrapper","Cip1852WrapperId")),t>=3&&t<=10&&await e.addTableColumn("Key","Type",q._.BIP32ED25519),t>=3&&t<=11&&(await e.dropTableColumn("ConceptualWallet","CoinType"),await e.addTableColumn("ConceptualWallet","NetworkId",z.networks.CardanoMainnet.NetworkId)),t>=3&&t<=12&&(r.Z.isNightly()&&(await Z(),window.location.reload()),await e.addTableColumn("Transaction","Type",R.iU.CardanoByron),await e.addTableColumn("Transaction","Extra",null)),t>=3&&t<=13&&await e.addTableColumn("Certificate","Ordinal",R.iU.CardanoByron),t>=3&&t<=15&&await async function(e){const t=e.getRawTransaction(),a=["AccountingTransactionInput","AccountingTransactionOutput","Block","Certificate","CertificateAddress","TokenList","Transaction","UtxoTransactionInput","UtxoTransactionOutput","Token"],r=t.objectStore("LastSyncInfo"),n=await(0,S.v_)(r.getAll()),i=t.objectStore("Token"),s=await(0,S.v_)(i.getAll());for(const e of a)try{const a=t.objectStore(e);await(0,S.v_)(a.clear())}catch(e){}for(const e of n){const a=t.objectStore("LastSyncInfo");await(0,S.v_)(a.put({id:e.id,value:{LastSyncInfoId:e.value.LastSyncInfoId,Time:new Date(l()()).getTime(),SlotNum:null,Height:0,BlockHash:null}}))}for(const e of p()(s).call(s,(e=>!0===e.value.IsDefault))){const a=t.objectStore("Token");await(0,S.v_)(a.put({id:e.id,value:e.value}))}}(e),t<18&&await e.addTableColumn("Address","IsUsed",!1)}a(33032);var ee=a(94473),te=a.n(ee),ae=a(39392),re=a.n(ae),ne=a(59340),ie=a.n(ne),se=a(74119);const oe={ACCOUNT_KEY:"ACCOUNT",WALLET_KEY:"WALLET",LAST_BLOCK_NUMBER_KEY:"LAST_BLOCK_NUMBER",SELECTED_EXPLORER_KEY:"SELECTED_EXPLORER"},le=()=>{const e=g()(X);if(0===e.length)return!1;for(const t of e)delete X[t];return!0};async function de(e){return await(0,se.Jt)(e).then((e=>null==e?e:JSON.parse(e)))}var ce=a(79562),ue=a(13469),pe=a(45712),he=a.n(pe),ye=(a(61346),a(36384)),we=a.n(ye),ve=a(96486),fe=a(66905),Ie=a(94528),Te=a(86335),ge=(a(13069),a(52367)),me=a(24651),be=a(40026);async function De(e){const t=fe.yK+0,a=Te.RustModule.WalletV2.Bip44AccountPublic.new(Te.RustModule.WalletV2.PublicKey.from_hex(e.accountPubKey),Te.RustModule.WalletV2.DerivationScheme.v2());let r;{const t=await async function(e,t,a){const r=(0,ve.range)(0,fe.C4),n=b()(r).call(r,(a=>t.bip44_chain(!1).address_key(Te.RustModule.WalletV2.AddressKeyIndex.new(a)).bootstrap_era_address(e).to_base58())),i=b()(r).call(r,(a=>t.bip44_chain(!0).address_key(Te.RustModule.WalletV2.AddressKeyIndex.new(a)).bootstrap_era_address(e).to_base58()));return[{index:0,insert:e=>A().resolve({KeyDerivationId:e.keyDerivationId,DisplayCutoff:0}),children:b()(r).call(r,(e=>({index:e,insert:async t=>await(0,be.c)(a,t,n[e])})))},{index:1,insert:e=>A().resolve({KeyDerivationId:e.keyDerivationId,DisplayCutoff:null}),children:b()(r).call(r,(e=>({index:e,insert:async t=>await(0,be.c)(a,t,i[e])})))}]}(e.settings,a,(0,me.dw)(new(we()))),n=te()(t).call(t,(e=>e.index===fe.OC.EXTERNAL));if(null==n)throw new Error("addPublicDeriverToMigratedWallet cannot find external chain. Should never happen");n.insert=t=>A().resolve({KeyDerivationId:t.keyDerivationId,DisplayCutoff:e.displayCutoff}),r=t}const n=[{index:fe.r7.BIP44,insert:e=>A().resolve({KeyDerivationId:e.keyDerivationId}),publicKey:null,privateKey:null},{index:fe.M8.CARDANO,insert:e=>A().resolve({KeyDerivationId:e.keyDerivationId}),publicKey:null,privateKey:null},{index:t,insert:e=>A().resolve({KeyDerivationId:e.keyDerivationId}),publicKey:{Hash:a.key().to_hex(),IsEncrypted:!1,PasswordLastUpdate:null,Type:q._.BIP32ED25519},privateKey:null}];return e.builder.addAdhocPublicDeriver((t=>({parentDerivationId:t.root.root.KeyDerivation.KeyDerivationId,pathStartLevel:1,publicDeriverMeta:{name:""},pathToPublic:n,initialDerivations:r,hwWalletMetaInsert:null==e.hwWalletMetaInsert?void 0:{ConceptualWalletId:t.conceptualWalletRow.ConceptualWalletId,...e.hwWalletMetaInsert}})))}a(90649);var ke=a(4922),xe=a(21233),Ce=a(3577),Pe=a(27189),Ae=a(19008),Ee=a(35072);async function Se(e,t){let a=await e.getLastLaunchVersion();ue.Yd.info(`Starting migration for ${a}`);const n=[["=0.0.1",async()=>await async function(e){return ue.Yd.info("Starting testMigration"),await e.setUserLocale("ja-JP"),!0}(e)],["<1.4.0",async()=>await async function(){var e;ue.Yd.info("Starting bip44Migration");const t=await(X.Addresses?X.Addresses:[]),a=Math.max(...b()(e=p()(t).call(t,(e=>0===e.change))).call(e,(e=>e.index)),0);try{await async function(e){const t=await de(oe.WALLET_KEY);if(!t)throw new Error("Need to create a wallet before saving wallet metadata");t.lastReceiveAddressIndex=e,await async function(e,t){await(0,se.mM)(e,ie()(t))}(oe.WALLET_KEY,t)}(a)}catch(e){return!1}return await le(),!0}()],["<1.10.0",async()=>await async function(e){if(!await le()&&!r.Z.isTest())return!1;const t=await async function(){return await de(oe.WALLET_KEY)||void 0}(),a=await async function(){const e=await de(oe.ACCOUNT_KEY);if(!e)return null;if("V2"!==e.derivation_scheme)throw Error("Sanity check");return e}();if(null!=t&&null!=a){const r=await async function(){const e=await de(oe.WALLET_KEY);return e?e.lastReceiveAddressIndex:0}(),n=z.networks.CardanoMainnet;if(null==n.BaseConfig[0].ByronNetworkId)throw new Error("missing Byron network id");const{ByronNetworkId:i}=n.BaseConfig[0],s=Te.RustModule.WalletV2.BlockchainSettings.from_json({protocol_magic:i});await async function(e){if(null!=e.encryptedPk){const t=[],a=e.encryptedPk;let r=Ie.s.start(e.db,ge.lE).addConceptualWallet((t=>({NetworkId:e.network.NetworkId,Name:e.walletName}))).addFromRoot((e=>({rootInsert:{privateKeyInfo:a,publicKeyInfo:null,derivationInfo:e=>({PublicKeyId:e.public,PrivateKeyId:e.private,Parent:null,Index:null}),levelInfo:e=>A().resolve({KeyDerivationId:e.keyDerivationId})},tree:e=>({derivationId:e,children:[]})}))).addBip44Wrapper((e=>({ConceptualWalletId:e.conceptualWalletRow.ConceptualWalletId,SignerLevel:ge.CZ.ROOT.level,PublicDeriverLevel:ge.CZ.ACCOUNT.level,PrivateDeriverKeyDerivationId:e.root.root.KeyDerivation.KeyDerivationId,PrivateDeriverLevel:t.length,RootKeyDerivationId:e.root.root.KeyDerivation.KeyDerivationId})));return r=await De({builder:r,db:e.db,accountPubKey:e.accountPubKey,settings:e.settings,displayCutoff:e.displayCutoff,hwWalletMetaInsert:e.hwWalletMetaInsert}),await r.commit()}{let t=Ie.s.start(e.db,ge.lE).addConceptualWallet((t=>({NetworkId:e.network.NetworkId,Name:e.walletName}))).addFromRoot((e=>({rootInsert:{privateKeyInfo:null,publicKeyInfo:null,derivationInfo:e=>({PublicKeyId:e.public,PrivateKeyId:e.private,Parent:null,Index:null}),levelInfo:e=>A().resolve({KeyDerivationId:e.keyDerivationId})},tree:e=>({derivationId:e,children:[]})}))).addBip44Wrapper((e=>({ConceptualWalletId:e.conceptualWalletRow.ConceptualWalletId,SignerLevel:null,PublicDeriverLevel:ge.CZ.ACCOUNT.level,PrivateDeriverKeyDerivationId:null,PrivateDeriverLevel:null,RootKeyDerivationId:e.root.root.KeyDerivation.KeyDerivationId})));t=await De({builder:t,db:e.db,accountPubKey:e.accountPubKey,settings:e.settings,displayCutoff:e.displayCutoff,hwWalletMetaInsert:e.hwWalletMetaInsert}),await t.commit()}}({db:e,accountPubKey:a.root_cached_key,displayCutoff:r,encryptedPk:null==t.masterKey?void 0:{Hash:t.masterKey,IsEncrypted:!0,PasswordLastUpdate:null==t.adaWallet.cwPassphraseLU?null:new Date(t.adaWallet.cwPassphraseLU),Type:q._.BIP32ED25519},hwWalletMetaInsert:null==t.adaWallet.cwHardwareInfo?void 0:{Vendor:t.adaWallet.cwHardwareInfo.vendor,Model:t.adaWallet.cwHardwareInfo.model,DeviceId:t.adaWallet.cwHardwareInfo.deviceId},settings:s,walletName:t.adaWallet.cwMeta.cwName,network:n})}return await async function(){await(0,se.Hx)(oe.ACCOUNT_KEY),await(0,se.Hx)(oe.WALLET_KEY),await(0,se.Hx)(oe.LAST_BLOCK_NUMBER_KEY)}(),!0}(t)],["=1.10.0",async()=>await Ke(t)],[">=2.0.0 <2.4.0",async()=>await Ke(t)],["<3.0.0",async()=>null!=await(0,se.Jt)(oe.SELECTED_EXPLORER_KEY)&&(await(0,se.Hx)(oe.SELECTED_EXPLORER_KEY),!0)],["<3.3.0",async()=>{const e=await Ke(t),a=await async function(e){const t=await(0,Ae.M)(e);if(0===t.length)return!1;let a=!1;for(const e of t)(0,Pe.hx)(e.getParent())&&(await(0,xe.q)({publicDeriver:e,conceptualWallet:e.getParent()}),a=!0);return a}(t);return e||a}],["<3.8.0",async()=>await Ke(t)],["<4.18",async()=>await async function(e){const t=await(0,Ae.M)(e);if(0===t.length)return!1;for(const e of t)try{if(!(0,z.isCardanoHaskell)(e.getParent().getNetworkInfo()))continue;const t=(0,Ce.se)(e);if(!t)throw new Error("unexpected missing trait");const a=await e.getLastSyncInfo(),r=await t.getAllUtxosFromOldDb(),n=b()(r).call(r,(e=>{const t=e.output.Transaction.BlockId;if(null==t)throw new Error("expect transaction to have block ID");return t})),i=e.getDb(),s=await(0,S.zm)(i,(0,S.Hz)(i,K.Ff),(e=>K.Ff.byIds(i,e,n))),o=new(re())(b()(s).call(s,(e=>[e.BlockId,e.Height]))),l=b()(r).call(r,(e=>{var t,a,r;const n=e.output.UtxoTransactionOutput.OutputIndex,i=e.output.Transaction.Hash,s=e=>""===e.Token.Identifier,l=te()(t=e.output.tokens).call(t,s),d=b()(a=p()(r=e.output.tokens).call(r,(e=>!s(e)))).call(a,(e=>{const{Metadata:t}=e.Token;if("Cardano"!==t.type)throw new Error("unexpected token metadata type");return{assetId:e.Token.Identifier,policyId:t.policyId,name:t.assetName,amount:e.TokenList.Amount}})),c=e.output.Transaction.BlockId;if(null==c)throw new Error("expect transaction to have block ID");const u=o.get(c);if(null==u)throw new Error(`can't find block info for ${c}`);if(null==l)throw new Error("missing default token");return{utxoId:`${i}${n}`,txHash:i,txIndex:n,receiver:e.address,amount:l.TokenList.Amount,assets:d,blockNum:u}})),d=a.BlockHash;if(null==d)throw new Error("missing block hash");await(0,S.zm)(i,(0,S.Hz)(i,Ee.I),(t=>Ee.I.addOrReplace(i,t,e.getPublicDeriverId(),{lastSafeBlockHash:d,utxos:l})))}catch(e){ue.Yd.warn(`UTXO storage migration failed: ${e}`)}return!0}(t)],["<5.4",()=>async function(e){return!!await e.hasAnyLegacyThemeFlags()&&(await e.unsetLegacyThemeFlags(),!0)}(e)]];let i=!1;for(const e of n)he()(a,e[0])&&(ue.Yd.info(`Migration started for ${e[0]}`),await e[1]()?(ue.Yd.info(`Applied migration for ${e[0]}`),i=!0):ue.Yd.info(`No need to apply migration for ${e[0]}`));return i}async function Ke(e){const t=await(0,Ae.M)(e);if(0===t.length)return!1;for(const e of t){const t=(0,Ce.JM)(e);if((0,z.isCardanoHaskell)(e.getParent().getNetworkInfo())){if(null==t)throw new Error("cardanoTxHistoryReset missing levels");await(0,ke.ew)({publicDeriver:t})}}return!0}const Ge=async e=>{if(await e.localStorageApi.getLastLaunchVersion()===e.currVersion)return!1;const t=await Se(e.localStorageApi,e.persistentDb);return await e.localStorageApi.setLastLaunchVersion(e.currVersion),t};let Ne=null,Re=null;async function Be(){const e=new ce.ZP;return Ne||(Ne=await Y(n.schema.DataStoreType.INDEXED_DB)),Re||(Re=Ge({localStorageApi:e,persistentDb:Ne,currVersion:r.N.getVersion()})),await Re,Ne}},41058:(e,t,a)=>{"use strict";a.d(t,{s:()=>d,C:()=>c});var r=a(79562),n=a(85412),i=a(32533),s=a(19187),o=a(11767),l=a(71865);async function d(e=new r.ZP){return new s.w7(await async function(e,t){var a;const r=null!==(a=await t.getUserLocale())&&void 0!==a?a:"en-US";return new e((()=>n.N.getVersion()),(()=>r),(()=>n.N.isFirefox()?"firefox":n.N.isChrome()?"chrome":"-"))}(i.g,e))}async function c(){var e;const t=null!==(e=await(new r.ZP).getUserLocale())&&void 0!==e?e:"en-US";return new l.w(new o.g((()=>n.N.getVersion()),(()=>t),(()=>n.N.isFirefox()?"firefox":n.N.isChrome()?"chrome":"-")))}},51887:(e,t,a)=>{"use strict";a.r(t),a.d(t,{default:()=>u});var r=a(56474),n=a.n(r),i=a(2991),s=a.n(i);const{injectedScripts:o}=a(71712);var l=a(71712),d=a(88318);var c=a(15594);const u=(e,t)=>(({description:e,defaultTitle:t,titleOverride:a,contentSecurityPolicy:r,versionName:i,extensionKey:l,geckoKey:d,iconOverride:c,version:u,enableProtocolHandlers:p,shouldInjectConnector:h})=>{const y=null==c?{16:"img/icon-16.png",48:"img/icon-48.png",128:"img/icon-128.png"}:c,w={version:u,name:!0===a?t:"Yoroi",manifest_version:3,description:e,action:{default_title:t,default_icon:y},browser_specific_settings:{gecko:{id:d}},icons:y,background:{service_worker:"js/background-service-worker.js"},permissions:["storage","system.display"],host_permissions:["*://connect.trezor.io/*"],content_scripts:[{matches:["*://connect.trezor.io/*/popup.html*"],js:["js/trezor-content-script.js"]}],content_security_policy:{extension_pages:r},protocol_handlers:p?[{protocol:"web+cardano",name:"Yoroi",uriTemplate:"main_window.html#/send-from-uri?q=%s"}]:[],web_accessible_resources:[]};h&&(w.content_scripts.push({matches:["file://*/*","http://*/*","https://*/*"],js:["js/inject.js"],run_at:"document_start",all_frames:!0}),w.web_accessible_resources.push({resources:s()(o).call(o,(e=>`js/${e}`)),matches:["<all_urls>"]}));const v=null!=i?{version_name:i}:n()({}),f=null!=l?{key:l}:n()({});return{...v,...w,...f}})({description:"A simple, secure and fast Cardano ADA wallet.",defaultTitle:"Yoroi",titleOverride:!0,contentSecurityPolicy:(0,l.genCSP)({isDev:e,additional:{"connect-src":[(0,d.serverToPermission)(d.Servers.Primary),(0,d.serverToPermission)(d.Servers.Testnet)],"frame-src":[c.POOLS_UI_URL_FOR_YOROI,c.CHANGELLY_URL]}}),version:"5.4.530",geckoKey:"{530f7c6c-6077-4703-8f71-cb368c663e35}",enableProtocolHandlers:!0,shouldInjectConnector:t})},15594:e=>{const t=null!={NODE_ENV:"production",COMMIT:"a6579847a1a3ee7bb20476a994c7647197be82fb",BRANCH:"fix/connector-foreign-withrawal",NIGHTLY:!1,POOLS_UI_URL_FOR_YOROI:"https://adapools.yoroiwallet.com",IS_LIGHT:!1}.SEIZA_URL?{NODE_ENV:"production",COMMIT:"a6579847a1a3ee7bb20476a994c7647197be82fb",BRANCH:"fix/connector-foreign-withrawal",NIGHTLY:!1,POOLS_UI_URL_FOR_YOROI:"https://adapools.yoroiwallet.com",IS_LIGHT:!1}.SEIZA_URL:"https://adapools.yoroiwallet.com",a=null!={NODE_ENV:"production",COMMIT:"a6579847a1a3ee7bb20476a994c7647197be82fb",BRANCH:"fix/connector-foreign-withrawal",NIGHTLY:!1,POOLS_UI_URL_FOR_YOROI:"https://adapools.yoroiwallet.com",IS_LIGHT:!1}.changelly_url?{NODE_ENV:"production",COMMIT:"a6579847a1a3ee7bb20476a994c7647197be82fb",BRANCH:"fix/connector-foreign-withrawal",NIGHTLY:!1,POOLS_UI_URL_FOR_YOROI:"https://adapools.yoroiwallet.com",IS_LIGHT:!1}.changelly_url:"https://widget.changelly.com/";e.exports={CHANGELLY_URL:a,POOLS_UI_URL_FOR_YOROI:"https://adapools.yoroiwallet.com",SEIZA_URL:t}},12355:(e,t,a)=>{"use strict";a.d(t,{t:()=>r});const r={DEVELOPMENT:"development",MAINNET:"mainnet",TEST:"test"}},88318:e=>{e.exports={portToPermission:function(e){return`http://localhost:${e} https://localhost:${e}`},Ports:{DevBackendServer:21e3,ReactDevTools:8097},serverToPermission:function(e){return`https://${e}`},Servers:{Primary:"*.yoroiwallet.com",Testnet:"*.emurgornd.com"}}},98390:(e,t,a)=>{"use strict";a(81643),a.p=chrome.extension.getURL("/js/")},46700:(e,t,a)=>{var r={"./af":42786,"./af.js":42786,"./ar":30867,"./ar-dz":14130,"./ar-dz.js":14130,"./ar-kw":96135,"./ar-kw.js":96135,"./ar-ly":56440,"./ar-ly.js":56440,"./ar-ma":47702,"./ar-ma.js":47702,"./ar-ps":20315,"./ar-ps.js":20315,"./ar-sa":16040,"./ar-sa.js":16040,"./ar-tn":37100,"./ar-tn.js":37100,"./ar.js":30867,"./az":31083,"./az.js":31083,"./be":9808,"./be.js":9808,"./bg":68338,"./bg.js":68338,"./bm":67438,"./bm.js":67438,"./bn":8905,"./bn-bd":76225,"./bn-bd.js":76225,"./bn.js":8905,"./bo":11560,"./bo.js":11560,"./br":1278,"./br.js":1278,"./bs":80622,"./bs.js":80622,"./ca":2468,"./ca.js":2468,"./cs":5822,"./cs.js":5822,"./cv":50877,"./cv.js":50877,"./cy":47373,"./cy.js":47373,"./da":24780,"./da.js":24780,"./de":59740,"./de-at":60217,"./de-at.js":60217,"./de-ch":60894,"./de-ch.js":60894,"./de.js":59740,"./dv":5300,"./dv.js":5300,"./el":50837,"./el.js":50837,"./en-au":78348,"./en-au.js":78348,"./en-ca":77925,"./en-ca.js":77925,"./en-gb":22243,"./en-gb.js":22243,"./en-ie":46436,"./en-ie.js":46436,"./en-il":47207,"./en-il.js":47207,"./en-in":44175,"./en-in.js":44175,"./en-nz":76319,"./en-nz.js":76319,"./en-sg":31662,"./en-sg.js":31662,"./eo":92915,"./eo.js":92915,"./es":55655,"./es-do":55251,"./es-do.js":55251,"./es-mx":96112,"./es-mx.js":96112,"./es-us":71146,"./es-us.js":71146,"./es.js":55655,"./et":5603,"./et.js":5603,"./eu":77763,"./eu.js":77763,"./fa":76959,"./fa.js":76959,"./fi":11897,"./fi.js":11897,"./fil":42549,"./fil.js":42549,"./fo":94694,"./fo.js":94694,"./fr":94470,"./fr-ca":63049,"./fr-ca.js":63049,"./fr-ch":52330,"./fr-ch.js":52330,"./fr.js":94470,"./fy":5044,"./fy.js":5044,"./ga":29295,"./ga.js":29295,"./gd":2101,"./gd.js":2101,"./gl":38794,"./gl.js":38794,"./gom-deva":27884,"./gom-deva.js":27884,"./gom-latn":23168,"./gom-latn.js":23168,"./gu":95349,"./gu.js":95349,"./he":24206,"./he.js":24206,"./hi":30094,"./hi.js":30094,"./hr":30316,"./hr.js":30316,"./hu":22138,"./hu.js":22138,"./hy-am":11423,"./hy-am.js":11423,"./id":29218,"./id.js":29218,"./is":90135,"./is.js":90135,"./it":90626,"./it-ch":10150,"./it-ch.js":10150,"./it.js":90626,"./ja":39183,"./ja.js":39183,"./jv":24286,"./jv.js":24286,"./ka":12105,"./ka.js":12105,"./kk":47772,"./kk.js":47772,"./km":18758,"./km.js":18758,"./kn":79282,"./kn.js":79282,"./ko":33730,"./ko.js":33730,"./ku":1408,"./ku-kmr":90563,"./ku-kmr.js":90563,"./ku.js":1408,"./ky":33291,"./ky.js":33291,"./lb":36841,"./lb.js":36841,"./lo":55466,"./lo.js":55466,"./lt":57010,"./lt.js":57010,"./lv":37595,"./lv.js":37595,"./me":39861,"./me.js":39861,"./mi":35493,"./mi.js":35493,"./mk":95966,"./mk.js":95966,"./ml":87341,"./ml.js":87341,"./mn":5115,"./mn.js":5115,"./mr":10370,"./mr.js":10370,"./ms":9847,"./ms-my":41237,"./ms-my.js":41237,"./ms.js":9847,"./mt":72126,"./mt.js":72126,"./my":56165,"./my.js":56165,"./nb":64924,"./nb.js":64924,"./ne":16744,"./ne.js":16744,"./nl":93901,"./nl-be":59814,"./nl-be.js":59814,"./nl.js":93901,"./nn":83877,"./nn.js":83877,"./oc-lnc":92135,"./oc-lnc.js":92135,"./pa-in":15858,"./pa-in.js":15858,"./pl":64495,"./pl.js":64495,"./pt":89520,"./pt-br":57971,"./pt-br.js":57971,"./pt.js":89520,"./ro":96459,"./ro.js":96459,"./ru":21793,"./ru.js":21793,"./sd":40950,"./sd.js":40950,"./se":10490,"./se.js":10490,"./si":90124,"./si.js":90124,"./sk":64249,"./sk.js":64249,"./sl":14985,"./sl.js":14985,"./sq":51104,"./sq.js":51104,"./sr":49131,"./sr-cyrl":79915,"./sr-cyrl.js":79915,"./sr.js":49131,"./ss":85893,"./ss.js":85893,"./sv":98760,"./sv.js":98760,"./sw":91172,"./sw.js":91172,"./ta":27333,"./ta.js":27333,"./te":23110,"./te.js":23110,"./tet":52095,"./tet.js":52095,"./tg":27321,"./tg.js":27321,"./th":9041,"./th.js":9041,"./tk":19005,"./tk.js":19005,"./tl-ph":75768,"./tl-ph.js":75768,"./tlh":89444,"./tlh.js":89444,"./tr":72397,"./tr.js":72397,"./tzl":28254,"./tzl.js":28254,"./tzm":51106,"./tzm-latn":30699,"./tzm-latn.js":30699,"./tzm.js":51106,"./ug-cn":9288,"./ug-cn.js":9288,"./uk":67691,"./uk.js":67691,"./ur":13795,"./ur.js":13795,"./uz":6791,"./uz-latn":60588,"./uz-latn.js":60588,"./uz.js":6791,"./vi":65666,"./vi.js":65666,"./x-pseudo":14378,"./x-pseudo.js":14378,"./yo":75805,"./yo.js":75805,"./zh-cn":83839,"./zh-cn.js":83839,"./zh-hk":55726,"./zh-hk.js":55726,"./zh-mo":99807,"./zh-mo.js":99807,"./zh-tw":74152,"./zh-tw.js":74152};function n(e){var t=i(e);return a(t)}function i(e){if(!a.o(r,e)){var t=new Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t}return r[e]}n.keys=function(){return Object.keys(r)},n.resolve=i,e.exports=n,n.id=46700},30214:()=>{},69228:()=>{},36631:()=>{},32574:()=>{},63906:()=>{},61758:()=>{},27790:()=>{}}]);