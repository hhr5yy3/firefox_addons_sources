var background=function(){"use strict";var Ve=Object.defineProperty;var Ke=(D,S,I)=>S in D?Ve(D,S,{enumerable:!0,configurable:!0,writable:!0,value:I}):D[S]=I;var P=(D,S,I)=>Ke(D,typeof S!="symbol"?S+"":S,I);function D(e){return e==null||typeof e=="function"?{main:e}:e}var S=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function I(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}var Z={exports:{}};(function(e,r){(function(t,s){s(e)})(typeof globalThis<"u"?globalThis:typeof self<"u"?self:S,function(t){if(!(globalThis.chrome&&globalThis.chrome.runtime&&globalThis.chrome.runtime.id))throw new Error("This script should only be loaded in a browser extension.");if(globalThis.browser&&globalThis.browser.runtime&&globalThis.browser.runtime.id)t.exports=globalThis.browser;else{const s="The message port closed before a response was received.",c=a=>{const o={alarms:{clear:{minArgs:0,maxArgs:1},clearAll:{minArgs:0,maxArgs:0},get:{minArgs:0,maxArgs:1},getAll:{minArgs:0,maxArgs:0}},bookmarks:{create:{minArgs:1,maxArgs:1},get:{minArgs:1,maxArgs:1},getChildren:{minArgs:1,maxArgs:1},getRecent:{minArgs:1,maxArgs:1},getSubTree:{minArgs:1,maxArgs:1},getTree:{minArgs:0,maxArgs:0},move:{minArgs:2,maxArgs:2},remove:{minArgs:1,maxArgs:1},removeTree:{minArgs:1,maxArgs:1},search:{minArgs:1,maxArgs:1},update:{minArgs:2,maxArgs:2}},browserAction:{disable:{minArgs:0,maxArgs:1,fallbackToNoCallback:!0},enable:{minArgs:0,maxArgs:1,fallbackToNoCallback:!0},getBadgeBackgroundColor:{minArgs:1,maxArgs:1},getBadgeText:{minArgs:1,maxArgs:1},getPopup:{minArgs:1,maxArgs:1},getTitle:{minArgs:1,maxArgs:1},openPopup:{minArgs:0,maxArgs:0},setBadgeBackgroundColor:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0},setBadgeText:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0},setIcon:{minArgs:1,maxArgs:1},setPopup:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0},setTitle:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0}},browsingData:{remove:{minArgs:2,maxArgs:2},removeCache:{minArgs:1,maxArgs:1},removeCookies:{minArgs:1,maxArgs:1},removeDownloads:{minArgs:1,maxArgs:1},removeFormData:{minArgs:1,maxArgs:1},removeHistory:{minArgs:1,maxArgs:1},removeLocalStorage:{minArgs:1,maxArgs:1},removePasswords:{minArgs:1,maxArgs:1},removePluginData:{minArgs:1,maxArgs:1},settings:{minArgs:0,maxArgs:0}},commands:{getAll:{minArgs:0,maxArgs:0}},contextMenus:{remove:{minArgs:1,maxArgs:1},removeAll:{minArgs:0,maxArgs:0},update:{minArgs:2,maxArgs:2}},cookies:{get:{minArgs:1,maxArgs:1},getAll:{minArgs:1,maxArgs:1},getAllCookieStores:{minArgs:0,maxArgs:0},remove:{minArgs:1,maxArgs:1},set:{minArgs:1,maxArgs:1}},devtools:{inspectedWindow:{eval:{minArgs:1,maxArgs:2,singleCallbackArg:!1}},panels:{create:{minArgs:3,maxArgs:3,singleCallbackArg:!0},elements:{createSidebarPane:{minArgs:1,maxArgs:1}}}},downloads:{cancel:{minArgs:1,maxArgs:1},download:{minArgs:1,maxArgs:1},erase:{minArgs:1,maxArgs:1},getFileIcon:{minArgs:1,maxArgs:2},open:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0},pause:{minArgs:1,maxArgs:1},removeFile:{minArgs:1,maxArgs:1},resume:{minArgs:1,maxArgs:1},search:{minArgs:1,maxArgs:1},show:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0}},extension:{isAllowedFileSchemeAccess:{minArgs:0,maxArgs:0},isAllowedIncognitoAccess:{minArgs:0,maxArgs:0}},history:{addUrl:{minArgs:1,maxArgs:1},deleteAll:{minArgs:0,maxArgs:0},deleteRange:{minArgs:1,maxArgs:1},deleteUrl:{minArgs:1,maxArgs:1},getVisits:{minArgs:1,maxArgs:1},search:{minArgs:1,maxArgs:1}},i18n:{detectLanguage:{minArgs:1,maxArgs:1},getAcceptLanguages:{minArgs:0,maxArgs:0}},identity:{launchWebAuthFlow:{minArgs:1,maxArgs:1}},idle:{queryState:{minArgs:1,maxArgs:1}},management:{get:{minArgs:1,maxArgs:1},getAll:{minArgs:0,maxArgs:0},getSelf:{minArgs:0,maxArgs:0},setEnabled:{minArgs:2,maxArgs:2},uninstallSelf:{minArgs:0,maxArgs:1}},notifications:{clear:{minArgs:1,maxArgs:1},create:{minArgs:1,maxArgs:2},getAll:{minArgs:0,maxArgs:0},getPermissionLevel:{minArgs:0,maxArgs:0},update:{minArgs:2,maxArgs:2}},pageAction:{getPopup:{minArgs:1,maxArgs:1},getTitle:{minArgs:1,maxArgs:1},hide:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0},setIcon:{minArgs:1,maxArgs:1},setPopup:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0},setTitle:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0},show:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0}},permissions:{contains:{minArgs:1,maxArgs:1},getAll:{minArgs:0,maxArgs:0},remove:{minArgs:1,maxArgs:1},request:{minArgs:1,maxArgs:1}},runtime:{getBackgroundPage:{minArgs:0,maxArgs:0},getPlatformInfo:{minArgs:0,maxArgs:0},openOptionsPage:{minArgs:0,maxArgs:0},requestUpdateCheck:{minArgs:0,maxArgs:0},sendMessage:{minArgs:1,maxArgs:3},sendNativeMessage:{minArgs:2,maxArgs:2},setUninstallURL:{minArgs:1,maxArgs:1}},sessions:{getDevices:{minArgs:0,maxArgs:1},getRecentlyClosed:{minArgs:0,maxArgs:1},restore:{minArgs:0,maxArgs:1}},storage:{local:{clear:{minArgs:0,maxArgs:0},get:{minArgs:0,maxArgs:1},getBytesInUse:{minArgs:0,maxArgs:1},remove:{minArgs:1,maxArgs:1},set:{minArgs:1,maxArgs:1}},managed:{get:{minArgs:0,maxArgs:1},getBytesInUse:{minArgs:0,maxArgs:1}},sync:{clear:{minArgs:0,maxArgs:0},get:{minArgs:0,maxArgs:1},getBytesInUse:{minArgs:0,maxArgs:1},remove:{minArgs:1,maxArgs:1},set:{minArgs:1,maxArgs:1}}},tabs:{captureVisibleTab:{minArgs:0,maxArgs:2},create:{minArgs:1,maxArgs:1},detectLanguage:{minArgs:0,maxArgs:1},discard:{minArgs:0,maxArgs:1},duplicate:{minArgs:1,maxArgs:1},executeScript:{minArgs:1,maxArgs:2},get:{minArgs:1,maxArgs:1},getCurrent:{minArgs:0,maxArgs:0},getZoom:{minArgs:0,maxArgs:1},getZoomSettings:{minArgs:0,maxArgs:1},goBack:{minArgs:0,maxArgs:1},goForward:{minArgs:0,maxArgs:1},highlight:{minArgs:1,maxArgs:1},insertCSS:{minArgs:1,maxArgs:2},move:{minArgs:2,maxArgs:2},query:{minArgs:1,maxArgs:1},reload:{minArgs:0,maxArgs:2},remove:{minArgs:1,maxArgs:1},removeCSS:{minArgs:1,maxArgs:2},sendMessage:{minArgs:2,maxArgs:3},setZoom:{minArgs:1,maxArgs:2},setZoomSettings:{minArgs:1,maxArgs:2},update:{minArgs:1,maxArgs:2}},topSites:{get:{minArgs:0,maxArgs:0}},webNavigation:{getAllFrames:{minArgs:1,maxArgs:1},getFrame:{minArgs:1,maxArgs:1}},webRequest:{handlerBehaviorChanged:{minArgs:0,maxArgs:0}},windows:{create:{minArgs:0,maxArgs:1},get:{minArgs:1,maxArgs:2},getAll:{minArgs:0,maxArgs:1},getCurrent:{minArgs:0,maxArgs:1},getLastFocused:{minArgs:0,maxArgs:1},remove:{minArgs:1,maxArgs:1},update:{minArgs:2,maxArgs:2}}};if(Object.keys(o).length===0)throw new Error("api-metadata.json has not been included in browser-polyfill");class k extends WeakMap{constructor(i,l=void 0){super(l),this.createItem=i}get(i){return this.has(i)||this.set(i,this.createItem(i)),super.get(i)}}const f=n=>n&&typeof n=="object"&&typeof n.then=="function",y=(n,i)=>(...l)=>{a.runtime.lastError?n.reject(new Error(a.runtime.lastError.message)):i.singleCallbackArg||l.length<=1&&i.singleCallbackArg!==!1?n.resolve(l[0]):n.resolve(l)},B=n=>n==1?"argument":"arguments",ze=(n,i)=>function(m,...h){if(h.length<i.minArgs)throw new Error(`Expected at least ${i.minArgs} ${B(i.minArgs)} for ${n}(), got ${h.length}`);if(h.length>i.maxArgs)throw new Error(`Expected at most ${i.maxArgs} ${B(i.maxArgs)} for ${n}(), got ${h.length}`);return new Promise((x,b)=>{if(i.fallbackToNoCallback)try{m[n](...h,y({resolve:x,reject:b},i))}catch(g){console.warn(`${n} API method doesn't seem to support the callback parameter, falling back to call it without a callback: `,g),m[n](...h),i.fallbackToNoCallback=!1,i.noCallback=!0,x()}else i.noCallback?(m[n](...h),x()):m[n](...h,y({resolve:x,reject:b},i))})},oe=(n,i,l)=>new Proxy(i,{apply(m,h,x){return l.call(h,n,...x)}});let F=Function.call.bind(Object.prototype.hasOwnProperty);const O=(n,i={},l={})=>{let m=Object.create(null),h={has(b,g){return g in n||g in m},get(b,g,w){if(g in m)return m[g];if(!(g in n))return;let u=n[g];if(typeof u=="function")if(typeof i[g]=="function")u=oe(n,n[g],i[g]);else if(F(l,g)){let v=ze(g,l[g]);u=oe(n,n[g],v)}else u=u.bind(n);else if(typeof u=="object"&&u!==null&&(F(i,g)||F(l,g)))u=O(u,i[g],l[g]);else if(F(l,"*"))u=O(u,i[g],l["*"]);else return Object.defineProperty(m,g,{configurable:!0,enumerable:!0,get(){return n[g]},set(v){n[g]=v}}),u;return m[g]=u,u},set(b,g,w,u){return g in m?m[g]=w:n[g]=w,!0},defineProperty(b,g,w){return Reflect.defineProperty(m,g,w)},deleteProperty(b,g){return Reflect.deleteProperty(m,g)}},x=Object.create(n);return new Proxy(x,h)},q=n=>({addListener(i,l,...m){i.addListener(n.get(l),...m)},hasListener(i,l){return i.hasListener(n.get(l))},removeListener(i,l){i.removeListener(n.get(l))}}),Ge=new k(n=>typeof n!="function"?n:function(l){const m=O(l,{},{getContent:{minArgs:0,maxArgs:0}});n(m)}),ge=new k(n=>typeof n!="function"?n:function(l,m,h){let x=!1,b,g=new Promise(C=>{b=function(E){x=!0,C(E)}}),w;try{w=n(l,m,b)}catch(C){w=Promise.reject(C)}const u=w!==!0&&f(w);if(w!==!0&&!u&&!x)return!1;const v=C=>{C.then(E=>{h(E)},E=>{let K;E&&(E instanceof Error||typeof E.message=="string")?K=E.message:K="An unexpected error occurred",h({__mozWebExtensionPolyfillReject__:!0,message:K})}).catch(E=>{console.error("Failed to send onMessage rejected reply",E)})};return v(u?w:g),!0}),_e=({reject:n,resolve:i},l)=>{a.runtime.lastError?a.runtime.lastError.message===s?i():n(new Error(a.runtime.lastError.message)):l&&l.__mozWebExtensionPolyfillReject__?n(new Error(l.message)):i(l)},le=(n,i,l,...m)=>{if(m.length<i.minArgs)throw new Error(`Expected at least ${i.minArgs} ${B(i.minArgs)} for ${n}(), got ${m.length}`);if(m.length>i.maxArgs)throw new Error(`Expected at most ${i.maxArgs} ${B(i.maxArgs)} for ${n}(), got ${m.length}`);return new Promise((h,x)=>{const b=_e.bind(null,{resolve:h,reject:x});m.push(b),l.sendMessage(...m)})},qe={devtools:{network:{onRequestFinished:q(Ge)}},runtime:{onMessage:q(ge),onMessageExternal:q(ge),sendMessage:le.bind(null,"sendMessage",{minArgs:1,maxArgs:3})},tabs:{sendMessage:le.bind(null,"sendMessage",{minArgs:2,maxArgs:3})}},V={clear:{minArgs:1,maxArgs:1},get:{minArgs:1,maxArgs:1},set:{minArgs:1,maxArgs:1}};return o.privacy={network:{"*":V},services:{"*":V},websites:{"*":V}},O(a,qe,o)};t.exports=c(chrome)}})})(Z);var ce=Z.exports;const d=I(ce);var p=(e=>(e.StoreHighlightInDB="store-highlight",e.RefetchHighlights="refetch-highlights",e.GetHighlights="get-highlights",e.GetHighlight="get-highlight",e.UpdateHighlight="update-highlight",e.DeleteFromStore="delete-highlight-from-store",e.DeleteFromHighlighter="delete-highlight-from-highlighter",e.TabUpdate="tab-update",e.GetUserSettings="get-user-settings",e.UserSettingsUpdate="user-settings-update",e.UpdateUserSettings="update-user-settings",e.Error="error",e))(p||{});async function J(){var r;const e=await d.tabs.query({active:!0,currentWindow:!0});return((r=e[0])==null?void 0:r.id)!=null?e[0]:null}var Y=(e=>(e.Yellow="#FFFF00",e.Green="#00FF00",e.Blue="#0000FF",e.Orange="#FFA94D",e.Grape="#da77f2",e))(Y||{});const Q={autoHighlighting:!1,extendedHighlighting:!0,displayHighlightsAsText:!1,exportFilteredOnly:!0,exportHighlightsFromText:!1,exportForUrl:!0,exportNewHighlightsOnly:!1,obsidianSync:!1,obsidianSyncUrl:"http://localhost:9090",highlightColorSelection:Y.Green,highlightingDisabled:!1};async function me(e){await d.storage.local.set({userSettings:e})}async function X(){const e=await d.storage.local.get("userSettings");return e.userSettings===void 0?Q:{...Q,...e.userSettings}}const N=(e,r)=>r.some(t=>e instanceof t);let ee,re;function Ae(){return ee||(ee=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])}function ue(){return re||(re=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])}const H=new WeakMap,R=new WeakMap,M=new WeakMap;function de(e){const r=new Promise((t,s)=>{const c=()=>{e.removeEventListener("success",a),e.removeEventListener("error",o)},a=()=>{t(T(e.result)),c()},o=()=>{s(e.error),c()};e.addEventListener("success",a),e.addEventListener("error",o)});return M.set(r,e),r}function he(e){if(H.has(e))return;const r=new Promise((t,s)=>{const c=()=>{e.removeEventListener("complete",a),e.removeEventListener("error",o),e.removeEventListener("abort",o)},a=()=>{t(),c()},o=()=>{s(e.error||new DOMException("AbortError","AbortError")),c()};e.addEventListener("complete",a),e.addEventListener("error",o),e.addEventListener("abort",o)});H.set(e,r)}let U={get(e,r,t){if(e instanceof IDBTransaction){if(r==="done")return H.get(e);if(r==="store")return t.objectStoreNames[1]?void 0:t.objectStore(t.objectStoreNames[0])}return T(e[r])},set(e,r,t){return e[r]=t,!0},has(e,r){return e instanceof IDBTransaction&&(r==="done"||r==="store")?!0:r in e}};function te(e){U=e(U)}function fe(e){return ue().includes(e)?function(...r){return e.apply(j(this),r),T(this.request)}:function(...r){return T(e.apply(j(this),r))}}function xe(e){return typeof e=="function"?fe(e):(e instanceof IDBTransaction&&he(e),N(e,Ae())?new Proxy(e,U):e)}function T(e){if(e instanceof IDBRequest)return de(e);if(R.has(e))return R.get(e);const r=xe(e);return r!==e&&(R.set(e,r),M.set(r,e)),r}const j=e=>M.get(e);function be(e,r,{blocked:t,upgrade:s,blocking:c,terminated:a}={}){const o=indexedDB.open(e,r),k=T(o);return s&&o.addEventListener("upgradeneeded",f=>{s(T(o.result),f.oldVersion,f.newVersion,T(o.transaction),f)}),t&&o.addEventListener("blocked",f=>t(f.oldVersion,f.newVersion,f)),k.then(f=>{a&&f.addEventListener("close",()=>a()),c&&f.addEventListener("versionchange",y=>c(y.oldVersion,y.newVersion,y))}).catch(()=>{}),k}function we(e,{blocked:r}={}){const t=indexedDB.deleteDatabase(e);return r&&t.addEventListener("blocked",s=>r(s.oldVersion,s)),T(t).then(()=>{})}const pe=["get","getKey","getAll","getAllKeys","count"],ye=["put","add","delete","clear"],$=new Map;function se(e,r){if(!(e instanceof IDBDatabase&&!(r in e)&&typeof r=="string"))return;if($.get(r))return $.get(r);const t=r.replace(/FromIndex$/,""),s=r!==t,c=ye.includes(t);if(!(t in(s?IDBIndex:IDBObjectStore).prototype)||!(c||pe.includes(t)))return;const a=async function(o,...k){const f=this.transaction(o,c?"readwrite":"readonly");let y=f.store;return s&&(y=y.index(k.shift())),(await Promise.all([y[t](...k),c&&f.done]))[0]};return $.set(r,a),a}te(e=>({...e,get:(r,t,s)=>se(r,t)||e.get(r,t,s),has:(r,t)=>!!se(r,t)||e.has(r,t)}));const Ee=["continue","continuePrimaryKey","advance"],ne={},W=new WeakMap,ie=new WeakMap,Se={get(e,r){if(!Ee.includes(r))return e[r];let t=ne[r];return t||(t=ne[r]=function(...s){W.set(this,ie.get(this)[r](...s))}),t}};async function*Te(...e){let r=this;if(r instanceof IDBCursor||(r=await r.openCursor(...e)),!r)return;r=r;const t=new Proxy(r,Se);for(ie.set(t,r),M.set(t,j(r));r;)yield t,r=await(W.get(t)||r.continue()),W.delete(t)}function ae(e,r){return r===Symbol.asyncIterator&&N(e,[IDBIndex,IDBObjectStore,IDBCursor])||r==="iterate"&&N(e,[IDBIndex,IDBObjectStore])}te(e=>({...e,get(r,t,s){return ae(r,t)?Te:e.get(r,t,s)},has(r,t){return ae(r,t)||e.has(r,t)}}));async function ke(e){const r=await Ie();if(r.some(s=>s.id===e.id)){await De(r,e);return}const t=[e,...r];await d.storage.local.set({errorLogEntries:t})}async function De(e,r){const t=e.map(s=>s.id===r.id?r:s);await d.storage.local.set({errorLogEntries:t})}async function Ie(){const e=await d.storage.local.get("errorLogEntries");return e.errorLogEntries===void 0?[]:e.errorLogEntries}async function z(e,r){Ce(e,r),ve(e,r)}async function ve(e,r){const t=await J();(t==null?void 0:t.id)!=null&&d.tabs.sendMessage(t.id,{type:p.Error,payload:{title:e,description:r}})}async function Ce(e,r){const s={id:await Pe(e+r),title:e,description:r,createdAt:new Date};return ke(s)}async function Pe(e){const t=new TextEncoder().encode(e),s=await crypto.subtle.digest("SHA-1",t);return Array.from(new Uint8Array(s)).map(a=>a.toString(16).padStart(2,"0")).join("")}const Me=4,A=class A{constructor(r){P(this,"db");P(this,"databaseInitialized");this.databaseInitialized=this.initDatabase(r)}async initDatabase(r){try{this.db=await be(A.DATABASE_NAME,r,{upgrade:(t,s,c,a)=>this.migrateDatabase(t,s,a)})}catch(t){A.assertIsError(t),z("Error initializing database",`If highlights are not stored, please try to reload the page or restart the browser to reload the extension. ${t?"Error: "+t.message:""}`),console.error("Error initializing database",t)}}async migrateDatabase(r,t,s){switch(t){case 0:r.createObjectStore(A.STORE_NAME,{keyPath:"id"}).createIndex("url-index","url",{unique:!1});case 1:{let a=await s.objectStore(A.STORE_NAME).openCursor();for(;a;){const o=a.value;o.markdown===void 0&&(o.markdown=o.text,await a.update(o)),a=await a.continue()}}case 2:{let a=await s.objectStore(A.STORE_NAME).openCursor();for(;a;){const o=a.value;o.createdAt instanceof Date&&(o.createdAt=o.createdAt.toISOString(),await a.update(o)),a=await a.continue()}}case 3:{let a=await s.objectStore(A.STORE_NAME).openCursor();for(;a;){const o=a.value;o.updatedAt===void 0&&(o.updatedAt=o.createdAt),o.hidden===void 0&&(o.hidden=!1),await a.update(o),a=await a.continue()}}}}async storeHighlight(r){A.assertDatabaseInitialized(this.db),await this.db.add(A.STORE_NAME,r)}async removeHighlight(r){A.assertDatabaseInitialized(this.db),await this.db.delete(A.STORE_NAME,r)}async updateHighlight(r){A.assertDatabaseInitialized(this.db),r.updatedAt=new Date().toISOString(),await this.db.put(A.STORE_NAME,r)}async getHighlights(){return A.assertDatabaseInitialized(this.db),await this.db.getAll(A.STORE_NAME)}async getHighlight(r){A.assertDatabaseInitialized(this.db);const t=await this.db.get(A.STORE_NAME,r);if(t===void 0)throw new Error(`No highlight with ID '${r}' found.`);return t}async getHighlightsForUrl(r){return A.assertDatabaseInitialized(this.db),await this.db.getAllFromIndex(A.STORE_NAME,"url-index",r)}async getNonExportedHighlights(){return(await this.getHighlights()).filter(t=>!t.exported)}async getNonExportedHighlightsForUrl(r){return(await this.getHighlightsForUrl(r)).filter(s=>!s.exported)}async markHighlightsAsExported(r){return this.setHighlightExportStatus(r,!0)}async setHighlightExportStatus(r,t){A.assertDatabaseInitialized(this.db);const s=this.db.transaction(A.STORE_NAME,"readwrite"),c=s.objectStore(A.STORE_NAME),a=r.map(o=>(o.exported=t,c.put(o)));await Promise.all(a),await s.done}close(){var r;(r=this.db)==null||r.close()}unsafeDelete(){return this.close(),we(A.DATABASE_NAME)}static assertIsError(r){if(!(r instanceof Error))throw r}static assertDatabaseInitialized(r){if(r==null)throw new Error("Database not initialized")}};P(A,"STORE_NAME","highlights"),P(A,"DATABASE_NAME",A.STORE_NAME+"-db");let G=A;async function Le(e,r){return Be(e,"PUT",r)}async function Be(e,r,t){const s=new Headers;t!=null&&s.set("Content-Type","application/json");const c=await fetch(e,{method:r,headers:s,body:JSON.stringify(t)});if(!c.ok){const o=await c.text();throw new Fe(o,c.status)}if(c.headers.get("Content-Type")==="application/json")return c.json()}class Fe extends Error{constructor(r,t){super(r),this.status=t,this.name="HttpError"}getStatus(){return this.status}}async function Oe(e,r){const t=Ne(e,"highlight");return Le(t,{url:e,content:r.markdown,title:r.title??r.url})}function Ne(e,r){let t;try{t=new URL(r,e)}catch(s){throw s instanceof TypeError?e===""?new Error("Please enter the URL configured in the Mark my Word Obsidian extension."):new TypeError(`Invalid URL format for URL ${e+"/"+r}: ${s.message}`):s}return t}async function He(e){(await d.tabs.query({})).forEach(t=>{t.id!=null&&d.tabs.sendMessage(t.id,e)})}const Re=D({persistent:!1,main:Ue});function Ue(){const e=new G(Me);d.tabs.onUpdated.addListener(async(r,t,s)=>{if(s.status==="complete"){const c=await J();if(c!==null&&r===c.id){const a=await e.getHighlightsForUrl(s.url??"");await d.tabs.sendMessage(r,{type:p.TabUpdate,payload:a})}}}),d.runtime.getPlatformInfo().then(r=>{r.os==="android"?d.browserAction.setPopup({popup:"custom-popup.html"}):d.browserAction!=null&&d.browserAction.onClicked.addListener(()=>{d.sidebarAction.toggle()})}),d.runtime.onMessage.addListener(r=>je(r,e))}async function je(e,r){switch(e.type){case p.StoreHighlightInDB:return $e(e.payload,r);case p.GetHighlights:return r.getHighlightsForUrl(e.payload);case p.GetHighlight:return r.getHighlight(e.payload);case p.UpdateHighlight:return r.updateHighlight(e.payload);case p.GetUserSettings:return X();case p.UpdateUserSettings:const t=e.payload;return await me(t),He({type:p.UserSettingsUpdate,payload:t});case p.DeleteFromStore:const s=e.payload;return r.removeHighlight(s)}}async function $e(e,r){const t=await X();t.obsidianSync&&(e.exported=!0);try{await r.storeHighlight(e)}catch(s){z("Failed to store highlight in the database",s.message),console.error("error: ",s),console.error("highlight: ",e)}if(t.obsidianSync)try{await Oe(t.obsidianSyncUrl,e)}catch(s){z("Failed to sync highlight to Obsidian",`Make sure Obsidian is running, the Mark my Word extension is enabled, and the URL is correct.
                  Error message: ${s.message}
                `),r.setHighlightExportStatus([e],!1)}}function Ze(){}function L(e,...r){}const We={debug:(...e)=>L(console.debug,...e),log:(...e)=>L(console.log,...e),warn:(...e)=>L(console.warn,...e),error:(...e)=>L(console.error,...e)};let _;try{_=Re.main(),_ instanceof Promise&&console.warn("The background's main() function return a promise, but it must be synchronous")}catch(e){throw We.error("The background crashed on startup!"),e}return _}();
background;
//# sourceMappingURL=background.js.map
