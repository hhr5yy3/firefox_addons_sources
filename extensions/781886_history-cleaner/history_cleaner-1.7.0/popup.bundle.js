(()=>{"use strict";const e="browser"in self?browser:chrome;class t{constructor(t){if(this.behavior="disable",this.days=0,this.idleLength=60,this.timerInterval=1440,this.deleteMode="timer",this.notifications=!1,this.downloads=!1,this.icon="theme",this.lastRun=e.i18n.getMessage("lastRunNever"),this.deleteCount=0,void 0===t)return;const n=e.runtime.getManifest().manifest_version;"string"==typeof t.behavior&&["disable","days","all"].includes(t.behavior)?this.behavior=t.behavior:"number"==typeof t.days&&t.days>0&&(this.behavior="days"),"number"==typeof t.days&&t.days>=0&&(this.days=t.days),"number"==typeof t.idleLength&&t.idleLength>=15&&(this.idleLength=t.idleLength),"number"==typeof t.timerInterval&&t.timerInterval>=1&&(this.timerInterval=t.timerInterval),"string"==typeof t.deleteMode&&["idle","startup","timer"].includes(t.deleteMode)&&(this.deleteMode=t.deleteMode),3===n&&"idle"===this.deleteMode&&(this.deleteMode="timer"),"boolean"==typeof t.notifications&&(this.notifications=t.notifications),"boolean"==typeof t.downloads&&(this.downloads=t.downloads),"string"==typeof t.lastRun&&(this.lastRun=t.lastRun),"string"==typeof t.icon&&(this.icon=t.icon),3===n&&"theme"===this.icon&&(this.icon="icon_circle_gradient")}}var n;!function(e){e[e.INVALID=-1]="INVALID",e[e.DELETE=0]="DELETE",e[e.SET_IDLE=1]="SET_IDLE",e[e.SET_STARTUP=2]="SET_STARTUP",e[e.SET_TIMER=3]="SET_TIMER",e[e.SET_ICON=4]="SET_ICON"}(n||(n={}));class i{constructor(e){this.state=e?.state??-1,this.idleLength=e?.idleLength??-1,this.timerInterval=e?.timerInterval??-1,this.icon=e?.icon??"theme"}}async function s(t,n,i){const s=n.target;if(s.checked){n.preventDefault();const a=await e.permissions.request({permissions:t});s.checked=a,i()}}[...document.getElementsByClassName("i18n")].forEach((t=>{"string"==typeof t.dataset.i18n&&(t.innerText=e.i18n.getMessage(t.dataset.i18n))}));const a=document.querySelector("form"),o=a.elements,d=document.querySelector("#last-run"),l=document.querySelector("#next-run"),r=document.querySelector("#sync-up"),c=document.querySelector("#sync-down"),u=document.querySelector("#export"),h=document.querySelector("#import"),g=document.querySelector("#import-file"),m=document.querySelector("#manual-delete");function v(t){const s=new i;switch(t.deleteMode){case"idle":s.state=n.SET_IDLE,s.idleLength=t.idleLength;break;case"startup":s.state=n.SET_STARTUP;break;case"timer":s.state=n.SET_TIMER,s.timerInterval=t.timerInterval}e.runtime.sendMessage(s)}async function f(t){if(a.checkValidity()){const s={behavior:o.behavior.value,days:parseInt(o.days.value),deleteMode:o.deleteMode.value,idleLength:parseInt(o.idleLength.value),timerInterval:parseInt(o.timerInterval.value),notifications:o.notifications.checked,downloads:o.downloads.checked,lastRun:o.lastRun.value,icon:o.icon.value};if("disable"===s.behavior?(m.disabled=!0,console.log("Disabled")):(m.disabled=!1,console.log("Enabled")),void 0!==t){const a=t.target,o=new i;"idleLength"!==a.name&&"deleteMode"!==a.name||"idle"!==s.deleteMode?"deleteMode"===a.name&&"startup"===s.deleteMode?(o.state=n.SET_STARTUP,e.runtime.sendMessage(o)):"timerInterval"!==a.name&&"deleteMode"!==a.name||"timer"!==s.deleteMode?"icon"===a.name&&(o.state=n.SET_ICON,o.icon=s.icon,e.runtime.sendMessage(o)):(o.state=n.SET_TIMER,o.timerInterval=s.timerInterval,e.runtime.sendMessage(o)):(o.state=n.SET_IDLE,o.idleLength=s.idleLength,e.runtime.sendMessage(o))}console.log("Saving",s),e.storage.local.set(s)}}async function y(){const n=new t(await e.storage.local.get());if(console.log("Loading",n),o.behavior.value=n.behavior.toString(),o.days.value=n.days.toString(),o.idleLength.value=n.idleLength.toString(),o.timerInterval.value=n.timerInterval.toString(),o.deleteMode.value=n.deleteMode,o.icon.value=n.icon,await e.permissions.contains({permissions:["notifications"]})?o.notifications.checked=n.notifications:o.notifications.checked=!1,await e.permissions.contains({permissions:["downloads"]})?o.downloads.checked=n.downloads:o.downloads.checked=!1,"disable"===n.behavior)l.innerText=e.i18n.getMessage("statisticsNextRunDisable");else{const t=await e.alarms.get("DeleteHistoryAlarm");"timer"===n.deleteMode&&void 0!==t&&(l.innerText=e.i18n.getMessage("statisticsNextRunTimer",[new Date(t.scheduledTime).toLocaleString()])),"idle"===n.deleteMode&&(l.innerText=e.i18n.getMessage("statisticsNextRunIdle")),"startup"===n.deleteMode&&(l.innerText=e.i18n.getMessage("statisticsNextRunStartup"))}o.lastRun.value=n.lastRun,d.innerText=n.lastRun,"disable"===n.behavior?m.disabled=!0:m.disabled=!1,u.href="data:application/json;charset=utf-8,"+encodeURIComponent(JSON.stringify(n))}document.addEventListener("DOMContentLoaded",y),a.addEventListener("input",f),m.addEventListener("click",(function(t){t.preventDefault();const s=new i({state:n.DELETE});e.runtime.sendMessage(s)})),o.notifications.addEventListener("change",(e=>s(["notifications"],e,f))),o.downloads.addEventListener("change",(e=>s(["downloads"],e,f))),r.addEventListener("click",(async function(n){n.preventDefault();const i=new t(await e.storage.local.get());await e.storage.sync.set(i)})),c.addEventListener("click",(async function(n){n.preventDefault();const i=new t(await e.storage.sync.get());v(i),e.storage.local.set(i)})),h.addEventListener("click",(()=>g.click())),g.addEventListener("change",(function(){const n=new FileReader;n.addEventListener("load",(()=>{if("string"==typeof n.result){const i=new t(JSON.parse(n.result));v(i),e.storage.local.set(i)}})),null!==g.files&&g.files.length>0&&n.readAsText(g.files[0])})),e.storage.onChanged.addListener(y)})();
//# sourceMappingURL=popup.bundle.js.map