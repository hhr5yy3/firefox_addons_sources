import{r as s}from"./cplx-M4JPizzD.js";import{j as r,c as g}from"./cplx-DEt7CUyc.js";import{$ as b}from"./cplx-BbAh7E-i.js";import{U as T,h as k}from"./cplx-CejnDNPm.js";import{b as P}from"./cplx-BB1imbNT.js";import{d as L}from"./cplx-CzQHx1MX.js";import{q as C,u as S,D as E,i as N}from"./cplx-CWPpH3dB.js";import{b as j}from"./cplx-BqwXc_LR.js";import{D as W,d as y}from"./cplx-Cdcyb6EG.js";import{P as A}from"./cplx-AFeO3sEC.js";import"./cplx-CVsLL7Ku.js";import"./cplx-BpeHHEix.js";import"./cplx-CIDXzIHh.js";import"./cplx-CvSOQQlQ.js";import"./cplx-Bzmv935M.js";import"./cplx-Bey00KRS.js";import"./cplx-DC-QQLj-.js";import"./cplx-B814hFp-.js";import"./cplx-wwbq-DDb.js";import"./cplx-CZMWhpfy.js";import"./cplx-SsoyhRxE.js";import"./cplx-DewpVJ-0.js";import"./cplx-B42KOvrD.js";import"./cplx-km2FGkQ4.js";import"./cplx-Mn-h5XDX.js";import"./cplx-Cqfmi6PF.js";import"./cplx-DSnlyBAv.js";import"./cplx-CXGk_GMP.js";import"./cplx-CCS6eJc0.js";import"./cplx-B19A3gYQ.js";import"./cplx-CCGYIZQf.js";import"./cplx-DD6dUv5H.js";import"./cplx-Dy60Fcq0.js";import"./cplx-CgmVhoKz.js";import"./cplx-hUtawQMb.js";import"./cplx-BsCYqTWz.js";import"./cplx-2ekRUlSR.js";import"./cplx-D37zsf-y.js";const v="thread-navigation-toc-panel-position";function I(){var d;const a=(d=A.getCachedSync().pluginsEnableStates)==null?void 0:d["thread:canvas"],t=C(e=>e.selectedCodeBlockLocation!=null),i=C(e=>e.isCanvasListOpen),{isMobile:c}=j(),p=P(),[u,o]=s.useState(null),n=S(e=>e.threadComponents.wrapper),l=s.useCallback(()=>{if(n==null)return null;const e=b(n).children().first(),m=e.width(),h=e.offset();if(m==null||h==null)return null;const{top:w,left:f}=h,R=f+m+O+75>window.innerWidth;return{position:{top:w+25,left:m+f+25},isFloating:R||!!a&&(t||i)}},[n,t,a,i]);return s.useEffect(()=>{const e=L(()=>{o(l())},100);return e(),E.create(v,{target:b(W.SIDEBAR.WRAPPER)[0],config:{attributes:!0,attributeFilter:["class"]},onMutation:()=>N.getInstance().enqueue(e,v)}),()=>{e.cancel(),E.destroy(v)}},[l,c,p,t]),u}function D({isOpen:a,onClick:t}){const{position:i}=I()??{};if(i==null)return null;const{top:c}=i;return r.jsx("div",{role:"button",className:g("tw-fixed -tw-right-3 tw-top-[--panel-top] tw-flex tw-h-16 tw-w-8 tw-items-center tw-justify-center tw-rounded-md tw-border tw-border-border/50 tw-bg-secondary tw-text-muted-foreground tw-shadow-lg tw-transition-colors tw-animate-in tw-fade-in hover:tw-text-foreground",{"tw-hidden":a}),style:{"--panel-top":`${c}px`},onClick:t,children:r.jsx(T,{className:"tw-size-4"})})}function M(){const[a,t]=s.useState([]),i=s.useRef(null),c=s.useRef(null),p=S(u=>u.threadComponents.messageBlocks);return s.useEffect(()=>{if(!p)return;const u=new IntersectionObserver(o=>{o.forEach(n=>{n.isIntersecting&&(c.current=n.target.id,t(l=>l.map(d=>({...d,isActive:d.id===n.target.id}))))})},{threshold:0,rootMargin:"-49% 0px -49% 0px"});return i.current=u,t(o=>p.map(({$wrapper:n,title:l},d)=>{var m;const e=`toc-item-${d}`;return n.attr("id",e),u.observe(n[0]),{id:e,title:l.length>0?l:((m=o[d])==null?void 0:m.title)??"",element:n,isActive:e===c.current}})),()=>{u.disconnect()}},[p]),a}const O=250;function It(){const{isMobile:a}=j(),[t,i]=s.useState(!1),c=s.useRef(null),p=M(),{position:u,isFloating:o}=I()??{},{top:n,left:l}=u??{},d=s.useCallback(()=>i(!0),[]),e=s.useCallback(()=>i(!1),[]),m=s.useMemo(()=>({"--panel-width":`${O}px`,"--panel-top":n!=null?`${n}px`:void 0,"--panel-left":!o&&l!=null?`${l}px`:void 0}),[n,l,o]),h=p.length>1&&!!u;return s.useEffect(()=>{if(!a)return;function w(f){c.current&&!c.current.contains(f.target)&&t&&i(!1)}return document.addEventListener("mousedown",w),()=>{document.removeEventListener("mousedown",w)}},[a,t]),h?r.jsxs(r.Fragment,{children:[o&&r.jsx(D,{isOpen:t,onClick:d}),r.jsxs("div",{ref:c,className:g("tw-custom-scrollbar tw-fixed tw-top-[--panel-top]","tw-w-[--panel-width] tw-overflow-y-auto",{"tw-max-h-[60vh]":o,"tw-max-h-[80vh]":!o},"tw-transition-all tw-animate-in tw-fade-in",{"tw-left-[--panel-left]":!o,"tw-right-3 tw-rounded-md tw-border tw-border-border/50 tw-bg-secondary tw-p-4 tw-shadow-lg md:tw-right-8":o,"tw-hidden":o&&!t}),style:m,children:[o&&r.jsx(B,{onClick:e}),r.jsx("div",{className:"tw-flex tw-flex-col tw-gap-2",children:p.map((w,f)=>r.jsx($,{item:w,onClick:()=>{const x=b(`#${w.id}`);x.length&&y(x,0,300)}},f))})]})]}):null}const $=s.memo(function({item:t,onClick:i}){return r.jsxs("div",{className:"tw-flex tw-cursor-pointer tw-items-center tw-gap-3",onClick:i,children:[r.jsx("div",{className:g("tw-h-5",{"tw-min-w-[3px] tw-bg-primary":t.isActive,"tw-min-w-[2px] tw-bg-muted-foreground":!t.isActive})}),r.jsx("div",{className:g("tw-block tw-truncate tw-transition-colors",{"tw-font-medium tw-text-primary":t.isActive,"tw-text-muted-foreground hover:tw-text-foreground":!t.isActive}),children:t.title})]})});function B({onClick:a}){return r.jsx("div",{className:"tw-absolute tw-right-2 tw-top-2 tw-cursor-pointer tw-rounded-full tw-p-1 tw-text-muted-foreground tw-transition-colors hover:tw-text-foreground",onClick:a,children:r.jsx(k,{className:"tw-size-4"})})}export{O as PANEL_WIDTH,It as default};
