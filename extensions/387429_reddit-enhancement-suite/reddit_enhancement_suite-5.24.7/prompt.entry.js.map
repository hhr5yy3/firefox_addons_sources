{
  "version": 3,
  "sources": ["../../lib/environment/utils/api.js", "../../lib/environment/utils/messaging.js", "../../lib/environment/background/messaging.js", "../../lib/environment/background/permissions.js", "../../lib/environment/background/permissions/prompt.entry.js"],
  "sourcesContent": ["/*  */\n\nexport function apiToPromise(func) {\n\treturn (...args) =>\n\t\tnew Promise((resolve, reject) => {\n\t\t\tfunc(...args, (...results) => {\n\t\t\t\tif (chrome.runtime.lastError) {\n\t\t\t\t\treject(new Error(chrome.runtime.lastError.message));\n\t\t\t\t} else {\n\t\t\t\t\tresolve(results.length > 1 ? results : results[0]);\n\t\t\t\t}\n\t\t\t});\n\t\t});\n}\n", "/*  */\n\n\n\n\n\n\n\n\nclass MessageHandlerError extends Error {\n\tconstructor(message, stack) {\n\t\tsuper();\n\t\tthis.message = message;\n\t\tthis.stack = stack;\n\t}\n}\n\nexport function createMessageHandler(_sendMessage, errorOnUnrecognizedTypes = false) {\n\tconst listeners = new Map();\n\n\tfunction addListener(type, callback) {\n\t\tif (listeners.has(type)) {\n\t\t\tthrow new Error(`Listener for \"${type}\" already exists.`);\n\t\t}\n\t\tlisteners.set(type, callback);\n\t}\n\n\tasync function sendMessage(type, data, context) {\n\t\tconst { data: newData, error } = await _sendMessage({ type, data }, context);\n\t\tif (error) {\n\t\t\tthrow new MessageHandlerError(error.message, `${error.stack}\\n    at target's \"${type}\" handler`);\n\t\t} else {\n\t\t\treturn newData;\n\t\t}\n\t}\n\n\tfunction _handleMessage({ type, data }, sendResponse, context) {\n\t\tconst listener = listeners.get(type);\n\t\tif (!listener) {\n\t\t\tif (errorOnUnrecognizedTypes) {\n\t\t\t\tsendResponse({ error: { message: `Unrecognised message type: ${type}`, stack: '' } });\n\t\t\t}\n\t\t\treturn false;\n\t\t}\n\n\t\tlet response;\n\n\t\ttry {\n\t\t\tresponse = listener(data, context);\n\t\t} catch (e) {\n\t\t\tconsole.error(e);\n\t\t\tsendResponse({ error: { message: e.message, stack: e.stack } });\n\t\t\treturn false;\n\t\t}\n\n\t\tif (response instanceof Promise) {\n\t\t\tresponse\n\t\t\t\t.then(\n\t\t\t\t\tdata => sendResponse({ data }),\n\t\t\t\t\te => {\n\t\t\t\t\t\tconsole.error(e);\n\t\t\t\t\t\tsendResponse({ error: { message: e.message, stack: e.stack } });\n\t\t\t\t\t},\n\t\t\t\t);\n\t\t\t// true = response will be handled asynchronously (needed for Chrome)\n\t\t\treturn true;\n\t\t} else {\n\t\t\tsendResponse({ data: response });\n\t\t\treturn false;\n\t\t}\n\t}\n\n\treturn {\n\t\t_handleMessage,\n\t\tsendMessage,\n\t\taddListener,\n\t};\n}\n", "/*  */\n\nimport { createMessageHandler } from '../utils/messaging';\nimport { apiToPromise } from '../utils/api';\n\nconst _sendMessage = apiToPromise(chrome.tabs.sendMessage);\n\nconst {\n\t_handleMessage,\n\tsendMessage,\n\taddListener,\n} = createMessageHandler((obj, tabId) => _sendMessage(tabId, obj));\n\nchrome.runtime.onMessage.addListener((obj, sender, sendResponse) => _handleMessage(obj, sendResponse, sender));\n\nexport {\n\tsendMessage,\n\taddListener,\n};\n", "/*  */\n\nimport { apiToPromise } from '../utils/api';\nimport { addListener } from './messaging';\n\naddListener('permissions', handleMessage);\n\nexport function handleMessage({ operation, permissions, origins }) {\n\tswitch (operation) {\n\t\tcase 'contains':\n\t\t\treturn apiToPromise(chrome.permissions.contains)({ permissions, origins });\n\t\tcase 'request':\n\t\t\treturn apiToPromise(chrome.permissions.request)({ permissions, origins })\n\t\t\t\t.catch(() => makePromptWindow({ permissions, origins }));\n\t\tdefault:\n\t\t\tthrow new Error(`Invalid permissions operation: ${operation}`);\n\t}\n}\n\nasync function makePromptWindow({ permissions, origins }) {\n\tconst url = new URL('prompt.html', location.origin);\n\turl.searchParams.set('permissions', JSON.stringify(permissions));\n\turl.searchParams.set('origins', JSON.stringify(origins));\n\n\tconst width = 630;\n\tconst height = 255;\n\n\t// Get the current window's dimensions and calculate center position\n\tconst { width: screenWidth, height: screenHeight } = await chrome.windows.getCurrent() || { width: 1920, height: 1080 };\n\tconst left = Math.floor(screenWidth / 2 - width / 2);\n\tconst top = Math.floor(screenHeight / 2 - height / 2);\n\n\tconst { tabs: [{ id }] } = await apiToPromise(chrome.windows.create)({ url: url.href, type: 'popup', width, height, left, top });\n\n\treturn new Promise(resolve => {\n\t\tfunction updateListener(tabId, updates) {\n\t\t\tif (tabId !== id) return;\n\n\t\t\tconst url = updates.url && new URL(updates.url);\n\t\t\tif (url && url.searchParams.has('result')) {\n\t\t\t\tstopListening();\n\t\t\t\tconst result = url.searchParams.get('result');\n\t\t\t\tif (!result) return;\n\t\t\t\tresolve(JSON.parse(result));\n\t\t\t\tapiToPromise(chrome.tabs.remove)(id);\n\t\t\t}\n\t\t}\n\n\t\tfunction removeListener(tabId) {\n\t\t\tif (tabId !== id) return;\n\t\t\tstopListening();\n\t\t\tresolve(false);\n\t\t}\n\n\t\tfunction stopListening() {\n\t\t\tchrome.tabs.onUpdated.removeListener(updateListener);\n\t\t\tchrome.tabs.onRemoved.removeListener(removeListener);\n\t\t}\n\n\t\tchrome.tabs.onUpdated.addListener(updateListener);\n\t\tchrome.tabs.onRemoved.addListener(removeListener);\n\t});\n}\n", "/*  */\n\nimport { handleMessage } from '../permissions';\n\nconst url = new URL(location.href);\n\nconst button = document.body.querySelector('#request');\nbutton.addEventListener('click', async () => {\n\ttry {\n\t\tconst result = await handleMessage({\n\t\t\toperation: 'request',\n\t\t\tpermissions: JSON.parse(url.searchParams.get('permissions') || '[]'),\n\t\t\torigins: JSON.parse(url.searchParams.get('origins') || '[]'),\n\t\t});\n\t\turl.searchParams.set('result', JSON.stringify(result));\n\t\tlocation.href = url.href;\n\t} catch (e) {\n\t\talert(`An error occured: ${e.message}`); // eslint-disable-line no-restricted-globals\n\t}\n});\n\n// Focus, so pressing space / enter can be used as an alternative to clicking the button\nbutton.focus();\n"],
  "mappings": "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",
  "names": ["_sendMessage", "addListener", "sendMessage", "_handleMessage", "data", "url"]
}
