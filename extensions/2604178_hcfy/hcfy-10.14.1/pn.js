(()=>{"use strict";var e,t,n,r={30819:(e,t,n)=>{n.d(t,{U0:()=>i,gm:()=>s});n(62234);var r=n(51127),a=n.n(r);const o=window.navigator.userAgent,i=o.includes("Mac"),s=(o.includes("Chrome"),o.includes("Edg"),o.includes("Firefox"));function d(e){return e.split(".").map((e=>Number(e)))}d(a().runtime.getManifest().version)},62503:(e,t,n)=>{n(62234);window.navigator.userAgent.includes("Firefox")&&(window.requestAnimationFrame=window.requestAnimationFrame.bind(window),window.cancelAnimationFrame=window.cancelAnimationFrame.bind(window))},48585:(e,t,n)=>{n(97107),n(33873),n(98376),n(47010),n(1363);var r=n(51127),a=n.n(r),o=n(14041),i=n(25873),s=n(93431),d=n(19687),l=n(78220),u=n(78107),c=n(43566),f=n(96538),p=n(74874),m=n.n(p),v=n(16224),h=n(25148),g=n(17439);n(10865),n(62234);var w=n(66538),b=n(21756),y=n(31085);function x(e){return e.target.matches("."+l.Qu)}function E(e){return new Promise(((t,n)=>{const r=new FileReader;r.addEventListener("load",(()=>{t(r.result)})),r.addEventListener("error",(()=>{n(r.error)})),r.readAsDataURL(e)}))}function j(e){const{toaster:t,onDrop:n}=e,r=function(e,t,n){const[r,a]=(0,o.useState)(!1),i=(0,o.useRef)(t);(0,o.useEffect)((()=>{i.current=t}),[t]);const s=(0,o.useRef)(n);return(0,o.useEffect)((()=>{s.current=n}),[n]),(0,o.useEffect)((()=>{if(!e)return;const t=function(e){e.preventDefault(),a(!0)};return e.addEventListener("dragenter",t),()=>{e.removeEventListener("dragenter",t)}}),[e]),(0,o.useEffect)((()=>{if(!e)return;const t=function(e){e.preventDefault(),e.dataTransfer&&(e.dataTransfer.dropEffect="copy")};return e.addEventListener("dragover",t),()=>{e.removeEventListener("dragover",t)}}),[e]),(0,o.useEffect)((()=>{if(!e)return;const t=e=>{s.current?s.current(e)&&a(!1):a(!1)};return e.addEventListener("dragleave",t),()=>{e.removeEventListener("dragleave",t)}}),[e]),(0,o.useEffect)((()=>{if(!e)return;const t=function(e){const t=e.dataTransfer;if(!t)return;e.preventDefault(),a(!1);const n=i.current,r=t.types;if(r.includes("Files")){const e=t.files[0];e.type.startsWith("image/")?n({type:"image",data:e}):n(new TypeError("此文件不是图片。"))}else{if(r.includes("text/html")){const e=t.getData("text/html").match(/<img.*?src="([^"]+)"/);if(e){const t=e[1];return void(t.startsWith("data:image/")?n({type:"image-data-uri",data:t}):n({type:"image-url",data:t}))}}if(r.includes("text/plain")){const e=t.getData("text");if(e)return void n({type:"text",data:e})}n(new TypeError("只支持拖放文字或图片。"))}};return e.addEventListener("drop",t),()=>{e.removeEventListener("drop",t)}}),[e]),r}(document.body,(e=>{if(e instanceof TypeError)null==t||t.show({intent:"warning",message:e.message});else switch(e.type){case"text":n({type:"text",text:e.data});break;case"image":E(e.data).then((e=>{n({type:"image",dataURI:e})}));break;case"image-data-uri":n({type:"image",dataURI:e.data});break;case"image-url":const r=null==t?void 0:t.show({message:"正在加载图片……"});b.A.get(e.data,{responseType:"blob"}).then((e=>(r&&(null==t||t.dismiss(r)),E(e.data)))).then((e=>{n({type:"image",dataURI:e})})).catch((e=>{r&&(null==t||t.dismiss(r)),null==t||t.show({intent:"danger",message:`发生了一个错误：${(null==e?void 0:e.message)||"未知错误"}`})}))}}),x);return(0,y.jsx)(w.h,{isOpen:r})}var T=n(22067);const k=m()(v.Ne,["tipForDropTranslateClosed"]);function C(){const[e,t]=(0,h.A)(k);return!e||e.tipForDropTranslateClosed?null:(0,y.jsxs)(T.P,{intent:"primary",style:{marginBottom:10},children:["你可以将文本或图片拖放到独立翻译窗口当中。",(0,y.jsx)("a",{onClick:()=>{t({tipForDropTranslateClosed:!0})},children:"不再提示"})]})}var O=n(84848),L=n(12128),A=n(91307);function F(){const[e,t]=(0,o.useState)(!1);return(0,o.useEffect)((()=>{window.addEventListener("beforeunload",(()=>{chrome.runtime.sendMessage({action:"set clipboard monitor",data:!1})}))}),[]),(0,y.jsx)(u.Sc,{style:{marginBottom:0},label:"持续监听剪切板",checked:e,onChange:e=>{const n=e.target.checked;chrome.runtime.sendMessage({action:"set clipboard monitor",data:n}),t(n)}})}s.$.onlyShowFocusOnTabs();const S=m()(v.g2,["panelSize","autoClipboard"]),D=(0,O.j_)(),M=new L.y("panelTranslateLimit",500);function P(e){const[t,n]=(0,o.useState)(null),[r,a]=(0,o.useState)("");if((0,o.useEffect)((()=>{M.isOver().then((e=>{n(e),a(M.dateEnd)}))}),[]),null==t)return null;if(t)return(0,y.jsxs)("div",{style:{textAlign:"center",padding:15},children:[(0,y.jsxs)("p",{children:["非会员用户每七天只能使用 ",500," ","次独立翻译窗口，下次重置时间：",r,"。成为会员即可解除此次数限制。"]}),(0,y.jsx)("p",{children:(0,y.jsx)(d.$,{onClick:A.$,intent:"primary",text:"开通会员"})}),(0,y.jsx)("p",{className:`${l.E4k} ${l.KJG}`,children:"开通会员或到达重置时间后，点击下方按钮即可恢复使用。"}),(0,y.jsx)("div",{children:(0,y.jsx)(d.$,{onClick:()=>{M.isOver().then((e=>{n(e),a(M.dateEnd)}))},children:"确认开通 / 重置状态"})})]});return e.children((()=>{M.isOver(!0).then((e=>{n(e),a(M.dateEnd)}))}))}function R(e){const t=(0,o.useRef)(null),[n,r]=(0,h.A)(S),[i,s]=(0,o.useState)(!1);function d(e){t.current&&(e?t.current.translate({type:"text",text:e},!0):(s(!1),setTimeout((()=>{s(!0)}))))}(0,f.A)(),(0,o.useEffect)((()=>{d(decodeURIComponent(window.location.search.slice(6)))}),[]),(0,o.useEffect)((()=>{var e;null===(e=t.current)||void 0===e||e.select()}),[]),(0,o.useEffect)((()=>{const e=e=>{if("translateInPopup"===e.action)d(e.data)};return a().runtime.onMessage.addListener(e),()=>{a().runtime.onMessage.removeListener(e)}}),[]);const l=(0,o.useCallback)(((e,n)=>{var r,a;e&&(n?null===(r=t.current)||void 0===r||r.setText(e):null===(a=t.current)||void 0===a||a.translate(e,!0))}),[]),p=(0,O.dU)(D);return(0,y.jsxs)(y.Fragment,{children:[(0,y.jsx)(j,{onDrop:e=>{var n;null===(n=t.current)||void 0===n||n.translate(e)},toaster:p.current}),(0,y.jsx)(C,{}),i&&(0,y.jsx)(g.W,{onTranslate:l,onDismiss:()=>{var e;return null===(e=t.current)||void 0===e?void 0:e.select()}}),(0,y.jsx)(c.A,{ref:t,toaster:p.current,showTextArea:!0,size:(null==n?void 0:n.panelSize)||S.panelSize,extendOptions:(0,y.jsxs)(y.Fragment,{children:[(0,y.jsx)(u.Sc,{label:"打开面板时自动翻译剪切板内的文本",checked:!0===(null==n?void 0:n.autoClipboard),indeterminate:"write-only"===(null==n?void 0:n.autoClipboard),onChange:e=>{r({autoClipboard:e.target.checked})}}),(0,y.jsx)(F,{})]}),onTranslate:e.onTranslate})]})}window.addEventListener("DOMContentLoaded",(()=>{const e=document.getElementById("app");if(!e)throw new Error("DOM 里没有 #app 元素。");(0,i.H)(e).render((0,y.jsx)(P,{children:e=>(0,y.jsx)(R,{onTranslate:e})}))})),window.addEventListener("beforeunload",(()=>{a().storage.local.set({panelPos:{top:window.screenY,left:window.screenX,width:window.outerWidth,height:window.outerHeight}})})),window.addEventListener("keydown",(e=>{if(27===e.keyCode){if("TEXTAREA"==e.target.nodeName&&e.isComposing)return;window.close()}}))}},a={};function o(e){var t=a[e];if(void 0!==t)return t.exports;var n=a[e]={id:e,loaded:!1,exports:{}};return r[e].call(n.exports,n,n.exports,o),n.loaded=!0,n.exports}o.m=r,e=[],o.O=(t,n,r,a)=>{if(!n){var i=1/0;for(u=0;u<e.length;u++){for(var[n,r,a]=e[u],s=!0,d=0;d<n.length;d++)(!1&a||i>=a)&&Object.keys(o.O).every((e=>o.O[e](n[d])))?n.splice(d--,1):(s=!1,a<i&&(i=a));if(s){e.splice(u--,1);var l=r();void 0!==l&&(t=l)}}return t}a=a||0;for(var u=e.length;u>0&&e[u-1][2]>a;u--)e[u]=e[u-1];e[u]=[n,r,a]},o.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return o.d(t,{a:t}),t},o.d=(e,t)=>{for(var n in t)o.o(t,n)&&!o.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:t[n]})},o.f={},o.e=e=>Promise.all(Object.keys(o.f).reduce(((t,n)=>(o.f[n](e,t),t)),[])),o.u=e=>({231:"blueprint-icons-split-paths-by-size-loader",824:"blueprint-icons-all-paths-loader",860:"blueprint-icons-all-paths"}[e]+".js"),o.miniCssF=e=>{},o.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==typeof window)return window}}(),o.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),t={},n="browser-extension:",o.l=(e,r,a,i)=>{if(t[e])t[e].push(r);else{var s,d;if(void 0!==a)for(var l=document.getElementsByTagName("script"),u=0;u<l.length;u++){var c=l[u];if(c.getAttribute("src")==e||c.getAttribute("data-webpack")==n+a){s=c;break}}s||(d=!0,(s=document.createElement("script")).charset="utf-8",s.timeout=120,o.nc&&s.setAttribute("nonce",o.nc),s.setAttribute("data-webpack",n+a),s.src=e),t[e]=[r];var f=(n,r)=>{s.onerror=s.onload=null,clearTimeout(p);var a=t[e];if(delete t[e],s.parentNode&&s.parentNode.removeChild(s),a&&a.forEach((e=>e(r))),n)return n(r)},p=setTimeout(f.bind(null,void 0,{type:"timeout",target:s}),12e4);s.onerror=f.bind(null,s.onerror),s.onload=f.bind(null,s.onload),d&&document.head.appendChild(s)}},o.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},o.nmd=e=>(e.paths=[],e.children||(e.children=[]),e),o.p="",(()=>{var e={553:0};o.f.j=(t,n)=>{var r=o.o(e,t)?e[t]:void 0;if(0!==r)if(r)n.push(r[2]);else{var a=new Promise(((n,a)=>r=e[t]=[n,a]));n.push(r[2]=a);var i=o.p+o.u(t),s=new Error;o.l(i,(n=>{if(o.o(e,t)&&(0!==(r=e[t])&&(e[t]=void 0),r)){var a=n&&("load"===n.type?"missing":n.type),i=n&&n.target&&n.target.src;s.message="Loading chunk "+t+" failed.\n("+a+": "+i+")",s.name="ChunkLoadError",s.type=a,s.request=i,r[1](s)}}),"chunk-"+t,t)}},o.O.j=t=>0===e[t];var t=(t,n)=>{var r,a,[i,s,d]=n,l=0;if(i.some((t=>0!==e[t]))){for(r in s)o.o(s,r)&&(o.m[r]=s[r]);if(d)var u=d(o)}for(t&&t(n);l<i.length;l++)a=i[l],o.o(e,a)&&e[a]&&e[a][0](),e[a]=0;return o.O(u)},n=self.webpackChunkbrowser_extension=self.webpackChunkbrowser_extension||[];n.forEach(t.bind(null,0)),n.push=t.bind(null,n.push.bind(n))})(),o.O(void 0,[375,492,167,159,984,756,643,189,821,701,382],(()=>o(62503)));var i=o.O(void 0,[375,492,167,159,984,756,643,189,821,701,382],(()=>o(48585)));i=o.O(i)})();