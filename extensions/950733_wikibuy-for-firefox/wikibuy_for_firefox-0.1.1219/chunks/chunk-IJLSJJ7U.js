import{a as I}from"./chunk-HGJD3ZUF.js";import{a as x}from"./chunk-BODFWMPN.js";import{a as C}from"./chunk-O4TFJKJQ.js";import{r as f,x as D}from"./chunk-WRHUMLYF.js";import{q as A}from"./chunk-OEPSEZ5A.js";import{e as p}from"./chunk-3GYLW4KZ.js";var _=p(x()),T=p(C()),w=p(A()),u=p(I());var g=({domain:n,sku:s,title:a})=>D("getWirelessDeviceId",{domain:n,sku:s,title:a});var m;async function F(n){let s=w.default.cloneDeep(n||{}),a=s.domain||"",y=s.pageType||"",c=!!s.pageData?.tag?.some(e=>e.indexOf("wireless_device")===0);if(y==="productPage"&&c){let e=s.pageData.products?.find(i=>i.pid&&i.title)||{},{sku:r,title:o}=e,t=await g({domain:a,sku:r,title:o});typeof t=="string"&&(e.wireless_device_id=t,s.pageData.wireless=Object.assign({},s.pageData.wireless||{},{deviceId:t}),s.pageData.tag.push(`device_id_${t.replaceAll("-","_")}`))}return s}function P(){window.__wb_timing.deweyUtilRequireAt=performance.now();let n,s;function a(){if(n)return n;s="async";let e=new u.Dewey;e._isasync=!0,e.setDocument(document),e.setParser(T.default),n=e;let r=!1;return n.startAttempt=0,n.deweyMode=s,n.pageTypeComplete=(o,t)=>{r||(r=!0,window.__wb_timing.deweyPageTypeFoundAt=performance.now())},n.emitter.on("result",o=>{let t=w.default.get(o,"pageType");t&&n.pageTypeComplete(t,"emitter")}),n}let y=!1,c={get deweyMode(){return a().deweyMode},get startAttempt(){return a().startAttempt},setDefaultConfig:e=>{a().setDefaultConfig(e)},get emitter(){return a().emitter},evaluateIdentifierTree:async(e,r)=>{let o=a();if(o._isasync){let t=r,i=r.deweyParser;return await u.evaluateIdentifierTree({identifiers:e,parser:i,evalDocument:t,matchTypes:{url:0,title:0,selectors:[]}})}return o.evaluateIdentifierTree(e,r)},run:async(e,r)=>{let o=a(),t={...e,ensureUrlTriggerIsPresent:f("ext_dewey_ensure_url_trigger")};return await o.run(t,r)},start:()=>{if(y)return;y=!0;let e=performance.now();window.__wb_timing.deweyStartAt=e;let r=a();r.extractVarsSplit=!0;let o=(0,_.exponential)({randomisationFactor:0,initialDelay:50,maxDelay:3e3});async function t(){r.startAttempt++;let i=await c.run(),l=w.default.get(i,"pageType"),d=performance.now()-e;!l&&d<5e3?o.backoff():a().pageTypeComplete(l,"startup")}o.on("ready",t),t()}};return c}window.Dewey||(window.Dewey=P()),m=window.Dewey;var R=m;export{F as a,R as b};
