const installation_div=document.createElement("div");installation_div.classList.add("alihelper-installed"),installation_div.setAttribute("type","dynamic"),document.body.appendChild(installation_div);const event_type_list=["FROM_PAGE_ADD_FAVORITE","FROM_PAGE_REMOVE_FAVORITE","FROM_PAGE_ADD_TRACKING","FROM_PAGE_REMOVE_TRACKING","FROM_PAGE_GET_TOKEN","FROM_PAGE_SET_VERIFICATION_EMAIL","FROM_PAGE_GET_GUEST_ID","FROM_PAGE_CALL_GET_CONFIG","FROM_PAGE_RUN_NOTIFICATION_CHECK"];let port=chrome.runtime.connect({name:"settings"});if(port.postMessage({type:"getSubscribe"}),port.onMessage.addListener((function(e){if(e.status){let e=document.createElement("a");e.setAttribute("class","b-button btn-part-sub"),e.textContent="Вы участвуете",$("p.participate").append(e)}else $(".b-button.btn-participate").click((function(e){var t=$(e.currentTarget).attr("data");port.postMessage({type:"setSubscribe",utm_medium:t}),port.onMessage.addListener((function(e){let t=document.createElement("a");t.setAttribute("class","b-button btn-part-sub"),t.textContent="Вы участвуете",$("p.participate").append(t)}))}))})),document.querySelector(".form.form-reg-i")&&chrome.storage.local.get((({guest_id:e})=>{let t=document.querySelector(".form.form-reg-i"),n=document.createElement("input");n.type="hidden",n.value=!!e&&e||"none",n.name="guest_id",t.appendChild(n)})),document.querySelector(".form.form-review-i")&&chrome.storage.local.get((({guest_id:e})=>{let t=document.querySelector(".form.form-review-i"),n=document.createElement("input");n.type="hidden",n.value=!!e&&e||"none",n.name="guest_id",t.appendChild(n)})),document.querySelector(".form-add-track")){let e=document.querySelector(".form-add-track"),t=document.createElement("div");t.className="detect-form",e.style.display="block",e.append(t)}if(document.querySelector(".form-add-track")&&document.querySelector(".detect-form")){document.querySelector(".form-add-track input").addEventListener("keydown",(function(e){if(13===e.which||13===e.keyCode||"Enter"===e.key){let t=e.target.value;t&&(t=t.substring(0,35)),port=chrome.runtime.connect({name:"settings"}),port&&port.postMessage({type:"addTrackingFromPage",track:t.trim()}),port&&port.onMessage.addListener((e=>{window.postMessage({type:"FROM_PAGE",value:e},"*")}))}})),$("body").on("click",".form-add-track button",(function(e){e.preventDefault();let t=document.querySelector(".form-add-track input").value;t&&(t=t.substring(0,35)),port=chrome.runtime.connect({name:"settings"}),port&&port.postMessage({type:"addTrackingFromPage",track:t.trim()}),port&&port.onMessage.addListener((e=>{window.postMessage({type:"FROM_PAGE",value:e},"*")}))}))}$("body").on("click",".go-to-ali",(function(e){e.preventDefault(),port.postMessage({type:"openTutorial"})})),$("body").on("click",".tracking-delete",(function(e){var t=$(e.currentTarget).attr("data");port=chrome.runtime.connect({name:"settings"}),port.postMessage({type:"delTracking",track:t})})),$("body").on("click",".tracking-add",(function(e){var t=$(e.currentTarget).attr("data"),n=$(e.currentTarget).attr("data-id");let a=document.createElement("div"),o=document.createElement("div");a.className="talign-center",o.className="spinner icon-spinner",a.appendChild(o),$(`.${n}.row.remove`).append(a),port=chrome.runtime.connect({name:"settings"}),port&&port.postMessage({type:"addTrackingFromPage",track:t}),port&&port.onMessage.addListener((e=>{window.postMessage({type:"FROM_PAGE",value:e},"*")}))})),chrome.runtime.onMessage.addListener((e=>{window.postMessage(e,"*")}));const sendMessageToBackground=e=>{const t=chrome.runtime?.id?chrome.runtime.connect(chrome.runtime.id,{name:"settings"}):chrome.runtime.connect({name:"settings"});t&&t.postMessage({...e})};window.addEventListener("message",(e=>{e.data&&e.data.type&&(event_type_list.includes(e.data.type)?sendMessageToBackground(e.data.payload):"findAndUpdateTracking"===e.data.type&&(port=chrome.runtime.connect({name:"settings"}),port&&port.postMessage({type:"findAndUpdateTracking",track:e.data.track,track_name:e.data.track_name}),port&&port.onMessage.addListener((e=>{window.postMessage({type:"FROM_PAGE",value:e},"*")}))))}),!1),"alihelper.net"===window.location.host&&-1!==window.location.pathname.search(/unsubscribe/)&&"complete"===$(".change_status").val()?(port=chrome.runtime.connect({name:"settings"}),port.postMessage({settings:"getSettings"}),port.onMessage.addListener((function(e){e.settings&&e.settings.ut&&(e.settings.en=!1,e.settings.epd=!1,e.settings.epp=!1,port.postMessage({type:"setSettings",settings:e.settings}))}))):"alihelper.net"===window.location.host&&-1!==window.location.pathname.search(/subscribe/)&&"complete"===$(".change_status").val()&&(port=chrome.runtime.connect({name:"settings"}),port.postMessage({settings:"getSettings"}),port.onMessage.addListener((function(e){e.settings&&e.settings.ut&&(e.settings.en=!0,e.settings.epd=!0,e.settings.epp=!0,port.postMessage({type:"setSettings",settings:e.settings}))})));const language=localStorage.getItem("cacheLanguage"),queryParams=localStorage.getItem("cacheQueryParams");sendMessageToBackground({type:"ALTERNATIVE_SOURCE",language,queryParams});