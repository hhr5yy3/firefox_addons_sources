(() => {
var m=(n,t)=>()=>(t||n((t={exports:{}}).exports,t),t.exports);var y=m(c=>{"use strict";var p=c&&c.__awaiter||function(n,t,e,s){return new(e||(e=Promise))(function(u,i){function o(a){try{r(s.next(a))}catch(h){i(h)}}function v(a){try{r(s.throw(a))}catch(h){i(h)}}function r(a){a.done?u(a.value):new e(function(h){h(a.value)}).then(o,v)}r((s=s.apply(n,t||[])).next())})},_=c&&c.__generator||function(n,t){var e={label:0,sent:function(){if(i[0]&1)throw i[1];return i[1]},trys:[],ops:[]},s,u,i;return{next:o(0),throw:o(1),return:o(2)};function o(r){return function(a){return v([r,a])}}function v(r){if(s)throw new TypeError("Generator is already executing.");for(;e;)try{if(s=1,u&&(i=u[r[0]&2?"return":r[0]?"throw":"next"])&&!(i=i.call(u,r[1])).done)return i;switch(u=0,i&&(r=[0,i.value]),r[0]){case 0:case 1:i=r;break;case 4:return e.label++,{value:r[1],done:!1};case 5:e.label++,u=r[1],r=[0];continue;case 7:r=e.ops.pop(),e.trys.pop();continue;default:if(i=e.trys,!(i=i.length>0&&i[i.length-1])&&(r[0]===6||r[0]===2)){e=0;continue}if(r[0]===3&&(!i||r[1]>i[0]&&r[1]<i[3])){e.label=r[1];break}if(r[0]===6&&e.label<i[1]){e.label=i[1],i=r;break}if(i&&e.label<i[2]){e.label=i[2],e.ops.push(r);break}i[2]&&e.ops.pop(),e.trys.pop();continue}r=t.call(n,e)}catch(a){r=[6,a],u=0}finally{s=i=0}if(r[0]&5)throw r[1];return{value:r[0]?r[1]:void 0,done:!0}}};c.__esModule=!0;var b=function(){function n(t){this.promiseResolverQueue=[],this.permits=t}return n.prototype.getPermits=function(){return this.permits},n.prototype.wait=function(){return p(this,void 0,void 0,function(){var t=this;return _(this,function(e){return this.permits>0?(this.permits-=1,[2,Promise.resolve(!0)]):[2,new Promise(function(s){return t.promiseResolverQueue.push(s)})]})})},n.prototype.acquire=function(){return p(this,void 0,void 0,function(){return _(this,function(t){return[2,this.wait()]})})},n.prototype.waitFor=function(t){return p(this,void 0,void 0,function(){var e=this,s,u;return _(this,function(i){return this.permits>0?(this.permits-=1,[2,Promise.resolve(!0)]):(s=function(o){},u=new Promise(function(o){s=o}),this.promiseResolverQueue.push(s),setTimeout(function(){var o=e.promiseResolverQueue.indexOf(s);o!==-1&&e.promiseResolverQueue.splice(o,1),s(!1)},t),[2,u])})})},n.prototype.tryAcquire=function(){return this.permits>0?(this.permits-=1,!0):!1},n.prototype.drainPermits=function(){if(this.permits>0){var t=this.permits;return this.permits=0,t}return 0},n.prototype.signal=function(){if(this.permits+=1,this.permits>1&&this.promiseResolverQueue.length>0)throw new Error("this.permits should never be > 0 when there is someone waiting.");if(this.permits===1&&this.promiseResolverQueue.length>0){this.permits-=1;var t=this.promiseResolverQueue.shift();t&&t(!0)}},n.prototype.release=function(){this.signal()},n.prototype.execute=function(t){return p(this,void 0,void 0,function(){return _(this,function(e){switch(e.label){case 0:return[4,this.wait()];case 1:e.sent(),e.label=2;case 2:return e.trys.push([2,,4,5]),[4,t()];case 3:return[2,e.sent()];case 4:return this.signal(),[7];case 5:return[2]}})})},n}();c.default=b});var d=m(f=>{"use strict";var g=f&&f.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var s in e)e.hasOwnProperty(s)&&(t[s]=e[s])};return function(t,e){n(t,e);function s(){this.constructor=t}t.prototype=e===null?Object.create(e):(s.prototype=e.prototype,new s)}}();f.__esModule=!0;var P=y(),Q=function(n){g(t,n);function t(){return n.call(this,1)||this}return t}(P.default);f.Lock=Q});var w=m(l=>{"use strict";function k(n){for(var t in n)l.hasOwnProperty(t)||(l[t]=n[t])}l.__esModule=!0;var O=y();l.default=O.default;k(d())});"semaphore-async-await"in globalThis.__thrush_future_vendor_registry__||Object.defineProperty(globalThis.__thrush_future_vendor_registry__,"semaphore-async-await",{get(){return w()}});
})();
