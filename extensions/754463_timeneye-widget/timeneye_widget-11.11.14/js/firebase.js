const googleClientId="410389300352-gbtsqjbsqqjmfni71jf7toj4islke3re.apps.googleusercontent.com",microsoftClientId="56412014-bafe-474e-95b4-ebfea106a167",urlAjax="https://track.timeneye.com/";if(void 0===browser)var browser=chrome;function thirdPartyLoginSuccessCallback(e,t){return this.apiRequest("authorizeThirdPartyLoginWithToken",{authority:e,token:t}).then(e=>{"string"==typeof e||e.code||browser.storage.sync.set({authToken:e.authToken})})}function getTokenFromResponse(e,t){let o=e.accessToken;return"apple.com"===e.providerId?o=e.idToken?e.idToken:e.oauthIdToken:!o&&e.oauthAccessToken?o=e.oauthAccessToken:!o&&e.idToken&&(o=e.idToken),thirdPartyLoginSuccessCallback(t,o)}async function signInWithPopupBg(e){var t=null;if("google"===e){const e=await browser.identity.launchWebAuthFlow({url:`https://accounts.google.com/o/oauth2/v2/auth?response_type=token&scope=email%20openid%20profile&client_id=${googleClientId}&prompt=select_account&redirect_uri=${browser.identity.getRedirectURL()}`,interactive:!0});t={_tokenResponse:{accessToken:decodeURIComponent(e).split("token=")[1].split("&")[0]}}}else if("microsoft"===e){const e=await browser.identity.launchWebAuthFlow({url:`https://login.microsoftonline.com/organizations/oauth2/v2.0/authorize?response_type=token&scope=https%3A%2F%2Fgraph.microsoft.com%2Fuser.read%20email%20openid%20profile&client_id=${microsoftClientId}&prompt=select_account&redirect_uri=${browser.identity.getRedirectURL()}`,interactive:!0});t={_tokenResponse:{accessToken:decodeURIComponent(e).split("access_token=")[1].split("&")[0]}}}return t._tokenResponse?this.getTokenFromResponse(t._tokenResponse,e):t}function standardizeBody(e,t){for(var o=new FormData,n=Object.keys(t),s=0,i=n.length;s<i;s++)"object"==typeof t[n[s]]?o.append(n[s],JSON.stringify(t[n[s]])):Number(t[n[s]]==Number(t[n[s]]))?o.append(n[s],t[n[s]].toString()):"string"==typeof t[n[s]]&&o.append(n[s],t[n[s]]);return o.append("target","widget"),o}function apiRequest(e,t){const o=this.standardizeBody(e,t);return fetch(urlAjax+"api/2/"+e,{method:"POST",body:o}).then((function(e){return e.json()}))}browser.runtime.onMessage.addListener((e,t,o)=>("signInWithPopup"===e.method&&this.signInWithPopupBg(e.service).then(e=>{o({token:e})}).catch(e=>{"string"==typeof e.message?o({message:e.message}):e.code&&o({message:e.description})}),!0));
//# sourceMappingURL=firebase.js.map