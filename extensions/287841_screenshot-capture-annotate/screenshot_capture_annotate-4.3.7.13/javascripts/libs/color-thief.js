var CanvasImage=function(t){this.canvas=document.createElement("canvas"),this.context=this.canvas.getContext("2d"),document.body.appendChild(this.canvas),this.width=this.canvas.width=t.width,this.height=this.canvas.height=t.height,this.context.drawImage(t,0,0,this.width,this.height)};CanvasImage.prototype.clear=function(){this.context.clearRect(0,0,this.width,this.height)},CanvasImage.prototype.update=function(t){this.context.putImageData(t,0,0)},CanvasImage.prototype.getPixelCount=function(){return this.width*this.height},CanvasImage.prototype.getImageData=function(){return this.context.getImageData(0,0,this.width,this.height)},CanvasImage.prototype.removeCanvas=function(){this.canvas.parentNode.removeChild(this.canvas)};var ColorThief=function(){};if(ColorThief.prototype.getColor=function(t,r){return this.getPalette(t,5,r)[0]},ColorThief.prototype.getPalette=function(t,r,n){void 0===r&&(r=10),void 0===n&&(n=10);for(var o,e,a,i,u=new CanvasImage(t),c=u.getImageData().data,f=u.getPixelCount(),s=[],v=0;v<f;v+=n)e=c[(o=4*v)+0],a=c[o+1],i=c[o+2],c[o+3]>=125&&(e>250&&a>250&&i>250||s.push([e,a,i]));var h=MMCQ.quantize(s,r).palette();return u.removeCanvas(),h},!pv)var pv={map:function(t,r){var n={};return r?t.map((function(t,o){return n.index=o,r.call(n,t)})):t.slice()},naturalOrder:function(t,r){return t<r?-1:t>r?1:0},sum:function(t,r){var n={};return t.reduce(r?function(t,o,e){return n.index=e,t+r.call(n,o)}:function(t,r){return t+r},0)},max:function(t,r){return Math.max.apply(null,r?pv.map(t,r):t)}};var MMCQ=function(){var t=5,r=8-t;function n(r,n,o){return(r<<2*t)+(n<<t)+o}function o(t){var r=[],n=!1;function o(){r.sort(t),n=!0}return{push:function(t){r.push(t),n=!1},peek:function(t){return n||o(),void 0===t&&(t=r.length-1),r[t]},pop:function(){return n||o(),r.pop()},size:function(){return r.length},map:function(t){return r.map(t)},debug:function(){return n||o(),r}}}function e(t,r,n,o,e,a,i){var u=this;u.r1=t,u.r2=r,u.g1=n,u.g2=o,u.b1=e,u.b2=a,u.histo=i}function a(){this.vboxes=new o((function(t,r){return pv.naturalOrder(t.vbox.count()*t.vbox.volume(),r.vbox.count()*r.vbox.volume())}))}function i(t,r){if(r.count()){var o=r.r2-r.r1+1,e=r.g2-r.g1+1,a=r.b2-r.b1+1,i=pv.max([o,e,a]);if(1==r.count())return[r.copy()];var u,c,f,s,v=0,h=[],p=[];if(i==o)for(u=r.r1;u<=r.r2;u++){for(s=0,c=r.g1;c<=r.g2;c++)for(f=r.b1;f<=r.b2;f++)s+=t[n(u,c,f)]||0;v+=s,h[u]=v}else if(i==e)for(u=r.g1;u<=r.g2;u++){for(s=0,c=r.r1;c<=r.r2;c++)for(f=r.b1;f<=r.b2;f++)s+=t[n(c,u,f)]||0;v+=s,h[u]=v}else for(u=r.b1;u<=r.b2;u++){for(s=0,c=r.r1;c<=r.r2;c++)for(f=r.g1;f<=r.g2;f++)s+=t[n(c,f,u)]||0;v+=s,h[u]=v}return h.forEach((function(t,r){p[r]=v-t})),g(i==o?"r":i==e?"g":"b")}function g(t){var n,o,e,a,i,c=t+"1",f=t+"2",s=0;for(u=r[c];u<=r[f];u++)if(h[u]>v/2){for(e=r.copy(),a=r.copy(),i=(n=u-r[c])<=(o=r[f]-u)?Math.min(r[f]-1,~~(u+o/2)):Math.max(r[c],~~(u-1-n/2));!h[i];)i++;for(s=p[i];!s&&h[i-1];)s=p[--i];return e[f]=i,a[c]=e[f]+1,[e,a]}}}return e.prototype={volume:function(t){var r=this;return r._volume&&!t||(r._volume=(r.r2-r.r1+1)*(r.g2-r.g1+1)*(r.b2-r.b1+1)),r._volume},count:function(t){var r=this,o=r.histo;if(!r._count_set||t){var e,a,i,u=0;for(e=r.r1;e<=r.r2;e++)for(a=r.g1;a<=r.g2;a++)for(i=r.b1;i<=r.b2;i++)index=n(e,a,i),u+=o[index]||0;r._count=u,r._count_set=!0}return r._count},copy:function(){var t=this;return new e(t.r1,t.r2,t.g1,t.g2,t.b1,t.b2,t.histo)},avg:function(r){var o=this,e=o.histo;if(!o._avg||r){var a,i,u,c,f=0,s=1<<8-t,v=0,h=0,p=0;for(i=o.r1;i<=o.r2;i++)for(u=o.g1;u<=o.g2;u++)for(c=o.b1;c<=o.b2;c++)f+=a=e[n(i,u,c)]||0,v+=a*(i+.5)*s,h+=a*(u+.5)*s,p+=a*(c+.5)*s;o._avg=f?[~~(v/f),~~(h/f),~~(p/f)]:[~~(s*(o.r1+o.r2+1)/2),~~(s*(o.g1+o.g2+1)/2),~~(s*(o.b1+o.b2+1)/2)]}return o._avg},contains:function(t){var n=this,o=t[0]>>r;return gval=t[1]>>r,bval=t[2]>>r,o>=n.r1&&o<=n.r2&&gval>=n.g1&&o<=n.g2&&bval>=n.b1&&o<=n.b2}},a.prototype={push:function(t){this.vboxes.push({vbox:t,color:t.avg()})},palette:function(){return this.vboxes.map((function(t){return t.color}))},size:function(){return this.vboxes.size()},map:function(t){for(var r=this.vboxes,n=0;n<r.size();n++)if(r.peek(n).vbox.contains(t))return r.peek(n).color;return this.nearest(t)},nearest:function(t){for(var r,n,o,e=this.vboxes,a=0;a<e.size();a++)((n=Math.sqrt(Math.pow(t[0]-e.peek(a).color[0],2)+Math.pow(t[1]-e.peek(a).color[1],2)+Math.pow(t[1]-e.peek(a).color[1],2)))<r||void 0===r)&&(r=n,o=e.peek(a).color);return o},forcebw:function(){var t=this.vboxes;t.sort((function(t,r){return pv.naturalOrder(pv.sum(t.color),pv.sum(r.color))}));var r=t[0].color;r[0]<5&&r[1]<5&&r[2]<5&&(t[0].color=[0,0,0]);var n=t.length-1,o=t[n].color;o[0]>251&&o[1]>251&&o[2]>251&&(t[n].color=[255,255,255])}},{quantize:function(u,c){if(!u.length||c<2||c>256)return!1;var f=function(o){var e,a,i,u,c=new Array(1<<3*t);return o.forEach((function(t){a=t[0]>>r,i=t[1]>>r,u=t[2]>>r,e=n(a,i,u),c[e]=(c[e]||0)+1})),c}(u);f.forEach((function(){0}));var s=function(t,n){var o,a,i,u=1e6,c=0,f=1e6,s=0,v=1e6,h=0;return t.forEach((function(t){o=t[0]>>r,a=t[1]>>r,i=t[2]>>r,o<u?u=o:o>c&&(c=o),a<f?f=a:a>s&&(s=a),i<v?v=i:i>h&&(h=i)})),new e(u,c,f,s,v,h,n)}(u,f),v=new o((function(t,r){return pv.naturalOrder(t.count(),r.count())}));function h(t,r){for(var n,o=1,e=0;e<1e3;)if((n=t.pop()).count()){var a=i(f,n),u=a[0],c=a[1];if(!u)return;if(t.push(u),c&&(t.push(c),o++),o>=r)return;if(e++>1e3)return}else t.push(n),e++}v.push(s),h(v,.75*c);for(var p=new o((function(t,r){return pv.naturalOrder(t.count()*t.volume(),r.count()*r.volume())}));v.size();)p.push(v.pop());h(p,c-p.size());for(var g=new a;p.size();)g.push(p.pop());return g}}}();