function e(){chrome.contextMenus.create({id:"addToQricambi",title:'Cerca "%s" su Qricambi',contexts:["selection"]})}function i(){chrome.tabs.create({url:chrome.runtime.getURL("pages/permissions.html")});chrome.storage.local.set({eula:!1,alwaysOnQ:!0,searchImmediately:!0,clearSearch:!0,gcatOptions:!0,partslinkOptions:!0,tecdocOptions:!0,inforicambiOptions:!1,clippartsOptions:!1,openNewDetectorWindow:!0,monosessionspiders:[{domain:"maina.blusys.it",cookie:"b2b_blusys_001293",name:"MainaSpaSpider"},{domain:"aldoromeo.blusys.it",cookie:"b2b_blusys_000626",name:"AldoromeoSpider"},{domain:"coran.blusys.it",cookie:"b2b_blusys_001235",name:"CoranSpider"},{domain:"topcaritalia.blusys.it",cookie:"b2b_blusys_001602",name:"TopcarSpider"},{domain:"autocom.blusys.it",cookie:"b2b_blusys_001936",name:"AutocomSpider"},{domain:"ilfreno.blusys.it",cookie:"b2b_blusys_001874",name:"IlFrenoSpider"},{domain:"sdgs.blusys.it",cookie:"b2b_blusys_001909",name:"SdgsSpider"},{domain:"neoparts.blusys.it",cookie:"b2b_blusys_001346",name:"NeopartsSpider"},{domain:"https://rimat.blusys.it",cookie:"b2b_blusys_001290",name:"Rimat"},{domain:"ricambisti.blusys.it",cookie:"b2b_blusys_001580",name:"CorautoSpider"},{domain:"gds-genei.blusys.it",cookie:"b2b_blusys_001529",name:"GdsSpider"},{domain:"secori.cointa.eu",name:"SecoriSpider"},{domain:"fissst.it",name:"FissstSpider"},{domain:"adria.cointa.eu",name:"AdriaSpider"},{domain:"sicilmotors.it",name:"SicilMotorsSpider"},{domain:"b2b21.univergomma.it",name:"UniverGommeSpider",useragent:!0},{domain:"b2b.overgom.it",name:"OvergomSpider",useragent:!0},{domain:"b2b.carlinigomme.com",cookie:"devid",name:"CarliniSpider"},{domain:"www.pneusb2b.it",cookie:"fingerprint",name:"Pneusb2bSpider"}]})}async function s(e,i){var a=await o();fetch("https://app.qricambi.com/api/Account/AddAccountMetadata",{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer "+a,Accept:"application/json"},body:JSON.stringify({key:e,type:"Cookie",value:i})})}async function a(e=""){var i,a;for(i of(await chrome.storage.local.get(["monosessionspiders"])).monosessionspiders)if(i.domain.includes(e))if(i.cookie){var o=await chrome.cookies.getAll({domain:i.domain,name:i.cookie});0<o.length&&await s(i.name,o[0].value)}else if(i.useragent){o=await chrome.tabs.query({url:"https://app.qricambi.com/*"});if(0<!o.length)return;var t=await chrome.tabs.sendMessage(o[0].id,{method:"getFingerprint"});0<t.fingerprint.length&&await s(i.name,t.fingerprint)}else if(!i.cookie&&!i.useragent)for(a of chrome.cookies.getAll({domain:i.domain}))a.name.includes("ergon.account")&&await s(i.name,a.name+"="+a.value)}async function o(){var e=await chrome.tabs.query({url:"https://app.qricambi.com/*"});return 0<!e.length?"":(e=await chrome.tabs.sendMessage(e[0].id,{method:"getQToken"}),await chrome.storage.local.set({qtoken:e.qtoken}),e.qtoken)}async function t(a=""){chrome.storage.local.get().then(i=>{chrome.tabs.query({url:"https://app.qricambi.com/*"}).then(e=>{0<e.length?0<a.length?browser.scripting.executeScript({target:{tabId:e[0].id},func:(e,i)=>{window.wrappedJSObject.QVue.addtag(e.replace(/[\s\(\)]/gi,"").trim(),i.searchImmediately,i.clearSearch)},args:[a,i]}).then(()=>{1==i.alwaysOnQ&&(browser.tabs.update(e[0].id,{active:!0}),browser.windows.update(e[0].windowId,{focused:!0}))}):(chrome.tabs.update(e[0].id,{active:!0}),chrome.windows.update(e[0].windowId,{focused:!0})):chrome.tabs.create({url:"https://app.qricambi.com/"}).then(e=>{0<a.length&&chrome.scripting.executeScript({target:{tabId:e.id},func:e=>{window.wrappedJSObject.QVue.addtag(e.replace(/[\s\(\)]/gi,"").trim())},args:[a]})})})})}e(),chrome.runtime.onInstalled.addListener(()=>{i()}),chrome.runtime.onStartup.addListener(()=>{o()}),chrome.permissions.onAdded.addListener(()=>{chrome.tabs.query({url:"https://app.qricambi.com/*"},e=>{e.forEach(e=>{chrome.tabs.reload(e.id)})})}),chrome.action.onClicked.addListener(()=>{t(),o()}),chrome.contextMenus.onClicked.addListener(e=>{t(e.selectionText.trim())}),chrome.runtime.onMessage.addListener(i=>{switch(i.method){case"gotoQ":chrome.storage.local.get().then(e=>{t(i.code)});break;case"getCookies":a(i.site)}}),chrome.tabs.onUpdated.addListener((e,i,a)=>{"complete"==a.status&&"https://app.qricambi.com/"==a.url&&o()});