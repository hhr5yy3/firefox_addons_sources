import{r as w}from"./cplx-M4JPizzD.js";import{j as n,c as v,v as F}from"./cplx-DEt7CUyc.js";import{t,E as G,F as q,H as Q,I as J,J as X,K as U,b as T,M as Y}from"./cplx-CejnDNPm.js";import{C as H,b as ee,T as O,f,a as y,g as ne,d as te,e as se,h as E}from"./cplx-C7vqVxs5.js";import{I as ae}from"./cplx-CCGYIZQf.js";import{$ as S}from"./cplx-BbAh7E-i.js";import{a as oe}from"./cplx--i0pL27w.js";import{P as re,u as p,c as ce}from"./cplx-CVOZpI4d.js";import{E as M,Z as K,K as j,j as ie}from"./cplx-CVsLL7Ku.js";import{j as le,a as me,h as N,k as de}from"./cplx-CWPpH3dB.js";import{K as B}from"./cplx-COgv5RYR.js";import{s as I}from"./cplx-Bey00KRS.js";import{w as ue,t as he,v as C}from"./cplx-Cdcyb6EG.js";import{B as A}from"./cplx-D1YT3uoP.js";import{u as L}from"./cplx-B42KOvrD.js";import{u as D}from"./cplx-BB1imbNT.js";import{i as k,u as P}from"./cplx-Mn-h5XDX.js";import{l as _,P as we}from"./cplx-AFeO3sEC.js";import{T as pe}from"./cplx-Cqfmi6PF.js";import{T as ge}from"./cplx-CBFcDSDy.js";import"./cplx-D37zsf-y.js";import"./cplx-BsCYqTWz.js";import"./cplx-DSnlyBAv.js";import"./cplx-CXGk_GMP.js";import"./cplx-BqwXc_LR.js";import"./cplx-CzQHx1MX.js";import"./cplx-BpeHHEix.js";import"./cplx-CIDXzIHh.js";import"./cplx-CvSOQQlQ.js";import"./cplx-Bzmv935M.js";import"./cplx-CZMWhpfy.js";import"./cplx-SsoyhRxE.js";import"./cplx-DewpVJ-0.js";import"./cplx-DD6dUv5H.js";import"./cplx-Dy60Fcq0.js";import"./cplx-CgmVhoKz.js";import"./cplx-km2FGkQ4.js";import"./cplx-hUtawQMb.js";import"./cplx-2ekRUlSR.js";import"./cplx-DC-QQLj-.js";import"./cplx-B814hFp-.js";import"./cplx-wwbq-DDb.js";import"./cplx-CCS6eJc0.js";import"./cplx-B19A3gYQ.js";function xe({...e}){return n.jsx("svg",{width:"0.8em",height:"0.8em",fill:"currentColor",xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 640 512",...e,children:n.jsx("path",{fill:"currentColor",d:"M320 51.2c6.4 0 19.2 17.3 30.4 51.2c4.8 14.1 9 31.4 12.5 51.2c2.9 15.4 5.1 32.3 6.4 51.2c1.3 16 1.9 33 1.9 51.2h51.2c0-17-.6-34.2-1.9-51.2c-1.3-17.3-3.2-34.6-5.8-51.2c-2.9-17.9-6.4-35.2-10.9-51.2c-3.8-13.8-8-26.6-13.1-38.4C374.1 25.3 350.7 0 320 0s-54.1 25.3-70.7 64c-5.1 11.5-9.3 24.6-13.1 38.4h53.8c11.2-33.9 23.7-51.2 30.4-51.2H320zm0 409.6c-6.4 0-19.2-17.3-30.4-51.2c-4.8-14.1-9-31.4-12.5-51.2c-2.9-15.4-5.1-32.3-6.4-51.2c-1.3-16-1.9-33-1.9-51.2H217.6c0 17 .6 34.2 1.9 51.2c1.3 17.3 3.2 34.6 5.8 51.2c2.9 17.9 6.4 35.2 10.9 51.2c3.8 13.8 8 26.6 13.1 38.4c16.6 38.7 40 64 70.7 64s54.1-25.3 70.7-64c5.1-11.5 9.3-24.6 13.1-38.4H350.1c-11.2 33.9-23.7 51.2-30.4 51.2h.3zM550.4 145.3c-7.4-15-16-29.4-26.2-42.9c-25-33-57.6-59.8-95.4-77.8C395.8 9 359 0 320 0s-75.8 9-108.8 24.6c-37.8 17.9-70.4 44.8-95.4 77.8c-9.9 13.4-18.9 27.5-26.2 42.9C73.3 178.9 64 216.3 64 256s9.3 77.1 25.6 110.7c7.4 15 16 29.4 26.2 42.9c25 33 57.6 59.8 95.4 77.8C244.2 503 281 512 320 512s75.8-9 108.8-24.6c37.8-17.9 70.4-44.8 95.4-77.8c9.9-13.4 18.9-27.5 26.2-42.9c16.3-33.6 25.6-71 25.6-110.7s-9.3-77.1-25.6-110.7zM390.7 448c-22.1 8.3-45.8 12.8-70.7 12.8s-48.6-4.8-70.7-12.8c-23.7-9-45.4-21.8-64.3-38.4c-1-.6-1.6-1.6-2.6-2.2c-15.7-14.1-29.1-30.7-39.7-49h30.4c-2.2-16.6-4.2-33.9-5.1-51.2H121.9c-4.2-16.3-6.7-33.6-6.7-51.2s2.6-34.9 6.7-51.2H320V153.6H143c10.6-18.2 24-34.9 39.7-49c1-.6 1.6-1.6 2.6-2.2C204.2 86.1 225.6 73 249.6 64c22.1-8.3 45.8-12.8 70.7-12.8s48.6 4.8 70.7 12.8c23.7 9 45.4 21.8 64.3 38.4c1 .6 1.6 1.6 2.6 2.2c15.7 14.1 29.1 30.7 39.7 49H467.2c2.2 16.6 4.2 33.9 5.1 51.2h46.1c4.2 16.3 6.7 33.6 6.7 51.2s-2.6 34.9-6.7 51.2H320.3v51.2h177c-10.6 18.2-24 34.9-39.7 49c-1 .6-1.6 1.6-2.6 2.2c-18.9 16.3-40.3 29.4-64.3 38.4z"})})}function fe({...e}){return n.jsx("svg",{width:"0.8em",height:"0.8em",fill:"currentColor",xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 221 183",...e,children:n.jsx("path",{fill:"currentColor",d:"M59.4967 39.8367C30.9654 39.8367 7.83624 62.9671 7.83624 91.5C7.83624 120.033 30.9654 143.163 59.4967 143.163C83.9985 143.163 104.516 126.105 109.823 103.216H117.84C112.399 130.466 88.3457 151 59.4967 151C26.6376 151 0 124.361 0 91.5C0 58.639 26.6376 32 59.4967 32C91.0393 32 116.849 56.5473 118.866 87.5817H155.879L123.292 54.9276L128.838 49.3918L161.428 82.0483L161.387 35.9218L169.223 35.9149L169.264 82.0641L201.87 49.3918L207.416 54.9276L174.829 87.5817H221V95.4183H174.771L207.416 128.131L201.87 133.667L169.281 101.011L169.321 147.157L161.485 147.163L161.444 100.993L128.838 133.667L123.292 128.131L155.937 95.4183H129.748V95.3791H84.6892V95.4183H59.495V87.5817H111.011C109.008 60.8792 86.7098 39.8367 59.4967 39.8367Z"})})}function je({...e}){return n.jsx("svg",{width:"0.8em",height:"0.8em",fill:"currentColor",xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 512 512",...e,children:n.jsx("path",{fill:"currentColor",d:"M512 281.6H460.8V256C460.8 143 369 51.2 256 51.2S51.2 143 51.2 256v25.6H0V256C0 114.9 114.9 0 256 0S512 114.9 512 256v25.6zm-102.4 0H358.4V256c0-56.3-46.1-102.4-102.4-102.4s-102.4 46.1-102.4 102.4v25.6H102.4V256c0-84.8 68.8-153.6 153.6-153.6s153.6 68.8 153.6 153.6v25.6zm-51.2 51.2c-41.9 0-79 20.5-102.4 51.8c-23.4-31.4-60.5-51.8-102.4-51.8H0V384H153.6c42.2 0 76.8 34.6 76.8 76.8v25.6h51.2V460.8c0-42.2 34.6-76.8 76.8-76.8H512V332.8H358.4zM256 307.2a51.2 51.2 0 1 0 0-102.4 51.2 51.2 0 1 0 0 102.4z"})})}function ye({...e}){return n.jsx("svg",{width:"0.8em",height:"0.8em",fill:"currentColor",xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 512 512","aria-hidden":"true",focusable:"false",role:"img",...e,children:n.jsx("path",{fill:"currentColor",d:"M492.8 147.2H262.4v51.2H492.8V147.2zm0 102.4H262.4v51.2H492.8V249.6zM262.4 96H32v51.2H262.4V96zm0 102.4H32v51.2H262.4V198.4zm0 102.4H32V352H262.4V300.8zM492.8 352H262.4v51.2H492.8V352z"})})}const Me=[{type:"enable",label:t("plugin-command-menu:commandMenu.zenMode.enable"),icon:G,keywords:[t("plugin-command-menu:commandMenu.keywords.enable"),t("plugin-command-menu:commandMenu.keywords.zen"),t("plugin-command-menu:commandMenu.keywords.mode")],action:()=>{var e;S("body").attr("data-cplx-zen-mode","true"),(e=M.getCachedSync())!=null&&e.plugins.zenMode.persistent&&M.set(a=>{a.plugins.zenMode.lastState=!0})},shortcut:["Ctrl","Alt","Z"]},{type:"disable",label:t("plugin-command-menu:commandMenu.zenMode.disable"),icon:q,keywords:[t("plugin-command-menu:commandMenu.keywords.disable"),t("plugin-command-menu:commandMenu.keywords.zen"),t("plugin-command-menu:commandMenu.keywords.mode")],action:()=>{var e;S("body").attr("data-cplx-zen-mode","false"),(e=M.getCachedSync())!=null&&e.plugins.zenMode.persistent&&M.set(a=>{a.plugins.zenMode.lastState=!1})},shortcut:["Ctrl","Alt","Z"]}],b={threads:{code:"threads",label:t("plugin-command-menu:commandMenu.filters.threads.label"),searchPlaceholder:t("plugin-command-menu:commandMenu.filters.threads.searchPlaceholder")},spaces:{code:"spaces",label:t("plugin-command-menu:commandMenu.filters.spaces.label"),searchPlaceholder:t("plugin-command-menu:commandMenu.filters.spaces.searchPlaceholder")},"spaces-threads":{code:"spaces-threads",label:"",searchPlaceholder:""}},$=[{icon:ye,code:b.threads.code,label:t("plugin-command-menu:commandMenu.filters.threads.label"),keywords:[t("plugin-command-menu:commandMenu.keywords.threads")]},{icon:re,code:b.spaces.code,label:t("plugin-command-menu:commandMenu.filters.spaces.label"),keywords:[t("plugin-command-menu:commandMenu.keywords.spaces")]}];$.forEach(e=>e.keywords.push(t("plugin-command-menu:commandMenu.keywords.search")));const Z=[{icon:oe,label:t("plugin-command-menu:commandMenu.navigation.home"),path:"/",keywords:[t("plugin-command-menu:commandMenu.keywords.home")],whereAmI:"home"},{icon:xe,label:t("plugin-command-menu:commandMenu.navigation.discover"),path:"/discover",keywords:[t("plugin-command-menu:commandMenu.keywords.discover")],whereAmI:"discover"},{icon:je,label:t("plugin-command-menu:commandMenu.navigation.library"),path:"/library",keywords:[t("plugin-command-menu:commandMenu.keywords.library")],whereAmI:"library"},{icon:Q,label:t("plugin-command-menu:commandMenu.navigation.userSettings"),path:"/settings/account",keywords:[t("plugin-command-menu:commandMenu.keywords.user"),t("plugin-command-menu:commandMenu.keywords.settings")],whereAmI:"settings"},{icon:fe,label:t("plugin-command-menu:commandMenu.navigation.labs"),path:"https://labs.perplexity.ai/",keywords:[t("plugin-command-menu:commandMenu.keywords.labs")],external:!0,whereAmI:"unknown"}];Z.forEach(e=>e.keywords.push(t("plugin-command-menu:commandMenu.keywords.navigate")));const R=[{scheme:"dark",icon:J,label:t("plugin-command-menu:commandMenu.colorSchemes.dark"),keywords:[t("plugin-command-menu:commandMenu.keywords.dark"),t("plugin-command-menu:commandMenu.keywords.theme")]},{scheme:"light",icon:X,label:t("plugin-command-menu:commandMenu.colorSchemes.light"),keywords:[t("plugin-command-menu:commandMenu.keywords.light"),t("plugin-command-menu:commandMenu.keywords.theme")]},{scheme:"system",icon:U,label:t("plugin-command-menu:commandMenu.colorSchemes.system"),keywords:[t("plugin-command-menu:commandMenu.keywords.system"),t("plugin-command-menu:commandMenu.keywords.theme")]}];R.forEach(e=>{e.keywords.push(t("plugin-command-menu:commandMenu.keywords.change"),t("plugin-command-menu:commandMenu.keywords.color"),t("plugin-command-menu:commandMenu.keywords.scheme"))});const z=w.memo(function({icon:a,label:o,shortcut:s,keywords:c,onSelect:r,closeOnSelect:i=!0,className:d,...l}){const{closeCommandMenu:u}=p();return n.jsxs(H,{keywords:c,className:v("tw-font-medium",d),onSelect:()=>{r==null||r(),i&&u()},...l,children:[n.jsx(a,{className:"tw-mr-2 tw-size-4"}),o,s&&n.jsx(ee,{children:n.jsx(B,{keys:s})})]})}),Se=w.memo(e=>{const a=p(l=>l.searchValue),{colorScheme:o,setColorScheme:s}=le();if(!(o!==e.scheme||a.length>0))return null;const{scheme:r,onSelect:i,...d}=e;return n.jsx(z,{...d,onSelect:i||(()=>s(r))})}),be=w.memo(e=>{const{url:a}=me(),o=p(g=>g.searchValue),s=ue(a)!==e.whereAmI||o.length>0,c=w.useCallback(()=>{e.path&&I("spa-router:push",{url:e.path},"window")},[e.path]);if(!s)return null;const{path:r,whereAmI:i,external:d,onSelect:l,...u}=e;return n.jsx(z,{...u,onSelect:l||c})});function ve(){const{filter:e,spacethreadTitle:a}=p();return e?n.jsxs("div",{className:"tw-ml-3",children:[b[e].label&&n.jsx(A,{children:b[e].label}),e==="spaces-threads"&&n.jsx(A,{className:"tw-line-clamp-1 tw-max-w-[150px]",children:a})]}):null}function Ce(e){const{filter:a,setFilter:o,setSearchValue:s}=p();if(a===e.code)return null;const{code:c,onSelect:r,...i}=e;return n.jsx(z,{...i,closeOnSelect:!1,onSelect:r||(()=>{o(e.code),s("")})})}function ke(){return n.jsxs("div",{className:"tw-flex tw-animate-pulse tw-items-center tw-justify-center tw-gap-2 tw-p-4 tw-text-sm tw-text-muted-foreground",children:[n.jsx(T,{className:"tw-size-4 tw-animate-spin"}),n.jsx("span",{children:t("plugin-command-menu:commandMenu.spaceSearch.loading")})]})}function He({...e}){return n.jsx("svg",{width:"0.8em",height:"0.8em","aria-hidden":"true",focusable:"false",xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 512 512",...e,children:n.jsx("path",{fill:"currentColor",d:"M89.6 422.4c7.9 7.9 31.4 16.9 80.4 .6c13.2-4.4 27.2-10.4 41.6-17.9c-18.9-14.4-37.7-30.8-55.8-48.9s-34.5-36.9-48.9-55.8c-7.5 14.4-13.5 28.4-17.9 41.6c-16.3 49-7.3 72.5 .6 80.4zM76.8 256C27.6 173.9 16.5 94.9 55.7 55.7S173.9 27.6 256 76.8c82.1-49.2 161.1-60.3 200.3-21.1s28.1 118.2-21.1 200.3c49.2 82.1 60.3 161.1 21.1 200.3s-118.2 28.1-200.3-21.1c-82.1 49.2-161.1 60.3-200.3 21.1S27.6 338.1 76.8 256zM107 211.6c14.4-18.9 30.8-37.7 48.9-55.8s36.9-34.5 55.8-48.9c-14.4-7.5-28.4-13.5-41.6-17.9c-49-16.3-72.5-7.3-80.4 .6s-16.9 31.4-.6 80.4c4.4 13.2 10.4 27.2 17.9 41.6zM256 134c-22.1 15.5-44.5 34.1-66.2 55.8s-40.3 44.1-55.8 66.2c15.5 22.1 34.1 44.5 55.8 66.2s44.1 40.3 66.2 55.8c22.1-15.5 44.5-34.1 66.2-55.8s40.3-44.1 55.8-66.2c-15.5-22.1-34.1-44.5-55.8-66.2s-44.1-40.3-66.2-55.8zm149 77.7c7.5-14.4 13.5-28.4 17.9-41.6c16.3-49 7.3-72.5-.6-80.4s-31.4-16.9-80.4-.6c-13.2 4.4-27.2 10.4-41.6 17.9c18.9 14.4 37.7 30.8 55.8 48.9s34.5 36.9 48.9 55.8zm0 88.7c-14.4 18.9-30.8 37.7-48.9 55.8s-36.9 34.5-55.8 48.9c14.4 7.5 28.4 13.5 41.6 17.9c49 16.3 72.5 7.3 80.4-.6s16.9-31.4 .6-80.4c-4.4-13.2-10.4-27.2-17.9-41.6zM224 256a32 32 0 1 1 64 0 32 32 0 1 1 -64 0z"})})}function Ne({space:e}){const{data:a}=L({...N.spaces._ctx.files(e.uuid),refetchOnMount:!1,refetchOnWindowFocus:!1});return n.jsx(n.Fragment,{children:a&&a.num_total_files>0&&n.jsxs("div",{className:"tw-flex tw-flex-shrink-0 tw-items-center tw-gap-1 tw-rounded-md tw-border tw-border-border/50 tw-bg-secondary tw-px-2 tw-py-1 tw-text-xs tw-text-muted-foreground tw-animate-in tw-fade-in",children:[n.jsx("span",{children:a.num_total_files}),n.jsx(Y,{className:"!tw-size-3"})]})})}function Ie({space:e}){var u;const{setOpen:a,setFilter:o,setSearchValue:s,setSpacethreadFilterSlug:c,setSpacethreadTitle:r}=p(),i=O(g=>g.value===e.uuid),d=w.useMemo(()=>(e.title+e.description+e.instructions).replace(/\s+/g,"").toLowerCase(),[e]),l=w.useMemo(()=>_.find(g=>g.code===e.model_selection),[e]);return n.jsx(H,{asChild:!0,value:e.uuid,keywords:[d],className:v("tw-flex tw-min-h-10 tw-items-center tw-font-medium",i&&"tw-h-max"),onSelect:()=>{if(k("ctrl"))return window.open(`/collections/${e.slug}`,"_blank");k("shift")?(o("spaces-threads"),s(""),c(e.slug),r(e.title)):(I("spa-router:push",{url:`/collections/${e.slug}`},"window"),a(!1))},children:n.jsxs("a",{href:`/collections/${e.slug}`,className:"tw-flex tw-h-full tw-w-full tw-flex-col tw-gap-2",children:[n.jsxs("div",{className:"tw-flex tw-w-full tw-items-center tw-justify-between",children:[n.jsxs("div",{className:"tw-flex tw-flex-1 tw-items-center tw-gap-2",children:[e.emoji&&n.jsx("div",{children:he(e.emoji)}),n.jsx("div",{className:"tw-line-clamp-1",children:e.title.slice(0,100)})]}),n.jsxs("div",{className:"tw-flex tw-flex-shrink-0 tw-items-center tw-gap-1",children:[l&&n.jsxs("div",{className:"tw-flex tw-flex-shrink-0 tw-items-center tw-gap-1 tw-rounded-md tw-border tw-border-border/50 tw-bg-secondary tw-px-2 tw-py-1 tw-text-xs tw-text-muted-foreground",children:[n.jsx(He,{className:"!tw-size-3"}),n.jsx("span",{children:(u=_.find(g=>g.code===e.model_selection))==null?void 0:u.label})]}),D(i,300)&&n.jsx(Ne,{space:e})]})]}),i&&(e.description||e.instructions)&&n.jsxs("div",{className:"tw-flex tw-max-w-full tw-flex-col tw-gap-1 tw-rounded-md tw-border tw-border-border/50 tw-bg-background tw-p-2",children:[e.description&&n.jsxs("div",{className:"tw-flex tw-items-baseline tw-gap-1",children:[n.jsx("div",{className:"tw-text-xs tw-font-medium",children:t("plugin-command-menu:commandMenu.spaceSearch.spaceItem.details.description")}),n.jsx("div",{className:"tw-line-clamp-2 tw-text-xs tw-text-foreground",children:e.description})]}),e.instructions&&n.jsxs("div",{className:"tw-flex tw-items-baseline tw-gap-1",children:[n.jsx("div",{className:"tw-text-xs tw-font-medium",children:t("plugin-command-menu:commandMenu.spaceSearch.spaceItem.details.instructions")}),n.jsx("div",{className:"tw-line-clamp-2 tw-text-xs tw-text-foreground",children:e.instructions})]})]}),i&&n.jsxs("div",{className:"tw-flex tw-items-center tw-justify-end tw-gap-2 tw-text-xs tw-text-muted-foreground",children:[n.jsx(B,{keys:["shift","enter"]}),n.jsx("span",{children:t("plugin-command-menu:commandMenu.spaceSearch.spaceItem.searchHint")})]})]})},e.uuid)}function Le(){const{filter:e}=p(),{data:a,isLoading:o,isError:s}=L({...N.spaces,enabled:e==="spaces",placeholderData:K});return e!=="spaces"?null:n.jsxs("div",{className:v("tw-transition-opacity",{"tw-opacity-50":o}),children:[!o&&!s&&n.jsx(f,{children:t("plugin-command-menu:commandMenu.spaceSearch.empty")}),s?n.jsx(f,{children:t("plugin-command-menu:commandMenu.spaceSearch.error")}):n.jsxs(y,{children:[o&&n.jsx(ke,{}),a==null?void 0:a.map(c=>n.jsx(Ie,{space:c},c.uuid))]})]})}function ze({thread:e}){const{setOpen:a}=p(),o=w.useMemo(()=>(e.title+e.first_answer).replace(/\s+/g,"").toLowerCase(),[e.title,e.first_answer]);return n.jsx(H,{asChild:!0,value:e.uuid,keywords:[o],className:"tw-flex tw-min-h-10 tw-justify-between tw-gap-4",onSelect:()=>{k("ctrl")?window.open(`/search/${e.slug}`,"_blank"):(I("spa-router:push",{url:`/search/${e.slug}`},"window"),a(!1))},children:n.jsxs("a",{href:`/search/${e.slug}`,className:"tw-flex tw-w-full tw-items-center tw-justify-between",children:[n.jsx("div",{className:"tw-flex-1",children:n.jsx("div",{className:"tw-line-clamp-1",children:e.title.slice(0,100)})}),n.jsx("div",{className:"tw-flex tw-flex-shrink-0 tw-items-center tw-gap-2",children:n.jsx("div",{className:"tw-flex-shrink-0 tw-text-xs tw-text-muted-foreground",children:F(e.last_query_datetime)})})]})},e.uuid)}function Ve(){const{filter:e,spacethreadFilterSlug:a,spacethreadTitle:o}=p(),{data:s,isLoading:c,isError:r}=L({...N.spaces._ctx.threads(a??""),enabled:e==="spaces-threads"&&!!a});return e!=="spaces-threads"?null:c?n.jsxs("div",{className:"tw-flex tw-animate-pulse tw-items-center tw-justify-center tw-gap-2 tw-p-4 tw-text-sm tw-text-muted-foreground",children:[n.jsx(T,{className:"tw-animate-spin"}),n.jsx("span",{children:t("plugin-command-menu:commandMenu.spaceSearch.spaceThreads.loading",{title:o})})]}):r?n.jsx(f,{children:t("plugin-command-menu:commandMenu.spaceSearch.spaceThreads.error")}):s&&!(s!=null&&s.length)?n.jsx(f,{children:t("plugin-command-menu:commandMenu.spaceSearch.spaceThreads.empty")}):n.jsx(y,{heading:t("plugin-command-menu:commandMenu.spaceSearch.spaceThreads.heading"),children:s==null?void 0:s.map(i=>n.jsx(ze,{thread:i},i.uuid))})}function Ee({searchValue:e}){return n.jsx(f,{children:e.length?t("plugin-command-menu:commandMenu.threadSearch.empty.withSearch"):n.jsx("span",{className:"tw-text-muted-foreground",children:t("plugin-command-menu:commandMenu.threadSearch.empty.withoutSearch")})})}function Pe(){return n.jsxs("div",{className:"tw-flex tw-animate-pulse tw-items-center tw-justify-center tw-gap-2 tw-p-4 tw-text-sm tw-text-muted-foreground",children:[n.jsx(T,{className:"tw-size-4 tw-animate-spin"}),n.jsx("span",{children:t("plugin-command-menu:commandMenu.threadSearch.loading")})]})}function Te({thread:e}){const{setFilter:a,setSearchValue:o,setSpacethreadFilterSlug:s,setSpacethreadTitle:c,inputRef:r}=p(),i=O(l=>l.value===e.slug);if(!e.collection)return null;const d=l=>{l.preventDefault(),l.stopPropagation(),e.collection&&(a("spaces-threads"),o(""),s(e.collection.slug),c(e.collection.title),setTimeout(()=>{var u;(u=r==null?void 0:r.current)==null||u.focus()},100))};return n.jsx(pe,{content:t("plugin-command-menu:commandMenu.threadSearch.spacePreview.tooltip"),children:n.jsx("div",{className:"tw-rounded-md tw-border tw-border-border/50 tw-bg-secondary tw-px-2 tw-py-1 tw-text-xs tw-outline-none focus:tw-outline-2 focus:tw-outline-primary focus-visible:tw-outline-2 focus-visible:tw-outline-primary",title:e.collection.title,tabIndex:i?0:-1,onClick:d,onKeyDown:l=>{l.key==="Enter"&&d(l)},children:n.jsx("div",{className:"tw-max-w-[100px] tw-truncate",children:e.collection.title})})})}function Ae({thread:e}){const{setOpen:a}=p();return n.jsx(H,{asChild:!0,value:e.slug,className:"tw-flex tw-h-10 tw-items-center tw-justify-between tw-gap-8 tw-font-medium",onSelect:()=>{if(k("ctrl"))return window.open(`/search/${e.slug}`,"_blank");I("spa-router:push",{url:`/search/${e.slug}`},"window"),a(!1)},children:n.jsxs("a",{href:`/search/${e.slug}`,className:"tw-flex tw-w-full tw-items-center tw-justify-between",children:[n.jsx("div",{className:"tw-flex-1",children:n.jsx("div",{className:"tw-line-clamp-1",title:e.title,children:e.title.slice(0,100)})}),n.jsxs("div",{className:"tw-flex tw-flex-shrink-0 tw-items-center tw-gap-2",children:[n.jsx(Te,{thread:e}),n.jsx("div",{className:"tw-flex-shrink-0 tw-text-xs tw-text-muted-foreground",children:F(e.last_query_datetime)})]})]})},e.slug)}function _e(){const{searchValue:e,filter:a}=p(),o=D(e,1e3),{data:s,isFetching:c,isLoading:r,isError:i}=L({...N.threadsSearch({searchValue:o,limit:o.length>0?5:void 0}),enabled:a==="threads",placeholderData:K,refetchOnWindowFocus:!1});return a!=="threads"?null:n.jsxs("div",{className:v("tw-transition-opacity",{"tw-opacity-50":c||r}),children:[!i&&!r&&n.jsx(Ee,{searchValue:e}),i?n.jsx(f,{children:t("plugin-command-menu:commandMenu.threadSearch.error")}):n.jsxs(y,{heading:s&&s.length>0?e?t("plugin-command-menu:commandMenu.threadSearch.heading.withSearch",{count:s.length}):t("plugin-command-menu:commandMenu.threadSearch.heading.withoutSearch"):"",children:[r&&n.jsx(Pe,{}),s==null?void 0:s.map(d=>n.jsx(Ae,{thread:d},d.slug))]})]})}const Fe=w.memo(e=>{const{action:a,onSelect:o,...s}=e,c=S("body").attr("data-cplx-zen-mode")==="true",r=e.type==="enable";return c!==r?n.jsx(z,{...s,onSelect:o||a}):null});function Oe(){const{pluginsEnableStates:e}=we.getCachedSync(),a=M.getCachedSync(),o=p(),[s,c]=w.useState(-1),[r,i]=w.useState([]),{open:d,setOpen:l,filter:u}=o,g=a.plugins.commandMenu.hotkey??[];P(C(g),m=>{m.stopImmediatePropagation(),l(!d)},{preventDefault:!0,enableOnContentEditable:!0,enableOnFormTags:!0},[g]),w.useEffect(()=>{i(m=>{if(m[s]===u)return m;const x=[...m.slice(0,s+1),u];return c(x.length-1),x})},[u,s]),P([C([j.Key.Alt,j.Key.ArrowLeft]),C([j.Key.Alt,j.Key.ArrowRight])],m=>{if(r.length<2)return;const x=m.key==="ArrowLeft"?Math.max(0,s-1):Math.min(r.length-1,s+1);x!==s&&(c(x),ce.setState({filter:r[x]}))},{enabled:d,preventDefault:!0,enableOnContentEditable:!0,enableOnFormTags:!0}),P(C([ie()==="mac"?j.Key.Meta:j.Key.Control,j.Key.Alt,"z"]),()=>{var x;const h=S("body").attr("data-cplx-zen-mode")==="true"?"false":"true";S("body").attr("data-cplx-zen-mode",h),(x=M.getCachedSync())!=null&&x.plugins.zenMode.persistent&&M.set(V=>{V.plugins.zenMode.lastState=h==="true"}),l(!1)},{enabled:e==null?void 0:e.zenMode,preventDefault:!0,enableOnContentEditable:!0,enableOnFormTags:!0})}function zn(){const{isLoggedIn:e}=de(),{open:a,setOpen:o,searchValue:s,setSearchValue:c,selectedValue:r,setSelectedValue:i,filter:d,setFilter:l,setInputRef:u}=p();Oe(),w.useEffect(()=>{if(s.startsWith("thread")&&(l("threads"),c(s.slice(6))),s.startsWith("space")){l("spaces"),c(s.slice(5));return}},[s,l,c]);const g=w.useRef(null);return w.useEffect(()=>{a&&u(g)},[a,u]),n.jsxs(ne,{open:a,preventScroll:!1,commandProps:{value:r,onValueChange:i,filter(m,h,x){const V=m+((x==null?void 0:x.join(""))??""),W=h.replace(/\s+/g,"").toLowerCase();return V.includes(W)?1:0},shouldFilter:d!=="threads"},onOpenChange:({open:m})=>o(m),children:[n.jsxs("div",{className:"tw-flex tw-items-center tw-border-b tw-border-border/50",children:[n.jsx(ve,{}),n.jsx(te,{ref:g,className:v("tw-grow tw-border-none",{"tw-font-medium":!s}),placeholder:d?b[d].searchPlaceholder:t("plugin-command-menu:commandMenu.input.placeholder"),searchIcon:!1,value:s,onValueChange:c,onKeyDown:m=>{m.key==="Backspace"&&s.length===0&&l(null)}})]}),n.jsxs(se,{children:[d&&(e?n.jsxs(n.Fragment,{children:[n.jsx(_e,{}),n.jsx(Le,{}),n.jsx(Ve,{})]}):n.jsx(f,{children:"Please sign in"})),!d&&n.jsxs(n.Fragment,{children:[n.jsx(f,{children:n.jsx(ge,{i18nKey:"plugin-command-menu:commandMenu.noResults",components:{emphasis:n.jsx(ae,{})},values:{code:s}})}),n.jsx(y,{heading:t("plugin-command-menu:commandMenu.groups.search"),children:$.map((m,h)=>n.jsx(Ce,{...m},h))}),n.jsx(E,{}),n.jsx(y,{heading:t("plugin-command-menu:commandMenu.groups.quickNavigations"),children:Z.map((m,h)=>n.jsx(be,{...m},h))}),n.jsx(E,{}),n.jsx(y,{heading:t("plugin-command-menu:commandMenu.groups.zenMode"),children:Me.map((m,h)=>n.jsx(Fe,{...m},h))}),n.jsx(E,{}),n.jsx(y,{heading:t("plugin-command-menu:commandMenu.groups.colorScheme"),children:R.map((m,h)=>n.jsx(Se,{...m},h))})]})]})]})}export{zn as default};
