import{a as S}from"./chunk-3TXHFKDN.js";var e={Tab:"	",LineBreak:`
`,Space:" ",ExclamationMark:"!",Hash:"#",Dollar:"$",Percent:"%",Asterisk:"*",Dash:"-",Bullet:"\u2022",Plus:"+",UnderScore:"_",BackTick:"`",Circumflex:"^",Tilde:"~",Dot:".",Pipe:"|",Equal:"=",Slash:"/",BackSlash:"\\",Colon:":",BlockQuote:">",OpeningAngleBracket:"<",closeingAngleBracket:">",OpeningParenthesis:"(",ClosingParenthesis:")",OpeningSqrBracket:"[",ClosingSqrBracket:"]",openingCurlyBracket:"{",closingCurlyBracket:"}"},c=new Set(["*","_","~","=","`","$","[","]","(",")"]),C=new Set(["#","-","+",">"]),g=new Set([...c,...C,"!",`
`,"<","%","\\"]),B=new Set([e.Pipe,e.Space,e.Dash]),d={FrontMatter:"---",Fence:"```",Math:"$$",CommentEnd:"-->"},r={BeforeNewLine:"BeforeNewLine",BeforeHeading:"BeforeHeading",BeforeUnorderedList:"BeforeUnorderedList",BeforeOrderedList:"BeforeOrderedList",BeforeFenceBlock:"BeforeFenceBlock",InFenceBlock:"InFenceBlock",BeforeMathBlock:"BeforeMathBlock",InMathBlock:"InMathBlock",BeforeEmbedLink:"BeforeEmbedLink",BeforeLinkUrl:"BeforeLinkUrl",InEmbedLink:"InEmbedLink",InLinkUrl:"InLinkUrl",InFootNote:"InFootNote"},L={"(":")","[":"]"},b={"# ":"h1","## ":"h2","### ":"h3","#### ":"h4","##### ":"h5","###### ":"h6","---":"hr","- ":"li","+ ":"li","* ":"li",">":"blockquote"},E={"*":"em",_:"em","**":"b","***":"b","==":"mark","~~":"del","~":"code"},l=class extends HTMLSpanElement{constructor(t=" "){super(),this.appendChild(new Text(t))}};customElements.define("text-span",l,{extends:"span"});var k=class{constructor(){}on(t,i){this[t]={cb:i}}once(t,i){this[t]={cb:i,once:!0}}emit(t,...i){this[t]?.cb(...i),this[t]?.once&&delete this[t]}};var u=class extends k{inlineCode=0;index=1;sectionStart=0;state=r.BeforeNewLine;constructor(){super()}skipUptoSequence(t){let i=t.length,s=[];for(;++this.index<this.size;){let n=s.length;if(i===n)break;let a=this.buffer[this.index];t[n]===a?s.push(a):s.length=0}}skipUntilMarker(){for(;c.has(this.buffer[++this.index])&&!(this.index===this.size||this.buffer[this.index]===e.LineBreak););}skipWhitespace(){for(;this.buffer[++this.index]==e.Space&&!(this.index===this.size||this.buffer[this.index]===e.LineBreak););return this.buffer[this.index]}fastForwardTo(t){if(this.buffer[this.index]===t)return!0;for(;this.buffer[++this.index]!==t;)if(this.index===this.size||this.buffer[this.index]===e.LineBreak)return;return!0}sendSpanText(){let t=this.buffer.slice(this.sectionStart,this.index);t&&this.emit("spantext",t),this.sectionStart=this.index}sendTextData(){let t=this.buffer.slice(this.sectionStart,this.index);t&&this.emit("text",t),this.sectionStart=this.index}stateInTableBody(){for(this.emit("addtablerow"),this.sectionStart=++this.index;this.buffer[++this.index]!==e.LineBreak;){let t=this.buffer[this.index];if(t===e.Pipe){let i=this.buffer.slice(this.sectionStart+1,this.index);this.emit("addtablecell",i),this.sectionStart=this.index}if(!t)break}this.sectionStart=this.index,this.buffer[this.index+1]===e.Pipe?this.stateInTableBody():--this.index}verifyTableSyntax(t){console.log("Table syntax is verifying");let i=this.index,s=[{start:i+1}],n=1;for(;this.buffer[++i]!==e.LineBreak;)t=this.buffer[i],t===e.Pipe&&(s[n-1].end=i,n++,s.push({start:i+1}));if(s[n-1].end??=i,++i,t=this.buffer[i],t===e.Pipe){for(n--;this.buffer[++i]!==e.LineBreak;)t=this.buffer[i],B.has(t)&&t===e.Pipe&&n--;if(n===0){let a=s.map(o=>this.buffer.slice(o.start,o.end));this.emit("table",a),this.sectionStart=this.index=++i,this.buffer[this.index]===e.Pipe&&this.stateInTableBody()}++this.index}}stateInHashTag(){this.fastForwardTo(e.Space);let t=this.buffer.slice(this.sectionStart,this.index);this.sectionStart=this.index,this.emit("hashTag",t)}stateBeforeHeading(){if(this.state=r.BeforeHeading,!this.fastForwardTo(e.Space))return this.marker=this.buffer.slice(this.sectionStart,this.index);let i=this.buffer.slice(this.sectionStart,this.index+1);this.emit("startmarker",(this.marker??"")+i),this.marker="",this.state=null,this.sectionStart=this.index}stateBeforeHashTag(t){t===e.Hash||t===e.Space?this.stateBeforeHeading():this.stateInHashTag()}stateBeforeUnorderedList(t){if(this.state=r.BeforeUnorderedList,!!t){if(t===e.Space){if(this.buffer[++this.index]===e.OpeningSqrBracket){let s=this.buffer[++this.index]==="x";if(this.buffer[++this.index]!==e.ClosingSqrBracket||this.buffer[++this.index]!==e.Space)return;++this.index}let i=this.buffer.slice(this.sectionStart,this.index);this.emit("startmarker",i===" "?"- ":i),this.sectionStart=this.index,this.state=null}else if(t===e.Dash&&this.buffer[++this.index]===e.Dash){if(this.buffer[this.index+1]!==e.LineBreak)return;this.emit("startmarker",this.buffer.slice(this.sectionStart,++this.index))}}}stateBeforeOrderedList(t){if(this.state=r.BeforeOrderedList,!!t&&(t===e.Dot&&(t=this.buffer[++this.index]),t===e.Space)){let i=this.buffer.slice(this.sectionStart,this.index);this.emit("startmarker",+i[0]?i:`${this.listCounter}. `),this.state=null,this.sectionStart=this.index}}stateInFenceBlock(){this.skipUptoSequence(d.Fence);let t=this.buffer.slice(this.sectionStart,this.index),i=t.endsWith(d.Fence);this.emit("fenceblock",i?t.slice(0,-3):t,i),i&&(this.state=null,this.sectionStart=this.index)}stateBeforeFenceBlock(){this.state=r.BeforeFenceBlock,this.buffer[this.index+1]&&this.buffer[++this.index]===e.BackTick&&this.buffer[++this.index]===e.BackTick&&(this.state=r.InFenceBlock,this.sectionStart=this.index+2,this.stateInFenceBlock())}stateInMathBlock(){this.skipUptoSequence(d.Math);let t=this.buffer.slice(this.sectionStart,this.index),i=t.endsWith(d.Math);this.emit("mathblock",i?t.slice(0,-3):t,i),i&&(this.state=null,this.sectionStart=this.index)}stateBeforeMathBlock(){this.state=r.BeforeMathBlock,this.buffer[this.index+1]&&this.buffer[++this.index]===e.Dollar&&this.buffer[++this.index]===e.LineBreak&&(this.state=r.InMathBlock,this.sectionStart=++this.index,this.stateInMathBlock())}stateInFootnote(){if(this.state=r.InFootnote,!!this.buffer[this.index+1]&&(this.fastForwardTo(e.ClosingSqrBracket),this.buffer[++this.index]===e.Colon)){let t=this.buffer.slice(this.sectionStart+2,this.index-1);this.emit("startmarker",`[^${t}]: `),this.sectionStart=++this.index}}blockMarkers={[e.Hash]:()=>this.stateBeforeHashTag(this.buffer[++this.index]),[e.BlockQuote]:()=>(this.emit("startmarker",">"),++this.index),[e.Dash]:()=>this.stateBeforeUnorderedList(this.buffer[++this.index]),[e.Plus]:()=>this.stateBeforeUnorderedList(this.buffer[++this.index]),[e.Bullet]:()=>this.stateBeforeUnorderedList(this.buffer[++this.index]),[e.Asterisk]:()=>this.buffer[this.index+1]===e.Asterisk?this.stateInlineMarker():this.stateBeforeUnorderedList(this.buffer[++this.index]),[e.Pipe]:()=>this.verifyTableSyntax(this.buffer[this.index]),[e.LineBreak]:()=>this.buffer[++this.index]&&this.stateBeforeNewLine(this.buffer[this.index]),[e.OpeningAngleBracket]:()=>this.stateInHtml(!0),[e.BackTick]:()=>this.stateBeforeFenceBlock(),[e.Dollar]:()=>this.stateBeforeMathBlock(),[e.Tab]:()=>(this.emit("indent"),this.stateBeforeNewLine(this.buffer[++this.index])),[e.Colon]:()=>this.buffer[++this.index]===e.Space&&this.emit("startmarker",": "),[e.OpeningSqrBracket]:()=>this.buffer[++this.index]===e.Circumflex?this.stateInFootnote():this.buffer[this.index]===e.OpeningSqrBracket?this.stateInWikiLink():this.stateBeforeLinkUrl()};stateBeforeNewLine(t){if(this.state=null,this.sectionStart=this.index,t===e.Space){t===e.Space&&(t=this.skipWhitespace());let i=this.index-this.sectionStart;if(i>=3)for(let s=0;s<Math.floor(i/3);s++)this.emit("indent");this.buffer[this.index+1]??(this.state=r.BeforeNewLine),this.sectionStart=this.index}if(this.blockMarkers[t])this.blockMarkers[t](),this.sectionStart=this.index;else if(this.markers[t])this.markers[t](),this.sectionStart=this.index;else if(+t){if(this.buffer[++this.index]&&this.buffer[this.index]!==e.Dot)return;this.listCounter=+t,this.stateBeforeOrderedList(this.buffer[++this.index])}}markers={[e.LineBreak]:()=>{this.sendTextData(),this.emit("newline"),this.buffer[++this.index]===e.LineBreak&&(this.emit("newline"),++this.index);let t=this.buffer[this.index];t?this.stateBeforeNewLine(t):this.state=r.BeforeNewLine},[e.Hash]:()=>{this.buffer[this.index+1]!==e.Space&&(this.sendTextData(),this.stateInHashTag())},[e.OpeningAngleBracket]:()=>(this.sendTextData(),this.stateInHtml()),[e.ExclamationMark]:()=>{this.buffer[this.index+1]===e.OpeningSqrBracket&&(this.sendTextData(),this.index=this.index+2,this.stateBeforeEmbedLink())},[e.OpeningSqrBracket]:()=>{this.sendTextData(),this.buffer[this.index+1]===e.Circumflex?this.stateInFootNoteRef():this.buffer[this.index+1]===e.OpeningSqrBracket?this.stateInWikiLink():this.stateBeforeLinkUrl()},[e.Percent]:()=>{this.buffer[this.index+1]===e.Percent&&(this.sendTextData(),this.stateInObsidianComment())},[e.BackSlash]:()=>(this.sendTextData(),this.sectionStart=++this.index)};cursorStates={[r.BeforeUnorderedList]:this.stateBeforeUnorderedList.bind(this),[r.BeforeNewLine]:this.stateBeforeNewLine.bind(this),[r.BeforeHeading]:this.stateBeforeHeading.bind(this),[r.BeforeOrderedList]:this.stateBeforeOrderedList.bind(this),[r.InFenceBlock]:this.stateInFenceBlock.bind(this),[r.InMathBlock]:this.stateInMathBlock.bind(this),[r.BeforeLinkUrl]:this.stateBeforeLinkUrl.bind(this),[r.BeforeEmbedLink]:this.stateBeforeEmbedLink.bind(this),[r.InEmbedLink]:this.stateInEmbedLink.bind(this),[r.InLinkUrl]:this.stateInLinkUrl.bind(this)};consume(t){this.buffer=t,this.size=this.buffer.length,this.index=this.sectionStart=0;try{for(this.state&&this.cursorStates[this.state]?.(this.buffer[this.index]),--this.index;++this.index<this.size;){let i=this.buffer[this.index];g.has(i)&&(this.markers[i]?this.markers[i]():c.has(i)&&this.stateInlineMarker())}this.state??this.sendSpanText(),this.emit("finish")}catch(i){console.error(i),this.emit("error",i.message)}}stateInlineMarker(){if(c.has(this.buffer.slice(this.sectionStart,this.index))||this.sendSpanText(),this.buffer[this.index]===e.OpeningSqrBracket)return this.stateBeforeLinkUrl();c.has(this.buffer[++this.index])&&this.skipUntilMarker();let t=this.buffer.slice(this.sectionStart,this.index);this.emit("twinmarker",t),this.sectionStart=this.index,this.buffer[this.index]===e.LineBreak&&this.markers[e.LineBreak]()}stateBeforeLinkUrl(){if(this.link??={title:"",url:""},this.buffer[this.index]===e.ExclamationMark&&this.buffer[++this.index]===e.OpeningSqrBracket){if(this.sectionStart=this.index,this.fastForwardTo(e.ClosingSqrBracket),this.link.imgAlt=this.buffer.slice(this.sectionStart+1,this.index),this.buffer[++this.index]===e.OpeningParenthesis){if(this.sectionStart=this.index,this.state=r.InLinkUrl,!this.fastForwardTo(e.ClosingParenthesis))return this.link.imgUrl=this.buffer.slice(this.sectionStart+2,this.index);if(this.link.imgUrl=this.buffer.slice(this.sectionStart+1,this.index),this.sectionStart=this.index,this.buffer[++this.index]!==e.ClosingSqrBracket)return}}else{this.buffer[this.index]===e.OpeningSqrBracket&&++this.index,this.sectionStart=this.index;let t=this.fastForwardTo(e.ClosingSqrBracket);if(this.link.title+=this.buffer.slice(this.sectionStart,t?this.index:this.index+1),this.state=r.BeforeLinkUrl,!t)return}this.buffer[++this.index]===e.OpeningParenthesis?(this.state=r.InLinkUrl,this.sectionStart=++this.index,this.stateInLinkUrl()):(this.state=null,this.sectionStart--,this.sendTextData())}stateInLinkUrl(){if(!this.fastForwardTo(e.ClosingParenthesis))return this.link.url+=this.buffer.slice(this.sectionStart,this.index);this.link.url+=this.buffer.slice(this.sectionStart,this.index),this.emit("linkurl",this.link.url,this.link.imgUrl?this.link:this.link.title),this.link=null,this.state=null,this.sectionStart=++this.index}stateInFootNoteRef(){this.fastForwardTo(e.ClosingSqrBracket);let t=this.buffer.slice(this.sectionStart+2,this.index);this.emit("footnoteref",t),this.sectionStart=++this.index}stateInWikiLink(){this.fastForwardTo(e.ClosingSqrBracket);let t=this.buffer.slice(this.sectionStart+2,this.index);this.buffer[++this.index]===e.ClosingSqrBracket&&(this.emit("wikilink",t),this.sectionStart=++this.index)}stateBeforeEmbedLink(){this.link??={title:"",url:""},this.sectionStart=this.index,this.state=r.BeforeEmbedLink;let t=this.fastForwardTo(e.ClosingSqrBracket);if(this.link.title+=this.buffer.slice(this.sectionStart,this.index),!!t&&this.buffer[++this.index]===e.OpeningParenthesis){if(this.state=r.InEmbedLink,this.sectionStart=this.index,!this.fastForwardTo(e.ClosingParenthesis))return this.link.url+=this.buffer.slice(this.sectionStart+1,this.index);this.stateInEmbedLink()}}stateInEmbedLink(){if(!this.fastForwardTo(e.ClosingParenthesis))return this.link.url+=this.buffer.slice(this.sectionStart,this.index);this.link.url+=this.buffer.slice(this.sectionStart+1,this.index),this.emit("image",this.link.url,this.link.title,!0),this.link=null,this.state=null,this.sectionStart=++this.index}stateInHtml(t){if(this.buffer[++this.index]===e.ExclamationMark)return this.skipComment();let i=[1];for(;++this.index<this.size;)if(this.buffer[this.index]===e.OpeningAngleBracket&&(this.buffer[++this.index]===e.Slash?i.pop():i.push(1),this.fastForwardTo(e.ClosingSqrBracket)),i.length===0){let n=this.buffer.slice(this.sectionStart,this.index);this.emit("inserthtml",n,t&&this.buffer[this.index]===e.LineBreak),this.sectionStart=this.index,this.buffer[this.index]===e.LineBreak&&--this.index;break}}skipComment(){this.index=this.index+3,this.sectionStart=this.index,this.skipUptoSequence(d.CommentEnd);let t=this.buffer.slice(this.sectionStart,this.index-3);this.emit("insertcomment",t),this.sectionStart=this.index}stateInObsidianComment(){this.index=this.index+2,this.sectionStart=this.index,this.skipUptoSequence("%%");let t=this.buffer.slice(this.sectionStart,this.index-2);this.emit("obsidiancomment",t),this.sectionStart=this.index}reset(){this.inlineCode=0,this.index=0,this.sectionStart=0}};var m=class{constructor(){this.inlineMarkerStack=[],this.blockElemStack=[],this.tokenizer=new u,this.nestLayer=0,this.setListener()}async*parseStream(t){let i=t.getReader();try{for(;;){let{done:s,value:n}=await i.read();if(s)break;this.contentFrag=new DocumentFragment,this.blockElemStack.length===0&&(this.currentLine=[]),this.blockElemStack.splice(0,1,this.contentFrag),this.tokenizer.consume(n),yield this.contentFrag}}catch(s){console.error(s)}finally{i.releaseLock()}}insertFrontMatter(t){}insertNewLine(){this.blockElemStack.at(-1).tagName?.startsWith("H")&&this.blockElemStack.pop(),(this.blockElemStack.at(-1).tagName==="P"||this.currentLine.length===0)&&this.blockElemStack.pop(),this.currentLine.length===0&&this.blockElemStack.length>1&&this.blockElemStack.pop(),this.currentLine.length=0,this.inlineMarkerStack.length=0}insertIndent(){this.nestLayer++}insertStartMarker(t){let i=b[t]?b[t]:+t[0]?"li":"p";if(this.blockElemStack.at(-1)?.tagName==="BLOCKQUOTE")return this.currentLine.push(this.blockElemStack.at(-1));let s=document.createElement(i);if(i[0]==="h")this.blockElemStack.splice(1);else if(i==="li"){let a=(this.blockElemStack.at(-1).nestLayer??0)-this.nestLayer;if(a>0)for(;a--;)this.blockElemStack.pop();let o=this.blockElemStack.at(-1);if(o.tagName!=="UL"&&o.tagName!=="OL"){let T=+t[0]?"ol":"ul",x=document.createElement(T);this.blockElemStack.at(-1).appendChild(x),this.blockElemStack.push(x)}s.nestLayer=this.blockElemStack.length-1,this.nestLayer=0}this.blockElemStack.at(-1).appendChild(s),this.blockElemStack.push(s);let n=new l("");s.appendChild(n),this.currentLine.push(n)}insertParagraph(){let t;return this.blockElemStack.at(-1).tagName==="P"?t=this.blockElemStack.at(-1):(this.blockElemStack.length>1&&this.blockElemStack.pop(),t=document.createElement("P"),this.blockElemStack.at(-1).appendChild(t),this.blockElemStack.push(t)),t}insertText(t){if(this.currentLine.length===0){let i=this.insertParagraph(),s=new l(t);i.appendChild(s),this.currentLine.push(s)}else this.currentLine.at(-1).nodeType===1&&this.currentLine.at(-1).appendChild(new Text(t))}insertTwinMarker(t){let i=this.inlineMarkerStack.at(-1)?.marker;if(i===t||L[i]===t)this.inlineMarkerStack.pop(),this.currentLine.pop();else{this.currentLine.length===0&&this.currentLine.push(this.insertParagraph());let s=E[t],n=document.createElement(s);n.marker=t,this.inlineMarkerStack.length===0?this.currentLine.at(-1).appendChild(n):this.inlineMarkerStack.at(-1).appendChild(n),this.inlineMarkerStack.push(n),this.currentLine.push(n)}}insertHashTag(t){let i=document.createElement("span");i.className="hashtag",i.appendChild(new Text(t)),this.currentLine.length===0?this.insertParagraph().appendChild(i):this.currentLine.at(-1).appendChild(i)}insertLink(t,i){let s=document.createElement("a");s.href=t,typeof i=="string"?s.textContent=i:s.appendChild(this.insertImg(i.imgUrl,i.imgAlt)),this.currentLine.length===0?this.insertParagraph().appendChild(s):this.currentLine.at(-1).appendChild(s)}insertImg(t,i){let s=new Image;return s.src=t,s.alt=i,this.currentLine.length===0?this.insertParagraph().appendChild(s):this.currentLine.at(-1).appendChild(s),s}insertWikiLink(t){}insertfootNoteRef(t){}insertFenceBlock(t,i){this.blockElemStack.length>1&&this.blockElemStack.pop(),this.openBlock?(this.openBlock.appendChild(new Text(t)),i&&(this.openBlock=null)):(this.openBlock=document.createElement("pre"),this.openBlock.appendChild(new Text(t)),this.contentFrag.appendChild(this.openBlock))}insertMathBlock(t,i){}insertTable(t){this.blockElemStack.length>1&&this.blockElemStack.pop();let i=document.createElement("table"),n=i.createTHead().insertRow();for(let a of t)n.insertCell().appendChild(new Text(a));this.openTableBody=i.createTBody(),this.contentFrag.appendChild(i)}insertTableRow(){this.openTableBody.insertRow()}insertTableCell(t){this.openTableBody.lastElementChild.insertCell().appendChild(new Text(t))}insertHTML(t,i){}insertComment(t){}insertObsidianComment(t){}setListener(){this.tokenizer.on("frontmatter",this.insertFrontMatter.bind(this)),this.tokenizer.on("newline",this.insertNewLine.bind(this)),this.tokenizer.on("indent",this.insertIndent.bind(this)),this.tokenizer.on("startmarker",this.insertStartMarker.bind(this)),this.tokenizer.on("text",this.insertText.bind(this)),this.tokenizer.on("spantext",this.insertText.bind(this)),this.tokenizer.on("twinmarker",this.insertTwinMarker.bind(this)),this.tokenizer.on("hashTag",this.insertHashTag.bind(this)),this.tokenizer.on("linkurl",this.insertLink.bind(this)),this.tokenizer.on("image",this.insertImg.bind(this)),this.tokenizer.on("wikilink",this.insertWikiLink.bind(this)),this.tokenizer.on("footnoteref",this.insertfootNoteRef.bind(this)),this.tokenizer.on("fenceblock",this.insertFenceBlock.bind(this)),this.tokenizer.on("mathblock",this.insertMathBlock.bind(this)),this.tokenizer.on("table",this.insertTable.bind(this)),this.tokenizer.on("addtablerow",this.insertTableRow.bind(this)),this.tokenizer.on("addtablecell",this.insertTableCell.bind(this)),this.tokenizer.on("inserthtml",this.insertHTML.bind(this)),this.tokenizer.on("insertcomment",this.insertComment.bind(this)),this.tokenizer.on("obsidiancomment",this.insertObsidianComment.bind(this))}};var f=class extends HTMLElement{constructor(t){super(),this.error=t}render(){let t=this.error.replaceAll("{",`{
	`).replaceAll("}",`
}`).replaceAll(",",`,
	`);return`<h1>${chrome.i18n.getMessage("something_went_wrong")}</h1>
			<p style="text-align: start;white-space-collapse: preserve;">${t}</p>
			<button>Okay</button>`}connectedCallback(){this.setAttribute("popover",""),this.className="alert-dialog",this.innerHTML=this.render(),this.showPopover(),this.lastElementChild.addEventListener("click",()=>this.remove())}};customElements.define("response-error-dialog",f);var M=S({"./ChatGPT/ChatGPTAiBot.js":()=>import("./ChatGPTAiBot-LAKHKS5L.js"),"./ChatGPT/json-parser2.js":()=>import("./json-parser2-7VC6NU4B.js"),"./ChatGPT/sha3-worker.js":()=>import("./sha3-worker-REHFHZ7A.js"),"./ChatGPT/token.js":()=>import("./token-RPRXJJ4M.js"),"./ChatGPT/util.js":()=>import("./util-WENVCLEI.js")});globalThis.getStore=chrome.storage.local.get.bind(chrome.storage.local);globalThis.setStore=chrome.storage.local.set.bind(chrome.storage.local);var p=class{constructor(){}async startChatBot(t){let i=t+"AiBot",{[i]:s}=await M(`./${t}/${i}.js`);return new s}async summarize(t,i){let s=document.body;s.replaceChildren();try{this[t]??=await this.startChatBot(t);let n=await this[t].streamSummary(i);if(!n)return;let a=new m;for await(let o of a.parseStream(n))s.appendChild(o)}catch(n){console.error(n),document.body.append(new f(n.message))}}},w={summary:chrome.i18n.getMessage("summarize_following_content_in_bullet_points"),mindMap:chrome.i18n.getMessage("create_mindmap_of_following_content"),highlight:chrome.i18n.getMessage("show_highlight_of_following_content_in_bullet_points")};onmessage=async h=>{if(Array.isArray(h.data)){if(w[h.data[0]]!==void 0){let[t,i]=h.data,s=new p,n=`${w[t]}:
${i}`;await s.summarize("ChatGPT",n)}else if(h.data[0]==="clipArticle"){let t=await chrome.runtime.sendMessage({htmlContent:document.body.innerHTML,sectionId:h.data[1],pageTitle:h.data[2]});if(t.errCaused)return alert(t.errCaused)}}};export{p as AiSummarizer};
