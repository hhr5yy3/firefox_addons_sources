(()=>{"use strict";var e,i={1642:(e,i,t)=>{var a=t(7416),s=t(1128),n=t(2024),o=t(822),r=t(4526);const g={class:"preview-images"},l=["data-index"],m={class:"image-container"},d=["srcset"],c=["src","data-index","alt"],h={key:0,class:"image-details"},u={class:"image-dimension-icon-container"},v=(0,o.Lk)("div",{class:"image-data-separator"},"•",-1),p={key:0,class:"image-data-separator"};t(9849),t(9558),t(1167),t(6831);var w=t(4390),f=t(9329),I=t(8618);const b={components:{[f.qw.name]:f.qw,[f.$n.name]:f.$n,[f.Zp.name]:f.Zp,[f.w.name]:f.w,[f.c5.name]:f.c5,[f.ZB.name]:f.ZB,[f.lG.name]:f.lG,[f.cG.name]:f.cG,[f.In.name]:f.In},data:function(){return{showDialog:!1,hasScrollBar:!1,previewImages:[],imagesLoaded:!1,largestImageWidth:0,largestImageHeight:0,largestImageDimension:0,largestImageIndex:null,minWidthViewport:!1,theme:""}},computed:{separatorClasses:function(){return{visible:this.hasScrollBar}}},rawData:{session:null},methods:{getText:I.q4,processMessage:async function(e,i){"openView"===e.id?(this.setup(e.session,e.images),this.openDialog()):"closeView"===e.id&&this.closeDialog()},onMessage:function(e,i){(0,s.Hf)({request:e,sender:i,requestHandler:this.processMessage})},onCancel:function(){this.closeDialog(),browser.runtime.sendMessage({id:"cancelView",view:"confirm"})},onSelection:async function(e){this.closeDialog();const i=this.previewImages[e.currentTarget.dataset.index].image;"share"===this.$options.rawData.session.sessionType?(await(0,s.pW)(i,{convert:this.$options.rawData.session.options.convertSharedImage}),browser.runtime.sendMessage({id:"cancelView",view:"confirm"})):await(0,s.NI)({message:{id:"imageConfirmationSubmit",image:i,session:this.$options.rawData.session},openConnection:this.$env.isSafari})},onPreviewImageLoad:function(e){this.setPreviewImageLoaded(e.target.dataset.index)},onPreviewImageError:function(e){const i=e.target.previousElementSibling;i.srcset=e.target.src,i.type="image/svg+xml",this.setPreviewImageLoaded(e.target.dataset.index)},setPreviewImageLoaded:function(e){this.previewImages[e].imageLoaded=!0,this.setImagesLoaded()},setImagesLoaded:function(){this.previewImages.every((e=>e.imageLoaded))&&!this.imagesLoaded&&(this.setImageDetails(),this.focusPreviewImage(),this.imagesLoaded=!0)},setImageDetails:function(){for(const e of document.querySelectorAll(".preview-images .image")){const i=e.dataset.index,t=this.previewImages[i];(0,s.uH)(e)&&(t.imageWidth=e.naturalWidth,t.imageHeight=e.naturalHeight,t.imageDimension=t.imageWidth*t.imageHeight,t.imageDimension>this.largestImageDimension&&(this.largestImageDimension=t.imageDimension,this.largestImageIndex=i),t.imageWidth>this.largestImageWidth&&(this.largestImageWidth=t.imageWidth),t.imageHeight>this.largestImageHeight&&(this.largestImageHeight=t.imageHeight)),t.imageDetails=(0,s.Oe)({width:t.imageWidth,height:t.imageHeight,size:t.image.imageSize,type:t.image.imageType,iecSize:!this.$env.isWindows})}},filterImageDetails:function(e){return e.filter((e=>!("size"===e.kind&&!this.minWidthViewport)))},addPreviewImages:function(e){this.previewImages=e.map((e=>({image:(0,w.IG)(e),imageWidth:0,imageHeight:0,imageDimension:0,imageLoaded:!1,imageDetails:[]})))},focusPreviewImage:function(){const e=document.querySelector(null!==this.largestImageIndex?`.tile-container[data-index="${this.largestImageIndex}"]`:".tile-container");window.setTimeout((()=>e.focus()),300)},openDialog:function(){this.showDialog=!0},closeDialog:function(){this.showDialog=!1},initResizeObservers:function(){const e=window.matchMedia("(min-width: 400px)");e.addEventListener("change",this.setMinWidthViewport),this.setMinWidthViewport(e);const i=new ResizeObserver(this.configureScrollBar),t=document.querySelector(".preview-images");i.observe(t),i.observe(t.parentNode),this.configureScrollBar()},setMinWidthViewport:function(e){this.minWidthViewport=e.matches},configureScrollBar:function(){const e=document.querySelector(".preview-images").parentNode;this.hasScrollBar=e.scrollHeight>e.clientHeight},setup:function(e,i){this.previewImages=[],this.imagesLoaded=!1,this.largestImageWidth=0,this.largestImageHeight=0,this.largestImageDimension=0,this.largestImageIndex=null,this.$options.rawData.session=e,this.$nextTick((()=>{this.addPreviewImages(i)}))},init:async function(){if(this.$env.isFirefox)browser.runtime.onMessage.addListener(this.onMessage),browser.runtime.sendMessage({id:"routeMessage",setSenderFrameId:!0,messageFrameId:0,message:{id:"saveFrameId"}});else if(this.$env.isSafari)window.addEventListener("message",(async e=>{const i=e.data;if((0,s.GZ)(i)){const e=await browser.runtime.sendMessage({id:"storageRequest",asyncResponse:!0,saveReceipt:!0,storageId:i});e&&this.processMessage(e)}})),browser.runtime.sendMessage({id:"routeMessage",setSenderFrameId:!0,messageFrameId:0,message:{id:"saveFrameId"}});else{const e=await browser.tabs.getCurrent();this.contentMessagePort=browser.tabs.connect(e.id,{name:"view",frameId:0}),this.contentMessagePort.onMessage.addListener(this.onMessage)}this.theme=await(0,s.xB)(),document.addEventListener("themeChange",(e=>{this.theme=e.detail})),window.addEventListener("keydown",(e=>{"Escape"===e.key&&(e.preventDefault(),e.stopImmediatePropagation(),this.onCancel())}),{capture:!0,passive:!1}),this.initResizeObservers()}},mounted:function(){this.init()}},y=(0,t(1535).A)(b,[["render",function(e,i,t,s,n,w){const f=(0,o.g2)("vn-card-title"),I=(0,o.g2)("vn-divider"),b=(0,o.g2)("vn-icon"),y=(0,o.g2)("vn-card-text"),W=(0,o.g2)("vn-button"),D=(0,o.g2)("vn-card-actions"),k=(0,o.g2)("vn-card"),x=(0,o.g2)("vn-dialog"),S=(0,o.g2)("vn-app");return(0,o.uX)(),(0,o.Wv)(S,null,{default:(0,o.k6)((()=>[(0,o.bF)(x,{modelValue:e.showDialog,"onUpdate:modelValue":i[4]||(i[4]=i=>e.showDialog=i),"content-class":"confirmation-dialog__content",transition:"scale-transition",scrollable:"",persistent:""},{default:(0,o.k6)((()=>[(0,o.bF)(k,null,{default:(0,o.k6)((()=>[(0,o.bF)(f,null,{default:(0,o.k6)((()=>[(0,o.eW)((0,r.toDisplayString)(w.getText("dialogTitle_imageConfirmation")),1)])),_:1}),(0,o.eW)(),(0,o.bF)(I,{class:(0,r.normalizeClass)(w.separatorClasses)},null,8,["class"]),(0,o.eW)(),(0,o.bF)(y,{tabindex:"-1"},{default:(0,o.k6)((()=>[(0,o.Lk)("div",g,[((0,o.uX)(!0),(0,o.CE)(o.FK,null,(0,o.pI)(e.previewImages,((t,s)=>((0,o.uX)(),(0,o.CE)("div",{class:"tile-container",tabindex:"0","data-index":s,onClick:i[2]||(i[2]=(...e)=>w.onSelection&&w.onSelection(...e)),onKeyup:i[3]||(i[3]=(0,a.withKeys)(((...e)=>w.onSelection&&w.onSelection(...e)),["enter"])),key:s},[(0,o.Lk)("picture",m,[(0,o.Lk)("source",{srcset:t.image.imageDataUrl||t.image.imageUrl},null,8,d),(0,o.eW)(),(0,o.Lk)("img",{class:"image",src:`/src/assets/icons/misc/${"dark"===e.theme?"broken-image-dark":"broken-image"}.svg`,"data-index":s,onErrorOnce:i[0]||(i[0]=(...e)=>w.onPreviewImageError&&w.onPreviewImageError(...e)),onLoad:i[1]||(i[1]=(...e)=>w.onPreviewImageLoad&&w.onPreviewImageLoad(...e)),alt:t.image.imageFilename},null,40,c)]),(0,o.eW)(),e.imagesLoaded?((0,o.uX)(),(0,o.CE)("div",h,[!e.largestImageDimension||t.imageWidth!==e.largestImageWidth&&t.imageHeight!==e.largestImageHeight&&t.imageDimension!==e.largestImageDimension?(0,o.Q3)("",!0):((0,o.uX)(),(0,o.CE)(o.FK,{key:0},[(0,o.Lk)("div",u,[t.imageWidth===e.largestImageWidth&&t.imageHeight<e.largestImageHeight?((0,o.uX)(),(0,o.Wv)(b,{key:0,class:"image-dimension-icon",src:"/src/assets/icons/misc/swap-horiz.svg",title:w.getText("pageContent_widest_image")},null,8,["title"])):(0,o.Q3)("",!0),(0,o.eW)(),t.imageHeight===e.largestImageHeight&&t.imageWidth<e.largestImageWidth?((0,o.uX)(),(0,o.Wv)(b,{key:1,class:"image-dimension-icon",src:"/src/assets/icons/misc/swap-vert.svg",title:w.getText("pageContent_tallest_image")},null,8,["title"])):(0,o.Q3)("",!0),(0,o.eW)(),t.imageDimension===e.largestImageDimension?((0,o.uX)(),(0,o.Wv)(b,{key:2,class:"image-dimension-icon",src:"/src/assets/icons/misc/open-with.svg",title:w.getText("pageContent_largest_image")},null,8,["title"])):(0,o.Q3)("",!0)]),(0,o.eW)(),v],64)),(0,o.eW)(),((0,o.uX)(!0),(0,o.CE)(o.FK,null,(0,o.pI)(w.filterImageDetails(t.imageDetails),((e,i)=>((0,o.uX)(),(0,o.CE)(o.FK,{key:i},[i?((0,o.uX)(),(0,o.CE)("div",p,"•")):(0,o.Q3)("",!0),(0,o.eW)(),(0,o.Lk)("div",{class:(0,r.normalizeClass)({[`image-${e.kind}-text`]:!0})},(0,r.toDisplayString)(e.text),3)],64)))),128))])):(0,o.Q3)("",!0)],40,l)))),128))])])),_:1}),(0,o.eW)(),(0,o.bF)(I,{class:(0,r.normalizeClass)(w.separatorClasses)},null,8,["class"]),(0,o.eW)(),(0,o.bF)(D,null,{default:(0,o.k6)((()=>[(0,o.bF)(W,{onClick:w.onCancel,variant:"tonal"},{default:(0,o.k6)((()=>[(0,o.eW)((0,r.toDisplayString)(w.getText("buttonLabel_cancel")),1)])),_:1},8,["onClick"])])),_:1})])),_:1})])),_:1},8,["modelValue"])])),_:1})}]]);!async function(){await(0,s.rn)(["400 14px Roboto","500 14px Roboto"]);const e=(0,a.createApp)(y);await(0,s.K7)(e),await(0,n.H)(e),e.mount("body")}()}},t={};function a(e){var s=t[e];if(void 0!==s)return s.exports;var n=t[e]={exports:{}};return i[e].call(n.exports,n,n.exports,a),n.exports}a.m=i,e=[],a.O=(i,t,s,n)=>{if(!t){var o=1/0;for(m=0;m<e.length;m++){for(var[t,s,n]=e[m],r=!0,g=0;g<t.length;g++)(!1&n||o>=n)&&Object.keys(a.O).every((e=>a.O[e](t[g])))?t.splice(g--,1):(r=!1,n<o&&(o=n));if(r){e.splice(m--,1);var l=s();void 0!==l&&(i=l)}}return i}n=n||0;for(var m=e.length;m>0&&e[m-1][2]>n;m--)e[m]=e[m-1];e[m]=[t,s,n]},a.n=e=>{var i=e&&e.__esModule?()=>e.default:()=>e;return a.d(i,{a:i}),i},a.d=(e,i)=>{for(var t in i)a.o(i,t)&&!a.o(e,t)&&Object.defineProperty(e,t,{enumerable:!0,get:i[t]})},a.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==typeof window)return window}}(),a.o=(e,i)=>Object.prototype.hasOwnProperty.call(e,i),a.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},a.j=4029,(()=>{var e={4029:0};a.O.j=i=>0===e[i];var i=(i,t)=>{var s,n,[o,r,g]=t,l=0;if(o.some((i=>0!==e[i]))){for(s in r)a.o(r,s)&&(a.m[s]=r[s]);if(g)var m=g(a)}for(i&&i(t);l<o.length;l++)n=o[l],a.o(e,n)&&e[n]&&e[n][0](),e[n]=0;return a.O(m)},t=globalThis.webpackChunksearch_by_image=globalThis.webpackChunksearch_by_image||[];t.forEach(i.bind(null,0)),t.push=i.bind(null,t.push.bind(t))})();var s=a.O(void 0,[8830],(()=>a(1642)));s=a.O(s)})();