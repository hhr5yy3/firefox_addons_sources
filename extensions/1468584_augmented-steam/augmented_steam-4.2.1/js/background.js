"use strict";var _as=(()=>{var es=Object.create;var vt=Object.defineProperty;var ts=Object.getOwnPropertyDescriptor;var os=Object.getOwnPropertyNames;var rs=Object.getPrototypeOf,ss=Object.prototype.hasOwnProperty;var $o=(s,e)=>()=>(e||s((e={exports:{}}).exports,e),e.exports),ns=(s,e)=>{for(var t in e)vt(s,t,{get:e[t],enumerable:!0})},Vo=(s,e,t,o)=>{if(e&&typeof e=="object"||typeof e=="function")for(let r of os(e))!ss.call(s,r)&&r!==t&&vt(s,r,{get:()=>e[r],enumerable:!(o=ts(e,r))||o.enumerable});return s};var ie=(s,e,t)=>(t=s!=null?es(rs(s)):{},Vo(e||!s||!s.__esModule?vt(t,"default",{value:s,enumerable:!0}):t,s)),is=s=>Vo(vt({},"__esModule",{value:!0}),s);var ae=$o((Kt,nr)=>{(function(s,e){if(typeof define=="function"&&define.amd)define("webextension-polyfill",["module"],e);else if(typeof Kt<"u")e(nr);else{var t={exports:{}};e(t),s.browser=t.exports}})(typeof globalThis<"u"?globalThis:typeof self<"u"?self:Kt,function(s){"use strict";if(!globalThis.chrome?.runtime?.id)throw new Error("This script should only be loaded in a browser extension.");if(typeof globalThis.browser>"u"||Object.getPrototypeOf(globalThis.browser)!==Object.prototype){let e="The message port closed before a response was received.",t=o=>{let r={alarms:{clear:{minArgs:0,maxArgs:1},clearAll:{minArgs:0,maxArgs:0},get:{minArgs:0,maxArgs:1},getAll:{minArgs:0,maxArgs:0}},bookmarks:{create:{minArgs:1,maxArgs:1},get:{minArgs:1,maxArgs:1},getChildren:{minArgs:1,maxArgs:1},getRecent:{minArgs:1,maxArgs:1},getSubTree:{minArgs:1,maxArgs:1},getTree:{minArgs:0,maxArgs:0},move:{minArgs:2,maxArgs:2},remove:{minArgs:1,maxArgs:1},removeTree:{minArgs:1,maxArgs:1},search:{minArgs:1,maxArgs:1},update:{minArgs:2,maxArgs:2}},browserAction:{disable:{minArgs:0,maxArgs:1,fallbackToNoCallback:!0},enable:{minArgs:0,maxArgs:1,fallbackToNoCallback:!0},getBadgeBackgroundColor:{minArgs:1,maxArgs:1},getBadgeText:{minArgs:1,maxArgs:1},getPopup:{minArgs:1,maxArgs:1},getTitle:{minArgs:1,maxArgs:1},openPopup:{minArgs:0,maxArgs:0},setBadgeBackgroundColor:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0},setBadgeText:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0},setIcon:{minArgs:1,maxArgs:1},setPopup:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0},setTitle:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0}},browsingData:{remove:{minArgs:2,maxArgs:2},removeCache:{minArgs:1,maxArgs:1},removeCookies:{minArgs:1,maxArgs:1},removeDownloads:{minArgs:1,maxArgs:1},removeFormData:{minArgs:1,maxArgs:1},removeHistory:{minArgs:1,maxArgs:1},removeLocalStorage:{minArgs:1,maxArgs:1},removePasswords:{minArgs:1,maxArgs:1},removePluginData:{minArgs:1,maxArgs:1},settings:{minArgs:0,maxArgs:0}},commands:{getAll:{minArgs:0,maxArgs:0}},contextMenus:{remove:{minArgs:1,maxArgs:1},removeAll:{minArgs:0,maxArgs:0},update:{minArgs:2,maxArgs:2}},cookies:{get:{minArgs:1,maxArgs:1},getAll:{minArgs:1,maxArgs:1},getAllCookieStores:{minArgs:0,maxArgs:0},remove:{minArgs:1,maxArgs:1},set:{minArgs:1,maxArgs:1}},devtools:{inspectedWindow:{eval:{minArgs:1,maxArgs:2,singleCallbackArg:!1}},panels:{create:{minArgs:3,maxArgs:3,singleCallbackArg:!0},elements:{createSidebarPane:{minArgs:1,maxArgs:1}}}},downloads:{cancel:{minArgs:1,maxArgs:1},download:{minArgs:1,maxArgs:1},erase:{minArgs:1,maxArgs:1},getFileIcon:{minArgs:1,maxArgs:2},open:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0},pause:{minArgs:1,maxArgs:1},removeFile:{minArgs:1,maxArgs:1},resume:{minArgs:1,maxArgs:1},search:{minArgs:1,maxArgs:1},show:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0}},extension:{isAllowedFileSchemeAccess:{minArgs:0,maxArgs:0},isAllowedIncognitoAccess:{minArgs:0,maxArgs:0}},history:{addUrl:{minArgs:1,maxArgs:1},deleteAll:{minArgs:0,maxArgs:0},deleteRange:{minArgs:1,maxArgs:1},deleteUrl:{minArgs:1,maxArgs:1},getVisits:{minArgs:1,maxArgs:1},search:{minArgs:1,maxArgs:1}},i18n:{detectLanguage:{minArgs:1,maxArgs:1},getAcceptLanguages:{minArgs:0,maxArgs:0}},identity:{launchWebAuthFlow:{minArgs:1,maxArgs:1}},idle:{queryState:{minArgs:1,maxArgs:1}},management:{get:{minArgs:1,maxArgs:1},getAll:{minArgs:0,maxArgs:0},getSelf:{minArgs:0,maxArgs:0},setEnabled:{minArgs:2,maxArgs:2},uninstallSelf:{minArgs:0,maxArgs:1}},notifications:{clear:{minArgs:1,maxArgs:1},create:{minArgs:1,maxArgs:2},getAll:{minArgs:0,maxArgs:0},getPermissionLevel:{minArgs:0,maxArgs:0},update:{minArgs:2,maxArgs:2}},pageAction:{getPopup:{minArgs:1,maxArgs:1},getTitle:{minArgs:1,maxArgs:1},hide:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0},setIcon:{minArgs:1,maxArgs:1},setPopup:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0},setTitle:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0},show:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0}},permissions:{contains:{minArgs:1,maxArgs:1},getAll:{minArgs:0,maxArgs:0},remove:{minArgs:1,maxArgs:1},request:{minArgs:1,maxArgs:1}},runtime:{getBackgroundPage:{minArgs:0,maxArgs:0},getPlatformInfo:{minArgs:0,maxArgs:0},openOptionsPage:{minArgs:0,maxArgs:0},requestUpdateCheck:{minArgs:0,maxArgs:0},sendMessage:{minArgs:1,maxArgs:3},sendNativeMessage:{minArgs:2,maxArgs:2},setUninstallURL:{minArgs:1,maxArgs:1}},sessions:{getDevices:{minArgs:0,maxArgs:1},getRecentlyClosed:{minArgs:0,maxArgs:1},restore:{minArgs:0,maxArgs:1}},storage:{local:{clear:{minArgs:0,maxArgs:0},get:{minArgs:0,maxArgs:1},getBytesInUse:{minArgs:0,maxArgs:1},remove:{minArgs:1,maxArgs:1},set:{minArgs:1,maxArgs:1}},managed:{get:{minArgs:0,maxArgs:1},getBytesInUse:{minArgs:0,maxArgs:1}},sync:{clear:{minArgs:0,maxArgs:0},get:{minArgs:0,maxArgs:1},getBytesInUse:{minArgs:0,maxArgs:1},remove:{minArgs:1,maxArgs:1},set:{minArgs:1,maxArgs:1}}},tabs:{captureVisibleTab:{minArgs:0,maxArgs:2},create:{minArgs:1,maxArgs:1},detectLanguage:{minArgs:0,maxArgs:1},discard:{minArgs:0,maxArgs:1},duplicate:{minArgs:1,maxArgs:1},executeScript:{minArgs:1,maxArgs:2},get:{minArgs:1,maxArgs:1},getCurrent:{minArgs:0,maxArgs:0},getZoom:{minArgs:0,maxArgs:1},getZoomSettings:{minArgs:0,maxArgs:1},goBack:{minArgs:0,maxArgs:1},goForward:{minArgs:0,maxArgs:1},highlight:{minArgs:1,maxArgs:1},insertCSS:{minArgs:1,maxArgs:2},move:{minArgs:2,maxArgs:2},query:{minArgs:1,maxArgs:1},reload:{minArgs:0,maxArgs:2},remove:{minArgs:1,maxArgs:1},removeCSS:{minArgs:1,maxArgs:2},sendMessage:{minArgs:2,maxArgs:3},setZoom:{minArgs:1,maxArgs:2},setZoomSettings:{minArgs:1,maxArgs:2},update:{minArgs:1,maxArgs:2}},topSites:{get:{minArgs:0,maxArgs:0}},webNavigation:{getAllFrames:{minArgs:1,maxArgs:1},getFrame:{minArgs:1,maxArgs:1}},webRequest:{handlerBehaviorChanged:{minArgs:0,maxArgs:0}},windows:{create:{minArgs:0,maxArgs:1},get:{minArgs:1,maxArgs:2},getAll:{minArgs:0,maxArgs:1},getCurrent:{minArgs:0,maxArgs:1},getLastFocused:{minArgs:0,maxArgs:1},remove:{minArgs:1,maxArgs:1},update:{minArgs:2,maxArgs:2}}};if(Object.keys(r).length===0)throw new Error("api-metadata.json has not been included in browser-polyfill");class n extends WeakMap{constructor(f,v=void 0){super(v),this.createItem=f}get(f){return this.has(f)||this.set(f,this.createItem(f)),super.get(f)}}let a=m=>m&&typeof m=="object"&&typeof m.then=="function",c=(m,f)=>(...v)=>{o.runtime.lastError?m.reject(new Error(o.runtime.lastError.message)):f.singleCallbackArg||v.length<=1&&f.singleCallbackArg!==!1?m.resolve(v[0]):m.resolve(v)},_=m=>m==1?"argument":"arguments",u=(m,f)=>function(w,...F){if(F.length<f.minArgs)throw new Error(`Expected at least ${f.minArgs} ${_(f.minArgs)} for ${m}(), got ${F.length}`);if(F.length>f.maxArgs)throw new Error(`Expected at most ${f.maxArgs} ${_(f.maxArgs)} for ${m}(), got ${F.length}`);return new Promise((x,X)=>{if(f.fallbackToNoCallback)try{w[m](...F,c({resolve:x,reject:X},f))}catch(y){console.warn(`${m} API method doesn't seem to support the callback parameter, falling back to call it without a callback: `,y),w[m](...F),f.fallbackToNoCallback=!1,f.noCallback=!0,x()}else f.noCallback?(w[m](...F),x()):w[m](...F,c({resolve:x,reject:X},f))})},S=(m,f,v)=>new Proxy(f,{apply(w,F,x){return v.call(F,m,...x)}}),E=Function.call.bind(Object.prototype.hasOwnProperty),C=(m,f={},v={})=>{let w=Object.create(null),F={has(X,y){return y in m||y in w},get(X,y,H){if(y in w)return w[y];if(!(y in m))return;let D=m[y];if(typeof D=="function")if(typeof f[y]=="function")D=S(m,m[y],f[y]);else if(E(v,y)){let pe=u(y,v[y]);D=S(m,m[y],pe)}else D=D.bind(m);else if(typeof D=="object"&&D!==null&&(E(f,y)||E(v,y)))D=C(D,f[y],v[y]);else if(E(v,"*"))D=C(D,f[y],v["*"]);else return Object.defineProperty(w,y,{configurable:!0,enumerable:!0,get(){return m[y]},set(pe){m[y]=pe}}),D;return w[y]=D,D},set(X,y,H,D){return y in w?w[y]=H:m[y]=H,!0},defineProperty(X,y,H){return Reflect.defineProperty(w,y,H)},deleteProperty(X,y){return Reflect.deleteProperty(w,y)}},x=Object.create(m);return new Proxy(x,F)},L=m=>({addListener(f,v,...w){f.addListener(m.get(v),...w)},hasListener(f,v){return f.hasListener(m.get(v))},removeListener(f,v){f.removeListener(m.get(v))}}),ee=new n(m=>typeof m!="function"?m:function(v){let w=C(v,{},{getContent:{minArgs:0,maxArgs:0}});m(w)}),Y=new n(m=>typeof m!="function"?m:function(v,w,F){let x=!1,X,y=new Promise(me=>{X=function(se){x=!0,me(se)}}),H;try{H=m(v,w,X)}catch(me){H=Promise.reject(me)}let D=H!==!0&&a(H);if(H!==!0&&!D&&!x)return!1;let pe=me=>{me.then(se=>{F(se)},se=>{let Se;se&&(se instanceof Error||typeof se.message=="string")?Se=se.message:Se="An unexpected error occurred",F({__mozWebExtensionPolyfillReject__:!0,message:Se})}).catch(se=>{console.error("Failed to send onMessage rejected reply",se)})};return pe(D?H:y),!0}),te=({reject:m,resolve:f},v)=>{o.runtime.lastError?o.runtime.lastError.message===e?f():m(new Error(o.runtime.lastError.message)):v&&v.__mozWebExtensionPolyfillReject__?m(new Error(v.message)):f(v)},Ie=(m,f,v,...w)=>{if(w.length<f.minArgs)throw new Error(`Expected at least ${f.minArgs} ${_(f.minArgs)} for ${m}(), got ${w.length}`);if(w.length>f.maxArgs)throw new Error(`Expected at most ${f.maxArgs} ${_(f.maxArgs)} for ${m}(), got ${w.length}`);return new Promise((F,x)=>{let X=te.bind(null,{resolve:F,reject:x});w.push(X),v.sendMessage(...w)})},It={devtools:{network:{onRequestFinished:L(ee)}},runtime:{onMessage:L(Y),onMessageExternal:L(Y),sendMessage:Ie.bind(null,"sendMessage",{minArgs:1,maxArgs:3})},tabs:{sendMessage:Ie.bind(null,"sendMessage",{minArgs:2,maxArgs:3})}},$={clear:{minArgs:1,maxArgs:1},get:{minArgs:1,maxArgs:1},set:{minArgs:1,maxArgs:1}};return r.privacy={network:{"*":$},services:{"*":$},websites:{"*":$}},C(o,It,r)};s.exports=t(chrome)}else s.exports=globalThis.browser})});var xr=$o((ao,co)=>{(function(s,e){typeof ao=="object"&&typeof co<"u"?co.exports=e():typeof define=="function"&&define.amd?define(e):(s=typeof globalThis<"u"?globalThis:s||self,s.DOMPurify=e())})(ao,function(){"use strict";let{entries:s,setPrototypeOf:e,isFrozen:t,getPrototypeOf:o,getOwnPropertyDescriptor:r}=Object,{freeze:n,seal:a,create:c}=Object,{apply:_,construct:u}=typeof Reflect<"u"&&Reflect;n||(n=function(g){return g}),a||(a=function(g){return g}),_||(_=function(g,k,A){return g.apply(k,A)}),u||(u=function(g,k){return new g(...k)});let S=w(Array.prototype.forEach),E=w(Array.prototype.pop),C=w(Array.prototype.push),L=w(String.prototype.toLowerCase),ee=w(String.prototype.toString),Y=w(String.prototype.match),te=w(String.prototype.replace),Ie=w(String.prototype.indexOf),It=w(String.prototype.trim),$=w(Object.prototype.hasOwnProperty),m=w(RegExp.prototype.test),f=F(TypeError),v=w(Number.isNaN);function w(P){return function(g){for(var k=arguments.length,A=new Array(k>1?k-1:0),K=1;K<k;K++)A[K-1]=arguments[K];return _(P,g,A)}}function F(P){return function(){for(var g=arguments.length,k=new Array(g),A=0;A<g;A++)k[A]=arguments[A];return u(P,k)}}function x(P,g){let k=arguments.length>2&&arguments[2]!==void 0?arguments[2]:L;e&&e(P,null);let A=g.length;for(;A--;){let K=g[A];if(typeof K=="string"){let de=k(K);de!==K&&(t(g)||(g[A]=de),K=de)}P[K]=!0}return P}function X(P){for(let g=0;g<P.length;g++)$(P,g)||(P[g]=null);return P}function y(P){let g=c(null);for(let[k,A]of s(P))$(P,k)&&(Array.isArray(A)?g[k]=X(A):A&&typeof A=="object"&&A.constructor===Object?g[k]=y(A):g[k]=A);return g}function H(P,g){for(;P!==null;){let A=r(P,g);if(A){if(A.get)return w(A.get);if(typeof A.value=="function")return w(A.value)}P=o(P)}function k(){return null}return k}let D=n(["a","abbr","acronym","address","area","article","aside","audio","b","bdi","bdo","big","blink","blockquote","body","br","button","canvas","caption","center","cite","code","col","colgroup","content","data","datalist","dd","decorator","del","details","dfn","dialog","dir","div","dl","dt","element","em","fieldset","figcaption","figure","font","footer","form","h1","h2","h3","h4","h5","h6","head","header","hgroup","hr","html","i","img","input","ins","kbd","label","legend","li","main","map","mark","marquee","menu","menuitem","meter","nav","nobr","ol","optgroup","option","output","p","picture","pre","progress","q","rp","rt","ruby","s","samp","section","select","shadow","small","source","spacer","span","strike","strong","style","sub","summary","sup","table","tbody","td","template","textarea","tfoot","th","thead","time","tr","track","tt","u","ul","var","video","wbr"]),pe=n(["svg","a","altglyph","altglyphdef","altglyphitem","animatecolor","animatemotion","animatetransform","circle","clippath","defs","desc","ellipse","filter","font","g","glyph","glyphref","hkern","image","line","lineargradient","marker","mask","metadata","mpath","path","pattern","polygon","polyline","radialgradient","rect","stop","style","switch","symbol","text","textpath","title","tref","tspan","view","vkern"]),me=n(["feBlend","feColorMatrix","feComponentTransfer","feComposite","feConvolveMatrix","feDiffuseLighting","feDisplacementMap","feDistantLight","feDropShadow","feFlood","feFuncA","feFuncB","feFuncG","feFuncR","feGaussianBlur","feImage","feMerge","feMergeNode","feMorphology","feOffset","fePointLight","feSpecularLighting","feSpotLight","feTile","feTurbulence"]),se=n(["animate","color-profile","cursor","discard","font-face","font-face-format","font-face-name","font-face-src","font-face-uri","foreignobject","hatch","hatchpath","mesh","meshgradient","meshpatch","meshrow","missing-glyph","script","set","solidcolor","unknown","use"]),Se=n(["math","menclose","merror","mfenced","mfrac","mglyph","mi","mlabeledtr","mmultiscripts","mn","mo","mover","mpadded","mphantom","mroot","mrow","ms","mspace","msqrt","mstyle","msub","msup","msubsup","mtable","mtd","mtext","mtr","munder","munderover","mprescripts"]),yr=n(["maction","maligngroup","malignmark","mlongdiv","mscarries","mscarry","msgroup","mstack","msline","msrow","semantics","annotation","annotation-xml","mprescripts","none"]),po=n(["#text"]),lo=n(["accept","action","align","alt","autocapitalize","autocomplete","autopictureinpicture","autoplay","background","bgcolor","border","capture","cellpadding","cellspacing","checked","cite","class","clear","color","cols","colspan","controls","controlslist","coords","crossorigin","datetime","decoding","default","dir","disabled","disablepictureinpicture","disableremoteplayback","download","draggable","enctype","enterkeyhint","face","for","headers","height","hidden","high","href","hreflang","id","inputmode","integrity","ismap","kind","label","lang","list","loading","loop","low","max","maxlength","media","method","min","minlength","multiple","muted","name","nonce","noshade","novalidate","nowrap","open","optimum","pattern","placeholder","playsinline","poster","preload","pubdate","radiogroup","readonly","rel","required","rev","reversed","role","rows","rowspan","spellcheck","scope","selected","shape","size","sizes","span","srclang","start","src","srcset","step","style","summary","tabindex","title","translate","type","usemap","valign","value","width","wrap","xmlns","slot"]),Et=n(["accent-height","accumulate","additive","alignment-baseline","ascent","attributename","attributetype","azimuth","basefrequency","baseline-shift","begin","bias","by","class","clip","clippathunits","clip-path","clip-rule","color","color-interpolation","color-interpolation-filters","color-profile","color-rendering","cx","cy","d","dx","dy","diffuseconstant","direction","display","divisor","dur","edgemode","elevation","end","fill","fill-opacity","fill-rule","filter","filterunits","flood-color","flood-opacity","font-family","font-size","font-size-adjust","font-stretch","font-style","font-variant","font-weight","fx","fy","g1","g2","glyph-name","glyphref","gradientunits","gradienttransform","height","href","id","image-rendering","in","in2","k","k1","k2","k3","k4","kerning","keypoints","keysplines","keytimes","lang","lengthadjust","letter-spacing","kernelmatrix","kernelunitlength","lighting-color","local","marker-end","marker-mid","marker-start","markerheight","markerunits","markerwidth","maskcontentunits","maskunits","max","mask","media","method","mode","min","name","numoctaves","offset","operator","opacity","order","orient","orientation","origin","overflow","paint-order","path","pathlength","patterncontentunits","patterntransform","patternunits","points","preservealpha","preserveaspectratio","primitiveunits","r","rx","ry","radius","refx","refy","repeatcount","repeatdur","restart","result","rotate","scale","seed","shape-rendering","specularconstant","specularexponent","spreadmethod","startoffset","stddeviation","stitchtiles","stop-color","stop-opacity","stroke-dasharray","stroke-dashoffset","stroke-linecap","stroke-linejoin","stroke-miterlimit","stroke-opacity","stroke","stroke-width","style","surfacescale","systemlanguage","tabindex","targetx","targety","transform","transform-origin","text-anchor","text-decoration","text-rendering","textlength","type","u1","u2","unicode","values","viewbox","visibility","version","vert-adv-y","vert-origin-x","vert-origin-y","width","word-spacing","wrap","writing-mode","xchannelselector","ychannelselector","x","x1","x2","xmlns","y","y1","y2","z","zoomandpan"]),_o=n(["accent","accentunder","align","bevelled","close","columnsalign","columnlines","columnspan","denomalign","depth","dir","display","displaystyle","encoding","fence","frame","height","href","id","largeop","length","linethickness","lspace","lquote","mathbackground","mathcolor","mathsize","mathvariant","maxsize","minsize","movablelimits","notation","numalign","open","rowalign","rowlines","rowspacing","rowspan","rspace","rquote","scriptlevel","scriptminsize","scriptsizemultiplier","selection","separator","separators","stretchy","subscriptshift","supscriptshift","symmetric","voffset","width","xmlns"]),gt=n(["xlink:href","xml:id","xlink:title","xml:space","xmlns:xlink"]),br=a(/\{\{[\w\W]*|[\w\W]*\}\}/gm),Sr=a(/<%[\w\W]*|[\w\W]*%>/gm),vr=a(/\${[\w\W]*}/gm),Ar=a(/^data-[\-\w.\u00B7-\uFFFF]/),Tr=a(/^aria-[\-\w]+$/),uo=a(/^(?:(?:(?:f|ht)tps?|mailto|tel|callto|sms|cid|xmpp):|[^a-z]|[a-z+.\-]+(?:[^a-z+.\-:]|$))/i),Pr=a(/^(?:\w+script|data):/i),kr=a(/[\u0000-\u0020\u00A0\u1680\u180E\u2000-\u2029\u205F\u3000]/g),mo=a(/^html$/i),Ir=a(/^[a-z][.\w]*(-[.\w]+)+$/i);var go=Object.freeze({__proto__:null,MUSTACHE_EXPR:br,ERB_EXPR:Sr,TMPLIT_EXPR:vr,DATA_ATTR:Ar,ARIA_ATTR:Tr,IS_ALLOWED_URI:uo,IS_SCRIPT_OR_DATA:Pr,ATTR_WHITESPACE:kr,DOCTYPE_NAME:mo,CUSTOM_ELEMENT:Ir});let ve={element:1,attribute:2,text:3,cdataSection:4,entityReference:5,entityNode:6,progressingInstruction:7,comment:8,document:9,documentType:10,documentFragment:11,notation:12},Er=function(){return typeof window>"u"?null:window},Cr=function(g,k){if(typeof g!="object"||typeof g.createPolicy!="function")return null;let A=null,K="data-tt-policy-suffix";k&&k.hasAttribute(K)&&(A=k.getAttribute(K));let de="dompurify"+(A?"#"+A:"");try{return g.createPolicy(de,{createHTML(Ee){return Ee},createScriptURL(Ee){return Ee}})}catch{return console.warn("TrustedTypes policy "+de+" could not be created."),null}};function ho(){let P=arguments.length>0&&arguments[0]!==void 0?arguments[0]:Er(),g=h=>ho(h);if(g.version="3.1.3",g.removed=[],!P||!P.document||P.document.nodeType!==ve.document)return g.isSupported=!1,g;let{document:k}=P,A=k,K=A.currentScript,{DocumentFragment:de,HTMLTemplateElement:Ee,Node:Ct,Element:fo,NodeFilter:je,NamedNodeMap:Nr=P.NamedNodeMap||P.MozNamedAttrMap,HTMLFormElement:Rr,DOMParser:Lr,trustedTypes:ht}=P,ft=fo.prototype,Mr=H(ft,"cloneNode"),Or=H(ft,"nextSibling"),Fr=H(ft,"childNodes"),He=H(ft,"parentNode");if(typeof Ee=="function"){let h=k.createElement("template");h.content&&h.content.ownerDocument&&(k=h.content.ownerDocument)}let V,Ge="",{implementation:Dt,createNodeIterator:Ur,createDocumentFragment:Br,getElementsByTagName:Wr}=k,{importNode:zr}=A,le={};g.isSupported=typeof s=="function"&&typeof He=="function"&&Dt&&Dt.createHTMLDocument!==void 0;let{MUSTACHE_EXPR:Nt,ERB_EXPR:Rt,TMPLIT_EXPR:Lt,DATA_ATTR:jr,ARIA_ATTR:Hr,IS_SCRIPT_OR_DATA:Gr,ATTR_WHITESPACE:xo,CUSTOM_ELEMENT:Kr}=go,{IS_ALLOWED_URI:wo}=go,B=null,yo=x({},[...D,...pe,...me,...Se,...po]),W=null,bo=x({},[...lo,...Et,..._o,...gt]),N=Object.seal(c(null,{tagNameCheck:{writable:!0,configurable:!1,enumerable:!0,value:null},attributeNameCheck:{writable:!0,configurable:!1,enumerable:!0,value:null},allowCustomizedBuiltInElements:{writable:!0,configurable:!1,enumerable:!0,value:!1}})),Ke=null,Mt=null,So=!0,Ot=!0,vo=!1,Ao=!0,Ce=!1,Ft=!0,Ae=!1,Ut=!1,Bt=!1,De=!1,xt=!1,wt=!1,To=!0,Po=!1,qr="user-content-",Wt=!0,qe=!1,Ne={},Re=null,ko=x({},["annotation-xml","audio","colgroup","desc","foreignobject","head","iframe","math","mi","mn","mo","ms","mtext","noembed","noframes","noscript","plaintext","script","style","svg","template","thead","title","video","xmp"]),Io=null,Eo=x({},["audio","video","img","source","image","track"]),zt=null,Co=x({},["alt","class","for","id","label","name","pattern","placeholder","role","summary","title","value","style","xmlns"]),yt="http://www.w3.org/1998/Math/MathML",bt="http://www.w3.org/2000/svg",ge="http://www.w3.org/1999/xhtml",Le=ge,jt=!1,Ht=null,$r=x({},[yt,bt,ge],ee),$e=null,Vr=["application/xhtml+xml","text/html"],Jr="text/html",z=null,Me=null,Do=255,Yr=k.createElement("form"),No=function(i){return i instanceof RegExp||i instanceof Function},Gt=function(){let i=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};if(!(Me&&Me===i)){if((!i||typeof i!="object")&&(i={}),i=y(i),$e=Vr.indexOf(i.PARSER_MEDIA_TYPE)===-1?Jr:i.PARSER_MEDIA_TYPE,z=$e==="application/xhtml+xml"?ee:L,B=$(i,"ALLOWED_TAGS")?x({},i.ALLOWED_TAGS,z):yo,W=$(i,"ALLOWED_ATTR")?x({},i.ALLOWED_ATTR,z):bo,Ht=$(i,"ALLOWED_NAMESPACES")?x({},i.ALLOWED_NAMESPACES,ee):$r,zt=$(i,"ADD_URI_SAFE_ATTR")?x(y(Co),i.ADD_URI_SAFE_ATTR,z):Co,Io=$(i,"ADD_DATA_URI_TAGS")?x(y(Eo),i.ADD_DATA_URI_TAGS,z):Eo,Re=$(i,"FORBID_CONTENTS")?x({},i.FORBID_CONTENTS,z):ko,Ke=$(i,"FORBID_TAGS")?x({},i.FORBID_TAGS,z):{},Mt=$(i,"FORBID_ATTR")?x({},i.FORBID_ATTR,z):{},Ne=$(i,"USE_PROFILES")?i.USE_PROFILES:!1,So=i.ALLOW_ARIA_ATTR!==!1,Ot=i.ALLOW_DATA_ATTR!==!1,vo=i.ALLOW_UNKNOWN_PROTOCOLS||!1,Ao=i.ALLOW_SELF_CLOSE_IN_ATTR!==!1,Ce=i.SAFE_FOR_TEMPLATES||!1,Ft=i.SAFE_FOR_XML!==!1,Ae=i.WHOLE_DOCUMENT||!1,De=i.RETURN_DOM||!1,xt=i.RETURN_DOM_FRAGMENT||!1,wt=i.RETURN_TRUSTED_TYPE||!1,Bt=i.FORCE_BODY||!1,To=i.SANITIZE_DOM!==!1,Po=i.SANITIZE_NAMED_PROPS||!1,Wt=i.KEEP_CONTENT!==!1,qe=i.IN_PLACE||!1,wo=i.ALLOWED_URI_REGEXP||uo,Le=i.NAMESPACE||ge,N=i.CUSTOM_ELEMENT_HANDLING||{},i.CUSTOM_ELEMENT_HANDLING&&No(i.CUSTOM_ELEMENT_HANDLING.tagNameCheck)&&(N.tagNameCheck=i.CUSTOM_ELEMENT_HANDLING.tagNameCheck),i.CUSTOM_ELEMENT_HANDLING&&No(i.CUSTOM_ELEMENT_HANDLING.attributeNameCheck)&&(N.attributeNameCheck=i.CUSTOM_ELEMENT_HANDLING.attributeNameCheck),i.CUSTOM_ELEMENT_HANDLING&&typeof i.CUSTOM_ELEMENT_HANDLING.allowCustomizedBuiltInElements=="boolean"&&(N.allowCustomizedBuiltInElements=i.CUSTOM_ELEMENT_HANDLING.allowCustomizedBuiltInElements),Ce&&(Ot=!1),xt&&(De=!0),Ne&&(B=x({},po),W=[],Ne.html===!0&&(x(B,D),x(W,lo)),Ne.svg===!0&&(x(B,pe),x(W,Et),x(W,gt)),Ne.svgFilters===!0&&(x(B,me),x(W,Et),x(W,gt)),Ne.mathMl===!0&&(x(B,Se),x(W,_o),x(W,gt))),i.ADD_TAGS&&(B===yo&&(B=y(B)),x(B,i.ADD_TAGS,z)),i.ADD_ATTR&&(W===bo&&(W=y(W)),x(W,i.ADD_ATTR,z)),i.ADD_URI_SAFE_ATTR&&x(zt,i.ADD_URI_SAFE_ATTR,z),i.FORBID_CONTENTS&&(Re===ko&&(Re=y(Re)),x(Re,i.FORBID_CONTENTS,z)),Wt&&(B["#text"]=!0),Ae&&x(B,["html","head","body"]),B.table&&(x(B,["tbody"]),delete Ke.tbody),i.TRUSTED_TYPES_POLICY){if(typeof i.TRUSTED_TYPES_POLICY.createHTML!="function")throw f('TRUSTED_TYPES_POLICY configuration option must provide a "createHTML" hook.');if(typeof i.TRUSTED_TYPES_POLICY.createScriptURL!="function")throw f('TRUSTED_TYPES_POLICY configuration option must provide a "createScriptURL" hook.');V=i.TRUSTED_TYPES_POLICY,Ge=V.createHTML("")}else V===void 0&&(V=Cr(ht,K)),V!==null&&typeof Ge=="string"&&(Ge=V.createHTML(""));n&&n(i),Me=i}},Ro=x({},["mi","mo","mn","ms","mtext"]),Lo=x({},["foreignobject","annotation-xml"]),Xr=x({},["title","style","font","a","script"]),Mo=x({},[...pe,...me,...se]),Oo=x({},[...Se,...yr]),Zr=function(i){let p=He(i);(!p||!p.tagName)&&(p={namespaceURI:Le,tagName:"template"});let d=L(i.tagName),b=L(p.tagName);return Ht[i.namespaceURI]?i.namespaceURI===bt?p.namespaceURI===ge?d==="svg":p.namespaceURI===yt?d==="svg"&&(b==="annotation-xml"||Ro[b]):!!Mo[d]:i.namespaceURI===yt?p.namespaceURI===ge?d==="math":p.namespaceURI===bt?d==="math"&&Lo[b]:!!Oo[d]:i.namespaceURI===ge?p.namespaceURI===bt&&!Lo[b]||p.namespaceURI===yt&&!Ro[b]?!1:!Oo[d]&&(Xr[d]||!Mo[d]):!!($e==="application/xhtml+xml"&&Ht[i.namespaceURI]):!1},ne=function(i){C(g.removed,{element:i});try{i.parentNode.removeChild(i)}catch{i.remove()}},St=function(i,p){try{C(g.removed,{attribute:p.getAttributeNode(i),from:p})}catch{C(g.removed,{attribute:null,from:p})}if(p.removeAttribute(i),i==="is"&&!W[i])if(De||xt)try{ne(p)}catch{}else try{p.setAttribute(i,"")}catch{}},Fo=function(i){let p=null,d=null;if(Bt)i="<remove></remove>"+i;else{let G=Y(i,/^[\r\n\t ]+/);d=G&&G[0]}$e==="application/xhtml+xml"&&Le===ge&&(i='<html xmlns="http://www.w3.org/1999/xhtml"><head></head><body>'+i+"</body></html>");let b=V?V.createHTML(i):i;if(Le===ge)try{p=new Lr().parseFromString(b,$e)}catch{}if(!p||!p.documentElement){p=Dt.createDocument(Le,"template",null);try{p.documentElement.innerHTML=jt?Ge:b}catch{}}let q=p.body||p.documentElement;return i&&d&&q.insertBefore(k.createTextNode(d),q.childNodes[0]||null),Le===ge?Wr.call(p,Ae?"html":"body")[0]:Ae?p.documentElement:q},Uo=function(i){return Ur.call(i.ownerDocument||i,i,je.SHOW_ELEMENT|je.SHOW_COMMENT|je.SHOW_TEXT|je.SHOW_PROCESSING_INSTRUCTION|je.SHOW_CDATA_SECTION,null)},Bo=function(i){return i instanceof Rr&&(typeof i.__depth<"u"&&typeof i.__depth!="number"||typeof i.__removalCount<"u"&&typeof i.__removalCount!="number"||typeof i.nodeName!="string"||typeof i.textContent!="string"||typeof i.removeChild!="function"||!(i.attributes instanceof Nr)||typeof i.removeAttribute!="function"||typeof i.setAttribute!="function"||typeof i.namespaceURI!="string"||typeof i.insertBefore!="function"||typeof i.hasChildNodes!="function")},Wo=function(i){return typeof Ct=="function"&&i instanceof Ct},he=function(i,p,d){le[i]&&S(le[i],b=>{b.call(g,p,d,Me)})},zo=function(i){let p=null;if(he("beforeSanitizeElements",i,null),Bo(i))return ne(i),!0;let d=z(i.nodeName);if(he("uponSanitizeElement",i,{tagName:d,allowedTags:B}),i.hasChildNodes()&&!Wo(i.firstElementChild)&&m(/<[/\w]/g,i.innerHTML)&&m(/<[/\w]/g,i.textContent)||i.nodeType===ve.progressingInstruction||Ft&&i.nodeType===ve.comment&&m(/<[/\w]/g,i.data))return ne(i),!0;if(!B[d]||Ke[d]){if(!Ke[d]&&Ho(d)&&(N.tagNameCheck instanceof RegExp&&m(N.tagNameCheck,d)||N.tagNameCheck instanceof Function&&N.tagNameCheck(d)))return!1;if(Wt&&!Re[d]){let b=He(i)||i.parentNode,q=Fr(i)||i.childNodes;if(q&&b){let G=q.length;for(let Z=G-1;Z>=0;--Z){let Q=Mr(q[Z],!0);Q.__removalCount=(i.__removalCount||0)+1,b.insertBefore(Q,Or(i))}}}return ne(i),!0}return i instanceof fo&&!Zr(i)||(d==="noscript"||d==="noembed"||d==="noframes")&&m(/<\/no(script|embed|frames)/i,i.innerHTML)?(ne(i),!0):(Ce&&i.nodeType===ve.text&&(p=i.textContent,S([Nt,Rt,Lt],b=>{p=te(p,b," ")}),i.textContent!==p&&(C(g.removed,{element:i.cloneNode()}),i.textContent=p)),he("afterSanitizeElements",i,null),!1)},jo=function(i,p,d){if(To&&(p==="id"||p==="name")&&(d in k||d in Yr||d==="__depth"||d==="__removalCount"))return!1;if(!(Ot&&!Mt[p]&&m(jr,p))){if(!(So&&m(Hr,p))){if(!W[p]||Mt[p]){if(!(Ho(i)&&(N.tagNameCheck instanceof RegExp&&m(N.tagNameCheck,i)||N.tagNameCheck instanceof Function&&N.tagNameCheck(i))&&(N.attributeNameCheck instanceof RegExp&&m(N.attributeNameCheck,p)||N.attributeNameCheck instanceof Function&&N.attributeNameCheck(p))||p==="is"&&N.allowCustomizedBuiltInElements&&(N.tagNameCheck instanceof RegExp&&m(N.tagNameCheck,d)||N.tagNameCheck instanceof Function&&N.tagNameCheck(d))))return!1}else if(!zt[p]){if(!m(wo,te(d,xo,""))){if(!((p==="src"||p==="xlink:href"||p==="href")&&i!=="script"&&Ie(d,"data:")===0&&Io[i])){if(!(vo&&!m(Gr,te(d,xo,"")))){if(d)return!1}}}}}}return!0},Ho=function(i){return i!=="annotation-xml"&&Y(i,Kr)},Go=function(i){he("beforeSanitizeAttributes",i,null);let{attributes:p}=i;if(!p)return;let d={attrName:"",attrValue:"",keepAttr:!0,allowedAttributes:W},b=p.length;for(;b--;){let q=p[b],{name:G,namespaceURI:Z,value:Q}=q,Ve=z(G),J=G==="value"?Q:It(Q);if(d.attrName=Ve,d.attrValue=J,d.keepAttr=!0,d.forceKeepAttr=void 0,he("uponSanitizeAttribute",i,d),J=d.attrValue,d.forceKeepAttr||(St(G,i),!d.keepAttr))continue;if(!Ao&&m(/\/>/i,J)){St(G,i);continue}if(Ft&&m(/((--!?|])>)|<\/(style|title)/i,J)){St(G,i);continue}Ce&&S([Nt,Rt,Lt],qo=>{J=te(J,qo," ")});let Ko=z(i.nodeName);if(jo(Ko,Ve,J)){if(Po&&(Ve==="id"||Ve==="name")&&(St(G,i),J=qr+J),V&&typeof ht=="object"&&typeof ht.getAttributeType=="function"&&!Z)switch(ht.getAttributeType(Ko,Ve)){case"TrustedHTML":{J=V.createHTML(J);break}case"TrustedScriptURL":{J=V.createScriptURL(J);break}}try{Z?i.setAttributeNS(Z,G,J):i.setAttribute(G,J),Bo(i)?ne(i):E(g.removed)}catch{}}}he("afterSanitizeAttributes",i,null)},Qr=function h(i){let p=null,d=Uo(i);for(he("beforeSanitizeShadowDOM",i,null);p=d.nextNode();){if(he("uponSanitizeShadowNode",p,null),zo(p))continue;let b=He(p);p.nodeType===ve.element&&(b&&b.__depth?p.__depth=(p.__removalCount||0)+b.__depth+1:p.__depth=1),(p.__depth>=Do||p.__depth<0||v(p.__depth))&&ne(p),p.content instanceof de&&(p.content.__depth=p.__depth,h(p.content)),Go(p)}he("afterSanitizeShadowDOM",i,null)};return g.sanitize=function(h){let i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},p=null,d=null,b=null,q=null;if(jt=!h,jt&&(h="<!-->"),typeof h!="string"&&!Wo(h))if(typeof h.toString=="function"){if(h=h.toString(),typeof h!="string")throw f("dirty is not a string, aborting")}else throw f("toString is not a function");if(!g.isSupported)return h;if(Ut||Gt(i),g.removed=[],typeof h=="string"&&(qe=!1),qe){if(h.nodeName){let Q=z(h.nodeName);if(!B[Q]||Ke[Q])throw f("root node is forbidden and cannot be sanitized in-place")}}else if(h instanceof Ct)p=Fo("<!---->"),d=p.ownerDocument.importNode(h,!0),d.nodeType===ve.element&&d.nodeName==="BODY"||d.nodeName==="HTML"?p=d:p.appendChild(d);else{if(!De&&!Ce&&!Ae&&h.indexOf("<")===-1)return V&&wt?V.createHTML(h):h;if(p=Fo(h),!p)return De?null:wt?Ge:""}p&&Bt&&ne(p.firstChild);let G=Uo(qe?h:p);for(;b=G.nextNode();){if(zo(b))continue;let Q=He(b);b.nodeType===ve.element&&(Q&&Q.__depth?b.__depth=(b.__removalCount||0)+Q.__depth+1:b.__depth=1),(b.__depth>=Do||b.__depth<0||v(b.__depth))&&ne(b),b.content instanceof de&&(b.content.__depth=b.__depth,Qr(b.content)),Go(b)}if(qe)return h;if(De){if(xt)for(q=Br.call(p.ownerDocument);p.firstChild;)q.appendChild(p.firstChild);else q=p;return(W.shadowroot||W.shadowrootmode)&&(q=zr.call(A,q,!0)),q}let Z=Ae?p.outerHTML:p.innerHTML;return Ae&&B["!doctype"]&&p.ownerDocument&&p.ownerDocument.doctype&&p.ownerDocument.doctype.name&&m(mo,p.ownerDocument.doctype.name)&&(Z="<!DOCTYPE "+p.ownerDocument.doctype.name+`>
`+Z),Ce&&S([Nt,Rt,Lt],Q=>{Z=te(Z,Q," ")}),V&&wt?V.createHTML(Z):Z},g.setConfig=function(){let h=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};Gt(h),Ut=!0},g.clearConfig=function(){Me=null,Ut=!1},g.isValidAttribute=function(h,i,p){Me||Gt({});let d=z(h),b=z(i);return jo(d,b,p)},g.addHook=function(h,i){typeof i=="function"&&(le[h]=le[h]||[],C(le[h],i))},g.removeHook=function(h){if(le[h])return E(le[h])},g.removeHooks=function(h){le[h]&&(le[h]=[])},g.removeAllHooks=function(){le={}},g}var Dr=ho();return Dr})});var Ps={};ns(Ps,{Unrecognized:()=>U});var Jo="options_contextSteamStore",Yo="options_contextSteamMarket",Xo="options_contextItad",Zo="options_contextBartervg",Qo="options_contextSteamdb",er="options_contextSteamdbInstant",tr="options_contextSteamKeys";var or="userNote_syncErrorEmpty",rr="userNote_syncErrorUnknown",sr="userNote_syncErrorLength";var ir=ie(ae()),Oe={version:ir.default.runtime.getManifest().version,db_version:6};var qt=ie(ae());var Cs=ie(ae()),fe=class{constructor(e){this.storageArea=e}get onChanged(){return this.storageArea.onChanged}async get(e){return(await this.storageArea.get(e))[e]??void 0}getObject(e){return this.storageArea.get(e)}set(e,t){return this.storageArea.set({[e]:t})}setObject(e){return this.storageArea.set(e)}remove(...e){return this.storageArea.remove(e)}};var Te=class extends fe{constructor(){super(qt.default.storage.sync)}get QUOTA_BYTES_PER_ITEM(){return qt.default.storage.sync.QUOTA_BYTES_PER_ITEM??8192}},_e=new Te;var At={language:"english",version:Oe.version,version_show:!0,highlight_owned_color:"#00ce67",highlight_wishlist_color:"#0491bf",highlight_coupon_color:"#a26426",highlight_inv_gift_color:"#800040",highlight_inv_guestpass_color:"#513c73",highlight_notinterested_color:"#4f4f4f",highlight_ignored_owned_color:"#4f4f4f",highlight_collection_color:"#856d0e",highlight_waitlist_color:"#4c7521",tag_owned_color:"#00b75b",tag_wishlist_color:"#0383b4",tag_coupon_color:"#c27120",tag_inv_gift_color:"#b10059",tag_inv_guestpass_color:"#65449a",tag_notinterested_color:"#4f4f4f",tag_ignored_owned_color:"#4f4f4f",tag_collection_color:"#856d0e",tag_waitlist_color:"#4c7521",highlight_owned:!0,highlight_wishlist:!0,highlight_coupon:!1,highlight_inv_gift:!1,highlight_inv_guestpass:!1,highlight_notinterested:!1,highlight_ignored_owned:!1,highlight_excludef2p:!1,highlight_collection:!0,highlight_waitlist:!0,tag_owned:!1,tag_wishlist:!1,tag_coupon:!1,tag_inv_gift:!1,tag_inv_guestpass:!1,tag_notinterested:!0,tag_ignored_owned:!0,tag_collection:!1,tag_waitlist:!1,tag_short:!1,hidetmsymbols:!1,showlowestprice:!0,showlowestprice_onwishlist:!0,showlowestpricecoupon:!0,showallstores:!0,excluded_stores:[],override_price:"auto",showregionalprice:"mouse",regional_countries:["us","gb","fr","br","au","jp"],show_es_homepagetabs:!0,showmarkettotal:!1,showsteamrepapi:!0,showmcus:!0,showoc:!0,showhltb:!0,showyoutube:!0,showtwitch:!0,showpcgw:!0,showcompletionistme:!1,showprotondb:!1,showviewinlibrary:!1,showsteamcardexchange:!1,showitadlinks:!0,showsteamdb:!0,showbartervg:!1,showastatslink:!0,showyoutubegameplay:!0,showyoutubereviews:!0,showwsgf:!0,exfgls:!0,app_custom_link:[{enabled:!0,name:"Google",url:"https://www.google.com/search?q=[ID]+[NAME]",icon:"https://www.google.com/images/branding/product/ico/googleg_lodp.ico"}],customize_apppage:{},customize_frontpage:{},show_package_info:!1,show_players_info:!0,show_early_access:!0,show_alternative_linux_icon:!1,show_itad_button:!1,skip_got_steam:!1,installsteam:"show",openinnewtab:!1,keepssachecked:!1,showemptywishlist:!0,user_notes_app:!0,user_notes_wishlist:!0,showwishliststats:!0,oneclickremovewl:!1,user_notes_adapter:"synced_storage",showlanguagewarning:!0,showlanguagewarninglanguage:"english",homepage_tab_selection:"remember",send_age_info:!0,removebroadcasts:!1,mp4video:!1,horizontalscrolling:!0,showsupportinfo:!0,showdrm:!0,regional_hideworld:!1,showinvnav:!0,quickinv:!0,quickinv_diff:-.01,community_default_tab:"",showallstats:!0,replacecommunityhublinks:!1,hideannouncementcomments:!1,showachinstore:!0,hideactivelistings:!1,showlowestmarketprice:!0,hidespamcomments:!1,spamcommentregex:"[\\u2500-\\u25FF]",wlbuttoncommunityapp:!0,removeguideslanguagefilter:!1,confirmdeletecomment:!0,disablelinkfilter:!1,show1clickgoo:!0,show_profile_link_images:"gray",show_custom_themes:!0,profile_pinned_bg:!1,friends_append_nickname:!1,profile_steamrepcn:!0,profile_steamgifts:!0,profile_steamtrades:!0,profile_bartervg:!0,profile_steamrep:!0,profile_steamdbcalc:!0,profile_astats:!0,profile_backpacktf:!0,profile_astatsnl:!0,profile_steamid:!0,profile_custom_link:[{enabled:!0,name:"Google",url:"https://www.google.com/search?q=[ID]",icon:"https://www.google.com/images/branding/product/ico/googleg_lodp.ico"}],group_steamgifts:!0,steamcardexchange:!0,purchase_dates:!0,show_badge_progress:!0,show_coupon:!0,show_wishlist_link:!0,show_wishlist_count:!0,show_progressbar:!0,show_backtotop:!1,profile_showcase_twitch:!0,profile_showcase_own_twitch:!1,profile_showcase_twitch_profileonly:!1,itad_sync_library:!0,itad_sync_wishlist:!0,add_to_waitlist:!1,collection_banner_notowned:!1,itad_sync_notes:!1,context_steam_store:!1,context_steam_market:!1,context_itad:!1,context_bartervg:!1,context_steamdb:!1,context_steamdb_instant:!1,context_steam_keys:!1},Tt=class{constructor(){this.listeners=new Set}addListener(e){this.listeners.add(e)}removeListener(e){this.listeners.delete(e)}invoke(){for(let e of this.listeners)e()}},R=class{static{this.storage=new Te}static{this.onSaveStart=new Tt}static{this.onSaveEnd=new Tt}static async load(){this.data=await this.storage.getObject(At)}static init(){return this.promise||(this.promise=this.load()),this.promise}static getDefault(e){return At[e]}static get(e){if(!this.data)throw new Error("Settings have not been loaded");return this.data[e]}static async set(e,t){this.onSaveStart.invoke(),this.data[e]=t,await this.storage.set(e,t),this.onSaveEnd.invoke()}static remove(e){this.storage.remove(e),this.data[e]=structuredClone(At[e])}static clear(){this.storage.remove(...Object.keys(this.data)),this.data=structuredClone(At)}static async import(e){await this.storage.setObject(e),await this.load()}static asObject(){return structuredClone(this.data)}},M=new Proxy(R,{get(s,e){return s.get(e)},set(s,e,t){return s.set(e,t),!0}});var ar=ie(ae()),Je=class s{static getURL(e){return ar.default.runtime.getURL(e)}static get(e){return fetch(s.getURL(e))}static async getJSON(e){return await(await s.get(e)).json()}static async getText(e){return await(await s.get(e)).text()}};var Ye=class s{static{this.map={english:"en",bulgarian:"bg",czech:"cs",danish:"da",dutch:"nl",finnish:"fi",french:"fr",greek:"el",german:"de",hungarian:"hu",italian:"it",japanese:"ja",koreana:"ko",norwegian:"no",polish:"pl",portuguese:"pt-PT",brazilian:"pt-BR",russian:"ru",romanian:"ro",schinese:"zh-CN",spanish:"es-ES",latam:"es-419",swedish:"sv-SE",tchinese:"zh-TW",thai:"th",turkish:"tr",ukrainian:"ua",vietnamese:"vi"}}constructor(e){this._name=e,this._code=s.map[e]??null}get name(){return this._name}get code(){return this._code}isOneOf(...e){return e.includes(this._name)}};var cr=ie(ae());var Xe=class{static parse(e){let t=e.match(/(.*):\s(.+)/);return t?{name:t[1]??"",message:t[2]??""}:{name:null,message:null}}};var oe=class{static async send(e,t={}){document.dispatchEvent(new CustomEvent("asRequestStart"));try{let o=await cr.default.runtime.sendMessage({action:e,params:t});return document.dispatchEvent(new CustomEvent("asRequestDone")),o}catch(o){let r=Xe.parse(o.message??"");throw document.dispatchEvent(new CustomEvent("asRequestError",{detail:r})),o}}};var Ze=class{static wishlistAdd(e){return oe.send("wishlist.add",{appid:e})}static wishlistRemove(e){return oe.send("wishlist.remove",{appid:e})}static fetchAppDetails(e,t=void 0){return oe.send("appdetails",{appid:e,filter:t})}static getPurchaseDate(e,t){return oe.send("purchases",{appName:e,lang:t})}static getCurrency(){return oe.send("currency")}static clearPurchases(){return oe.send("clearpurchases")}static clearDynamicStore(){return oe.send("dynamicstore.clear")}static getDynamicStoreStatus(e){return oe.send("dynamicstore.status",{ids:e})}static getDynamicStoreRandomApp(){return oe.send("dynamicstore.randomapp")}};var Fe=class{static load(e){return Je.getJSON(`/localization/compiled/${e}.json`)}static async init(e){let t=M.language;e===null?e=new Ye(t):e.name!==t&&(M.language=e.name,Ze.clearPurchases());let o=e.code??"en";try{this.locale=await this.load(o)}catch{console.error(`Failed to load ${o}`),this.locale=await this.load("en")}}};function $t(s,e=null){let t=Fe.locale.strings[s]??"<<missing text>>";if(e!==null)for(let[o,r]of Object.entries(e))t=t.replaceAll(`__${o}__`,String(r));return t}var we=ie(ae()),Qe=class s{static{this.queryLinks={context_steam_store:[Jo,"https://store.steampowered.com/search/?term=__query__",()=>M.context_steam_store],context_steam_market:[Yo,"https://steamcommunity.com/market/search?q=__query__",()=>M.context_steam_market],context_itad:[Xo,"https://isthereanydeal.com/search/?q=__query__",()=>M.context_itad],context_bartervg:[Zo,"https://barter.vg/search?q=__query__",()=>M.context_bartervg],context_steamdb:[Qo,"https://steamdb.info/search/?q=__query__",()=>M.context_steamdb],context_steamdb_instant:[er,"https://steamdb.info/instantsearch/?query=__query__",()=>M.context_steamdb_instant],context_steam_keys:[tr,"https://store.steampowered.com/account/registerkey?key=__query__",()=>M.context_steam_keys]}}static register(){we.default.runtime.onStartup.addListener(s.build),we.default.runtime.onInstalled.addListener(s.build),we.default.contextMenus.onClicked.hasListener(s.onClick)||we.default.contextMenus.onClicked.addListener(s.onClick)}static onClick(e){let t=s.queryLinks[e.menuItemId];if(!t)return;let o=t[1],r=e.selectionText.trim();if(e.menuItemId==="context_steam_keys"){let n=r.match(/[A-Z0-9]{5}(-[A-Z0-9]{5}){2}/g);Array.isArray(n)&&(r=n.join(","))}we.default.tabs.create({url:o.replace("__query__",encodeURIComponent(r))})}static async build(){await R.init(),await Fe.init(null);for(let[e,t]of Object.entries(s.queryLinks)){let[o,r,n]=t;we.default.contextMenus.create({id:e,title:$t(o,{query:"%s"}),contexts:["selection"],visible:n()},()=>we.default.runtime.lastError)}}static update(e){let t=this.queryLinks[e];if(!t)return;let[o,r,n]=t;we.default.contextMenus.update(e,{title:$t(o,{query:"%s"}),contexts:["selection"],visible:n()})}};var as=(s,e)=>e.some(t=>s instanceof t),pr,lr;function cs(){return pr||(pr=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])}function ps(){return lr||(lr=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])}var _r=new WeakMap,Jt=new WeakMap,ur=new WeakMap,Vt=new WeakMap,Xt=new WeakMap;function ls(s){let e=new Promise((t,o)=>{let r=()=>{s.removeEventListener("success",n),s.removeEventListener("error",a)},n=()=>{t(ue(s.result)),r()},a=()=>{o(s.error),r()};s.addEventListener("success",n),s.addEventListener("error",a)});return e.then(t=>{t instanceof IDBCursor&&_r.set(t,s)}).catch(()=>{}),Xt.set(e,s),e}function _s(s){if(Jt.has(s))return;let e=new Promise((t,o)=>{let r=()=>{s.removeEventListener("complete",n),s.removeEventListener("error",a),s.removeEventListener("abort",a)},n=()=>{t(),r()},a=()=>{o(s.error||new DOMException("AbortError","AbortError")),r()};s.addEventListener("complete",n),s.addEventListener("error",a),s.addEventListener("abort",a)});Jt.set(s,e)}var Yt={get(s,e,t){if(s instanceof IDBTransaction){if(e==="done")return Jt.get(s);if(e==="objectStoreNames")return s.objectStoreNames||ur.get(s);if(e==="store")return t.objectStoreNames[1]?void 0:t.objectStore(t.objectStoreNames[0])}return ue(s[e])},set(s,e,t){return s[e]=t,!0},has(s,e){return s instanceof IDBTransaction&&(e==="done"||e==="store")?!0:e in s}};function mr(s){Yt=s(Yt)}function us(s){return s===IDBDatabase.prototype.transaction&&!("objectStoreNames"in IDBTransaction.prototype)?function(e,...t){let o=s.call(Pt(this),e,...t);return ur.set(o,e.sort?e.sort():[e]),ue(o)}:ps().includes(s)?function(...e){return s.apply(Pt(this),e),ue(_r.get(this))}:function(...e){return ue(s.apply(Pt(this),e))}}function ms(s){return typeof s=="function"?us(s):(s instanceof IDBTransaction&&_s(s),as(s,cs())?new Proxy(s,Yt):s)}function ue(s){if(s instanceof IDBRequest)return ls(s);if(Vt.has(s))return Vt.get(s);let e=ms(s);return e!==s&&(Vt.set(s,e),Xt.set(e,s)),e}var Pt=s=>Xt.get(s);function gr(s,e,{blocked:t,upgrade:o,blocking:r,terminated:n}={}){let a=indexedDB.open(s,e),c=ue(a);return o&&a.addEventListener("upgradeneeded",_=>{o(ue(a.result),_.oldVersion,_.newVersion,ue(a.transaction),_)}),t&&a.addEventListener("blocked",_=>t(_.oldVersion,_.newVersion,_)),c.then(_=>{n&&_.addEventListener("close",()=>n()),r&&_.addEventListener("versionchange",u=>r(u.oldVersion,u.newVersion,u))}).catch(()=>{}),c}var ds=["get","getKey","getAll","getAllKeys","count"],gs=["put","add","delete","clear"],Zt=new Map;function dr(s,e){if(!(s instanceof IDBDatabase&&!(e in s)&&typeof e=="string"))return;if(Zt.get(e))return Zt.get(e);let t=e.replace(/FromIndex$/,""),o=e!==t,r=gs.includes(t);if(!(t in(o?IDBIndex:IDBObjectStore).prototype)||!(r||ds.includes(t)))return;let n=async function(a,...c){let _=this.transaction(a,r?"readwrite":"readonly"),u=_.store;return o&&(u=u.index(c.shift())),(await Promise.all([u[t](...c),r&&_.done]))[0]};return Zt.set(e,n),n}mr(s=>({...s,get:(e,t,o)=>dr(e,t)||s.get(e,t,o),has:(e,t)=>!!dr(e,t)||s.has(e,t)}));async function hs(s,e,t,o){if(e==0&&(s.createObjectStore("items"),s.createObjectStore("earlyAccessAppids"),s.createObjectStore("collection"),s.createObjectStore("waitlist"),s.createObjectStore("itadImport"),s.createObjectStore("purchases"),s.createObjectStore("notes")),e<5&&(e>=1&&(s.deleteObjectStore("storePageData"),s.deleteObjectStore("profiles"),s.deleteObjectStore("rates"),s.deleteObjectStore("coupons"),s.deleteObjectStore("giftsAndPasses"),s.deleteObjectStore("dynamicStore"),s.deleteObjectStore("packages")),e>=2&&(s.deleteObjectStore("workshopFileSizes"),s.deleteObjectStore("reviews")),e>=3&&s.deleteObjectStore("expiries"),e>=4&&s.deleteObjectStore("storeList"),s.createObjectStore("storePageData").createIndex("idx_expiry","expiry"),s.createObjectStore("profiles").createIndex("idx_expiry","expiry"),s.createObjectStore("rates").createIndex("idx_expiry","expiry"),s.createObjectStore("coupons").createIndex("idx_appid","appids",{unique:!1,multiEntry:!0}),s.createObjectStore("giftsAndPasses").createIndex("idx_appid","",{unique:!1,multiEntry:!0}),s.createObjectStore("dynamicStore").createIndex("idx_appid","",{unique:!1,multiEntry:!0}),s.createObjectStore("packages").createIndex("idx_expiry","expiry"),s.createObjectStore("workshopFileSizes").createIndex("idx_expiry","expiry"),s.createObjectStore("reviews").createIndex("idx_expiry","expiry"),s.createObjectStore("expiries").createIndex("idx_expiry",""),s.createObjectStore("storeList")),e<6){let r=await o.objectStore("collection").getAllKeys(),n=o.objectStore("collection");for(let a of r)n.put([],a)}console.log(`DB migrated, ${e} -> ${t}`)}var hr={upgrade:hs};var fr=ie(ae());var Qt=class extends fe{constructor(){super(fr.default.storage.local)}},I=new Qt;var eo=class{constructor(e){this.promise=new Promise(t=>setTimeout(t,e))}then(e){return this.promise.then(e)}},to=class{constructor(e,t){this._running=!1;this.onDone=e,this.duration=t,this.reset()}get running(){return this._running}reset(){typeof this.id<"u"&&clearTimeout(this.id),this.id=window.setTimeout(async()=>{await this.onDone(),this._running=!1},this.duration),this._running=!0}stop(){typeof this.id<"u"&&(clearTimeout(this.id),this.id=void 0),this._running=!1}},T=class{static timer(e){return new eo(e)}static resettableTimer(e,t){return new to(e,t)}static now(){return Math.trunc(Date.now()/1e3)}static isInPast(e){return e<=this.now()}static isInFuture(e){return e>this.now()}};var l=class s{static init(){return this.promise||(this.promise=(async()=>{this.db=await gr("Augmented Steam",Oe.db_version,{upgrade:hr.upgrade,blocked(){console.error("Failed to upgrade database, there is already an open connection")}});let e=await I.get("db_cleanup");(!e||T.isInPast(e+86400))&&(console.log("Db cleanup"),await s.cleanup(),await I.set("db_cleanup",T.now()))})()),this.promise}static async cleanup(){let e=[],t=this.db.transaction(this.db.objectStoreNames,"readwrite"),o=await t.objectStore("expiries").index("idx_expiry").openCursor(IDBKeyRange.upperBound(T.now()));for(;o;){let r=o.key;this.db.objectStoreNames.contains(r)&&e.push(t.objectStore(r).clear()),e.push(o.delete()),o=await o.continue()}await Promise.all(e),await Promise.all([this.deleteExpiredEntries("packages","idx_expiry"),this.deleteExpiredEntries("storePageData","idx_expiry"),this.deleteExpiredEntries("profiles","idx_expiry"),this.deleteExpiredEntries("rates","idx_expiry"),this.deleteExpiredEntries("workshopFileSizes","idx_expiry"),this.deleteExpiredEntries("reviews","idx_expiry")])}static async deleteExpiredEntries(e,t){let n=await this.db.transaction(e,"readwrite").store.index(t).openCursor(IDBKeyRange.upperBound(T.now()));if(n)for(;n;)await n.delete(),n=await n.continue()}static async isStoreExpired(e){let t=await this.db.get("expiries",e);return!t||T.isInPast(t)}static async setStoreExpiry(e,t){return this.db.put("expiries",T.now()+t,e)}static async put(e,t,o){await this.db.put(e,t,o)}static async putMany(e,t){let o=this.db.transaction(e,"readwrite"),r=o.store;await Promise.all(t.map(([n,a])=>r.put(a,n))),await o.done}static async replaceAll(e,t){let o=this.db.transaction(e,"readwrite"),r=o.store;await r.clear(),t.length>0&&await Promise.all(t.map(([n,a])=>r.put(a,n))),await o.done}static async get(e,t){return await this.db.get(e,t)}static async getObject(e,t){let o=await this.db.transaction(e).store.openCursor(),r=Object.fromEntries(t.map(n=>[n,void 0]));for(;o;)r[o.key]=o.value,o=await o.continue();return r}static async getFromIndex(e,t,o){return await this.db.transaction(e).store.index(t).get(o)}static async delete(e,...t){for(let o of t)await this.db.delete(e,o)}static async clear(...e){let t=this.db.transaction([...e,"expiries"],"readwrite");for(let o of e)t.objectStore("expiries").delete(o),t.objectStore(o).clear()}static async contains(e,t){let r=this.db.transaction(e).store;return Object.fromEntries(await Promise.all(t.map(async n=>[n,await r.getKey(n)!==void 0])))}};var oo=class extends Error{constructor(e){super(e),this.name="LoginError"}},ro=class extends Error{constructor(e){super(e),this.name="ServerOutageError"}},so=class extends Error{constructor(e){super(e),this.name="OAuth Unauthorized"}},no=class extends Error{constructor(e,t){super(t),this.code=e}},io=class extends Error{constructor(e,t){super(e),this.featureName=t}},O={LoginError:oo,ServerOutageError:ro,HTTPError:no,FeatureDependencyError:io,OAuthUnauthorized:so};var re=class{constructor(e){this.origin=e}getUrl(e,t={}){let o=new URL(e,this.origin);for(let[r,n]of Object.entries(t))n!==void 0&&o.searchParams.set(r,String(n));return o}async fetchJson(e,t={}){let o=await fetch(e,t);if(!o.ok)throw new O.HTTPError(o.status,o.statusText);return await o.json()}async fetchText(e,t={}){let o=await fetch(e,t);if(!o.ok)throw new O.HTTPError(o.status,o.statusText);return await o.text()}};var Dn=ie(xr());var Pe=class{static getVariable(e,t){if(typeof e=="string"){let o=e.match(t);return o&&o[1]?o[1]:null}for(let o of e.querySelectorAll("script"))if(o.textContent){let r=o.textContent.match(t);if(r)return r&&r[1]?r[1]:null}return null}static getStringVariable(e,t=document){let o=typeof e=="string"?new RegExp(`${e}\\s*=\\s*['"](.+?)['"];`):e;return this.getVariable(t,o)}static getIntVariable(e,t=document){let o=typeof e=="string"?new RegExp(`${e}\\s*=\\s*(.+?);`):e,r=this.getVariable(t,o);return r?Number(r):null}static getArrayVariable(e,t=document){let o=typeof e=="string"?new RegExp(`${e}\\s*=\\s*(\\[.+?]);`):e,r=this.getVariable(t,o);return r?JSON.parse(r):null}static getObjectVariable(e,t=document){let o=typeof e=="string"?new RegExp(`${e}\\s*=\\s*(\\{.+?});`):e,r=this.getVariable(t,o);return r?JSON.parse(r):null}};var fs=ie(ae());var et=class{static escapeRegExp(e){return e.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}static clearSpecialSymbols(e){return e.replace(/[\u00AE\u00A9\u2122]/g,"")}static levenshtein(e,t){let o=e.length,r=t.length;if(o===0)return r;if(r===0)return o;let n,a,c,_,u,S,E,C,L,ee,Y;for(o>r&&(n=e,e=t,t=n),S=new Int8Array(o+1),a=0;a<=o;a++)S[a]=a;for(a=1;a<=r;a++){for(_=a,Y=t[a-1],c=1;c<=o;c++)Y===e[c-1]?u=S[c-1]:(E=_+1,C=S[c]+1,L=E-(E-C&C-E>>7),ee=S[c-1]+1,u=L-(L-ee&ee-L>>7)),S[c-1]=_,_=u;S[o]=_}return S[o]}};var tt=class{constructor(){this.parser=new DOMParser}dom(e){return this.parser.parseFromString(e,"text/html")}parseCurrencyFromWallet(e){return this.dom(e).querySelector("input[name=currency]")?.value??null}parseCurrencyFromApp(e){return this.dom(e).querySelector("meta[itemprop=priceCurrency][content]")?.getAttribute("content")??null}parseWorkshopFileSize(e){let t=this.dom(e).querySelector(".detailsStatRight")?.textContent;if(!t)return-1;let o=t.match(/(\d+(?:[.,]\d+)?) (MB|KB|B)/);if(!o)return-2;let r=parseFloat(o[1].replace(/,/g,""));if(Number.isNaN(r))return-2;let n=o[2];return r*{MB:1e3,KB:1,B:.001}[n]}parseReviews(e){let t=[];for(let o of this.dom(e).querySelectorAll(".review_box")){let r=o.querySelector("[src*=thumbsUp]")?1:0,[n=0,a=0]=Array.from(o.querySelector(".header")?.childNodes??[]).filter(Y=>Y.nodeType===Node.TEXT_NODE).map(Y=>{let te=Y.textContent?.match(/(?:\d+,)?\d+/);return te?Number(te[0].replace(/,/g,"")):0}),c=o.querySelector(".content").textContent.trim().length,_=o.querySelector("input[id^=ReviewVisibility]"),u=_?Number(_.value):0,S=_?_.id.replace("ReviewVisibility",""):o.querySelector(".control_block > a").id.replace("RecommendationVoteUpBtn",""),E=o.querySelector(".hours").textContent.match(/(?:\d+,)?\d+\.\d+/),C=E?parseFloat(E[0].replace(/,/g,"")):0,L=Array.from(o.querySelectorAll(".review_award")).reduce((Y,te)=>{let Ie=te.classList.contains("more_btn")?0:Number(te.querySelector(".review_award_count").textContent.trim());return Y+Ie},0),ee=o.nextElementSibling?.classList.contains("review_developer_response_container")?o.nextElementSibling.outerHTML:"";t.push({default:0,rating:r,helpful:n,funny:a,length:c,visibility:u,playtime:C,awards:L,node:o.outerHTML+ee,id:S})}return t}parsePurchaseDates(e){let t=[/- Complete Pack/ig,/Standard Edition/ig,/Steam Store and Retail Key/ig,/- Hardware Survey/ig,/ComputerGamesRO -/ig,/Founder Edition/ig,/Retail( Key)?/ig,/Complete$/ig,/Launch$/ig,/Free$/ig,/(RoW)/ig,/ROW/ig,/:/ig],o=[],n=this.dom(e).querySelectorAll("#main_content td.license_date_col");for(let a of n){let c=a.nextElementSibling;if(!c)continue;c.querySelector("div")?.remove();let _=et.clearSpecialSymbols(c.textContent.trim());for(let u of t)_=_.replace(u,"");_=_.trim(),o.push([_,a.textContent])}return o}};var ye=class{static{this.parser=null}static getParser(){return this.parser||(this.parser=new tt),this.parser}};var ot=class extends re{constructor(){super("https://steamcommunity.com/")}async fetchPage(e){let t=await fetch(e,{credentials:"include"});if(!t.ok)throw new O.HTTPError(t.status,t.statusText);if(new URL(t.url).pathname==="/login/home/")throw new O.LoginError("community");return await t.text()}fetchBadgeInfo(e,t){let o=this.getUrl(`/profiles/${e}/ajaxgetbadgeinfo/${t}`);return this.fetchJson(o,{credentials:"include"})}async fetchWorkshopFileSize(e){let t=this.getUrl("/sharedfiles/filedetails/",{id:e}),o=await this.fetchText(t,{credentials:"include"}),n=await ye.getParser().parseWorkshopFileSize(o);if(n===-1)throw new Error(`Couldn't find details block for item id "${e}"`);if(n===-2)throw new Error(`Invalid file size for item id "${e}"`);return n}async getWorkshopFileSize(e,t){let o=await l.get("workshopFileSizes",e);if(!o||T.isInPast(o.expiry)){if(t)return await l.delete("workshopFileSizes",e),null;o={size:await this.fetchWorkshopFileSize(e),expiry:T.now()+5*86400},await l.put("workshopFileSizes",o,e)}return o.size}async fetchReviews(e,t){let o=ye.getParser(),r=[],n=0;for(let a=1;a<=t;a++){let c=this.getUrl(`${e}/recommended`,{p:a}),_=await this.fetchPage(c),u=await o.parseReviews(_);for(let S of u)S.default=n++,r.push(S)}return r}async getReviews(e,t){let o=await l.get("reviews",e);return(!o||T.isInPast(o.expiry))&&(o={data:await this.fetchReviews(e,t),expiry:T.now()+60*60},await l.put("reviews",o,e)),o.data}async login(e){if(!e)throw await this.logout(),new Error("Login endpoint needs a valid profile path");if(!e.startsWith("/id/")&&!e.startsWith("/profiles/"))throw await this.logout(),new Error(`Could not interpret ${e} as a valid profile path`);let t=await I.get("login");if(t?.profilePath===e)return t;let o=this.getUrl(e),r=await this.fetchText(o),a=Pe.getObjectVariable("g_rgProfileData",r)?.steamid;if(!a)throw new Error("Failed to retrieve steamID from profile");await this.logout(!0);let c={steamId:a,profilePath:e};return await I.set("login",c),c}async logout(e=void 0){e===void 0&&(e=await I.get("login")!==void 0),e&&await Promise.all([I.remove("login"),I.remove("storeCountry"),I.remove("currency")])}async setStoreCountry(e){await I.set("storeCountry",e)}async getStoreCountry(){return await I.get("storeCountry")??null}handle(e){switch(e.action){case"community.badgeinfo":return this.fetchBadgeInfo(e.params.steamId,e.params.appid);case"community.workshopFileSize":return this.getWorkshopFileSize(e.params.id,e.params.preventFetch);case"community.reviews":return this.getReviews(e.params.steamId,e.params.pages);case"community.login":return this.login(e.params.profilePath);case"community.logout":return this.logout(e.params.force??void 0);case"community.storecountry.set":return this.setStoreCountry(e.params.newCountry);case"community.storecountry.get":return this.getStoreCountry()}return U}};var ke=class extends re{constructor(){super("https://store.steampowered.com/")}async fetchPage(e){let t=await fetch(e,{credentials:"include"});if(!t.ok)throw new O.HTTPError(t.status,t.statusText);if(new URL(t.url).pathname==="/login/")throw new O.LoginError("store");return await t.text()}async fetchPackageApps(e){let t=this.getUrl("/api/packagedetails/",{packageids:e}),r=(await this.fetchJson(t))[String(e)];return r&&r.success?r.data.apps.map(n=>n.id):[]}async getPackageApps(e){let t=new Map,o=[],r=await l.getObject("packages",e);for(let[n,a]of Object.entries(r))!a||T.isInPast(a.expiry)?o.push(Number(n)):t.set(Number(n),a.appids);if(o.length>0){let n=[];for(let a of o){let c=await this.fetchPackageApps(a);n.push([a,{appids:c,expiry:T.now()+86400}]),t.set(a,c)}n.length>0&&await l.putMany("packages",n)}return t}async wishlistAdd(e){let t,o=await this.fetchSessionId();if(o){let r=this.getUrl("/api/addtowishlist");t=await this.fetchJson(r,{method:"POST",credentials:"include",body:new URLSearchParams({sessionid:o,appid:String(e)})})}if(!t||!t.success)throw new Error(`Failed to add app ${e} to wishlist`);await this.clearDynamicStore()}async wishlistRemove(e){let t,o=await this.fetchSessionId();if(o){let r=this.getUrl("/api/removefromwishlist");t=await this.fetchJson(r,{method:"POST",credentials:"include",body:new URLSearchParams({sessionid:o,appid:String(e)})})}if(!t||!t.success)throw new Error(`Failed to remove app ${e} from wishlist`);await this.clearDynamicStore()}async getCurrencyFromWallet(e){let t=this.getUrl("/steamaccount/addfunds"),o=await this.fetchPage(t);return e.parseCurrencyFromWallet(o)}async getCurrencyFromApp(e){let t=this.getUrl("/app/220"),o=await this.fetchPage(t);return e.parseCurrencyFromApp(o)}async getCurrency(){let e=await I.get("currency");if(e&&T.isInFuture(e.expiry))return e.data;let t=ye.getParser(),o=await this.getCurrencyFromWallet(t);if(!o&&(o=await this.getCurrencyFromApp(t),!o))throw new Error("Store currency could not be determined from app 220");return await I.set("currency",{data:o,expiry:T.now()+86400}),o}async fetchSessionId(){let e=this.getUrl("/about/"),t=await this.fetchPage(e);return Pe.getStringVariable("g_sessionID",t)}async fetchPurchaseDates(e){let t=this.getUrl("/account/licenses/",{l:e}),o=await this.fetchPage(t);return ye.getParser().parsePurchaseDates(o)}async getPurchaseDate(e,t){if(await l.isStoreExpired("purchases")){let o=await this.fetchPurchaseDates(t);await l.putMany("purchases",o),await l.setStoreExpiry("purchases",86400)}return await l.get("purchases",e)??null}clearPurchases(){return l.clear("purchases")}async refreshDynamicStore(){if(!await l.isStoreExpired("dynamicStore"))return;let t=this.getUrl("dynamicstore/userdata"),o=await this.fetchJson(t,{cache:"no-cache"}),{rgOwnedApps:r,rgOwnedPackages:n,rgIgnoredApps:a,rgWishlist:c}=o,_=[],u=[];for(let[S,E]of Object.entries(a)){let C=Number(S);E===0?_.push(C):E===2&&u.push(C)}await l.putMany("dynamicStore",[["ignored",_],["ignoredOwnedElsewhere",u],["ownedApps",r],["ownedPackages",n],["wishlisted",c]]),await l.setStoreExpiry("dynamicStore",5*60)}async getDynamicStoreStatus(e){await this.refreshDynamicStore();let r=l.db.transaction("dynamicStore").store.index("idx_appid"),n=[],a=[],c=[],_=[];for(let u of e){let S=u.split("/",2);if(S.length!=2)continue;let E=S[0],C=Number(S[1]),L=await r.getAllKeys(C);for(let ee of L)switch(ee){case"ignored":n.push(u);break;case"ignoredOwnedElsewhere":a.push(u);break;case"wishlisted":_.push(u);break;case"ownedApps":E==="app"&&c.push(u);break;case"ownedPackages":E==="sub"&&c.push(u);break}}return{ignored:n,ignoredOwned:a,owned:c,wishlisted:_}}async dynamicStoreRandomApp(){await this.refreshDynamicStore();let e=await l.get("dynamicStore","ownedApps");return!e||!Array.isArray(e)||e.length===0?null:e[Math.floor(Math.random()*e.length)]}async clearDynamicStore(){await l.clear("dynamicStore")}async fetchAppDetails(e,t=void 0){let o=this.getUrl("api/appdetails/",{appids:e,filter:t}),r=await this.fetchJson(o,{credentials:"include"}),n=String(e);if(r&&r[n]){let a=r[n];if(a.success)return a.data}return null}handle(e){switch(e.action){case"wishlist.add":return this.wishlistAdd(e.params.appid);case"wishlist.remove":return this.wishlistRemove(e.params.appid);case"appdetails":return this.fetchAppDetails(e.params.appid,e.params.filter??void 0);case"currency":return this.getCurrency();case"sessionid":return this.fetchSessionId();case"purchases":return this.getPurchaseDate(e.params.appName,e.params.lang);case"clearpurchases":return this.clearPurchases();case"dynamicstore.clear":return this.clearDynamicStore();case"dynamicstore.status":return this.getDynamicStoreStatus(e.params.ids);case"dynamicstore.randomapp":return this.dynamicStoreRandomApp()}return U}};var ce={ApiServerHost:"https://api.augmentedsteam.com",PublicHost:"https://augmentedsteam.com",ITADApiServerHost:"https://api.isthereanydeal.com",ITADServer:"https://isthereanydeal.com",ITADClientId:"5fe78af07889f43a",ITADDiscord:"https://discord.gg/yn57q7f"};var be=ie(ae());var j=class{static{this.loadPromise=void 0}static load(){return this.loadPromise||(this.loadPromise=(async()=>{let e=await I.get("access_token");return e?T.isInPast(e.expiry)?(await I.remove("access_token"),null):e.token:null})()),this.loadPromise}static async create(e,t){await I.set("access_token",{token:e,expiry:T.now()+t}),this.loadPromise=void 0}static async clear(){await I.remove("access_token"),this.loadPromise=void 0}};var rt=class{constructor(){this.RedirectURI="https://isthereanydeal.com/connectaugmentedsteam"}generateString(e){let t="abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789.~",o=new Uint8Array(e);return crypto.getRandomValues(o),o.reduce((r,n)=>r+t.charAt(Math.floor(n%t.length)),"")}async sha256(e){let o=new TextEncoder().encode(e),r=await crypto.subtle.digest("SHA-256",o);return String.fromCharCode(...new Uint8Array(r))}base64url(e){return btoa(e).replace(/\+/g,"-").replace(/\//g,"_").replace(/=+$/,"")}async getResponseUrl(e){return new Promise((t,o)=>{let r=(a,c,_)=>{a===e&&c.url?.startsWith(this.RedirectURI)&&(be.default.tabs.onUpdated.removeListener(r),be.default.tabs.onRemoved.removeListener(n),be.default.tabs.remove(a),t(new URL(c.url)))},n=(a,c)=>{a===e&&(be.default.tabs.onUpdated.removeListener(r),be.default.tabs.onRemoved.removeListener(n),o())};be.default.tabs.onUpdated.addListener(r),be.default.tabs.onRemoved.addListener(n)})}async authorize(e){let t=this.generateString(64),o=this.generateString(30),r=new URL(`${ce.ITADServer}/oauth/authorize/`);r.searchParams.set("response_type","code"),r.searchParams.set("client_id",ce.ITADClientId),r.searchParams.set("redirect_uri",this.RedirectURI),r.searchParams.set("scope",e.join(" ")),r.searchParams.set("state",o),r.searchParams.set("code_challenge",this.base64url(await this.sha256(t))),r.searchParams.set("code_challenge_method","S256");let n=await be.default.tabs.create({url:r.toString()});if(!n.id)throw new Error("Missing tab id");let a=await this.getResponseUrl(n.id);if(a.searchParams.get("state")!==o)throw new Error("Failed to verify state parameter from URL fragment");let c=a.searchParams.get("code");if(!c)throw new Error("Failed to receive code");let _=new URL("oauth/token/",ce.ITADServer),u=new URLSearchParams;u.set("grant_type","authorization_code"),u.set("client_id",ce.ITADClientId),u.set("redirect_uri",this.RedirectURI),u.set("code",c),u.set("code_verifier",t);let E=await(await fetch(_,{method:"POST",body:u})).json(),C=E.access_token,L=E.expires_in;if(!C||!L)throw new Error("Authorization failed");await j.create(C,Number(L))}};var Ue=class extends Error{constructor(e,t=void 0){super(t),this.name="OutOfCapacityError",this.ratio=e}};var st=class{constructor(e=!1,t){this.closeToFull=e,this.utilization=t}};var nt=class{async getNotesMap(){return new Map(Object.entries(await _e.get("user_notes")??{}).map(([e,t])=>[Number(e),t]))}async get(...e){let t=new Map(e.map(r=>[r,null])),o=await _e.get("user_notes");if(o)for(let[r,n]of Object.entries(o)){let a=Number(r);t.has(a)&&t.set(a,n)}return t}async set(e,t){let o=await this.getNotesMap();o.set(e,t);let r=Object.fromEntries(o.entries()),n=this.getNotesSize(r)/_e.QUOTA_BYTES_PER_ITEM;if(n>1)throw new Ue(n,"Can't set this user note, out of capacity");return await _e.set("user_notes",r),new st(n>.85,n)}async delete(e){let t=await this.getNotesMap();return t.delete(e),t.size>0?_e.set("user_notes",Object.fromEntries(t.entries())):_e.remove("user_notes")}async export(){let e=await this.getNotesMap();return Object.fromEntries(e.entries())}async import(e){let t=this.getNotesSize(e)/_e.QUOTA_BYTES_PER_ITEM;if(t>1)throw new Ue(t,"Import to synced storage failed, too much data for this adapter");return _e.set("user_notes",e)}clear(){return _e.remove("user_notes")}getNotesSize(e){return 10+JSON.stringify(e).length}};var wr=250,xs=40,ws=84600,ys=5*60,bs=15*60,Ss=15*60,vs=2*60,As=["wait_read","wait_write","coll_read","coll_write","notes_read","notes_write"],it=class extends re{constructor(){super(ce.ITADApiServerHost)}async fetchStoreList(){let e=this.getUrl("service/shops/v1"),t=await this.fetchJson(e);if(!Array.isArray(t))throw new Error("Can't read store list from response");return t.map(o=>({id:o.id,title:o.title}))}async fetchSteamIds(e){let t=this.getUrl("lookup/shop/61/id/v1"),o=await this.fetchJson(t,{method:"POST",headers:{"content-type":"application/json"},body:JSON.stringify(e)}),r=new Map;for(let[n,a]of Object.entries(o))if(a!==null)for(let c of a)r.set(c,n);return r}async fetchGameIds(e){let t=this.getUrl("lookup/id/shop/61/v1"),o=await this.fetchJson(t,{method:"POST",headers:{"content-type":"application/json"},body:JSON.stringify(e)}),r=new Map;for(let[n,a]of Object.entries(o))a!==null&&r.set(n,a);return r}async fetchCollection(){let e=await j.load();if(!e)return null;let t=await this.fetchJson(this.getUrl("/collection/games/v1"),{headers:{authorization:"Bearer "+e}});if(t.length===0)return null;let o=new Map;for(let c of t)o.set(c.id,[]);let r=await this.fetchJson(this.getUrl("/collection/copies/v1"),{headers:{authorization:"Bearer "+e}});for(let c of r){let _=c.game.id,u={redeemed:c.redeemed};c.shop&&(u.shop=c.shop.name),c.note&&(u.note=c.note),c.tags.length>0&&(u.tags=c.tags.map(S=>S.tag)),o.get(_)?.push(u)}let n=await this.fetchSteamIds([...o.keys()]),a=new Map;for(let[c,_]of n.entries())a.set(c,o.get(_)??[]);return a}async fetchWaitlist(){let e=await j.load();if(!e)return null;let t=this.getUrl("/waitlist/games/v1"),o=await this.fetchJson(t,{headers:{authorization:"Bearer "+e}});if(o.length===0)return null;let r=o.map(n=>n.id);return await this.fetchSteamIds(r)}async getStoreList(){if(await l.isStoreExpired("storeList")){let e=await this.fetchStoreList();return await l.replaceAll("storeList",e.map(t=>[t.id,t])),await l.setStoreExpiry("storeList",ws),e}else return await l.db.getAll("storeList")}async isConnected(){return await j.load()!==null}async disconnect(){return await j.clear(),await I.remove("lastItadImport"),await I.remove("syncEvents"),l.clear("collection","waitlist","itadImport")}async getLastImport(){return await I.get("lastItadImport")??{from:null,to:null}}async recordLastImport(){let e=await this.getLastImport();e.from=T.now(),await I.set("lastItadImport",e)}async getSyncEvents(){return await I.get("syncEvents")??[]}async recordSyncEvent(e,t,o){let r=await this.getSyncEvents();r.unshift({section:e,type:t,timestamp:T.now(),count:o}),await I.set("syncEvents",r.slice(0,xs))}async removeFromWaitlist(e){let t=await j.load();if(!t)throw new Error("Missing access token");if(e.length===0)throw new Error("Can't remove nothing from ITAD Waitlist!");let o=e.map(n=>`app/${n}`),r=await Promise.all(o.map(n=>l.get("waitlist",n)));if(r=r.filter(n=>n),r.length>0){let n=this.getUrl("waitlist/games/v1"),a=await fetch(n,{method:"DELETE",headers:{authorization:"Bearer "+t},body:JSON.stringify(r)});if(!a.ok)throw new O.HTTPError(a.status,a.statusText);return l.delete("waitlist",...o)}}async addToWaitlist(e){let t=await j.load();if(!t)throw new Error("Missing access token");let o=e.map(n=>`app/${n}`),r=await this.fetchGameIds(o);if(r.size!==0){let n=await fetch(new URL("waitlist/games/v1",ce.ITADApiServerHost),{method:"PUT",headers:{authorization:"Bearer "+t},body:JSON.stringify(Array.from(r.values()))});if(!n.ok)throw new O.HTTPError(n.status,n.statusText);return l.putMany("waitlist",[...r])}}async addToCollection(e,t){let o=await j.load();if(!o)throw new Error("Missing access token");let r=[...e.map(a=>`app/${a}`),...t.map(a=>`sub/${a}`)];if(r.length===0)return;let n=await this.fetchGameIds(r);if(n.size!==0&&(await fetch(new URL("collection/games/v1",ce.ITADApiServerHost),{method:"PUT",headers:{authorization:"Bearer "+o},body:JSON.stringify(Array.from(n.values()))})).ok)return l.putMany("collection",[...n.keys()].map(c=>[c,[]]))}async exportToItad(e){if(await R.load(),!M.itad_sync_library&&!M.itad_sync_wishlist)return;if(!e){let o=await this.getLastImport();if(o.to&&T.isInFuture(o.to+ys))return}if(M.itad_sync_library){let o=l.db.transaction(["dynamicStore","itadImport"]),r=o.objectStore("dynamicStore"),n=o.objectStore("itadImport"),a=new Set(await n.get("lastOwnedApps")??[]),c=new Set(await n.get("lastOwnedPackages")??[]),_=await r.get("ownedApps")??[],u=await r.get("ownedPackages")??[];await o.done;let S=_.filter(C=>e||!a.has(C)),E=u.filter(C=>e||!c.has(C));(S.length>0||E.length>0)&&(await this.addToCollection(S,E),await l.putMany("itadImport",[["lastOwnedApps",_],["lastOwnedPackages",u]])),await this.recordSyncEvent("collection","push",S.length+E.length)}if(M.itad_sync_wishlist){let o=l.db.transaction(["dynamicStore","itadImport"]),r=o.objectStore("dynamicStore"),n=o.objectStore("itadImport"),a=new Set(await n.get("lastWishlisted")??[]),c=await r.get("wishlisted")??[];await o.done;let _=c.filter(u=>e||!a.has(u));_.length>0&&(await this.addToWaitlist(_),await l.put("itadImport",c,"lastWishlisted")),await this.recordSyncEvent("waitlist","push",_.length)}let t=await this.getLastImport();t.to=T.now(),await I.set("lastItadImport",t)}async importWaitlist(e){if(await R.load(),!!M.itad_sync_wishlist&&(e||await l.isStoreExpired("waitlist"))){let t=await this.fetchWaitlist();await l.replaceAll("waitlist",t?[...t.entries()]:[]),await l.setStoreExpiry("waitlist",bs),await this.recordLastImport(),await this.recordSyncEvent("waitlist","pull",t?.size??0)}}async importCollection(e){if(await R.load(),!!M.itad_sync_library&&(e||await l.isStoreExpired("collection"))){let t=await this.fetchCollection();await l.replaceAll("collection",t?[...t.entries()]:[]),await l.setStoreExpiry("collection",Ss),await this.recordLastImport(),await this.recordSyncEvent("collection","pull",t?.size??0)}}async sync(e){await R.load(),await this.exportToItad(e),await this.importWaitlist(e),await this.importCollection(e),M.itad_sync_notes&&await this.pullNotes(e)}async inWaitlist(e){return await this.importWaitlist(!1),l.contains("waitlist",e)}async inCollection(e){return await this.importCollection(!1),l.contains("collection",e)}async getFromCollection(e){return await this.importCollection(!1),await l.get("collection",e)??null}async pullNotes(e){if(await R.load(),!e&&!await l.isStoreExpired("notes"))return 0;let t=await j.load();if(!t)throw new O.OAuthUnauthorized;let o=await this.fetchJson(this.getUrl("/user/notes/v1"),{method:"GET",headers:{authorization:"Bearer "+t,accept:"application/json"}}),r=new Map;if(o.length!==0){let n=new Map(o.map(c=>[c.gid,c.note])),a=await this.fetchSteamIds([...n.keys()]);for(let[c,_]of a){if(!c.startsWith("app/"))continue;let u=Number(c.substring(4)),S=n.get(_);r.set(u,S)}switch(M.user_notes_adapter){case"synced_storage":let c=new nt;for(let[_,u]of r)await c.set(_,u);break;case"idb":await l.putMany("notes",[...r.entries()].map(([_,u])=>[Number(_),u]));break}}return await l.setStoreExpiry("notes",vs),await this.recordLastImport(),await this.recordSyncEvent("notes","pull",r.size),r.size}async pushNotes(e){let t=await j.load();if(!t)throw new O.OAuthUnauthorized;let o={pushed:0,errors:[]};if(e.length===0)return o;let r=new Map(e),n=[...r.keys()].map(_=>`app/${_}`),a=await this.fetchGameIds(n),c=[];for(let[_,u]of r.entries()){if(u=u.trim(),u===""){o.errors.push([_,or,null]);continue}if(u.length>wr){o.errors.push([_,sr,{length:u.length,max:wr}]);continue}let S=a.get(`app/${_}`)??null;if(S===null){o.errors.push([_,rr,null]);continue}c.push({gid:S,note:u})}if(c.length!==0){let _=await fetch(this.getUrl("/user/notes/v1"),{method:"PUT",headers:{authorization:"Bearer "+t,"content-type":"application/json",accept:"application/json"},body:JSON.stringify(c)});if(!_.ok)throw new O.HTTPError(_.status,_.statusText)}return o.pushed=c.length,await this.recordSyncEvent("notes","push",o.pushed),o}async deleteNotes(e){let t=await j.load();if(!t)throw new O.OAuthUnauthorized;let o=await this.fetchGameIds(e.map(n=>`app/${n}`)),r=await fetch(this.getUrl("/user/notes/v1"),{method:"DELETE",headers:{authorization:"Bearer "+t,"content-type":"application/json"},body:JSON.stringify([...o.values()])});if(!r.ok)throw new O.HTTPError(r.status,r.statusText)}handle(e){switch(e.action){case"itad.storelist":return this.getStoreList();case"itad.authorize":return new rt().authorize(As);case"itad.disconnect":return this.disconnect();case"itad.isconnected":return this.isConnected();case"itad.export":return this.exportToItad(e.params.force);case"itad.sync":return this.sync(e.params.force);case"itad.lastimport":return this.getLastImport();case"itad.syncevents":return this.getSyncEvents();case"itad.inwaitlist":return this.inWaitlist(e.params.storeIds);case"itad.addtowaitlist":return this.addToWaitlist(e.params.appids);case"itad.removefromwaitlist":return this.removeFromWaitlist(e.params.appids);case"itad.incollection":return this.inCollection(e.params.storeIds);case"itad.getfromcollection":return this.getFromCollection(e.params.storeId);case"itad.notes.pull":return this.pullNotes(!0);case"itad.notes.push":return this.pushNotes(e.params.notes);case"itad.notes.delete":return this.deleteNotes(e.params.appids)}return U}};var at=class extends re{constructor(){super(ce.ApiServerHost)}fetchStorePageData(e){let t=this.getUrl(`app/${e}/v2`);return this.fetchJson(t)}fetchRates(e){let t=this.getUrl("rates/v1",{to:e.join(",")});return this.fetchJson(t)}fetchEarlyAccess(){let e=this.getUrl("early-access/v1");return this.fetchJson(e)}fetchSteamPeek(e){let t=this.getUrl(`similar/${e}/v2`,{count:15});return this.fetchJson(t)}fetchDlcInfo(e){let t=this.getUrl(`dlc/${e}/v2`);return this.fetchJson(t)}fetchProfile(e){let t=this.getUrl(`profile/${e}/v2`);return this.fetchJson(t)}fetchTwitch(e){let t=this.getUrl(`twitch/${e}/stream/v2`);return this.fetchJson(t)}fetchProfileBackgrounds(e){let t=this.getUrl("profile/background/list/v2",{appid:e});return this.fetchJson(t)}fetchProfileBackgroundsGames(){let e=this.getUrl("profile/background/games/v1");return this.fetchJson(e)}fetchMarketCardPrices(e,t){let o=this.getUrl("market/cards/v2",{currency:e,appid:t});return this.fetchJson(o)}fetchMarketAverageCardPrices(e,t){let o=this.getUrl("market/cards/average-prices/v2",{currency:e,appids:t.join(",")});return this.fetchJson(o)}fetchPrices(e,t,o,r,n,a){let c=this.getUrl("prices/v2");return this.fetchJson(c,{method:"POST",body:JSON.stringify({country:e,apps:t,subs:o,bundles:r,voucher:n,shops:a})})}async getProfileData(e){let o=await l.get("profiles",e);return(!o||T.isInPast(o.expiry))&&(o={data:await this.fetchProfile(e),expiry:T.now()+86400},await l.put("profiles",o,e)),o.data}clearOwn(e){return l.delete("profiles",e)}async getStorePageData(e){let o=await l.get("storePageData",e);return(!o||T.isInPast(o.expiry))&&(o={data:await this.fetchStorePageData(e),expiry:T.now()+3600},await l.put("storePageData",o,e)),o.data}expireStorePageData(e){return l.delete("storePageData",e)}async getRates(e){let o=e.join(","),r=await l.get("rates",o);return(!r||T.isInPast(r.expiry))&&(r={data:await this.fetchRates(e),expiry:T.now()+3600},await l.put("rates",r,o)),r.data}clearRates(){return l.clear("rates")}async isEarlyAccess(e){if(await l.isStoreExpired("earlyAccessAppids")){let r=await this.fetchEarlyAccess();await l.replaceAll("earlyAccessAppids",r.map(n=>[n,n])),await l.setStoreExpiry("earlyAccessAppids",7200)}return l.contains("earlyAccessAppids",e)}handle(e){switch(e.action){case"prices":{let{country:t,apps:o,subs:r,bundles:n,voucher:a,shops:c}=e.params;return this.fetchPrices(t,o,r,n,a,c)}case"dlcinfo":return this.fetchDlcInfo(e.params.appid);case"storepagedata":return this.getStorePageData(e.params.appid);case"storepagedata.expiry":return this.expireStorePageData(e.params.appid);case"rates":return this.getRates(e.params.to);case"clearrates":return this.clearRates();case"isea":return this.isEarlyAccess(e.params.appids);case"profile.background":return this.fetchProfileBackgrounds(e.params.appid);case"profile.background.games":return this.fetchProfileBackgroundsGames();case"twitch.stream":return this.fetchTwitch(e.params.channelId);case"market.cardprices":return this.fetchMarketCardPrices(e.params.currency,e.params.appid);case"market.averagecardprices":return this.fetchMarketAverageCardPrices(e.params.currency,e.params.appids);case"steampeek":return this.fetchSteamPeek(e.params.appid);case"profile":return this.getProfileData(e.params.steamId);case"clearownprofile":return this.clearOwn(e.params.steamId)}return U}};var ct=class{getNote(e){return l.getObject("notes",e)}async setNote(e,t){await l.put("notes",t,e)}deleteNote(e){return l.delete("notes",e)}async getAllNotes(){let t=await l.db.transaction("notes").store.openCursor(),o={};for(;t;)o[t.key]=t.value,t=await t.continue();return o}async setAllNotes(e){return await this.clearNotes(),l.putMany("notes",Object.entries(e).map(([t,o])=>[Number(t),o]))}clearNotes(){return l.clear("notes")}handle(e){switch(e.action){case"notes.get":return this.getNote(e.params.appids);case"notes.set":return this.setNote(e.params.appid,e.params.note);case"notes.delete":return this.deleteNote(e.params.appid);case"notes.getall":return this.getAllNotes();case"notes.setall":return this.setAllNotes(e.params.notes);case"notes.clear":return this.clearNotes()}return U}};var kt=ie(ae());var pt=class{constructor(e,t){this.type_=e;this.id_=t;this.full=`${this.type_}/${this.id_}`}get type(){return this.type_}get number(){return this.id_}get string(){return this.full}};var Be=class extends pt{static fromUrl(e){let t=e.match(/(?:store\.steampowered|steamcommunity)\.com\/(?:app|games|market\/listings)\/(\d+)\/?/);return t&&t[1]!==void 0?Number(t[1]):null}static fromCDNUrl(e){let t=/(?:cdn\.(?:(?:akamai|cloudflare|fastly)\.)?steamstatic\.com\/steam|steamcdn-a\.akamaihd\.net\/steam|steamcommunity\/public\/images)\/apps\/(\d+)\//,o=/shared\.(?:(?:akamai|cloudflare|fastly)\.)?steamstatic\.com\/store_item_assets\/steam\/apps\/(\d+)\//,r=e.match(t)??e.match(o);return r&&r[1]!==void 0?Number(r[1]):null}static fromGameCardUrl(e){let t=e.match(/\/gamecards\/(\d+)/);return t&&t[1]!==void 0?Number(t[1]):null}static fromElement(e){if(!e)return null;let t=e.dataset.dsAppid;if(t)return Number(t);let o=e.getAttribute("href");return o?this.fromUrl(o):null}static fromImageElement(e){if(!e)return null;let t=e.getAttribute("src");return t?this.fromCDNUrl(t):e.dataset.imageUrl?this.fromCDNUrl(e.dataset.imageUrl):null}static fromText(e){let t=/(?:store\.steampowered|steamcommunity)\.com\/app\/(\d+)\/?/g,o=[],r;for(;(r=t.exec(e))!==null;)o.push(Number(r[1]));return o}constructor(e){super("app",e)}};var lt=class extends re{constructor(){super("https://steamcommunity.com/")}async loadInventory(e){let t=await I.get("login");if(!t||!t.steamId)return console.warn("Must be signed in to access Inventory"),null;let o=null,r=new URL(`/inventory/${t.steamId}/753/${e}`,"https://steamcommunity.com/");r.searchParams.set("l","english"),r.searchParams.set("count","2000");let n=!1;do{n=!1;let a=await fetch(r,{credentials:"include"});if(!a.ok)throw a.status===403?new O.LoginError("community"):new O.HTTPError(a.status,a.statusText);let c=await a.json();c&&c.success&&(o||(o={assets:[],descriptions:[]}),c.assets&&o.assets.push(...c.assets),c.descriptions&&o.descriptions.push(...c.descriptions),c.last_assetid&&r.searchParams.set("start_assetid",c.last_assetid),c.more_items&&(n=!0))}while(n);if(!o)throw new Error(`Could not retrieve Inventory 753/${e}`);return o}async fetchCoupons(){let e=await this.loadInventory(3);if(!e)return null;let t=new Map;for(let r of e.descriptions){if(!r.type||r.type!=="Coupon"||!r.actions)continue;let n={appids:[],image_url:r.icon_url,title:r.name,discount:Number(r.name.match(/([1-9][0-9])%/)[1]),id:`${r.classid}_${r.instanceid}`};r.descriptions.forEach((a,c)=>{let _=a.value;_.startsWith("Can't be applied with other discounts.")?(n.discount_note=_,n.discount_note_id=c,n.discount_doesnt_stack=!0):_.startsWith("(Valid")&&(n.valid_id=c,n.valid=_)});for(let a of r.actions){let c=a.link.match(/[1-9][0-9]*(?:,[1-9][0-9]*)*/);if(!c){console.warn("Couldn't find packageid(s) for link %s",a.link);continue}for(let _ of c[0].split(",")){let u=Number(_);(!t.has(u)||t.get(u).discount<n.discount)&&t.set(u,n)}}}let o=await new ke().getPackageApps([...t.keys()]);for(let[r,n]of t.entries())n.appids=o.get(r)??[];return t}async fetchGiftsAndPasses(){let e=await this.loadInventory(1);if(!e)return null;let t=[],o=[],r=!1;for(let n of e.descriptions){let a=n.descriptions?.find(c=>c.type==="html");if(a){let c=Be.fromText(a.value);if(c.length>0){r=!0;for(let _ of c)n.type==="Gift"?t.push(_):o.push(_)}}if(!r&&n.actions&&n.actions.length>1){let c=Be.fromUrl(n.actions[0].link);c&&(n.type==="Gift"?t.push(c):o.push(c))}}return{gifts:t,passes:o}}async fetchItems(){let e=await this.loadInventory(6);return e?e.descriptions.map(t=>t.market_hash_name):null}async refreshCoupons(){return this.refreshCouponsPromise||(this.refreshCouponsPromise=(async()=>{if(await l.isStoreExpired("coupons")){let t=await this.fetchCoupons();t===null?await l.clear("coupons"):(await l.replaceAll("coupons",[...t.entries()]),await l.setStoreExpiry("coupons",60*60))}})()),this.refreshCouponsPromise}async getCoupon(e){return await this.refreshCoupons(),l.getFromIndex("coupons","idx_appid",e)}async getCouponsAppids(e){await this.refreshCoupons();let t=l.db.transaction("coupons"),o=new Set(await t.store.index("idx_appid").getAllKeys()),r=[];for(let n of e)o.has(n)&&r.push("app/"+n);return await t.done,r}async refreshGiftsAndPasses(){return this.refreshGiftsPromise||(this.refreshGiftsPromise=(async()=>{if(await l.isStoreExpired("giftsAndPasses")){let t=await this.fetchGiftsAndPasses();t===null?await l.clear("giftsAndPasses"):(await l.replaceAll("giftsAndPasses",[["gifts",t.gifts],["passes",t.passes]]),await l.setStoreExpiry("giftsAndPasses",60*60))}})()),this.refreshGiftsPromise}async getGiftsAppids(e){await this.refreshGiftsAndPasses();let t=l.db.transaction("giftsAndPasses"),o=new Set(await t.store.get("gifts")??[]),r=[];for(let n of e)o.has(n)&&r.push("app/"+n);return await t.done,r}async getPassesAppids(e){await this.refreshGiftsAndPasses();let t=l.db.transaction("giftsAndPasses"),o=new Set(await t.store.get("passes")??[]),r=[];for(let n of e)o.has(n)&&r.push("app/"+n);return await t.done,r}async hasItem(e){if(await l.isStoreExpired("items")){let o=await this.fetchItems();o===null?await l.clear("items"):(await l.replaceAll("items",o.map(r=>[r,r])),await l.setStoreExpiry("items",60*60))}return await l.contains("items",e)}handle(e){switch(e.action){case"inventory.coupon":return this.getCoupon(e.params.appid);case"inventory.getCouponAppids":return this.getCouponsAppids(e.params.appids);case"inventory.getGiftsAppids":return this.getGiftsAppids(e.params.appids);case"inventory.getPassesAppids":return this.getPassesAppids(e.params.appids);case"inventory.hasItem":return this.hasItem(e.params.hashes)}return U}};var We=class{async clearCache(){await I.remove("currency"),await l.clear("coupons","giftsAndPasses","items","earlyAccessAppids","purchases","dynamicStore","packages","profiles","rates","collection","waitlist","itadImport","workshopFileSizes","reviews","storeList","storePageData","expiries")}handle(e){switch(e.action){case"cache.clear":return this.clearCache()}return U}};var _t=class{static{this.currentContext=0}static set CurrentContext(e){this.currentContext=e}static isBackgroundScript(){return this.currentContext===1}static isContentScript(){return this.currentContext===2}static isOptions(){return this.currentContext===3}};var ut=class s{constructor(e,t=0,o=0){console.assert([e,t,o].filter(Number.isInteger).length===3,`${e}.${t}.${o} must be integers`),this.major=e,this.minor=t,this.patch=o}static from(e){if(e instanceof s)return new s(e.major,e.minor,e.patch);if(typeof e=="string")return s.fromString(e);if(Array.isArray(e))return s.fromArray(e);throw new Error(`Could not construct a Version from ${e}`)}static fromArray(e){if(e.length===0)throw new Error;return new s(Number(e[0]),Number(e[1]??0),Number(e[2]??0))}static fromString(e){return s.fromArray(e.split("."))}static coerce(e){return e instanceof s?e:s.from(e)}toString(){return`${this.major}.${this.minor}.${this.patch}`}toArray(){return[this.major,this.minor,this.patch]}toJSON(){return this.toString()}isCurrent(){return this.isSameOrAfter(Oe.version)}isSame(e){let t=s.coerce(e);return this.major===t.major&&this.minor===t.minor&&this.patch===t.patch}isBefore(e){let t=s.coerce(e);return this.major<t.major?!0:this.major>t.major?!1:this.minor<t.minor?!0:this.minor>t.minor?!1:this.patch<t.patch}isSameOrBefore(e){return this.isSame(e)||this.isBefore(e)}isAfter(e){return s.coerce(e).isBefore(this)}isSameOrAfter(e){return s.coerce(e).isSameOrBefore(this)}};var mt=class{static async migrate(e){let t=new Te;if(e.isSameOrBefore("2.0.0")&&(await t.remove("showfakeccwarning"),await t.remove("hideaboutlinks")),e.isSameOrBefore("2.0.1")){await t.remove("hide_dlcunownedgames"),await t.remove("hide_wishlist"),await t.remove("hide_cart"),await t.remove("hide_notdiscounted"),await t.remove("hide_mixed"),await t.remove("hide_negative"),await t.remove("hide_priceabove"),await t.remove("priceabove_value"),await t.remove("hide_owned"),await t.remove("hide_ignored"),await t.remove("highlight_notdiscounted"),await t.remove("showallfriendsthatown");let o=t.get("showusernotes");o!==void 0&&(await R.set("user_notes_app",!!o),await R.set("user_notes_wishlist",!!o),await t.remove("showusernotes"))}if(e.isSameOrBefore("2.1.0")){await t.remove("showcomparelinks");let o=await t.get("profile_custom_link");for(let r of o)r.url&&!r.url.includes("[ID]")&&(r.url+="[ID]");await R.set("profile_custom_link",o)}if(e.isSameOrBefore("2.3.3")){let o=await t.get("customize_apppage");for(let r of["steamchart","surveys","steamspy"])Object.prototype.hasOwnProperty.call(o,r)&&typeof o[r]=="boolean"&&delete o[r];await R.set("customize_apppage",o)}if(e.isSameOrBefore("2.4.1")&&await t.remove("showallachievements"),e.isSameOrBefore("2.5.0")&&await t.remove("replaceaccountname"),e.isSameOrBefore("3.0.0")){let o={adventureshop:1,allyouplay:2,amazonus:3,battlenet:4,bistore:5,bundlestars:6,coinplay:7,cybermanta:8,desura:9,digitaldownload:10,direct2drive:11,discord:12,dlgamer:13,dotemu:14,dreamgame:15,epic:16,fireflower:17,funstock:18,game2:19,gamebillet:20,gamefly:21,gamejolt:22,gameolith:23,gamersgate:24,gamesload:25,gamesplanet:26,gamesplanetde:27,gamesplanetfr:28,gamesplanetus:29,gamesrepublic:30,gamesrocket:31,gametap:32,gemly:33,getgames:34,gog:35,greenmangaming:36,humblestore:37,humblewidgets:38,chrono:39,imperialgames:40,impulse:41,indiegalastore:42,indiegamestand:43,itchio:44,lbostore:45,less4games:46,macgamestore:47,microsoft:48,newegg:49,nuuvem:50,oculus:51,origin:52,paradox:53,playfield:54,playism:55,razer:56,savemi:57,shinyloot:58,silagames:59,squenix:60,steam:61,uplay:62,voidu:63,wingamestore:64,joybuggy:65,noctre:66,etailmarket:67},r=await t.get("excluded_stores");await R.set("excluded_stores",r.map(n=>o[n]??null).filter(n=>n))}e.isSameOrBefore("3.1.0")&&(await t.remove("addtocart_no_redirect"),await t.remove("show_steamspy_info"),await t.remove("show_survey_info"),await t.remove("show_steamchart_info")),e.isSameOrBefore("4.0.1")&&(await R.set("itad_sync_library",await t.get("itad_import_library")??!0),await R.set("itad_sync_wishlist",await t.get("itad_import_wishlist")??!0),await t.remove("itad_import_library"),await t.remove("itad_import_wishlist"),await j.clear()),e.isSameOrBefore("4.1.2")&&await t.remove("showdeckcompat")}};var ze=ie(ae()),dt=class{constructor(){this.listeners=new Map}unregister(e){console.log(`Unregister webrequest listeners for tab ${e}, tab no longer exists`);let t=this.listeners.get(e)??new Map;for(let o of t.values())ze.webRequest.onCompleted.removeListener(o);this.listeners.delete(e)}async register(e,t,o){let r=async a=>{try{await ze.default.tabs.get(e)}catch{this.unregister(e);return}ze.default.tabs.sendMessage(e,{key:t,url:a.url})},n=this.listeners.get(e)??new Map;n.has(t)||(n.set(t,r),this.listeners.set(e,n),ze.webRequest.onCompleted.addListener(r,{urls:o}))}handle(e,t){if(!t.id)throw new Error("Requires tab");switch(e.action){case"listener.register":return this.register(t.id,e.params.key,e.params.urls)}return U}};_t.CurrentContext=1;var U=Symbol("Unrecognized");kt.default.runtime.onInstalled.addListener(async s=>{if(s.reason!=="update"||s.previousVersion===void 0)return;let e=ut.fromString(s.previousVersion);await l.init(),await mt.migrate(e),await new We().handle("cache.clear"),await async function(){await new fe(kt.default.storage.local).remove("es_guide_tags")}(),console.log("Update done")});var Ts=[new at,new ot,new lt,new it,new ke,new ct,new We,new dt];kt.default.runtime.onMessage.addListener((s,e)=>{if(!(!e||!e.tab)&&!(!s||!s.action))return(async()=>{try{await Promise.all([l.init(),R.init()]);let t;for(let o of Ts)if(t=await o.handle(s,e.tab),t!==U)break;if(t===U)throw new Error("Unknown message");return t}catch(t){throw console.group(`Callback: "${s.action}"`),console.error("Failed to execute %o",s),console.error(t),console.groupEnd(),new Error(t.toString())}})()});Qe.register();return is(Ps);})();
/*! Bundled license information:

dompurify/dist/purify.js:
  (*! @license DOMPurify 3.1.3 | (c) Cure53 and other contributors | Released under the Apache license 2.0 and Mozilla Public License 2.0 | github.com/cure53/DOMPurify/blob/3.1.3/LICENSE *)
*/
//# sourceMappingURL=background.js.map
