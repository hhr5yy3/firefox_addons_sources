this.browser=function(){return this.msBrowser||this.browser||this.chrome}();var Securden_offScreen={productVersion:null,serverUrl:null,init:function(){chrome.runtime.onMessage.addListener(Securden_offScreen.processRequest),setTimeout(window.close,6e4)},processRequest:function(e,n,r){if(e.offScreen)return Securden_offScreen.productVersion=e.productVersion,Securden_offScreen.serverUrl=e.serverUrl,Securden_offScreen.sendRequest(e).then((e=>r(e))),!0},getCsrfToken:function(e){return action="get_csrf_token",url=e+"/browser_extension_api/"+action,fetch(url).then((e=>e.ok?e.json():e.json().then((n=>({ok:e.ok,responseData:n}))))).catch((e=>{throw new Error("Network error occurred: "+e.message)}))},sendRequest:async function(e){serverUrl=e.serverUrl,ajaxConfig=e.ajaxConfig||e;var n=ajaxConfig.data,r="";r=serverUrl+"/browser_extension_api/"+ajaxConfig.action;var o="POST"==ajaxConfig.type?"POST":"GET";if("GET"!=o){var t=null;productVersion=Securden_offScreen.productVersion,csrfValueObj=await Securden_offScreen.getCsrfToken(serverUrl),null!=(t=csrfValueObj.token)&&null!=t&&(n.csrfmiddlewaretoken=t);var s="X-CSRFToken";SecurdenExtensionUtils.checkIfFeatureEnabledInVersion("CSRF_TOKEN_NEW_NAME",Securden_offScreen.productVersion)&&(s="X-SECURDENPOSTTOKEN")}var c={method:o,headers:{"Content-Type":"application/json",[s]:t,SECURDENHTTPREFERER:serverUrl},body:"POST"===o?JSON.stringify(ajaxConfig.data):void 0};"GET"===o&&null!=n&&null!=n&&(r=r+"?"+Object.keys(n).map((e=>(SecurdenExtensionUtils.isEncodedURIComponent(e)?e:encodeURIComponent(e))+"="+(SecurdenExtensionUtils.isEncodedURIComponent(n[e])?n[e]:encodeURIComponent(n[e])))).join("&"));return fetch(r,c).then((e=>{if(205!==e.status)return e.ok?e.json():e.json().then((n=>({ok:e.ok,responseData:n})))}))}};Securden_offScreen.init();