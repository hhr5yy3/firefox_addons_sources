"use strict";(self.webpackChunkchrome_extension=self.webpackChunkchrome_extension||[]).push([[30],{11125:(e,t,i)=>{i.d(t,{Y:()=>l});var r=i(15215),n=i(34549),o=i(88319),a={keyPrefix:"aws-amplify-cache",capacityInBytes:1048576,itemMaxSize:21e4,defaultTTL:2592e5,defaultPriority:5,warningThreshold:.8,storage:(new(i(54769).i)).getStorage()};function s(e){var t=0;t=e.length;for(var i=e.length;i>=0;i-=1){var r=e.charCodeAt(i);r>127&&r<=2047?t+=1:r>2047&&r<=65535&&(t+=2),r>=56320&&r<=57343&&(i-=1)}return t}function c(){return(new Date).getTime()}function f(e){return Number.isInteger?Number.isInteger(e):function(e){return"number"==typeof e&&isFinite(e)&&Math.floor(e)===e}(e)}var h={},g=(function(){function e(){}e.clear=function(){h={}},e.getItem=function(e){return h[e]||null},e.setItem=function(e,t){h[e]=t},e.removeItem=function(e){delete h[e]}}(),new n.C("StorageCache")),u=function(){function e(e){this.config=Object.assign({},e),this.cacheCurSizeKey=this.config.keyPrefix+"CurSize",this.checkConfig()}return e.prototype.getModuleName=function(){return"Cache"},e.prototype.checkConfig=function(){f(this.config.capacityInBytes)||(g.error("Invalid parameter: capacityInBytes. It should be an Integer. Setting back to default."),this.config.capacityInBytes=a.capacityInBytes),f(this.config.itemMaxSize)||(g.error("Invalid parameter: itemMaxSize. It should be an Integer. Setting back to default."),this.config.itemMaxSize=a.itemMaxSize),f(this.config.defaultTTL)||(g.error("Invalid parameter: defaultTTL. It should be an Integer. Setting back to default."),this.config.defaultTTL=a.defaultTTL),f(this.config.defaultPriority)||(g.error("Invalid parameter: defaultPriority. It should be an Integer. Setting back to default."),this.config.defaultPriority=a.defaultPriority),this.config.itemMaxSize>this.config.capacityInBytes&&(g.error("Invalid parameter: itemMaxSize. It should be smaller than capacityInBytes. Setting back to default."),this.config.itemMaxSize=a.itemMaxSize),(this.config.defaultPriority>5||this.config.defaultPriority<1)&&(g.error("Invalid parameter: defaultPriority. It should be between 1 and 5. Setting back to default."),this.config.defaultPriority=a.defaultPriority),(Number(this.config.warningThreshold)>1||Number(this.config.warningThreshold)<0)&&(g.error("Invalid parameter: warningThreshold. It should be between 0 and 1. Setting back to default."),this.config.warningThreshold=a.warningThreshold);this.config.capacityInBytes>5242880&&(g.error("Cache Capacity should be less than 5MB. Setting back to default. Setting back to default."),this.config.capacityInBytes=a.capacityInBytes)},e.prototype.fillCacheItem=function(e,t,i){var r={key:e,data:t,timestamp:c(),visitedTime:c(),priority:i.priority,expires:i.expires,type:typeof t,byteSize:0};return r.byteSize=s(JSON.stringify(r)),r.byteSize=s(JSON.stringify(r)),r},e.prototype.configure=function(e){return e?(e.keyPrefix&&g.warn("Don't try to configure keyPrefix!"),this.config=Object.assign({},this.config,e,e.Cache),this.checkConfig(),this.config):this.config},e}(),y=new n.C("Cache"),l=new(function(e){function t(t){var i=this,r=t?Object.assign({},a,t):a;return(i=e.call(this,r)||this).config.storage=r.storage,i.getItem=i.getItem.bind(i),i.setItem=i.setItem.bind(i),i.removeItem=i.removeItem.bind(i),i}return(0,r.__extends)(t,e),t.prototype._decreaseCurSizeInBytes=function(e){var t=this.getCacheCurSize();this.config.storage.setItem(this.cacheCurSizeKey,(t-e).toString())},t.prototype._increaseCurSizeInBytes=function(e){var t=this.getCacheCurSize();this.config.storage.setItem(this.cacheCurSizeKey,(t+e).toString())},t.prototype._refreshItem=function(e,t){return e.visitedTime=c(),this.config.storage.setItem(t,JSON.stringify(e)),e},t.prototype._isExpired=function(e){var t=this.config.storage.getItem(e),i=JSON.parse(t);return c()>=i.expires},t.prototype._removeItem=function(e,t){var i=t||JSON.parse(this.config.storage.getItem(e)).byteSize;this._decreaseCurSizeInBytes(i),this.config.storage.removeItem(e)},t.prototype._setItem=function(e,t){this._increaseCurSizeInBytes(t.byteSize);try{this.config.storage.setItem(e,JSON.stringify(t))}catch(e){this._decreaseCurSizeInBytes(t.byteSize),y.error("Failed to set item "+e)}},t.prototype._sizeToPop=function(e){var t=this.getCacheCurSize()+e-this.config.capacityInBytes,i=(1-this.config.warningThreshold)*this.config.capacityInBytes;return t>i?t:i},t.prototype._isCacheFull=function(e){return e+this.getCacheCurSize()>this.config.capacityInBytes},t.prototype._findValidKeys=function(){for(var e=[],t=[],i=0;i<this.config.storage.length;i+=1)t.push(this.config.storage.key(i));for(i=0;i<t.length;i+=1){var r=t[i];0===r.indexOf(this.config.keyPrefix)&&r!==this.cacheCurSizeKey&&(this._isExpired(r)?this._removeItem(r):e.push(r))}return e},t.prototype._popOutItems=function(e,t){for(var i=[],r=t,n=0;n<e.length;n+=1){var o=this.config.storage.getItem(e[n]);if(null!=o){var a=JSON.parse(o);i.push(a)}}i.sort((function(e,t){return e.priority>t.priority?-1:e.priority<t.priority?1:e.visitedTime<t.visitedTime?-1:1}));for(n=0;n<i.length;n+=1)if(this._removeItem(i[n].key,i[n].byteSize),(r-=i[n].byteSize)<=0)return},t.prototype.setItem=function(e,t,i){y.log("Set item: key is "+e+", value is "+t+" with options: "+i);var r=this.config.keyPrefix+e;if(r!==this.config.keyPrefix&&r!==this.cacheCurSizeKey)if(void 0!==t){var n={priority:i&&void 0!==i.priority?i.priority:this.config.defaultPriority,expires:i&&void 0!==i.expires?i.expires:this.config.defaultTTL+c()};if(n.priority<1||n.priority>5)y.warn("Invalid parameter: priority due to out or range. It should be within 1 and 5.");else{var o=this.fillCacheItem(r,t,n);if(o.byteSize>this.config.itemMaxSize)y.warn("Item with key: "+e+" you are trying to put into is too big!");else try{var a=this.config.storage.getItem(r);if(a&&this._removeItem(r,JSON.parse(a).byteSize),this._isCacheFull(o.byteSize)){var s=this._findValidKeys();if(this._isCacheFull(o.byteSize)){var f=this._sizeToPop(o.byteSize);this._popOutItems(s,f)}}this._setItem(r,o)}catch(e){y.warn("setItem failed! "+e)}}}else y.warn("The value of item should not be undefined!");else y.warn("Invalid key: should not be empty or 'CurSize'")},t.prototype.getItem=function(e,t){y.log("Get item: key is "+e+" with options "+t);var i=null,r=this.config.keyPrefix+e;if(r===this.config.keyPrefix||r===this.cacheCurSizeKey)return y.warn("Invalid key: should not be empty or 'CurSize'"),null;try{if(null!=(i=this.config.storage.getItem(r))){if(!this._isExpired(r)){var n=JSON.parse(i);return(n=this._refreshItem(n,r)).data}this._removeItem(r,JSON.parse(i).byteSize),i=null}if(t&&void 0!==t.callback){var o=t.callback();return null!==o&&this.setItem(e,o,t),o}return null}catch(e){return y.warn("getItem failed! "+e),null}},t.prototype.removeItem=function(e){y.log("Remove item: key is "+e);var t=this.config.keyPrefix+e;if(t!==this.config.keyPrefix&&t!==this.cacheCurSizeKey)try{var i=this.config.storage.getItem(t);i&&this._removeItem(t,JSON.parse(i).byteSize)}catch(e){y.warn("removeItem failed! "+e)}},t.prototype.clear=function(){y.log("Clear Cache");for(var e=[],t=0;t<this.config.storage.length;t+=1){var i=this.config.storage.key(t);0===i.indexOf(this.config.keyPrefix)&&e.push(i)}try{for(t=0;t<e.length;t+=1)this.config.storage.removeItem(e[t])}catch(e){y.warn("clear failed! "+e)}},t.prototype.getAllKeys=function(){for(var e=[],t=0;t<this.config.storage.length;t+=1){var i=this.config.storage.key(t);0===i.indexOf(this.config.keyPrefix)&&i!==this.cacheCurSizeKey&&e.push(i.substring(this.config.keyPrefix.length))}return e},t.prototype.getCacheCurSize=function(){var e=this.config.storage.getItem(this.cacheCurSizeKey);return e||(this.config.storage.setItem(this.cacheCurSizeKey,"0"),e="0"),Number(e)},t.prototype.createInstance=function(e){return e.keyPrefix&&e.keyPrefix!==a.keyPrefix||(y.error("invalid keyPrefix, setting keyPrefix with timeStamp"),e.keyPrefix=c.toString()),new t(e)},t}(u));o.H.register(l)}}]);