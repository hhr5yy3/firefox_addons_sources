"use strict";(self.webpackChunk_solflare_extension=self.webpackChunk_solflare_extension||[]).push([["StakingPage"],{"./src/pages/Staking/index.tsx":(t,a,e)=>{e.r(a),e.d(a,{default:()=>ut});var n=e("../../../node_modules/react/jsx-runtime.js"),i=e("../../../node_modules/react/index.js"),s=e("../../../node_modules/react-router/dist/index.js"),o=e("../../../node_modules/react-i18next/dist/es/useTranslation.js"),c=e("../../../node_modules/@fortawesome/pro-light-svg-icons/index.mjs"),r=e("../../libs/foundation-ui/dist/index.js"),l=e("../../libs/shared/dist/assets/solana.png"),d=e("../../libs/shared/dist/components/index.js"),u=e("../../libs/shared/dist/utils/displayPrice.js"),m=e("../../libs/shared/dist/utils/truncateMiddle.js"),g=e("../../libs/shared/dist/features/stakingCore/constants.js"),k=e("../../../node_modules/bignumber.js/bignumber.mjs"),p=e("../../libs/shared/dist/constants/mints.js"),x=e("../../libs/shared/dist/features/currencies/hooks/index.js"),v=e("../../libs/shared/dist/components/TokenAvatar/index.js");const j=({amount:t,validatorName:a,validatorImage:e})=>{const{value:i,suffix:s,prefix:l,price:d}=(0,x.yF)("SOL",t),{t:m}=(0,o.$)(),g=(0,n.jsx)(r.TXListItem,{title:(0,u.ED)({amount:t,displayType:"solana",suffix:" SOL"}),subtitle:d?(0,u.ED)({amount:i,displayType:"value",suffix:s,prefix:l}):void 0,avatar:(0,n.jsx)(v.y,{src:p.vx.logoURI,verified:!0})}),k=a?(0,n.jsx)(r.TXListItem,{title:a,subtitle:m("staking_slrs_create_new_title"),avatar:(0,n.jsx)(r.ValidatorAvatar,{src:e})}):null;return(0,n.jsx)(r.ConfirmTransaction,{avatar:(0,n.jsx)(r.IconAvatar,{size:"xl",icon:c.Mw$}),transactionFromItem:k||g,transactionToItem:k?g:void 0,hideFlowIcon:!0})};var h=e("../../libs/shared/dist/constants/routes.js"),b=e("../../libs/shared/dist/utils/lamportToSol.js"),S=e("../../libs/shared/dist/features/stakingCore/index.js"),_=e("../../libs/shared/dist/features/stakingModal/utils/splitStakeErrors.js");const A=({splitStakeAccount:t,setSplitStakeAccount:a})=>{const{t:e}=(0,o.$)(),p=()=>{a(void 0)},{maxAmountBN:x,setSelectedAmount:v,selectedAmount:A,error:w,splitStake:f}=((t,a)=>{const e=(0,s.s0)(),[c,r]=(0,i.useState)(),{mutateAsync:l,isLoading:d}=(0,S.QC)(),{t:u}=(0,o.$)(),{data:g,isLoading:p}=(0,S.te)(),x=(0,b.s)(t.actions.find((t=>"split"===t.name))?.metadata?.amountMax||0),v=(0,b.s)(t.actions.find((t=>"split"===t.name))?.metadata?.amountMin||0),A=c?new k.Z(c):void 0,w=(0,_.M)(A,v,x,u);return{splitStake:()=>l({amountSOL:c,confirmData:(0,n.jsx)(j,{validatorName:t.validator?.name??(0,m.r)(t.validator?.votePublicKey),validatorImage:t.validator?.image,amount:A?.toString()??"0"}),splitStakeAccount:t,onBroadcast:()=>{a(),e(h.xm)}}),splitStakeLoading:d,selectedAmount:c,setSelectedAmount:r,minAmountBN:v,maxAmountBN:x,validatorsLoading:p,validators:g,error:w}})(t,p);return(0,n.jsxs)(r.PageModal,{open:!0,onOpenChange:p,children:[(0,n.jsx)(r.PageTitle,{left:(0,n.jsx)(r.ActionableIcon,{icon:c.acZ,onClick:p,size:"l"}),center:e("action_split")}),(0,n.jsx)(r.PageContent,{children:(0,n.jsx)(r.StakingForm,{children:(0,n.jsxs)(r.StakingFormContent,{children:[(0,n.jsx)(r.SendInput,{label:(0,n.jsx)(r.Label,{htmlFor:"token-input",children:e("table_token")}),right:x.isGreaterThanOrEqualTo(g.T)&&(0,n.jsxs)(r.RightLabel,{onClick:()=>v(x.toString()),children:[e("swap_max"),": ",x.toString()," SOL"]}),id:"token-input",selectedToken:{tokenId:"-",symbol:"SOL",amount:"-",logoURI:l,verified:!0},amount:A||"",onAmountChange:t=>v(t.target.value),tokens:[],onSelectedTokenChange:()=>{},disabledTokenSelect:!0,amountTextInputType:"number"}),(0,n.jsx)(r.FormField,{label:(0,n.jsxs)(r.Label,{children:[e("table_validator"),(0,n.jsx)(d.sW,{tooltip:e("staking_validator_description")})]}),children:(0,n.jsx)(r.ValidatorListItem,{background:"dropDown",image:t.validator?.image??void 0,title:t.validator?.name??(0,m.r)(t.validator?.votePublicKey),apr:(0,u.ED)({amount:t.validator?.apy??0,suffix:"% APY",displayType:"medium"})})})]})})}),(0,n.jsxs)(r.FooterActions,{children:[w&&(0,n.jsx)(r.Alert,{variant:"error",title:w.title,message:w.message}),(0,n.jsx)(r.ButtonGroup,{children:(0,n.jsx)(r.Button,{disabled:Boolean(w)||!A,onClick:()=>{p(),f()},children:e("action_split")})})]})]})};var w=e("../../libs/shared/dist/features/stakingModal/extension/StakingModal.js"),f=e("../../libs/shared/dist/features/currencies/components/index.js"),y=e("../../libs/shared/dist/features/portfolio/hooks/index.js"),C=e("../../libs/shared/dist/features/pfp/components/index.js");const I=({amount:t,walletName:a,walletPubkey:e})=>{const{value:i,suffix:s,prefix:o,price:l}=(0,x.yF)("SOL",t);return(0,n.jsx)(r.ConfirmTransaction,{avatar:(0,n.jsx)(r.IconAvatar,{size:"xl",icon:c.owJ}),transactionFromItem:(0,n.jsx)(r.TXListItem,{title:(0,u.ED)({amount:t,displayType:"solana",suffix:" SOL"}),subtitle:l?(0,u.ED)({amount:i,displayType:"value",suffix:s,prefix:o}):void 0,avatar:(0,n.jsx)(v.y,{src:p.vx.logoURI,verified:!0})}),transactionToItem:(0,n.jsx)(r.TXListItem,{title:a,subtitle:(0,m.r)(e),avatar:(0,n.jsx)(C.y,{publicKey:e})})})};var D=e("../../libs/shared/dist/features/walletData/hooks/index.js");const T=({withdrawStakeAccount:t,setWithdrawStakeAccount:a})=>{const{t:e}=(0,o.$)(),s=()=>{a(void 0)},{amount:g,withdrawStake:k,setCloseAccount:p,closeAccount:x,withdrawLoading:v}=((t,a)=>{const{publicKey:e,accountName:s}=(0,D.rT)(),{mutateAsync:o,isLoading:c}=(0,S.Uo)(),[r,l]=i.useState(!0),{data:d,isLoading:u}=(0,S.te)(),m=t.actions.find((t=>"withdraw"===t.name))?.metadata,g=(r?m?.amountWithClosing:m?.amount)||0,k=(0,b.s)(g);return{amount:k,validators:d,validatorsLoading:u,setCloseAccount:l,closeAccount:r,withdrawStake:()=>{o({amountLamports:g,confirmData:(0,n.jsx)(I,{amount:k.toString(),walletName:s,walletPubkey:e}),stakingAccount:t,closeAccount:r,onBroadcast:()=>{a()}})},withdrawLoading:c}})(t,s),{data:j}=(0,y.Dm)();return(0,n.jsxs)(r.PageModal,{open:!0,onOpenChange:s,children:[(0,n.jsx)(r.PageTitle,{left:(0,n.jsx)(r.ActionableIcon,{icon:c.acZ,onClick:s,size:"l"}),center:e("withdraw")}),(0,n.jsx)(r.PageContent,{children:(0,n.jsx)(r.StakingForm,{children:(0,n.jsxs)(r.StakingFormContent,{children:[(0,n.jsx)(r.FormField,{label:(0,n.jsx)(r.Label,{children:e("table_token")}),children:(0,n.jsx)(r.StakeAccountListItem,{statuses:[],validatorImage:l,background:"dropDown",title:e("solana"),amount:(0,u.ED)({amount:g,displayType:"solana",suffix:" SOL"}),height:"s",value:(0,n.jsx)(f.sp,{value:g.multipliedBy(j?.price?.price??0).toNumber()}),spacingX:"select",avatarSize:"s"})}),(0,n.jsx)(r.FormField,{label:(0,n.jsxs)(r.Label,{children:[e("table_validator"),(0,n.jsx)(d.sW,{tooltip:e("staking_validator_description")})]}),children:(0,n.jsx)(r.ValidatorListItem,{background:"dropDown",image:t.validator?.image??void 0,apr:(0,u.ED)({amount:t.validator?.apy??0,displayType:"medium",suffix:"% APY"}),title:t.validator?.name??(0,m.r)(t.validator?.votePublicKey)})}),(0,n.jsx)(r.Control,{id:"cb-close",label:e("action_close_account"),tooltip:e("staking_withdraw_available_tooltip"),action:(0,n.jsx)(r.Checkbox,{checked:x,onChange:t=>p(Boolean(t.target.checked))})})]})})}),(0,n.jsx)(r.FooterActions,{children:(0,n.jsx)(r.ButtonGroup,{children:(0,n.jsx)(r.Button,{disabled:v,onClick:()=>{s(),k()},children:e("withdraw")})})})]})};var L=e("../../libs/shared/dist/features/stakingModal/shared/UnstakeModal.js"),N=e("../../../node_modules/@fortawesome/pro-solid-svg-icons/index.mjs"),B=e("../../libs/shared/dist/constants/validatorStatus.js");const F=()=>{const{t}=(0,o.$)(),{data:a,isLoading:e,isError:i}=(0,S.ku)(),[l,d]=(0,S.Bf)(),g=(0,s.s0)();if(i)return(0,n.jsx)("div",{children:t("error_something_wrong")});const p=a?.header,x=(0,b.s)(p?.totalAmount||0),v=a&&void 0!==p?.totalAmount?x.multipliedBy(new k.Z(p?.price?.price||0)).toString():void 0,j={active:t("staking_status_active"),activating:t("staking_status_activating"),deactivating:t("staking_status_unstaking"),inactive:t("staking_status_unstaked"),empty:t("staking_status_empty"),inactiveDeactivating:t("staking_status_unstaking"),activeInactive:t("staking_status_unstaked")};return(0,n.jsxs)(r.PagePortal,{children:[(0,n.jsx)(r.PageTitle,{left:(0,n.jsx)(r.ActionableIcon,{onClick:()=>g(h.xm),icon:c.acZ,size:"l"}),center:t("staking_title")}),(0,n.jsxs)(r.PageContent,{children:[(0,n.jsx)(r.StakingHero,{isLoading:e,avatar:(0,n.jsx)(r.IconAvatar,{size:"l",icon:N.Quw}),amount:(0,u.ED)({amount:x,displayType:"amount",suffix:" SOL"}),value:void 0!==v?(0,n.jsx)(f.sp,{value:v}):null,actions:[(0,n.jsx)(r.ButtonGroup,{children:(0,n.jsx)(r.Button,{disabled:e,onClick:d,children:t("action_stake")})},"actions-button")]}),(0,n.jsx)(r.StakingList,{isLoading:e,onStakingAccountClick:t=>{g(h.Ni.STAKE(t.publicKey))},data:(a?.stakeAccounts||[]).map((a=>{const e=a.validator,i=e?.status===B.n.Active?e.name||(0,m.r)(e.votePublicKey):t("staking_account_info_route_deactivated_validator"),s=Boolean(a.lockup);return{publicKey:a.publicKey,title:i,locked:s,statuses:a.statuses.map((t=>{return{status:(a=t,{active:"active",inactive:"inactive",activating:"activating",deactivating:"deactivating",empty:"empty",inactiveDeactivating:"deactivating",activeInactive:"inactive"}[a]),text:j[t]??t};var a})),validatorImage:e?.image??void 0,amount:(0,u.ED)({amount:(0,b.s)(a.amount),displayType:"amount",suffix:" SOL"}),value:(0,n.jsx)(f.sp,{value:(0,b.s)(a.amount).multipliedBy(new k.Z(p?.price?.price||0)).toString()})}}))})]})]})};var K=e("../../libs/shared/dist/features/stakingModal/components/StakeForm.js"),P=e("../../libs/shared/dist/features/stakingModal/hooks/useCreateStakeForm.js");const M=({restakeAccount:t})=>{const{maxSOLBalance:a,selectedAmount:e,setSelectedValidator:i,selectedValidator:l,error:d,createStake:u,createStakeLoading:m,setValidatorFilter:g,validatorOptions:k,validatorsLoading:p,validatorsFetching:x}=(0,P.g)(t),{t:v}=(0,o.$)(),j=(0,s.s0)();return(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(r.PageTitle,{left:(0,n.jsx)(r.ActionableIcon,{onClick:()=>j(h.xm),icon:c.acZ,size:"l"}),center:v("action_stake")}),(0,n.jsx)(r.PageContent,{children:(0,n.jsx)(r.StakingForm,{children:(0,n.jsx)(r.StakingFormContent,{children:(0,n.jsx)(K.m,{maxSOLBalance:a,selectedAmount:e,validatorOptions:k,onValidatorQueryChange:g,validatorsLoading:p,validatorsFetching:x,onValidatorChange:i,selectedValidator:l})})})}),(0,n.jsxs)(r.FooterActions,{children:[d&&(0,n.jsx)(r.Alert,{variant:"error",title:d.title,message:d.message}),(0,n.jsx)(r.ButtonGroup,{children:(0,n.jsx)(r.Button,{disabled:void 0===e||0==+e||Boolean(d)||!l||m,onClick:u,children:v("action_stake")})})]})]})},E=()=>{const{t}=(0,o.$)();return(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(r.PageTitle,{center:t("action_restake")}),(0,n.jsx)(r.PageContent,{children:(0,n.jsx)(r.Spinner,{size:"l"})})]})};var U=e("../../libs/shared/dist/hooks/index.js");const H=()=>{const{data:t}=(0,S.ku)(),{stakeId:a}=(0,U.nc)(["stakeId"]),e=t?.stakeAccounts.find((t=>t.publicKey===a));return e?(0,n.jsx)(r.PagePortal,{children:e?(0,n.jsx)(M,{restakeAccount:e}):(0,n.jsx)(E,{})}):(0,n.jsx)(E,{})};var O=e("../../libs/shared/dist/features/globalConfig/hooks/index.js"),V=e("../../libs/rise-ui/dist/index.js"),W=e("../../libs/shared/dist/features/staking/web/ExplorerDropDownItem.js"),$=e("../../libs/shared/dist/features/stakingModal/hooks/useUnstakeForm.js");const R=({stakingAccount:t,openSplitModal:a,closeDropdown:e})=>{const i=(0,s.s0)(),{t:c}=(0,o.$)(),{publicKey:r,accountName:l}=(0,D.rT)(),d=t.actions.find((t=>"split"===t.name))?.metadata,u=d?.amount&&d.amount>2e9,m=t.actions.find((t=>"withdraw"===t.name||"partialWithdraw"===t.name)),g=m?.metadata?.amount??0,k=(0,b.s)(g).toString(),{mutate:p}=(0,S.Uo)(),{standardUnstake:x}=(0,$.K)({stakeAccount:t});return(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(V.bK,{onClick:()=>{e(),x()},children:c("action_unstake")}),g>0&&(0,n.jsx)(V.bK,{onClick:()=>{e(),p({amountLamports:g,confirmData:(0,n.jsx)(I,{amount:k,walletName:l,walletPubkey:r}),stakingAccount:t,onBroadcast:()=>{i(h.Ni.MAIN,{replace:!0})}})},children:c("action_withdraw_inactive",{token:"SOL"})}),u&&(0,n.jsx)(V.bK,{onClick:()=>{e(),a(t)},children:c("action_split")})]})},z=({stakingAccount:t,openSplitModal:a,closeDropdown:e})=>{const i=(0,s.s0)(),{t:c}=(0,o.$)(),{publicKey:r,accountName:l}=(0,D.rT)(),d=t.actions.find((t=>"split"===t.name))?.metadata,u=t.actions.find((t=>"withdraw"===t.name||"partialWithdraw"===t.name)),m=u?.metadata?.amount??0,g=(0,b.s)(m).toString(),{mutate:k}=(0,S.Uo)();return(0,n.jsxs)(n.Fragment,{children:[d&&(0,n.jsx)(V.bK,{onClick:()=>{e(),a(t)},children:c("action_split")}),m>0&&(0,n.jsx)(V.bK,{onClick:()=>{e(),k({amountLamports:m,confirmData:(0,n.jsx)(I,{amount:g,walletName:l,walletPubkey:r}),stakingAccount:t,onBroadcast:()=>{i(h.Ni.MAIN,{replace:!0})}})},children:c("action_withdraw_inactive",{token:"SOL"})})]})};var Z=e("../../libs/shared/dist/components/ConfirmationHelpers/ConfirmationStaking.js");const G=({stakingAccount:t,closeDropdown:a,tEvents:e})=>{const i=(0,s.s0)(),{t:c}=(0,o.$)(),{publicKey:r,accountName:l}=(0,D.rT)(),d=t.actions.find((t=>"delegate"===t.name)),u=(0,b.s)(t.amount).toString(),{mutateAsync:g}=(0,S.jg)(),{setStakingEvents:k}=(0,S.Ub)(),p=t.actions.find((t=>"withdraw"===t.name||"partialWithdraw"===t.name)),x=p?.metadata?.amount??0,v=(0,b.s)(x).toString(),{mutate:j}=(0,S.Uo)();return(0,n.jsxs)(n.Fragment,{children:[d&&(0,n.jsx)(V.bK,{onClick:()=>{k({...e,source:"restakeUnstaking"}),a(),g({validatorPubkey:t.voter,stakePubkey:t.publicKey,confirmData:(0,n.jsx)(Z.Z,{validatorName:t.validator?.name??(0,m.r)(t.validator?.votePublicKey),validatorImage:t.validator?.image??void 0,amount:u}),onBroadcast:()=>{i(h.Ni.MAIN,{replace:!0})}})},children:c("action_restake")}),x>0&&(0,n.jsx)(V.bK,{onClick:()=>{a(),j({amountLamports:x,confirmData:(0,n.jsx)(I,{amount:v,walletName:l,walletPubkey:r}),stakingAccount:t,onBroadcast:()=>{i(h.Ni.MAIN,{replace:!0})}})},children:c("action_withdraw_inactive",{token:"SOL"})})]})},Q=({stakingAccount:t,closeDropdown:a})=>{const e=(0,s.s0)(),{t:i}=(0,o.$)(),c=t.actions.find((t=>"delegate"===t.name)),r=Boolean(t.lockup);return c&&!r?(0,n.jsx)(V.bK,{onClick:()=>{a(),e(h.Ni.RESTAKE(t.publicKey))},children:i("action_stake")}):null},X=({stakingAccount:t,closeDropdown:a,openSplitModal:e})=>{const i=(0,s.s0)(),{t:c}=(0,o.$)(),{publicKey:r,accountName:l}=(0,D.rT)(),d=t.actions.find((t=>"withdraw"===t.name||"partialWithdraw"===t.name)),u=d?.metadata?.amount??0,m=(0,b.s)(u).toString(),{mutate:g}=(0,S.Uo)(),k=t.actions.find((t=>"split"===t.name))?.metadata;return(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(V.bK,{onClick:()=>{a(),g({amountLamports:u,confirmData:(0,n.jsx)(I,{amount:m,walletName:l,walletPubkey:r}),stakingAccount:t,onBroadcast:()=>{i(h.Ni.MAIN,{replace:!0})}})},children:c("action_withdraw_unstaked",{token:"SOL"})}),k&&(0,n.jsx)(V.bK,{onClick:()=>{a(),e(t)},children:c("action_split")})]})},J=({stakingAccount:t,openSplitModal:a,setSelectedRestakeAccount:e,tEvents:s})=>{const o=(0,S.fZ)(t.statuses),[l,d]=i.useState(null),u=Boolean(l),{setStakingEvents:m}=(0,S.Ub)(),g=()=>{d(null)};return(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(r.ActionableIcon,{icon:c.Uwo,size:"l",onClick:t=>{d(t.currentTarget)}}),(0,n.jsxs)(V.vb,{anchorEl:l,open:u,onClose:g,children:["active"===o&&(0,n.jsx)(z,{stakingAccount:t,openSplitModal:a,closeDropdown:g}),"activating"===o&&(0,n.jsx)(R,{stakingAccount:t,openSplitModal:a,closeDropdown:g}),"deactivating"===o&&(0,n.jsx)(G,{stakingAccount:t,closeDropdown:g,tEvents:s}),"inactive-active"===o&&(0,n.jsx)(X,{stakingAccount:t,openSplitModal:a,closeDropdown:g}),"inactive"===o&&(0,n.jsx)(Q,{stakingAccount:t,closeDropdown:()=>{g(),m({...S.TQ,source:"restakeUnstaked"})},setSelectedRestakeAccount:e}),(0,n.jsx)(W.x,{onClose:g,publicKey:t.publicKey})]})]})},Y=({stakingAccount:t,openDeactivateModal:a})=>{const{t:e}=(0,o.$)(),{isFetching:i}=(0,S.ku)(),{standardUnstake:s}=(0,$.K)({stakeAccount:t});return(0,n.jsx)(r.ButtonGroup,{children:(0,n.jsx)(r.Button,{variant:"secondary",disabled:i,onClick:()=>{t.lockup?s():a(t)},children:e("action_unstake")})})};var q=e("../../libs/shared/dist/components/ConfirmationHelpers/ConfirmationCloseStake.js");const tt=({stakingAccount:t})=>{const a=(0,s.s0)(),{t:e}=(0,o.$)(),i=t.actions.find((t=>"withdraw"===t.name))?.metadata?.amountWithClosing,{isFetching:c}=(0,S.ku)(),{mutateAsync:l,isLoading:d}=(0,S.Uo)(),u=t.validator;return(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(r.Alert,{title:e("staking_alert_view_only_title"),message:e("staking_alert_view_only_message"),variant:"info"}),i&&(0,n.jsx)(r.ButtonGroup,{children:(0,n.jsx)(r.Button,{variant:"secondary",disabled:d||c,onClick:()=>{l({closeAccount:!0,amountLamports:i,confirmData:(0,n.jsx)(q.Z,{stakeStatus:(0,n.jsx)(r.StakeStatusTag,{status:"empty",children:e("staking_status_empty")}),validatorName:u?.name??"Stake Account",validatorImage:u?.image}),stakingAccount:t,actionType:"closeAccount",onBroadcast:()=>{a(h.Ni.MAIN,{replace:!0})}})},children:e("action_close_account")})})]})},at=({stakingAccount:t,openWithdrawModal:a})=>{const e=(0,s.s0)(),{t:i}=(0,o.$)(),{publicKey:c,accountName:l}=(0,D.rT)(),{isFetching:d}=(0,S.ku)(),{mutateAsync:u,isLoading:m}=(0,S.Uo)(),g=t.actions.find((t=>"withdraw"===t.name)),k=t.actions.find((t=>"withdraw"===t.name))?.metadata?.amountWithClosing,p=t.validator,x=Boolean(t.lockup),v=t.actions.find((t=>"delegate"===t.name));return(0,n.jsxs)(r.ButtonGroup,{children:[v&&x&&(0,n.jsx)(r.Button,{onClick:()=>{e(h.Ni.RESTAKE(t.publicKey))},children:i("action_stake")}),g?(0,n.jsx)(n.Fragment,{children:!p&&k?(0,n.jsx)(r.Button,{disabled:m||d,onClick:()=>{u({amountLamports:k,confirmData:(0,n.jsx)(I,{amount:(0,b.s)(t.amount).toString(),walletName:l,walletPubkey:c}),stakingAccount:t,onBroadcast:()=>{e(h.Ni.MAIN,{replace:!0})}})},children:i("action_withdraw")}):(0,n.jsx)(r.Button,{onClick:()=>a(t),children:i("action_withdraw")})}):null]})},et=({stakingAccount:t,openDeactivateModal:a})=>{const{t:e}=(0,o.$)(),{isFetching:i}=(0,S.ku)(),{standardUnstake:s}=(0,$.K)({stakeAccount:t});return(0,n.jsx)(r.ButtonGroup,{children:(0,n.jsx)(r.Button,{variant:"secondary",disabled:i,onClick:()=>{t.lockup?s():a(t)},children:e("action_unstake")})})},nt=({stakingAccount:t})=>{const a=(0,s.s0)(),{t:e}=(0,o.$)(),{publicKey:i,accountName:c}=(0,D.rT)(),l=t.actions.find((t=>"withdraw"===t.name||"partialWithdraw"===t.name)),d=l?.metadata?.amount??0,u=(0,b.s)(d).toString(),{mutate:m,isLoading:g}=(0,S.Uo)(),{isFetching:k}=(0,S.ku)();return(0,n.jsx)(r.Button,{disabled:g||k,onClick:()=>m({amountLamports:d,confirmData:(0,n.jsx)(I,{amount:u,walletName:c,walletPubkey:i}),stakingAccount:t,onBroadcast:()=>{a(h.Ni.MAIN,{replace:!0})}}),children:e("action_withdraw")})},it=({stakingAccount:t})=>{const{t:a}=(0,o.$)();return(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(r.Alert,{title:a("staking_alert_partially_unstaked_title"),message:"Due to high network unstaking volume, it will take about 2-3 days longer to unstake your full amount.",variant:"info"}),(0,n.jsx)(r.ButtonGroup,{children:(0,n.jsx)(nt,{stakingAccount:t})})]})};var st=e("../../libs/shared/dist/assets/list-rewards-empty.png"),ot=e("../../libs/shared/dist/utils/humanDate.js");const ct=({stakingAccount:{publicKey:t,activationEpoch:a}})=>{const{t:e}=(0,o.$)(),{data:i,isFetching:s}=(0,S.tb)(t,a),c=i?.rewards??[],{data:l}=(0,y.Dm)();return s?(0,n.jsx)(r.RewardListSkeleton,{}):c?.length?(0,n.jsx)(r.DetailsList,{fullWidthNegativeMarginSeparator:!0,extractKey:t=>String(t.epoch),data:c,renderItem:t=>(0,n.jsx)(r.RewardListItem,{title:(0,ot.rN)(1e3*t.rewardTime,!0,!1,!0),amount:(0,b.s)(t.amount).toString(),value:(0,n.jsx)(f.sp,{value:(0,b.s)(t.amount).multipliedBy(l?.price?.price??0).toString()})})}):(0,n.jsx)(r.EmptyState,{illustration:(0,n.jsx)("img",{src:st,alt:"No rewards",style:{maxHeight:"100%"}}),children:(0,n.jsx)(r.Paragraph,{textAlign:"center",children:e("staking_no_staking_rewards_yet")})})};var rt=e("../../libs/shared/dist/features/staking/shared/InstantUnstakeSpeedupBanner.js"),lt=e("../../libs/shared/dist/utils/timeRemaining.js");const dt=({setSplitAccount:t,setWithdrawAccount:a,setSelectedRestakeAccount:e,setDeactivateAccount:l})=>{const{data:d}=(0,S.ku)(),{setStakingEvents:g,stakingEvents:p}=(0,S.Ub)(),{stakeId:x}=(0,U.nc)(["stakeId"]),v=(0,s.s0)(),{t:j}=(0,o.$)(),{openExplorer:_}=(0,U.Vf)(),{cluster:A}=(0,O.LN)(),w="mainnet"===A,[y,C]=(0,i.useState)(""),I=d?.stakeAccounts.find((t=>t.publicKey===x));if(!I)return(0,n.jsx)(s.Fg,{to:h.Ni.MAIN,replace:!0});const D=I.validator,T=(0,S.fZ)(I.statuses),{title:L,pageHeroAvatarVariant:B,pageHeroIcon:F}=((t,a)=>{const e=(0,S.fZ)(t.statuses);return"active"===e?{title:a("staking_status_active"),pageHeroAvatarVariant:"stakingStatusStaked",pageHeroIcon:N.Quw}:"activating"===e?{title:a("staking_status_activating"),pageHeroAvatarVariant:"stakingStatusInProcess",pageHeroIcon:N.B2l}:"deactivating"===e?{title:a("staking_status_unstaking"),pageHeroAvatarVariant:"stakingStatusInProcess",pageHeroIcon:N.B2l}:"deactivating-inactive"===e?{title:a("staking_status_unstaking"),pageHeroAvatarVariant:"stakingStatusUnstaked",pageHeroIcon:N.owJ}:"inactive-active"===e?{title:a("staking_status_active"),pageHeroAvatarVariant:"stakingStatusStaked",pageHeroIcon:N.owJ}:"inactive"===e?{title:a("staking_status_unstaked"),pageHeroAvatarVariant:"stakingStatusUnstaked",pageHeroIcon:N.owJ}:"empty"===e?{title:a("staking_status_empty_title"),pageHeroAvatarVariant:"stakingStatusEmpty",pageHeroIcon:N.dLy}:{title:a("staking_status_unstaked"),pageHeroAvatarVariant:"stakingStatusUnstaked",pageHeroIcon:N.owJ}})(I,j),K=(0,b.s)(I.amount||0),P=d&&void 0!==d.header?.totalAmount?K.multipliedBy(new k.Z(d.header?.price?.price||0)).toString():void 0,M=(0,lt.X)(d?.header.epochEndSeconds??0),E=Boolean(I.lockup),H={...S.TQ,amountInSol:(0,u.ED)({amount:K,displayType:"solana"}),amountInUsd:(0,u.ED)({amount:P,displayType:"value"}),validatorName:D?.name??p.validatorName,validatorVotePubKey:D?.votePublicKey??p.validatorVotePubKey,validatorNodePubKey:D?.nodePublicKey??p.validatorNodePubKey};return(0,n.jsxs)(r.PagePortal,{children:[(0,n.jsx)(r.PageTitle,{left:(0,n.jsx)(r.ActionableIcon,{onClick:()=>{g({...S.TQ}),v(h.xm)},icon:c.acZ,size:"l"}),center:L,right:(0,n.jsx)(J,{stakingAccount:I,openSplitModal:t,setSelectedRestakeAccount:e,tEvents:H})}),(0,n.jsxs)(r.PageContent,{children:[(0,n.jsx)(r.StakingHero,{avatar:(0,n.jsx)(r.IconAvatar,{background:B,size:"l",icon:F}),amount:(0,u.ED)({amount:K,displayType:"solana",suffix:" SOL"}),value:void 0!==P?(0,n.jsx)(f.sp,{value:P}):null,actions:(()=>{const t=[];switch(E&&t.push((0,n.jsx)(r.Alert,{title:j("staking_alert_locked_title"),message:j("staking_alert_locked_message"),variant:"info"},"actions-alert")),T){case"active":t.push((0,n.jsx)(Y,{stakingAccount:I,openDeactivateModal:l},"actions-button"));break;case"deactivating-inactive":t.push((0,n.jsx)(it,{stakingAccount:I},"actions-button"));break;case"inactive-active":t.push((0,n.jsx)(et,{stakingAccount:I,openDeactivateModal:l},"actions-button"));break;case"inactive":t.push((0,n.jsx)(at,{openWithdrawModal:a,stakingAccount:I},"actions-button"));break;case"empty":t.push((0,n.jsx)(tt,{stakingAccount:I},"actions-button"))}return t})(),banner:"deactivating"===T||"deactivating-inactive"===T?(0,n.jsx)(rt.v,{stakeAccount:I}):void 0}),(D||w||E)&&(0,n.jsx)(r.TabsContainer,{activeTab:""!==y?y:D||E?"details":"rewards",onChange:t=>C(t),tabs:[...D||E?[{value:"details",label:j("form_details"),content:(0,n.jsxs)(r.DetailsSection,{children:[E&&(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(r.DetailsSectionRow,{title:(0,n.jsx)(r.SectionTitle,{title:j("staking_unlock_time_label")}),content:(0,lt.X)(I.lockup?.expiresInSeconds??0)}),(0,n.jsx)(r.Divider,{fullWidthNegativeMargin:!0})]}),D&&(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(r.DetailsSectionRow,{title:(0,n.jsx)(r.SectionTitle,{title:j("staking_native_validator")}),content:(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(r.ValidatorAvatar,{size:"s",src:D.image||void 0}),D.name??(0,m.r)(D.votePublicKey),(0,n.jsx)(r.ActionableIcon,{icon:c.gJF,size:"s",onClick:()=>_({type:"account",address:D?.votePublicKey})})]})}),(0,n.jsx)(r.Divider,{fullWidthNegativeMargin:!0})]}),I.statuses.includes("deactivating")&&(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(r.DetailsSectionRow,{title:(0,n.jsx)(r.SectionTitle,{title:j("staking_unstake_time_label")}),content:M}),(0,n.jsx)(r.Divider,{fullWidthNegativeMargin:!0})]}),I.statuses.includes("activating")&&(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(r.DetailsSectionRow,{title:(0,n.jsx)(r.SectionTitle,{title:j("staking_stake_detail_time_to_stake_label")}),content:M}),(0,n.jsx)(r.Divider,{fullWidthNegativeMargin:!0})]}),D&&(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(r.DetailsSectionRow,{title:(0,n.jsx)(r.SectionTitle,{title:j("table_apy")}),content:(0,u.ED)({amount:D.apy,displayType:"medium",suffix:"%"})}),(0,n.jsx)(r.Divider,{fullWidthNegativeMargin:!0}),(0,n.jsx)(r.DetailsSectionRow,{title:(0,n.jsx)(r.SectionTitle,{title:j("staking_stake_detail_total_stake_label")}),content:(0,u.ED)({amount:(0,b.s)(D.stakeActive),displayType:"none",suffix:" SOL"})})]})]})}]:[],...w?[{value:"rewards",label:j("form_rewards"),content:(0,n.jsx)(ct,{stakingAccount:I})}]:[]]})]})]})},ut=()=>{const[t,a]=(0,i.useState)(),[e,o]=(0,i.useState)(),[c,r]=(0,i.useState)(),[l,d]=(0,i.useState)();return(0,n.jsxs)(n.Fragment,{children:[(0,s.V$)([{index:!0,element:(0,n.jsx)(F,{})},{path:"stake/:stakeId",element:(0,n.jsx)(dt,{setSplitAccount:o,setWithdrawAccount:a,setSelectedRestakeAccount:r,setDeactivateAccount:d})},{path:"restake/:stakeId",element:(0,n.jsx)(H,{})}]),c&&(0,n.jsx)(w.C,{}),t&&(0,n.jsx)(T,{withdrawStakeAccount:t,setWithdrawStakeAccount:a}),e&&(0,n.jsx)(A,{splitStakeAccount:e,setSplitStakeAccount:o}),l&&(0,n.jsx)(L.K,{stakeAccount:l,close:()=>d(void 0)})]})}},"../../libs/shared/dist/assets/list-rewards-empty.png":(t,a,e)=>{t.exports=e.p+"assets/list-rewards-empty.089e294b..png"}}]);