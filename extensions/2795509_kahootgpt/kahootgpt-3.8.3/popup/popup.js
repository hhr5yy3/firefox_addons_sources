let injection=document.getElementById("injection"),purchase=document.getElementById("pay"),nopay=document.getElementById("nopay"),login=document.getElementById("login"),tutorial=document.getElementById("tutorial"),close_tutorial=document.getElementById("tutorial-close"),never_tutorial=document.getElementById("tutorial-never"),emailInput=document.getElementById("emailInput"),loginStatus=document.getElementById("loginStatus"),sendLink=document.getElementById("sendLink"),cancelLogin=document.getElementById("cancelLogin"),unsubscribe=document.getElementById("unsubscribe"),logout=document.getElementById("logout"),loginmodal=document.getElementById("login-modal"),cover=document.getElementById("cover"),settings=document.getElementById("settings"),config=document.getElementById("config"),checkbox=document.getElementById("checkbox"),toggle=document.getElementById("toggle"),powericon=document.getElementById("power-icon"),tapstatus=document.getElementById("autoclick-status"),kgptconfigbutton=document.getElementById("kgpt-config-button"),kgptconfig=document.getElementById("kgpt-config"),openaiconfigbutton=document.getElementById("openai-config-button"),openaiconfig=document.getElementById("openai-config"),openaikeyinput=document.getElementById("openaikeyinput"),storekey=document.getElementById("storekey"),autohi=document.getElementById("autohighlight"),autoin=document.getElementById("autoimport"),models=document.getElementById("models"),save=document.getElementById("save"),cancel=document.getElementById("cancel"),attach=document.getElementById("attach"),fakeattach=document.getElementById("fake"),detach=document.getElementById("detach"),kgptconsole=document.getElementById("console"),advert=document.getElementById("advert"),exitadvert=document.getElementById("exit-advert");var openAIKey,toggled=!1,kahootId=0,attached=!1,paid=!1,autoHighlight=!1,autoImport=!1,model="gpt-3.5-turbo-0125";let completion_type=["text-davinci-003","text-davinci-002","text-davinci-001"],chat_type=["o1-mini","o1-preview","gpt-4o-mini","gpt-4o","gpt-4-turbo","gpt-4","gpt-3.5-turbo-0125","gpt-3.5-turbo-1106"];async function is_paid(){var e=await chrome.runtime.sendMessage("is_paid"),t=document.getElementById("pro");!0===e?(console.log("Paid"),paid=!0,closepaypage(),t.innerHTML="PRO",t.classList.add("pro"),closepaypage(),logDebug("User has paid"),chrome.tabs.sendMessage(kahootId,{type:"paid",value:paid.toString()},e=>{console.log("Paid: Updated")})):(console.log("Not paid"),paid=!1,t.innerHTML="",t.classList.remove("pro"),logDebug("User has not paid"),logout.textContent="Login",unsubscribe.style.opacity=.75,unsubscribe.style.cursor="not-allowed")}function life(){console.log("LIFETIME CLICKED"),chrome.windows.create({url:"https://buy.stripe.com/7sIbMBeCn0XWgY88wA",type:"popup",width:500,height:700},function(e){console.log("Window created:",e)})}function monthly(){console.log("MONTHLY CLICKED"),chrome.windows.create({url:"https://buy.stripe.com/4gwcQFfGrdKIfU45kn",type:"popup",width:500,height:700},function(e){console.log("Window created:",e)})}function max(){console.log("MAX CLICKED"),chrome.windows.create({url:"https://buy.stripe.com/6oEeYN3XJ36437idQV",type:"popup",width:500,height:700},function(e){console.log("Window created:",e)})}async function callKahootGPT(e){var t,{id:e,url:o}=e;o.startsWith("https://kahoot.it/")&&(chrome.scripting.executeScript({target:{tabId:e,allFrames:!0},files:["/scripts/contentScript.js"]}),console.log("Loading: "+o),logVerb("Loading: "+o),await sleep(4e3),kahootId=e,attached=!0,chrome.tabs.sendMessage(e,{type:"initialize",value:paid.toString(),key:openAIKey,hl:autoHighlight.toString(),im:autoImport.toString(),md:model.toString()},e=>{"initialized"===e.data&&console.log("Connected to injected script"),logLog("Connected")}),await sleep(100),t=setInterval(()=>{injection.style.opacity||(injection.style.opacity=1),0<injection.style.opacity?injection.style.opacity-=.1:(clearInterval(t),injection.style.display="none")},25),toggled||checkbox.click())}function toggleAutoTap(){toggled?(checkbox.style.boxShadow="0 4px 4px -2px #000",toggle.style.background="#525252",powericon.style.fill="#b7b7b7",tapstatus.innerHTML="Auto-hoist OFF",tapstatus.style.color="#b7b7b7"):(checkbox.style.boxShadow="none",toggle.style.background="#9d86c3",powericon.style.fill="#9d86c3",tapstatus.innerHTML="Auto-hoist ON",tapstatus.style.color="#864cbf"),toggled=!toggled,console.log("Toggled: "+toggled),logLog("Toggled: "+toggled)}function closepaypage(){var e=setInterval(()=>{purchase.style.opacity||(purchase.style.opacity=1),0<purchase.style.opacity?purchase.style.opacity-=.1:(clearInterval(e),purchase.style.display="none")},12);logDebug("Pay page closed")}async function getCurrentTab(){var[e]=await chrome.tabs.query({active:!0,lastFocusedWindow:!0});return logDebug("Retrieved current tab"),e}function setAPIKey(e){chrome.storage.local.set({key:e},()=>{console.log("Key setted"),openAIKey=e,logVerb("API key set")})}function getAPIKey(){chrome.storage.local.get(["key"],e=>{console.log("Key queried"),openAIKey=e.key||openAIKey,logVerb("API key retrieved")})}function setHighlight(e){chrome.storage.local.set({highlight:e},()=>{console.log("Highlight setted"),autoHighlight=e,logVerb("Highlight set")})}function getHighlight(){chrome.storage.local.get(["highlight"],e=>{console.log("Highlight queried"),autoHighlight=e.highlight||autoHighlight,logVerb("Highlight retrieved")})}function setImport(e){chrome.storage.local.set({import:e},()=>{console.log("Import setted"),autoImport=e,logVerb("Import set")})}function getImport(){chrome.storage.local.get(["import"],e=>{console.log("Import queried"),autoImport=e.import||autoImport,logVerb("Import retrieved")})}function setModel(e){chrome.storage.local.set({model:e},()=>{console.log("Model setted"),model=e,logVerb("Model set")})}function getModel(){chrome.storage.local.get(["model"],e=>{console.log("Model queried"),e.model&&(completion_type.includes(e.model)||chat_type.includes(e.model))&&(model=e.model||model),logVerb("Model retrieved")})}function logError(e){appendConsole(`<span data="entry" class="entry error">${e}</span>`)}function logLog(e){appendConsole(`<span data="entry" class="entry log">${e}</span>`)}function logDebug(e){appendConsole(`<span data="entry" class="entry debug">${e}</span>`)}function logVerb(e){appendConsole(`<span data="entry" class="entry verb">${e}</span>`)}function appendConsole(e){kgptconsole.innerHTML+=e;let t=document.querySelectorAll('[data="entry"]');for(;50<t.length;)(t=document.querySelectorAll('[data="entry"]'))[0].outerHTML="";kgptconsole.scroll({top:kgptconsole.scrollHeight,behavior:"smooth"})}let sleep=t=>new Promise(e=>setTimeout(e,t));function attachScript(a){injection.style.display="flex";var e=0,t=(injection.style.opacity=e,setInterval(()=>{injection.style.opacity<1?(e+=.1,injection.style.opacity=e):clearInterval(t)},12));getCurrentTab().then(o=>{let n=o["id"];chrome.tabs.sendMessage(n,{type:"ping",value:"settings",key:openAIKey,hl:autoHighlight.toString(),im:autoImport.toString(),md:model.toString()},e=>{var t;chrome.runtime.lastError?a?t=setInterval(()=>{injection.style.opacity||(injection.style.opacity=1),0<injection.style.opacity?injection.style.opacity-=.1:(clearInterval(t),injection.style.display="none")},25):(console.log("Not injected; preparing injection"),callKahootGPT(o)):(console.log("Already injected"),logVerb("Already injected"),logLog("Connected"),"true"===(e.value||{}).toString()&&(checkbox.disabled=!1,checkbox.click()),t=setInterval(()=>{injection.style.opacity||(injection.style.opacity=1),0<injection.style.opacity?injection.style.opacity-=.1:(clearInterval(t),injection.style.display="none")},25),kahootId=n,attached=!0,getAPIKey(),getImport())})})}checkbox.addEventListener("click",async()=>{var e,t;await is_paid(),paid?(toggleAutoTap(),chrome.tabs.sendMessage(kahootId,{type:"autotap",value:toggled.toString()},e=>{console.log("Auto-tap: Toggled")})):(purchase.style.display="block",checkbox.style.boxShadow="none",toggle.style.background="#ff9494",powericon.style.fill="#ff9494",tapstatus.innerHTML="Get PRO in popup",tapstatus.style.color="#ff9494",e=0,purchase.style.opacity=e,t=setInterval(()=>{purchase.style.opacity<1?(e+=.1,purchase.style.opacity=e):clearInterval(t)},12),console.log("Auto-tap: Not paid"),logDebug("User has not paid"))}),kgptconfigbutton.addEventListener("click",()=>{kgptconfig.style.display="block",openaiconfig.style.transform="translateX(500px)",kgptconfig.style.transform="translateX(0px)",kgptconfigbutton.style.background="linear-gradient(#525252, #52525200)",openaiconfigbutton.style.background="transparent"}),openaiconfigbutton.addEventListener("click",()=>{openaiconfig.style.display="block",kgptconfig.style.transform="translateX(-500px)",openaiconfig.style.transform="translateX(0px)",openaiconfigbutton.style.background="linear-gradient(#525252, #52525200)",kgptconfigbutton.style.background="transparent"}),unsubscribe.addEventListener("click",async()=>{var e,t;await is_paid(),0==paid?(purchase.style.display="block",e=0,purchase.style.opacity=e,t=setInterval(()=>{purchase.style.opacity<1?(e+=.1,purchase.style.opacity=e):clearInterval(t)},12)):chrome.storage.local.get(["email","accessToken"],async e=>{fetch("https://api.kahootgpt.itsmarsss.com/api/unsubscribe",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:e.email,accessToken:e.accessToken})}).then(e=>{if(e.ok)return e.json();unsubscribe.textContent="Error occured",logError("Error canceling subscription"),setTimeout(()=>{unsubscribe.textContent="Cancel Subscription"},3e3)}).then(e=>{unsubscribe.textContent=e.message,logVerb("User cancelled subscription"),setTimeout(()=>{unsubscribe.textContent="Cancel Subscription"},3e3)})})}),logout.addEventListener("click",async()=>{var e,t;await is_paid(),0==paid?(purchase.style.display="block",e=0,purchase.style.opacity=e,t=setInterval(()=>{purchase.style.opacity<1?(e+=.1,purchase.style.opacity=e):clearInterval(t)},12)):chrome.storage.local.get(["email","accessToken"],async e=>{fetch("https://api.kahootgpt.itsmarsss.com/api/signout",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:e.email,accessToken:e.accessToken})}).then(()=>{chrome.storage.local.remove(["email","accessToken"]),logout.textContent="Logged out",unsubscribe.style.opacity=.75,unsubscribe.style.cursor="not-allowed",paid=!1,chrome.tabs.sendMessage(kahootId,{type:"paid",value:paid.toString()},e=>{console.log("Paid: Updated")}),logVerb("User logged out"),setTimeout(()=>{logout.textContent="Login"},3e3)})})}),document.getElementsByClassName("life")[0].addEventListener("click",life),document.getElementsByClassName("month")[0].addEventListener("click",monthly),document.getElementsByClassName("max")[0].addEventListener("click",max),attach.addEventListener("click",()=>{attachScript(!1)}),fakeattach.addEventListener("click",()=>{attachScript(!1)}),detach.addEventListener("click",()=>{getCurrentTab().then(e=>{e=e.id;kahootId=e,chrome.tabs.reload(kahootId),toggled&&checkbox.click(),logLog("Detached (reloaded)")})}),settings.addEventListener("click",async()=>{logDebug("Open settings"),storekey.checked&&getAPIKey(),getHighlight(),getImport(),getModel(),await sleep(500),openaikeyinput.value=openAIKey,autohi.checked=autoHighlight,autoin.checked=autoImport;for(var e=0;e<models.options.length;e++)if(models.options[e].value==model){models.options[e].selected=!0;break}config.style.display="block";var t=0,o=(config.style.opacity=t,setInterval(()=>{config.style.opacity<1?(t+=.1,config.style.opacity=t):clearInterval(o)},12));kgptconfigbutton.click()}),openaikeyinput.addEventListener("mouseover",()=>{openaikeyinput.type="text"}),openaikeyinput.addEventListener("mouseout",()=>{openaikeyinput.type="password"}),save.addEventListener("click",async()=>{logDebug("Close settings - save changes"),storekey.checked?openaikeyinput.value!=openAIKey&&(setAPIKey(openaikeyinput.value),chrome.tabs.sendMessage(kahootId,{type:"setapikey",value:openaikeyinput.value},e=>{window.chrome.runtime.lastError&&logError("Error sending data - <i>you can ignore this</i>")})):openAIKey=openaikeyinput.value,autohi.checked!=autoHighlight&&(setHighlight(autohi.checked),chrome.tabs.sendMessage(kahootId,{type:"sethighlight",value:autohi.checked.toString()},e=>{window.chrome.runtime.lastError&&logError("Error sending data - <i>you can ignore this</i>")})),autoin.checked!=autoImport&&(setImport(autoin.checked),chrome.tabs.sendMessage(kahootId,{type:"setimport",value:autoin.checked.toString()},e=>{window.chrome.runtime.lastError&&logError("Error sending data - <i>you can ignore this</i>")})),models.options[models.selectedIndex].value!=model&&(setModel(models.value),chrome.tabs.sendMessage(kahootId,{type:"setModel",value:models.options[models.selectedIndex].value.toString()},e=>{window.chrome.runtime.lastError&&logError("Error sending data - <i>you can ignore this</i>")})),await sleep(500);var e=setInterval(()=>{config.style.opacity||(config.style.opacity=1),0<config.style.opacity?config.style.opacity-=.1:(clearInterval(e),config.style.display="none")},12);await is_paid()}),cancel.addEventListener("click",async()=>{logDebug("Close settings - cancel changes");var e=setInterval(()=>{config.style.opacity||(config.style.opacity=1),0<config.style.opacity?config.style.opacity-=.1:(clearInterval(e),config.style.display="none")},12);await is_paid()});var fadeEffect,checkAvailability=setInterval(()=>{chrome.tabs.sendMessage(kahootId,{type:"checkup",value:openAIKey},e=>{window.chrome.runtime.lastError?(console.log("Disconnected"),attached=!1,cover.style.display="block",toggled&&checkbox.click(),checkbox.disabled=!0):(cover.style.display="none",checkbox.disabled=!1)})},100);nopay.addEventListener("click",()=>{closepaypage()}),login.addEventListener("click",()=>{loginmodal.style.transform="translateY(0)"}),sendLink.addEventListener("click",()=>{logDebug("Send login link"),fetch("https://api.kahootgpt.itsmarsss.com/api/signin",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:emailInput.value})}).then(e=>{if(e.ok)return logVerb("Login link sent"),loginStatus.textContent="Check your inbox! Screen closing in 3 seconds.",setTimeout(()=>{loginmodal.style.transform="translateY(-150%)"},3e3),e.json();logVerb("Email not found | Error occured"),loginStatus.textContent="Email not found"}).then(e=>{chrome.storage.local.set({email:emailInput.value.toLowerCase(),accessToken:e.accessToken})})}),cancelLogin.addEventListener("click",()=>{loginmodal.style.transform="translateY(-150%)"}),exitadvert.addEventListener("click",()=>{var e=setInterval(()=>{advert.style.opacity||(advert.style.opacity=1),0<advert.style.opacity?advert.style.opacity-=.1:(clearInterval(e),advert.style.display="none")},25)}),close_tutorial.addEventListener("click",()=>{var e=setInterval(()=>{tutorial.style.opacity||(tutorial.style.opacity=1),0<tutorial.style.opacity?tutorial.style.opacity-=.1:(clearInterval(e),tutorial.style.display="none")},25)}),never_tutorial.addEventListener("click",()=>{var e=setInterval(()=>{tutorial.style.opacity||(tutorial.style.opacity=1),0<tutorial.style.opacity?tutorial.style.opacity-=.1:(clearInterval(e),tutorial.style.display="none")},25);chrome.storage.local.set({tutorial:!1})}),getAPIKey(),getHighlight(),getImport(),getModel();let manifest=chrome.runtime.getManifest(),ads=(console.log("Version: v"+manifest.version),document.getElementById("KahootGPT").innerHTML="KahootGPT v"+manifest.version,await is_paid(),chrome.storage.local.get(["tutorial"],function(e){var t,o;!1!==e.tutorial&&(tutorial.style.display="flex",t=0,tutorial.style.opacity=t,o=setInterval(()=>{tutorial.style.opacity<1?(t+=.1,tutorial.style.opacity=t):clearInterval(o)},12))}),[{img:"../assets/ad-0.png",link:"https://chromewebstore.google.com/detail/pcogcfinllbgfmhmcpnighcpepnfpfca",title:"Typing Statistics | Auto Typer",description:"Typing Statistics: Tracks WPM and other Statistics as well as auto typer"},{img:"../assets/ad-1.png",link:"https://chromewebstore.google.com/detail/nclcdonlldfknpglcdhgpcaljjodedod",title:"YouTube AdSkipper / AdBlocker",description:"The only YouTube AdSkipper/AdBlocker that works."}]),ad=ads[Math.floor(Math.random()*ads.length)];async function loadiFrame(){document.getElementById("discord-widget-cont").innerHTML+=`<iframe class="discord-widget" src="https://discord.com/widget?id=1021555821907300423&theme=dark"
    width="550" height="435" allowtransparency="true" frameborder="0"
    sandbox="allow-popups allow-popups-to-escape-sandbox allow-same-origin allow-scripts"></iframe>`}document.getElementById("media").src=ad.img,document.getElementById("ad-link").href=ad.link,document.getElementById("ad-title").innerHTML=ad.title,document.getElementById("ad-description").innerHTML=ad.description,(.3<=Math.random()||paid)&&(fadeEffect=setInterval(()=>{advert.style.opacity||(advert.style.opacity=1),0<advert.style.opacity?advert.style.opacity-=.1:(clearInterval(fadeEffect),advert.style.display="none")},25)),logLog(`~~~ Welcome to KahootGPT v${manifest.version} ~~~`),attachScript(!0),loadiFrame();