// Copyright 2023 OneTab Ltd.  All rights reserved.
const D="1.83",be=!1,ve=!1,De=!1,Te=!1,Se=!1,Le=!0,m=!!navigator.userAgent.match(/Mobile/i),Re="about:",Ee="about:blank",Ie="https://www.one-tab.com",Ce=!1,k=!1,$=!1;async function j(){return new Promise((e,t)=>{document.readyState==="complete"?e():document.addEventListener("readystatechange",n=>{document.readyState==="complete"&&e()})})}async function G(){if(m){let e=document.createElement("meta");e.name="viewport",e.content="width=400, initial-scale=1",document.getElementsByTagName("head")[0].appendChild(e)}await M(),await j(),H()}async function M(){try{let e=await chrome.tabs.getCurrent();e&&await chrome.tabs.update(e.id,{autoDiscardable:!1})}catch(e){console.log(e)}}function Pe(e){if(typeof e=="string"&&(e=document.getElementById(e)),!!e)for(;e.childNodes.length>0;)e.childNodes[0].remove()}function Ae(e){return p(void 0,"div",{style:{fontSize:"1px",height:e+"px",width:"1px"}}).o}let T=!1;async function N(e,t={}){if(!T){const r=async()=>{if((await chrome.runtime.sendMessage({args:[],type:W.A,v:!0}))?.result?.pong!==String(D))throw new Error};try{await r()}catch{console.log("core not ready. retrying..."),await b(1e3);try{await r()}catch{console.log("core not ready. retrying..."),await b(5e3);try{await r()}catch{throw new Error("Cannot connect to core")}}}T=!0}t.type=e,t.v=!0;let n=await chrome.runtime.sendMessage(t);if(n===null)throw new Error("null message response from core");if(n?.C)throw new Error(n.C);return n.result}function Fe(e){chrome.runtime.onMessage.addListener((t,n,r)=>{t.type==="stateChange"&&e(t.k)})}const W=new Proxy({},{get(e,t){return t}}),y=new Proxy({},{get(e,t,n){return(...r)=>(r=v(r,void 0,de),N(t,{args:r}))}});let O=navigator.language||navigator.userLanguage;function _(){let e=["ar","he","fa","ps","ur"],t=O.split("-",1)[0];return e.indexOf(t)>=0?"rtl":"ltr"}let S=_();function f(){return S!=="rtl"}function H(){document.getElementsByTagName("html")[0].dir=S}function w(){return f()?"Left":"Right"}function Ue(){return f()?"Right":"Left"}function B(){return f()?"left":"right"}function ke(){return f()?"right":"left"}function z(e,t){f()?e.style.left=t:e.style.right=t}function $e(e,t){f()?e.style.right=t:e.style.left=t}function L(e,t){f()?e.style.paddingLeft=t:e.style.paddingRight=t}function je(e,t){f()?e.style.paddingRight=t:e.style.paddingLeft=t}function V(e,t){f()?e.style.marginLeft=t:e.style.marginRight=t}class q{constructor({className:t="",q:n,width:r=n,height:o=n,style:i={},J:c={},K:l,Z:a},u){this.G=u,this.p=x("picture",{style:{position:"relative",display:"inline-block",userSelect:"none",width:r,height:o,...i},className:t,...c,draggable:!1,children:{N:x("source",{srcset:u(!0),media:"(prefers-color-scheme: light)"}),O:x("source",{srcset:u(!1),media:"(prefers-color-scheme: dark)"}),X:K()},...l&&{onmouseover:d=>this.W(!0),onmouseout:d=>this.W(!1)},...a&&{onclick:a}})}Y(t){this.G=t,this.p.N.o.srcset=t(!0),this.p.O.o.srcset=t(!1)}W(t=!1){this.p.N.o.srcset=this.G(!0,t),this.p.O.o.srcset=this.G(!1,t)}}function J(...e){return new q(...e).p.o}function K(){const e=document.createElement("img");return e.className="lightDarkInnerImg",e.draggable=!1,e}function X(e){return p(void 0,"div",{id:"headerText",style:{paddingTop:"40px",paddingBottom:"20px",[`padding${w()}`]:"240px",fontSize:"16px",color:"var(--text-color-weak)",fontWeight:"300",borderBottom:"1px dashed var(--dash-color)",marginBottom:"10px"},textContent:e}).o}function Q(){return J({style:{width:416/2+"px",height:114/2+"px",position:"absolute",top:"16px",[`${B()}`]:"19px"}},e=>`images/top-left-logo-${e?"light":"dark"}${f()?"":"-rtl"}.png`)}function Ge(e,t,n){let r=document.createElement("div"),o=document.createElement("div");L(o,"30px"),o.style.position="relative";let i=document.createElement("img");i.src=e?"images/twister-open.png":"images/twister-closed"+(f()?"":"-rtl")+".png",i.style.width=48/2+"px",i.style.height=50/2+"px",i.style.position="absolute",z(i,"0px"),i.style.top="0px",o.textContent=t,o.style.fontSize="16px",o.style.cursor="pointer",r.appendChild(o),o.appendChild(i);let c=document.createElement("div");L(c,"30px"),c.style.paddingTop="10px",c.appendChild(n.o),c.style.display=e?"block":"none",r.appendChild(c),o.onclick=()=>{e=!e,i.src=e?"images/twister-open.png":"images/twister-closed"+(f()?"":"-rtl")+".png",c.style.display=e?"block":"none"};let l={D:n.o};return Object.assign(l,n),l.o=r,l}function Me(e,t,n,r){let o=document.createElement("div");o.style.fontSize=t+"px",o.className="clickable";let i=document.createElement("span");if(r){let c=document.createElement("span");c.textContent=s("newExclamation")+" ",i.appendChild(c)}return typeof e=="string"?i.appendChild(document.createTextNode(e)):i.appendChild(e),i.style.verticalAlign="middle",i.onclick=c=>{n(i)},o.appendChild(i),o}const R=chrome.runtime.getURL("onetab.html"),E=R.substring(0,R.length-"onetab.html".length);let I=!1;async function Ne(){return I?(await chrome.permissions.getAll()).permissions.includes("tabGroups")&&chrome.tabGroups:!1}async function We(){if(!I||$)return!1;try{return await chrome.permissions.request({permissions:["tabGroups"]})}catch(e){return console.log('chrome.permissions.request for "tabGroups" permission failed with error:'),console.log(e),!1}}function Oe(e){let t=C(e);return t.toLowerCase().startsWith("www.")?t.substring("www.".length):t}function C(e){return e?(e.indexOf("//")===0&&(e="http:"+e),e.indexOf("://")===-1&&(e="http://"+e),e=e.substring(e.indexOf("://")+"://".length),e.indexOf("/")!==-1&&(e=e.substring(0,e.indexOf("/"))),e.indexOf(":")!==-1&&(e=e.substring(0,e.indexOf(":"))),e.indexOf("?")!==-1&&(e=e.substring(0,e.indexOf("?"))),e.indexOf("#")!==-1&&(e=e.substring(0,e.indexOf("#"))),e.toLowerCase()):"undefined"}function _e(e){return e.indexOf("://")===-1?"https://":(e=e.substring(0,e.indexOf("://")+"://".length),e.toLowerCase())}let P=["com","co.uk","org.uk","net","org","de","ru","info","xyz","nl"];function He(e){let t=C(e);try{for(let n in P){let r="."+P[n];if(oe(t,r)){for(t=t.substring(0,t.length-r.length);t.indexOf(".")!==-1;)t=t.substring(t.indexOf(".")+1);t=t+r;break}}return t.indexOf("www.")===0&&(t=t.substring("www.".length)),t}catch{return t}}function Y(e){e.noCacheRandom=Z()}function Z(){return new Date().getTime()+Math.round(Math.random()*1e4)+""}async function Be(e,t){Y(t);let n=JSON.stringify(t);return await(await ee(e,n)).json()}async function ee(e,t){let n={};t?(n.method="POST",n.body=t):n.method="GET",n.headers=new Headers,n.headers.append("Content-Type","text/json");let r=await fetch(e,n);if(r.status===200)return r;throw new Error("http response code"+r.status)}function ze(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,e=>{let t=Math.random()*16|0;return(e=="x"?t:t&3|8).toString(16)})}const te="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz-_".split("");function ne(e,t){let n=te,r=[],o=0;for(t=t||n.length,e=e||22,o=0;o<e;o++)r[o]=n[0|Math.random()*t];return r.join("")}function re(){return ne()}function Ve(){return re()}function qe(e){return e==null?"":e.replace(/^\s+/,"").replace(/\s+$/,"")}function Je(e,t){return e?.length>t&&(e=e.substring(0,t)+"…"),e}function Ke(...e){return(t,n)=>e.reduce((r,o)=>r||o(t,n),0)}function Xe(e){return(t,n)=>e(t)-e(n)}function Qe(e){return(t,n)=>e(n)-e(t)}const Ye=(e,t)=>!!t.starred-!!e.starred||e.starred&&t.starred&&t.starredDate-e.starredDate||t.createDate-e.createDate;function Ze(e){return e||(e=""),e.replace(/[\x00-\x1F\x7F-\x9F]/g,"")}function oe(e,t){return e?e.indexOf(t,e.length-t.length)!==-1:!1}const ie={restoreWindow:"newWindow",pinnedTabs:"ignore",startupLaunch:"displayOneTab",restoreRemoval:"default",duplicates:"allow",pinned:"true"};function et(e,t){return t[e]?t[e]:ie[e]}function tt(e,t,n){e.parentNode&&e.remove(),t.insertBefore(e,n===void 0||n>=t.children.length||t.children.length===0?null:t.children[Math.max(0,n)])}function A(e,t){return x("div",e,t)}function x(e,t,n){return p(void 0,e,t,n)}function p(e,t,n,r){let o=t===void 0?e:document.createElement(t),i={},c={};if(n){n.style&&Object.assign(o.style,n.style);for(let a of Object.keys(n))a!=="style"&&a!=="children"&&a!=="child"&&a!=="init"&&(o[a]=n[a]),(a==="role"||a==="placeholder")&&o.setAttribute(a,n[a]);if(n.children){let a=Object.entries(n.children);for(const[u,d]of a)d instanceof HTMLElement?o.appendChild(d):(o.appendChild(d?.p?.o??d.o),d.u&&(Object.assign(c,d.u),c[u]=d));for(const[u,d]of a)i[u]=d,c[u]=d}if(n.l){let a=n.l;i.l=a,o.appendChild(a instanceof HTMLElement?a:a?.p?.o??a.o)}}t!==void 0&&e&&e.appendChild(o);let l={o,u:c};return Object.assign(l,i),r&&Object.assign(l,r),n?.init&&n.init(l),l}const F="about:reader?url=";function nt(e){return e?e.indexOf(":")===-1?"https://"+e:e.indexOf(F)===0?decodeURIComponent(e.substring(F.length)):e.startsWith(`${E}placeholder.html?`)?new URLSearchParams(e.substring(e.indexOf("?"))).get("url"):e:""}function rt(e){let t=e.match(/\d+/);if(t)return parseInt(t[0])}const U=[...new Array(30)].map((e,t)=>parseInt(10+Math.pow(1.6,t)));function*ae(e){let t=0;for(;U.slice(0,t).reduce((n,r)=>n+r,0)<e;)yield U[t++]}async function ot(e,t,n){let r=0;for(let o of ae(e)){if(await n(r))return;await b(o),r+=o}throw new Error(`Timeout waiting for condition ${t}`)}function s(e){let t=chrome.i18n.getMessage(e);return t||(console.log("No translation available for: "+e),e)}function it(e,t,n){return t&&((e||"").toLowerCase().startsWith("file:")||ce(e))?n?`data:text/html, <html><body><div id="placeholderUrl">${e}</div></body></html>`:`${E}placeholder.html?url=${encodeURI(e)}`:e}async function at(){try{return k||!0}catch(e){return console.log(e),!0}}function ce(e){for(let t of se)if(e.startsWith(t))return!0;return!!(!e||e===""||e.startsWith("chrome-devtools:"))}const se=["javascript:","about:",...["chrome://","edge://","data:"].filter(e=>!0),...["edge://","chrome://"].map(e=>["newtab","new-tab-page","print","network-error","badcastcrash","inducebrowsercrashforrealz","crash","crashdump","kill","hang","shorthang","gpuclean","gpucrash","gpuhang","memory-exhaust","memory-pressure-critical","memory-pressure-moderate","ppapiflashcrash","ppapiflashhang","quit","restart"].map(t=>`${e}${t}/`)).flat()];async function b(e){return new Promise(t=>setTimeout(t,e))}class ue{async put(t,n){await chrome.storage.local.set({[t]:n})}async get(t){return(await chrome.storage.local.get([t]))[t]}async remove(t){return await chrome.storage.local.remove(t)}}const le=new ue;function g(){return le}const de="undefined-34LKmiHxP3Mu48u8qrDaHf";function v(e,t,n){return Array.isArray(e)?e.map(r=>v(r,t,n)):typeof e=="object"&&e!==null?Object.fromEntries(Object.entries(e).map(([r,o])=>[r,v(o,t,n)])):e===t?n:e}const ct="c",st="e",ut="tg";class fe{async put(t,n){await chrome.storage.session.set({[t]:n})}async get(t){return(await chrome.storage.session.get([t]))[t]}async getAll(){return await chrome.storage.session.get(null)}async remove(t){return await chrome.storage.session.remove(t)}async clearAll(){await chrome.storage.session.clear()}}class pe{async put(t,n){await g().put("sessionStore",{...await this.getAll(),[t]:n})}async get(t){return(await this.getAll())[t]}async getAll(){return await g().get("sessionStore")??{}}async remove(t){let n=await this.getAll();delete n[t],await g().put("sessionStore",n)}async clearAll(){await g().remove("sessionStore")}}const we=chrome.storage.session?new fe:new pe;function lt(){return we}function dt(){return navigator.userAgent.includes(" Edg/")}async function ft(e){let[t]=await chrome.tabs.query({windowId:e.windowId,active:!0});t&&t.id!==e.id?(await chrome.tabs.update(e.id,{active:!0}),await chrome.tabs.update(t.id,{active:!0})):console.log("No active tab found")}function pt(e,t){let n,r;return arguments.length===1?(n=e,r=n!==void 0):(r=e,n=t),r?[n]:[]}function wt({id:e,display:t,marginTop:n="16px",marginBottom:r="16px",marginLeft:o=0,marginRight:i=0,color:c="var(--border-color)",I:l,P:a,F:u}={}){return A({...e&&{id:e},...a&&{className:"hideIfInLastSection"},...u&&{className:"hideIfInLastSubsection"},style:{...t&&{display:t},marginTop:n,marginBottom:r,marginLeft:o,marginRight:i,borderBottom:`1px solid ${c}`,...l}})}function ht(e){return[`
`,"\v","\f","\r","","\u2028","\u2029"].some(t=>t===e)}const he=["\v","\f","\r","","\u2028","\u2029"];function xt(e){return e?(e=e.replaceAll(`\r
`,`
`),he.forEach(t=>e=e.replaceAll(t,`
`)),e):""}setTimeout(async()=>{await G(),await xe()},1);function xe(){ge()}function ge(){p(document.getElementById("contentAreaDiv"),void 0,{style:{paddingTop:"0px",[`padding${w()}`]:"0px"},children:{st:Q(),header:X(s("options")),tn:p(void 0,"div",{style:{paddingTop:"24px",[`padding${w()}`]:"36px"},children:{...!m&&{nn:h("restoreWindow",s("optionTabGroupRestoreTitle"),[{settingValue:"newWindow",title:s("optionTabGroupRestoreNewWindow")},{settingValue:"newWindowAlways",title:s("optionTabGroupRestoreNewWindowAlways")},{settingValue:"currentWindow",title:s("optionTabGroupRestoreCurrentWindowAlways")}]),rn:h("pinnedTabs",s("optionPinnedTabsTitle"),[{settingValue:"ignore",title:s("optionPinnedTabsDontSend"),en:s("optionPinnedTabsDontSendDesc")},{settingValue:"allow",title:s("optionPinnedTabsAllow")}],s("optionPinnedTabsNote")),on:h("startupLaunch",s("optionStartupLaunchTitle"),[{settingValue:"displayOneTab",title:s("optionStartupLaunchDisplay")},{settingValue:"none",title:s("optionStartupLaunchNone"),en:s("optionStartupLaunchNoneDesc")}])},an:h("restoreRemoval",s("optionRestoreRemovalTitle"),[{settingValue:"default",title:s("optionRestoreRemovalDefault"),en:s("optionRestoreRemovalDefaultDesc")},{settingValue:"keep",title:s("optionRestoreRemovalKeep"),en:s("optionRestoreRemovalKeepDesc")}]),...!m&&{cn:h("duplicates",s("optionDuplicatesTitle"),[{settingValue:"allow",title:s("optionDuplicatesAllow")},{settingValue:"reject",title:s("optionDuplicatesReject"),en:s("optionDuplicatesRejectDesc")}])},sn:A({style:{paddingTop:"10px",paddingBottom:"10px",[`padding${w()}`]:"0px",fontSize:"10px",color:"var(--text-color-weak)"},textContent:`OneTab v${D}`})}})}})}function h(e,t,n,r){let o=p(void 0,"div",{style:{paddingBottom:"40px",maxWidth:"600px"},children:{heading:p(void 0,"div",{style:{fontSize:"14px",paddingBottom:"0px"},textContent:t})}}).o;return n.forEach(i=>o.appendChild(ye(e,`optionGroup-${e}`,i))),r&&p(o,"div",{style:{fontSize:"12.25px",color:"var(--text-color-weak)",paddingTop:"10px",paddingLeft:"0px"},textContent:r}),o}let me=0;function ye(e,t,n){let r="optionId"+me++,o=n.settingValue,i=p(void 0,"div",{style:{paddingBottom:"0px"}}).o,c=p(void 0,"input",{style:{cursor:"pointer"},id:r,type:"radio",name:t}).o;y.Aa(e).then(u=>{u===o&&(c.checked=!0)}),c.addEventListener("click",()=>{(async()=>{let u=await y.getSettings();u[e]=o,await y._e(u)})()});let l=p(void 0,"label",{style:{fontSize:"14px",cursor:"pointer"},htmlFor:r,textContent:" "+n.title}).o;i.appendChild(c),i.appendChild(l),V(i,"-5px");let a=p(void 0,"div",{style:{color:"var(--text-color-weak)",fontSize:"12.25px",paddingTop:"4px",[`padding${w()}`]:"30px"}}).o;return n.en&&(a.textContent=n.en),i.appendChild(a),i}
