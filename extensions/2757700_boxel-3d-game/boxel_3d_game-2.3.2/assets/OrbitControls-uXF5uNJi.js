import{an as Ut,q as l,aV as D,be as ft,a$ as qt,M as vt,O as ut,ak as gt,aS as Ht,bf as M,a0 as g,aT as Pt,aa as St,bg as B,a2 as h,bh as at,bi as Z,aZ as Wt,al as Kt,D as Vt,bj as Bt,bk as Gt,Z as $t,bl as H,bm as W,bn as Mt,V as j}from"./SkeletonUtils-K4FW0S_X.js";var K=Object.freeze({Linear:Object.freeze({None:function(e){return e},In:function(e){return e},Out:function(e){return e},InOut:function(e){return e}}),Quadratic:Object.freeze({In:function(e){return e*e},Out:function(e){return e*(2-e)},InOut:function(e){return(e*=2)<1?.5*e*e:-.5*(--e*(e-2)-1)}}),Cubic:Object.freeze({In:function(e){return e*e*e},Out:function(e){return--e*e*e+1},InOut:function(e){return(e*=2)<1?.5*e*e*e:.5*((e-=2)*e*e+2)}}),Quartic:Object.freeze({In:function(e){return e*e*e*e},Out:function(e){return 1- --e*e*e*e},InOut:function(e){return(e*=2)<1?.5*e*e*e*e:-.5*((e-=2)*e*e*e-2)}}),Quintic:Object.freeze({In:function(e){return e*e*e*e*e},Out:function(e){return--e*e*e*e*e+1},InOut:function(e){return(e*=2)<1?.5*e*e*e*e*e:.5*((e-=2)*e*e*e*e+2)}}),Sinusoidal:Object.freeze({In:function(e){return 1-Math.sin((1-e)*Math.PI/2)},Out:function(e){return Math.sin(e*Math.PI/2)},InOut:function(e){return .5*(1-Math.sin(Math.PI*(.5-e)))}}),Exponential:Object.freeze({In:function(e){return e===0?0:Math.pow(1024,e-1)},Out:function(e){return e===1?1:1-Math.pow(2,-10*e)},InOut:function(e){return e===0?0:e===1?1:(e*=2)<1?.5*Math.pow(1024,e-1):.5*(-Math.pow(2,-10*(e-1))+2)}}),Circular:Object.freeze({In:function(e){return 1-Math.sqrt(1-e*e)},Out:function(e){return Math.sqrt(1- --e*e)},InOut:function(e){return(e*=2)<1?-.5*(Math.sqrt(1-e*e)-1):.5*(Math.sqrt(1-(e-=2)*e)+1)}}),Elastic:Object.freeze({In:function(e){return e===0?0:e===1?1:-Math.pow(2,10*(e-1))*Math.sin((e-1.1)*5*Math.PI)},Out:function(e){return e===0?0:e===1?1:Math.pow(2,-10*e)*Math.sin((e-.1)*5*Math.PI)+1},InOut:function(e){return e===0?0:e===1?1:(e*=2,e<1?-.5*Math.pow(2,10*(e-1))*Math.sin((e-1.1)*5*Math.PI):.5*Math.pow(2,-10*(e-1))*Math.sin((e-1.1)*5*Math.PI)+1)}}),Back:Object.freeze({In:function(e){var t=1.70158;return e===1?1:e*e*((t+1)*e-t)},Out:function(e){var t=1.70158;return e===0?0:--e*e*((t+1)*e+t)+1},InOut:function(e){var t=2.5949095;return(e*=2)<1?.5*(e*e*((t+1)*e-t)):.5*((e-=2)*e*((t+1)*e+t)+2)}}),Bounce:Object.freeze({In:function(e){return 1-K.Bounce.Out(1-e)},Out:function(e){return e<1/2.75?7.5625*e*e:e<2/2.75?7.5625*(e-=1.5/2.75)*e+.75:e<2.5/2.75?7.5625*(e-=2.25/2.75)*e+.9375:7.5625*(e-=2.625/2.75)*e+.984375},InOut:function(e){return e<.5?K.Bounce.In(e*2)*.5:K.Bounce.Out(e*2-1)*.5+.5}}),generatePow:function(e){return e===void 0&&(e=4),e=e<Number.EPSILON?Number.EPSILON:e,e=e>1e4?1e4:e,{In:function(t){return Math.pow(t,e)},Out:function(t){return 1-Math.pow(1-t,e)},InOut:function(t){return t<.5?Math.pow(t*2,e)/2:(1-Math.pow(2-t*2,e))/2+.5}}}}),G=function(){return performance.now()},Et=function(){function e(){for(var t=[],i=0;i<arguments.length;i++)t[i]=arguments[i];this._tweens={},this._tweensAddedDuringUpdate={},this.add.apply(this,t)}return e.prototype.getAll=function(){var t=this;return Object.keys(this._tweens).map(function(i){return t._tweens[i]})},e.prototype.removeAll=function(){this._tweens={}},e.prototype.add=function(){for(var t,i=[],o=0;o<arguments.length;o++)i[o]=arguments[o];for(var s=0,n=i;s<n.length;s++){var r=n[s];(t=r._group)===null||t===void 0||t.remove(r),r._group=this,this._tweens[r.getId()]=r,this._tweensAddedDuringUpdate[r.getId()]=r}},e.prototype.remove=function(){for(var t=[],i=0;i<arguments.length;i++)t[i]=arguments[i];for(var o=0,s=t;o<s.length;o++){var n=s[o];n._group=void 0,delete this._tweens[n.getId()],delete this._tweensAddedDuringUpdate[n.getId()]}},e.prototype.allStopped=function(){return this.getAll().every(function(t){return!t.isPlaying()})},e.prototype.update=function(t,i){t===void 0&&(t=G()),i===void 0&&(i=!0);var o=Object.keys(this._tweens);if(o.length!==0)for(;o.length>0;){this._tweensAddedDuringUpdate={};for(var s=0;s<o.length;s++){var n=this._tweens[o[s]],r=!i;n&&n.update(t,r)===!1&&!i&&this.remove(n)}o=Object.keys(this._tweensAddedDuringUpdate)}},e}(),V={Linear:function(e,t){var i=e.length-1,o=i*t,s=Math.floor(o),n=V.Utils.Linear;return t<0?n(e[0],e[1],o):t>1?n(e[i],e[i-1],i-o):n(e[s],e[s+1>i?i:s+1],o-s)},Bezier:function(e,t){for(var i=0,o=e.length-1,s=Math.pow,n=V.Utils.Bernstein,r=0;r<=o;r++)i+=s(1-t,o-r)*s(t,r)*e[r]*n(o,r);return i},CatmullRom:function(e,t){var i=e.length-1,o=i*t,s=Math.floor(o),n=V.Utils.CatmullRom;return e[0]===e[i]?(t<0&&(s=Math.floor(o=i*(1+t))),n(e[(s-1+i)%i],e[s],e[(s+1)%i],e[(s+2)%i],o-s)):t<0?e[0]-(n(e[0],e[0],e[1],e[1],-o)-e[0]):t>1?e[i]-(n(e[i],e[i],e[i-1],e[i-1],o-i)-e[i]):n(e[s?s-1:0],e[s],e[i<s+1?i:s+1],e[i<s+2?i:s+2],o-s)},Utils:{Linear:function(e,t,i){return(t-e)*i+e},Bernstein:function(e,t){var i=V.Utils.Factorial;return i(e)/i(t)/i(e-t)},Factorial:function(){var e=[1];return function(t){var i=1;if(e[t])return e[t];for(var o=t;o>1;o--)i*=o;return e[t]=i,i}}(),CatmullRom:function(e,t,i,o,s){var n=(i-e)*.5,r=(o-t)*.5,a=s*s,p=s*a;return(2*t-2*i+n+r)*p+(-3*t+3*i-2*n-r)*a+n*s+t}}},xt=function(){function e(){}return e.nextId=function(){return e._nextId++},e._nextId=0,e}(),dt=new Et,Jt=function(){function e(t,i){this._isPaused=!1,this._pauseStart=0,this._valuesStart={},this._valuesEnd={},this._valuesStartRepeat={},this._duration=1e3,this._isDynamic=!1,this._initialRepeat=0,this._repeat=0,this._yoyo=!1,this._isPlaying=!1,this._reversed=!1,this._delayTime=0,this._startTime=0,this._easingFunction=K.Linear.None,this._interpolationFunction=V.Linear,this._chainedTweens=[],this._onStartCallbackFired=!1,this._onEveryStartCallbackFired=!1,this._id=xt.nextId(),this._isChainStopped=!1,this._propertiesAreSetUp=!1,this._goToEnd=!1,this._object=t,typeof i=="object"?(this._group=i,i.add(this)):i===!0&&(this._group=dt,dt.add(this))}return e.prototype.getId=function(){return this._id},e.prototype.isPlaying=function(){return this._isPlaying},e.prototype.isPaused=function(){return this._isPaused},e.prototype.getDuration=function(){return this._duration},e.prototype.to=function(t,i){if(i===void 0&&(i=1e3),this._isPlaying)throw new Error("Can not call Tween.to() while Tween is already started or paused. Stop the Tween first.");return this._valuesEnd=t,this._propertiesAreSetUp=!1,this._duration=i<0?0:i,this},e.prototype.duration=function(t){return t===void 0&&(t=1e3),this._duration=t<0?0:t,this},e.prototype.dynamic=function(t){return t===void 0&&(t=!1),this._isDynamic=t,this},e.prototype.start=function(t,i){if(t===void 0&&(t=G()),i===void 0&&(i=!1),this._isPlaying)return this;if(this._repeat=this._initialRepeat,this._reversed){this._reversed=!1;for(var o in this._valuesStartRepeat)this._swapEndStartRepeatValues(o),this._valuesStart[o]=this._valuesStartRepeat[o]}if(this._isPlaying=!0,this._isPaused=!1,this._onStartCallbackFired=!1,this._onEveryStartCallbackFired=!1,this._isChainStopped=!1,this._startTime=t,this._startTime+=this._delayTime,!this._propertiesAreSetUp||i){if(this._propertiesAreSetUp=!0,!this._isDynamic){var s={};for(var n in this._valuesEnd)s[n]=this._valuesEnd[n];this._valuesEnd=s}this._setupProperties(this._object,this._valuesStart,this._valuesEnd,this._valuesStartRepeat,i)}return this},e.prototype.startFromCurrentValues=function(t){return this.start(t,!0)},e.prototype._setupProperties=function(t,i,o,s,n){for(var r in o){var a=t[r],p=Array.isArray(a),y=p?"array":typeof a,b=!p&&Array.isArray(o[r]);if(!(y==="undefined"||y==="function")){if(b){var w=o[r];if(w.length===0)continue;for(var I=[a],T=0,x=w.length;T<x;T+=1){var P=this._handleRelativeValue(a,w[T]);if(isNaN(P)){b=!1,console.warn("Found invalid interpolation list. Skipping.");break}I.push(P)}b&&(o[r]=I)}if((y==="object"||p)&&a&&!b){i[r]=p?[]:{};var f=a;for(var m in f)i[r][m]=f[m];s[r]=p?[]:{};var w=o[r];if(!this._isDynamic){var k={};for(var m in w)k[m]=w[m];o[r]=w=k}this._setupProperties(f,i[r],w,s[r],n)}else(typeof i[r]>"u"||n)&&(i[r]=a),p||(i[r]*=1),b?s[r]=o[r].slice().reverse():s[r]=i[r]||0}}},e.prototype.stop=function(){return this._isChainStopped||(this._isChainStopped=!0,this.stopChainedTweens()),this._isPlaying?(this._isPlaying=!1,this._isPaused=!1,this._onStopCallback&&this._onStopCallback(this._object),this):this},e.prototype.end=function(){return this._goToEnd=!0,this.update(this._startTime+this._duration),this},e.prototype.pause=function(t){return t===void 0&&(t=G()),this._isPaused||!this._isPlaying?this:(this._isPaused=!0,this._pauseStart=t,this)},e.prototype.resume=function(t){return t===void 0&&(t=G()),!this._isPaused||!this._isPlaying?this:(this._isPaused=!1,this._startTime+=t-this._pauseStart,this._pauseStart=0,this)},e.prototype.stopChainedTweens=function(){for(var t=0,i=this._chainedTweens.length;t<i;t++)this._chainedTweens[t].stop();return this},e.prototype.group=function(t){return t?(t.add(this),this):(console.warn("tween.group() without args has been removed, use group.add(tween) instead."),this)},e.prototype.remove=function(){var t;return(t=this._group)===null||t===void 0||t.remove(this),this},e.prototype.delay=function(t){return t===void 0&&(t=0),this._delayTime=t,this},e.prototype.repeat=function(t){return t===void 0&&(t=0),this._initialRepeat=t,this._repeat=t,this},e.prototype.repeatDelay=function(t){return this._repeatDelayTime=t,this},e.prototype.yoyo=function(t){return t===void 0&&(t=!1),this._yoyo=t,this},e.prototype.easing=function(t){return t===void 0&&(t=K.Linear.None),this._easingFunction=t,this},e.prototype.interpolation=function(t){return t===void 0&&(t=V.Linear),this._interpolationFunction=t,this},e.prototype.chain=function(){for(var t=[],i=0;i<arguments.length;i++)t[i]=arguments[i];return this._chainedTweens=t,this},e.prototype.onStart=function(t){return this._onStartCallback=t,this},e.prototype.onEveryStart=function(t){return this._onEveryStartCallback=t,this},e.prototype.onUpdate=function(t){return this._onUpdateCallback=t,this},e.prototype.onRepeat=function(t){return this._onRepeatCallback=t,this},e.prototype.onComplete=function(t){return this._onCompleteCallback=t,this},e.prototype.onStop=function(t){return this._onStopCallback=t,this},e.prototype.update=function(t,i){var o=this,s;if(t===void 0&&(t=G()),i===void 0&&(i=e.autoStartOnUpdate),this._isPaused)return!0;var n;if(!this._goToEnd&&!this._isPlaying)if(i)this.start(t,!0);else return!1;if(this._goToEnd=!1,t<this._startTime)return!0;this._onStartCallbackFired===!1&&(this._onStartCallback&&this._onStartCallback(this._object),this._onStartCallbackFired=!0),this._onEveryStartCallbackFired===!1&&(this._onEveryStartCallback&&this._onEveryStartCallback(this._object),this._onEveryStartCallbackFired=!0);var r=t-this._startTime,a=this._duration+((s=this._repeatDelayTime)!==null&&s!==void 0?s:this._delayTime),p=this._duration+this._repeat*a,y=function(){if(o._duration===0||r>p)return 1;var P=Math.trunc(r/a),f=r-P*a,m=Math.min(f/o._duration,1);return m===0&&r===o._duration?1:m},b=y(),w=this._easingFunction(b);if(this._updateProperties(this._object,this._valuesStart,this._valuesEnd,w),this._onUpdateCallback&&this._onUpdateCallback(this._object,b),this._duration===0||r>=this._duration)if(this._repeat>0){var I=Math.min(Math.trunc((r-this._duration)/a)+1,this._repeat);isFinite(this._repeat)&&(this._repeat-=I);for(n in this._valuesStartRepeat)!this._yoyo&&typeof this._valuesEnd[n]=="string"&&(this._valuesStartRepeat[n]=this._valuesStartRepeat[n]+parseFloat(this._valuesEnd[n])),this._yoyo&&this._swapEndStartRepeatValues(n),this._valuesStart[n]=this._valuesStartRepeat[n];return this._yoyo&&(this._reversed=!this._reversed),this._startTime+=a*I,this._onRepeatCallback&&this._onRepeatCallback(this._object),this._onEveryStartCallbackFired=!1,!0}else{this._onCompleteCallback&&this._onCompleteCallback(this._object);for(var T=0,x=this._chainedTweens.length;T<x;T++)this._chainedTweens[T].start(this._startTime+this._duration,!1);return this._isPlaying=!1,!1}return!0},e.prototype._updateProperties=function(t,i,o,s){for(var n in o)if(i[n]!==void 0){var r=i[n]||0,a=o[n],p=Array.isArray(t[n]),y=Array.isArray(a),b=!p&&y;b?t[n]=this._interpolationFunction(a,s):typeof a=="object"&&a?this._updateProperties(t[n],r,a,s):(a=this._handleRelativeValue(r,a),typeof a=="number"&&(t[n]=r+(a-r)*s))}},e.prototype._handleRelativeValue=function(t,i){return typeof i!="string"?i:i.charAt(0)==="+"||i.charAt(0)==="-"?t+parseFloat(i):parseFloat(i)},e.prototype._swapEndStartRepeatValues=function(t){var i=this._valuesStartRepeat[t],o=this._valuesEnd[t];typeof o=="string"?this._valuesStartRepeat[t]=this._valuesStartRepeat[t]+parseFloat(o):this._valuesStartRepeat[t]=this._valuesEnd[t],this._valuesEnd[t]=i},e.autoStartOnUpdate=!1,e}(),Me=xt.nextId,R=dt,Ee=R.getAll.bind(R),xe=R.removeAll.bind(R),Te=R.add.bind(R),Oe=R.remove.bind(R),De=R.update.bind(R);const F=new Ut,v=new l,z=new l,d=new D,Tt={X:new l(1,0,0),Y:new l(0,1,0),Z:new l(0,0,1)},_t={type:"change"},Ot={type:"mouseDown",mode:null},Dt={type:"mouseUp",mode:null},It={type:"objectChange"};class te extends ft{constructor(t,i=null){super(void 0,i);const o=new ae(this);this._root=o;const s=new re;this._gizmo=s,o.add(s);const n=new he;this._plane=n,o.add(n);const r=this;function a(Y,X){let U=X;Object.defineProperty(r,Y,{get:function(){return U!==void 0?U:X},set:function(N){U!==N&&(U=N,n[Y]=N,s[Y]=N,r.dispatchEvent({type:Y+"-changed",value:N}),r.dispatchEvent(_t))}}),r[Y]=X,n[Y]=X,s[Y]=X}a("camera",t),a("object",void 0),a("enabled",!0),a("axis",null),a("mode","translate"),a("translationSnap",null),a("rotationSnap",null),a("scaleSnap",null),a("space","world"),a("size",1),a("dragging",!1),a("showX",!0),a("showY",!0),a("showZ",!0),a("minX",-1/0),a("maxX",1/0),a("minY",-1/0),a("maxY",1/0),a("minZ",-1/0),a("maxZ",1/0);const p=new l,y=new l,b=new D,w=new D,I=new l,T=new D,x=new l,P=new l,f=new l,m=0,k=new l;a("worldPosition",p),a("worldPositionStart",y),a("worldQuaternion",b),a("worldQuaternionStart",w),a("cameraPosition",I),a("cameraQuaternion",T),a("pointStart",x),a("pointEnd",P),a("rotationAxis",f),a("rotationAngle",m),a("eye",k),this._offset=new l,this._startNorm=new l,this._endNorm=new l,this._cameraScale=new l,this._parentPosition=new l,this._parentQuaternion=new D,this._parentQuaternionInv=new D,this._parentScale=new l,this._worldScaleStart=new l,this._worldQuaternionInv=new D,this._worldScale=new l,this._positionStart=new l,this._quaternionStart=new D,this._scaleStart=new l,this._getPointer=ee.bind(this),this._onPointerDown=ne.bind(this),this._onPointerHover=ie.bind(this),this._onPointerMove=se.bind(this),this._onPointerUp=oe.bind(this),i!==null&&this.connect()}connect(){this.domElement.addEventListener("pointerdown",this._onPointerDown),this.domElement.addEventListener("pointermove",this._onPointerHover),this.domElement.addEventListener("pointerup",this._onPointerUp),this.domElement.style.touchAction="none"}disconnect(){this.domElement.removeEventListener("pointerdown",this._onPointerDown),this.domElement.removeEventListener("pointermove",this._onPointerHover),this.domElement.removeEventListener("pointermove",this._onPointerMove),this.domElement.removeEventListener("pointerup",this._onPointerUp),this.domElement.style.touchAction="auto"}getHelper(){return this._root}pointerHover(t){if(this.object===void 0||this.dragging===!0)return;t!==null&&F.setFromCamera(t,this.camera);const i=mt(this._gizmo.picker[this.mode],F);i?this.axis=i.object.name:this.axis=null}pointerDown(t){if(!(this.object===void 0||this.dragging===!0||t!=null&&t.button!==0)&&this.axis!==null){t!==null&&F.setFromCamera(t,this.camera);const i=mt(this._plane,F,!0);i&&(this.object.updateMatrixWorld(),this.object.parent.updateMatrixWorld(),this._positionStart.copy(this.object.position),this._quaternionStart.copy(this.object.quaternion),this._scaleStart.copy(this.object.scale),this.object.matrixWorld.decompose(this.worldPositionStart,this.worldQuaternionStart,this._worldScaleStart),this.pointStart.copy(i.point).sub(this.worldPositionStart)),this.dragging=!0,Ot.mode=this.mode,this.dispatchEvent(Ot)}}pointerMove(t){const i=this.axis,o=this.mode,s=this.object;let n=this.space;if(o==="scale"?n="local":(i==="E"||i==="XYZE"||i==="XYZ")&&(n="world"),s===void 0||i===null||this.dragging===!1||t!==null&&t.button!==-1)return;t!==null&&F.setFromCamera(t,this.camera);const r=mt(this._plane,F,!0);if(r){if(this.pointEnd.copy(r.point).sub(this.worldPositionStart),o==="translate")this._offset.copy(this.pointEnd).sub(this.pointStart),n==="local"&&i!=="XYZ"&&this._offset.applyQuaternion(this._worldQuaternionInv),i.indexOf("X")===-1&&(this._offset.x=0),i.indexOf("Y")===-1&&(this._offset.y=0),i.indexOf("Z")===-1&&(this._offset.z=0),n==="local"&&i!=="XYZ"?this._offset.applyQuaternion(this._quaternionStart).divide(this._parentScale):this._offset.applyQuaternion(this._parentQuaternionInv).divide(this._parentScale),s.position.copy(this._offset).add(this._positionStart),this.translationSnap&&(n==="local"&&(s.position.applyQuaternion(d.copy(this._quaternionStart).invert()),i.search("X")!==-1&&(s.position.x=Math.round(s.position.x/this.translationSnap)*this.translationSnap),i.search("Y")!==-1&&(s.position.y=Math.round(s.position.y/this.translationSnap)*this.translationSnap),i.search("Z")!==-1&&(s.position.z=Math.round(s.position.z/this.translationSnap)*this.translationSnap),s.position.applyQuaternion(this._quaternionStart)),n==="world"&&(s.parent&&s.position.add(v.setFromMatrixPosition(s.parent.matrixWorld)),i.search("X")!==-1&&(s.position.x=Math.round(s.position.x/this.translationSnap)*this.translationSnap),i.search("Y")!==-1&&(s.position.y=Math.round(s.position.y/this.translationSnap)*this.translationSnap),i.search("Z")!==-1&&(s.position.z=Math.round(s.position.z/this.translationSnap)*this.translationSnap),s.parent&&s.position.sub(v.setFromMatrixPosition(s.parent.matrixWorld)))),s.position.x=Math.max(this.minX,Math.min(this.maxX,s.position.x)),s.position.y=Math.max(this.minY,Math.min(this.maxY,s.position.y)),s.position.z=Math.max(this.minZ,Math.min(this.maxZ,s.position.z));else if(o==="scale"){if(i.search("XYZ")!==-1){let a=this.pointEnd.length()/this.pointStart.length();this.pointEnd.dot(this.pointStart)<0&&(a*=-1),z.set(a,a,a)}else v.copy(this.pointStart),z.copy(this.pointEnd),v.applyQuaternion(this._worldQuaternionInv),z.applyQuaternion(this._worldQuaternionInv),z.divide(v),i.search("X")===-1&&(z.x=1),i.search("Y")===-1&&(z.y=1),i.search("Z")===-1&&(z.z=1);s.scale.copy(this._scaleStart).multiply(z),this.scaleSnap&&(i.search("X")!==-1&&(s.scale.x=Math.round(s.scale.x/this.scaleSnap)*this.scaleSnap||this.scaleSnap),i.search("Y")!==-1&&(s.scale.y=Math.round(s.scale.y/this.scaleSnap)*this.scaleSnap||this.scaleSnap),i.search("Z")!==-1&&(s.scale.z=Math.round(s.scale.z/this.scaleSnap)*this.scaleSnap||this.scaleSnap))}else if(o==="rotate"){this._offset.copy(this.pointEnd).sub(this.pointStart);const a=20/this.worldPosition.distanceTo(v.setFromMatrixPosition(this.camera.matrixWorld));let p=!1;i==="XYZE"?(this.rotationAxis.copy(this._offset).cross(this.eye).normalize(),this.rotationAngle=this._offset.dot(v.copy(this.rotationAxis).cross(this.eye))*a):(i==="X"||i==="Y"||i==="Z")&&(this.rotationAxis.copy(Tt[i]),v.copy(Tt[i]),n==="local"&&v.applyQuaternion(this.worldQuaternion),v.cross(this.eye),v.length()===0?p=!0:this.rotationAngle=this._offset.dot(v.normalize())*a),(i==="E"||p)&&(this.rotationAxis.copy(this.eye),this.rotationAngle=this.pointEnd.angleTo(this.pointStart),this._startNorm.copy(this.pointStart).normalize(),this._endNorm.copy(this.pointEnd).normalize(),this.rotationAngle*=this._endNorm.cross(this._startNorm).dot(this.eye)<0?1:-1),this.rotationSnap&&(this.rotationAngle=Math.round(this.rotationAngle/this.rotationSnap)*this.rotationSnap),n==="local"&&i!=="E"&&i!=="XYZE"?(s.quaternion.copy(this._quaternionStart),s.quaternion.multiply(d.setFromAxisAngle(this.rotationAxis,this.rotationAngle)).normalize()):(this.rotationAxis.applyQuaternion(this._parentQuaternionInv),s.quaternion.copy(d.setFromAxisAngle(this.rotationAxis,this.rotationAngle)),s.quaternion.multiply(this._quaternionStart).normalize())}this.dispatchEvent(_t),this.dispatchEvent(It)}}pointerUp(t){t!==null&&t.button!==0||(this.dragging&&this.axis!==null&&(Dt.mode=this.mode,this.dispatchEvent(Dt)),this.dragging=!1,this.axis=null)}dispose(){this.disconnect(),this._root.dispose()}attach(t){return this.object=t,this._root.visible=!0,this}detach(){return this.object=void 0,this.axis=null,this._root.visible=!1,this}reset(){this.enabled&&this.dragging&&(this.object.position.copy(this._positionStart),this.object.quaternion.copy(this._quaternionStart),this.object.scale.copy(this._scaleStart),this.dispatchEvent(_t),this.dispatchEvent(It),this.pointStart.copy(this.pointEnd))}getRaycaster(){return F}getMode(){return this.mode}setMode(t){this.mode=t}setTranslationSnap(t){this.translationSnap=t}setRotationSnap(t){this.rotationSnap=t}setScaleSnap(t){this.scaleSnap=t}setSize(t){this.size=t}setSpace(t){this.space=t}}function ee(e){if(this.domElement.ownerDocument.pointerLockElement)return{x:0,y:0,button:e.button};{const t=this.domElement.getBoundingClientRect();return{x:(e.clientX-t.left)/t.width*2-1,y:-(e.clientY-t.top)/t.height*2+1,button:e.button}}}function ie(e){if(this.enabled)switch(e.pointerType){case"mouse":case"pen":this.pointerHover(this._getPointer(e));break}}function ne(e){this.enabled&&(document.pointerLockElement||this.domElement.setPointerCapture(e.pointerId),this.domElement.addEventListener("pointermove",this._onPointerMove),this.pointerHover(this._getPointer(e)),this.pointerDown(this._getPointer(e)))}function se(e){this.enabled&&this.pointerMove(this._getPointer(e))}function oe(e){this.enabled&&(this.domElement.releasePointerCapture(e.pointerId),this.domElement.removeEventListener("pointermove",this._onPointerMove),this.pointerUp(this._getPointer(e)))}function mt(e,t,i){const o=t.intersectObject(e,!0);for(let s=0;s<o.length;s++)if(o[s].object.visible||i)return o[s];return!1}const rt=new qt,u=new l(0,1,0),At=new l(0,0,0),jt=new vt,ht=new D,lt=new D,C=new l,kt=new vt,$=new l(1,0,0),Q=new l(0,1,0),J=new l(0,0,1),ct=new l,tt=new l,et=new l;class ae extends ut{constructor(t){super(),this.isTransformControlsRoot=!0,this.controls=t,this.visible=!1}updateMatrixWorld(t){const i=this.controls;i.object!==void 0&&(i.object.updateMatrixWorld(),i.object.parent===null?console.error("TransformControls: The attached 3D object must be a part of the scene graph."):i.object.parent.matrixWorld.decompose(i._parentPosition,i._parentQuaternion,i._parentScale),i.object.matrixWorld.decompose(i.worldPosition,i.worldQuaternion,i._worldScale),i._parentQuaternionInv.copy(i._parentQuaternion).invert(),i._worldQuaternionInv.copy(i.worldQuaternion).invert()),i.camera.updateMatrixWorld(),i.camera.matrixWorld.decompose(i.cameraPosition,i.cameraQuaternion,i._cameraScale),i.camera.isOrthographicCamera?i.camera.getWorldDirection(i.eye).negate():i.eye.copy(i.cameraPosition).sub(i.worldPosition).normalize(),super.updateMatrixWorld(t)}dispose(){this.traverse(function(t){t.geometry&&t.geometry.dispose(),t.material&&t.material.dispose()})}}class re extends ut{constructor(){super(),this.isTransformControlsGizmo=!0,this.type="TransformControlsGizmo";const t=new gt({depthTest:!1,depthWrite:!1,fog:!1,toneMapped:!1,transparent:!0}),i=new Ht({depthTest:!1,depthWrite:!1,fog:!1,toneMapped:!1,transparent:!0}),o=t.clone();o.opacity=.15;const s=i.clone();s.opacity=.5;const n=t.clone();n.color.setHex(16711680);const r=t.clone();r.color.setHex(65280);const a=t.clone();a.color.setHex(255);const p=t.clone();p.color.setHex(16711680),p.opacity=.5;const y=t.clone();y.color.setHex(65280),y.opacity=.5;const b=t.clone();b.color.setHex(255),b.opacity=.5;const w=t.clone();w.opacity=.25;const I=t.clone();I.color.setHex(16776960),I.opacity=.25,t.clone().color.setHex(16776960);const T=t.clone();T.color.setHex(7895160);const x=new M(0,.04,.1,12);x.translate(0,.05,0);const P=new g(.08,.08,.08);P.translate(0,.04,0);const f=new Pt;f.setAttribute("position",new St([0,0,0,1,0,0],3));const m=new M(.0075,.0075,.5,3);m.translate(0,.25,0);function k(O,it){const A=new B(O,.0075,3,64,it*Math.PI*2);return A.rotateY(Math.PI/2),A.rotateX(Math.PI/2),A}function Y(){const O=new Pt;return O.setAttribute("position",new St([0,0,0,1,1,1],3)),O}const X={X:[[new h(x,n),[.5,0,0],[0,0,-Math.PI/2]],[new h(x,n),[-.5,0,0],[0,0,Math.PI/2]],[new h(m,n),[0,0,0],[0,0,-Math.PI/2]]],Y:[[new h(x,r),[0,.5,0]],[new h(x,r),[0,-.5,0],[Math.PI,0,0]],[new h(m,r)]],Z:[[new h(x,a),[0,0,.5],[Math.PI/2,0,0]],[new h(x,a),[0,0,-.5],[-Math.PI/2,0,0]],[new h(m,a),null,[Math.PI/2,0,0]]],XYZ:[[new h(new at(.1,0),w.clone()),[0,0,0]]],XY:[[new h(new g(.15,.15,.01),b.clone()),[.15,.15,0]]],YZ:[[new h(new g(.15,.15,.01),p.clone()),[0,.15,.15],[0,Math.PI/2,0]]],XZ:[[new h(new g(.15,.15,.01),y.clone()),[.15,0,.15],[-Math.PI/2,0,0]]]},U={X:[[new h(new M(.2,0,.6,4),o),[.3,0,0],[0,0,-Math.PI/2]],[new h(new M(.2,0,.6,4),o),[-.3,0,0],[0,0,Math.PI/2]]],Y:[[new h(new M(.2,0,.6,4),o),[0,.3,0]],[new h(new M(.2,0,.6,4),o),[0,-.3,0],[0,0,Math.PI]]],Z:[[new h(new M(.2,0,.6,4),o),[0,0,.3],[Math.PI/2,0,0]],[new h(new M(.2,0,.6,4),o),[0,0,-.3],[-Math.PI/2,0,0]]],XYZ:[[new h(new at(.2,0),o)]],XY:[[new h(new g(.2,.2,.01),o),[.15,.15,0]]],YZ:[[new h(new g(.2,.2,.01),o),[0,.15,.15],[0,Math.PI/2,0]]],XZ:[[new h(new g(.2,.2,.01),o),[.15,0,.15],[-Math.PI/2,0,0]]]},N={START:[[new h(new at(.01,2),s),null,null,null,"helper"]],END:[[new h(new at(.01,2),s),null,null,null,"helper"]],DELTA:[[new Z(Y(),s),null,null,null,"helper"]],X:[[new Z(f,s.clone()),[-1e3,0,0],null,[1e6,1,1],"helper"]],Y:[[new Z(f,s.clone()),[0,-1e3,0],[0,0,Math.PI/2],[1e6,1,1],"helper"]],Z:[[new Z(f,s.clone()),[0,0,-1e3],[0,-Math.PI/2,0],[1e6,1,1],"helper"]]},Lt={XYZE:[[new h(k(.5,1),T),null,[0,Math.PI/2,0]]],X:[[new h(k(.5,.5),n)]],Y:[[new h(k(.5,.5),r),null,[0,0,-Math.PI/2]]],Z:[[new h(k(.5,.5),a),null,[0,Math.PI/2,0]]],E:[[new h(k(.75,1),I),null,[0,Math.PI/2,0]]]},Zt={AXIS:[[new Z(f,s.clone()),[-1e3,0,0],null,[1e6,1,1],"helper"]]},zt={XYZE:[[new h(new Wt(.25,10,8),o)]],X:[[new h(new B(.5,.1,4,24),o),[0,0,0],[0,-Math.PI/2,-Math.PI/2]]],Y:[[new h(new B(.5,.1,4,24),o),[0,0,0],[Math.PI/2,0,0]]],Z:[[new h(new B(.5,.1,4,24),o),[0,0,0],[0,0,-Math.PI/2]]],E:[[new h(new B(.75,.1,2,24),o)]]},Xt={X:[[new h(P,n),[.5,0,0],[0,0,-Math.PI/2]],[new h(m,n),[0,0,0],[0,0,-Math.PI/2]],[new h(P,n),[-.5,0,0],[0,0,Math.PI/2]]],Y:[[new h(P,r),[0,.5,0]],[new h(m,r)],[new h(P,r),[0,-.5,0],[0,0,Math.PI]]],Z:[[new h(P,a),[0,0,.5],[Math.PI/2,0,0]],[new h(m,a),[0,0,0],[Math.PI/2,0,0]],[new h(P,a),[0,0,-.5],[-Math.PI/2,0,0]]],XY:[[new h(new g(.15,.15,.01),b),[.15,.15,0]]],YZ:[[new h(new g(.15,.15,.01),p),[0,.15,.15],[0,Math.PI/2,0]]],XZ:[[new h(new g(.15,.15,.01),y),[.15,0,.15],[-Math.PI/2,0,0]]],XYZ:[[new h(new g(.1,.1,.1),w.clone())]]},Nt={X:[[new h(new M(.2,0,.6,4),o),[.3,0,0],[0,0,-Math.PI/2]],[new h(new M(.2,0,.6,4),o),[-.3,0,0],[0,0,Math.PI/2]]],Y:[[new h(new M(.2,0,.6,4),o),[0,.3,0]],[new h(new M(.2,0,.6,4),o),[0,-.3,0],[0,0,Math.PI]]],Z:[[new h(new M(.2,0,.6,4),o),[0,0,.3],[Math.PI/2,0,0]],[new h(new M(.2,0,.6,4),o),[0,0,-.3],[-Math.PI/2,0,0]]],XY:[[new h(new g(.2,.2,.01),o),[.15,.15,0]]],YZ:[[new h(new g(.2,.2,.01),o),[0,.15,.15],[0,Math.PI/2,0]]],XZ:[[new h(new g(.2,.2,.01),o),[.15,0,.15],[-Math.PI/2,0,0]]],XYZ:[[new h(new g(.2,.2,.2),o),[0,0,0]]]},Ft={X:[[new Z(f,s.clone()),[-1e3,0,0],null,[1e6,1,1],"helper"]],Y:[[new Z(f,s.clone()),[0,-1e3,0],[0,0,Math.PI/2],[1e6,1,1],"helper"]],Z:[[new Z(f,s.clone()),[0,0,-1e3],[0,-Math.PI/2,0],[1e6,1,1],"helper"]]};function L(O){const it=new ut;for(const A in O)for(let q=O[A].length;q--;){const S=O[A][q][0].clone(),nt=O[A][q][1],st=O[A][q][2],ot=O[A][q][3],Qt=O[A][q][4];S.name=A,S.tag=Qt,nt&&S.position.set(nt[0],nt[1],nt[2]),st&&S.rotation.set(st[0],st[1],st[2]),ot&&S.scale.set(ot[0],ot[1],ot[2]),S.updateMatrix();const wt=S.geometry.clone();wt.applyMatrix4(S.matrix),S.geometry=wt,S.renderOrder=1/0,S.position.set(0,0,0),S.rotation.set(0,0,0),S.scale.set(1,1,1),it.add(S)}return it}this.gizmo={},this.picker={},this.helper={},this.add(this.gizmo.translate=L(X)),this.add(this.gizmo.rotate=L(Lt)),this.add(this.gizmo.scale=L(Xt)),this.add(this.picker.translate=L(U)),this.add(this.picker.rotate=L(zt)),this.add(this.picker.scale=L(Nt)),this.add(this.helper.translate=L(N)),this.add(this.helper.rotate=L(Zt)),this.add(this.helper.scale=L(Ft)),this.picker.translate.visible=!1,this.picker.rotate.visible=!1,this.picker.scale.visible=!1}updateMatrixWorld(t){const i=(this.mode==="scale"?"local":this.space)==="local"?this.worldQuaternion:lt;this.gizmo.translate.visible=this.mode==="translate",this.gizmo.rotate.visible=this.mode==="rotate",this.gizmo.scale.visible=this.mode==="scale",this.helper.translate.visible=this.mode==="translate",this.helper.rotate.visible=this.mode==="rotate",this.helper.scale.visible=this.mode==="scale";let o=[];o=o.concat(this.picker[this.mode].children),o=o.concat(this.gizmo[this.mode].children),o=o.concat(this.helper[this.mode].children);for(let s=0;s<o.length;s++){const n=o[s];n.visible=!0,n.rotation.set(0,0,0),n.position.copy(this.worldPosition);let r;if(this.camera.isOrthographicCamera?r=(this.camera.top-this.camera.bottom)/this.camera.zoom:r=this.worldPosition.distanceTo(this.cameraPosition)*Math.min(1.9*Math.tan(Math.PI*this.camera.fov/360)/this.camera.zoom,7),n.scale.set(1,1,1).multiplyScalar(r*this.size/4),n.tag==="helper"){n.visible=!1,n.name==="AXIS"?(n.visible=!!this.axis,this.axis==="X"&&(d.setFromEuler(rt.set(0,0,0)),n.quaternion.copy(i).multiply(d),Math.abs(u.copy($).applyQuaternion(i).dot(this.eye))>.9&&(n.visible=!1)),this.axis==="Y"&&(d.setFromEuler(rt.set(0,0,Math.PI/2)),n.quaternion.copy(i).multiply(d),Math.abs(u.copy(Q).applyQuaternion(i).dot(this.eye))>.9&&(n.visible=!1)),this.axis==="Z"&&(d.setFromEuler(rt.set(0,Math.PI/2,0)),n.quaternion.copy(i).multiply(d),Math.abs(u.copy(J).applyQuaternion(i).dot(this.eye))>.9&&(n.visible=!1)),this.axis==="XYZE"&&(d.setFromEuler(rt.set(0,Math.PI/2,0)),u.copy(this.rotationAxis),n.quaternion.setFromRotationMatrix(jt.lookAt(At,u,Q)),n.quaternion.multiply(d),n.visible=this.dragging),this.axis==="E"&&(n.visible=!1)):n.name==="START"?(n.position.copy(this.worldPositionStart),n.visible=this.dragging):n.name==="END"?(n.position.copy(this.worldPosition),n.visible=this.dragging):n.name==="DELTA"?(n.position.copy(this.worldPositionStart),n.quaternion.copy(this.worldQuaternionStart),v.set(1e-10,1e-10,1e-10).add(this.worldPositionStart).sub(this.worldPosition).multiplyScalar(-1),v.applyQuaternion(this.worldQuaternionStart.clone().invert()),n.scale.copy(v),n.visible=this.dragging):(n.quaternion.copy(i),this.dragging?n.position.copy(this.worldPositionStart):n.position.copy(this.worldPosition),this.axis&&(n.visible=this.axis.search(n.name)!==-1));continue}n.quaternion.copy(i),this.mode==="translate"||this.mode==="scale"?(n.name==="X"&&Math.abs(u.copy($).applyQuaternion(i).dot(this.eye))>.99&&(n.scale.set(1e-10,1e-10,1e-10),n.visible=!1),n.name==="Y"&&Math.abs(u.copy(Q).applyQuaternion(i).dot(this.eye))>.99&&(n.scale.set(1e-10,1e-10,1e-10),n.visible=!1),n.name==="Z"&&Math.abs(u.copy(J).applyQuaternion(i).dot(this.eye))>.99&&(n.scale.set(1e-10,1e-10,1e-10),n.visible=!1),n.name==="XY"&&Math.abs(u.copy(J).applyQuaternion(i).dot(this.eye))<.2&&(n.scale.set(1e-10,1e-10,1e-10),n.visible=!1),n.name==="YZ"&&Math.abs(u.copy($).applyQuaternion(i).dot(this.eye))<.2&&(n.scale.set(1e-10,1e-10,1e-10),n.visible=!1),n.name==="XZ"&&Math.abs(u.copy(Q).applyQuaternion(i).dot(this.eye))<.2&&(n.scale.set(1e-10,1e-10,1e-10),n.visible=!1)):this.mode==="rotate"&&(ht.copy(i),u.copy(this.eye).applyQuaternion(d.copy(i).invert()),n.name.search("E")!==-1&&n.quaternion.setFromRotationMatrix(jt.lookAt(this.eye,At,Q)),n.name==="X"&&(d.setFromAxisAngle($,Math.atan2(-u.y,u.z)),d.multiplyQuaternions(ht,d),n.quaternion.copy(d)),n.name==="Y"&&(d.setFromAxisAngle(Q,Math.atan2(u.x,u.z)),d.multiplyQuaternions(ht,d),n.quaternion.copy(d)),n.name==="Z"&&(d.setFromAxisAngle(J,Math.atan2(u.y,u.x)),d.multiplyQuaternions(ht,d),n.quaternion.copy(d))),n.visible=n.visible&&(n.name.indexOf("X")===-1||this.showX),n.visible=n.visible&&(n.name.indexOf("Y")===-1||this.showY),n.visible=n.visible&&(n.name.indexOf("Z")===-1||this.showZ),n.visible=n.visible&&(n.name.indexOf("E")===-1||this.showX&&this.showY&&this.showZ),n.material._color=n.material._color||n.material.color.clone(),n.material._opacity=n.material._opacity||n.material.opacity,n.material.color.copy(n.material._color),n.material.opacity=n.material._opacity,this.enabled&&this.axis&&(n.name===this.axis||this.axis.split("").some(function(a){return n.name===a}))&&(n.material.color.setHex(16776960),n.material.opacity=1)}super.updateMatrixWorld(t)}}class he extends h{constructor(){super(new Kt(1e5,1e5,2,2),new gt({visible:!1,wireframe:!0,side:Vt,transparent:!0,opacity:.1,toneMapped:!1})),this.isTransformControlsPlane=!0,this.type="TransformControlsPlane"}updateMatrixWorld(t){let i=this.space;switch(this.position.copy(this.worldPosition),this.mode==="scale"&&(i="local"),ct.copy($).applyQuaternion(i==="local"?this.worldQuaternion:lt),tt.copy(Q).applyQuaternion(i==="local"?this.worldQuaternion:lt),et.copy(J).applyQuaternion(i==="local"?this.worldQuaternion:lt),u.copy(tt),this.mode){case"translate":case"scale":switch(this.axis){case"X":u.copy(this.eye).cross(ct),C.copy(ct).cross(u);break;case"Y":u.copy(this.eye).cross(tt),C.copy(tt).cross(u);break;case"Z":u.copy(this.eye).cross(et),C.copy(et).cross(u);break;case"XY":C.copy(et);break;case"YZ":C.copy(ct);break;case"XZ":u.copy(et),C.copy(tt);break;case"XYZ":case"E":C.set(0,0,0);break}break;case"rotate":default:C.set(0,0,0)}C.length()===0?this.quaternion.copy(this.cameraQuaternion):(kt.lookAt(v.set(0,0,0),C,u),this.quaternion.setFromRotationMatrix(kt)),super.updateMatrixWorld(t)}}const Rt={type:"change"},yt={type:"start"},Ct={type:"end"},pt=new Bt,Yt=new Gt,le=Math.cos(70*$t.DEG2RAD),_=new l,E=2*Math.PI,c={NONE:-1,ROTATE:0,DOLLY:1,PAN:2,TOUCH_ROTATE:3,TOUCH_PAN:4,TOUCH_DOLLY_PAN:5,TOUCH_DOLLY_ROTATE:6},bt=1e-6;class ce extends ft{constructor(t,i=null){super(t,i),this.state=c.NONE,this.enabled=!0,this.target=new l,this.cursor=new l,this.minDistance=0,this.maxDistance=1/0,this.minZoom=0,this.maxZoom=1/0,this.minTargetRadius=0,this.maxTargetRadius=1/0,this.minPolarAngle=0,this.maxPolarAngle=Math.PI,this.minAzimuthAngle=-1/0,this.maxAzimuthAngle=1/0,this.enableDamping=!1,this.dampingFactor=.05,this.enableZoom=!0,this.zoomSpeed=1,this.enableRotate=!0,this.rotateSpeed=1,this.keyRotateSpeed=1,this.enablePan=!0,this.panSpeed=1,this.screenSpacePanning=!0,this.keyPanSpeed=7,this.zoomToCursor=!1,this.autoRotate=!1,this.autoRotateSpeed=2,this.keys={LEFT:"ArrowLeft",UP:"ArrowUp",RIGHT:"ArrowRight",BOTTOM:"ArrowDown"},this.mouseButtons={LEFT:H.ROTATE,MIDDLE:H.DOLLY,RIGHT:H.PAN},this.touches={ONE:W.ROTATE,TWO:W.DOLLY_PAN},this.target0=this.target.clone(),this.position0=this.object.position.clone(),this.zoom0=this.object.zoom,this._domElementKeyEvents=null,this._lastPosition=new l,this._lastQuaternion=new D,this._lastTargetPosition=new l,this._quat=new D().setFromUnitVectors(t.up,new l(0,1,0)),this._quatInverse=this._quat.clone().invert(),this._spherical=new Mt,this._sphericalDelta=new Mt,this._scale=1,this._panOffset=new l,this._rotateStart=new j,this._rotateEnd=new j,this._rotateDelta=new j,this._panStart=new j,this._panEnd=new j,this._panDelta=new j,this._dollyStart=new j,this._dollyEnd=new j,this._dollyDelta=new j,this._dollyDirection=new l,this._mouse=new j,this._performCursorZoom=!1,this._pointers=[],this._pointerPositions={},this._controlActive=!1,this._onPointerMove=ue.bind(this),this._onPointerDown=pe.bind(this),this._onPointerUp=de.bind(this),this._onContextMenu=ve.bind(this),this._onMouseWheel=ye.bind(this),this._onKeyDown=be.bind(this),this._onTouchStart=we.bind(this),this._onTouchMove=fe.bind(this),this._onMouseDown=_e.bind(this),this._onMouseMove=me.bind(this),this._interceptControlDown=ge.bind(this),this._interceptControlUp=Pe.bind(this),this.domElement!==null&&this.connect(),this.update()}connect(){this.domElement.addEventListener("pointerdown",this._onPointerDown),this.domElement.addEventListener("pointercancel",this._onPointerUp),this.domElement.addEventListener("contextmenu",this._onContextMenu),this.domElement.addEventListener("wheel",this._onMouseWheel,{passive:!1}),this.domElement.getRootNode().addEventListener("keydown",this._interceptControlDown,{passive:!0,capture:!0}),this.domElement.style.touchAction="none"}disconnect(){this.domElement.removeEventListener("pointerdown",this._onPointerDown),this.domElement.removeEventListener("pointermove",this._onPointerMove),this.domElement.removeEventListener("pointerup",this._onPointerUp),this.domElement.removeEventListener("pointercancel",this._onPointerUp),this.domElement.removeEventListener("wheel",this._onMouseWheel),this.domElement.removeEventListener("contextmenu",this._onContextMenu),this.stopListenToKeyEvents(),this.domElement.getRootNode().removeEventListener("keydown",this._interceptControlDown,{capture:!0}),this.domElement.style.touchAction="auto"}dispose(){this.disconnect()}getPolarAngle(){return this._spherical.phi}getAzimuthalAngle(){return this._spherical.theta}getDistance(){return this.object.position.distanceTo(this.target)}listenToKeyEvents(t){t.addEventListener("keydown",this._onKeyDown),this._domElementKeyEvents=t}stopListenToKeyEvents(){this._domElementKeyEvents!==null&&(this._domElementKeyEvents.removeEventListener("keydown",this._onKeyDown),this._domElementKeyEvents=null)}saveState(){this.target0.copy(this.target),this.position0.copy(this.object.position),this.zoom0=this.object.zoom}reset(){this.target.copy(this.target0),this.object.position.copy(this.position0),this.object.zoom=this.zoom0,this.object.updateProjectionMatrix(),this.dispatchEvent(Rt),this.update(),this.state=c.NONE}update(t=null){const i=this.object.position;_.copy(i).sub(this.target),_.applyQuaternion(this._quat),this._spherical.setFromVector3(_),this.autoRotate&&this.state===c.NONE&&this._rotateLeft(this._getAutoRotationAngle(t)),this.enableDamping?(this._spherical.theta+=this._sphericalDelta.theta*this.dampingFactor,this._spherical.phi+=this._sphericalDelta.phi*this.dampingFactor):(this._spherical.theta+=this._sphericalDelta.theta,this._spherical.phi+=this._sphericalDelta.phi);let o=this.minAzimuthAngle,s=this.maxAzimuthAngle;isFinite(o)&&isFinite(s)&&(o<-Math.PI?o+=E:o>Math.PI&&(o-=E),s<-Math.PI?s+=E:s>Math.PI&&(s-=E),o<=s?this._spherical.theta=Math.max(o,Math.min(s,this._spherical.theta)):this._spherical.theta=this._spherical.theta>(o+s)/2?Math.max(o,this._spherical.theta):Math.min(s,this._spherical.theta)),this._spherical.phi=Math.max(this.minPolarAngle,Math.min(this.maxPolarAngle,this._spherical.phi)),this._spherical.makeSafe(),this.enableDamping===!0?this.target.addScaledVector(this._panOffset,this.dampingFactor):this.target.add(this._panOffset),this.target.sub(this.cursor),this.target.clampLength(this.minTargetRadius,this.maxTargetRadius),this.target.add(this.cursor);let n=!1;if(this.zoomToCursor&&this._performCursorZoom||this.object.isOrthographicCamera)this._spherical.radius=this._clampDistance(this._spherical.radius);else{const r=this._spherical.radius;this._spherical.radius=this._clampDistance(this._spherical.radius*this._scale),n=r!=this._spherical.radius}if(_.setFromSpherical(this._spherical),_.applyQuaternion(this._quatInverse),i.copy(this.target).add(_),this.object.lookAt(this.target),this.enableDamping===!0?(this._sphericalDelta.theta*=1-this.dampingFactor,this._sphericalDelta.phi*=1-this.dampingFactor,this._panOffset.multiplyScalar(1-this.dampingFactor)):(this._sphericalDelta.set(0,0,0),this._panOffset.set(0,0,0)),this.zoomToCursor&&this._performCursorZoom){let r=null;if(this.object.isPerspectiveCamera){const a=_.length();r=this._clampDistance(a*this._scale);const p=a-r;this.object.position.addScaledVector(this._dollyDirection,p),this.object.updateMatrixWorld(),n=!!p}else if(this.object.isOrthographicCamera){const a=new l(this._mouse.x,this._mouse.y,0);a.unproject(this.object);const p=this.object.zoom;this.object.zoom=Math.max(this.minZoom,Math.min(this.maxZoom,this.object.zoom/this._scale)),this.object.updateProjectionMatrix(),n=p!==this.object.zoom;const y=new l(this._mouse.x,this._mouse.y,0);y.unproject(this.object),this.object.position.sub(y).add(a),this.object.updateMatrixWorld(),r=_.length()}else console.warn("WARNING: OrbitControls.js encountered an unknown camera type - zoom to cursor disabled."),this.zoomToCursor=!1;r!==null&&(this.screenSpacePanning?this.target.set(0,0,-1).transformDirection(this.object.matrix).multiplyScalar(r).add(this.object.position):(pt.origin.copy(this.object.position),pt.direction.set(0,0,-1).transformDirection(this.object.matrix),Math.abs(this.object.up.dot(pt.direction))<le?this.object.lookAt(this.target):(Yt.setFromNormalAndCoplanarPoint(this.object.up,this.target),pt.intersectPlane(Yt,this.target))))}else if(this.object.isOrthographicCamera){const r=this.object.zoom;this.object.zoom=Math.max(this.minZoom,Math.min(this.maxZoom,this.object.zoom/this._scale)),r!==this.object.zoom&&(this.object.updateProjectionMatrix(),n=!0)}return this._scale=1,this._performCursorZoom=!1,n||this._lastPosition.distanceToSquared(this.object.position)>bt||8*(1-this._lastQuaternion.dot(this.object.quaternion))>bt||this._lastTargetPosition.distanceToSquared(this.target)>bt?(this.dispatchEvent(Rt),this._lastPosition.copy(this.object.position),this._lastQuaternion.copy(this.object.quaternion),this._lastTargetPosition.copy(this.target),!0):!1}_getAutoRotationAngle(t){return t!==null?E/60*this.autoRotateSpeed*t:E/60/60*this.autoRotateSpeed}_getZoomScale(t){const i=Math.abs(t*.01);return Math.pow(.95,this.zoomSpeed*i)}_rotateLeft(t){this._sphericalDelta.theta-=t}_rotateUp(t){this._sphericalDelta.phi-=t}_panLeft(t,i){_.setFromMatrixColumn(i,0),_.multiplyScalar(-t),this._panOffset.add(_)}_panUp(t,i){this.screenSpacePanning===!0?_.setFromMatrixColumn(i,1):(_.setFromMatrixColumn(i,0),_.crossVectors(this.object.up,_)),_.multiplyScalar(t),this._panOffset.add(_)}_pan(t,i){const o=this.domElement;if(this.object.isPerspectiveCamera){const s=this.object.position;_.copy(s).sub(this.target);let n=_.length();n*=Math.tan(this.object.fov/2*Math.PI/180),this._panLeft(2*t*n/o.clientHeight,this.object.matrix),this._panUp(2*i*n/o.clientHeight,this.object.matrix)}else this.object.isOrthographicCamera?(this._panLeft(t*(this.object.right-this.object.left)/this.object.zoom/o.clientWidth,this.object.matrix),this._panUp(i*(this.object.top-this.object.bottom)/this.object.zoom/o.clientHeight,this.object.matrix)):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - pan disabled."),this.enablePan=!1)}_dollyOut(t){this.object.isPerspectiveCamera||this.object.isOrthographicCamera?this._scale/=t:(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),this.enableZoom=!1)}_dollyIn(t){this.object.isPerspectiveCamera||this.object.isOrthographicCamera?this._scale*=t:(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),this.enableZoom=!1)}_updateZoomParameters(t,i){if(!this.zoomToCursor)return;this._performCursorZoom=!0;const o=this.domElement.getBoundingClientRect(),s=t-o.left,n=i-o.top,r=o.width,a=o.height;this._mouse.x=s/r*2-1,this._mouse.y=-(n/a)*2+1,this._dollyDirection.set(this._mouse.x,this._mouse.y,1).unproject(this.object).sub(this.object.position).normalize()}_clampDistance(t){return Math.max(this.minDistance,Math.min(this.maxDistance,t))}_handleMouseDownRotate(t){this._rotateStart.set(t.clientX,t.clientY)}_handleMouseDownDolly(t){this._updateZoomParameters(t.clientX,t.clientX),this._dollyStart.set(t.clientX,t.clientY)}_handleMouseDownPan(t){this._panStart.set(t.clientX,t.clientY)}_handleMouseMoveRotate(t){this._rotateEnd.set(t.clientX,t.clientY),this._rotateDelta.subVectors(this._rotateEnd,this._rotateStart).multiplyScalar(this.rotateSpeed);const i=this.domElement;this._rotateLeft(E*this._rotateDelta.x/i.clientHeight),this._rotateUp(E*this._rotateDelta.y/i.clientHeight),this._rotateStart.copy(this._rotateEnd),this.update()}_handleMouseMoveDolly(t){this._dollyEnd.set(t.clientX,t.clientY),this._dollyDelta.subVectors(this._dollyEnd,this._dollyStart),this._dollyDelta.y>0?this._dollyOut(this._getZoomScale(this._dollyDelta.y)):this._dollyDelta.y<0&&this._dollyIn(this._getZoomScale(this._dollyDelta.y)),this._dollyStart.copy(this._dollyEnd),this.update()}_handleMouseMovePan(t){this._panEnd.set(t.clientX,t.clientY),this._panDelta.subVectors(this._panEnd,this._panStart).multiplyScalar(this.panSpeed),this._pan(this._panDelta.x,this._panDelta.y),this._panStart.copy(this._panEnd),this.update()}_handleMouseWheel(t){this._updateZoomParameters(t.clientX,t.clientY),t.deltaY<0?this._dollyIn(this._getZoomScale(t.deltaY)):t.deltaY>0&&this._dollyOut(this._getZoomScale(t.deltaY)),this.update()}_handleKeyDown(t){let i=!1;switch(t.code){case this.keys.UP:t.ctrlKey||t.metaKey||t.shiftKey?this.enableRotate&&this._rotateUp(E*this.keyRotateSpeed/this.domElement.clientHeight):this.enablePan&&this._pan(0,this.keyPanSpeed),i=!0;break;case this.keys.BOTTOM:t.ctrlKey||t.metaKey||t.shiftKey?this.enableRotate&&this._rotateUp(-E*this.keyRotateSpeed/this.domElement.clientHeight):this.enablePan&&this._pan(0,-this.keyPanSpeed),i=!0;break;case this.keys.LEFT:t.ctrlKey||t.metaKey||t.shiftKey?this.enableRotate&&this._rotateLeft(E*this.keyRotateSpeed/this.domElement.clientHeight):this.enablePan&&this._pan(this.keyPanSpeed,0),i=!0;break;case this.keys.RIGHT:t.ctrlKey||t.metaKey||t.shiftKey?this.enableRotate&&this._rotateLeft(-E*this.keyRotateSpeed/this.domElement.clientHeight):this.enablePan&&this._pan(-this.keyPanSpeed,0),i=!0;break}i&&(t.preventDefault(),this.update())}_handleTouchStartRotate(t){if(this._pointers.length===1)this._rotateStart.set(t.pageX,t.pageY);else{const i=this._getSecondPointerPosition(t),o=.5*(t.pageX+i.x),s=.5*(t.pageY+i.y);this._rotateStart.set(o,s)}}_handleTouchStartPan(t){if(this._pointers.length===1)this._panStart.set(t.pageX,t.pageY);else{const i=this._getSecondPointerPosition(t),o=.5*(t.pageX+i.x),s=.5*(t.pageY+i.y);this._panStart.set(o,s)}}_handleTouchStartDolly(t){const i=this._getSecondPointerPosition(t),o=t.pageX-i.x,s=t.pageY-i.y,n=Math.sqrt(o*o+s*s);this._dollyStart.set(0,n)}_handleTouchStartDollyPan(t){this.enableZoom&&this._handleTouchStartDolly(t),this.enablePan&&this._handleTouchStartPan(t)}_handleTouchStartDollyRotate(t){this.enableZoom&&this._handleTouchStartDolly(t),this.enableRotate&&this._handleTouchStartRotate(t)}_handleTouchMoveRotate(t){if(this._pointers.length==1)this._rotateEnd.set(t.pageX,t.pageY);else{const o=this._getSecondPointerPosition(t),s=.5*(t.pageX+o.x),n=.5*(t.pageY+o.y);this._rotateEnd.set(s,n)}this._rotateDelta.subVectors(this._rotateEnd,this._rotateStart).multiplyScalar(this.rotateSpeed);const i=this.domElement;this._rotateLeft(E*this._rotateDelta.x/i.clientHeight),this._rotateUp(E*this._rotateDelta.y/i.clientHeight),this._rotateStart.copy(this._rotateEnd)}_handleTouchMovePan(t){if(this._pointers.length===1)this._panEnd.set(t.pageX,t.pageY);else{const i=this._getSecondPointerPosition(t),o=.5*(t.pageX+i.x),s=.5*(t.pageY+i.y);this._panEnd.set(o,s)}this._panDelta.subVectors(this._panEnd,this._panStart).multiplyScalar(this.panSpeed),this._pan(this._panDelta.x,this._panDelta.y),this._panStart.copy(this._panEnd)}_handleTouchMoveDolly(t){const i=this._getSecondPointerPosition(t),o=t.pageX-i.x,s=t.pageY-i.y,n=Math.sqrt(o*o+s*s);this._dollyEnd.set(0,n),this._dollyDelta.set(0,Math.pow(this._dollyEnd.y/this._dollyStart.y,this.zoomSpeed)),this._dollyOut(this._dollyDelta.y),this._dollyStart.copy(this._dollyEnd);const r=(t.pageX+i.x)*.5,a=(t.pageY+i.y)*.5;this._updateZoomParameters(r,a)}_handleTouchMoveDollyPan(t){this.enableZoom&&this._handleTouchMoveDolly(t),this.enablePan&&this._handleTouchMovePan(t)}_handleTouchMoveDollyRotate(t){this.enableZoom&&this._handleTouchMoveDolly(t),this.enableRotate&&this._handleTouchMoveRotate(t)}_addPointer(t){this._pointers.push(t.pointerId)}_removePointer(t){delete this._pointerPositions[t.pointerId];for(let i=0;i<this._pointers.length;i++)if(this._pointers[i]==t.pointerId){this._pointers.splice(i,1);return}}_isTrackingPointer(t){for(let i=0;i<this._pointers.length;i++)if(this._pointers[i]==t.pointerId)return!0;return!1}_trackPointer(t){let i=this._pointerPositions[t.pointerId];i===void 0&&(i=new j,this._pointerPositions[t.pointerId]=i),i.set(t.pageX,t.pageY)}_getSecondPointerPosition(t){const i=t.pointerId===this._pointers[0]?this._pointers[1]:this._pointers[0];return this._pointerPositions[i]}_customWheelEvent(t){const i=t.deltaMode,o={clientX:t.clientX,clientY:t.clientY,deltaY:t.deltaY};switch(i){case 1:o.deltaY*=16;break;case 2:o.deltaY*=100;break}return t.ctrlKey&&!this._controlActive&&(o.deltaY*=10),o}}function pe(e){this.enabled!==!1&&(this._pointers.length===0&&(this.domElement.setPointerCapture(e.pointerId),this.domElement.addEventListener("pointermove",this._onPointerMove),this.domElement.addEventListener("pointerup",this._onPointerUp)),!this._isTrackingPointer(e)&&(this._addPointer(e),e.pointerType==="touch"?this._onTouchStart(e):this._onMouseDown(e)))}function ue(e){this.enabled!==!1&&(e.pointerType==="touch"?this._onTouchMove(e):this._onMouseMove(e))}function de(e){switch(this._removePointer(e),this._pointers.length){case 0:this.domElement.releasePointerCapture(e.pointerId),this.domElement.removeEventListener("pointermove",this._onPointerMove),this.domElement.removeEventListener("pointerup",this._onPointerUp),this.dispatchEvent(Ct),this.state=c.NONE;break;case 1:const t=this._pointers[0],i=this._pointerPositions[t];this._onTouchStart({pointerId:t,pageX:i.x,pageY:i.y});break}}function _e(e){let t;switch(e.button){case 0:t=this.mouseButtons.LEFT;break;case 1:t=this.mouseButtons.MIDDLE;break;case 2:t=this.mouseButtons.RIGHT;break;default:t=-1}switch(t){case H.DOLLY:if(this.enableZoom===!1)return;this._handleMouseDownDolly(e),this.state=c.DOLLY;break;case H.ROTATE:if(e.ctrlKey||e.metaKey||e.shiftKey){if(this.enablePan===!1)return;this._handleMouseDownPan(e),this.state=c.PAN}else{if(this.enableRotate===!1)return;this._handleMouseDownRotate(e),this.state=c.ROTATE}break;case H.PAN:if(e.ctrlKey||e.metaKey||e.shiftKey){if(this.enableRotate===!1)return;this._handleMouseDownRotate(e),this.state=c.ROTATE}else{if(this.enablePan===!1)return;this._handleMouseDownPan(e),this.state=c.PAN}break;default:this.state=c.NONE}this.state!==c.NONE&&this.dispatchEvent(yt)}function me(e){switch(this.state){case c.ROTATE:if(this.enableRotate===!1)return;this._handleMouseMoveRotate(e);break;case c.DOLLY:if(this.enableZoom===!1)return;this._handleMouseMoveDolly(e);break;case c.PAN:if(this.enablePan===!1)return;this._handleMouseMovePan(e);break}}function ye(e){this.enabled===!1||this.enableZoom===!1||this.state!==c.NONE||(e.preventDefault(),this.dispatchEvent(yt),this._handleMouseWheel(this._customWheelEvent(e)),this.dispatchEvent(Ct))}function be(e){this.enabled!==!1&&this._handleKeyDown(e)}function we(e){switch(this._trackPointer(e),this._pointers.length){case 1:switch(this.touches.ONE){case W.ROTATE:if(this.enableRotate===!1)return;this._handleTouchStartRotate(e),this.state=c.TOUCH_ROTATE;break;case W.PAN:if(this.enablePan===!1)return;this._handleTouchStartPan(e),this.state=c.TOUCH_PAN;break;default:this.state=c.NONE}break;case 2:switch(this.touches.TWO){case W.DOLLY_PAN:if(this.enableZoom===!1&&this.enablePan===!1)return;this._handleTouchStartDollyPan(e),this.state=c.TOUCH_DOLLY_PAN;break;case W.DOLLY_ROTATE:if(this.enableZoom===!1&&this.enableRotate===!1)return;this._handleTouchStartDollyRotate(e),this.state=c.TOUCH_DOLLY_ROTATE;break;default:this.state=c.NONE}break;default:this.state=c.NONE}this.state!==c.NONE&&this.dispatchEvent(yt)}function fe(e){switch(this._trackPointer(e),this.state){case c.TOUCH_ROTATE:if(this.enableRotate===!1)return;this._handleTouchMoveRotate(e),this.update();break;case c.TOUCH_PAN:if(this.enablePan===!1)return;this._handleTouchMovePan(e),this.update();break;case c.TOUCH_DOLLY_PAN:if(this.enableZoom===!1&&this.enablePan===!1)return;this._handleTouchMoveDollyPan(e),this.update();break;case c.TOUCH_DOLLY_ROTATE:if(this.enableZoom===!1&&this.enableRotate===!1)return;this._handleTouchMoveDollyRotate(e),this.update();break;default:this.state=c.NONE}}function ve(e){this.enabled!==!1&&e.preventDefault()}function ge(e){e.key==="Control"&&(this._controlActive=!0,this.domElement.getRootNode().addEventListener("keyup",this._interceptControlUp,{passive:!0,capture:!0}))}function Pe(e){e.key==="Control"&&(this._controlActive=!1,this.domElement.getRootNode().removeEventListener("keyup",this._interceptControlUp,{passive:!0,capture:!0}))}export{K as E,Et as G,ce as O,Jt as T,te as a};
