class PinterestPlugin extends SitePlugin{inject(){setInterval(()=>{this.makeVideoElementCollectable()},500)}onContextMen;makeVideoElementCollectable(){document.querySelectorAll("video:not([eagle-collectable])").forEach((e,t)=>{e.setAttribute("eagle-collectable","true")}),document.querySelectorAll("section.note-item:has(.play-icon) img:not([eagle-collectable][eagle-type])").forEach((e,t)=>{e.setAttribute("eagle-collectable","true"),e.setAttribute("eagle-type","video")})}getMeta(e){var t,r={},n=e.closest("section");if(n)t=n.querySelector("a.title"),n=n.querySelector("a.author"),t&&n?r.title=t.textContent.trim()+" - "+n.textContent.trim():t?r.title=t.textContent.trim():n&&(r.title=n.textContent.trim());else if(n=e.closest("div#noteContainer.note-container")){const t=n.querySelector("div.title");e=n.querySelector("div.desc");n=n.querySelector("a.name");t&&n?r.title=t.textContent.trim()+" - "+n.textContent.trim():e&&n?r.title=e.textContent.trim()+" - "+n.textContent.trim():n&&(r.title=n.textContent.trim())}return r}cutString(e,t,r,n=0,l=!1){if(-1===(n=e.indexOf(t,n)))return"";n+=t.length;let i=e.indexOf(r,n);if(-1===i){if(!l)return"";i=e.length}return e.substr(n,i-n)}extractPageId(e){return(e=e.match(/\/([a-z0-9]{24})\?/))?e[1]:null}isH265Support(){try{var e=document.createElement("video"),t="probably"===e.canPlayType('video/mp4; codecs="avc1.42E01E"')&&"probably"===e.canPlayType('video/mp4; codecs="hev1.1.6.L93.B0"');return e.remove(),t}catch(e){return!1}}async getMetaAsync(t){try{let e=window.location.href;var r=t.closest("a");if(!r?.querySelector("span.play-icon")&&"VIDEO"!==t.tagName)return{};r&&(r.href.includes("/user/profile/")&&(e=r.href),r.href.includes("/explore/")&&(e=r.href),r.href.includes("/search_result/"))&&(e=r.href);var n,l=this.extractPageId(e),i=await(await fetch(e)).text(),o=this.cutString(i,'"noteDetailMap":',',"serverRequestInfo":'),a=JSON.parse(o)[l];return a?.note?.video?.media?.stream?(n=a.note.video.media.stream,this.isH265Support()&&0<n.h265.length?{src:n.h265[0].masterUrl}:{src:n.h264[0].masterUrl}):{}}catch(e){return{}}}}(()=>{var e=new PinterestPlugin;eagle.plugin.register("www.xiaohongshu.com/(.*)",e),e.inject()})();