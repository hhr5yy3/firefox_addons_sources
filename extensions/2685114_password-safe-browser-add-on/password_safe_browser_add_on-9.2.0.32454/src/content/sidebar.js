function elementContains(selector,regex){selector=document.querySelectorAll(selector);return[].filter.call(selector,element=>RegExp(regex).test(element.textContent))}function PsrTemplate(field,command,delay,value,psrElement){this.Field=field,this.Command=command,this.Value=value,this.Delay=delay,this.PsrElement=psrElement}function PsrElement(element){this.getPropOrDefault=function(el,propName){if(el)return el=null!=el[propName]?el[propName]:"",["id","name","className","tagName"].some(p=>p===propName)&&"string"!=typeof el?"":el},this.getRandomColor=function(){for(var letters="0123456789ABCDEF".split(""),color="#",i=0;i<6;i++)color+=letters[Math.floor(16*Math.random())];return color};var rect=element.getBoundingClientRect(),rect={top:rect.top+Math.max(window.pageYOffset,document.documentElement.scrollTop,document.body.scrollTop),left:rect.left+Math.max(window.pageYOffset,document.documentElement.scrollTop,document.body.scrollTop)},form=element.closest("form");this.Host=window.location.host,this.Url=window.location.href,this.Tag=this.getPropOrDefault(element,"tagName"),this.Name=this.getPropOrDefault(element,"name"),this.ClassName=this.getPropOrDefault(element,"className"),this.Id=this.getPropOrDefault(element,"id"),this.Type=this.getPropOrDefault(element,"type"),this.Href=element.getAttribute("href"),this.ScreenTop=rect.top,this.ScreenLeft=rect.left,this.ActualWidth=element.offsetWidth,this.ActualHeight=element.offsetHeight,this.FormName=this.getPropOrDefault(form,"name"),this.FormId=this.getPropOrDefault(form,"id"),this.ParentFormIndex=-1,this.FormIndex=-1,this.Color=this.getRandomColor(),this.Title=element.getAttribute("title"),this.Alt=element.getAttribute("alt"),this.DefaultValue=this.getPropOrDefault(element,"defaultValue"),this.TagIndex=[].slice.call(document.querySelectorAll(this.Tag)).indexOf(element),[].slice.call(document.querySelectorAll("form")).forEach((form,formIndex)=>{[].slice.call(form.querySelectorAll("input, textarea, select, button")).forEach((input,inputIndex)=>{input===element&&(this.ParentFormIndex=formIndex,this.FormIndex=inputIndex)})}),"input"===this.Tag.toLowerCase()?"submit"===this.Type.toLowerCase()?this.Text=element.value:(rect=document.querySelector("label[for='"+element.getAttribute("id")+"']"),this.Text=rect?rect.textContent:""):this.Text=element.textContent}function PsrSidebar(){this.isVisible=!1,this.template=[],this.templatePanel,this.recordingEnabled=!0,this.isRight=!0;var _self=this;this.initialize=async function(){this.optionAdvanced=await mv.getStoreEntry("option_advanced")},this.toggleSidebar=function(){var el;_self.addPsrEventsToContentDom(),_self.isVisible?((el=document.getElementById("psrTemplateSidebar"))&&el.remove(),_self.isVisible=!1):_self.isInIframe()||(el=_self.createSidebar(),document.children[0].appendChild(el),_self.isVisible=!0)},this.createSidebar=function(){const sidebar=document.createElement("div");sidebar.id="psrTemplateSidebar",sidebar.classList.add("psrOverrideStyle"),sidebar.style.position="fixed",sidebar.style.right="0",sidebar.style.bottom="0",sidebar.style.borderLeft="1px solid black",sidebar.style.padding="15px 15px 5px 15px",sidebar.style.width="350px",sidebar.style.height="100%",sidebar.style.backgroundColor="#e8e8e8",sidebar.style.opacity="0.9",sidebar.style.zIndex="999999";var headerPanel=document.createElement("div"),header=(headerPanel.classList.add("psrOverrideStyle"),headerPanel.style.margin="5px 0 0 0",headerPanel.style.display="block",headerPanel.style.fontSize="small",document.createElement("h1")),recordingEnabledPanel=(header.classList.add("psrOverrideStyle"),header.style.fontSize="22px",header.style.textAlign="left",header.style.color="#4682b4",header.style.display="block",header.style.margin="0px 0p 15px 0px",header.innerHTML=_self.getLocalized("template_header"),document.createElement("div"));recordingEnabledPanel.classList.add("psrOverrideStyle"),recordingEnabledPanel.style.display="block",recordingEnabledPanel.style.margin="5px 0 5px 0";const recordingEnabled=document.createElement("input");recordingEnabled.classList.add("psrOverrideStyle"),recordingEnabled.id="psrRecordingEnabled",recordingEnabled.type="checkbox",recordingEnabled.checked=_self.recordingEnabled,recordingEnabled.style.margin="0 5px 0 5px",recordingEnabled.addEventListener("click",()=>{_self.recordingEnabled=recordingEnabled.checked,_self.recordingEnabled?_self.addPsrEventsToContentDom():_self.removePsrEventsFromContentDom()});var recordingEnabledLabel=document.createElement("label"),recordingEnabledLabel=(recordingEnabledLabel.classList.add("psrOverrideStyle"),recordingEnabledLabel.htmlFor="psrRecordingEnabled",recordingEnabledLabel.innerHTML=_self.getLocalized("template_active"),recordingEnabledPanel.appendChild(recordingEnabled),recordingEnabledPanel.appendChild(recordingEnabledLabel),document.createElement("div"));recordingEnabledLabel.classList.add("psrOverrideStyle"),recordingEnabledLabel.style.display="block",recordingEnabledLabel.style.margin="5px 0 5px 0";const advancedOptionsCheckbox=document.createElement("input");advancedOptionsCheckbox.classList.add("psrOverrideStyle"),advancedOptionsCheckbox.id="psrAdvancedOptions",advancedOptionsCheckbox.type="checkbox",advancedOptionsCheckbox.checked=_self.optionAdvanced,advancedOptionsCheckbox.style.margin="0 5px 0 5px",advancedOptionsCheckbox.addEventListener("change",async()=>{_self.optionAdvanced=advancedOptionsCheckbox.checked,_self.optionAdvanced=await mv.setStoreEntry("option_advanced",advancedOptionsCheckbox.checked),_self.optionAdvanced?[].slice.call(document.querySelectorAll("select[name=psrDelayCombobox]")).forEach(e=>e.style.display=""):[].slice.call(document.querySelectorAll("select[name=psrDelayCombobox]")).forEach(e=>e.style.display="none"),_self.sendTemplateToBackgroundScript(JSON.stringify(_self.template),window.location.href,!0,_self.optionAdvanced)});var advancedOptionsCheckboxLabel=document.createElement("label"),advancedOptionsCheckboxLabel=(advancedOptionsCheckboxLabel.classList.add("psrOverrideStyle"),advancedOptionsCheckboxLabel.htmlFor="psrAdvancedOptions",advancedOptionsCheckboxLabel.innerHTML=_self.getLocalized("template_advanced_options"),recordingEnabledLabel.appendChild(advancedOptionsCheckbox),recordingEnabledLabel.appendChild(advancedOptionsCheckboxLabel),document.createElement("div")),psrButtonStyle=(advancedOptionsCheckboxLabel.classList.add("psrOverrideStyle"),advancedOptionsCheckboxLabel.style.position="absolute",advancedOptionsCheckboxLabel.style.bottom="0",advancedOptionsCheckboxLabel.style.right="0",advancedOptionsCheckboxLabel.style.margin="0 15px 5px 0",{margin:"0 0 0 5px",border:"1px solid #777777",color:"white",padding:"2px 5px",borderRadius:"3px",backgroundColor:"#4682b4",textAlign:"center"}),saveButton=document.createElement("button"),cancelButton=(saveButton.classList.add("psrOverrideStyle"),Object.assign(saveButton.style,psrButtonStyle),saveButton.innerHTML=_self.getLocalized("template_save"),saveButton.id="psrTemplateSaveButton",saveButton.addEventListener("click",_self.saveTemplate),document.createElement("button")),moveButton=(cancelButton.classList.add("psrOverrideStyle"),Object.assign(cancelButton.style,psrButtonStyle),cancelButton.innerHTML=_self.getLocalized("template_discard"),cancelButton.addEventListener("click",_self.cancelTemplate),document.createElement("button"));return moveButton.classList.add("psrOverrideStyle"),Object.assign(moveButton.style,psrButtonStyle),moveButton.innerHTML=_self.getLocalized("template_sidebar_move"),moveButton.addEventListener("click",()=>{_self.isRight?(_self.isRight=!1,sidebar.style.left="0",sidebar.style.right=""):(_self.isRight=!0,sidebar.style.left="",sidebar.style.right="0")}),_self.templatePanel=document.createElement("div"),_self.templatePanel.classList.add("psrOverrideStyle"),_self.templatePanel.style.display="block",_self.templatePanel.style.marginTop="25px",headerPanel.appendChild(header),headerPanel.appendChild(recordingEnabledPanel),headerPanel.appendChild(recordingEnabledLabel),headerPanel.appendChild(document.createElement("hr")),advancedOptionsCheckboxLabel.appendChild(moveButton),advancedOptionsCheckboxLabel.appendChild(saveButton),advancedOptionsCheckboxLabel.appendChild(cancelButton),sidebar.appendChild(headerPanel),sidebar.appendChild(_self.templatePanel),sidebar.appendChild(advancedOptionsCheckboxLabel),sidebar},this.setDelayOption=function(option){_self.optionAdvanced=option;var advancedOptions=document.getElementById("psrAdvancedOptions");advancedOptions&&(advancedOptions.checked=option)},this.saveTemplate=function(){_self.isVisible&&_self.toggleSidebar();var url=0<_self.template.length?_self.template[0].PsrElement.Url:window.location.href;_self.sendTemplateToBackgroundScript(JSON.stringify(_self.template),url,!1,_self.optionAdvanced),_self.dispose()},this.cancelTemplate=function(){_self.isVisible&&_self.toggleSidebar(),_self.sendTemplateToBackgroundScript(null,window.location.href,!1,!1),_self.dispose()},this.sendTemplateToBackgroundScript=function(template,url,edit,advanced){abstractBrowser.sendMessage({command:"SaveTemplateCommand",data:{template:template,url:url,host:window.location.host,edit:edit,advanced:advanced}})},this.dispose=function(){for(var i=0;i<_self.template.length;i++)_self.unmarkTemplateElement(_self.template[i].PsrElement);_self.removePsrEventsFromContentDom(),_self.template=[]},this.elementClicked=function(element){var value,command;!_self.recordingEnabled||element.classList.contains("psrOverrideStyle")||isHidden(element)||(command=matchesSelector(element,"input")&&"submit"!==element.type?FILL_COMMAND:_self.template.length<2?CLICK_COMMAND:SUBMIT_COMMAND,value=matchesSelector(element,"[type=password]")?"{ContainerItemPassword}":"{ContainerItemUserName}",command=new PsrTemplate(element,command,0,command===FILL_COMMAND?value:"",new PsrElement(element)),_self.addElementToTemplate(command,!1),_self.sendTemplateToBackgroundScript(JSON.stringify(_self.template),window.location.href,!0,_self.optionAdvanced))},this.addElementToTemplate=function(element,ignoreFrame){element.Field&&_self.markTemplateElement(element.Field,element.PsrElement.Color,!1),_self.template.push(element);var isIframe=_self.isInIframe();if(!isIframe||!ignoreFrame)if(isIframe)abstractBrowser.sendMessage({subject:"SendToContentScript",data:element,command:"SidebarAddTemplateCommand"});else{const templateItem=document.createElement("div");templateItem.classList.add("psrOverrideStyle"),templateItem.style.margin="5px 0 15px 10px",templateItem.style.display="block",_self.markTemplateElement(templateItem,element.PsrElement.Color,!0);let previousTemplate;2<this.template.length&&(previousTemplate=_self.template[_self.template.length-2]);var ignoreFrame=document.createElement("span"),isIframe=(ignoreFrame.innerHTML=element.PsrElement.Tag+": "+(""===element.PsrElement.Text?""===element.PsrElement.Name?element.PsrElement.Id:element.PsrElement.Name:element.PsrElement.Text),ignoreFrame.classList.add("psrOverrideStyle"),ignoreFrame.style.margin="10px 5px 3px 5px",ignoreFrame.style.display="block",document.createElement("div")),containerItemCombobox=(isIframe.classList.add("psrOverrideStyle"),isIframe.style.display="block",_self.createContainerItemTypeCombobox());const containerItemNameInput=document.createElement("input");containerItemCombobox.addEventListener("change",evt=>{var selectedOption=evt.target.options[evt.target.selectedIndex].id;"ContainerItemByName"===selectedOption?(element.Value&&element.Value.replace("{","").replace("}",""),containerItemNameInput.classList.add("select_containeritem_name"),containerItemNameInput.type="text",containerItemNameInput.classList.add("psrOverrideStyle"),containerItemNameInput.style.margin="2px",containerItemNameInput.style.backgroundColor="#F8F8F8",containerItemNameInput.style.border="1px solid darkgray",containerItemNameInput.style.margin="2px 0 0 0",containerItemNameInput.style.fontSize="12px",containerItemNameInput.addEventListener("change",event=>{element.Value="{"+event.target.value+"}",element.Command=FILL_COMMAND,_self.sendTemplateToBackgroundScript(JSON.stringify(_self.template),window.location.href,!0,_self.optionAdvanced)}),templateItem.appendChild(containerItemNameInput)):(containerItemNameInput.remove(),selectedOption===SUBMIT_COMMAND?(element.Value="",element.Command=SUBMIT_COMMAND):selectedOption===CLICK_COMMAND?(element.Value="",element.Command=CLICK_COMMAND):(element.Value="{"+evt.target.options[evt.target.selectedIndex].id+"}",element.Command=FILL_COMMAND),_self.sendTemplateToBackgroundScript(JSON.stringify(_self.template),window.location.href,!0,_self.optionAdvanced))}),isIframe.appendChild(containerItemCombobox);var delayCombobox=_self.createDelayCombobox();delayCombobox.addEventListener("change",event=>{event=event.target.options[event.target.selectedIndex].id;element.Delay=_self.getDelayValueForOptionId(event),_self.sendTemplateToBackgroundScript(JSON.stringify(_self.template),window.location.href,!0,_self.optionAdvanced)}),_self.setDelaySelection(element.Delay,delayCombobox),isIframe.appendChild(delayCombobox);let templateHref;previousTemplate&&element.PsrElement.Host!==previousTemplate.PsrElement.Host||1===_self.template.length?((templateHref=document.createElement("p")).classList.add("psrOverrideStyle"),templateHref.innerHTML=element.PsrElement.Host+":",templateHref.style.borderBottom="1px solid #4682B4",templateHref.style.display="block",_self.templatePanel.appendChild(templateHref)):templateHref=elementContains("p",element.PsrElement.Host)[0];delayCombobox=document.createElement("button"),delayCombobox=(delayCombobox.classList.add("psrOverrideStyle"),delayCombobox.innerHTML="x",delayCombobox.style.float="right",delayCombobox.style.margin="0 5px 0 0",delayCombobox.style.position="relative",delayCombobox.style.top="0",delayCombobox.style.right="0",delayCombobox.addEventListener("click",()=>{_self.templatePanel.removeChild(templateItem);var index=_self.template.indexOf(element);_self.template.splice(index,1),_self.unmarkTemplateElement(element.PsrElement);let url;for(let i=0;i<_self.template.length;i++){var e=_self.template[i];if(e.PsrElement.Host===element.PsrElement.Host){url=e.PsrElement.Host;break}}url||_self.templatePanel.removeChild(templateHref),_self.sendTemplateToBackgroundScript(JSON.stringify(_self.template),url,!0,_self.optionAdvanced)}),element.Field=null,templateItem.appendChild(delayCombobox),templateItem.appendChild(ignoreFrame),templateItem.appendChild(isIframe),_self.templatePanel.appendChild(templateItem),_self.setValueSelection(element,containerItemCombobox),[].slice.call(document.querySelectorAll("select[name=psrDelayCombobox]")));_self.optionAdvanced?delayCombobox.forEach(e=>e.style.display=""):delayCombobox.forEach(e=>e.style.display="none")}},this.setValueSelection=function(templateElement,valueSelect){if(templateElement.Command===CLICK_COMMAND)valueSelect.selectedIndex=2;else if(templateElement.Command===SUBMIT_COMMAND)valueSelect.selectedIndex=3;else{let value=templateElement.Value;if(""!==value){value=value.replace("{","").replace("}","");for(var i=0;i<valueSelect.options.length;i++)if(valueSelect.options[i].id===value)return void(valueSelect.selectedIndex=i);valueSelect.selectedIndex=valueSelect.length-1,valueSelect.dispatchEvent(new Event("change"))}}},this.markTemplateElement=function(element,color,removeRightBorder){element&&element.style&&(element.style.borderStyle="solid",element.style.borderWidth="1px "+(removeRightBorder?0:1)+"px 1px 8px",element.style.borderRadius="8px 0px 0px 8px",element.style.borderColor=color,element.style.padding="0px 5px 5px 5px")},this.unmarkTemplateElement=function(element){element&&(element=getElement(element))&&(element.style.borderStyle="",element.style.borderWidth="",element.style.borderRadius="",element.style.borderColor="",element.style.padding="")},this.addPsrEventsToContentDom=function(){document.addEventListener("click",_self.onDocumentClicked)},this.onDocumentClicked=function(e){e.target.classList.contains("psrOverrideStyle")||!matchesSelector(e.target,"input, a, button, div, image, img, span")||matchesSelector(e.target,"div, span")&&!checkLoginText(e.target)||_self.elementClicked(e.target)},this.removePsrEventsFromContentDom=function(){document.removeEventListener("click",_self.onDocumentClicked)},this.isInIframe=function(){try{return window!=window.top}catch(ex){return!0}},this.createContainerItemTypeCombobox=function(){var combobox=document.createElement("select");return combobox.classList.add("psrOverrideStyle"),combobox.id="psrContainerTypeSelection",combobox.style.display="inline",combobox.style.backgroundColor="#F8F8F8",combobox.style.border="1px solid darkgray",combobox.style.margin="2px 0 0 0",combobox.style.fontSize="12px",combobox.appendChild(_self.createComboboxOption("ContainerItemUserName",_self.getLocalized("template_command_username"))),combobox.appendChild(_self.createComboboxOption("ContainerItemPassword",_self.getLocalized("template_command_password"))),combobox.appendChild(_self.createComboboxOption(CLICK_COMMAND,_self.getLocalized("template_command_click"))),combobox.appendChild(_self.createComboboxOption(SUBMIT_COMMAND,_self.getLocalized("template_command_submit"))),combobox.appendChild(_self.createComboboxOption("ContainerItemText",_self.getLocalized("template_command_text"))),combobox.appendChild(_self.createComboboxOption("ContainerItemEmail",_self.getLocalized("template_command_email"))),combobox.appendChild(_self.createComboboxOption("ContainerItemInt",_self.getLocalized("template_command_int"))),combobox.appendChild(_self.createComboboxOption("ContainerItemFloat",_self.getLocalized("template_command_float"))),combobox.appendChild(_self.createComboboxOption("ContainerItemCheck",_self.getLocalized("template_command_check"))),combobox.appendChild(_self.createComboboxOption("ContainerItemByName",_self.getLocalized("template_command_fieldbyname"))),combobox},this.createDelayCombobox=function(){var delayCombobox=document.createElement("select");return delayCombobox.classList.add("psrOverrideStyle"),delayCombobox.name="psrDelayCombobox",delayCombobox.style.display="inline",delayCombobox.style.backgroundColor="#F8F8F8",delayCombobox.style.border="1px solid darkgray",delayCombobox.style.margin="2px 0 0 4px",delayCombobox.style.fontSize="12px",delayCombobox.appendChild(_self.createComboboxOption("psrDelay0",_self.getLocalized("template_delay_0"))),delayCombobox.appendChild(_self.createComboboxOption("psrDelay0_25",_self.getLocalized("template_delay_0_25"))),delayCombobox.appendChild(_self.createComboboxOption("psrDelay0_50",_self.getLocalized("template_delay_0_50"))),delayCombobox.appendChild(_self.createComboboxOption("psrDelay0_75",_self.getLocalized("template_delay_0_75"))),delayCombobox.appendChild(_self.createComboboxOption("psrDelay1_00",_self.getLocalized("template_delay_1_00"))),delayCombobox.appendChild(_self.createComboboxOption("psrDelay1_50",_self.getLocalized("template_delay_1_50"))),delayCombobox.appendChild(_self.createComboboxOption("psrDelay2_00",_self.getLocalized("template_delay_2_00"))),delayCombobox.appendChild(_self.createComboboxOption("psrDelay2_50",_self.getLocalized("template_delay_2_50"))),delayCombobox.appendChild(_self.createComboboxOption("psrDelay3_00",_self.getLocalized("template_delay_3_00"))),delayCombobox},this.createComboboxOption=function(id,text){var option=document.createElement("option");return option.id=id,option.innerHTML=text,option},this.getDelayValueForOptionId=function(optionId){switch(optionId){case"psrDelay0":return 0;case"psrDelay0_25":return 250;case"psrDelay0_50":return 500;case"psrDelay0_75":return 750;case"psrDelay1_00":return 1e3;case"psrDelay1_50":return 1500;case"psrDelay2_00":return 2e3;case"psrDelay2_50":return 2500;case"psrDelay3_00":return 3e3;default:return 0}},this.setDelaySelection=function(delay,combobox){var id="";switch(delay){case 0:id="psrDelay0";break;case 250:id="psrDelay0_25";break;case 500:id="psrDelay0_50";break;case 750:id="psrDelay0_75";break;case 1e3:id="psrDelay1_00";break;case 1500:id="psrDelay1_50";break;case 2e3:id="psrDelay2_00";break;case 2500:id="psrDelay2_50";break;case 3e3:id="psrDelay3_00"}for(var i=0;i<combobox.options.length;i++)if(combobox.options[i].id===id)return void(combobox.selectedIndex=i)},this.getLocalized=function(key,inserts){return translationService.translate(key,inserts)}}document.addEventListener("DOMContentLoaded",()=>{var psrstyle=document.createElement("style");psrstyle.appendChild(document.createTextNode("")),document.head.appendChild(psrstyle);psrstyle.sheet.insertRule(`
    .psrOverrideStyle {
      background: 0;
      background-color: transparent;
      border: 0;
      border-radius: 0;
      box-shadow: none;
      bottom: auto;
      clear: none;
      content: normal;
      color: #777777;
      display: inline;
      float: none;
      font: 16px;
      font-size: medium;
      font-weight: normal;
      font-variant: normal;
      font-style: normal;
      font-family: Arial, Helvetica, sans-serif;
      height: auto;
      letter-spacing: normal;
      line-height: normal;
      left: auto;
      min-width: 0;
      min-height: 0;
      max-width: none;
      max-height: none;
      margin: 0;
      opacity: 1;
      overflow: visible;
      position: static;
      padding: 0;
      text-align: left;
      text-shadow: none;
      text-transform: none;
      transform: none;
      transition: none;
      top: auto;
      vertical-align: baseline;
      visibility: visible;
      right: auto;
      white-space: normal;
      width: auto;
      word-spacing: normal;
      z-index: auto;
      box-sizing: initial;
    }`,0)});