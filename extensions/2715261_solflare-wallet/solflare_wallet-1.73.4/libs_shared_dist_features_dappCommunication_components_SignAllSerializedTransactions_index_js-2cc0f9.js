"use strict";(self.webpackChunk_solflare_extension=self.webpackChunk_solflare_extension||[]).push([["libs_shared_dist_features_dappCommunication_components_SignAllSerializedTransactions_index_js-2cc0f9"],{"../../libs/shared/dist/features/dappCommunication/components/MessageAnalysisLoading/index.js":(e,s,t)=>{t.d(s,{K:()=>o});var n=t("../../../node_modules/react/jsx-runtime.js"),i=t("../../../node_modules/react-i18next/dist/es/useTranslation.js"),a=t("../../libs/foundation-ui/dist/index.js"),r=t("../../libs/shared/dist/hooks/useMetamask/index.js");const o=()=>{const{t:e}=(0,i.$)(),{isMetamask:s}=(0,r.U)();return(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(a.TXSimulationList,{children:(0,n.jsx)(a.Section,{variant:"m",children:(0,n.jsx)(a.TXSimulationSection,{title:(0,n.jsx)(a.SectionTitle,{title:e("transaction_message"),tooltip:(0,n.jsx)(a.InfoWithTooltip,{tooltip:e("transaction_message_tooltip")})}),children:(0,n.jsx)(a.TXMessageLoading,{})})})}),(0,n.jsx)(a.FooterActions,{variant:"inContent",children:!s&&(0,n.jsxs)(a.ButtonGroup,{children:[(0,n.jsx)(a.Button,{variant:"secondary",disabled:!0,children:e("action_reject_case")}),(0,n.jsx)(a.Button,{disabled:!0,children:e("action_approve_case")})]})})]})}},"../../libs/shared/dist/features/dappCommunication/components/SignAllSerializedTransactions/index.js":(e,s,t)=>{t.d(s,{w:()=>A});var n=t("../../../node_modules/react/jsx-runtime.js"),i=t("../../../node_modules/react-i18next/dist/es/useTranslation.js"),a=t("../../libs/foundation-ui/dist/index.js"),r=t("../../libs/shared/dist/features/transactionAnalysis/components/index.js"),o=t("../../libs/shared/dist/features/transactionAnalysis/queries/index.js"),d=t("../../libs/shared/dist/features/transactionAnalysis/utils/index.js"),c=t("../../libs/shared/dist/features/dappCommunication/hooks/index.js"),l=t("../../libs/shared/dist/features/dappCommunication/hooks/useAutoApprove.js"),u=t("../../../node_modules/@solana/web3.js/lib/index.browser.esm.js"),m=t("../../../node_modules/base64-js/index.js"),p=t("../../../node_modules/bs58/index.js"),j=t.n(p),h=t("../../libs/shared/dist/context/solana/useDappSolanaConnection.js"),y=t("../../libs/shared/dist/features/transactionAnalysis/context/index.js"),x=t("../../libs/shared/dist/features/transactionFlow/hooks/index.js"),f=t("../../libs/shared/dist/features/dappCommunication/context/index.js"),g=t("../../libs/shared/dist/features/dappCommunication/utils/index.js"),b=t("../../../node_modules/console-browserify/index.js");const A=({transactions:e,onSign:s,onReject:t})=>{const{t:p}=(0,i.$)(),A=(0,c.ZY)(e),{simulationResults:w,serializedTransactions:_,isLoading:v,queryKey:T}=(0,o.My)(A,"signAllTransactions"),C=(0,c.j2)({queryKey:T}),{sign:S,reject:k}=((e,s,t,n)=>{const{getSendConnection:i}=(0,h.U)(),a=(0,x.mx)(),{origin:r}=(0,f.N)(),{sendMultipleTransactions:o}=(0,x.pQ)(),{isBlockhashExpiredRef:d}=(0,y.C)(),c=async()=>{await(n?.({type:"reject"})),t()};return{sign:async({autoApprove:t}={})=>{try{const c=e.map((e=>(0,m.toByteArray)(e))),l=await(0,g.mW)(a,c.map(j().encode));if(d.current)return;try{const e=l.map((e=>u.VersionedTransaction.deserialize(j().decode(e)))),s=i({origin:r??"",autoApprove:t??!1,method:"sign"});await o({connection:s,transactions:e})}catch{b.log("failed to send transactions")}await(n?.({type:"sign",autoApprove:t})),s(l)}catch(e){if(d.current)return;await c()}},reject:c}})(_,s,t,C);return(0,l.d)((()=>S({autoApprove:!0}))),(0,n.jsx)(r.BY,{title:(0,n.jsx)(a.PageTitle,{center:p("approve_transaction_few")}),simulationResults:w,isLoading:v,onReject:k,onApprove:S,analysisPreview:(0,d.Zb)(w)&&(0,n.jsx)(a.TXSimulationList,{children:w.transactions.map(((e,s)=>(0,n.jsx)(r.ND,{transaction:e,rawTransaction:_[s]},s)))})})}},"../../libs/shared/dist/features/dappCommunication/components/SignAllTransactionMessages/index.js":(e,s,t)=>{t.d(s,{O:()=>A});var n=t("../../../node_modules/react/jsx-runtime.js"),i=t("../../../node_modules/react-i18next/dist/es/useTranslation.js"),a=t("../../libs/foundation-ui/dist/index.js"),r=t("../../libs/shared/dist/features/transactionAnalysis/components/index.js"),o=t("../../libs/shared/dist/features/transactionAnalysis/queries/index.js"),d=t("../../libs/shared/dist/features/transactionAnalysis/utils/index.js"),c=t("../../libs/shared/dist/features/dappCommunication/hooks/index.js"),l=t("../../libs/shared/dist/features/dappCommunication/hooks/useAutoApprove.js"),u=t("../../../node_modules/react/index.js"),m=t("../../../node_modules/@solana/web3.js/lib/index.browser.esm.js"),p=t("../../../node_modules/base64-js/index.js"),j=t("../../../node_modules/bs58/index.js"),h=t.n(j),y=t("../../libs/shared/dist/context/solana/useDappSolanaConnection.js"),x=t("../../libs/shared/dist/features/transactionAnalysis/context/index.js"),f=t("../../libs/shared/dist/features/transactionFlow/hooks/index.js"),g=t("../../libs/shared/dist/features/dappCommunication/context/index.js"),b=t("../../libs/shared/dist/features/dappCommunication/utils/index.js");const A=({messages:e,onSign:s,onReject:t})=>{const{t:j}=(0,i.$)(),A=(0,c.bL)(e),{simulationResults:w,isLoading:_,queryKey:v}=(0,o.mG)(A,"signAllTransactions"),T=(0,c.j2)({queryKey:v}),{sign:C,reject:S,transactions:k}=((e,s,t,n)=>{const{getSendConnection:i}=(0,y.U)(),a=(0,f.mx)(),{origin:r}=(0,g.N)(),{sendMultipleTransactions:o}=(0,f.pQ)(),{isBlockhashExpiredRef:d}=(0,x.C)(),c=(0,u.useMemo)((()=>e.reduce(((e,s)=>{const t=m.VersionedMessage.deserialize((0,p.toByteArray)(s)),n=new m.VersionedTransaction(t);return[...e,(0,p.fromByteArray)(n.serialize())]}),[])),[e]),l=async()=>{await(n?.({type:"reject"})),t()};return{sign:async({autoApprove:t}={})=>{try{const c=e.map((e=>(0,p.toByteArray)(e))),l=await(0,b.Se)(a,c.map((e=>h().encode(e))));if(d.current)return;try{const e=c.map(((e,s)=>{const t=m.VersionedMessage.deserialize(e),n=new m.VersionedTransaction(t);return n.addSignature(new m.PublicKey(a.publicKey),h().decode(l[s])),n})),s=i({origin:r??"",autoApprove:t??!1,method:"sign"});await o({connection:s,transactions:e})}catch{}await(n?.({type:"sign",autoApprove:t})),s(l)}catch(e){if(d.current)return;await l()}},reject:l,transactions:c}})(A,s,t,T);return(0,l.d)((()=>C({autoApprove:!0}))),(0,n.jsx)(r.BY,{title:(0,n.jsx)(a.PageTitle,{center:j("approve_transaction_few")}),simulationResults:w,isLoading:_,onReject:S,onApprove:C,analysisPreview:(0,d.Zb)(w)&&(0,n.jsx)(a.TXSimulationList,{children:w.transactions.map(((e,s)=>(0,n.jsx)(r.ND,{transaction:e,rawTransaction:k[s]},s)))})})}},"../../libs/shared/dist/features/dappCommunication/components/SignAndSendSerializedTransaction/index.js":(e,s,t)=>{t.d(s,{$:()=>g});var n=t("../../../node_modules/react/jsx-runtime.js"),i=t("../../../node_modules/react-i18next/dist/es/useTranslation.js"),a=t("../../libs/foundation-ui/dist/index.js"),r=t("../../libs/shared/dist/features/transactionAnalysis/components/index.js"),o=t("../../libs/shared/dist/features/transactionAnalysis/queries/index.js"),d=t("../../libs/shared/dist/features/transactionAnalysis/utils/index.js"),c=t("../../libs/shared/dist/features/dappCommunication/hooks/index.js"),l=t("../../libs/shared/dist/features/dappCommunication/hooks/useAutoApprove.js"),u=t("../../../node_modules/base64-js/index.js"),m=t("../../../node_modules/bs58/index.js"),p=t.n(m),j=t("../../libs/shared/dist/context/solana/useDappSolanaConnection.js"),h=t("../../libs/shared/dist/features/transactionAnalysis/context/index.js"),y=t("../../libs/shared/dist/features/transactionFlow/hooks/index.js"),x=t("../../libs/shared/dist/features/dappCommunication/context/index.js"),f=t("../../libs/shared/dist/features/dappCommunication/utils/index.js");const g=({transaction:e,sendOptions:s,onSign:t,onReject:m})=>{const{t:g}=(0,i.$)(),b=(0,c.ZY)(e),{simulationResults:A,serializedTransactions:w,isLoading:_,queryKey:v}=(0,o.My)(b,"signAndSendTransaction"),T=(0,c.j2)({queryKey:v}),{signAndSend:C,reject:S}=((e,s,t,n,i)=>{const a=(0,y.mx)(),{getSendConnection:r}=(0,j.U)(),{origin:o}=(0,x.N)(),{isBlockhashExpiredRef:d}=(0,h.C)(),c=async e=>{await(i?.({type:"reject"})),n(e)};return{signAndSend:async({autoApprove:n}={})=>{try{const c=await(0,f.pE)(a,p().encode((0,u.toByteArray)(e)));if(d.current)return;const l=await r({origin:o??"",autoApprove:n??!1,method:"signAndSend"}).sendRawTransaction(p().decode(c),s);await(i?.({type:"sign",autoApprove:n})),t(l)}catch(e){if(d.current)return;await c(e?.message)}},reject:c}})(w[0],s,t,m,T);return(0,l.d)((()=>C({autoApprove:!0}))),(0,n.jsx)(r.BY,{title:(0,n.jsx)(a.PageTitle,{center:g("approve_transaction_one")}),simulationResults:A,isLoading:_,onReject:S,onApprove:C,analysisPreview:(0,d.Zb)(A)&&(0,n.jsx)(a.TXSimulationList,{children:A.transactions.map(((e,s)=>(0,n.jsx)(r.ND,{transaction:e,rawTransaction:w[s]},s)))})})}},"../../libs/shared/dist/features/dappCommunication/components/SignMessage/index.js":(e,s,t)=>{t.d(s,{Q:()=>_});var n=t("../../../node_modules/react/jsx-runtime.js"),i=t("../../../node_modules/react/index.js"),a=t("../../../node_modules/react-i18next/dist/es/useTranslation.js"),r=t("../../../node_modules/base64-js/index.js"),o=t("../../libs/foundation-ui/dist/index.js"),d=t("../../../node_modules/lodash/lodash.js"),c=t("../../libs/shared/dist/features/transactionAnalysis/components/index.js"),l=t("../../libs/shared/dist/features/transactionAnalysis/queries/index.js"),u=t("../../libs/shared/dist/features/transactionAnalysis/types.js"),m=t("../../libs/shared/dist/features/dappCommunication/hooks/index.js"),p=t("../../libs/shared/dist/features/dappCommunication/hooks/useAutoApprove.js"),j=t("../../../node_modules/bs58/index.js"),h=t.n(j),y=t("../../../node_modules/uuid/dist/esm-browser/v4.js"),x=t("../../libs/shared/dist/storage/solflareService.js"),f=t("../../libs/shared/dist/features/transactionAnalysis/context/index.js"),g=t("../../libs/shared/dist/features/transactionFlow/hooks/index.js"),b=t("../../libs/shared/dist/features/dappCommunication/context/index.js"),A=t("../../libs/shared/dist/features/dappCommunication/utils/index.js");var w=t("../../libs/shared/dist/features/dappCommunication/components/MessageAnalysisLoading/index.js");const _=({message:e,display:s,onSign:t,onReject:j})=>{const{t:_}=(0,a.$)(),v=(0,i.useMemo)((()=>{try{return(0,r.fromByteArray)(function(e){if(e.length)return Uint8Array.from(e);{const s=(0,d.max)((0,d.keys)(e).map((e=>parseInt(e,10))))||0;return Uint8Array.from({...e,length:s+1})}}(e))}catch{return""}}),[e]),{isLoading:T,simulationResults:C,isTransactionDetected:S,queryKey:k}=(0,l.cK)(v),B=(0,m.j2)({queryKey:k}),{sign:R,reject:M,decodedMessage:E}=((e,s,t,n,o)=>{const d=(0,g.mx)(),{t:c}=(0,a.$)(),{origin:l,title:u}=(0,b.N)(),{isBlockhashExpiredRef:m}=(0,f.C)(),p=(0,i.useMemo)((()=>(0,A.my)((0,r.toByteArray)(e),s)??c("error_unable_to_decode_message")),[s,e,c]),j=async()=>{await(o?.({type:"reject"})),n()};return{sign:async()=>{try{if((0,A.nO)((0,r.toByteArray)(e)))throw new Error("Transaction detected");const n=await(0,A.l)(d,h().encode((0,r.toByteArray)(e)));if(m.current)return;await(async({message:e,origin:s,title:t})=>{const n=await x.Z.solflaresigneddata.get()||[],i=(0,y.Z)();return n.length>100&&n.shift(),n.push({id:i,message:e,origin:s,title:t,timestamp:Math.floor(+new Date/1e3)}),x.Z.solflaresigneddata.set(n)})({message:(0,A.my)((0,r.toByteArray)(e),s)??"",origin:l,title:u}),await(o?.({type:"sign"})),t(n)}catch(e){if(m.current)return;j()}},reject:j,decodedMessage:p}})(v,s,t,j,B);return(0,p.d)(R),(0,n.jsx)(c.W2,{title:(0,n.jsx)(o.PageTitle,{center:_("transaction_sign_message")}),children:S?(0,n.jsx)(c.RD,{alerts:[{key:u.s.INVALID_TRANSACTION,severity:"error",title:_("transaction_scam_site_detected_title"),message:_("transaction_scam_site_detected_message")}],onReject:M}):T?(0,n.jsx)(w.K,{}):(0,n.jsx)(c.Nr,{simulationResults:C,onApprove:R,onReject:M,analysisPreview:(0,n.jsx)(o.TXSimulationList,{children:(0,n.jsx)(o.Section,{variant:"m",children:(0,n.jsx)(o.TXMessage,{title:(0,n.jsx)(o.SectionTitle,{title:_("transaction_message"),tooltip:(0,n.jsx)(o.InfoWithTooltip,{tooltip:_("transaction_message_tooltip")})}),children:(0,n.jsx)(o.Paragraph,{children:E})})})})})})}},"../../libs/shared/dist/features/dappCommunication/components/SignSerializedTransaction/index.js":(e,s,t)=>{t.d(s,{b:()=>g});var n=t("../../../node_modules/react/jsx-runtime.js"),i=t("../../../node_modules/react-i18next/dist/es/useTranslation.js"),a=t("../../libs/foundation-ui/dist/index.js"),r=t("../../libs/shared/dist/features/transactionAnalysis/components/index.js"),o=t("../../libs/shared/dist/features/transactionAnalysis/queries/index.js"),d=t("../../libs/shared/dist/features/transactionAnalysis/utils/index.js"),c=t("../../libs/shared/dist/features/dappCommunication/hooks/index.js"),l=t("../../libs/shared/dist/features/dappCommunication/hooks/useAutoApprove.js"),u=t("../../../node_modules/base64-js/index.js"),m=t("../../../node_modules/bs58/index.js"),p=t.n(m),j=t("../../libs/shared/dist/context/solana/useDappSolanaConnection.js"),h=t("../../libs/shared/dist/features/transactionAnalysis/context/index.js"),y=t("../../libs/shared/dist/features/transactionFlow/hooks/index.js"),x=t("../../libs/shared/dist/features/dappCommunication/context/index.js"),f=t("../../libs/shared/dist/features/dappCommunication/utils/index.js");const g=({transaction:e,onSign:s,onReject:t})=>{const{t:m}=(0,i.$)(),g=(0,c.ZY)(e),{isLoading:b,simulationResults:A,serializedTransactions:w,queryKey:_}=(0,o.My)(g,"signTransaction"),v=(0,c.j2)({queryKey:_}),{sign:T,reject:C}=((e,s,t,n)=>{const i=(0,y.mx)(),{getSendConnection:a}=(0,j.U)(),{origin:r}=(0,x.N)(),{isBlockhashExpiredRef:o}=(0,h.C)(),d=async()=>{await(n?.({type:"reject"})),t()};return{sign:async({autoApprove:t}={})=>{try{const d=await(0,f.pE)(i,p().encode((0,u.toByteArray)(e)));if(o.current)return;try{await a({origin:r??"",autoApprove:t??!1,method:"sign"}).sendRawTransaction(p().decode(d))}catch{}await(n?.({type:"sign",autoApprove:t})),s(d,{autoApprove:t})}catch(e){if(o.current)return;await d()}},reject:d}})(w[0],s,t,v);return(0,l.d)((()=>T({autoApprove:!0}))),(0,n.jsx)(r.BY,{title:(0,n.jsx)(a.PageTitle,{center:m("approve_transaction_one")}),simulationResults:A,isLoading:b,onApprove:T,onReject:C,analysisPreview:(0,d.Zb)(A)&&(0,n.jsx)(a.TXSimulationList,{children:A.transactions.map(((e,s)=>(0,n.jsx)(r.ND,{transaction:e,rawTransaction:w[0]},s)))})})}},"../../libs/shared/dist/features/dappCommunication/components/SignTransactionMessage/index.js":(e,s,t)=>{t.d(s,{J:()=>A});var n=t("../../../node_modules/react/jsx-runtime.js"),i=t("../../../node_modules/react-i18next/dist/es/useTranslation.js"),a=t("../../libs/foundation-ui/dist/index.js"),r=t("../../libs/shared/dist/features/transactionAnalysis/components/index.js"),o=t("../../libs/shared/dist/features/transactionAnalysis/queries/index.js"),d=t("../../libs/shared/dist/features/transactionAnalysis/utils/index.js"),c=t("../../libs/shared/dist/features/dappCommunication/hooks/index.js"),l=t("../../libs/shared/dist/features/dappCommunication/hooks/useAutoApprove.js"),u=t("../../../node_modules/react/index.js"),m=t("../../../node_modules/@solana/web3.js/lib/index.browser.esm.js"),p=t("../../../node_modules/base64-js/index.js"),j=t("../../../node_modules/bs58/index.js"),h=t.n(j),y=t("../../libs/shared/dist/context/solana/useDappSolanaConnection.js"),x=t("../../libs/shared/dist/features/transactionAnalysis/context/index.js"),f=t("../../libs/shared/dist/features/transactionFlow/hooks/index.js"),g=t("../../libs/shared/dist/features/dappCommunication/context/index.js"),b=t("../../libs/shared/dist/features/dappCommunication/utils/index.js");const A=({message:e,onSign:s,onReject:t})=>{const{t:j}=(0,i.$)(),A=(0,c.bL)(e),{simulationResults:w,isLoading:_,queryKey:v}=(0,o.mG)(A,"signTransaction"),T=(0,c.j2)({queryKey:v}),{sign:C,reject:S,transaction:k}=((e,s,t,n)=>{const{getSendConnection:i}=(0,y.U)(),a=(0,f.mx)(),{origin:r}=(0,g.N)(),{isBlockhashExpiredRef:o}=(0,x.C)(),d=(0,u.useMemo)((()=>{if(!e)return"";const s=m.VersionedMessage.deserialize((0,p.toByteArray)(e)),t=new m.VersionedTransaction(s);return(0,p.fromByteArray)(t.serialize())}),[e]),c=async()=>{await(n?.({type:"reject"})),t()};return{sign:async({autoApprove:t}={})=>{try{const d=(0,p.toByteArray)(e),c=await(0,b.XO)(a,h().encode(d));if(o.current)return;try{const e=m.VersionedMessage.deserialize(d),s=new m.VersionedTransaction(e);s.addSignature(new m.PublicKey(a.publicKey),h().decode(c));const n=i({origin:r??"",autoApprove:t??!1,method:"sign"});await n.sendRawTransaction(s.serialize())}catch{}await(n?.({type:"sign",autoApprove:t})),s(c)}catch(e){if(o.current)return;await c()}},reject:c,message:e,transaction:d}})(A[0],s,t,T);return(0,l.d)((()=>C({autoApprove:!0}))),(0,n.jsx)(r.BY,{title:(0,n.jsx)(a.PageTitle,{center:j("approve_transaction_one")}),simulationResults:w,isLoading:_,onReject:S,onApprove:C,analysisPreview:(0,d.Zb)(w)&&(0,n.jsx)(a.TXSimulationList,{children:w.transactions.map(((e,s)=>(0,n.jsx)(r.ND,{transaction:e,rawTransaction:k},s)))})})}},"../../libs/shared/dist/features/dappCommunication/constants.js":(e,s,t)=>{t.d(s,{R:()=>n});const n=.001},"../../libs/shared/dist/features/dappCommunication/hooks/index.js":(e,s,t)=>{t.d(s,{bL:()=>f,ZY:()=>g,j2:()=>j});var n=t("../../../node_modules/react/index.js"),i=t("../../../node_modules/@tanstack/react-query/build/lib/QueryClientProvider.mjs"),a=t("../../../node_modules/lodash/lodash.js"),r=t("../../libs/shared/dist/constants/mints.js"),o=t("../../libs/shared/dist/features/featureFlags/index.js"),d=t("../../libs/shared/dist/features/shared/autoApproveApps/index.js"),c=t("../../libs/shared/dist/features/shared/autoApproveApps/utils/isHostInAllowedAutoApprovedList.js"),l=t("../../libs/shared/dist/features/transactionAnalysis/types.js"),u=t("../../libs/shared/dist/features/transactionAnalysis/utils/index.js"),m=t("../../libs/shared/dist/features/dappCommunication/constants.js"),p=t("../../libs/shared/dist/features/dappCommunication/context/index.js");const j=({queryKey:e})=>{const s=(0,i.NL)(),{origin:t,host:j,blinkUrl:h}=(0,p.N)();(0,d.L)();const y=(0,n.useCallback)((async({autoApprove:n})=>{const i=s.getQueryState(e),d=s.getQueryData(["allowedAutoApproveApps"])??[],p=(0,c.y)(j,d),y={dappUrl:t,autoApprove:n,isDappOnAutoApproveList:p};if(i&&"loading"!==i.status){const s=i.data;(0,u.Zb)(s)?(e.includes("message-simulation")||(y.isFinancialTransaction=s.transactions.some((e=>{if((0,a.isEmpty)(e.changes))return!1;if(e.changes.filter((e=>(0,u.FO)(e.amount))).length>1)return!0;const s=e.changes[0].amount;return!!((0,u.FO)(s)&&s?.mint===r.BH&&Math.abs(+s?.amount)>m.R)})),y.isSimulationSuccessful=s.transactions.every((e=>!e.isFailedSimulation)),y.numberOfTokenDelegations=s.meta.countTokenDelegations,y.numberOfStakeDelegations=s.meta.countStakingChanges,y.numberOfNftDelegations=s.meta.countNftDelegations,y.networkFeeInSol=(0,a.sumBy)(s.transactions,(e=>e.networkFee?+e.networkFee.amount:0)),y.maliciousPossible=s.transactions.some((e=>e.alerts.some((e=>e.key===l.s.MALICIOUS_POSSIBLE))))||s.alerts.some((e=>e.key===l.s.MALICIOUS_POSSIBLE)),y.insufficientFunds=s.transactions.some((e=>e.alerts.some((e=>e.key===l.s.INSUFFICIENT_FUNDS)))),y.insufficientSol=s.transactions.some((e=>e.alerts.some((e=>e.key===l.s.INSUFFICIENT_SOL)))),y.hasSlippageError=s.transactions.some((e=>e.alerts.some((e=>e.key===l.s.SLIPPAGE_ERROR)))),y.numberOfWritableAccounts=s.meta.countWritable),y.isToggleDisplayed=!!s.actionText,y.didSecurityVerificationFail=(0,u.AB)(s),y.didDynamicVerificationFail=!1):(0,u.$u)(s)?(y.isToggleDisplayed=!0,y.didSecurityVerificationFail=!1,y.didDynamicVerificationFail=!0):(y.isToggleDisplayed=!0,y.didSecurityVerificationFail=!0,y.didDynamicVerificationFail=!0)}await(0,o.Or)(y),h&&""!==h.trim()&&await(0,o.Yk)({blinkUrl:h,dappUrl:t,autoApprove:n})}),[h,j,t,s,e]);return(0,n.useCallback)((async e=>{const s="sign"===e.type&&(e.autoApprove??!1);try{await y({autoApprove:s})}catch{}}),[y])};var h=t("../../../node_modules/base64-js/index.js"),y=t("../../../node_modules/bs58/index.js"),x=t.n(y);const f=e=>(0,n.useMemo)((()=>(Array.isArray(e)?e:[e]).map((e=>{try{const s=x().decode(e);return(0,u.XH)(s),(0,h.fromByteArray)(s)}catch(e){return null}})).filter(Boolean)),[e]),g=e=>(0,n.useMemo)((()=>(Array.isArray(e)?e:[e]).map((e=>{try{const s=x().decode(e);return(0,u.EA)(s),(0,h.fromByteArray)(s)}catch(e){return null}})).filter(Boolean)),[e])},"../../libs/shared/dist/features/dappCommunication/hooks/useAutoApprove.js":(e,s,t)=>{t.d(s,{d:()=>d});var n=t("../../../node_modules/react/index.js"),i=t("../../libs/wallet-core/dist/shared.js"),a=t("../../libs/shared/dist/storage/solflareService.js"),r=t("../../libs/shared/dist/features/walletData/hooks/index.js"),o=t("../../libs/shared/dist/features/dappCommunication/context/index.js");const d=e=>{const{origin:s}=(0,o.N)(),{publicKey:t,walletType:d}=(0,r.rT)();(0,n.useEffect)((()=>{d!==i.CO&&d!==i.R7&&d!==i.vn||(async()=>{const n=await a.Z.solflaretrustedappsperwallet.get(),i=n[t]?.[s];i?.autoApprove&&e()})()}),[d])}},"../../libs/shared/dist/features/dappCommunication/modals/BlockedOriginModal/index.js":(e,s,t)=>{t.d(s,{a:()=>o});var n=t("../../../node_modules/react/jsx-runtime.js"),i=t("../../../node_modules/@fortawesome/pro-light-svg-icons/index.mjs"),a=t("../../libs/foundation-ui/dist/index.js"),r=t("../../libs/shared/dist/components/index.js");const o=({host:e,title:s,onReject:t})=>(0,n.jsx)(a.PagePortal,{size:"fullPage",children:(0,n.jsxs)(a.FullPageConfirm,{children:[(0,n.jsx)(a.PageTitle,{center:"Unsafe Website Blocked"}),(0,n.jsxs)(a.PageContent,{gap:"l",children:[(0,n.jsx)(a.AppInteractionHero,{title:s||e,subtitle:s?e:void 0,avatar:(0,n.jsx)(r.iB,{host:e,size:"l"})}),(0,n.jsx)(a.TxErrorMessage,{actions:(0,n.jsx)(a.Button,{onClick:()=>window.open("https://academy.solflare.com/guides/?get_help=true","_blank"),size:"s",variant:"tertiary",left:(0,n.jsx)(a.Icon,{icon:i.gJF}),children:"Contact support"}),children:(0,n.jsx)(a.Paragraph,{children:"For your safety, we've prevented access to this website. It's flagged on the community-maintained list of scam and phishing websites."})}),(0,n.jsx)(a.FooterActions,{variant:"inContent",children:(0,n.jsx)(a.ButtonGroup,{children:(0,n.jsx)(a.Button,{onClick:()=>t(),children:"Back to safety"})})})]})]})})},"../../libs/shared/dist/features/dappCommunication/utils/decodeSignMessage.js":(e,s,t)=>{t.d(s,{m:()=>n});const n=(e,s="utf8")=>{return"utf8"===s?(new TextDecoder).decode(e):"hex"===s?`0x${t=e,Array.prototype.map.call(t,(e=>`00${e.toString(16)}`.slice(-2))).join("")}`:void 0;var t}},"../../libs/shared/dist/features/dappCommunication/utils/index.js":(e,s,t)=>{t.d(s,{my:()=>n.m,nO:()=>o,mW:()=>d,Se:()=>c,l:()=>l,pE:()=>u,XO:()=>m});var n=t("../../libs/shared/dist/features/dappCommunication/utils/decodeSignMessage.js"),i=t("../../../node_modules/@solana/web3.js/lib/index.browser.esm.js"),a=(t("../../../node_modules/base64-js/index.js"),t("../../../node_modules/bs58/index.js")),r=t.n(a);const o=e=>{try{const s=i.VersionedMessage.deserialize(e);return!!s&&s.header?.numRequiredSignatures<=64&&!!s.recentBlockhash&&s.compiledInstructions?.length>0}catch(e){return!1}},d=async(e,s)=>{if(!e.publicKey)throw new Error("Wallet not connected");const t=s.map((e=>i.VersionedTransaction.deserialize(r().decode(e)))),n=await e.signAllTransactions(t.map((e=>e.message.serialize())));if(!n)throw new Error("Transactions rejected");return t.map(((s,t)=>(s.addSignature(new i.PublicKey(e.publicKey),n[t]),s))).map((e=>r().encode(e.serialize())))},c=async(e,s)=>{if(!e.publicKey)throw new Error("Wallet not connected");const t=await e.signAllTransactions(s.map((e=>r().decode(e))));if(!t)throw new Error("Transaction rejected");return t.map((e=>r().encode(e)))},l=async(e,s)=>{if(!e.publicKey)throw new Error("Wallet not connected");const t=await e.signMessage(r().decode(s));if(!t)throw new Error("Transaction rejected");return r().encode(t)},u=async(e,s)=>{if(!e.publicKey)throw new Error("Wallet not connected");const t=i.VersionedTransaction.deserialize(r().decode(s)),n=await e.signTransaction(t.message.serialize());if(!n)throw new Error("Transaction rejected");return t.addSignature(new i.PublicKey(e.publicKey),n),r().encode(t.serialize())},m=async(e,s)=>{if(!e.publicKey)throw new Error("Wallet not connected");const t=await e.signTransaction(r().decode(s));if(!t)throw new Error("Transaction rejected");return r().encode(t)}},"../../libs/shared/dist/features/recentAddresses/constants.js":(e,s,t)=>{t.d(s,{x:()=>n});const n=30},"../../libs/shared/dist/features/transactionAnalysis/components/index.js":(e,s,t)=>{t.d(s,{BY:()=>n.B,ND:()=>i.N,Nr:()=>o.N,RD:()=>r.R,W2:()=>a.W});var n=t("../../libs/shared/dist/features/transactionAnalysis/components/AnalysisRenderer/index.js"),i=t("../../libs/shared/dist/features/transactionAnalysis/components/DynamicAnalysisTransaction/index.js"),a=t("../../libs/shared/dist/features/transactionAnalysis/components/Container/index.js"),r=t("../../libs/shared/dist/features/transactionAnalysis/components/AnalysisBlockedAction/index.js"),o=t("../../libs/shared/dist/features/transactionAnalysis/components/AnalysisRendererContent/index.js")},"../../libs/shared/dist/features/transactionAnalysis/context/blockhashExpired/index.js":(e,s,t)=>{t.d(s,{C:()=>c,y:()=>d});var n=t("../../../node_modules/react/jsx-runtime.js"),i=t("../../../node_modules/react/index.js"),a=t("../../libs/shared/dist/features/transactionFlow/context/index.js"),r=t("../../libs/shared/dist/features/transactionAnalysis/constants.js");const o=(0,i.createContext)(null),d=({resetKey:e,timerEnabled:s,children:t})=>{const[d,c]=(0,i.useState)(!1),l=(0,i.useRef)(!1),{setIsLedgerPending:u,setIsKeystonePending:m}=(0,a.p)();(0,i.useEffect)((()=>{if(c(!1),l.current=!1,!s)return;const e=setInterval((()=>{l.current=!0,c(!0),u(!1),m(!1)}),r.t);return()=>{clearInterval(e)}}),[e,m,u,s]);const p=(0,i.useMemo)((()=>({isBlockhashExpired:d,isBlockhashExpiredRef:l})),[d]);return(0,n.jsx)(o.Provider,{value:p,children:t})},c=()=>{const e=(0,i.useContext)(o);if(null===e)throw new Error("useBlockhashExpired must be used within a BlockhashExpiredProvider");return e}},"../../libs/shared/dist/features/transactionAnalysis/queries/index.js":(e,s,t)=>{t.d(s,{cK:()=>x,mG:()=>j.m,My:()=>p});var n=t("../../../node_modules/react/index.js"),i=t("../../../node_modules/@tanstack/react-query/build/lib/useQuery.mjs"),a=t("../../../node_modules/lodash/lodash.js"),r=t("../../libs/shared/dist/features/currencies/hooks/index.js"),o=t("../../libs/shared/dist/features/dappCommunication/context/index.js"),d=t("../../libs/shared/dist/features/globalConfig/hooks/index.js"),c=t("../../libs/shared/dist/features/settings/index.js"),l=t("../../libs/shared/dist/features/walletData/hooks/index.js"),u=t("../../libs/shared/dist/features/transactionAnalysis/api/index.js"),m=t("../../libs/shared/dist/features/transactionAnalysis/utils/index.js");const p=(e,s,t=!0)=>{const{publicKey:p}=(0,l.rT)(),j=(0,d.LN)(),h=(0,r.Af)(),{current:y}=(0,c.ix)(),{host:x}=(0,o.N)(),f=(0,n.useMemo)((()=>["transactions-simulation",p,j,x,e]),[p,j,x,e]),{data:g,isLoading:b,isError:A,error:w,refetch:_}=(0,i.a)({queryKey:f,queryFn:async()=>(0,u.J)({transactions:e.map((e=>({payload:e,type:"wireTransaction"}))),method:s,publicKey:p,cluster:j.cluster,host:x??"",currency:h.ticker,language:y}),retry:!1,enabled:!(0,a.isEmpty)(e)&&!(0,a.isEmpty)(e[0])&&!!x&&t}),v=(0,n.useMemo)((()=>{try{return(0,m.Zb)(g)?g.transactions.map((e=>e.enrichedTx)):e}catch{return e}}),[g,e]);return{error:w,isError:A,isLoading:b,simulationResults:g,serializedTransactions:v,refetch:_,queryKey:f}};var j=t("../../libs/shared/dist/features/transactionAnalysis/queries/useTransactionMessagesAnalysisQuery.js"),h=t("../../../node_modules/base64-js/index.js"),y=t("../../libs/shared/dist/features/dappCommunication/utils/index.js");const x=e=>{const{publicKey:s}=(0,l.rT)(),t=(0,d.LN)(),m=(0,r.Af)(),{current:p}=(0,c.ix)(),{host:j}=(0,o.N)(),x=(0,n.useMemo)((()=>(0,y.nO)((0,h.toByteArray)(e))),[e]),f=(0,n.useMemo)((()=>["message-simulation",s,t,j,e]),[j,e,t,s]),{data:g,isLoading:b,isError:A,error:w,refetch:_}=(0,i.a)({queryKey:f,queryFn:()=>(0,u.J)({transactions:[{payload:e,type:"compiledMessage"}],method:"signMessage",publicKey:s,cluster:t.cluster,host:j??"",currency:m.ticker,language:p}),retry:!1,enabled:!x&&!(0,a.isEmpty)(e)&&!!j});return{error:w,isError:A,isLoading:b,simulationResults:g,refetch:_,isTransactionDetected:x,queryKey:f}}},"../../libs/shared/dist/features/transactionAnalysis/utils/index.js":(e,s,t)=>{t.d(s,{M3:()=>i,FO:()=>a,TX:()=>l,$u:()=>c,O9:()=>r,Zb:()=>o,AB:()=>d,EA:()=>m,XH:()=>u});var n=t("../../../node_modules/@solana/web3.js/lib/index.browser.esm.js");const i=e=>e?"object"==typeof e?`${e.amount}${e.symbol?` ${e.symbol}`:""}`:e??"":"",a=e=>!!e?.amount,r=e=>!!e,o=e=>r(e)&&(0===e.errors.length||e.errors.every((e=>"static_simulation_failed"===e))),d=e=>o(e)&&e.errors.includes("static_simulation_failed"),c=e=>r(e)&&e.errors.every((e=>"dynamic_simulation_failed"===e)),l=e=>!r(e)&&!c(e),u=e=>{try{return n.VersionedMessage.deserialize(e).serialize(),!0}catch{throw new Error("Invalid transaction message")}},m=e=>{try{return n.VersionedTransaction.deserialize(e).serialize(),!0}catch{throw new Error("Invalid transaction")}}},"../../libs/shared/dist/features/transactionFlow/components/LedgerConfirm/index.js":(e,s,t)=>{t.d(s,{D:()=>c});var n=t("../../../node_modules/react/jsx-runtime.js"),i=t("../../../node_modules/react-i18next/dist/es/useTranslation.js"),a=t("../../../node_modules/@emotion/styled/dist/emotion-styled.browser.esm.js"),r=t("../../libs/foundation-ui/dist/index.js"),o=t("../../libs/shared/dist/assets/ledger-confirm.svg");const d=a.Z.img`
  width: 150px;
  margin: 24px auto 0 auto;
`,c=({title:e})=>{const{t:s}=(0,i.$)();return(0,n.jsxs)(r.PageContent,{children:[(0,n.jsx)(r.PageTitle,{center:e||s("confirm_transaction_title")}),(0,n.jsx)(r.Typography,{variant:"textM",alignCenter:!0,children:s("approve_ledger_transaction")}),(0,n.jsx)(d,{src:o,alt:"Ledger"})]})}},"../../libs/shared/dist/features/transactionFlow/utils/index.js":(e,s,t)=>{t.d(s,{g:()=>i.g,l:()=>n.l});var n=t("../../libs/shared/dist/features/transactionFlow/utils/snackbar.js"),i=t("../../libs/shared/dist/features/transactionFlow/utils/confirmTransaction.js")},"../../libs/shared/dist/hooks/useSearchMultiple.js":(e,s,t)=>{t("../../../node_modules/react/index.js"),t("../../../node_modules/lodash/lodash.js")},"../../libs/shared/dist/hooks/useStorageItem.js":(e,s,t)=>{t("../../../node_modules/react/index.js"),t("../../libs/shared/dist/storage/solflareService.js")},"../../libs/shared/dist/utils/resolveResizableImage.js":(e,s,t)=>{t.d(s,{r:()=>c});var n=t("../../../node_modules/axios/lib/axios.js"),i=t("../../libs/shared/dist/utils/getResizedImageUrl.js");const a=["image/png","image/jpeg","image/webp","image/gif","image/svg+xml"],r={width:100,maxBytes:10485760},o=new Map,d=async e=>await new Promise((s=>{const t=new Image;t.onload=()=>{s(e)},t.onerror=()=>{s(null)},t.src=e})),c=async(e,s)=>{if(!e)return;if(e.startsWith("data:"))return e;const t={...r,...s||{}},c=`width=${t.width};maxBytes=${t.maxBytes};${e}`;if(o.has(c))return o.get(c)||void 0;let l,u=NaN;try{const s=await n.Z.head(e);u=parseInt(s.headers["content-length"],10),l=s.headers["content-type"]}catch(e){}if(!l||a.includes(l)){const s=await d((0,i.N)(e,{width:t.width}));if(s)return o.set(c,s),s}if(!u||u<=t.maxBytes){const s=await d(e);if(s)return o.set(c,s),s}o.set(c,null)}},"../../libs/shared/dist/assets/ledger-confirm.svg":(e,s,t)=>{e.exports=t.p+"assets/ledger-confirm.3f00ff7f..svg"}}]);
//# sourceMappingURL=libs_shared_dist_features_dappCommunication_components_SignAllSerializedTransactions_index_js-2cc0f9.js.map