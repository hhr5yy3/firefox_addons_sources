// Copyright 2023 OneTab Ltd.  All rights reserved.
const K=!1,X=!1,Q=!1,Y=!1,Z=!1,ee=!0,T=!!navigator.userAgent.match(/Mobile/i),te="about:",ne="about:blank";async function h(){return new Promise((e,t)=>{document.readyState==="complete"?e():document.addEventListener("readystatechange",n=>{document.readyState==="complete"&&e()})})}async function re(){if(T){let e=document.createElement("meta");e.name="viewport",e.content="width=400, initial-scale=1",document.getElementsByTagName("head")[0].appendChild(e)}await D(),await h(),setHtmlTagLanguageDirection()}async function D(){try{let e=await chrome.tabs.getCurrent();e&&await chrome.tabs.update(e.id,{autoDiscardable:!1})}catch(e){console.log(e)}}function oe(e){if(typeof e=="string"&&(e=document.getElementById(e)),!!e)for(;e.childNodes.length>0;)e.childNodes[0].remove()}function ie(e){return S(void 0,"div",{style:{fontSize:"1px",height:e+"px",width:"1px"}}).o}let x=!1;async function F(e,t={}){if(!x){const r=async()=>{if((await chrome.runtime.sendMessage({args:[],type:I.A,v:!0}))?.result?.pong!==String(currentVersion))throw new Error};try{await r()}catch{console.log("core not ready. retrying..."),await d(1e3);try{await r()}catch{console.log("core not ready. retrying..."),await d(5e3);try{await r()}catch{throw new Error("Cannot connect to core")}}}x=!0}t.type=e,t.v=!0;let n=await chrome.runtime.sendMessage(t);if(n===null)throw new Error("null message response from core");if(n?.C)throw new Error(n.C);return n.result}function ae(e){chrome.runtime.onMessage.addListener((t,n,r)=>{t.type==="stateChange"&&e(t.k)})}const I=new Proxy({},{get(e,t){return t}}),ce=new Proxy({},{get(e,t,n){return(...r)=>(r=w(r,void 0,W),F(t,{args:r}))}}),m=chrome.runtime.getURL("onetab.html"),y=m.substring(0,m.length-"onetab.html".length);let p=!1;async function se(){return p?(await chrome.permissions.getAll()).permissions.includes("tabGroups")&&chrome.tabGroups:!1}async function ue(){if(!p||requestTabGroupsPermissionIfNecessaryDisabled)return!1;try{return await chrome.permissions.request({permissions:["tabGroups"]})}catch(e){return console.log('chrome.permissions.request for "tabGroups" permission failed with error:'),console.log(e),!1}}function le(e){let t=b(e);return t.toLowerCase().startsWith("www.")?t.substring("www.".length):t}function b(e){return e?(e.indexOf("//")===0&&(e="http:"+e),e.indexOf("://")===-1&&(e="http://"+e),e=e.substring(e.indexOf("://")+"://".length),e.indexOf("/")!==-1&&(e=e.substring(0,e.indexOf("/"))),e.indexOf(":")!==-1&&(e=e.substring(0,e.indexOf(":"))),e.indexOf("?")!==-1&&(e=e.substring(0,e.indexOf("?"))),e.indexOf("#")!==-1&&(e=e.substring(0,e.indexOf("#"))),e.toLowerCase()):"undefined"}function fe(e){return e.indexOf("://")===-1?"https://":(e=e.substring(0,e.indexOf("://")+"://".length),e.toLowerCase())}let g=["com","co.uk","org.uk","net","org","de","ru","info","xyz","nl"];function de(e){let t=b(e);try{for(let n in g){let r="."+g[n];if(R(t,r)){for(t=t.substring(0,t.length-r.length);t.indexOf(".")!==-1;)t=t.substring(t.indexOf(".")+1);t=t+r;break}}return t.indexOf("www.")===0&&(t=t.substring("www.".length)),t}catch{return t}}function U(e){e.noCacheRandom=v()}function v(){return new Date().getTime()+Math.round(Math.random()*1e4)+""}async function we(e,t){U(t);let n=JSON.stringify(t);return await(await P(e,n)).json()}async function P(e,t){let n={};t?(n.method="POST",n.body=t):n.method="GET",n.headers=new Headers,n.headers.append("Content-Type","text/json");let r=await fetch(e,n);if(r.status===200)return r;throw new Error("http response code"+r.status)}function he(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,e=>{let t=Math.random()*16|0;return(e=="x"?t:t&3|8).toString(16)})}const A="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz-_".split("");function L(e,t){let n=A,r=[],o=0;for(t=t||n.length,e=e||22,o=0;o<e;o++)r[o]=n[0|Math.random()*t];return r.join("")}function M(){return L()}function xe(){return M()}function me(e){return e==null?"":e.replace(/^\s+/,"").replace(/\s+$/,"")}function ye(e,t){return e?.length>t&&(e=e.substring(0,t)+"…"),e}function pe(...e){return(t,n)=>e.reduce((r,o)=>r||o(t,n),0)}function be(e){return(t,n)=>e(t)-e(n)}function ge(e){return(t,n)=>e(n)-e(t)}const Se=(e,t)=>!!t.starred-!!e.starred||e.starred&&t.starred&&t.starredDate-e.starredDate||t.createDate-e.createDate;function Ee(e){return e||(e=""),e.replace(/[\x00-\x1F\x7F-\x9F]/g,"")}function R(e,t){return e?e.indexOf(t,e.length-t.length)!==-1:!1}const O={restoreWindow:"newWindow",pinnedTabs:"ignore",startupLaunch:"displayOneTab",restoreRemoval:"default",duplicates:"allow",pinned:"true"};function Ce(e,t){return t[e]?t[e]:O[e]}function Te(e,t,n){e.parentNode&&e.remove(),t.insertBefore(e,n===void 0||n>=t.children.length||t.children.length===0?null:t.children[Math.max(0,n)])}function j(e,t){return N("div",e,t)}function N(e,t,n){return S(void 0,e,t,n)}function S(e,t,n,r){let o=t===void 0?e:document.createElement(t),s={},c={};if(n){n.style&&Object.assign(o.style,n.style);for(let i of Object.keys(n))i!=="style"&&i!=="children"&&i!=="child"&&i!=="init"&&(o[i]=n[i]),(i==="role"||i==="placeholder")&&o.setAttribute(i,n[i]);if(n.children){let i=Object.entries(n.children);for(const[l,a]of i)a instanceof HTMLElement?o.appendChild(a):(o.appendChild(a?.p?.o??a.o),a.u&&(Object.assign(c,a.u),c[l]=a));for(const[l,a]of i)s[l]=a,c[l]=a}if(n.l){let i=n.l;s.l=i,o.appendChild(i instanceof HTMLElement?i:i?.p?.o??i.o)}}t!==void 0&&e&&e.appendChild(o);let u={o,u:c};return Object.assign(u,s),r&&Object.assign(u,r),n?.init&&n.init(u),u}const E="about:reader?url=";function De(e){return e?e.indexOf(":")===-1?"https://"+e:e.indexOf(E)===0?decodeURIComponent(e.substring(E.length)):e.startsWith(`${y}placeholder.html?`)?new URLSearchParams(e.substring(e.indexOf("?"))).get("url"):e:""}function Fe(e){let t=e.match(/\d+/);if(t)return parseInt(t[0])}const C=[...new Array(30)].map((e,t)=>parseInt(10+Math.pow(1.6,t)));function*_(e){let t=0;for(;C.slice(0,t).reduce((n,r)=>n+r,0)<e;)yield C[t++]}async function Ie(e,t,n){let r=0;for(let o of _(e)){if(await n(r))return;await d(o),r+=o}throw new Error(`Timeout waiting for condition ${t}`)}function G(e){let t=chrome.i18n.getMessage(e);return t||(console.log("No translation available for: "+e),e)}function Ue(e,t,n){return t&&((e||"").toLowerCase().startsWith("file:")||H(e))?n?`data:text/html, <html><body><div id="placeholderUrl">${e}</div></body></html>`:`${y}placeholder.html?url=${encodeURI(e)}`:e}async function ve(){try{return globalForcePlaceholdersEnabled||!0}catch(e){return console.log(e),!0}}function H(e){for(let t of B)if(e.startsWith(t))return!0;return!!(!e||e===""||e.startsWith("chrome-devtools:"))}const B=["javascript:","about:",...["chrome://","edge://","data:"].filter(e=>!0),...["edge://","chrome://"].map(e=>["newtab","new-tab-page","print","network-error","badcastcrash","inducebrowsercrashforrealz","crash","crashdump","kill","hang","shorthang","gpuclean","gpucrash","gpuhang","memory-exhaust","memory-pressure-critical","memory-pressure-moderate","ppapiflashcrash","ppapiflashhang","quit","restart"].map(t=>`${e}${t}/`)).flat()];async function d(e){return new Promise(t=>setTimeout(t,e))}class ${async put(t,n){await chrome.storage.local.set({[t]:n})}async get(t){return(await chrome.storage.local.get([t]))[t]}async remove(t){return await chrome.storage.local.remove(t)}}const k=new $;function f(){return k}const W="undefined-34LKmiHxP3Mu48u8qrDaHf";function w(e,t,n){return Array.isArray(e)?e.map(r=>w(r,t,n)):typeof e=="object"&&e!==null?Object.fromEntries(Object.entries(e).map(([r,o])=>[r,w(o,t,n)])):e===t?n:e}const Pe="c",Ae="e",Le="tg";class z{async put(t,n){await chrome.storage.session.set({[t]:n})}async get(t){return(await chrome.storage.session.get([t]))[t]}async getAll(){return await chrome.storage.session.get(null)}async remove(t){return await chrome.storage.session.remove(t)}async clearAll(){await chrome.storage.session.clear()}}class V{async put(t,n){await f().put("sessionStore",{...await this.getAll(),[t]:n})}async get(t){return(await this.getAll())[t]}async getAll(){return await f().get("sessionStore")??{}}async remove(t){let n=await this.getAll();delete n[t],await f().put("sessionStore",n)}async clearAll(){await f().remove("sessionStore")}}const q=chrome.storage.session?new z:new V;function Me(){return q}function Re(){return navigator.userAgent.includes(" Edg/")}async function Oe(e){let[t]=await chrome.tabs.query({windowId:e.windowId,active:!0});t&&t.id!==e.id?(await chrome.tabs.update(e.id,{active:!0}),await chrome.tabs.update(t.id,{active:!0})):console.log("No active tab found")}function je(e,t){let n,r;return arguments.length===1?(n=e,r=n!==void 0):(r=e,n=t),r?[n]:[]}function Ne({id:e,display:t,marginTop:n="16px",marginBottom:r="16px",marginLeft:o=0,marginRight:s=0,color:c="var(--border-color)",I:u,P:i,F:l}={}){return j({...e&&{id:e},...i&&{className:"hideIfInLastSection"},...l&&{className:"hideIfInLastSubsection"},style:{...t&&{display:t},marginTop:n,marginBottom:r,marginLeft:o,marginRight:s,borderBottom:`1px solid ${c}`,...u}})}function _e(e){return[`
`,"\v","\f","\r","","\u2028","\u2029"].some(t=>t===e)}const J=["\v","\f","\r","","\u2028","\u2029"];function Ge(e){return e?(e=e.replaceAll(`\r
`,`
`),J.forEach(t=>e=e.replaceAll(t,`
`)),e):""}(async()=>(await h(),[...document.querySelectorAll("[data-m]")].forEach(e=>e.textContent=G(e.dataset.m))))();
