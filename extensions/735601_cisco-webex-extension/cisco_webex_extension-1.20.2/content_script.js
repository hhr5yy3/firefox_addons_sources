var browserType=null,browserVersion=null;!function(){var e=navigator.userAgent.toLowerCase(),t=e.match(/(opera|chrome|safari|firefox|msie|trident(?=\/))\/?\s*(\d+)/i)||[],n=[];/firefox/i.test(t[1])?(n=/\brv[ :]+(\d+.?\d*)/g.exec(e)||[],browserType="firefox",browserVersion=n[1]):/chrome/i.test(t[1])&&(n=e.match(/\b(chrome)\/(\d+.?\d*.?\d*.?\d*)/),browserType="chrome",browserVersion=n[2])}();var ContentScript=function(g){return g.id=chrome.runtime.id,g.port=null,g.token_="",g.hashList=[],g.uuid_="",g.numberOfFailures_=0,g.cwsDeprecated_=!1,g.initHashList=function(){g.hashList.push("X4WKTojPTBCkUep3mJ4lISkJd5xjgCy7t3WOV9ekcYQ="),g.hashList.push("64tUupzAFkz0sO9FdxdKzXPU1M+kX5addpE8cY8KwMY="),g.hashList.push("Y1UGgNTP1Q1s+ApMq8hsYXhEOhDHsCr5/q5bbvBFP/c="),g.hashList.push("eaShT5BXYGibkON42a7ewRxsy4+PSGtTMh2fG54Zf7A="),g.hashList.push("bzT9bgmTETuVqCgVxPDSjrnTqC6N14zH8kVD/pHJBdw="),g.hashList.push("Y1KRUKo4HpiaxizSb9jeqQR7pL82VYHg0CMQHD0EHHI="),g.hashList.push("1bIZVrqEKHJbytsxxLWDyOXWT4CQO7K46V4lOryJIJo=")},g.uuid=function(){var n=(new Date).getTime();return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(e){var t=(n+16*Math.random())%16|0;return n=Math.floor(n/16),("x"===e?t:7&t|8).toString(16)})},g.filterLog=function(e){var t={};for(var n in e){var a=e[n];if(n.match(/location\d+_url|szhomepage\d+/i))try{var r=document.createElement("a");if(r.href=atob(a),r.hostname.trim().toLowerCase().match(/webex\.com$|webex\.com\.cn$|^_self$/i))continue}catch(e){}else if("clientparam_value"===n.trim().toLowerCase()){var i=(new DOMParser).parseFromString(atob(a),"text/xml");if(i&&"root"===i.childNodes[0].nodeName)continue}else if(a.match(/^\d+$|^\d+\.\d+$/))continue;t[n]=a}return t},g.sendLog=function(t,e){try{var n="string"==typeof t.message?JSON.parse(t.message):t.message;n.ext_message_type=t.message_type,n.ext_tracking_id=g.uuid_,n.domain=window.location.protocol+"//"+window.location.host,n.illegal=!!e,chrome.runtime.sendMessage(n,function(e){})}catch(e){chrome.runtime.sendMessage(t.message,function(e){})}},g.verifyScriptCall=function(e){var t=/^(WebEx_|As[ADEPS]|RA[AM])|^(Ex|In)it|^(FinishC|Is[NS]|JoinM|[NM][BCS][JRUC]|Set|Name|Noti|Trans|Update)|^(td|SCSP)$/;if(20480<e.length)return!1;for(var n=e.split(";"),a=0;a<n.length;a++){var r=n[a].trim(),i="",s=r.indexOf("=");if(0<=s){if("szCookie"!==r.substring(0,s).trim())return!1;r=r.substring(s+1).trim()}0<=(s=r.indexOf("("))&&(i=r.substring(s+1),r=r.substring(0,s).trim());var o=i.split(",");if(1024<i.length||20<o.length)return!1;if(0<r.length&&!r.match(t))return!1;if(r.match(/2$/))return!1;for(var c=g.crypto(r),m=0;m<g.hashList.length;m++)if(c===g.hashList[m])return!1}return!0},g.verify=function(e){if("connect"!==e.message_type&&"disconnect"!==e.message_type&&"launch_meeting"!==e.message_type)return!1;if("launch_meeting"!==e.message_type)return!0;try{if("string"!=typeof e.message)return!1;if(e.message.includes("\\u0000"))return!1;var t=JSON.parse(e.message);if(navigator.platform.match(/win/i)){if((i=t.GpcExtName)&&"atgpcext"!==(i=i.trim()).toLowerCase()&&"atgpcext"!==atob(i).toLowerCase().trim())return!1;var n=t.GpcUnpackName;if(n&&"atgpcdec"!==(n=n.trim()).toLowerCase()&&"atgpcdec"!==atob(n).toLowerCase().trim())return!1;var a=t.GpcInitCall;if(a&&!g.verifyScriptCall(atob(a.trim())))return!1;var r=t.GpcExitCall;if(r&&!g.verifyScriptCall(atob(r.trim())))return!1}else if(navigator.platform.match(/mac/i)){var i;if("atgpcext64"!==(i=t.GpcExtName.trim()).toLowerCase()&&"atgpcext64"!==atob(i).toLowerCase().trim())return!1}else if(!navigator.platform.match(/linux/i))return!1;var s=t.GpcComponentName.toLowerCase().trim();return null==s.match(/\.dll$|\.bundle$|\.app$|\.so$/)&&(s=(s=atob(t.GpcComponentName)).toLowerCase().trim()),!0}catch(e){}return!1},g.verifyVersion=function(e,t){if(!e||!t)return!1;try{var n=/^(\d+)\.(\d+)(\.\d+)+$/.exec(e);if(navigator.platform.match(/win/i)){if(parseInt(t)<3)return!1;if(n.length<2||parseInt(n[1])<10040)return!1}else{if(!navigator.platform.match(/mac/i))return!1;if(parseInt(t)<1)return!1;if(n.length<3||parseInt(n[2])<40)return!1}return!0}catch(e){return!1}},g.handleStateChanged=function(e){var t={timestamp:(new Date).toUTCString(),token:g.token_,message_type:"state_changed",message:{ExtState:{result:e,reason:e?"ok":"ExtensionNotInstalled"},HostState:{result:!1,reason:"HostNotInstalled"},res_url:chrome.extension.getURL("cwcsf-nativemsg-iframe-43c85c0d-d633-af5e-c056-32dc7efc570b.html")}};g.handleNativeMessage(t)},g.handleNativeMessage=function(e){if("hello_ack"!==e.message_type&&"launch_meeting_started"!==e.message_type&&"launch_meeting_ack"!==e.message_type||g.sendLog(e),"disconnect_ack"!==e.message_type||!g.cwsDeprecated_){if("hello_ack"===e.message_type&&!navigator.platform.match(/linux/i)){var t=navigator.platform.match(/win/i)?e.cwsversion:navigator.platform.match(/mac/i)?e.message.cwsversion:null,n=navigator.platform.match(/win/i)?e.gpcversion:navigator.platform.match(/mac/i)?e.message.gpcversion:null;if(!g.verifyVersion(t,n))return g.numberOfFailures_++,e={timestamp:(new Date).toUTCString(),token:g.token_,message_type:"disconnect",message:"Specified native messaging host deprecated."},g.cwsDeprecated_||g.handleNativeMessage(e),g.cwsDeprecated_=!0,void g.sendMessage(e);g.numberOfFailures_=0,g.cwsDeprecated_=!1}"firefox"===browserType&&(e=JSON.stringify(e));var a=new CustomEvent("native_message",{detail:e});window.parent.document.dispatchEvent(a)}},g.handleNativeDisconnect=function(e){var t={timestamp:(new Date).toUTCString(),token:g.token_,message_type:"disconnect",message:"disconnect"};g.port=null,g.cwsDeprecated_||g.handleNativeMessage(t)},g.sendMessage=function(e,t){try{if(!g.verify(e)){"launch_meeting"===e.message_type&&g.sendLog(e,!0);var n={timestamp:(new Date).toUTCString(),token:g.token_,message_type:"error",message:{error_code:1005,error_message:"BadDocShow"}};if(g.handleNativeMessage(n),null!=g.port){var a={timestamp:(new Date).toUTCString(),token:g.token_,message_type:"disconnect",message:"disconnect"};g.port.postMessage(a)}return}"launch_meeting"===e.message_type&&(e.domain=window.location.protocol+"//"+window.location.host),null!=g.port&&g.port.postMessage(e),"launch_meeting"===e.message_type&&g.sendLog(e)}catch(e){n={timestamp:(new Date).toUTCString(),token:g.token_,message_type:"error",message:{error_code:-1,error_message:e.toString()}};g.handleNativeMessage(n)}},g.connectPort=function(e){window.location.host;if(!g.port)try{g.port=chrome.runtime.connect(e,{name:g.token_}),null!=g.port&&(g.port.onMessage.addListener(g.handleNativeMessage),g.port.onDisconnect.addListener(g.handleNativeDisconnect))}catch(e){ContentScript.handleStateChanged(!1)}},g.crypto=function(e){return CryptoJS.SHA256(e).toString(CryptoJS.enc.Base64)},g.init=function(){g.initHashList(),g.uuid_=g.uuid(),document.addEventListener("connect",function(e){g.token_=e.detail.token,g.connectPort("")}),document.addEventListener("message",function(e){g.sendMessage(e.detail,g.handleNativeMessage)}),document.addEventListener("disconnect",function(e){g.token_=e.detail.token,null!=g.port&&(g.port.disconnect(),g.port=null)})},g}(ContentScript||{});ContentScript.init(),window.onload=function(){ContentScript.handleStateChanged(!0)};