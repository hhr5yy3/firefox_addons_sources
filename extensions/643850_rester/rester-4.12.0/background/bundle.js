(()=>{"use strict";var e={d:(t,r)=>{for(var n in r)e.o(r,n)&&!e.o(t,n)&&Object.defineProperty(t,n,{enumerable:!0,get:r[n]})},o:(e,t)=>Object.prototype.hasOwnProperty.call(e,t),r:e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})}},t={};e.r(t),e.d(t,{format:()=>y,parse:()=>g});var r={};e.r(r),e.d(r,{postman:()=>t});class n{constructor(){this._listeners={}}addEventListener(e,t){this._listeners[e]||(this._listeners[e]=[]),this._listeners[e].push(t)}removeEventListener(e,t){if(this._listeners[e]){const r=this._listeners[e].indexOf(t);-1!==r&&this._listeners[e].splice(r,1)}}dispatchEvent(e){(this._listeners[e.type]||[]).forEach((t=>t(e)))}}const s=new class extends n{constructor(e){super(),this.tables=e,this.writeLock=Promise.resolve(),this.tables.forEach((e=>{e.indexes=e.indexes||[],e.info=null,this._get(e.name).then((t=>{e.info=t||{lastId:0,ids:[]}}))}))}get(e,t,r){return this._get(`${e}.e.${r}`).then((e=>e&&new t(e)))}getIndexKeys(e,t){return this._get(`${e}.i.${t}`).then((e=>e?Object.keys(e):[]))}query(e,t,r){const n=[];return this._forEachIdIntervalReverse(e,((t,s)=>{for(let o=s;o>=t;o--)if(n.push(`${e}.e.${o}`),r&&0==--r)return!0})),this._get(n).then((e=>Object.values(e).map((e=>new t(e))).sort(((e,t)=>t.id-e.id))))}transaction(){const e=this,t={},r={};return["add","put","delete"].forEach((e=>{r[e]=function(n,s){return t[n]||(t[n]=[]),t[n].push({action:e,entity:s}),r}})),r.execute=function(){return e._withWriteLock((r=>{const n=[],s=Object.keys(t).map((s=>{const o=e.tables.find((e=>e.name===s)),i=o.indexes.map((e=>`${s}.i.${e}`));return t[s].forEach((({action:t,entity:r})=>{if("add"===t||"put"===t){const n=!Object.prototype.hasOwnProperty.call(r,"id");if(n)r.id=++o.info.lastId,e._addIdToIntervals(s,r.id);else{if("add"===t)throw new Error(`add(${r.id}): Cannot add an entity with an id.`);if(!e._findIdInterval(s,((e,t)=>r.id>=e&&r.id<=t)))throw new Error(`put(${r.id}): Entity does not exist. Cannot insert entity with specific id.`)}n||i.push(`${s}.e.${r.id}`)}else"delete"===t&&(e._removeIdFromIntervals(s,r.id),i.push(`${s}.e.${r.id}`))})),e._get(i).then((r=>{const n={[s]:o.info};return t[s].forEach((({action:e,entity:t})=>{"add"!==e&&"put"!==e||(n[`${s}.e.${t.id}`]=t);const i=r[`${s}.e.${t.id}`]||{};o.indexes.forEach((e=>{const o=i[e],a=t[e],c=r[`${s}.i.${e}`]||{};if(o&&c[o])if(1===c[o].length)delete c[o];else{const e=c[o].indexOf(t.id);c[o].splice(e,1)}a&&(Object.prototype.hasOwnProperty.call(c,a)||(c[a]=[]),c[a].push(t.id)),n[`${s}.i.${e}`]=c}))})),e._set(n)})).then((()=>{const r=[];if(t[s].forEach((({action:e,entity:t})=>{"delete"===e&&r.push(`${s}.e.${t.id}`)})),r.length>0)return e._remove(r)})).then((()=>{t[s].forEach((({action:e,entity:t})=>{r.push({action:e,item:t,itemType:t.constructor.type}),n.push(t.id)}))}))}));return Promise.all(s).then((()=>1===n.length?n[0]:n))}))},r}_withWriteLock(e){const t=()=>new Promise(((t,r)=>{try{const n=[];Promise.resolve(e(n)).then(((...e)=>{this.dispatchEvent(new CustomEvent("change",{detail:n})),t(...e)}),r)}catch(e){r(e)}}));return this.writeLock=this.writeLock.then(t,t),this.writeLock}_addIdToIntervals(e,t){const r=this.tables.find((t=>t.name===e)),n=r.info.ids[r.info.ids.length-1];n&&n===t?r.info.ids[r.info.ids.length-1]=t:r.info.ids.push(t,t)}_removeIdFromIntervals(e,t){const r=this.tables.find((t=>t.name===e)),n=this._findIdInterval(e,((e,r)=>t>=e&&t<=r));n&&(t===n.start&&t===n.end?r.info.ids.splice(2*n.index,2):t===n.start?r.info.ids[2*n.index]++:t===n.end?r.info.ids[2*n.index+1]--:r.info.ids.splice(2*n.index+1,0,t-1,t+1))}_forEachIdInterval(e,t){const r=this.tables.find((t=>t.name===e));for(let e=0;e<r.info.ids.length/2&&!t(r.info.ids[2*e],r.info.ids[2*e+1],e);e++);}_forEachIdIntervalReverse(e,t){const r=this.tables.find((t=>t.name===e));for(let e=r.info.ids.length/2-1;e>=0&&!t(r.info.ids[2*e],r.info.ids[2*e+1],e);e--);}_findIdInterval(e,t){let r;return this._forEachIdInterval(e,((e,n,s)=>{if(t(e,n))return r={start:e,end:n,index:s},!0})),r}_get(e){return this._performStorageLocalOperation("get",e,(t=>"string"==typeof e?t[e]:t))}_set(e){return this._performStorageLocalOperation("set",e)}_remove(e){return this._performStorageLocalOperation("remove",e)}_performStorageLocalOperation(e,t,r=(e=>e)){return new Promise(((n,s)=>{const o=performance.now();chrome.storage.local[e](t,(t=>{const i=performance.now()-o;i>500&&this.dispatchEvent(new CustomEvent("slowPerformance",{detail:{operation:`storage.local.${e}(...)`,duration:Math.round(i)}})),chrome.runtime.lastError?s(chrome.runtime.lastError):n(r(t))}))}))}}([{name:"authProviderConfigs"},{name:"authTokens"},{name:"environments"},{name:"history"},{name:"requests",indexes:["collection"]}]);class o{static get type(){return"AuthorizationProviderConfiguration"}static get defaultProperties(){return{title:"",providerId:0}}constructor(e){Object.assign(this,o.defaultProperties,e)}}class i{static get type(){return"AuthorizationToken"}static get defaultProperties(){return{title:"",scheme:"",token:"",expirationDate:null,configurationId:0,providerId:0}}constructor(e){Object.assign(this,i.defaultProperties,e)}}class a{static get type(){return"Environment"}static get defaultProperties(){return{name:"",values:{}}}constructor(e){Object.assign(this,a.defaultProperties,e)}}function c(e){return Array.isArray(e)?e:Object.keys(e).map((t=>({name:t,value:e[t]})))}class u{static get type(){return"Request"}static get defaultProperties(){return{collection:null,title:null,method:null,url:null,headers:[],body:null,variables:{}}}constructor(e){var t;Object.assign(this,u.defaultProperties,e),this.collection&&(this.collection=this.collection.split(/\s*\/\s*/g).join(" / ")),this.headers=c(this.headers),this.variables=(t=this.variables)?(Object.prototype.hasOwnProperty.call(t,"enabled")&&delete t.enabled,t):{}}}function l(){return s.query("requests",u)}class d{static get type(){return"Response"}static get defaultProperties(){return{status:0,statusText:null,headers:[],body:null,redirected:!1}}constructor(e){Object.assign(this,d.defaultProperties,e),this.headers=c(this.headers)}}class h{static get type(){return"HistoryEntry"}static get defaultProperties(){return{time:0,timeEnd:0,request:null,response:null}}constructor(e){Object.assign(this,h.defaultProperties,e),this.request&&(this.request=new u(this.request)),this.response&&(this.response=new d(this.response)),this.size=JSON.stringify(this).length}}function f(e){return s.query("history",h,e)}function m(e,t){if(e===t)return 0;if(void 0===e)return-1;if(void 0===t)return 1;if(null===e)return-1;if(null===t)return 1;if("number"==typeof e&&"number"==typeof t)return e-t;if(Array.isArray(e)&&Array.isArray(t)){const r=Math.min(e.length,t.length);for(let n=0;n<r;n++){const r=m(e[n],t[n]);if(0!==r)return r}return e.length-t.length}return String(e).localeCompare(String(t))}new WeakMap;const p=["https://schema.getpostman.com/json/collection/v2.0.0/collection.json","https://schema.getpostman.com/json/collection/v2.1.0/collection.json"];function y(e){const t={info:{name:"RESTer",schema:"https://schema.getpostman.com/json/collection/v2.1.0/collection.json"},item:j(e)};return{contentType:"application/json",content:JSON.stringify(t,null,4),suffix:"json"}}function g(e,t){let r;try{if(r=JSON.parse(e),!p.includes(r.info.schema))throw new Error("Schema not supported.")}catch(e){return{supported:!1,error:e}}return{supported:!0,data:x(r.item,t.collectionPrefix)}}class v{static get sortOrder(){return 1}constructor(e){this.name=e,this.item=[]}static isPostmanFolder(e){return Array.isArray(e.item)}}class b{static get sortOrder(){return 2}static fromResterRequest(e,t){const r=new b;return r.id=O(e.id),r.name=e.title,r.request=w.fromResterRequest(e),t.length>0&&(r.response=t.map(q.fromResterHistoryEntry)),r}constructor(e){Object.assign(this,e),this.request=new w(this.request),this.response&&(this.response=this.response.map((e=>new q(e))))}toResterRequest(){const e=this.request.toResterRequest();var t;return this.id&&(e.id=(t=this.id).startsWith("rester-")?parseInt(t.substr(7),10):t),e.title=this.name||"<no title>",e}}class w{static fromResterRequest(e){const t=new w;return t.url=e.url,t.method=e.method,t.header=e.headers.map((e=>({key:e.name,value:e.value}))),e.body&&(t.body={mode:"raw",raw:e.body}),t}static isPostmanRequest(e){return"object"==typeof e&&e.url}constructor(e){Object.assign(this,e)}toResterRequest(){const e=new u;return e.method=this.method,e.url="object"==typeof this.url?this.url.raw:this.url,Array.isArray(this.header)&&(e.headers=this.header.filter((e=>!e.disabled)).map((e=>({name:e.key,value:e.value})))),this.body&&("raw"===this.body.mode?e.body=this.body.raw:"urlencoded"===this.body.mode?e.body=P(this.body.urlencoded):"formdata"===this.body.mode&&(e.body=P(this.body.formdata))),e}}class q{static fromResterHistoryEntry(e){const t=new q;return t.id=O(e.id),t.name=`${e.time} ${e.request.title}`,t.originalRequest=w.fromResterRequest(e.request),e.timing?t.responseTime=e.timing.duration:e.timeEnd&&(t.responseTime=new Date(e.timeEnd)-new Date(e.time)),t.header=e.response.headers.map((e=>({key:e.name,value:e.value}))),t.body=e.response.body,t.status=e.response.statusText,t.code=e.response.status,t}constructor(e){Object.assign(this,e),this.originalRequest&&(this.originalRequest=new w(this.originalRequest))}}function O(e){return`rester-${e}`}function P(e){return e.filter((e=>e.key.trim()&&!e.disabled)).map((e=>`${encodeURIComponent(e.key)}=${encodeURIComponent(e.value)}`)).join("&")}function E(e,t){return function(e,t,r){if(0===e.length)return 0;var n;t=(r=null==(n=r)?e=>e:"function"==typeof n?e=>n(e):e=>e[n])(t);let s=0,o=e.length-1;for(;s<=o;){const n=Math.floor((s+o)/2),i=m(r(e[n]),t);if(i<0)s=n+1;else{if(!(i>0))return n;o=n-1}}return s}(e,t,(e=>[e.name,e.constructor.sortOrder]))}function j({requests:e,historyEntries:t}){const r=new v;function n(e){let t=r;const n=e.split(/\s*\/\s*/i);for(const e of n){const r=new v(e),n=E(t.item,r);let s=t.item[n];s&&v.isPostmanFolder(s)&&s.name===e||(s=r,t.item.splice(n,0,s)),t=s}return t}for(const r of e){const e=t.filter((e=>e.request.id===r.id)),s=n(r.collection),o=b.fromResterRequest(r,e),i=E(s.item,o);s.item.splice(i,0,o)}return r.item}function x(e,t){const r=[];for(const o of e)if(v.isPostmanFolder(o)){const e=x(o.item,(n=t,s=o.name,n=n.trim(),s=s.trim(),n?`${n} / ${s}`:s));r.push(...e.requests)}else if(w.isPostmanRequest(o.request)){const e=new b(o).toResterRequest();e.collection=t,r.push(e)}var n,s;return{requests:r}}const R={activeEnvironment:null,stripDefaultHeaders:!1,enableRequestLintInspections:!0,pinSidenav:!1,requestBodyFullSize:!1,responseBodyWrap:!0,responseBodyPrettyPrint:!0,responseBodyFullSize:!1,responseBodyPreview:!1,showVariablesOnSide:!1,requestPageFullWidth:!1,theme:"dark"};function _(){return new Promise(((e,t)=>{chrome.storage.local.get("settings",(r=>{chrome.runtime.lastError?t(chrome.runtime.lastError):e(r.settings||{})}))}))}const I=new n;function $(e,t){const r={};for(let n of t){let t=r,s=e;for(let e=0;e<n.length;e++){let r=n[e],o=e===n.length-1;if(!Object.prototype.hasOwnProperty.call(s,r))break;Object.prototype.hasOwnProperty.call(t,r)||(t[r]=o?s[r]:{}),t=t[r],s=s[r]}}return r}const k={data:{authorizationProviderConfigurations:{put:function(e){return e=new o(e),s.transaction().put("authProviderConfigs",e).execute()},query:async function(e){return(await s.query("authProviderConfigs",o)).filter((t=>t.providerId===e))},delete:function(e){const t=new o({id:e});return s.transaction().delete("authProviderConfigs",t).execute()}},authorizationTokens:{add:function(e){return e=new i(e),s.transaction().add("authTokens",e).execute()},query:function(){return s.query("authTokens",i)},delete:function(e){const t=new i({id:e});return s.transaction().delete("authTokens",t).execute()}},environments:{put:function(e){return e=new a(e),s.transaction().put("environments",e).execute()},get:function(e){return s.get("environments",a,e)},query:function(){return s.query("environments",a)},delete:function(e){const t=new a({id:e});return s.transaction().delete("environments",t).execute()}},history:{add:function(e){return e=new h(e),s.transaction().add("history",e).execute()},get:function(e){return s.get("history",h,e)},query:f,delete:function(e){Array.isArray(e)||(e=[e]);const t=s.transaction();for(let r of e){const e=new h({id:r});t.delete("history",e)}return t.execute()}},requests:{put:function(e){return(e=new u(e)).variables&&"values"in e.variables&&delete e.variables.values,s.transaction().put("requests",e).execute()},get:function(e){return s.get("requests",u,e)},query:l,queryCollections:function(){return s.getIndexKeys("requests","collection")},delete:function(e){const t=new u({id:e});return s.transaction().delete("requests",t).execute()}}},exportImport:{export:async function(e){const t=await l(),n=e.includeHistory?await f():[],s=r[e.format].format({requests:t,historyEntries:n}),o=new File([s.content],`rester-export-${e.format}.${s.suffix}`,{type:s.contentType});!function(e,t){const r=URL.createObjectURL(e);chrome.downloads.download({...t,url:r},(e=>{e&&chrome.downloads.onChanged.addListener((function t(n){n.id===e&&"in_progress"!==n.state&&(URL.revokeObjectURL(r),chrome.downloads.onChanged.removeListener(t))}))}))}(o,{filename:o.name})},import:async function(e){let t;for(const n of Object.values(r)){const r=n.parse(e.data,{collectionPrefix:e.collectionPrefix});if(r.supported){t=r.data;break}}if(!t)throw new Error("Unsupported data format.");const n=s.transaction();for(const e of t.requests)delete e.id,n.add("requests",e);await n.execute()}},settings:{get:function(){return _().then((e=>{const t=Object.keys(R);for(let r of t)Object.prototype.hasOwnProperty.call(e,r)||(e[r]=R[r]);return e}))},set:function(e){const t=Object.keys(e).filter((e=>Object.prototype.hasOwnProperty.call(R,e))),r={};for(let n of t)r[n]=e[n];return _().then((e=>(Object.assign(e,r),function(e){return new Promise(((t,r)=>{chrome.storage.local.set({settings:e},(()=>{chrome.runtime.lastError?r(chrome.runtime.lastError):t()}))}))}(e)))).then((()=>{I.dispatchEvent(new CustomEvent("change",{detail:r}))}))}}};chrome.browserAction.onClicked.addListener((()=>{chrome.tabs.query({active:!0,currentWindow:!0},(e=>{const t=chrome.runtime.getURL("site/index.html");if(["about:blank","about:newtab"].includes(e[0].url))try{chrome.tabs.update({loadReplace:!0,url:t})}catch(e){chrome.tabs.update({url:t})}else chrome.tabs.create({url:t})}))})),chrome.runtime.onConnect.addListener((e=>{function t(t){e.postMessage({action:"event.dataChange",detail:JSON.stringify(t.detail)})}function r(t){e.postMessage({action:"event.dataSlowPerformance",detail:JSON.stringify(t.detail)})}function n(t){e.postMessage({action:"event.settingsChange",detail:JSON.stringify(t.detail)})}"api"===e.name&&(s.addEventListener("change",t),s.addEventListener("slowPerformance",r),I.addEventListener("change",n),e.onMessage.addListener((({id:t,action:r,args:n,fields:s})=>{if(!r.startsWith("api."))return;const o=r.split(".").slice(1).reduce(((e,t)=>e&&e[t]),k);o&&Promise.resolve(o(n&&JSON.parse(n))).then((r=>{r&&s&&(r=function(e,t){return t=function(e){return e.map((e=>e.split(".")))}(t),Array.isArray(e)?e.map((e=>$(e,t))):$(e,t)}(r,s)),e.postMessage({id:t,action:"apiresponse",result:JSON.stringify(r)})})).catch((r=>{r.message&&(r={name:r.name,message:r.message,stack:r.stack}),e.postMessage({id:t,action:"apiresponse",error:JSON.stringify(r)})}))})),e.onDisconnect.addListener((()=>{s.removeEventListener("change",t),s.removeEventListener("slowPerformance",r),I.removeEventListener("change",n)})))}))})();