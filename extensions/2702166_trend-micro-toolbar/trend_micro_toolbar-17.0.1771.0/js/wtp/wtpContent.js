var wtpContent=function(t){var e={};function n(r){if(e[r])return e[r].exports;var a=e[r]={i:r,l:!1,exports:{}};return t[r].call(a.exports,a,a.exports,n),a.l=!0,a.exports}return n.m=t,n.c=e,n.d=function(t,e,r){n.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:r})},n.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},n.t=function(t,e){if(1&e&&(t=n(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var r=Object.create(null);if(n.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var a in t)n.d(r,a,function(e){return t[e]}.bind(null,a));return r},n.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return n.d(e,"a",e),e},n.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},n.p="",n(n.s=55)}({0:function(t,e,n){"use strict";function r(){return-1!=navigator.userAgent.indexOf("Firefox")?browser:chrome}function a(){r().storage.local.get("debug",t=>{t.debug&&console&&console.log&&console.log.apply(this,arguments)})}function o(){console&&console.error&&console.error.apply(this,arguments)}function i(){void 0===i.locale_map&&TMExt_$.ajax({url:getURL("settings.json"),async:!1,dataType:"json",success:function(t){a(t),i.locale_map=t.supportLanguage,i.default_lang=t.defaultLanguage,i.l10n_map=t.l10nFolderMap}});let t=navigator.language,e=!1,n=i.locale_map,r="";for(var o=0;o<n.length;++o)if(n[o].includes(t)){r=n[o],e=!0;break}e||(r=i.default_lang);let s=r;return void 0!==i.l10n_map[r]&&(s=i.l10n_map[r]),s}function s(t,e,n){var a={action:t,params:e};r().runtime.sendMessage(a,n)}async function _(){let t=[];try{const e=await fetch(r().runtime.getURL("PbBankingList.txt"));t=(await e.text()).split("\n")}catch(t){o("getBankingList: e = "+t)}return a("getBankingList: size of banking list = "+t.length),t}function l(t,e,n,r){if(r<n)return-1;if(r-n<=1)return e===t[n]?n:e===t[r]?r:-1;let a=Math.floor((n+r)/2);return t[a]===e?a:t[a]<e?l(t,e,a,r):t[a]>e?l(t,e,n,a):-1}n.r(e),n.d(e,"getBrowser",(function(){return r})),n.d(e,"logInfo",(function(){return a})),n.d(e,"logError",(function(){return o})),n.d(e,"getCurrentLocale",(function(){return i})),n.d(e,"tbc_sendRequest",(function(){return s})),n.d(e,"getBankingList",(function(){return _})),n.d(e,"binarySearch",(function(){return l})),e.default={getBrowser:r,logInfo:a,logError:o,getCurrentLocale:i,tbc_sendRequest:s,getBankingList:_,binarySearch:l,sendMessageToActiveTab:function(t){return new Promise((e,n)=>{const a=r();a.tabs.query({active:!0,currentWindow:!0},r=>{r.length<=0?e(!1):a.tabs.sendMessage(r[0].id,t,()=>{a.runtime.lastError&&n(a.runtime.lastError.message)})})})},sha256:async function(t){let e=(new TextEncoder).encode(t),n=await crypto.subtle.digest("SHA-256",e);return[...new Uint8Array(n)].map(t=>t.toString(16).padStart(2,"0")).join("")}}},1:function(t,e,n){"use strict";n.d(e,"a",(function(){return r})),n.d(e,"b",(function(){return a})),n.d(e,"c",(function(){return o}));let r={STANDALONE:"Standalone",COEXIST:"Toolbar",PROMOTER:"Promoter"},a=500,o={OPEN_HELP:"tbb_open_help",OPEN_SETTINGS:"tbb_open_settings",PRELOAD:"tbb_pre_load",INJECTRESOURCES:"tbb_inject_resources",RATINGURLS:"tbb_ratingURLS",RATINGSINGLEURL:"tbb_ratingSingleURL",RATINGOUTERSOURCEURLS:"tbb_ratingOuterSourceURLs",RATINGCREATETABS:"tbb_ratingCreatTabs",INSERTRATINGRESULT:"tbc_insertRatingResult",INSERTSINGLERESULT:"tbc_insertSingleRatingResult",FEEDBACK_UNTESTED_URL:"tbc_feedback_untested_url",FEEDBACK_NAVIGATION_DURATION:"tbc_feedback_navigation_duration",OPEN_FBPS_HELP:"tbb_open_fbps_help",FEEDBACK_2_SITESAFETY:"tbb_feedback_2_sitesafety",SEND_MAIL_2_TMPLUGIN_TOOLBAR:"tbb_send_mail_2_tmplugin_toolbar",FORCE_REFRESH_PAGE:"tbb_force_refresh_page",UPDATE_GLOBAL_VARIABLES:"tbb_update_global_variables",SHOW_LOG_COLLECTION_RESULT:"tbb_show_log_collection_result",UPDATE_INIT_STORAGE:"tbc_update_init_storage",OPEN_PAYGURAD:"tbb_open_paygurad",SHOW_PAYGURAD_TUTORIAL:"tbb_show_paygurad_tutorial",PAYGUARD_CHECK_BANKING_LIST:"tbb_paygurad_check_banking_list",SEND_PAYGURAD_UBM:"tbb_send_paygurad_ubm",GET_PRODUCT_SETTINGS:"tbb_get_product_settings",OPEN_LOGIN_PAGE:"tbb_open_login_page",FEED_UBM:"feedbackUBM",SEND_UNTEST_URL_UBM:"send_untested_url_ubm",GET_INFORMATION:"tbb_get_information",GET_FRAUD_BUSTER_SECRET:"tbb_get_fraud_buster_secret",POPUP_IN_TAB:"tbc_popup_in_tab",OPEN_NEW_TAB_WITH_URL:"tbb_open_new_tab_with_url",CAN_FRAUD_BUSTER_WORK:"tbb_can_fraud_buster_work",FRAUD_BUSTER_GET_PRODUCT_INFO:"tbb_getProductInfoForFraudBuster",GET_USER_FRAUD_BUSTER_SETTING:"tbb_getUserFraudBusterSetting",SET_USER_FRAUD_BUSTER_SETTING:"tbb_setUserFraudBusterSetting",GET_FRAUD_BUSTER_IDENTITY:"tbb_getFraudBusterIdentity",ENABLED_FRAUD_BUSTER:"tbb_enabledFraudBuster",DISABLED_FRAUD_BUSTER:"tbb_disabledFraudBuster",WRITE_PRODUCT_EVENT_LOG:"tbb_writeProductEventLog",SEND_UBM:"tbb_sendUBM",UPDATE_PRODUCT_INFO:"tbb_updateProductInfo",NOTIFY_PRODUCT_INFO_CHANGE:"tbb_notifyProductInfoChange",UPDATE_EMAIL_SCANNED_COUNT:"tbb_updateEmailScannedCount",NOTIFY_SIGN_IN:"NOTIFY_SIGN_IN",GET_BANKING_LIST:"tbb_get_banking_list",SAL_SCAN:"tbb_sal_scan",OPEN_TI_WTP_EXCEPTION_PAGE:"openTiWtpExceptionPage",SHOW_NOTIFICSTION:"SHOW_NOTIFICSTION",SHOW_SALBLOCKINGPAGE:"SHOW_SALBLOCKINGPAGE",CLOSE_SALBLOCKINGPAGE:"CLOSE_SALBLOCKINGPAGE",GET_SETTINGS_FROM_TI:"GetSettingsFromTi",PS_LOCAL_PAGE_MESSAGE:"tbb_ps_local_page_message",PS_CONTENT_MESSAGE:"tbb_ps_content_message",PS_CAN_PROMOTE:"tbb_ps_can_promote",PS_GET_PROMOTION_STATUS:"tbb_ps_get_promotion_status",PS_SET_PROMOTION_STATUS:"tbb_ps_set_promotion_status",PS_CHECK_PRIVACY:"tbb_ps_check_privacy",PS_SHOW_PROMOTION_LEARNMORE:"tbb_ps_show_promtion_learn_more",PS_GET_SETTINGS:"tbb_ps_get_settings",PS_SET_SETTINGS:"tbb_ps_set_settings",PS_DATA_COLLECTION:"tbb_ps_data_collection",PS_FEEDBACK_2FA_STATUS:"tbb_ps_feedback_2fa_status",PS_REGISTER_CONTENT_PAGE:"tbb_ps_register_content_page",PS_REGISTER_LOCAL_PAGE:"tbb_ps_register_local_page",PS_OPEN_HELP_PAGE:"tbb_ps_open_help_page",PS_BROWSER_SCAN:"tbb_ps_browser_scan",PS_WEBSITE_SCAN:"tbb_ps_website_scan"}},4:function(t,e,n){"use strict";let r=n(0).getBrowser();function a(t={}){return new Promise(e=>{r.tabs.query(t,t=>e(t))})}var o={setStorage:function(t){return new Promise(e=>{r.storage.local.set(t,()=>{e()})})},getStorage:function(t){return new Promise(e=>{r.storage.local.get(t,t=>{e(t)})})},removeStoreage:function(t){return new Promise(e=>{r.storage.local.remove(t,()=>{e()})})},getSystemStorageInfo:function(){return new Promise(t=>{r.system.storage.getInfo(e=>{t(e)})})},getSystemCpuInfo:function(){return new Promise(t=>{r.system.cpu.getInfo(e=>{t(e)})})},getTabInfo:a,getActiveTab:async function(){return await a({active:!0,lastFocusedWindow:!0})},getCurrentActiveWindowTabId:function(){return new Promise(t=>{const e=n=>{r.tabs.query({active:!0,lastFocusedWindow:!0},(function(a){!r.runtime.lastError&&0!==a.length&&a[0].hasOwnProperty("id")?t({ret:!0,tabId:a[0].id}):++n>=10?t({ret:!1}):setTimeout(()=>{e(n)},500)}))};e(0)})},getTab:function(t){return new Promise(e=>{r.tabs.get(t,t=>{r.runtime.lastError?e(null):e(t)})})}};n.d(e,"a",(function(){return o}))},55:function(t,e,n){"use strict";n.r(e);var r=n(0),a=n(1),o=n(4);const i="js/wtp/CRPattern",s="js/wtp/CREngine/TISProToolbarDefine.js",_="js/wtp/CREngine/TISProToolbarLib.js",l="js/wtp/CREngine/TISProUrlManualScannerLib.js",u="js/wtp/CREngine/TISProAlertFriendLib.js",g="js/wtp/CREngine/TISProToolbarSendMailLib.js",c="js/wtp/CREngine/TISProFeedbackSnsUnsafeUrlLib.js",d="images/tooltip/",f=0,p=2,b=3,S=4,T=5;function E(){let t,e,n;for(t="",n=0;n<32;n++)8!=n&&12!=n&&16!=n&&20!=n||(t+="-"),e=Math.floor(16*Math.random()).toString(16).toUpperCase(),t+=e;return t}let h=r.default.getBrowser(),m=E();function R(t){return!!new RegExp("biglobe\\.ne\\.jp","i").test(t)}function I(t){if(null==t)return[];let e=[];return t.Engine.ParserRule&&e.push(i+"/"+t.Engine.ParserRule),t.Engine.SupportShareToFriend&&1==t.Engine.SupportShareToFriend&&e.push(u),t.Engine.EnableFeedbackSnsUnsafeUrl&&1==t.Engine.EnableFeedbackSnsUnsafeUrl&&(e.push(g),e.push(c)),e}function w(t){return!!document.getElementById(t)}function P(t){let e=document.getElementById(t);return e||(e=document.createElement("div"),e.id=t,e.innerHTML="init",e.style.display="None",document.documentElement.appendChild(e)),e}class O{constructor(t){this.crpattern=t,this.mouseOver=!0,this.highlight=!0,this.tooltipTimeout=300,this.resultIDs=[]}init(){2===this.crpattern.Engine.Categary&&this.crpattern.Engine.GeneralSearch&&this.RenderRatingSettingPopup();try{if(null===this.crpattern||void 0===this.crpattern)return void r.default.logError("PageRatingHandler.init: pattern is invalid");if(r.default.logInfo("PageRatingHandler.init: Check injected node"),w("tmtoolbar_page_rating_injected"))return void r.default.logInfo("PageRatingHandler.init: node has been injected");if(this.crpattern.Engine.ImageFilter&&(!TSRIsImageSafeSearchEnabled||!TSRIsImageSafeSearchEnabled()))return void r.default.logInfo("PageRatingHandler.init: safe image search is not enabled");if(!P("tmtoolbar_page_rating_injected"))return void r.default.logError("PageRatingHandler.init: node not found, may need to inject again");h.runtime.onMessage.addListener(t=>{if(!t.hasOwnProperty("action")||t.action!==a.c.INSERTRATINGRESULT)return;let e=t.params,n=e.docID;n&&n===m&&("undefined"==typeof TSRGetRatingFlowID?r.default.logInfo("TSRGetRatingFlowID is not defined"):e.flowID!=TSRGetRatingFlowID()&&r.default.logInfo("flowID is invalid, params.flowID = "+e.flowID,", TSRGetRatingFlowID = "+TSRGetRatingFlowID()),TSRInsertResultICON&&(r.default.logInfo("insert rating result, url = "+e.url+", ID = "+e.resultID+", level = "+e.ratingLevel+", bPhishing = "+e.bPhishing),this.resultIDs.push(e.resultID),TSRInsertResultICON(e.resultID,e.ratingLevel,e.bPhishing,this.crpattern.Engine.Categary)))});let t=null;const e=()=>{t&&(t=null),this.parse()},n=new MutationObserver(()=>{t||(t=setTimeout(e,1e3))}),o={childList:!0,attributes:!0,subtree:!0};n.observe(document.documentElement,o)}catch(t){r.default.logError("PageRatingHandler.init: e = "+t)}}RenderRatingSettingPopup(){h.storage.local.get({wtp_status:!0,wtp_pagerating_status:!1,wtp_pagerating_highlight_status:!0,wtp_pagerating_set_popup_is_set:!1,wtp_pagerating_set_popup_is_seen:!1,urls:[],browser:"",locale:"en",os:"",plid:"",titanium:{},cros:"",mode:""},t=>{let e=!(t.mode===a.a.COEXIST&&t.titanium.hasOwnProperty("toolbar_enable")&&!t.titanium.toolbar_enable);if(!t.wtp_status||!t.wtp_pagerating_status||!e||t.wtp_pagerating_set_popup_is_set||!t.wtp_pagerating_set_popup_is_set&&t.wtp_pagerating_set_popup_is_seen)return;let n=!!t.titanium.hasOwnProperty("plid")&&t.titanium.plid,r=n&&n.includes("-NWN-"),o={logo:!0,ja:!0,mac:"mac"===t.os,chromebook:"cros"===t.os,nttwest:r},i="ja"===t.locale?o:{logo:!0},s=productNameLogic(i),_="";void 0!==t.urls.Explain_How_Toolbar_Works&&(_=t.urls.Explain_How_Toolbar_Works),this.highlight=!!t.wtp_pagerating_highlight_status;var l=this;ratingSettingPopup(s,this.highlight,t.browser,_,(function(t){h.storage.local.set({wtp_pagerating_highlight_status:t}),l.resultIDs.forEach(e=>{TSRHightlightById(e,t)})}),(function(t,e=!1){h.storage.local.set({wtp_pagerating_set_popup_is_seen:t,wtp_pagerating_set_popup_is_set:e})}))})}parse(){"undefined"!=typeof TSRParse&&"undefined"!=typeof TSRInitToolTip?h.storage.local.get({framework_status:!1,wtp_status:!1,wtp_pagerating_status:!1,wtp_pagerating_highlight_status:!0,urls:[],browser:""},t=>{if(!t.framework_status||!t.wtp_status||!t.wtp_pagerating_status)return;let e="";void 0!==t.urls.pagerating_How_Turn_Off_highlight_link&&(e=t.urls.pagerating_How_Turn_Off_highlight_link),this.highlight=t.wtp_pagerating_highlight_status;let n=null;try{TSRInitToolTip(getURL(d),this.mouseOver,this.highlight,this.tooltipTimeout,500,e,t.browser),n=TSRParse()}catch(t){r.default.logError(t)}n&&0!=n.length&&this.RatingURLs(n,this.crpattern)}):r.default.logError("PageRatingHandler.parse: lib functions are not available")}RatingURLs(t,e){let n=new Array;for(let e=1;e<t.length;e++){let r=t[e];r&&!r.sended&&(r.sended=!0,n[e]=r.link)}if(0!==n.length)try{let r=new URL(document.location.href);h.runtime.sendMessage({action:a.c.RATINGURLS,params:{windowguid:m,flowid:t.FlowID,urls:n,category:e.Engine.Categary,host:r.hostname}})}catch(t){r.default.logError("RatingURLs e = "+t)}}}class N{constructor(){this.mouseOver=!0,this.highlight=!0,this.tooltipTimeout=300}initToolTip(){try{"undefined"!=typeof TSRInitToolTip&&TSRInitToolTip(getURL(d),this.mouseOver,this.highlight,this.tooltipTimeout,a.b)}catch(t){r.default.logError("initToolTip: e = "+t)}}handleData(t){try{h.storage.local.get({framework_status:!1,wtp_status:!1,wtp_manualrating_status:!1},e=>{if(!e.framework_status||!e.wtp_status||!e.wtp_manualrating_status)return;let n=new URL(document.location.href);h.runtime.sendMessage({action:a.c.RATINGSINGLEURL,params:{windowguid:m,url:t,category:T,host:n.hostname}})})}catch(t){r.default.logError("handleData: e = "+t)}}init(){try{if(r.default.logInfo("ManualRatingHandler.init: Check injected node"),w("tmtoolbar_manual_rating_injected"))return void r.default.logInfo("ManualRatingHandler.init: node has been injected");if(!P("tmtoolbar_manual_rating_injected"))return void r.default.logError("ManualRatingHandler.init: node not found, may need to inject again");P(Communicator.UMS_EVENT_ID).addEventListener(Communicator.UMS_SEND_DATA_EVENT,t=>{let e=t.target.getAttribute("data");this.handleData(e)}),h.runtime.onMessage.addListener(t=>{if(!t.hasOwnProperty("action")||t.action!==a.c.INSERTSINGLERESULT)return;r.default.logInfo("ManualRatingHandler.onMessage: message = "+JSON.stringify(t));let e=t.params,n=e.docID;n&&n===m&&(this.initToolTip(),g_manual_rating&&g_manual_rating.callbackFromDoc(e.ratingLevel,e.url))}),this.initToolTip()}catch(t){r.default.logError("ManualRatingHandler.init: e = "+t)}}}class A{constructor(){this.urlSet=new Set,this.guid=E()}init(){new MutationObserver(()=>{this.parse()}).observe(document,{childList:!0,attributes:!0,subtree:!0})}parse(){h.storage.local.get({framework_status:!1,wtp_status:!1,wtp_rate_subframe:!0,wtp_rate_outer_script:!0},t=>{if(t.framework_status&&t.wtp_status)try{let e=[];if(t.wtp_rate_subframe&&document.querySelectorAll("iframe").forEach(t=>{t.src&&"about:blank"!==t.src&&!this.urlSet.has(t.src)&&(this.urlSet.add(t.src),e.push(t.src))}),t.wtp_rate_outer_script&&document.querySelectorAll("script").forEach(t=>{t.src&&"about:blank"!==t.src&&!this.urlSet.has(t.src)&&(this.urlSet.add(t.src),e.push(t.src))}),r.default.logInfo("OuterSourceRatingHandler.init: length of newUrls = "+e.length),0===e.length)return;let n=new URL(document.location.href);h.runtime.sendMessage({action:a.c.RATINGOUTERSOURCEURLS,params:{windowguid:this.guid,flowid:0,urls:e,category:f,host:n.hostname}})}catch(t){r.default.logError("OuterSourceRatingHandler.init: e = "+t)}})}}function L(t){if(null===t)return null;var e=null;switch(t.Engine.Categary){case S:case p:case b:e=new O(t);break;default:r.default.logError("No possible")}return e}function U(){return new N}function C(){return new A}n(9);let y=r.default.getBrowser();const D="[WTP][Content]",G=async()=>{let t=await o.a.getStorage({framework_status:!1});if(!t.framework_status)return void setTimeout(()=>{G()},500);t=await o.a.getStorage({l10n_strings:{},browser:"",os:"",mode:"",locale:"en",titanium_name:"",wtp_imagesafesearch_status:!1,serverConfig:{}}),r.default.logInfo(D,"storageData = "+JSON.stringify(t));let e=t.wtp_imagesafesearch_status,n="";t.mode===a.a.COEXIST?n=t.titanium_name?t.titanium_name:"":t.l10n_strings&&(n="msedge"===t.browser?t.l10n_strings.product_name:"cros"===t.os?t.l10n_strings.product_name_chromebook:t.l10n_strings.product_name_chrome),r.default.logInfo(D,"productName = "+n),y.runtime.sendMessage({action:a.c.PRELOAD,url:{href:document.location.href}},o=>{if(r.default.logInfo(D,"message = "+JSON.stringify(o)),!o)return void setTimeout(G,500);let i=["_locales/"+t.locale+"/TISProToolbarLocalization.js",s,_,l],u=o.crPattern;do{if(!u){r.default.logInfo(D,"content: no pattern information");break}if(4===u.Engine.EngineType&&R(document.referrer)){r.default.logInfo(D,"skip inject content script");break}let t=I(u);r.default.logInfo(D,"pageRatingScripts = "+JSON.stringify(t));for(let e in t)i.push(t[e])}while(0);r.default.logInfo(D,"injectedScripts = "+JSON.stringify(i));var g={scripts:i,csses:["css/common/TISProToolbar.css","js/wtp/trend_notification.css"],all_frames:!1};const c=()=>{if("undefined"==typeof D_TSRToolTipTitleString)return void setTimeout(c,500);D_TSRToolTipTitleString=n,o.featureConfig&&"undefined"!=typeof TSRUpdateFeatureConfig&&(r.default.logInfo(D,"set WTP feature config = "+JSON.stringify(o.featureConfig)),TSRUpdateFeatureConfig(o.featureConfig)),"undefined"!=typeof TSREnableImageSafeSearch&&TSREnableImageSafeSearch(e);let t=L(u);t&&t.init();let a=U();a&&a.init();let i=C();i&&i.init()};y.runtime.sendMessage({action:a.c.INJECTRESOURCES,parameters:g},()=>{r.default.logInfo(D,"script injected and got response"),c()})});new PerformanceObserver(e=>{e.getEntries().forEach(e=>{const n=Math.round(e.duration);if(n<=0)return;const o=new URL(e.name).hostname;if(r.default.logInfo(D,`hostname: ${o}, load duration: ${n} ms`),!t.serverConfig.hasOwnProperty("FeedbackPerformanceSites"))return void r.default.logInfo(D,"FeedbackPerformanceSites is not exist");-1!=t.serverConfig.FeedbackPerformanceSites.indexOf(o)?y.runtime.sendMessage({action:a.c.FEEDBACK_NAVIGATION_DURATION,parameters:{host:o,duration:n}}):r.default.logInfo(D,`hostname: ${o} is not in FeedbackPerformanceSites`)})}).observe({type:"navigation",buffered:!0})};G()},9:function(t,e){}});