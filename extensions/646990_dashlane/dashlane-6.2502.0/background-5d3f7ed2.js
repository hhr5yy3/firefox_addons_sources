"use strict";(self.webpackChunk_dashlane_amphora=self.webpackChunk_dashlane_amphora||[]).push([[433],{21804:(e,t,s)=>{s.r(t),s.d(t,{AsyncResource:()=>n});const n={bind:e=>e}},31579:(e,t,s)=>{s.r(t),s.d(t,{performance:()=>n});const n={now:()=>{}}},54070:(e,t,s)=>{s.d(t,{m:()=>d});var n=s(75958),r=s(99930),i=s(68076),a=s(88661),o=s(66557),c=s(40299);const d=(0,n.Q)({name:"scim",commands:{updateScimConfiguration:r.G,generateScimToken:i.S},events:{},queries:{scimConfiguration:a.I,scimEndpoint:o.v,provisioningSolution:c.M}})},68076:(e,t,s)=>{s.d(t,{S:()=>i});var n=s(13385),r=s(62149);class i extends((0,n.g)({scope:r.F.User})){}},99930:(e,t,s)=>{s.d(t,{G:()=>i});var n=s(13385),r=s(62149);class i extends((0,n.g)({scope:r.F.User})){}},40299:(e,t,s)=>{s.d(t,{M:()=>i});var n=s(77535),r=s(62149);class i extends((0,n.k)({scope:r.F.User})){}},88661:(e,t,s)=>{s.d(t,{I:()=>i});var n=s(77535),r=s(62149);class i extends((0,n.k)({scope:r.F.User})){}},66557:(e,t,s)=>{s.d(t,{v:()=>i});var n=s(77535),r=s(62149);class i extends((0,n.k)({scope:r.F.User})){}},10121:(e,t,s)=>{s.d(t,{Bs:()=>a,Hh:()=>i,k5:()=>r});var n=s(7165);const r=n.z.object({token:n.z.string(),active:n.z.boolean()}).optional(),i=n.z.nativeEnum({confidentialScim:"confidential-scim",selfHostedScim:"self-hosted-scim",adSync:"adsync",none:"none"}),a=n.z.object({provisioningSolution:i.optional()})},20246:(e,t,s)=>{s.d(t,{y:()=>E});var n=s(75958),r=s(80246),i=s(90435),a=s(42308),o=s(21454),c=s(99614),d=s(82062),l=s(49574),u=s(54602),p=s(88187),m=s(37461),h=s(75998),g=s(56346),v=s(27326),y=s(446),f=s(62149);class b extends((0,y.d)({scope:f.F.User})){}var S=s(63874),w=s(18306);const E=(0,n.Q)({name:"confidentialSSOApi",commands:{CheckDNSValidationCommand:r.o,ClearSettingsCommand:i.h,CreateTeamCommand:a.p,MigrateToConfidentialSsoCommand:o.Dt,DeleteDomainCommand:c.k,EnableSsoCommand:d.F,LoginUserWithEnclaveSSOCommand:l.B,ProvisionDomainCommand:u.p,TestLoginUserWithEnclaveSSOCommand:p.b,UpdateMetadataCommand:m.o,ValidateMetadataCommand:h.l,UpdateGroupProvisioningConfigurationCommand:g.Z5},events:{confidentialSsoSettingsReset:v.z,ssoSolutionChanged:b},queries:{SsoProvisioningQuery:S._,GetGroupProvisioningConfigurationQuery:w.$}})},51448:(e,t,s)=>{s.d(t,{E:()=>i});var n=s(8260),r=s(20246);class i extends((0,n.E)(r.y)){}(0,n.K)(r.y,i)},80246:(e,t,s)=>{s.d(t,{o:()=>i});var n=s(13385),r=s(62149);class i extends((0,n.g)({scope:r.F.User})){}},90435:(e,t,s)=>{s.d(t,{h:()=>i});var n=s(13385),r=s(62149);class i extends((0,n.g)({scope:r.F.User})){}},42308:(e,t,s)=>{s.d(t,{p:()=>i});var n=s(13385),r=s(62149);class i extends((0,n.g)({scope:r.F.User})){}},99614:(e,t,s)=>{s.d(t,{k:()=>i});var n=s(13385),r=s(62149);class i extends((0,n.g)({scope:r.F.User})){}},82062:(e,t,s)=>{s.d(t,{F:()=>i});var n=s(13385),r=s(62149);class i extends((0,n.g)({scope:r.F.User})){}},49574:(e,t,s)=>{s.d(t,{B:()=>i});var n=s(13385),r=s(62149);class i extends((0,n.g)({scope:r.F.Device})){}},21454:(e,t,s)=>{s.d(t,{Dt:()=>c,Fw:()=>o,hw:()=>a});var n=s(13385),r=s(62149),i=s(98124);const a=(0,i.Vj)("SSO_CONNECTOR_KEY_MISSING","SSO Migration failed: SSO connector key is missing"),o=(0,i.Vj)("SSO_CONNECTOR_KEY_FORMAT_INVALID","SSO Migration failed: SSO connector key format is invalid");class c extends((0,n.g)({scope:r.F.User})){}},54602:(e,t,s)=>{s.d(t,{p:()=>i});var n=s(13385),r=s(62149);class i extends((0,n.g)({scope:r.F.User})){}},88187:(e,t,s)=>{s.d(t,{b:()=>i});var n=s(13385),r=s(62149);class i extends((0,n.g)({scope:r.F.User})){}},56346:(e,t,s)=>{s.d(t,{B3:()=>d,HC:()=>c,Y3:()=>u,Z5:()=>p,b2:()=>l,gY:()=>o,hJ:()=>a});var n=s(13385),r=s(62149),i=s(98124),a=function(e){return e.GENERIC_ERROR="GENERIC_ERROR",e.TEAM_NOT_FOUND="TEAM_NOT_FOUND",e.MISMATCHING_ADMIN_PROVISIONING_KEY="MISMATCHING_ADMIN_PROVISIONING_KEY",e.IDP_NOT_FOUND="IDP_NOT_FOUND",e.NO_IDP_CONFIGURATION_UPDATE="NO_IDP_CONFIGURATION_UPDATE",e}({});const o=(0,i.Vj)("TEAM_NOT_FOUND","Team not found"),c=(0,i.Vj)("MISMATCHING_ADMIN_PROVISIONING_KEY","Mismatching admin provisioning key"),d=(0,i.Vj)("IDP_NOT_FOUND","IDP not found"),l=(0,i.Vj)("NO_IDP_CONFIGURATION_UPDATE","No IDP configuration update"),u=(0,i.Vj)("GENERIC_ERROR","Generic error");class p extends((0,n.g)({scope:r.F.User})){}},37461:(e,t,s)=>{s.d(t,{o:()=>i});var n=s(13385),r=s(62149);class i extends((0,n.g)({scope:r.F.User})){}},75998:(e,t,s)=>{s.d(t,{l:()=>i});var n=s(13385),r=s(62149);class i extends((0,n.g)({scope:r.F.User})){}},27326:(e,t,s)=>{s.d(t,{z:()=>i});var n=s(446),r=s(62149);class i extends((0,n.d)({scope:r.F.User})){}},18306:(e,t,s)=>{s.d(t,{$:()=>i});var n=s(77535),r=s(62149);class i extends((0,n.k)({scope:r.F.User})){}},63874:(e,t,s)=>{s.d(t,{_:()=>i});var n=s(77535),r=s(62149);class i extends((0,n.k)({scope:r.F.User})){}},95450:(e,t,s)=>{s.d(t,{JU:()=>p,WO:()=>l,X5:()=>r,pI:()=>u});var n=s(7165);n.z.object({groupProvisioningActivated:n.z.boolean()}),n.z.object({idpUuid:n.z.string().uuid(),certificates:n.z.array(n.z.string()),entrypoint:n.z.string(),groupProvisioningActivated:n.z.boolean().optional(),creationDateUnix:n.z.number(),updateDateUnix:n.z.number()});const r=n.z.enum(["valid","pending","expired","invalid"]),i=n.z.enum(["tokenNotFound","invalidToken"]),a=n.z.object({status:r.nullable(),verificationToken:n.z.string(),lastCheckDateUnix:n.z.number(),pendingReason:i.nullable(),expiryDateUnix:n.z.number()}),o=n.z.object({creationDateUnix:n.z.number(),dnsCheckStatus:a,domainName:n.z.string(),idpUuid:n.z.ostring(),updateDateUnix:n.z.number()});n.z.record(n.z.string(),o);const c=n.z.object({subdomainValue:n.z.string().nullable(),txtValue:n.z.string().nullable(),verificationStatus:r.nullable(),tokenFound:n.z.string().nullable(),pendingReason:i.nullable()}),d=n.z.array(n.z.object({domainName:n.z.string().url(),verificationStatus:r,idpUuid:n.z.string().optional().nullable()})),l=n.z.nativeEnum({none:"none",confidentialSaml:"confidential-saml",selfHostedSaml:"self-hosted-saml",ssoConnector:"sso-connector"}),u=n.z.enum(["none","incomplete","complete","enabled"]),p=n.z.object({isInitialized:n.z.boolean(),ssoSolution:l,ssoStatus:u,global:n.z.object({adminProvisioningKey:n.z.string().nullable(),isTeamProvisionedInNitro:n.z.boolean().nullable(),teamUuid:n.z.string().nullable(),ssoCapable:n.z.boolean().nullable(),ssoIsNitroProvider:n.z.boolean().nullable()}),idpApplication:n.z.object({entityId:n.z.string().nullable(),acsUrl:n.z.string().nullable(),signOnUrl:n.z.string().nullable()}),idpMetadata:n.z.object({metadataValue:n.z.string().nullable(),idpUuid:n.z.string().nullable(),groupProvisioningActivated:n.z.boolean().nullable()}),domainSetup:d,domainVerificationInfo:n.z.record(n.z.string().url(),c),enableSSO:n.z.object({ssoEnabled:n.z.boolean().nullable()})})},62076:(e,t,s)=>{s.d(t,{x:()=>r});const n=["local","staging","prod"];function r(e){return n.some((t=>t===e))}},47714:(e,t,s)=>{s.d(t,{i:()=>q});var n=s(92336),r=s(86006),i=s(40416),a=s(19961),o=s(54070),c=s(62149),d=s(10121),l=s(63144),u=s(56618);const p=e=>d.k5.safeParse(e).success;class m extends((0,l.Q)({persist:!1,capacity:u.Y._001KB,initialValue:undefined,scope:c.F.User,storeName:"confidential-scim-state",storeTypeGuard:p})){}var h=s(92587),g=s(76500),v=s(60399),y=s(78346),f=s(25917);class b{async getConfidentialScimConfig(){const e={token:"",active:!1},{teamUuid:t,adminProvisioningKey:s}=await this.getTeamIdentifiers(),n=await this.enclaveApiClient.scim.getScimConfiguration({teamUuid:t,adminProvisioningKey:s});if((0,y.hx)(n))throw new Error("cannot get scim configuration");const{active:r,token:i}=(0,y.db)(n);return e.active=r,e.token=i??"",e}async setConfidentialScimConfig(e){const{teamUuid:t,adminProvisioningKey:s}=await this.getTeamIdentifiers();await this.enclaveApiClient.scim.setScimConfiguration({teamUuid:t,adminProvisioningKey:s,token:e.token??"",active:e.active??!1})}async getTeamIdentifiers(){const e=await(0,v.z)(this.teamEnclaveClient.queries.getTeamIdentifiers());if((0,y.hx)(e))throw new Error("cannot get team info");const{teamUuid:t,adminProvisioningKey:s}=(0,y.db)(e);if(!s)throw new Error("[scimService] - adminProvisioningKey is missing, createTeamInEnclave should be called first");return{teamUuid:t,adminProvisioningKey:s}}constructor(e,t){this.enclaveApiClient=e,this.teamEnclaveClient=t}}b=(0,n.gn)([(0,h.GS)(),(0,n.w6)("design:type",Function),(0,n.w6)("design:paramtypes",[void 0===g.l?Object:g.l,void 0===f.G?Object:f.G])],b);var S=s(43978),w=s(37182),E=s(69885),_=s(46449),C=s(66557),I=s(99081);class T{execute(){return this.confidentialScimStore.state$.pipe((0,S.w)((async e=>{if(!e?.token)return(0,y.Rn)({tag:"Could not load team uuid"});const{teamUuid:t}=await this.confidentialScimService.getTeamIdentifiers();if(!t)return(0,y.Rn)({tag:"Could not load team uuid"});const s=new URL(`scim/${t}`,this.enclaveApiSettings.enclaveUrl);return(0,y.Vp)({endpoint:s.href})})),(0,w.K)((()=>(0,E.of)((0,y.Rn)({tag:"Could not load team uuid"})))))}constructor(e,t,s){this.enclaveApiSettings=e,this.confidentialScimService=t,this.confidentialScimStore=s}}T=(0,n.gn)([(0,_.e)(C.v),(0,n.w6)("design:type",Function),(0,n.w6)("design:paramtypes",[void 0===I.N6?Object:I.N6,void 0===b?Object:b,void 0===m?Object:m])],T);const A=e=>d.Bs.safeParse(e).success,U={};class N extends((0,l.Q)({persist:!1,capacity:u.Y._001KB,initialValue:U,scope:c.F.User,storeName:"provisioning-state",storeTypeGuard:A})){}var O=s(45736),D=s(82874),F=s(99930);class P{async execute({body:e}){const t=await this.confidentialScimStore.getState();try{const s={token:e.token??(t?.token||""),active:e.active??!!t?.active};return await this.confidentialScimStore.set({...s}),await this.confidentialScimService.setConfidentialScimConfig({...t,...e}),(0,y.Vp)(void 0)}catch(e){return await this.confidentialScimStore.set(t),(0,y.Rn)({tag:e.message})}}constructor(e,t){this.confidentialScimService=e,this.confidentialScimStore=t}}P=(0,n.gn)([(0,D.W)(F.G),(0,n.w6)("design:type",Function),(0,n.w6)("design:paramtypes",[void 0===b?Object:b,void 0===m?Object:m])],P);var R=s(68076),x=s(51448),L=s(48083),k=s(14122);class j{async execute(){const e=await this.confidentialScimStore.getState(),{global:{ssoIsNitroProvider:t}}=await this.ssoProvisioningStore.getState();try{t||await this.createTeam();const e=crypto.randomUUID();return await this.confidentialScimStore.set({token:e,active:!1}),await this.confidentialScimService.setConfidentialScimConfig({token:e,active:!1}),(0,y.Vp)(void 0)}catch(t){return this.confidentialScimStore.set(e),(0,y.Rn)({tag:`Something wrong happened: ${t}`})}}async createTeam(){await this.ssoClient.commands.createTeam(),await this.carbonClient.commands.updateTeamSettings({provisioningSolution:d.Hh.enum.confidentialScim})}constructor(e,t,s,n,r){this.confidentialScimStore=e,this.confidentialScimService=t,this.ssoClient=s,this.ssoProvisioningStore=n,this.carbonClient=r}}j=(0,n.gn)([(0,D.W)(R.S),(0,n.w6)("design:type",Function),(0,n.w6)("design:paramtypes",[void 0===m?Object:m,void 0===b?Object:b,void 0===x.E?Object:x.E,void 0===L.M?Object:L.M,void 0===k._?Object:k._])],j);var M=s(88661);class z{execute(){return this.confidentialScimStore.state$.pipe((0,S.w)((async e=>e?(0,y.Vp)(e):this.getInitState())))}async getInitState(){try{const e=await this.scimConfigurationService.getConfidentialScimConfig();return await this.scimStore.set(e),(0,y.Vp)(e)}catch(e){return(0,y.Vp)({active:!1,token:null})}}constructor(e,t,s){this.confidentialScimStore=e,this.scimConfigurationService=t,this.scimStore=s}}z=(0,n.gn)([(0,_.e)(M.I),(0,n.w6)("design:type",Function),(0,n.w6)("design:paramtypes",[void 0===m?Object:m,void 0===b?Object:b,void 0===m?Object:m])],z);var V=s(82567),B=s(87065),K=s(40299),G=s(31108);class ${execute(){return this.provisioningStore.state$.pipe((0,S.w)((e=>e.provisioningSolution?(0,E.of)((0,y.Vp)(e.provisioningSolution)):this.fetchInfoFromTeamPlanDetails().pipe((0,V.b)((t=>{this.provisioningStore.set({...e,provisioningSolution:t})})),(0,B.U)(y.Vp)))))}fetchInfoFromTeamPlanDetails(){return this.teamPlanDetailsClient.queries.getTeamProvisioningInfo().pipe((0,B.U)((e=>{if((0,y.hx)(e))return d.Hh.enum.none;const{provisioningSolution:t}=(0,y.db)(e);if(!t)return d.Hh.enum.none;const s=d.Hh.safeParse(t);return s.success?s.data:d.Hh.enum.none})))}constructor(e,t){this.teamPlanDetailsClient=e,this.provisioningStore=t}}$=(0,n.gn)([(0,_.e)(K.M),(0,n.w6)("design:type",Function),(0,n.w6)("design:paramtypes",[void 0===G.e?Object:G.e,void 0===N?Object:N])],$);class q{}q=(0,n.gn)([(0,r.Y)({api:o.m,imports:[i.D,O.D,a.G],handlers:{commands:{updateScimConfiguration:P,generateScimToken:j},events:{},queries:{scimConfiguration:z,scimEndpoint:T,provisioningSolution:$}},stores:[m,N],providers:[b]})],q)},45736:(e,t,s)=>{s.d(t,{D:()=>ze});var n=s(92336),r=s(86006),i=s(75421),a=s(85045),o=s(5206),c=s(19961),d=s(20246),l=s(92587),u=s(95450),p=s(48083);const m="_dashlane-challenge";class h{async reset(){await this.store.init({isInitialized:!1,ssoSolution:u.WO.enum.none,ssoStatus:u.pI.enum.none,global:{adminProvisioningKey:null,teamUuid:null,ssoIsNitroProvider:null,isTeamProvisionedInNitro:null,ssoCapable:null},idpApplication:{entityId:null,acsUrl:null,signOnUrl:null},idpMetadata:{metadataValue:null,idpUuid:null,groupProvisioningActivated:null},domainSetup:[],domainVerificationInfo:{},enableSSO:{ssoEnabled:null}})}set(e){return this.store.set(e)}constructor(e){this.store=e}}h=(0,n.gn)([(0,l.GS)(),(0,n.w6)("design:type",Function),(0,n.w6)("design:paramtypes",[void 0===p.M?Object:p.M])],h);var g=s(13800);class v extends g.f{}v=(0,n.gn)([(0,l.GS)()],v);var y=s(14676),f=s(60399),b=s(78346),S=s(25917),w=s(31108),E=s(76500),_=s(14122);class C{async fetchInitialValue(){const e=await this.getIsTeamSsoCapable();if(!e)return{isInitialized:!0,ssoSolution:u.WO.enum.none,ssoStatus:u.pI.enum.none,global:{adminProvisioningKey:null,teamUuid:null,ssoIsNitroProvider:null,isTeamProvisionedInNitro:null,ssoCapable:!1},idpApplication:{entityId:null,acsUrl:null,signOnUrl:null},idpMetadata:{metadataValue:null,idpUuid:null,groupProvisioningActivated:null},domainSetup:[],domainVerificationInfo:{},enableSSO:{ssoEnabled:null}};const{teamUuid:t,adminProvisioningKey:s}=await this.getTeamIdentifiers(),n=await this.getTeamSsoSettings();if(n.ssoSolution===u.WO.enum.confidentialSaml&&!s)throw new Error("[InitSsoProvisioningCommand] team is confidential but has no adminProvisioningKey");const r=n.ssoSolution===u.WO.enum.confidentialSaml&&s?await this.getTeamFromEnclave():{domains:{},idps:{},updateDateUnix:0,messageIntegrations:{slackStatus:!1}},i=this.inferSsoStatus(n,r),a=Object.keys(r.idps)[0]??null;return{isInitialized:!0,ssoSolution:n.ssoSolution??u.WO.enum.none,ssoStatus:i,global:{adminProvisioningKey:s??null,isTeamProvisionedInNitro:!!s,ssoIsNitroProvider:n.ssoIsNitroProvider??null,ssoCapable:e,teamUuid:t},idpApplication:{acsUrl:(o=this.enclaveApiClient.enclaveUrl,o?`${new URL(o).origin}/saml/callback`:""),entityId:"dashlane-nitro-sso",signOnUrl:"https://app.dashlane.com"},idpMetadata:{idpUuid:a,metadataValue:n.ssoIdpMetadata??null,groupProvisioningActivated:a?r.idps[a].groupProvisioningActivated??null:null},domainSetup:this.getDomainSetupState(r.domains),domainVerificationInfo:this.getDomainVerificationInfo(r.domains),enableSSO:{ssoEnabled:!!n.ssoEnabled}};var o}async getIsTeamSsoCapable(){const e=await(0,f.z)(this.teamPlanDetailsClient.queries.getTeamCapabilities());if((0,b.hx)(e))throw new Error("[InitSsoProvisioningCommand] unable to retrieve team capabilities");return!!(0,b.db)(e).sso.enabled}async getTeamIdentifiers(){const e=await(0,f.z)(this.teamEnclaveClient.queries.getTeamIdentifiers());if((0,b.hx)(e))throw new Error("[InitSsoProvisioningCommand] unable to retrieve team identifiers");return(0,b.db)(e)}async getTeamSsoSettings(){const e=await(0,f.z)(this.teamPlanDetailsClient.queries.getTeamSsoInfo());if((0,b.hx)(e))throw new Error("[InitSsoProvisioningCommand] unable to retrieve team settings");return(0,b.db)(e)}inferSsoStatus(e,t){return e.ssoSolution&&e.ssoSolution!==u.WO.enum.none?e.ssoEnabled?u.pI.enum.enabled:e.ssoIdpMetadata||e.ssoIdpEntrypoint||e.ssoServiceProviderUrl||Object.keys(t.domains).length?u.pI.enum.incomplete:u.pI.enum.none:u.pI.enum.none}getDomainSetupState(e){return Object.entries(e).map((([e,t])=>({domainName:e,verificationStatus:t.dnsCheckStatus.status??"pending"})))}getDomainVerificationInfo(e){return Object.entries(e).reduce(((e,[t,s])=>(e[t]={txtValue:s.dnsCheckStatus.verificationToken,verificationStatus:u.X5.parse(s.dnsCheckStatus.status),subdomainValue:m,pendingReason:s.dnsCheckStatus.pendingReason,tokenFound:null},e)),{})}async getTeamFromEnclave(){const e=await(0,f.z)(this.teamEnclaveClient.queries.getTeamFromEnclave());if((0,b.hx)(e))throw new Error("[InitSsoProvisioningCommand] unable to retrieve team from enclave");return(0,b.db)(e)}constructor(e,t,s,n){this.enclaveApiClient=e,this.teamEnclaveClient=t,this.teamPlanDetailsClient=s,this.carbonLegacyClient=n}}C=(0,n.gn)([(0,l.GS)(),(0,n.w6)("design:type",Function),(0,n.w6)("design:paramtypes",[void 0===E.l?Object:E.l,void 0===S.G?Object:S.G,void 0===w.e?Object:w.e,void 0===_._?Object:_._])],C);class I extends((0,a.AJ)()){}var T=s(82874),A=s(49574);class U{}class N{async execute(e){const t=e.body.userEmailAddress,s=t.slice(t.indexOf("@")+1),n=await this.enclaveApiClient.authentication.requestLogin({login:t});if((0,b.hx)(n))return n;const{idpAuthorizeUrl:r,teamUuid:i}=(0,b.db)(n),{samlToken:a}=await this.enclaveLoginContext.getSamlFromLogin(r,!0,e.body.tabFocus),o=await this.enclaveApiClient.authentication.confirmLogin({domainName:s,samlResponse:a,teamUuid:i});if((0,b.hx)(o))return o;const c={...(0,b.db)(o),login:e.body.userEmailAddress};return await this.enclaveLoginContext.redirectUserIntoLoginFlow(c),(0,b.Vp)(void 0)}constructor(e,t,s){this.enclaveApiClient=e,this.enclaveLoginContext=t,this.carbonLegacyClient=s}}N=(0,n.gn)([(0,T.W)(A.B),(0,n.w6)("design:type",Function),(0,n.w6)("design:paramtypes",[void 0===E.l?Object:E.l,void 0===U?Object:U,void 0===_._?Object:_._])],N);var O=s(43651),D=s(54602),F=s(13134),P=s(7165);const R=P.z.object({error:P.z.string()}),x=P.z.object({data:P.z.object({samlIdpEntryPoint:P.z.string(),samlIdpCertificate:P.z.string()})}),L=async(e,t)=>{if(null===t)return{samlIdpEntryPoint:"",samlIdpCertificate:""};let s="";if(new F.Y(t).isUrlValid()){const e=await fetch(t);s=await e.text()}else s=t;const{parseMetadataFields:n}=e.commands,r=await n({ssoIdpMetadata:s});if((0,b.d6)(r))return x.parse(r.data).data;throw new Error("failed to parse metadata, please validate first.")};class k{async execute({body:e}){const t=await this.ssoProvisioningStore.getState();if(!t.global.teamUuid)return(0,b.Rn)({tag:"TeamIdNotFound"});if(!t.global.adminProvisioningKey)return(0,b.Rn)({tag:"AdminProvisioningKeyNotFound"});if(!e.domainName)return(0,b.Rn)({tag:"DomainNameNotProvided"});const s=t.idpMetadata.metadataValue?await L(this.carbonLegacyClient,t.idpMetadata.metadataValue):null,n=await this.enclaveApiClient.domains.createDomain({domainName:e.domainName,adminProvisioningKey:t.global.adminProvisioningKey,idpMetadata:s?{certificate:s.samlIdpCertificate,entrypoint:s.samlIdpEntryPoint}:void 0,teamUuid:t.global.teamUuid});if((0,b.hx)(n))return n;const{dnsVerificationToken:r}=(0,b.db)(n),i=[...t.domainSetup,{idpUuid:t.idpMetadata.idpUuid,domainName:e.domainName,verificationStatus:u.X5.enum.pending}],a={...t.domainVerificationInfo,[e.domainName]:{txtValue:r,verificationStatus:u.X5.enum.pending,subdomainValue:m,pendingReason:null,tokenFound:null}};return await this.ssoProvisioningStoreUpdater.set({...t,domainSetup:i,domainVerificationInfo:{...t.domainVerificationInfo,...a}}),(0,b.Vp)(void 0)}constructor(e,t,s,n,r){this.enclaveApiClient=e,this.ssoProvisioningStoreUpdater=t,this.ssoProvisioningStore=s,this.featureFlipsClient=n,this.carbonLegacyClient=r}}k=(0,n.gn)([(0,T.W)(D.p),(0,n.w6)("design:type",Function),(0,n.w6)("design:paramtypes",[void 0===E.l?Object:E.l,void 0===h?Object:h,void 0===p.M?Object:p.M,void 0===O.P?Object:O.P,void 0===_._?Object:_._])],k);var j=s(42308),M=s(33312);const z=P.z.object({adminProvisioningKey:P.z.object({adminProvisioningKey:P.z.ostring().nullable(),itemId:P.z.ostring().nullable()}).optional().nullable()}),V=(e,t)=>{const s=t({path:`userSession.teamAdminData.teams.${e}`}).pipe((0,M.nb)({success:e=>{const t=z.safeParse(e);if(!t.success)throw t.error;return t.data.adminProvisioningKey?.adminProvisioningKey??null},failure:()=>""}));return(0,f.z)(s)};class B{async execute(){const{global:e}=await this.ssoProvisioningStore.getState();if(!e.adminProvisioningKey){const e=await this.teamEnclaveClient.commands.createTeamInEnclave();if((0,b.hx)(e))return(0,b.Rn)({tag:"CreateTeamApiError"})}if(!e.ssoIsNitroProvider)try{await this.setupSsoConfidentialTeam()}catch{return(0,b.Rn)({tag:"CreateTeamApiError"})}return(0,b.Vp)(void 0)}async setupSsoConfidentialTeam(){const e=await this.ssoProvisioningStore.getState();await this.carbonClient.commands.updateTeamSettings({ssoServiceProviderUrl:this.ssoServiceProviderUrl,ssoSolution:u.WO.enum.confidentialSaml}),this.eventEmitter.sendEvent("ssoSolutionChanged",u.WO.enum.confidentialSaml);const t=await(0,f.z)(this.teamPlanDetailsClient.queries.getTeamId());if((0,b.hx)(t))throw new Error("Failed to get teamId");const{teamId:s}=(0,b.db)(t);if(!s)throw new Error("Failed to get teamId");const n=await V(s,this.carbonClient.queries.carbonState);await this.ssoProvisioningStoreUpdater.set({...e,ssoSolution:u.WO.enum.confidentialSaml,ssoStatus:u.pI.enum.incomplete,global:{...e.global,adminProvisioningKey:n,ssoIsNitroProvider:!0,isTeamProvisionedInNitro:!0}})}constructor(e,t,s,n,r,i,a){this.enclaveApiClient=e,this.teamEnclaveClient=t,this.ssoProvisioningStoreUpdater=s,this.ssoProvisioningStore=n,this.carbonClient=r,this.teamPlanDetailsClient=i,this.eventEmitter=a,this.ssoServiceProviderUrl=new URL(this.enclaveApiClient.enclaveUrl).origin}}B=(0,n.gn)([(0,T.W)(j.p),(0,n.w6)("design:type",Function),(0,n.w6)("design:paramtypes",[void 0===E.l?Object:E.l,void 0===S.G?Object:S.G,void 0===h?Object:h,void 0===p.M?Object:p.M,void 0===_._?Object:_._,void 0===w.e?Object:w.e,void 0===v?Object:v])],B);var K=s(7303),G=s(21454),$=s(10121),q=s(54591);const H=P.z.object({data:P.z.object({deviceAccessKey:P.z.string(),deviceSecretKey:P.z.string()})}),W=P.z.object({data:P.z.object({devicePrivateKey:P.z.string(),devicePublicKey:P.z.string()})}),Q=P.z.enum(["sso_connector","encryption_service","nitro_encryption_service","command_line"]),Y=[Q.enum.encryption_service,Q.enum.nitro_encryption_service,Q.enum.sso_connector],X=P.z.object({platform:Q,accessKey:P.z.string(),deviceName:P.z.string().nullable(),activated:P.z.boolean(),creationDateUnix:P.z.number(),updateDateUnix:P.z.number()}),Z=P.z.object({data:P.z.object({teamDevices:P.z.array(X)})});class J{async execute({body:e}){const t=await this.ssoProvisioningStore.getState(),s=t.global.teamUuid;if(!s)throw new Error("SSO Migration failed: TeamUuid is missing");if(t.ssoSolution===u.WO.enum.ssoConnector){if(!e.ssoConnectorKey)return(0,b.Rn)((0,G.hw)());if(!new RegExp("^[0-9a-f]{8}[-]([0-9a-f]{4}[-]){3}[0-9a-f]{12}\\|[0-9a-zA-Z/+]{86}==$").test(e.ssoConnectorKey))return(0,b.Rn)((0,G.Fw)())}const n=e.ssoConnectorKey||await this.getSsoConnectorKey(),r=await this.getTeamDomains(),{samlIdpCertificate:i,ssoIdpEntrypoint:a}=await this.getIdpData(),o=await this.getTeamDeviceToMigrate(),c=await this.getScimToken(o.accessKey),d=await(async e=>{const t=await e.commands.registerTeamDevice({platform:q.h.NITRO,deviceName:"Nitro Encryption Service"});if((0,b.hx)(t))return t;const{data:{deviceAccessKey:s,deviceSecretKey:n}}=H.parse((0,b.db)(t)),r=await e.commands.registerTeamDeviceAccount({deviceAccessKey:s,shouldGenerateDeviceKeyPair:!0});if((0,b.hx)(r))return r;const{data:{devicePrivateKey:i,devicePublicKey:a}}=W.parse((0,b.db)(r));return(0,b.Vp)({deviceAccessKey:s,deviceSecretKey:n,devicePrivateKey:i,devicePublicKey:a})})(this.carbonClient);if((0,b.hx)(d))throw new Error("SSO Migration failed: Unable to register team device with account with error");const{deviceAccessKey:l,deviceSecretKey:p,devicePublicKey:m,devicePrivateKey:h}=(0,b.db)(d),{adminProvisioningKey:g,team:v}=await this.createTeamForMigration({teamDeviceCredentials:{teamUuid:s,accessKey:l,secretKey:p,sharingPublicKey:m,sharingPrivateKey:h},masterServiceProviderKey:n,domains:r,certificates:[i],entrypoint:a,scimToken:c});return await this.runSideEffects({currentState:t,adminProvisioningKey:g,teamDeviceToMigrate:o,team:v}),(0,b.Vp)(void 0)}async getTeamDomains(){const e=await this.carbonClient.commands.getTeamDomains();if((0,b.hx)(e))throw new Error("SSO Migration failed: Unable to retrieve team domains");const t=(0,b.db)(e);if(!t.success)throw new Error("SSO Migration failed: Unable to retrieve team domains");return t.domains.map((e=>e.name))}async getIdpData(){const e=await(0,f.z)(this.teamPlanDetails.queries.getTeamSsoInfo());if((0,b.hx)(e))throw new Error("SSO Migration failed: Cannot retrieve any SSO information");const{ssoIdpEntrypoint:t,ssoIdpMetadata:s}=(0,b.db)(e);if(!t||!s)throw new Error("SSO Migration failed: Cannot retrieve Idp info. ssoIdpEntrypoint or ssoIdpMetadata is missing");const{samlIdpCertificate:n}=await L(this.carbonClient,s);return{samlIdpCertificate:n,ssoIdpEntrypoint:t}}async getSsoConnectorKey(){const e=await(0,f.z)(this.teamPlanDetails.queries.getTeamId());if((0,b.hx)(e))throw new Error("SSO Migration failed: Unable to retrieve team id");const t=(0,b.db)(e).teamId??"",s=await(0,f.z)(this.carbonClient.queries.carbonState({path:"userSession.teamAdminData.teams"}));if((0,b.hx)(s))throw new Error("SSO Migration failed: Unable to retrieve teamAdminData");const n=P.z.record(P.z.string(),P.z.object({ssoConnectorKey:P.z.object({ssoConnectorKey:P.z.string()})})),r=(0,b.db)(s),i=n.safeParse(r);if(!i.success)throw new Error("SSO Migration failed: Unable to retrieve ssoConnectorKey");return i.data[t].ssoConnectorKey.ssoConnectorKey}async getScimToken(e){const t=await this.carbonClient.commands.getTeamDeviceEncryptedConfig({draft:!1,deviceAccessKey:e});if((0,b.hx)(t))throw new Error("SSO Migration failed: Unable to retrieve scim token");const s=(0,b.db)(t);if(s.success)return s.data?.configProperties.scimAuthToken||void 0}async getTeamDeviceToMigrate(){const e=await(async e=>{const{listTeamDevices:t}=e.commands,s=await t();if((0,b.hx)(s))throw new Error("Failed to get team devices");const{data:{teamDevices:n}}=Z.parse(s.data),r=n.filter((e=>Y.includes(e.platform)&&e.activated)),i=e=>e.reduce(((e,t)=>!e||t.updateDateUnix>e.updateDateUnix?t:e),null),a=r.filter((e=>e.platform===Q.enum.nitro_encryption_service)),o=r.filter((e=>e.platform===Q.enum.encryption_service)),c=r.filter((e=>e.platform===Q.enum.sso_connector));return o.length?i(o):c.length?i(c):i(a)})(this.carbonClient);if(!e)throw new Error("SSO Migration failed: no active team device found");return e}getDomainInfoFromTeam(e){return Object.entries(e.domains).reduce(((e,[t,s])=>(e.domainSetup.push({domainName:t,verificationStatus:s.dnsCheckStatus.status??"pending"}),e.domainVerificationInfo[t]={txtValue:s.dnsCheckStatus.verificationToken,verificationStatus:u.X5.parse(s.dnsCheckStatus.status),subdomainValue:m,pendingReason:s.dnsCheckStatus.pendingReason,tokenFound:null},e)),{domainSetup:(0,K.Ay)([]),domainVerificationInfo:(0,K.Ay)({})})}async runSideEffects({currentState:e,adminProvisioningKey:t,teamDeviceToMigrate:s,team:n}){await this.carbonClient.commands.persistAdminProvisioningKey({adminProvisioningKey:t}),await this.carbonClient.commands.updateTeamSettings({ssoServiceProviderUrl:this.ssoServiceProviderUrl,ssoSolution:u.WO.enum.confidentialSaml,provisioningSolution:$.Hh.enum.confidentialScim}),this.eventEmitter.sendEvent("ssoSolutionChanged",u.WO.enum.confidentialSaml);const{domainSetup:r,domainVerificationInfo:i}=this.getDomainInfoFromTeam(n),a=Object.entries(n.idps).map((([e])=>e))[0];await this.ssoProvisioningStoreUpdater.set({...e,ssoSolution:u.WO.enum.confidentialSaml,ssoStatus:u.pI.enum.incomplete,global:{...e.global,adminProvisioningKey:t,ssoIsNitroProvider:!0,isTeamProvisionedInNitro:!0},idpMetadata:{...e.idpMetadata,idpUuid:a},domainSetup:r,domainVerificationInfo:i}),await this.carbonClient.commands.deactivateTeamDevice({teamDeviceAccessKey:s.accessKey})}async createTeamForMigration(e){const t=await this.enclaveApiClient.teams.createTeamForMigration(e);if((0,b.hx)(t))throw new Error("SSO Migration to confidential failed: Unable to create team for migration");const{adminProvisioningKey:s,team:n}=(0,b.db)(t);return{adminProvisioningKey:s,team:n}}constructor(e,t,s,n,r,i){this.enclaveApiClient=e,this.ssoProvisioningStoreUpdater=t,this.ssoProvisioningStore=s,this.carbonClient=n,this.teamPlanDetails=r,this.eventEmitter=i,this.ssoServiceProviderUrl=new URL(this.enclaveApiClient.enclaveUrl).origin}}J=(0,n.gn)([(0,T.W)(G.Dt),(0,n.w6)("design:type",Function),(0,n.w6)("design:paramtypes",[void 0===E.l?Object:E.l,void 0===h?Object:h,void 0===p.M?Object:p.M,void 0===_._?Object:_._,void 0===w.e?Object:w.e,void 0===v?Object:v])],J);var ee=s(99614);const te=["DOMAIN_NOT_FOUND","DOMAIN_CONFIGURATION_NOT_FOUND"];class se{async execute({body:e}){const t=await this.ssoProvisioningStore.getState();if(!t.global.teamUuid)return(0,b.Rn)({tag:"TeamIdNotFound"});if(!t.global.adminProvisioningKey)return(0,b.Rn)({tag:"AdminProvisioningKeyNotFound"});if(!e.domainName)return(0,b.Rn)({tag:"DomainNameNotProvided"});try{const s=await this.enclaveApiClient.domains.deleteDomain({domainName:e.domainName,teamUuid:t.global.teamUuid,adminProvisioningKey:t.global.adminProvisioningKey});if((0,b.hx)(s))return s}catch(e){const t=e instanceof Error?e.message:"Unable to delete domain.";if(!te.includes(t))throw e}return await this.applyDeleteDomainOnState(t,e.domainName),(0,b.Vp)(void 0)}async applyDeleteDomainOnState(e,t){e.domainSetup=e.domainSetup.filter((e=>e.domainName!==t)),delete e.domainVerificationInfo[t],await this.ssoProvisioningStoreUpdater.set(e)}constructor(e,t,s,n){this.enclaveApiClient=e,this.ssoProvisioningStoreUpdater=t,this.ssoProvisioningStore=s,this.featureFlipsClient=n}}se=(0,n.gn)([(0,T.W)(ee.k),(0,n.w6)("design:type",Function),(0,n.w6)("design:paramtypes",[void 0===E.l?Object:E.l,void 0===h?Object:h,void 0===p.M?Object:p.M,void 0===O.P?Object:O.P])],se);var ne=s(60590),re=s(88187);class ie{async execute(){const e=await this.ssoProvisioningStore.getState(),{global:{adminProvisioningKey:t,teamUuid:s},idpMetadata:{idpUuid:n}}=e;if(!t||!s||!n)return(0,b.Rn)({tag:"MissingCommandParameters"});try{const e=await this.enclaveApiClient.authentication.requestTestLogin({adminProvisioningKey:t,teamUuid:s,idpUuid:n});if((0,b.hx)(e))return e;const{idpAuthorizeUrl:r}=(0,b.db)(e),{samlToken:i}=await this.enclaveLoginContext.getSamlFromLogin(r,!1);return await this.enclaveApiClient.authentication.confirmTestLogin({teamUuid:s,adminProvisioningKey:t,idpUuid:n,samlResponse:i}),await this.enclaveLoginContext.cleanupTestLogin(),(0,b.Vp)(void 0)}catch{return(0,b.Rn)({tag:"FailedToLoginIntoSsoProvider"})}}constructor(e,t,s,n,r){this.enclaveApiClient=e,this.enclaveLoginContext=t,this.platformInfoService=s,this.ssoProvisioningStore=n,this.featureFlips=r}}ie=(0,n.gn)([(0,T.W)(re.b),(0,n.w6)("design:type",Function),(0,n.w6)("design:paramtypes",[void 0===E.l?Object:E.l,void 0===U?Object:U,void 0===ne.t?Object:ne.t,void 0===p.M?Object:p.M,void 0===O.P?Object:O.P])],ie);var ae=s(75998);class oe{async execute({body:e}){const{commands:{carbon:t}}=this.carbonLegacy,s=await(async(e,t)=>{if(null===t)return;const s=await e({name:"parseMetadataFields",args:[{ssoIdpMetadata:t}]});return(0,b.d6)(s)?void 0:R.parse(s.error).error})(t,e.metadata);return s?(0,b.Rn)({tag:s}):(0,b.Vp)(void 0)}constructor(e){this.carbonLegacy=e}}oe=(0,n.gn)([(0,T.W)(ae.l),(0,n.w6)("design:type",Function),(0,n.w6)("design:paramtypes",[void 0===_._?Object:_._])],oe);var ce=s(37461),de=s(51448);const le=async(e,t)=>{const{updateTeamSettings:s}=e.commands;await s({...t})};class ue{async execute({body:e}){try{await this.setupConfidentialTeam()}catch{return(0,b.Rn)({tag:"setup_confidential_team_failed"})}const t=await this.ssoProvisioningStore.getState(),{adminProvisioningKey:s,teamUuid:n}=t.global;if(!s||!n)return(0,b.Rn)({tag:"internal_error"});const{metadata:r}=e;let i="",a="";try{const e=await L(this.carbon,r);a=e.samlIdpEntryPoint,i=e.samlIdpCertificate}catch{return(0,b.Rn)({tag:"invalid_metadata_content"})}try{const e=t.idpMetadata.idpUuid,o={adminProvisioningKey:s,teamUuid:n,idpMetadata:{certificates:[i],entrypoint:a}},c=e?await this.enclaveApiClient.idps.updateIdp({...o,idpMetadata:{...o.idpMetadata,idpUuid:e}}):await this.enclaveApiClient.idps.createIdp(o);if((0,b.hx)(c))return c;const{idpUuid:d}=(0,b.db)(c);await this.ssoProvisioningStoreUpdater.set({...t,idpMetadata:{...t.idpMetadata,idpUuid:d,metadataValue:r}});try{await le(this.carbon,{ssoIdpMetadata:r,ssoIdpEntrypoint:a})}catch(e){return(0,b.Rn)({tag:"save_metadata_failed"})}}catch(e){return(0,b.Rn)({tag:"domain_update_failed"})}return(0,b.Vp)(void 0)}async setupConfidentialTeam(){const{global:e}=await this.ssoProvisioningStore.getState(),{ssoIsNitroProvider:t,adminProvisioningKey:s}=e;return s&&t||await this.ssoClient.commands.createTeam(),(0,b.Vp)(void 0)}constructor(e,t,s,n,r,i){this.enclaveApiClient=e,this.platformInfoService=t,this.ssoProvisioningStoreUpdater=s,this.ssoProvisioningStore=n,this.carbon=r,this.ssoClient=i}}ue=(0,n.gn)([(0,T.W)(ce.o),(0,n.w6)("design:type",Function),(0,n.w6)("design:paramtypes",[void 0===E.l?Object:E.l,void 0===ne.t?Object:ne.t,void 0===h?Object:h,void 0===p.M?Object:p.M,void 0===_._?Object:_._,void 0===de.E?Object:de.E])],ue);var pe=s(80246);class me{async execute(e){const t=await this.ssoProvisioningStore.getState(),{global:{adminProvisioningKey:s},domainVerificationInfo:n,domainSetup:r}=t,i=e.body.domainName;if(!s)return(0,b.Rn)({tag:"AdminProvisioningKeyNotFound"});if(!i)return(0,b.Rn)({tag:"DomainNameNotProvided"});let a;try{const e=await this.enclaveApiClient.domains.checkDnsValidation({domainName:i,adminProvisioningKey:s,teamUuid:t.global.teamUuid??""});if((0,b.hx)(e))return e;a=(0,b.db)(e)}catch{return(0,b.Rn)({tag:"CouldNotVerifyDns"})}const o=n[i];o.txtValue=a.verificationToken,o.verificationStatus=a.status,o.tokenFound=a.tokenFound??null,o.pendingReason=a.pendingReason;const c=r.map((e=>(e.domainName===i&&(e.verificationStatus=a.status),e)));return await this.ssoProvisioningStoreUpdater.set({...t,domainSetup:c,domainVerificationInfo:{...n,[i]:o}}),(0,b.Vp)(void 0)}constructor(e,t,s,n){this.enclaveApiClient=e,this.ssoProvisioningStoreUpdater=t,this.ssoProvisioningStore=s,this.featureFlips=n}}me=(0,n.gn)([(0,T.W)(pe.o),(0,n.w6)("design:type",Function),(0,n.w6)("design:paramtypes",[void 0===E.l?Object:E.l,void 0===h?Object:h,void 0===p.M?Object:p.M,void 0===O.P?Object:O.P])],me);var he=s(82062);class ge{async execute(){const e=await this.ssoProvisioningStore.getState();if(e.enableSSO.ssoEnabled)return(0,b.Rn)({tag:"SsoAlreadyEnabled"});const{commands:{carbon:t}}=this.carbonLegacy,s=await(async(e,{ssoEnabled:t})=>{const s=await e({name:"updateTeamSettings",args:[{ssoEnabled:t}]});return!(0,b.hx)(s)})(t,{ssoEnabled:!0});return s?(await this.ssoProvisioningStore.set({...e,ssoStatus:u.pI.enum.enabled,global:{...e.global},enableSSO:{...e.enableSSO,ssoEnabled:!0}}),(0,b.Vp)(void 0)):(0,b.Rn)({tag:"EnableSsoFailed"})}constructor(e,t,s){this.ssoProvisioningStoreUpdater=e,this.ssoProvisioningStore=t,this.carbonLegacy=s}}ge=(0,n.gn)([(0,T.W)(he.F),(0,n.w6)("design:type",Function),(0,n.w6)("design:paramtypes",[void 0===h?Object:h,void 0===p.M?Object:p.M,void 0===_._?Object:_._])],ge);var ve=s(90435),ye=s(89238);const fe=P.z.object({enabled:P.z.boolean()}).optional(),be=P.z.object({teamInfo:P.z.object({uuid:P.z.ostring().nullable(),ssoSolution:P.z.nativeEnum({selfHostedSaml:"self-hosted-saml",confidentialSaml:"confidential-saml",ssoConnector:"sso-connector",none:"none"}).optional().nullable(),ssoEnabled:P.z.boolean().optional(),ssoIsNitroProvider:P.z.boolean().optional(),ssoServiceProviderUrl:P.z.ostring().nullable(),ssoIdpMetadata:P.z.ostring().nullable(),ssoIdpEntrypoint:P.z.ostring().nullable()}),capabilities:P.z.object({sso:fe})}),Se=P.z.object({data:be}),we=P.z.object({message:P.z.string(),reason:P.z.nativeEnum(ye._V)});class Ee{async execute({body:{teamId:e}}){const t=await this.ssoProvisioningStore.getState(),s=await V(e,this.carbon.queries.carbonState);let n=null;const r=await(async e=>{const{getTeamInfo:t}=e.commands,s=await t();if((0,b.hx)(s))switch(we.parse(s.error).reason){case ye._V.UNAUTHORIZED:return(0,b.Rn)({tag:"UserNotAuthorized"});case ye._V.UNKNOWN_ERROR:return(0,b.Rn)({tag:"CouldNotGetTeamStatus"});default:throw new Error("An unexpected error happened while trying to retrieve team info")}const{data:{teamInfo:n,capabilities:r}}=Se.parse(s.data);return(0,b.Vp)({teamInfo:n,capabilities:r})})(this.carbon);if((0,b.d6)(r)&&r.data.teamInfo.uuid&&(n=r.data.teamInfo.uuid),!n)return this.appLogger.error("failed to clear settings: teamId was not found"),(0,b.Rn)({tag:"TeamIdNotFound"});if(!s)return this.appLogger.error("failed to clear settings: NitroTeam was not provisoned"),(0,b.Rn)({tag:"NitroTeamNotProvisioned"});try{await this.deleteCurrentTeam({...t,global:{...t.global,adminProvisioningKey:s,teamUuid:n}})}catch(e){const{message:t}=e;if("TEAM_NOT_FOUND"!==t&&"UNKNOWN_ERROR"!==t&&"MISMATCHING_ADMIN_PROVISIONING_KEY"!==t)return this.appLogger.error("failed to clear settings: could not delete Nitro team"),(0,b.Rn)({tag:"CouldNotDeleteNitroTeam"})}const i=await this.removeAdmingProvisioningKey();if((0,b.hx)(i))return this.appLogger.error("failed to clear settings: could not delete admin provisioning key"),i;const a=await this.clearLegacyTeamSettings();return(0,b.hx)(a)?(0,b.Rn)({tag:"CouldNotClearLegacyTeamSettings"}):(await this.ssoProvisioningStoreUpdater.reset(),this.eventEmitter.sendEvent("confidentialSsoSettingsReset",void 0),(0,b.Vp)(void 0))}async deleteCurrentTeam(e){const{global:t}=e;if(!t.adminProvisioningKey)return(0,b.Rn)({tag:"NitroTeamNotProvisioned"});const s={teamUuid:t.teamUuid,adminProvisioningKey:t.adminProvisioningKey};return await this.enclaveApiClient.teams.deleteTeam(s),(0,b.Vp)(void 0)}async clearLegacyTeamSettings(){try{await le(this.carbon,{provisioningSolution:null,ssoSolution:null,ssoServiceProviderUrl:null,ssoIdpMetadata:null,ssoIdpEntrypoint:null,ssoEnabled:!1}),this.eventEmitter.sendEvent("ssoSolutionChanged",u.WO.enum.none)}catch{return(0,b.Rn)({tag:"CouldNotClearLegacyTeamSettings"})}return(0,b.Vp)(void 0)}async removeAdmingProvisioningKey(){try{const{removeAdminProvisioningKey:e}=this.carbon.commands;await e()}catch{return(0,b.Rn)({tag:"CouldNotDeleteAdminProvisioningKey"})}return(0,b.Vp)(void 0)}constructor(e,t,s,n,r,i){this.enclaveApiClient=e,this.ssoProvisioningStoreUpdater=t,this.ssoProvisioningStore=s,this.appLogger=n,this.carbon=r,this.eventEmitter=i}}Ee=(0,n.gn)([(0,T.W)(ve.h),(0,n.w6)("design:type",Function),(0,n.w6)("design:paramtypes",[void 0===E.l?Object:E.l,void 0===h?Object:h,void 0===p.M?Object:p.M,void 0===I?Object:I,void 0===_._?Object:_._,void 0===v?Object:v])],Ee);var _e=s(56346);P.z.object({});class Ce{async execute({body:e}){const t=await this.ssoProvisioningStore.getState(),{adminProvisioningKey:s,teamUuid:n}=t.global,{idpUuid:r}=t.idpMetadata;if(!s||!n)return(0,b.Rn)((0,_e.Y3)());if(!r)return Promise.reject((0,b.Rn)((0,_e.B3)()));const{groupProvisioningActivated:i}=e;try{await this.enclaveApiClient.idps.updateIdp({adminProvisioningKey:s,teamUuid:n,idpMetadata:{idpUuid:r,groupProvisioningActivated:i}}),await this.ssoProvisioningStoreUpdater.set({...t,idpMetadata:{...t.idpMetadata,groupProvisioningActivated:i}})}catch(e){switch(e.message){case _e.hJ.MISMATCHING_ADMIN_PROVISIONING_KEY:return Promise.reject((0,b.Rn)((0,_e.HC)()));case _e.hJ.TEAM_NOT_FOUND:return Promise.reject((0,b.Rn)((0,_e.gY)()));case _e.hJ.IDP_NOT_FOUND:return Promise.reject((0,b.Rn)((0,_e.B3)()));case _e.hJ.NO_IDP_CONFIGURATION_UPDATE:return Promise.reject((0,b.Rn)((0,_e.b2)()));default:return Promise.reject((0,b.Rn)((0,_e.Y3)()))}}return(0,b.Vp)(void 0)}constructor(e,t,s){this.enclaveApiClient=e,this.ssoProvisioningStoreUpdater=t,this.ssoProvisioningStore=s}}Ce=(0,n.gn)([(0,T.W)(_e.Z5),(0,n.w6)("design:type",Function),(0,n.w6)("design:paramtypes",[void 0===E.l?Object:E.l,void 0===h?Object:h,void 0===p.M?Object:p.M])],Ce);var Ie=s(85798),Te=s(40923);class Ae{async handle({body:e}){if("ssoSolutionChanged"===e.eventName){const t=u.WO.safeParse(e.eventData);if(!t.success)throw new Error(`[Sso Setup] - Carbon setup wrong sso solution, got: ${e.eventData}`);this.eventEmitter.sendEvent("ssoSolutionChanged",t.data)}}constructor(e){this.eventEmitter=e}}Ae=(0,n.gn)([(0,Ie.b)(Te.Dj),(0,n.w6)("design:type",Function),(0,n.w6)("design:paramtypes",[void 0===v?Object:v])],Ae);var Ue=s(6136),Ne=s(43978),Oe=s(162),De=s(82567),Fe=s(87065),Pe=s(69885),Re=s(46449),xe=s(26549),Le=s(63874);class ke{execute(){return this.ssoProvisioningStore.state$.pipe((0,Ue.x)(),(0,Ne.w)((e=>e.isInitialized?(0,Pe.of)((0,b.Vp)(e)):(0,Oe.D)(this.ssoStateService.fetchInitialValue()).pipe((0,De.b)((e=>{this.ssoProvisioningStore.set(e)})),(0,Fe.U)((e=>(0,b.Vp)(e)))))))}constructor(e,t,s){this.httpClient=e,this.ssoProvisioningStore=t,this.ssoStateService=s}}ke=(0,n.gn)([(0,Re.e)(Le._),(0,n.w6)("design:type",Function),(0,n.w6)("design:paramtypes",[void 0===xe.e?Object:xe.e,void 0===p.M?Object:p.M,void 0===C?Object:C])],ke);var je=s(18306);class Me{execute(){return this.ssoProvisioningStore.state$.pipe((0,Fe.U)((e=>(0,b.Vp)({groupProvisioningActivated:e.idpMetadata.groupProvisioningActivated??!1}))))}constructor(e){this.ssoProvisioningStore=e}}Me=(0,n.gn)([(0,Re.e)(je.$),(0,n.w6)("design:type",Function),(0,n.w6)("design:paramtypes",[void 0===p.M?Object:p.M])],Me);class ze{}ze=(0,n.gn)([(0,r.Y)({api:d.y,handlers:{commands:{loginUserWithEnclaveSSO:N,provisionDomain:k,createTeam:B,migrateToConfidentialSso:J,deleteDomain:se,testLoginUserWithEnclaveSSO:ie,validateMetadata:oe,updateMetadata:ue,checkDNSValidation:me,enableSso:ge,clearSettings:Ee,updateGroupProvisioningConfiguration:Ce},events:{...(0,r.g)(y.W,{carbonLegacy:Ae})},queries:{ssoProvisioning:ke,getGroupProvisioningConfiguration:Me}},configurations:{enclaveLoginContextInfrastructure:{token:U}},imports:[i.X,o.i,c.G],exports:[p.M],stores:[p.M],providers:[h,v,C,(0,a.ND)(I)],requiredFeatureFlips:["itadmin_tac_encryptionservice_SSOmigration_reset","setup_rollout_reset_confidential_button","setup_rollout_web_ssoconnector_card","setup_rollout_confidential_migration"]})],ze)},48083:(e,t,s)=>{s.d(t,{M:()=>d});var n=s(62149),r=s(95450),i=s(63144),a=s(56618);const o=e=>r.JU.safeParse(e).success,c={isInitialized:!1,ssoSolution:r.WO.enum.none,ssoStatus:r.pI.enum.none,global:{adminProvisioningKey:null,teamUuid:null,ssoIsNitroProvider:null,isTeamProvisionedInNitro:null,ssoCapable:null},idpApplication:{entityId:null,acsUrl:null,signOnUrl:null},idpMetadata:{metadataValue:null,idpUuid:null,groupProvisioningActivated:null},domainSetup:[],domainVerificationInfo:{},enableSSO:{ssoEnabled:null}};class d extends((0,i.Q)({persist:!1,capacity:a.Y._010KB,initialValue:c,scope:n.F.User,storeName:"nitro-sso-provisioning-state",storeTypeGuard:o})){}},78857:(e,t,s)=>{s.d(t,{X:()=>g});var n=s(7165),r=s(56773),i=s(70101),a=s(21597),o=s(96344),c=s(87163),d=s(71751),l=s(96754),u=s(42700),p=s(99743),m=s(36610);const h=n.z.object({type:n.z.string(),saml:n.z.string()});class g{checkMessageType(e){return!this.samlReceived&&"SamlAssertionIntercepted"===e.type}interceptSamlFromTab(){return new Promise(((e,t)=>{if(!this.onMessageListener)return t(new Error("OnMessage event listener is not available in current context"));const s=i.$.addListener((e=>{e===this.interceptedTabId&&(i.$.removeListener(s),t(new Error("Intercepting SAML - tab closed unexpectedly")))}));this.onMessageListener.events$.pipe((0,r.P)()).subscribe((([n])=>{const r=h.safeParse(n);r.success?(this.samlReceived=!0,i.$.removeListener(s),e({samlToken:r.data.saml})):t(new Error("Intercepting SAML - received message could not be parsed"))}))}))}async redirectTabToUrl(e){if(this.interceptedTabId)return await(0,a.V)(this.interceptedTabId,{url:e});{const t=(await(0,o.T)({windowTypes:["normal"]})).id;return await(0,c.U)({windowId:t,url:e})}}async getActiveExtensionTabId(){const e=await(0,d.I)({currentWindow:!0,active:!0}),t=e.length>0?e[0]:null,s=(0,l.A)("");if(t?.id&&t.url?.includes(s))return t.id}async getSamlFromLogin(e,t,s){this.samlReceived=!1,this.originalTabId=void 0,this.interceptedTabId&&(await(0,u.O)([this.interceptedTabId]).catch((()=>{})),this.interceptedTabId=void 0);const n=async(t=!0)=>{const s=await(0,c.U)({url:e,active:t});return this.interceptedTabId=s.id,await this.interceptSamlFromTab()},r=async t=>{this.interceptedTabId=t;const s=this.interceptSamlFromTab();return await(0,a.V)(t,{url:e}),s};return t?this.getActiveExtensionTabId().then((e=>e?r(e):n(s))):this.getActiveExtensionTabId().then((e=>(this.originalTabId=e,n(s))))}async redirectUserIntoLoginFlow(e){const t={ssoToken:e.ssoToken,exists:e.exists,currentAuths:e.currentAuthenticationMethods,expectedAuths:e.expectedAuthenticationMethods,key:e.userServiceProviderKey,login:e.login},s=Object.entries(t).map((e=>`${e[0]}=${encodeURIComponent(e[1].toString())}`)).join("&"),n=(0,l.A)(`index.html#/sso?${s}`);await this.redirectTabToUrl(n)}async redirectUserToLoginPage(){const e=(0,l.A)("index.html#/login");await this.redirectTabToUrl(e)}async cleanupTestLogin(){this.interceptedTabId&&await(0,u.O)([this.interceptedTabId]).catch((()=>{})),this.originalTabId&&(0,a.V)(this.originalTabId,{active:!0})}constructor(){this.interceptedTabId=void 0,this.originalTabId=void 0,this.samlReceived=!1;try{this.onMessageListener=new m.j({source:p.p,filter:this.checkMessageType.bind(this)})}catch{}}}},4174:(e,t,s)=>{s.d(t,{Q:()=>i});var n=s(8260),r=s(98768);class i extends((0,n.E)(r.r)){}(0,n.K)(r.r,i)},98768:(e,t,s)=>{s.d(t,{r:()=>a});var n=s(75958),r=s(16541),i=s(74430);const a=(0,n.Q)({name:"sync",commands:{SyncCommand:r.t},queries:{SyncProgressQuery:i.F},events:{}})},16541:(e,t,s)=>{s.d(t,{t:()=>i});var n=s(13385),r=s(62149);class i extends((0,n.g)({scope:r.F.Device})){}},74430:(e,t,s)=>{s.d(t,{F:()=>i});var n=s(77535),r=s(62149);class i extends((0,n.k)({scope:r.F.Device})){}},90993:(e,t,s)=>{s.d(t,{L:()=>n,_:()=>r});var n=function(e){return e.READY="ready",e.IN_PROGRESS="in_progress",e.SUCCESS="success",e.FAILURE="failure",e}({});class r{}},90904:(e,t,s)=>{s.d(t,{R:()=>T});var n=s(92336),r=s(86006),i=s(62149),a=s(98768),o=s(90993),c=s(41842),d=s(60399),l=s(92587),u=s(14122),p=s(78346),m=s(33312);const h=e=>"object"==typeof e&&null!==e&&"status"in e&&Object.values(o.L).includes(e.status);var g=s(98124);class v extends((0,g.Hu)("SyncError","An error occoured while trying to sync the vault")){}class y{async attemptSync(e){await this.carbonLegacy.commands.carbonLegacyLeeloo({name:"sessionForceSync",arg:[{trigger:e}]})}async waitForSync(e){const t=this.getSyncState().pipe((0,c.h)((e=>!(!(0,p.d6)(e)||!h(e.data))&&[o.L.FAILURE,o.L.SUCCESS].includes(e.data.status))),(0,m.DZ)((()=>new v)),(0,m.lk)((e=>e.status===o.L.FAILURE?(0,p.Rn)({tag:"Sync failed"}):(0,p.Vp)(void 0))));return await this.attemptSync(e),(0,d.z)(t)}getSyncState(){return this.carbonLegacy.queries.carbonState({path:"userSession.sync"}).pipe((0,m.Qn)((e=>{if(!h(e))throw new Error("Bad sync state format");return{status:e.status}})))}constructor(e){this.carbonLegacy=e}}y=(0,n.gn)([(0,l.GS)(),(0,n.w6)("design:type",Function),(0,n.w6)("design:paramtypes",[void 0===u._?Object:u._])],y);var f=s(48062);class b{async run(){return await this.syncService.attemptSync(f.Trigger.Periodic),Promise.resolve()}constructor(e){this.syncService=e}}b=(0,n.gn)([(0,l.GS)(),(0,n.w6)("design:type",Function),(0,n.w6)("design:paramtypes",[void 0===o._?Object:o._])],b);var S=s(82874),w=s(16541);class E{execute(e){const{trigger:t}=e.body;return this.syncService.attemptSync(t),Promise.resolve((0,p.Vp)(void 0))}constructor(e){this.syncService=e}}E=(0,n.gn)([(0,S.W)(w.t),(0,n.w6)("design:type",Function),(0,n.w6)("design:paramtypes",[void 0===o._?Object:o._])],E);var _=s(46449),C=s(74430);class I{execute(){return this.syncService.getSyncState()}constructor(e){this.syncService=e}}I=(0,n.gn)([(0,_.e)(C.F),(0,n.w6)("design:type",Function),(0,n.w6)("design:paramtypes",[void 0===o._?Object:o._])],I);class T{}T=(0,n.gn)([(0,r.Y)({api:a.r,handlers:{commands:{sync:E},events:{},queries:{syncProgress:I}},crons:[{handler:b,periodInMinutes:5,name:"periodic-sync-cron",scope:i.F.User}],providers:[{provide:o._,useClass:y}],exports:[o._]})],T)},58605:(e,t,s)=>{s.d(t,{$:()=>r});var n=s(98124);class r extends((0,n.Hu)("UserIsNotAdmin","User is not an admin")){}},11512:(e,t,s)=>{s.d(t,{t:()=>o});var n=s(75958),r=s(85187),i=s(71379),a=s(43613);const o=(0,n.Q)({name:"inviteLink",commands:{toggleInviteLink:r.s,requestUserInviteTokenSending:i.T},events:{},queries:{inviteLinkData:a.$}})},71379:(e,t,s)=>{s.d(t,{T:()=>i});var n=s(13385),r=s(62149);class i extends((0,n.g)({scope:r.F.User})){}},85187:(e,t,s)=>{s.d(t,{s:()=>i});var n=s(13385),r=s(62149);class i extends((0,n.g)({scope:r.F.User})){}},43613:(e,t,s)=>{s.d(t,{$:()=>a,D:()=>i});var n=s(77535),r=s(62149),i=function(e){return e.NOT_LOADED="not_loaded",e.NOT_CREATED="not_created",e.READY="ready",e}({});class a extends((0,n.k)({scope:r.F.User})){}},58164:(e,t,s)=>{s.d(t,{t:()=>T});var n=s(75958),r=s(36486),i=s(31521),a=s(93595),o=s(23578),c=s(14485),d=s(61358),l=s(81940),u=s(4093),p=s(69877),m=s(56859),h=s(56276),g=s(59875),v=s(92179),y=s(7310),f=s(91206),b=s(66385),S=s(16883),w=s(75178),E=s(74629),_=s(31432),C=s(75008),I=s(97786);const T=(0,n.Q)({name:"teamAdminNotifications",commands:{markB2BPlanDiscontinuedSeen:r.q,markCRDRisksFoundInfoboxSeen:i.e,markIdPFailedNotificationSeen:a.b,markIdPNeedsSeatsInfoboxSeen:o.k,markIdPNeedsSeatsInfoboxInPopupSeen:c.N,markIdPProvisioningsPendingInfoboxSeen:d.r,markNewRestrictSharingPolicySeen:l.o,markNotificationTrialExtendedSeen:u.D,markOfferToExtendFreeTrialSeen:p.R,markStarterRepackagePolicyInfoboxSeen:m.z},events:{},queries:{getIdPFailedProvisioningsData:h.It,getIdPFixedProvisioningsData:g.Un,hasSeenB2BPlanDiscontinued:v.z,hasSeenCRDRisksFoundInfobox:y.e,hasSeenIdPFailedNotification:f.g,hasSeenIdPNeedsSeatsInfoboxInPopup:b.k,hasSeenIdPNeedsSeatsInfobox:S.T,hasSeenIdPProvisioningsPendingInfobox:w.S,hasSeenNewRestrictSharingPolicy:E.x,hasSeenNotificationTrialExtended:_.q,hasSeenOfferToExtendFreeTrial:C.U,HasSeenStarterRepackagePolicyInfobox:I.i}})},36486:(e,t,s)=>{s.d(t,{q:()=>i});var n=s(13385),r=s(62149);class i extends((0,n.g)({scope:r.F.User})){}},31521:(e,t,s)=>{s.d(t,{e:()=>i});var n=s(13385),r=s(62149);class i extends((0,n.g)({scope:r.F.User})){}},93595:(e,t,s)=>{s.d(t,{b:()=>i});var n=s(13385),r=s(62149);class i extends((0,n.g)({scope:r.F.User})){}},14485:(e,t,s)=>{s.d(t,{N:()=>i});var n=s(13385),r=s(62149);class i extends((0,n.g)({scope:r.F.User})){}},23578:(e,t,s)=>{s.d(t,{k:()=>i});var n=s(13385),r=s(62149);class i extends((0,n.g)({scope:r.F.User})){}},61358:(e,t,s)=>{s.d(t,{r:()=>i});var n=s(13385),r=s(62149);class i extends((0,n.g)({scope:r.F.User})){}},81940:(e,t,s)=>{s.d(t,{o:()=>i});var n=s(13385),r=s(62149);class i extends((0,n.g)({scope:r.F.User})){}},4093:(e,t,s)=>{s.d(t,{D:()=>i});var n=s(13385),r=s(62149);class i extends((0,n.g)({scope:r.F.User})){}},69877:(e,t,s)=>{s.d(t,{R:()=>i});var n=s(13385),r=s(62149);class i extends((0,n.g)({scope:r.F.User})){}},56859:(e,t,s)=>{s.d(t,{z:()=>i});var n=s(13385),r=s(62149);class i extends((0,n.g)({scope:r.F.User})){}},56276:(e,t,s)=>{s.d(t,{C$:()=>a,It:()=>c,qj:()=>o});var n=s(77535),r=s(62149),i=s(98124),a=function(e){return e.NOT_ADMIN="not_admin",e.SERVER_ERROR="server_error",e}({});const o=(0,i.Vj)("not_admin","User is not an admin");(0,i.Vj)("server_error","Server error while retrieving IdP Notifications data");class c extends((0,n.k)({scope:r.F.User})){}},59875:(e,t,s)=>{s.d(t,{Go:()=>a,Un:()=>o});var n=s(77535),r=s(62149),i=s(98124);const a=(0,i.Vj)("not_admin","User is not an admin");(0,i.Vj)("server_error","Server error while retrieving IdP Notifications data");class o extends((0,n.k)({scope:r.F.User})){}},92179:(e,t,s)=>{s.d(t,{z:()=>r});var n=s(77535);class r extends((0,n.k)()){}},7310:(e,t,s)=>{s.d(t,{e:()=>r});var n=s(77535);class r extends((0,n.k)()){}},91206:(e,t,s)=>{s.d(t,{g:()=>r});var n=s(77535);class r extends((0,n.k)()){}},66385:(e,t,s)=>{s.d(t,{k:()=>r});var n=s(77535);class r extends((0,n.k)()){}},16883:(e,t,s)=>{s.d(t,{T:()=>r});var n=s(77535);class r extends((0,n.k)()){}},75178:(e,t,s)=>{s.d(t,{S:()=>r});var n=s(77535);class r extends((0,n.k)()){}},74629:(e,t,s)=>{s.d(t,{x:()=>r});var n=s(77535);class r extends((0,n.k)()){}},31432:(e,t,s)=>{s.d(t,{q:()=>r});var n=s(77535);class r extends((0,n.k)()){}},75008:(e,t,s)=>{s.d(t,{U:()=>r});var n=s(77535);class r extends((0,n.k)()){}},97786:(e,t,s)=>{s.d(t,{i:()=>r});var n=s(77535);class r extends((0,n.k)()){}},72788:(e,t,s)=>{s.d(t,{L:()=>u});var n=s(75958),r=s(16396),i=s(37043),a=s(67267),o=s(35468),c=s(73895),d=s(22099),l=s(59509);const u=(0,n.Q)({name:"teamMembers",commands:{proposeMembers:r.og,dismissNonMembersInfobox:i.Y},events:{membersAdded:a.q},queries:{getNonMembersCount:o.H,getNonMembersList:c.Fz,getHasAdminDismissedInfobox:d.K,getMembersList:l.k}})},37043:(e,t,s)=>{s.d(t,{Y:()=>i});var n=s(13385),r=s(62149);class i extends((0,n.g)({scope:r.F.User})){}},16396:(e,t,s)=>{s.d(t,{Wv:()=>g,og:()=>v});var n=s(13385),r=s(62149),i=s(98124);const a=(0,i.Vj)("InvalidOrigin","Invalid origin"),o=(0,i.Vj)("NoFreeSlot","No free slot"),c=(0,i.Vj)("NoFreeSlotFreePlan","No free slot in free plan"),d=(0,i.Vj)("UserTeamInviteTokenNotFound","No invite token to a team available for user"),l=(0,i.Vj)("PaymentFailed","Payment failed"),u=(0,i.Vj)("NotBillingAdmin","User is not the billing admin"),p=(0,i.Vj)("CannotAddSeatDuringGracePeriod","Seats cannot be added during grace period"),m=(0,i.Vj)("UnsupportedPaymentMean","No valid credit card set for this users to add extra seats"),h=(0,i.Vj)("CannotProposeMemberAbove10","Your plan has a maximum of 10 users, to add more users please upgrade your plan");function g(e){switch(e){case"invalid_origin":return a();case"no_free_slot":return o();case"no_free_slot_free_plan":return c();case"USER_TEAM_INVITE_TOKEN_NOT_FOUND":return d();case"payment_failed":return l();case"not_billing_admin":return u();case"cannot_add_seat_during_grace_period":return p();case"unsupported_payment_mean":return m();case"CANNOT_PROPOSE_MEMBER_ABOVE_10":return h();default:throw new Error("Unknown server error")}}class v extends((0,n.g)({scope:r.F.User})){}},67267:(e,t,s)=>{s.d(t,{q:()=>i});var n=s(446),r=s(62149);class i extends((0,n.d)({scope:r.F.User})){}},22099:(e,t,s)=>{s.d(t,{K:()=>i});var n=s(77535),r=s(62149);class i extends((0,n.k)({scope:r.F.User})){}},59509:(e,t,s)=>{s.d(t,{k:()=>i});var n=s(77535),r=s(62149);class i extends((0,n.k)({scope:r.F.User})){}},35468:(e,t,s)=>{s.d(t,{H:()=>i});var n=s(77535),r=s(62149);class i extends((0,n.k)({scope:r.F.User})){}},73895:(e,t,s)=>{s.d(t,{Fz:()=>c,R0:()=>a,RD:()=>o});var n=s(7165),r=s(77535),i=s(62149);const a=n.z.object({userId:n.z.number(),login:n.z.string(),premiumStatus:n.z.enum(["free","subscribed","legacy"]),lastActivityDateUnix:n.z.number(),proposedState:n.z.enum(["proposed","not_in_team","in_team","revoked"])}),o=n.z.array(a);class c extends((0,r.k)({scope:i.F.User})){}},35475:(e,t,s)=>{s.d(t,{B:()=>i});var n=s(75958),r=s(58089);const i=(0,n.Q)({name:"teamPasswordHealth",commands:{},events:{},queries:{getReport:r.z}})},58089:(e,t,s)=>{s.d(t,{z:()=>i});var n=s(77535),r=s(62149);class i extends((0,n.k)({scope:r.F.User})){}},48666:(e,t,s)=>{s.d(t,{o:()=>O});var n=s(75958),r=s(36833),i=s(30561),a=s(52966),o=s(45364),c=s(8025),d=s(3434),l=s(23099),u=s(93216),p=s(20249),m=s(29151),h=s(49649),g=s(31933),v=s(93478),y=s(47883),f=s(8365),b=s(14784),S=s(44096),w=s(22283),E=s(88273),_=s(51183),C=s(22057),I=s(3463),T=s(20270),A=s(621),U=s(15640),N=s(10729);const O=(0,n.Q)({name:"teamPlanDetails",commands:{addSeats:r.E,extendFreeTrial:i.No,requestTeamPlanCancellation:a.y7,editTeamName:o.Q2,editTeamPolicies:c.m,sendFeedback:d.cr,updateBillingAdmin:l.t,refreshAdminCardInfo:u.H},events:{},queries:{getAdminCardInfo:p._,getIndustryBenchmarkData:m.l,getTeamActiveDirectoryInfo:h.e,getTeamBillingInformation:g._,getTeamCancellationStatus:v.F,getTeamCapabilities:y.Y,getTeamCreationDateUnixQuery:f.T,getTeamDuoInfo:b.Z,getTeamId:S.e,getTeamName:w.j,getTeamRoles:E.R,getTeamPolicies:_.K,getTeamProvisioningInfo:C.j,getTeamSeats:I.W,getTeamSecurityScore:T.R,getTeamSsoInfo:A.m,getTeamTrialStatus:U.P,isTeamCreator:N.G7}})},31108:(e,t,s)=>{s.d(t,{e:()=>i});var n=s(8260),r=s(48666);class i extends((0,n.E)(r.o)){}(0,n.K)(r.o,i)},36833:(e,t,s)=>{s.d(t,{E:()=>i});var n=s(13385),r=s(62149);class i extends((0,n.g)({scope:r.F.User})){}},45364:(e,t,s)=>{s.d(t,{Kv:()=>d,Q2:()=>l,QI:()=>c,U8:()=>a,mX:()=>o});var n=s(13385),r=s(62149),i=s(98124);const a=(0,i.Vj)("team_name_already_exists","That team name already exists"),o=(0,i.Vj)("INVALID_TEAM_SETTING_VALUE","The team setting value is invalid"),c=(0,i.Vj)("not_admin","User is not admin"),d=(0,i.Vj)("not_authorized","User is not authorized to perform this action");class l extends((0,n.g)({scope:r.F.User})){}},8025:(e,t,s)=>{s.d(t,{m:()=>i});var n=s(13385),r=s(62149);class i extends((0,n.g)({scope:r.F.User})){}},30561:(e,t,s)=>{s.d(t,{AP:()=>c,No:()=>u,RQ:()=>d,gv:()=>o,lO:()=>l,sK:()=>a});var n=s(13385),r=s(62149),i=s(98124),a=function(e){return e.TEAM_NOT_FOUND="TEAM_NOT_FOUND",e.NOT_IN_FREE_TRIAL="TEAM_NOT_FREE_TRIAL",e.IN_GRACE_PERIOD="TEAM_IN_GRACE_PERIOD",e.USER_NOT_ADMIN="not_admin",e}({});const o=(0,i.Vj)("TEAM_NOT_FOUND","Team not found"),c=(0,i.Vj)("TEAM_NOT_FREE_TRIAL","Team is not in a free trial"),d=(0,i.Vj)("TEAM_IN_GRACE_PERIOD","User trial is already extended. User is in grace period"),l=(0,i.Vj)("not_admin","User is not admin");class u extends((0,n.g)({scope:r.F.User})){}},93216:(e,t,s)=>{s.d(t,{H:()=>i});var n=s(13385),r=s(62149);class i extends((0,n.g)({scope:r.F.User})){}},52966:(e,t,s)=>{s.d(t,{Rb:()=>c,VH:()=>a,fz:()=>o,y7:()=>d});var n=s(13385),r=s(62149),i=s(98124);const a=(0,i.Vj)("TEAM_IN_FREE_TRIAL","Team is in a free trial"),o=(0,i.Vj)("TEAM_IS_DISCONTINUED","Team is discontinued"),c=(0,i.Vj)("NOT_ADMIN","User is not admin");class d extends((0,n.g)({scope:r.F.User})){}},3434:(e,t,s)=>{s.d(t,{b6:()=>a,cr:()=>o});var n=s(13385),r=s(62149),i=s(98124);const a=(0,i.Vj)("INVALID_FEEDBACK","The provided feedback is invalid and won't be shared");class o extends((0,n.g)({scope:r.F.User})){}},23099:(e,t,s)=>{s.d(t,{t:()=>i});var n=s(13385),r=s(62149);class i extends((0,n.g)({scope:r.F.User})){}},20249:(e,t,s)=>{s.d(t,{_:()=>i});var n=s(77535),r=s(62149);class i extends((0,n.k)({scope:r.F.User})){}},29151:(e,t,s)=>{s.d(t,{l:()=>i});var n=s(77535),r=s(62149);class i extends((0,n.k)({scope:r.F.User})){}},49649:(e,t,s)=>{s.d(t,{e:()=>i});var n=s(77535),r=s(62149);class i extends((0,n.k)({scope:r.F.User})){}},31933:(e,t,s)=>{s.d(t,{_:()=>i});var n=s(77535),r=s(62149);class i extends((0,n.k)({scope:r.F.User})){}},93478:(e,t,s)=>{s.d(t,{F:()=>i});var n=s(77535),r=s(62149);class i extends((0,n.k)({scope:r.F.User})){}},47883:(e,t,s)=>{s.d(t,{Y:()=>i});var n=s(77535),r=s(62149);class i extends((0,n.k)({scope:r.F.User})){}},8365:(e,t,s)=>{s.d(t,{T:()=>i});var n=s(77535),r=s(62149);class i extends((0,n.k)({scope:r.F.User})){}},14784:(e,t,s)=>{s.d(t,{Z:()=>i});var n=s(77535),r=s(62149);class i extends((0,n.k)({scope:r.F.User})){}},44096:(e,t,s)=>{s.d(t,{e:()=>i});var n=s(77535),r=s(62149);class i extends((0,n.k)({scope:r.F.User})){}},22283:(e,t,s)=>{s.d(t,{j:()=>i});var n=s(77535),r=s(62149);class i extends((0,n.k)({scope:r.F.User})){}},51183:(e,t,s)=>{s.d(t,{K:()=>i});var n=s(77535),r=s(62149);class i extends((0,n.k)({scope:r.F.User})){}},22057:(e,t,s)=>{s.d(t,{j:()=>i});var n=s(77535),r=s(62149);class i extends((0,n.k)({scope:r.F.User})){}},88273:(e,t,s)=>{s.d(t,{R:()=>i});var n=s(77535),r=s(62149);class i extends((0,n.k)({scope:r.F.User})){}},3463:(e,t,s)=>{s.d(t,{W:()=>i});var n=s(77535),r=s(62149);class i extends((0,n.k)({scope:r.F.User})){}},20270:(e,t,s)=>{s.d(t,{R:()=>i});var n=s(77535),r=s(62149);class i extends((0,n.k)({scope:r.F.User})){}},621:(e,t,s)=>{s.d(t,{m:()=>i});var n=s(77535),r=s(62149);class i extends((0,n.k)({scope:r.F.User})){}},15640:(e,t,s)=>{s.d(t,{P:()=>i});var n=s(77535),r=s(62149);class i extends((0,n.k)({scope:r.F.User})){}},10729:(e,t,s)=>{s.d(t,{G7:()=>o});var n=s(77535),r=s(62149),i=s(98124);const a=(0,i.Vj)("NOT_LOGGED","Please log the user");(0,i.Vj)("NOT_ADMIN","User is not an admin");class o extends((0,n.k)({scope:r.F.User,noUserError:a()})){}},45836:(e,t,s)=>{s.d(t,{F:()=>a,Gr:()=>c,Uz:()=>o,lD:()=>r,qo:()=>i,ym:()=>l,yt:()=>d});var n=s(7165),r=function(e){return e.Legacy="legacy",e.Starter="starter",e.Team="team",e.Business="business",e.BusinessPlus="businessplus",e.Enterprise="entreprise",e.Standard="standard",e}({}),i=function(e){return e.ProcessOut="processout",e.Invoice="invoice",e}({}),a=function(e){return e.USD="usd",e.EUR="eur",e}({}),o=function(e){return e.Pending="pending",e.Canceled="canceled",e.None="none",e.Unknown="unknown",e}({});const c={ChoseOtherPasswordManager:"chose_other_password_manager",DownsizedEmployeeCount:"downsized_employee_count",MissingCriticalFeatures:"missing_critical_features",NoInternalUsage:"no_internal_usage",Other:"other",TechnicalIssues:"technical_issues",TooExpensive:"too_expensive"};var d=function(e){return e.InTeam="in_team",e.NotPremium="not_premium",e.NoPayment="no_payment",e.IsUnpaidFamilyMember="is_unpaid_family_member",e.DefaultSettings="default_settings",e.NoVPNCapability="no_vpn_capability",e.DisabledForFreeUser="disabled_for_free_user",e}({});const l=n.z.object({allowPersistenceForMasterPassword:n.z.boolean(),allowSharing:n.z.boolean(),sharingRestrictedToTeam:n.z.boolean(),enforce2FA:n.z.boolean(),cryptoForcedPayload:n.z.string(),disableAutoLoginDomains:n.z.array(n.z.string()),enableForcedDomains:n.z.boolean(),enablePersonalSpace:n.z.boolean(),enableRemoveForcedContent:n.z.boolean(),enableVPN:n.z.boolean(),forceAutomaticLogout:n.z.number(),lockOnExit:n.z.boolean(),vaultExportEnabled:n.z.boolean(),collectSensitiveDataAuditLogsEnabled:n.z.boolean(),ssoEnabled:n.z.boolean(),ssoProvisioning:n.z.boolean(),teamDomain:n.z.array(n.z.string()),restrictSharingToTeam:n.z.boolean(),recoveryEnabled:n.z.boolean(),richIconsEnabled:n.z.boolean(),itemVisibilityEnabled:n.z.boolean()})},27006:(e,t,s)=>{s.d(t,{K:()=>l});var n=s(75958),r=s(33549),i=s(66499),a=s(51060),o=s(54697),c=s(39127),d=s(70552);const l=(0,n.Q)({name:"teamPlanUpdate",commands:{changeTierMidcycle:r.G,computePlanPricingDetails:i.wf,upgradeTeamWithExistingCc:a.gi},events:{},queries:{getTeamOffers:o.g,getMidcycleTierUpgradePrice:c.X,getPlanPricingDetailsQuery:d.n}})},33549:(e,t,s)=>{s.d(t,{G:()=>i});var n=s(13385),r=s(62149);class i extends((0,n.g)({scope:r.F.User})){}},66499:(e,t,s)=>{s.d(t,{C9:()=>o,rm:()=>a,wf:()=>c});var n=s(13385),r=s(62149),i=s(98124);const a=(0,i.Vj)("not_billing_admin","User is not billing admin"),o=(0,i.Vj)("cannot_add_seat_during_grace_period","Cannot add seats during grace period");class c extends((0,n.g)({scope:r.F.User})){}},51060:(e,t,s)=>{s.d(t,{AI:()=>a,KW:()=>w,L7:()=>c,Ls:()=>_,NS:()=>p,QF:()=>b,T1:()=>E,ZP:()=>C,Zy:()=>o,_1:()=>h,aY:()=>f,d3:()=>m,fu:()=>g,g3:()=>l,gi:()=>I,hS:()=>y,hY:()=>d,jV:()=>v,oH:()=>u,rj:()=>S});var n=s(13385),r=s(62149),i=s(98124),a=function(e){return e.STARTER_PLAN_NOT_10_SEATS="starter_plan_not_10_seats",e.USER_SUBSCRIBING_NOT_FOUND="user_subscribing_not_found",e.CANNOT_INVOICE_FREE_PLAN="cannot_invoice_free_plan",e.PAYMENT_ERROR_DURING_UPGRADE="payment_error_during_upgrade",e.SEATS_TO_PURCHASE_LOWER_ACTUAL_USAGE="seats_to_purchase_lower_actual_usage",e.NOT_IN_A_TEAM_PLAN="not_in_a_team_plan",e.NOT_TEAM_CAPTAIN="not_team_captain",e.NOT_IN_FREE_TRIAL="not_in_free_trial",e.INVALID_PLAN="invalid_plan",e.WRONG_AMOUNT_TO_PAY="wrong_amount_to_pay",e.SALES_TAX_MISMATCH="SALES_TAX_MISMATCH",e.B2B_PLAN_NOT_FOUND="b2b_plan_not_found",e.SELECTED_PLAN_IS_NOT_VALID="SELECTED_PLAN_IS_NOT_VALID",e.FORBIDDEN_EMAIL_DOMAIN="FORBIDDEN_EMAIL_DOMAIN",e.TEAM_HAS_SSO_ENABLED="TEAM_HAS_SSO_ENABLED",e.VAT_NUMBER_NOT_UPSERTED="VAT_NUMBER_NOT_UPSERTED",e.NO_KEY_FOR_USER="no_key_for_user",e.UNSUPPORTED_PAYMENT_MEAN="unsupported_payment_mean",e}({});const o=(0,i.Vj)("starter_plan_not_10_seats","Starter Plan is 10 seats"),c=(0,i.Vj)("user_subscribing_not_found","User subscribing does not exist."),d=(0,i.Vj)("cannot_invoice_free_plan","Cannot invoice when Free plan."),l=(0,i.Vj)("payment_error_during_upgrade","Payment error during upgrade"),u=(0,i.Vj)("seats_to_purchase_lower_actual_usage","Seats to purchase is lower than actual team usage"),p=(0,i.Vj)("not_in_a_team_plan","Cannot upgrade, user is not in a team plan"),m=(0,i.Vj)("not_team_captain","The user is not a captain of this team"),h=(0,i.Vj)("not_in_free_trial","This team is not in free trial"),g=(0,i.Vj)("invalid_plan","Offer not allowed"),v=(0,i.Vj)("wrong_amount_to_pay","Amount displayed is too different than real actual price"),y=(0,i.Vj)("SALES_TAX_MISMATCH","Taxes displayed is too different than real actual price"),f=(0,i.Vj)("b2b_plan_not_found","The planId requested to upgrade is not found"),b=(0,i.Vj)("SELECTED_PLAN_IS_NOT_VALID","Selected plan is not valid"),S=(0,i.Vj)("FORBIDDEN_EMAIL_DOMAIN","This user has a forbidden email domain"),w=(0,i.Vj)("TEAM_HAS_SSO_ENABLED","Team needs to disable SSO before purchasing non-SSO offering plans"),E=(0,i.Vj)("VAT_NUMBER_NOT_UPSERTED","VAT number could not be upserted"),_=(0,i.Vj)("no_key_for_user","No key for user"),C=(0,i.Vj)("unsupported_payment_mean","The team is using an unsupported payment mean type.");class I extends((0,n.g)({scope:r.F.User})){}},39127:(e,t,s)=>{s.d(t,{X:()=>i});var n=s(77535),r=s(62149);class i extends((0,n.k)({scope:r.F.User})){}},70552:(e,t,s)=>{s.d(t,{n:()=>i});var n=s(77535),r=s(62149);class i extends((0,n.k)({scope:r.F.User})){}},54697:(e,t,s)=>{s.d(t,{g:()=>i});var n=s(77535),r=s(62149);class i extends((0,n.k)({scope:r.F.User})){}},50691:(e,t,s)=>{s.d(t,{a:()=>c});var n=s(75958),r=s(47969),i=s(38356),a=s(99706),o=s(23945);const c=(0,n.Q)({name:"teamVat",commands:{DeleteTeamVatCommand:r.Hy,UpsertTeamVatCommand:i.XW},events:{},queries:{getTeamVat:a.N7,getTaxAmount:o.B}})},47969:(e,t,s)=>{s.d(t,{Hy:()=>d,zK:()=>c});var n=s(13385),r=s(62149),i=s(98124);class a extends((0,i.Hu)("TeamNotFound","The given user is not part of a single team")){}class o extends((0,i.Hu)("NotBillingAdmin","The user is not Billing Admin")){}function c(e){switch(e){case"TEAM_NOT_FOUND":return new a;case"not_billing_admin":return new o;default:throw new Error("Unknown server error")}}class d extends((0,n.g)({scope:r.F.User})){}},38356:(e,t,s)=>{s.d(t,{XW:()=>l,q5:()=>d});var n=s(13385),r=s(62149),i=s(98124);class a extends((0,i.Hu)("TeamNotFound","The given user is not part of a single team")){}class o extends((0,i.Hu)("NotBillingAdmin","The user is not Billing Admin")){}class c extends((0,i.Hu)("VatNumberNotUpserted","The VAT number couldn't be upserted")){}function d(e){switch(e){case"TEAM_NOT_FOUND":return new a;case"not_billing_admin":return new o;case"VAT_NUMBER_NOT_UPSERTED":return new c;default:throw new Error("Unknown server error")}}class l extends((0,n.g)({scope:r.F.User})){}},23945:(e,t,s)=>{s.d(t,{A:()=>i,B:()=>a});var n=s(77535),r=s(98124);class i extends((0,r.Hu)("GetExpectedTaxInformationFailed","Could not return tax amount")){}class a extends((0,n.k)()){}},99706:(e,t,s)=>{s.d(t,{K$:()=>d,N7:()=>l});var n=s(77535),r=s(62149),i=s(98124);class a extends((0,i.Hu)("TeamNotFound","The given user is not part of a single team")){}class o extends((0,i.Hu)("VatNumberNotFound","The given Team does not have a VAT number")){}class c extends((0,i.Hu)("NotBillingAdmin","The user is not Billing Admin")){}function d(e){switch(e){case"TEAM_NOT_FOUND":return new a;case"VAT_NUMBER_NOT_FOUND":return new o;case"not_billing_admin":return new c;default:throw new Error("Unknown server error")}}class l extends((0,n.k)({scope:r.F.User})){}},58216:(e,t,s)=>{s.d(t,{F:()=>n});const n=e=>"accepted"===e.status},69840:(e,t,s)=>{s.d(t,{_:()=>R});var n=s(92336),r=s(86006),i=s(11512),a=function(e){return e.WebOnboardingInviteLinkTacMigration="web_onboarding_inviteLinkTacMigration",e}({}),o=s(62149),c=s(63144),d=s(56618),l=s(43613);class u extends((0,c.Q)({persist:!1,scope:o.F.User,storeName:"invite-link-team-store",initialValue:{status:l.D.NOT_LOADED},capacity:d.Y._001KB})){}var p=s(25859),m=s(87065),h=s(46449),g=s(78346),v=s(60399),y=s(33312),f=s(52477),b=s(17591),S=s(92587),w=s(53344),E=s(7165),_=function(e){return e.TEAM_DOES_NOT_EXIST="TEAM_DOES_NOT_EXIST",e.USER_NOT_PROPOSED_IN_TEAM="USER_NOT_PROPOSED_IN_TEAM",e.USER_TEAM_INVITE_TOKEN_NOT_FOUND="USER_TEAM_INVITE_TOKEN_NOT_FOUND",e}({});E.z.object({tag:E.z.nativeEnum(_)});var C=function(e){return e.NOT_ADMIN="NOT_ADMIN",e.TEAM_INVITE_LINK_NOT_FOUND="TEAM_INVITE_LINK_NOT_FOUND",e}({});E.z.object({tag:E.z.nativeEnum(C)});let I=!1;class T{async shouldRefreshState(){const e=await this.inviteLinkStore.getState(),t=e.status!==l.D.READY,s=e.status===l.D.READY&&e.lastRefreshDate+this.MIN_DELAY_BETWEEN_REFRESHES<Date.now();return t||s}constructor(e,t){this.serverApiClient=e,this.inviteLinkStore=t,this.MIN_DELAY_BETWEEN_REFRESHES=1e3,this.getFunctionalErrorForToken=e=>{switch(e){case _.TEAM_DOES_NOT_EXIST:return{tag:_.TEAM_DOES_NOT_EXIST};case _.USER_NOT_PROPOSED_IN_TEAM:return{tag:_.USER_NOT_PROPOSED_IN_TEAM};case _.USER_TEAM_INVITE_TOKEN_NOT_FOUND:return{tag:_.USER_TEAM_INVITE_TOKEN_NOT_FOUND};default:throw new Error(`RequestTeamInviteToken: error ${e}`)}},this.requestUserInviteTokenSending=(e,t)=>(0,v.z)(this.serverApiClient.v1.teams.requestTeamInviteToken({login:e,teamUuid:t}).pipe((0,y.DZ)((e=>(0,f.EQ)(e,{BusinessError:e=>this.getFunctionalErrorForToken(e.code),FetchFailedError:()=>{throw new Error("Fetch Failed error")},InternalServerError:b.j,InvalidRequest:b.j,RateLimited:b.j,ServiceUnavailable:b.j,UnspecifiedBadStatus:b.j}))),(0,y.Qn)((({data:e})=>e)))),this.loadInviteLinkData=async()=>{if(I)return;if(I=!0,!await this.shouldRefreshState())return void(I=!1);const e=await(0,v.z)(this.serverApiClient.v1.teams.getTeamSignUpPageForAdmin().pipe((0,y.Qn)((({data:e})=>e))));if((0,g.hx)(e)){const t="BusinessError"===e.error.tag&&"TEAM_INVITE_LINK_NOT_FOUND"===e.error.code?l.D.NOT_CREATED:l.D.NOT_LOADED;return I=!1,await this.inviteLinkStore.set({status:t})}const{disabled:t,teamKey:s}=e.data;await this.inviteLinkStore.set({teamKey:s,enabled:!t,lastRefreshDate:Date.now(),status:l.D.READY}),I=!1},this.toggleInviteLink=async e=>{const t=await(0,v.z)(this.serverApiClient.v1.teams.toggleTeamSignUpPage({disabled:!e}).pipe((0,y.Qn)((({data:e})=>e))));if((0,g.hx)(t))throw new Error(`could't change toggleTeamSignUpPage ${t}`)},this.createInviteLink=async e=>{const t=await(0,v.z)(this.serverApiClient.v1.teams.createTeamSignUpPage({displayName:e}).pipe((0,y.Qn)((({data:e})=>e))));if((0,g.hx)(t))throw new Error(`could't create an invite link with createTeamSignUpPage ${t}`)}}}T=(0,n.gn)([(0,S.GS)(),(0,n.w6)("design:type",Function),(0,n.w6)("design:paramtypes",[void 0===w.l?Object:w.l,void 0===u?Object:u])],T);class A{execute(){return(0,p.P)((()=>(this.inviteLinkService.loadInviteLinkData(),this.inviteLinkStore.state$.pipe((0,m.U)((e=>{switch(e.status){case l.D.NOT_LOADED:return(0,g.Vp)(null);case l.D.NOT_CREATED:return(0,g.Vp)({teamKey:"",enabled:!1});default:return(0,g.Vp)({teamKey:e.teamKey,enabled:e.enabled})}}))))))}constructor(e,t){this.inviteLinkService=e,this.inviteLinkStore=t}}A=(0,n.gn)([(0,h.e)(l.$),(0,n.w6)("design:type",Function),(0,n.w6)("design:paramtypes",[void 0===T?Object:T,void 0===u?Object:u])],A);var U=s(41511),N=s(82874),O=s(85187);class D{async execute({body:e}){const{teamName:t,enabled:s}=e,n=await this.inviteLinkStore.getState();return n.status===l.D.NOT_CREATED?await this.inviteLinkService.createInviteLink(t):n.status===l.D.READY&&n.teamKey&&await this.inviteLinkService.toggleInviteLink(s),this.inviteLinkService.loadInviteLinkData(),Promise.resolve((0,g.Vp)(void 0))}constructor(e,t){this.inviteLinkStore=e,this.inviteLinkService=t}}D=(0,n.gn)([(0,N.W)(O.s),(0,n.w6)("design:type",Function),(0,n.w6)("design:paramtypes",[void 0===u?Object:u,void 0===T?Object:T])],D);var F=s(71379);class P{async execute({body:e}){const{login:t,teamUuid:s}=e;return await this.inviteLinkService.requestUserInviteTokenSending(t,s),Promise.resolve((0,g.Vp)(void 0))}constructor(e){this.inviteLinkService=e}}P=(0,n.gn)([(0,N.W)(F.T),(0,n.w6)("design:type",Function),(0,n.w6)("design:paramtypes",[void 0===T?Object:T])],P);class R{}R=(0,n.gn)([(0,r.Y)({api:i.t,imports:[U.n],providers:[T],stores:[u],handlers:{commands:{toggleInviteLink:D,requestUserInviteTokenSending:P},events:{},queries:{inviteLinkData:A}},requiredFeatureFlips:Object.values(a)})],R)},51191:(e,t,s)=>{s.d(t,{E:()=>Te});var n=s(92336),r=s(86006),i=s(41511),a=s(58164),o=s(6550),c=s(87752),d=s(47415),l=s(62149),u=s(63144),p=s(56618),m=s(60018),h=s(7165),g=function(e){return e.B2BPlanDiscontinued="b2bPlanDiscontinued",e.CRDRisksFoundInfobox="crdRisksFoundInfobox",e.IdPFailedNotification="idpFailedNotification",e.IdPNeedsSeatsInfobox="idpNeedsSeatsInfobox",e.IdPProvisioningsPendingInfobox="idpProvisioningsPendingInfobox",e.IdPNeedsSeatsInfoboxInPopup="idpNeedsSeatsInfoboxInPopup",e.NotificationTrialExtended="notificationTrialExtended",e.OfferToExtendFreeTrial="offerToExtendFreeTrial",e.RestrictSharingPolicy="restrictSharingPolicy",e.StarterRepackagePolicyInfobox="starterRepackagePolicyInfobox",e}({});const v=h.z.object({seenNotifications:h.z.record(h.z.nativeEnum(g),h.z.boolean())}),y=e=>v.safeParse(e).success,f={b2bPlanDiscontinued:!1,crdRisksFoundInfobox:!1,idpFailedNotification:!1,idpNeedsSeatsInfobox:!1,idpProvisioningsPendingInfobox:!1,idpNeedsSeatsInfoboxInPopup:!1,notificationTrialExtended:!1,offerToExtendFreeTrial:!1,restrictSharingPolicy:!1,starterRepackagePolicyInfobox:!1};function b(e){return{seenNotifications:f}}class S extends((0,u.Q)({storage:{schemaVersion:3,initialValue:{seenNotifications:f},migrateStorageSchema:b,typeGuard:y},persist:!0,isCache:!0,scope:l.F.User,storeName:"team-admin-notifications-store",capacity:p.Y._010KB,codec:m.E})){}const w=h.z.object({failedProvisionings:h.z.union([h.z.object({eventDateUnix:h.z.number(),failedLogins:h.z.array(h.z.string()),nbOfFailedCreations:h.z.number(),requiredSeats:h.z.number(),nbOfPendingProvisionings:h.z.number(),shouldShowNotifications:h.z.object({warningProvisioningsPending:h.z.boolean(),alertFailuresNeedSeats:h.z.boolean()})}),h.z.undefined()]),fixedProvisionings:h.z.union([h.z.array(h.z.object({buyingUserId:h.z.number().nullable(),eventDateUnix:h.z.number(),nbOfSeatsBought:h.z.number()})),h.z.undefined()]),lastRefreshDate:h.z.number(),error:h.z.union([h.z.string(),h.z.undefined()])}),E=e=>w.safeParse(e).success;class _ extends((0,u.Q)({storage:{schemaVersion:1,initialValue:{lastRefreshDate:0},typeGuard:E},persist:!0,scope:l.F.User,storeName:"idp-notifications-store",capacity:p.Y._010KB,codec:m.E})){}var C=s(60399),I=s(87065),T=s(82567),A=s(25859),U=s(78346),N=s(92587),O=s(53344),D=s(56276),F=s(59875);class P{async refreshState(){const e=await this.teamAdminService.refreshState();if(!e?.isBillingOrFullAdmin)return void this.idpNotificationsStore.set({lastRefreshDate:0,error:D.C$.NOT_ADMIN});const t=await this.idpNotificationsStore.getState();if(t.lastRefreshDate+this.MIN_DELAY_BETWEEN_REFRESHES>Date.now())return;const s=(await this.adminNotificationsStore.getState()).seenNotifications;return(0,C.z)(this.serverApiClient.v1.teams.getIdpNotifications({}).pipe((0,I.U)((t=>{if((0,U.hx)(t))return{lastRefreshDate:Date.now(),error:t.error.message};const s=t.data.data.logs.failedProvisionings,n=s?.nbOfFailedCreations,r=e.seats.remaining,i=n?Math.max(n-r,0):0,a={warningProvisioningsPending:r>0,alertFailuresNeedSeats:i>0};return{failedProvisionings:s?.nbOfFailedCreations?{...s,requiredSeats:i,nbOfPendingProvisionings:r,shouldShowNotifications:a}:void 0,fixedProvisionings:t.data.data.logs.fixedProvisionings,lastRefreshDate:Date.now()}})),(0,T.b)((async e=>{let n=!1,r=!1,i=!1;e.failedProvisionings&&e.failedProvisionings.eventDateUnix===t.failedProvisionings?.eventDateUnix?e.failedProvisionings.requiredSeats!==t.failedProvisionings.requiredSeats&&(n=!0):(n=!0,i=!0),e.failedProvisionings?.nbOfPendingProvisionings!==t.failedProvisionings?.nbOfPendingProvisionings&&(r=!0),await this.adminNotificationsStore.set({seenNotifications:{...s,...n?{idpNeedsSeatsInfobox:!1,idpNeedsSeatsInfoboxInPopup:!1}:{},idpFailedNotification:!i&&s.idpFailedNotification,idpProvisioningsPendingInfobox:!r&&s.idpProvisioningsPendingInfobox}}),await this.idpNotificationsStore.set(e)}))))}constructor(e,t,s,n){this.serverApiClient=e,this.teamAdminService=t,this.idpNotificationsStore=s,this.adminNotificationsStore=n,this.MIN_DELAY_BETWEEN_REFRESHES=500,this.getIdPFailedProvisioningsData=()=>(0,A.P)((()=>(this.refreshState(),this.idpNotificationsStore.state$.pipe((0,I.U)((e=>"not_admin"===e.error?(0,U.Rn)((0,D.qj)()):(0,U.Vp)(e.failedProvisionings))))))),this.getIdPFixedProvisioningsData=()=>(0,A.P)((()=>(this.refreshState(),this.idpNotificationsStore.state$.pipe((0,I.U)((e=>"not_admin"===e.error?(0,U.Rn)((0,F.Go)()):(0,U.Vp)(e.fixedProvisionings)))))))}}P=(0,n.gn)([(0,N.GS)(),(0,n.w6)("design:type",Function),(0,n.w6)("design:paramtypes",[void 0===O.l?Object:O.l,void 0===c.k?Object:c.k,void 0===_?Object:_,void 0===S?Object:S])],P);var R=s(15661),x=s(82874),L=s(56859);class k{async execute(){const e=await this.store.getState(),t={...e.seenNotifications,starterRepackagePolicyInfobox:!0};return await this.store.set({...e,seenNotifications:t}),Promise.resolve((0,U.Vp)(void 0))}constructor(e){this.store=e}}k=(0,n.gn)([(0,x.W)(L.z),(0,n.w6)("design:type",Function),(0,n.w6)("design:paramtypes",[void 0===S?Object:S])],k);var j=s(36486);class M{async execute(){const e=await this.store.getState(),t={...e.seenNotifications,b2bPlanDiscontinued:!0};return await this.store.set({...e,seenNotifications:t}),Promise.resolve((0,U.Vp)(void 0))}constructor(e){this.store=e}}M=(0,n.gn)([(0,x.W)(j.q),(0,n.w6)("design:type",Function),(0,n.w6)("design:paramtypes",[void 0===S?Object:S])],M);var z=s(31521);class V{async execute(){const e=await this.store.getState(),t={...e.seenNotifications,crdRisksFoundInfobox:!0};return await this.store.set({...e,seenNotifications:t}),Promise.resolve((0,U.Vp)(void 0))}constructor(e){this.store=e}}V=(0,n.gn)([(0,x.W)(z.e),(0,n.w6)("design:type",Function),(0,n.w6)("design:paramtypes",[void 0===S?Object:S])],V);var B=s(93595);class K{async execute(){const e=await this.store.getState(),t={...e.seenNotifications,idpFailedNotification:!0};return await this.store.set({...e,seenNotifications:t}),Promise.resolve((0,U.Vp)(void 0))}constructor(e){this.store=e}}K=(0,n.gn)([(0,x.W)(B.b),(0,n.w6)("design:type",Function),(0,n.w6)("design:paramtypes",[void 0===S?Object:S])],K);var G=s(23578);class ${async execute(){const e=await this.store.getState(),t={...e.seenNotifications,idpNeedsSeatsInfobox:!0};return await this.store.set({...e,seenNotifications:t}),Promise.resolve((0,U.Vp)(void 0))}constructor(e){this.store=e}}$=(0,n.gn)([(0,x.W)(G.k),(0,n.w6)("design:type",Function),(0,n.w6)("design:paramtypes",[void 0===S?Object:S])],$);var q=s(14485);class H{async execute(){const e=await this.store.getState(),t={...e.seenNotifications,idpNeedsSeatsInfoboxInPopup:!0};return await this.store.set({...e,seenNotifications:t}),Promise.resolve((0,U.Vp)(void 0))}constructor(e){this.store=e}}H=(0,n.gn)([(0,x.W)(q.N),(0,n.w6)("design:type",Function),(0,n.w6)("design:paramtypes",[void 0===S?Object:S])],H);var W=s(61358);class Q{async execute(){const e=await this.store.getState(),t={...e.seenNotifications,idpProvisioningsPendingInfobox:!0};return await this.store.set({...e,seenNotifications:t}),Promise.resolve((0,U.Vp)(void 0))}constructor(e){this.store=e}}Q=(0,n.gn)([(0,x.W)(W.r),(0,n.w6)("design:type",Function),(0,n.w6)("design:paramtypes",[void 0===S?Object:S])],Q);var Y=s(81940);class X{async execute(){const e=await this.store.getState(),t={...e.seenNotifications,restrictSharingPolicy:!0};return await this.store.set({...e,seenNotifications:t}),Promise.resolve((0,U.Vp)(void 0))}constructor(e){this.store=e}}X=(0,n.gn)([(0,x.W)(Y.o),(0,n.w6)("design:type",Function),(0,n.w6)("design:paramtypes",[void 0===S?Object:S])],X);var Z=s(4093);class J{async execute(){const e=await this.store.getState(),t={...e.seenNotifications,notificationTrialExtended:!0};return await this.store.set({...e,seenNotifications:t}),Promise.resolve((0,U.Vp)(void 0))}constructor(e){this.store=e}}J=(0,n.gn)([(0,x.W)(Z.D),(0,n.w6)("design:type",Function),(0,n.w6)("design:paramtypes",[void 0===S?Object:S])],J);var ee=s(69877);class te{async execute(){const e=await this.store.getState(),t={...e.seenNotifications,offerToExtendFreeTrial:!0};return await this.store.set({...e,seenNotifications:t}),Promise.resolve((0,U.Vp)(void 0))}constructor(e){this.store=e}}te=(0,n.gn)([(0,x.W)(ee.R),(0,n.w6)("design:type",Function),(0,n.w6)("design:paramtypes",[void 0===S?Object:S])],te);var se=s(46449);class ne{execute(){return this.idpNotificationsDataService.getIdPFailedProvisioningsData()}constructor(e){this.idpNotificationsDataService=e}}ne=(0,n.gn)([(0,se.e)(D.It),(0,n.w6)("design:type",Function),(0,n.w6)("design:paramtypes",[void 0===P?Object:P])],ne);class re{execute(){return this.idpNotificationsDataService.getIdPFixedProvisioningsData()}constructor(e){this.idpNotificationsDataService=e}}re=(0,n.gn)([(0,se.e)(F.Un),(0,n.w6)("design:type",Function),(0,n.w6)("design:paramtypes",[void 0===P?Object:P])],re);var ie=s(97786);class ae{execute(){return this.store.state$.pipe((0,I.U)((e=>(0,U.Vp)(!!e.seenNotifications.starterRepackagePolicyInfobox))))}constructor(e){this.store=e}}ae=(0,n.gn)([(0,se.e)(ie.i),(0,n.w6)("design:type",Function),(0,n.w6)("design:paramtypes",[void 0===S?Object:S])],ae);var oe=s(6136),ce=s(92179);class de{execute(){return this.store.state$.pipe((0,I.U)((e=>!!e.seenNotifications.b2bPlanDiscontinued)),(0,oe.x)(),(0,I.U)(U.Vp))}constructor(e){this.store=e}}de=(0,n.gn)([(0,se.e)(ce.z),(0,n.w6)("design:type",Function),(0,n.w6)("design:paramtypes",[void 0===S?Object:S])],de);var le=s(7310);class ue{execute(){return this.store.state$.pipe((0,I.U)((e=>!!e.seenNotifications.crdRisksFoundInfobox)),(0,oe.x)(),(0,I.U)(U.Vp))}constructor(e){this.store=e}}ue=(0,n.gn)([(0,se.e)(le.e),(0,n.w6)("design:type",Function),(0,n.w6)("design:paramtypes",[void 0===S?Object:S])],ue);var pe=s(91206);class me{execute(){return this.store.state$.pipe((0,I.U)((e=>!!e.seenNotifications.idpFailedNotification)),(0,oe.x)(),(0,I.U)(U.Vp))}constructor(e){this.store=e}}me=(0,n.gn)([(0,se.e)(pe.g),(0,n.w6)("design:type",Function),(0,n.w6)("design:paramtypes",[void 0===S?Object:S])],me);var he=s(16883);class ge{execute(){return this.store.state$.pipe((0,I.U)((e=>!!e.seenNotifications.idpNeedsSeatsInfobox)),(0,oe.x)(),(0,I.U)(U.Vp))}constructor(e){this.store=e}}ge=(0,n.gn)([(0,se.e)(he.T),(0,n.w6)("design:type",Function),(0,n.w6)("design:paramtypes",[void 0===S?Object:S])],ge);var ve=s(66385);class ye{execute(){return this.store.state$.pipe((0,I.U)((e=>(0,U.Vp)(!!e.seenNotifications.idpNeedsSeatsInfoboxInPopup))))}constructor(e){this.store=e}}ye=(0,n.gn)([(0,se.e)(ve.k),(0,n.w6)("design:type",Function),(0,n.w6)("design:paramtypes",[void 0===S?Object:S])],ye);var fe=s(75178);class be{execute(){return this.store.state$.pipe((0,I.U)((e=>!!e.seenNotifications.idpProvisioningsPendingInfobox)),(0,oe.x)(),(0,I.U)(U.Vp))}constructor(e){this.store=e}}be=(0,n.gn)([(0,se.e)(fe.S),(0,n.w6)("design:type",Function),(0,n.w6)("design:paramtypes",[void 0===S?Object:S])],be);var Se=s(74629);class we{execute(){return this.store.state$.pipe((0,I.U)((e=>!!e.seenNotifications.restrictSharingPolicy)),(0,oe.x)(),(0,I.U)(U.Vp))}constructor(e){this.store=e}}we=(0,n.gn)([(0,se.e)(Se.x),(0,n.w6)("design:type",Function),(0,n.w6)("design:paramtypes",[void 0===S?Object:S])],we);var Ee=s(31432);class _e{execute(){return this.store.state$.pipe((0,I.U)((e=>!!e.seenNotifications.notificationTrialExtended)),(0,oe.x)(),(0,I.U)(U.Vp))}constructor(e){this.store=e}}_e=(0,n.gn)([(0,se.e)(Ee.q),(0,n.w6)("design:type",Function),(0,n.w6)("design:paramtypes",[void 0===S?Object:S])],_e);var Ce=s(75008);class Ie{execute(){return this.store.state$.pipe((0,I.U)((e=>!!e.seenNotifications.offerToExtendFreeTrial)),(0,oe.x)(),(0,I.U)(U.Vp))}constructor(e){this.store=e}}Ie=(0,n.gn)([(0,se.e)(Ce.U),(0,n.w6)("design:type",Function),(0,n.w6)("design:paramtypes",[void 0===S?Object:S])],Ie);class Te{}Te=(0,n.gn)([(0,r.Y)({api:a.t,imports:[R.H,i.n],stores:[_,S,o.C],providers:[P,d.J,c.k],handlers:{commands:{markStarterRepackagePolicyInfoboxSeen:k,markB2BPlanDiscontinuedSeen:M,markCRDRisksFoundInfoboxSeen:V,markIdPFailedNotificationSeen:K,markIdPNeedsSeatsInfoboxSeen:$,markIdPNeedsSeatsInfoboxInPopupSeen:H,markIdPProvisioningsPendingInfoboxSeen:Q,markNewRestrictSharingPolicySeen:X,markNotificationTrialExtendedSeen:J,markOfferToExtendFreeTrialSeen:te},events:{},queries:{getIdPFailedProvisioningsData:ne,getIdPFixedProvisioningsData:re,HasSeenStarterRepackagePolicyInfobox:ae,hasSeenB2BPlanDiscontinued:de,hasSeenCRDRisksFoundInfobox:ue,hasSeenIdPFailedNotification:me,hasSeenIdPNeedsSeatsInfobox:ge,hasSeenIdPNeedsSeatsInfoboxInPopup:ye,hasSeenIdPProvisioningsPendingInfobox:be,hasSeenNewRestrictSharingPolicy:we,hasSeenNotificationTrialExtended:_e,hasSeenOfferToExtendFreeTrial:Ie}},requiredFeatureFlips:["monetization_extension_group_sharing_repackage"]})],Te)},44272:(e,t,s)=>{s.d(t,{X:()=>H});var n=s(92336),r=s(86006),i=s(41511),a=s(72788),o=s(63144),c=s(56618),d=s(62149),l=s(73895),u=s(7165);const p=u.z.object({adminHasDismissInfobox:u.z.boolean(),nonMembersCount:u.z.number().optional(),nonMembersList:l.RD.optional()}),m=e=>p.safeParse(e).success;class h extends((0,o.Q)({initialValue:{adminHasDismissInfobox:!1},storeTypeGuard:m,persist:!1,scope:d.F.User,storeName:"non-member-store",capacity:c.Y._001KB})){}var g=s(46449),v=s(59509),y=s(33312),f=s(58216),b=s(32054);class S{execute({body:e}){const{teamId:t}=e;return this.getTeamMembersData.get(t).pipe((0,y.Qn)((({members:e,billingAdmins:t})=>({billingAdmins:t,members:e.map((e=>({isTeamCaptain:(0,f.F)(e)&&e.isTeamCaptain,isGroupManager:(0,f.F)(e)&&e.isGroupManager,login:e.login,status:e.status})))}))))}constructor(e){this.getTeamMembersData=e}}S=(0,n.gn)([(0,g.e)(v.k),(0,n.w6)("design:type",Function),(0,n.w6)("design:paramtypes",[void 0===b.G?Object:b.G])],S);var w=s(82874),E=s(16396),_=s(60399),C=s(82567),I=s(92587),T=s(53344),A=s(78346),U=s(13800);class N extends U.f{}N=(0,n.gn)([(0,I.GS)()],N);class O{async callProposeMembers({proposedMemberLogins:e,force:t,origin:s,notificationOptions:n}){try{return await(0,_.z)(this.serverApiClient.v1.teams.proposeMembers({proposedMemberLogins:e,force:t,origin:s,notificationOptions:n}).pipe((0,y.DZ)((e=>{if("BusinessError"===e.tag)return(0,E.Wv)(e.code);throw new Error(e.message)})),(0,y.lk)((e=>(0,A.Vp)(e.data))),(0,C.b)((()=>{this.eventEmitter.sendEvent("membersAdded",void 0)}))))}catch(e){throw new Error("Propose Members failed")}}constructor(e,t){this.serverApiClient=e,this.eventEmitter=t}}O=(0,n.gn)([(0,I.GS)(),(0,n.w6)("design:type",Function),(0,n.w6)("design:paramtypes",[void 0===T.l?Object:T.l,void 0===N?Object:N])],O);class D{execute({body:{proposedMemberLogins:e,force:t,origin:s,notificationOptions:n}}){return this.proposeMembersService.callProposeMembers({proposedMemberLogins:e,force:t,origin:s,notificationOptions:n})}constructor(e){this.proposeMembersService=e}}D=(0,n.gn)([(0,w.W)(E.og),(0,n.w6)("design:type",Function),(0,n.w6)("design:paramtypes",[void 0===O?Object:O])],D);var F=s(37043);class P{async execute(){return await this.nonMemberStore.set({adminHasDismissInfobox:!0}),(0,A.Vp)(void 0)}constructor(e){this.nonMemberStore=e}}P=(0,n.gn)([(0,w.W)(F.Y),(0,n.w6)("design:type",Function),(0,n.w6)("design:paramtypes",[void 0===h?Object:h])],P);var R=s(43978),x=s(69885),L=s(87065),k=s(6136),j=s(35468),M=s(58605);class z{getCount(){return this.serverApiClient.v1.teams.countDomainUsersNotInTeam({}).pipe((0,L.U)((e=>(0,A.hx)(e)?(0,A.Rn)(new M.$):(0,A.Vp)(e.data.data.usersCount))))}getList(){return this.serverApiClient.v1.teams.getDomainUsersNotInTeam({}).pipe((0,L.U)((e=>(0,A.hx)(e)?(0,A.Rn)(new M.$):(0,A.Vp)(e.data.data.users.map((e=>l.R0.parse(e)))))))}constructor(e){this.serverApiClient=e}}z=(0,n.gn)([(0,I.GS)(),(0,n.w6)("design:type",Function),(0,n.w6)("design:paramtypes",[void 0===T.l?Object:T.l])],z);class V{execute(){return this.nonMembersStore.state$.pipe((0,R.w)((e=>void 0!==e.nonMembersCount?(0,x.of)(e.nonMembersCount):this.nonMembersService.getCount().pipe((0,L.U)((t=>(0,A.hx)(t)?0:(this.nonMembersStore.set({...e,nonMembersCount:t.data}),t.data)))))),(0,k.x)(),(0,L.U)(A.Vp))}constructor(e,t){this.nonMembersStore=e,this.nonMembersService=t}}V=(0,n.gn)([(0,g.e)(j.H),(0,n.w6)("design:type",Function),(0,n.w6)("design:paramtypes",[void 0===h?Object:h,void 0===z?Object:z])],V);var B=s(62760);const K=[];class G{execute(){return this.nonMembersStore.state$.pipe((0,R.w)((e=>void 0!==e.nonMembersList?(0,x.of)(e.nonMembersList):this.nonMembersService.getList().pipe((0,L.U)((t=>{if((0,A.hx)(t))return K;const s=t.data;return this.nonMembersStore.set({...e,nonMembersList:s}),s}))))),(0,k.x)(((e,t)=>(0,B.shallowEqualArrays)(e,t))),(0,L.U)(A.Vp))}constructor(e,t){this.nonMembersStore=e,this.nonMembersService=t}}G=(0,n.gn)([(0,g.e)(l.Fz),(0,n.w6)("design:type",Function),(0,n.w6)("design:paramtypes",[void 0===h?Object:h,void 0===z?Object:z])],G);var $=s(22099);class q{execute(){return this.nonMembersStore.state$.pipe((0,L.U)((e=>e.adminHasDismissInfobox)),(0,k.x)(),(0,L.U)(A.Vp))}constructor(e){this.nonMembersStore=e}}q=(0,n.gn)([(0,g.e)($.K),(0,n.w6)("design:type",Function),(0,n.w6)("design:paramtypes",[void 0===h?Object:h])],q);class H{}H=(0,n.gn)([(0,r.Y)({api:a.L,imports:[i.n],providers:[O,z,N,b.G],stores:[h],handlers:{commands:{proposeMembers:D,dismissNonMembersInfobox:P},events:{},queries:{getNonMembersCount:V,getNonMembersList:G,getHasAdminDismissedInfobox:q,getMembersList:S}},exports:[b.G]})],H)},32054:(e,t,s)=>{s.d(t,{G:()=>o});var n=s(92336),r=s(33312),i=s(92587),a=s(53344);class o{constructor(e){this.serverApiClient=e,this.get=e=>this.serverApiClient.v1.teams.getTeamMembers({teamId:parseInt(e,10),orderBy:"joinedDateUnix",limit:0}).pipe((0,r.Qn)((({data:e})=>e)),(0,r.DZ)((e=>{throw e})))}}o=(0,n.gn)([(0,i.GS)(),(0,n.w6)("design:type",Function),(0,n.w6)("design:paramtypes",[void 0===a.l?Object:a.l])],o)},80699:(e,t,s)=>{s.d(t,{V:()=>v});var n=s(92336),r=s(86006),i=s(41511),a=s(35475),o=s(92587),c=s(53344),d=s(78346),l=s(33312),u=s(87065);class p{constructor(e){this.serverApiClient=e,this.getTeamReport=()=>this.getTeamReportData().pipe((0,u.U)((e=>{if((0,d.hx)(e))throw new Error("could't retrieve team report");const{data:t}=e;return(0,d.Vp)(t)}))),this.getTeamReportData=()=>this.serverApiClient.v1.teams.report({}).pipe((0,l.Qn)((({data:e})=>e)),(0,l.DZ)((e=>{throw e})))}}p=(0,n.gn)([(0,o.GS)(),(0,n.w6)("design:type",Function),(0,n.w6)("design:paramtypes",[void 0===c.l?Object:c.l])],p);var m=s(46449),h=s(58089);class g{execute(){return this.teamReportService.getTeamReport()}constructor(e){this.teamReportService=e}}g=(0,n.gn)([(0,m.e)(h.z),(0,n.w6)("design:type",Function),(0,n.w6)("design:paramtypes",[void 0===p?Object:p])],g);class v{}v=(0,n.gn)([(0,r.Y)({api:a.B,imports:[i.n],providers:[p],handlers:{commands:{},events:{},queries:{getReport:g}}})],v)},47415:(e,t,s)=>{s.d(t,{J:()=>p});var n=s(92336),r=s(95255),i=s(14122),a=s(92587),o=s(78346),c=s(60399),d=s(87065),l=s(7165);const u=l.z.array(l.z.object({details:l.z.object({isBillingAdmin:l.z.boolean(),isTeamAdmin:l.z.boolean(),status:l.z.nativeEnum(r.fE)})}));class p{get isBillingAdmin(){return(0,c.z)(this.isBillingAdmin$)}get isFullRightsAdmin(){return(0,c.z)(this.isFullRightsAdmin$)}spaces$(){return this.carbonLegacyClient.queries.carbonState({path:"userSession.spaceData.spaces"}).pipe((0,d.U)((e=>{return(0,o.hx)(e)||(t=e.data,!u.safeParse(t).success)||0===e.data.length?[]:e.data.filter((e=>e.details.status===r.fE.Accepted));var t})))}constructor(e){this.carbonLegacyClient=e,this.isBillingAdmin$=this.spaces$().pipe((0,d.U)((e=>e.some((e=>e.details.isBillingAdmin))))),this.isFullRightsAdmin$=this.spaces$().pipe((0,d.U)((e=>e.some((e=>e.details.isTeamAdmin)))))}}p=(0,n.gn)([(0,a.GS)(),(0,n.w6)("design:type",Function),(0,n.w6)("design:paramtypes",[void 0===i._?Object:i._])],p)},72223:(e,t,s)=>{s.d(t,{O:()=>n,e:()=>a});const n=(e,t)=>({allowPersistenceForMasterPassword:!e.mpPersistenceDisabled,allowSharing:!e.sharingDisabled,sharingRestrictedToTeam:!!e.sharingRestrictedToTeam,enforce2FA:"newDevice"===e.twoFAEnforced,cryptoForcedPayload:e.cryptoForcedPayload??"disabled",disableAutoLoginDomains:e.autologinDomainDisabledArray??[],enableForcedDomains:!!e.forcedDomainsEnabled,enablePersonalSpace:!!e.personalSpaceEnabled,enableRemoveForcedContent:!!e.removeForcedContentEnabled,enableVPN:!!e.secureWifiEnabled,forceAutomaticLogout:(e.forceAutomaticLogout||"unset").toString(),lockOnExit:!!e.lockOnExit,vaultExportEnabled:!!e.vaultExportEnabled,collectSensitiveDataAuditLogsEnabled:!!e.collectSensitiveDataAuditLogsEnabled,ssoEnabled:!!e.ssoEnabled,ssoProvisioning:"automatic"===e.ssoProvisioning,teamDomain:e.teamDomains??[],restrictSharingToTeam:"boolean"==typeof e.sharingRestrictedToTeam?e.sharingRestrictedToTeam:t.internalSharingOnly.enabled,recoveryEnabled:!!e.recoveryEnabled,richIconsEnabled:!!e.richIconsEnabled,itemVisibilityEnabled:!!e.uvvsReportEnabled}),r=(e,t,s)=>{const n=[];return s?.added&&s.added.forEach((t=>n.push({type:e,value:t}))),s?.removed&&s.removed.forEach((e=>n.push({type:t,value:e}))),n},i=(e,t)=>void 0!==t?[{type:e,value:t}]:[],a=(e,t)=>{const s=[...r("add_team_domain","remove_team_domain",t.teamDomain),...r("add_autologin_domain_disabled","remove_autologin_domain_disabled",t.disableAutoLoginDomains),...i("set_forced_domains_enabled",t.enableForcedDomains),...i("set_rm_forced_content_enabled",t.enableRemoveForcedContent),...i("set_vault_export_enabled",t.vaultExportEnabled),...i("set_secure_wifi",t.enableVPN),...i("set_lock_on_exit",t.lockOnExit),...i("set_collect_sensitive_data_audit_logs_enabled",t.collectSensitiveDataAuditLogsEnabled),...i("set_sharing_restricted_to_team",t.restrictSharingToTeam),...(n="set_sharing_disabled",a=t.allowSharing,void 0!==a?[{type:n,value:!a}]:[])];var n,a;return void 0!==t.enforce2FA&&s.push({type:"set_two_factor_authentication_enforced",value:t.enforce2FA?"newDevice":"disabled"}),void 0!==t.forceAutomaticLogout&&s.push({type:null===t.forceAutomaticLogout?"unset_force_automatic_logout":"set_force_automatic_logout",value:t.forceAutomaticLogout}),void 0!==t.cryptoForcedPayload&&s.push({type:"set_crypto_forced_payload",value:t.cryptoForcedPayload}),void 0!==t.ssoProvisioning&&s.push({type:"set_sso_provisioning",value:t.ssoProvisioning?"automatic":"disabled"}),void 0!==t.richIconsEnabled&&s.push({type:"set_rich_icons_enabled",value:t.richIconsEnabled}),void 0!==t.itemVisibilityEnabled&&s.push({type:"set_uvvs_report_enabled",value:t.itemVisibilityEnabled}),{operations:s,teamId:e}}},15661:(e,t,s)=>{s.d(t,{H:()=>Dt});var n=s(92336),r=s(86006),i=s(55385),a=s(85045),o=s(41511),c=s(48666),d=s(72788);var l=s(65862),u=s(67051),p=s(47415),m=s(60399),h=s(92587),g=s(53344),v=s(98124),y=function(e){return e.CannotAddSeatDuringFreeTrial="cannot_add_seat_during_free_trial",e.CannotAddSeatIfDiscontinued="cannot_add_seat_on_soft_discontinued",e.CannotAddSeatDuringGracePeriod="cannot_add_seat_during_grace_period",e.UnsupportedPaymentMean="unsupported_payment_mean",e.UserIsNotBillingAdmin="not_billing_admin",e.PaymentFailed="payment_failed",e}({});const f=(0,v.Vj)("cannot_add_seat_during_free_trial","Not possible to add seats during free trial"),b=(0,v.Vj)("cannot_add_seat_on_soft_discontinued","Not possible to add seats if team is discontinued"),S=(0,v.Vj)("cannot_add_seat_during_grace_period","Not possible to add seats during grace period"),w=(0,v.Vj)("unsupported_payment_mean","Payment mean is not supported"),E=(0,v.Vj)("not_billing_admin","User is not billing admin"),_=(0,v.Vj)("payment_failed","The payment has failed");var C=s(33312),I=s(52477),T=s(17591);class A{addSeats({seats:e}){return(0,m.z)(this.serverApiClient.v1.teams.addSeats({seats:e}).pipe((0,C.DZ)((e=>(0,I.EQ)(e,{BusinessError:e=>this.getAddSeatsFunctionalError(e.code),FetchFailedError:T.j,BadStatus:T.j,InternalServerError:T.j,InvalidRequest:T.j,RateLimited:T.j,ServiceUnavailable:T.j,UnspecifiedBadStatus:T.j}))),(0,C.Qn)((e=>e.data))))}constructor(e){this.serverApiClient=e,this.getAddSeatsFunctionalError=e=>{switch(e){case y.CannotAddSeatDuringFreeTrial:return f();case y.CannotAddSeatDuringGracePeriod:return S();case y.CannotAddSeatIfDiscontinued:return b();case y.UnsupportedPaymentMean:return w();case y.UserIsNotBillingAdmin:return E();case y.PaymentFailed:default:return _()}}}}A=(0,n.gn)([(0,h.GS)(),(0,n.w6)("design:type",Function),(0,n.w6)("design:paramtypes",[void 0===g.l?Object:g.l])],A);var U=s(25859),N=s(87065),O=s(6136),D=s(10705),F=s(62760),P=s(78346),R=s(58605),x=s(45836),L=s(95557),k=s(10994),j=s(92481),M=s(50793);const z=e=>{if(!e)return new Date;const t=(0,L.Z)(e,"yyyy-MM-dd",new Date);return"Invalid Date"!==t.toString()?t:new Date(e)},V=e=>{const t=z((0,k.Z)(e).toString());return(0,j.Z)(t,"yyyy-MM-dd")===(0,j.Z)(z((new Date).toString()),"yyyy-MM-dd")},B=e=>{const t=new Date,s=(0,k.Z)(e);return s.setDate(s.getDate()+6),n=s,t.setHours(0,0,0,0)>n.setHours(0,0,0,0);var n},K=e=>(0,M.Z)((0,k.Z)(e),new Date);var G=s(6550),$=s(87752);class q{constructor(e,t){this.teamAdminStore=e,this.teamAdminService=t,this.getTeamTrialStatus=()=>(0,U.P)((()=>(this.teamAdminService.refreshState(),this.teamAdminStore.state$.pipe((0,N.U)((e=>e.isBillingOrFullAdmin?{isBillingOrFullAdmin:!0,isFreeTrial:e.billing.isFreeTrial,isGracePeriod:e.billing.isGracePeriod,creationDateUnix:e.creationDateUnix,nextBillingDetailsDateUnix:e.billing.nextBillingDetails.dateUnix,spaceTier:e.billing.planTier}:{isBillingOrFullAdmin:!1})),(0,O.x)(F.shallowEqualObjects),(0,N.U)((({isBillingOrFullAdmin:e,isFreeTrial:t,isGracePeriod:s,creationDateUnix:n,nextBillingDetailsDateUnix:r,spaceTier:i})=>e?(0,P.Vp)({isFreeTrial:t,isGracePeriod:s,isFirstDayOfTrial:V(n),isSecondStageOfTrial:B(n),daysLeftInTrial:K(r),spaceTier:i}):(0,P.Rn)(new R.$))))))),this.getTeamBillingDetails=()=>this.teamAdminStore.state$.pipe((0,N.U)((e=>{if(!e.isBillingOrFullAdmin)return{isBillingOrFullAdmin:!1};const{billing:t,seats:s}=e;return{isBillingOrFullAdmin:!0,nextBillingDetailsAmount:t.nextBillingDetails.amount,nextBillingDetailsCurrency:t.nextBillingDetails.currency,nextBillingDetailsDateUnix:t.nextBillingDetails.dateUnix,nextBillingAmountFormatted:t.nextBillingDetails.amount/100,billingType:t.billingMethod,spaceTier:t.planTier,creditCardLastDigits:t.creditCardLastDigits,lastBillingDateUnix:t.lastBillingDateUnix,seatsPaid:s.paid,seatsExtraFree:s.extraFree,usersToBeRenewedCount:t.usersToBeRenewedCount,planDetails:t.planDetails,duration:t.duration}})),(0,O.x)(((e,t)=>(0,D.Z)(e,t))),(0,N.U)((({isBillingOrFullAdmin:e,nextBillingDetailsAmount:t,nextBillingDetailsCurrency:s,nextBillingDetailsDateUnix:n,nextBillingAmountFormatted:r,billingType:i,spaceTier:a,creditCardLastDigits:o,lastBillingDateUnix:c,seatsPaid:d,seatsExtraFree:l,usersToBeRenewedCount:u,planDetails:p,duration:m})=>{if(!e)return(0,P.Rn)(new R.$);const h={amount:t,currency:"usd"===s?x.F.USD:x.F.EUR,dateUnix:n,amountFormatted:r,pricePerSeat:r/u};return(0,P.Vp)({billingType:i??null,spaceTier:a,creditCardLastDigits:o??null,lastBillingDateUnix:c,nextBillingDetails:h,seatsNumber:d+l,usersToBeRenewedCount:u,daysLeftUntilNextBillingPeriod:K(n),planDetails:{...p,duration:m}})}))),this.getTeamCapabilities=()=>this.teamAdminStore.state$.pipe((0,N.U)((e=>e.isBillingOrFullAdmin?e.capabilities:null)),(0,O.x)(((e,t)=>null!==e&&null!==t?(0,D.Z)(e,t):e===t)),(0,N.U)((e=>null===e?(0,P.Rn)(new R.$):(0,P.Vp)(e)))),this.getTeamCreationDateUnix=()=>this.teamAdminStore.state$.pipe((0,N.U)((e=>"NOT_LOADED"===e.loadingState||"LOADING"===e.loadingState&&!e.isBillingOrFullAdmin?null:!!e.isBillingOrFullAdmin&&e.creationDateUnix)),(0,O.x)(),(0,N.U)((e=>!1===e?(0,P.Rn)(new R.$):(0,P.Vp)(e)))),this.getTeamSeats=()=>this.teamAdminStore.state$.pipe((0,N.U)((e=>e.isBillingOrFullAdmin?(0,P.Vp)(e.seats):(0,P.Rn)(new R.$)))),this.getTeamSecurityScore=()=>this.teamAdminStore.state$.pipe((0,N.U)((e=>e.isBillingOrFullAdmin?(0,P.Vp)(e.securityScore):(0,P.Rn)(new R.$)))),this.getIndustryBenchmarkData=()=>this.teamAdminStore.state$.pipe((0,N.U)((e=>!!e.isBillingOrFullAdmin&&e.industryBenchmarkData)),(0,O.x)(((e,t)=>"boolean"!=typeof e&&"boolean"!=typeof t?(0,F.shallowEqualObjects)(e,t):e===t)),(0,N.U)((e=>!1===e?(0,P.Rn)(new R.$):(0,P.Vp)(e)))),this.getTeamName=()=>this.teamAdminStore.state$.pipe((0,N.U)((e=>e.isBillingOrFullAdmin?e.teamName:null)),(0,O.x)(),(0,N.U)((e=>null===e?(0,P.Rn)(new R.$):(0,P.Vp)(e)))),this.getTeamRoles=()=>this.teamAdminStore.state$.pipe((0,N.U)((e=>e.isBillingOrFullAdmin?(0,P.Vp)(e.teamRoles):(0,P.Rn)(new R.$)))),this.getTeamActiveDirectoryInfo=()=>this.teamAdminStore.state$.pipe((0,N.U)((e=>e.isBillingOrFullAdmin?(0,P.Vp)(e.settings.activeDirectoryInfo):(0,P.Rn)(new R.$)))),this.getTeamDuoInfo=()=>this.teamAdminStore.state$.pipe((0,N.U)((e=>e.isBillingOrFullAdmin?(0,P.Vp)(e.settings.duoInfo):(0,P.Rn)(new R.$)))),this.getTeamSsoInfo=()=>this.teamAdminStore.state$.pipe((0,N.U)((e=>e.isBillingOrFullAdmin?(0,P.Vp)(e.settings.ssoInfo):(0,P.Rn)(new R.$)))),this.getTeamProvisioningInfo=()=>this.teamAdminStore.state$.pipe((0,N.U)((e=>e.isBillingOrFullAdmin?(0,P.Vp)({provisioningSolution:e.settings.provisioningSolution}):(0,P.Rn)(new R.$)))),this.getTeamPolicies=()=>(0,U.P)((()=>(this.teamAdminService.refreshState(),this.teamAdminStore.state$.pipe((0,N.U)((e=>e.isBillingOrFullAdmin?e.policies:null)),(0,O.x)(((e,t)=>null!==e&&null!==t?(0,D.Z)(e,t):e===t)),(0,N.U)((e=>null===e?(0,P.Rn)(new R.$):(0,P.Vp)(e)))))))}}q=(0,n.gn)([(0,h.GS)(),(0,n.w6)("design:type",Function),(0,n.w6)("design:paramtypes",[void 0===G.C?Object:G.C,void 0===$.k?Object:$.k])],q);var H=s(30561);class W{constructor(e){this.serverApiClient=e,this.extendFreeTrial=async()=>{const e=await(0,m.z)(this.serverApiClient.v1.teams.extendFreeTrial({}));return(0,P.hx)(e)&&this.getExtendTrialFunctionalError(e.error.message),(0,P.Vp)(void 0)},this.getExtendTrialFunctionalError=e=>{switch(e){case H.sK.TEAM_NOT_FOUND:return(0,H.gv)();case H.sK.NOT_IN_FREE_TRIAL:return(0,H.AP)();case H.sK.IN_GRACE_PERIOD:return(0,H.RQ)();case H.sK.USER_NOT_ADMIN:return(0,H.lO)();default:return(0,H.gv)()}}}}W=(0,n.gn)([(0,h.GS)(),(0,n.w6)("design:type",Function),(0,n.w6)("design:paramtypes",[void 0===g.l?Object:g.l])],W);var Q=s(85390),Y=s(82567),X=s(52966),Z=s(14122),J=s(63144),ee=s(56618),te=s(62149),se=s(60018);const ne=e=>e===x.Uz.Canceled||e===x.Uz.None||e===x.Uz.Pending;class re extends((0,J.Q)({storage:{schemaVersion:1,initialValue:x.Uz.None,typeGuard:ne},persist:!0,scope:te.F.User,storeName:"plan-cancellation-store",capacity:ee.Y._001KB,codec:se.E})){}class ie{async refreshState(){const e=this.getTickets(),t=this.getIsRenewalStopped();return await(0,m.z)((0,Q.a)([e,t]).pipe((0,N.U)((([e,t])=>this.serverToDomainCancelStatusMapper(e,t))),(0,Y.b)((e=>{this.planCancellationStore.set(e)}))))}constructor(e,t,s){this.serverApiClient=e,this.planCancellationStore=t,this.carbon=s,this.createZendeskCancellationTicket=async e=>{const t=await(0,m.z)(this.serverApiClient.v1.teams.createZendeskCancellationTicket(e));return(0,P.hx)(t)&&this.getBusinessErrorsForCreateZendeskCancellationTicket(t.error.message),(0,P.Vp)(void 0)},this.getZendeskCancellationTicket=()=>(this.refreshState(),this.planCancellationStore.state$.pipe((0,O.x)(),(0,N.U)(P.Vp))),this.getBusinessErrorsForCreateZendeskCancellationTicket=e=>"TEAM_IN_FREE_TRIAL"===e?(0,X.VH)():"TEAM_IS_DISCONTINUED"===e?(0,X.fz)():(0,X.Rb)(),this.serverToDomainCancelStatusMapper=(e,t)=>(0,P.hx)(e)?x.Uz.Unknown:t?x.Uz.Canceled:void 0!==(0,P.db)(e).id?x.Uz.Pending:x.Uz.None,this.getIsRenewalStopped=()=>this.carbon.queries.getNodePremiumStatus().pipe((0,N.U)((e=>{if((0,P.hx)(e))throw new Error("Cannot retrieve node premium status from Carbon");return e.data.b2bStatus?.currentTeam?.isRenewalStopped}))),this.getTickets=()=>this.serverApiClient.v1.teams.getZendeskCancellationTicket({}).pipe((0,C.DZ)((e=>({tag:e.message}))),(0,C.Qn)((e=>e.data)))}}ie=(0,n.gn)([(0,h.GS)(),(0,n.w6)("design:type",Function),(0,n.w6)("design:paramtypes",[void 0===g.l?Object:g.l,void 0===re?Object:re,void 0===Z._?Object:Z._])],ie);var ae=s(7165);const oe=ae.z.object({isLoading:ae.z.boolean(),isTeamCreator:ae.z.boolean().optional()}),ce=e=>oe.safeParse(e).success;class de extends((0,J.Q)({initialValue:{isLoading:!1},storeTypeGuard:ce,persist:!1,isCache:!0,scope:te.F.User,storeName:"team-creator-store",capacity:ee.Y._010KB})){}class le extends((0,J.Q)({persist:!1,scope:te.F.Device,storeName:"admin-card-info",initialValue:{last4DigitsFormatted:"",expirationDateFormatted:"",hasCreditCardPaymentMethod:!1,isExpired:!1,billingCountry:"",cardType:""},capacity:ee.Y._001KB})){}var ue=s(3843);class pe{populateAdminCardInfoStore(){return this.serverApiClient.v1.premium.getSubscriptionInfo({}).pipe((0,N.U)((e=>{if(!(0,P.d6)(e))throw new Error(`Cannot retrieve subscription info. Error: ${e.error} `);const t=e.data.data.b2bSubscription?.billingInformation;return this.cardInfoStore.set({last4DigitsFormatted:this.formatCardLast4Digits(Number(t?.last4)),expirationDateFormatted:t?.exp_year&&t.exp_month?`${t.exp_month}/${t.exp_year.toString().substring(2)}`:"",hasCreditCardPaymentMethod:!!t?.last4,isExpired:this.isBillingMethodExpired(t),billingCountry:t?.country??"",cardType:t?.type??""}),(0,P.Vp)(void 0)})))}constructor(e,t){this.serverApiClient=e,this.cardInfoStore=t,this.isBillingMethodExpired=e=>!(!e?.exp_year||!e.exp_month)&&(0,ue.Z)(new Date(e.exp_year,e.exp_month,0)),this.formatCardLast4Digits=e=>e.toLocaleString("en-US",{minimumIntegerDigits:4,useGrouping:!1})}}pe=(0,n.gn)([(0,h.GS)(),(0,n.w6)("design:type",Function),(0,n.w6)("design:paramtypes",[void 0===g.l?Object:g.l,void 0===le?Object:le])],pe);var me=s(37182),he=s(69885),ge=s(63696),ve=s(31108),ye=s(71991),fe=s(58216);class be extends((0,a.AJ)()){}var Se=s(32054);class we{async refreshState(){const e=await(0,m.z)(this.isTeamAdmin()),t=await(0,m.z)(this.getUserLogin()),s=await(0,m.z)(this.getTeamId());if(e)return(0,m.z)(this.getTeamMembersData.get(s).pipe((0,N.U)((e=>{if((0,P.hx)(e))throw new Error("Error: could not retrieve team's members");const{data:s}=e;this.teamCreatorStore.set({isTeamCreator:this.isTeamCreator(s,t),isLoading:!1})}))));await this.teamCreatorStore.set({isTeamCreator:!1,isLoading:!1})}constructor(e,t,s,n,r,i){this.logger=e,this.permissionsClient=t,this.teamPlanDetailsClient=s,this.getTeamMembersData=n,this.sessionClient=r,this.teamCreatorStore=i,this.isTeamCreator=(e,t)=>{const s=e.members.filter((e=>(0,fe.F)(e)&&e.isTeamCaptain)).sort(((e,t)=>(e.joinedDateUnix??0)-(t.joinedDateUnix??0)));return s[0]?.login===t},this.getTeamId=()=>{const{getTeamId:e}=this.teamPlanDetailsClient.queries;return e().pipe((0,N.U)((e=>(0,P.hx)(e)||!e.data.teamId?"":e.data.teamId)))},this.isTeamAdmin=()=>{const{userPermissions:e}=this.permissionsClient.queries;return e().pipe((0,N.U)((e=>{if((0,P.hx)(e))throw new Error("is-team-creator: error occurred while retrieving permissions",{cause:{failure:(0,P.Yv)(e)}});return e.data.includes("ALL")})),(0,me.K)((e=>(this.logger.error("Unable to retrieve user permissions",{error:e}),(0,he.of)(!1)))),(0,O.x)())},this.getUserLogin=()=>{const{selectedOpenedSession:e}=this.sessionClient.queries;return e().pipe((0,N.U)((e=>{if((0,P.d6)(e)&&"string"==typeof e.data&&""!==e.data)return e.data;throw new Error("No active login")})))}}}we=(0,n.gn)([(0,h.GS)(),(0,n.w6)("design:type",Function),(0,n.w6)("design:paramtypes",[void 0===be?Object:be,void 0===ye.J?Object:ye.J,void 0===ve.e?Object:ve.e,void 0===Se.G?Object:Se.G,void 0===ge.x?Object:ge.x,void 0===de?Object:de])],we);var Ee=s(44272),_e=s(82874),Ce=s(36833);class Ie{async execute({body:e}){const{seats:t}=e,s=await this.addSeatsService.addSeats({seats:t});return(0,P.d6)(s)&&await this.teamAdminService.refreshState(),s}constructor(e,t){this.teamAdminService=e,this.addSeatsService=t}}Ie=(0,n.gn)([(0,_e.W)(Ce.E),(0,n.w6)("design:type",Function),(0,n.w6)("design:paramtypes",[void 0===$.k?Object:$.k,void 0===A?Object:A])],Ie);class Te{async execute(){const e=await this.freeTrialService.extendFreeTrial();return(0,P.d6)(e)&&await this.teamAdminService.refreshState(),e}constructor(e,t){this.freeTrialService=e,this.teamAdminService=t}}Te=(0,n.gn)([(0,_e.W)(H.No),(0,n.w6)("design:type",Function),(0,n.w6)("design:paramtypes",[void 0===W?Object:W,void 0===$.k?Object:$.k])],Te);const Ae={[x.Gr.ChoseOtherPasswordManager]:"cancellation_switched_to_competitor",[x.Gr.DownsizedEmployeeCount]:"cancellation_acquisition_or_restructured",[x.Gr.MissingCriticalFeatures]:"cancellation_lack_of_features",[x.Gr.NoInternalUsage]:"cancellation_lack_of_adoption",[x.Gr.Other]:"cancellation_other",[x.Gr.TechnicalIssues]:"cancellation_technical_issues",[x.Gr.TooExpensive]:"cancellation_price"};class Ue{async execute({body:e}){const{reasons:t}=e,s=(e=>({reasons:e.map((e=>Ae[e]))}))(t),n=await this.planCancellationService.createZendeskCancellationTicket(s);return(0,P.d6)(n)&&await this.planCancellationService.refreshState(),n}constructor(e){this.planCancellationService=e}}Ue=(0,n.gn)([(0,_e.W)(X.y7),(0,n.w6)("design:type",Function),(0,n.w6)("design:paramtypes",[void 0===ie?Object:ie])],Ue);var Ne=s(45364);class Oe{async execute({body:e}){const{teamId:t,newTeamName:s}=e,n=await(0,m.z)(this.serverApiClient.v1.teams.editSettings({teamId:t,operations:[{type:"set_name",value:s}]}));return(0,P.hx)(n)?"code"in n.error&&"team_name_already_exists"===n.error.code?(0,P.Rn)((0,Ne.U8)()):"NOT_ADMIN"===n.error.message?(0,P.Rn)((0,Ne.QI)()):"NOT_AUTHORIZED"===n.error.message?(0,P.Rn)((0,Ne.Kv)()):(0,P.Rn)((0,Ne.mX)()):(0,P.Vp)(void 0)}constructor(e){this.serverApiClient=e}}Oe=(0,n.gn)([(0,_e.W)(Ne.Q2),(0,n.w6)("design:type",Function),(0,n.w6)("design:paramtypes",[void 0===g.l?Object:g.l])],Oe);var De=s(8025),Fe=s(72223);class Pe{async execute({body:e}){const{teamId:t,policyUpdates:s}=e;return await(0,m.z)(this.serverApiClient.v1.teams.editSettings((0,Fe.e)(t,s))),await this.teamAdminService.refreshState(),(0,P.Vp)(void 0)}constructor(e,t){this.teamAdminService=e,this.serverApiClient=t}}Pe=(0,n.gn)([(0,_e.W)(De.m),(0,n.w6)("design:type",Function),(0,n.w6)("design:paramtypes",[void 0===$.k?Object:$.k,void 0===g.l?Object:g.l])],Pe);var Re=s(3434);class xe{async execute({body:e}){const{feedbackBody:t}=e,s=await(0,m.z)(this.serverApiClient.v1.feedback.sendFeedback({title:"A team Admin just wrote to us:",body:t}));return(0,P.hx)(s)?(0,P.Rn)((0,Re.b6)()):(0,P.Vp)(void 0)}constructor(e){this.serverApiClient=e}}xe=(0,n.gn)([(0,_e.W)(Re.cr),(0,n.w6)("design:type",Function),(0,n.w6)("design:paramtypes",[void 0===g.l?Object:g.l])],xe);var Le=s(23099);class ke{async execute({body:{newAdminEmail:e}}){const t=await(0,m.z)(this.serverApiClient.v1.teams.updateBillingAdmin({newAdminLogin:e}));if((0,P.hx)(t))throw new Error(`Unable to update billing admin. ${t.error.message}`);return(0,P.Vp)(void 0)}constructor(e){this.serverApiClient=e}}ke=(0,n.gn)([(0,_e.W)(Le.t),(0,n.w6)("design:type",Function),(0,n.w6)("design:paramtypes",[void 0===g.l?Object:g.l])],ke);var je=s(93216);class Me{async execute(){return await(0,m.z)(this.cardInfoService.populateAdminCardInfoStore())}constructor(e){this.cardInfoService=e}}Me=(0,n.gn)([(0,_e.W)(je.H),(0,n.w6)("design:type",Function),(0,n.w6)("design:paramtypes",[void 0===pe?Object:pe])],Me);var ze=s(12723),Ve=s(85798);class Be{async handle(){await this.teamAdminService.refreshState()}constructor(e){this.teamAdminService=e}}Be=(0,n.gn)([(0,Ve.b)(ze.M),(0,n.w6)("design:type",Function),(0,n.w6)("design:paramtypes",[void 0===$.k?Object:$.k])],Be);var Ke=s(67267);class Ge{async handle(){await this.teamAdminService.refreshState()}constructor(e){this.teamAdminService=e}}Ge=(0,n.gn)([(0,Ve.b)(Ke.q),(0,n.w6)("design:type",Function),(0,n.w6)("design:paramtypes",[void 0===$.k?Object:$.k])],Ge);var $e=s(84895);class qe{async handle(){await this.teamCreatorService.refreshState()}constructor(e){this.teamCreatorService=e}}qe=(0,n.gn)([(0,Ve.b)($e.L),(0,n.w6)("design:type",Function),(0,n.w6)("design:paramtypes",[void 0===we?Object:we])],qe);var He=s(46449),We=s(20249);class Qe{execute(){return this.cardInfoStore.state$.pipe((0,N.U)((e=>(0,P.Vp)(e))))}constructor(e){this.cardInfoStore=e}}Qe=(0,n.gn)([(0,He.e)(We._),(0,n.w6)("design:type",Function),(0,n.w6)("design:paramtypes",[void 0===le?Object:le])],Qe);var Ye=s(162),Xe=s(29151);class Ze{execute(){return(0,Ye.D)(this.getTeamPlanDetailsService.getIndustryBenchmarkData())}constructor(e){this.getTeamPlanDetailsService=e}}Ze=(0,n.gn)([(0,He.e)(Xe.l),(0,n.w6)("design:type",Function),(0,n.w6)("design:paramtypes",[void 0===q?Object:q])],Ze);var Je=s(49649);class et{execute(){return this.getTeamPlanDetailsService.getTeamActiveDirectoryInfo()}constructor(e){this.getTeamPlanDetailsService=e}}et=(0,n.gn)([(0,He.e)(Je.e),(0,n.w6)("design:type",Function),(0,n.w6)("design:paramtypes",[void 0===q?Object:q])],et);var tt=s(31933);class st{execute(){return(0,Ye.D)(this.getTeamPlanDetailsService.getTeamBillingDetails())}constructor(e){this.getTeamPlanDetailsService=e}}st=(0,n.gn)([(0,He.e)(tt._),(0,n.w6)("design:type",Function),(0,n.w6)("design:paramtypes",[void 0===q?Object:q])],st);var nt=s(93478);class rt{execute(){return this.planCancellationService.getZendeskCancellationTicket()}constructor(e){this.planCancellationService=e}}rt=(0,n.gn)([(0,He.e)(nt.F),(0,n.w6)("design:type",Function),(0,n.w6)("design:paramtypes",[void 0===ie?Object:ie])],rt);var it=s(47883);class at{execute(){return this.getTeamPlanDetailsService.getTeamCapabilities()}constructor(e){this.getTeamPlanDetailsService=e}}at=(0,n.gn)([(0,He.e)(it.Y),(0,n.w6)("design:type",Function),(0,n.w6)("design:paramtypes",[void 0===q?Object:q])],at);var ot=s(8365);class ct{execute(){return(0,Ye.D)(this.getTeamPlanDetailsService.getTeamCreationDateUnix())}constructor(e){this.getTeamPlanDetailsService=e}}ct=(0,n.gn)([(0,He.e)(ot.T),(0,n.w6)("design:type",Function),(0,n.w6)("design:paramtypes",[void 0===q?Object:q])],ct);var dt=s(14784);class lt{execute(){return this.getTeamPlanDetailsService.getTeamDuoInfo()}constructor(e){this.getTeamPlanDetailsService=e}}lt=(0,n.gn)([(0,He.e)(dt.Z),(0,n.w6)("design:type",Function),(0,n.w6)("design:paramtypes",[void 0===q?Object:q])],lt);var ut=s(44096);class pt{execute(){const{carbonState:e}=this.carbon.queries;return e({path:"state.userSession.spaceData.spaces"}).pipe((0,N.U)((e=>{if(!(0,P.d6)(e))throw new Error("Cannot retrieve user spaces");const t=e.data.find((e=>"accepted"===e.details.status));return t?t.teamId:null})),(0,O.x)(),(0,N.U)((e=>(0,P.Vp)({teamId:e}))))}constructor(e){this.carbon=e}}pt=(0,n.gn)([(0,He.e)(ut.e),(0,n.w6)("design:type",Function),(0,n.w6)("design:paramtypes",[void 0===Z._?Object:Z._])],pt);var mt=s(22283);class ht{execute(){return this.getTeamPlanDetailsService.getTeamName()}constructor(e){this.getTeamPlanDetailsService=e}}ht=(0,n.gn)([(0,He.e)(mt.j),(0,n.w6)("design:type",Function),(0,n.w6)("design:paramtypes",[void 0===q?Object:q])],ht);var gt=s(88273);class vt{execute(){return(0,Ye.D)(this.getTeamPlanDetailsService.getTeamRoles())}constructor(e){this.getTeamPlanDetailsService=e}}vt=(0,n.gn)([(0,He.e)(gt.R),(0,n.w6)("design:type",Function),(0,n.w6)("design:paramtypes",[void 0===q?Object:q])],vt);var yt=s(51183);class ft{execute(){return this.getTeamPlanDetailsService.getTeamPolicies()}constructor(e){this.getTeamPlanDetailsService=e}}ft=(0,n.gn)([(0,He.e)(yt.K),(0,n.w6)("design:type",Function),(0,n.w6)("design:paramtypes",[void 0===q?Object:q])],ft);var bt=s(22057);class St{execute(){return this.getTeamPlanDetailsService.getTeamProvisioningInfo()}constructor(e){this.getTeamPlanDetailsService=e}}St=(0,n.gn)([(0,He.e)(bt.j),(0,n.w6)("design:type",Function),(0,n.w6)("design:paramtypes",[void 0===q?Object:q])],St);var wt=s(3463);class Et{execute(){return(0,Ye.D)(this.getTeamPlanDetailsService.getTeamSeats())}constructor(e){this.getTeamPlanDetailsService=e}}Et=(0,n.gn)([(0,He.e)(wt.W),(0,n.w6)("design:type",Function),(0,n.w6)("design:paramtypes",[void 0===q?Object:q])],Et);var _t=s(20270);class Ct{execute(){return(0,Ye.D)(this.getTeamPlanDetailsService.getTeamSecurityScore())}constructor(e){this.getTeamPlanDetailsService=e}}Ct=(0,n.gn)([(0,He.e)(_t.R),(0,n.w6)("design:type",Function),(0,n.w6)("design:paramtypes",[void 0===q?Object:q])],Ct);var It=s(621);class Tt{execute(){return this.getTeamPlanDetailsService.getTeamSsoInfo()}constructor(e){this.getTeamPlanDetailsService=e}}Tt=(0,n.gn)([(0,He.e)(It.m),(0,n.w6)("design:type",Function),(0,n.w6)("design:paramtypes",[void 0===q?Object:q])],Tt);var At=s(15640);class Ut{execute(){return this.getTeamPlanDetailsService.getTeamTrialStatus()}constructor(e){this.getTeamPlanDetailsService=e}}Ut=(0,n.gn)([(0,He.e)(At.P),(0,n.w6)("design:type",Function),(0,n.w6)("design:paramtypes",[void 0===q?Object:q])],Ut);var Nt=s(10729);class Ot{execute(){return this.teamCreatorStore.state$.pipe((0,N.U)((e=>e.isTeamCreator??null)),(0,O.x)(),(0,N.U)(P.Vp))}constructor(e){this.teamCreatorStore=e}}Ot=(0,n.gn)([(0,He.e)(Nt.G7),(0,n.w6)("design:type",Function),(0,n.w6)("design:paramtypes",[void 0===de?Object:de])],Ot);class Dt{}Dt=(0,n.gn)([(0,r.Y)({api:c.o,imports:[o.n,Ee.X,i.G],providers:[(0,a.ND)(be),A,W,q,$.k,p.J,ie,pe,we],stores:[G.C,re,de,le],handlers:{commands:{addSeats:Ie,extendFreeTrial:Te,requestTeamPlanCancellation:Ue,editTeamName:Oe,editTeamPolicies:Pe,sendFeedback:xe,updateBillingAdmin:ke,refreshAdminCardInfo:Me},events:{...(0,r.g)(l.Q,{sessionOpened:Be}),...(0,r.g)(d.L,{membersAdded:Ge}),...(0,r.g)(u.J,{permissionsLoaded:qe})},queries:{getAdminCardInfo:Qe,getIndustryBenchmarkData:Ze,getTeamActiveDirectoryInfo:et,getTeamBillingInformation:st,getTeamCancellationStatus:rt,getTeamCapabilities:at,getTeamCreationDateUnix:ct,getTeamDuoInfo:lt,getTeamId:pt,getTeamName:ht,getTeamRoles:vt,getTeamPolicies:ft,getTeamProvisioningInfo:St,getTeamSeats:Et,getTeamSecurityScore:Ct,getTeamSsoInfo:Tt,getTeamTrialStatus:Ut,isTeamCreator:Ot}},requiredFeatureFlips:Object.values({DashHackIndustryBenchmarkDev:"dashhack_web_securityScoreBenchmark",ComputePlanPricingMigration:"ecommerce_web_compute_plan_price_details_migration"})})],Dt)},87752:(e,t,s)=>{s.d(t,{k:()=>E});var n=s(92336),r=s(60399),i=s(87065),a=s(92587),o=s(53344),c=s(78346),d=s(47415),l=s(45836);const u=e=>{switch(e){case"legacy":default:return l.lD.Legacy;case"starter":return l.lD.Starter;case"team":return l.lD.Team;case"business":return l.lD.Business;case"businessplus":return l.lD.BusinessPlus;case"entreprise":return l.lD.Enterprise;case"standard":return l.lD.Standard}},p=e=>{switch(e){case"in_team":return l.yt.InTeam;case"not_premium":return l.yt.NotPremium;case"no_payment":return l.yt.NoPayment;case"is_unpaid_family_member":return l.yt.IsUnpaidFamilyMember;case"default_settings":default:return l.yt.DefaultSettings;case"no_vpn_capability":return l.yt.NoVPNCapability;case"disabled_for_free_user":return l.yt.DisabledForFreeUser}};var m=s(72223);const h=e=>{const{enabled:t,info:s}=e;let n;return s&&(n={limit:s.limit??void 0,maxFileSize:s.maxFileSize??void 0,quota:s.quota??void 0,reason:s.reason?p(s.reason):void 0,excludedPolicies:s.excludedPolicies??void 0}),{enabled:t,info:n}},g=e=>{const{activeDirectorySync:t,activityLog:s,phoneSupport:n,samlProvisioning:r,scim:i,sso:a,usageReports:o,adminPolicies:c,groupSharing:d}=e;return{activeDirectorySync:h(t),activityLog:h(s),phoneSupport:h(n),samlProvisioning:h(r),scim:h(i),sso:h(a),usageReports:h(o),adminPolicies:h(c),groupSharing:h(d)}},v=(e,t,s)=>({...e,billingMethod:(e=>{if(e)return"invoice"===e?l.qo.Invoice:l.qo.ProcessOut})(s?.planDetails?.type),duration:s?.planDetails?.duration,planTier:u(t)}),y=e=>new Set(Object.keys(e)),f=(e,t)=>({provisioningSolution:e.provisioningSolution??"none",activeDirectoryInfo:{activeDirectorySyncType:e.activeDirectorySyncType,activeDirectoryToken:e.activeDirectoryToken,activeDirectorySyncStatus:t},duoInfo:{duo:e.duo,duoApiHostname:e.duoApiHostname,duoIntegrationKey:e.duoIntegrationKey,duoSecretKey:e.duoSecretKey,recoveryEnabled:e.recoveryEnabled},ssoInfo:{ssoSolution:e.ssoSolution??"none",ssoEnabled:!!e.ssoEnabled,ssoServiceProviderUrl:e.ssoServiceProviderUrl,ssoIdpMetadata:e.ssoIdpMetadata,ssoIdpEntrypoint:e.ssoIdpEntrypoint,ssoIsNitroProvider:e.ssoIsNitroProvider,uuid:e.uuid}}),b=(e,t)=>{if(!t||!e)return null;const{averageSecurityScore:s,top25Percentile:n}=t;return{averageSecurityScore:s,top25Percentile:n,ratingVSIndustry:e>s?"higher":e<s?"lower":"onPar",deltaVSIndustry:Math.abs(e-s)}};var S=s(6550);let w=null;class E{async refreshState(){const e=await this.isUserTeamAdminService.isBillingAdmin,t=await this.isUserTeamAdminService.isFullRightsAdmin;if(!e&&!t)return void this.teamAdminStore.set({isBillingOrFullAdmin:!1,loadingState:"LOADED",lastRefreshDate:0});const s=await this.teamAdminStore.getState();return s.isBillingOrFullAdmin&&s.lastRefreshDate+this.MIN_DELAY_BETWEEN_REFRESHES>Date.now()?void 0:(w||(w=this.refresh(s,t)),await w)}async refresh(e,t){this.teamAdminStore.set({...e,loadingState:"LOADING",lastRefreshDate:Date.now()});const s=t?await this.getActiveDirectorySyncStatus():void 0,n=await this.getTeamSubscriptionInfo(),r=await this.getTeamStatus();if(!r)return this.teamAdminStore.set({...e,loadingState:"LOADED",isBillingOrFullAdmin:!1}),w=null,{};const i=((e,t,s)=>{const{securityScore:n,industryBenchmarkData:r,creationDateUnix:i,billing:a,capabilities:o,seats:c,planTier:d,info:l}=e,{name:u,groupManagers:p,teamCaptains:h}=l;return{isBillingOrFullAdmin:!0,creationDateUnix:i,loadingState:"LOADED",teamName:u,securityScore:n,industryBenchmarkData:b(n,r),seats:c,capabilities:g(o),billing:v(a,d,s),teamRoles:{groupManagersIds:p,teamCaptainsIds:y(h)},lastRefreshDate:Date.now(),policies:(0,m.O)(l,o),settings:f(l,t)}})(r,s,n);return this.teamAdminStore.set(i),w=null,i}getActiveDirectorySyncStatus(){return(0,r.z)(this.serverApiClient.v1.teams.getDirectorySyncToken({}).pipe((0,i.U)((e=>{if(!(0,c.hx)(e))return e.data.data.activeDirectorySyncStatus}))))}getTeamStatus(){return(0,r.z)(this.serverApiClient.v1.teams.teamStatus({}).pipe((0,i.U)((e=>{if(!(0,c.hx)(e))return e.data.data}))))}getTeamSubscriptionInfo(){return(0,r.z)(this.serverApiClient.v1.premium.getSubscriptionInfo({}).pipe((0,i.U)((e=>{if(!(0,c.hx)(e))return e.data.data.b2bSubscription}))))}constructor(e,t,s){this.serverApiClient=e,this.isUserTeamAdminService=t,this.teamAdminStore=s,this.MIN_DELAY_BETWEEN_REFRESHES=500}}E=(0,n.gn)([(0,a.GS)(),(0,n.w6)("design:type",Function),(0,n.w6)("design:paramtypes",[void 0===o.l?Object:o.l,void 0===d.J?Object:d.J,void 0===S.C?Object:S.C])],E)},6550:(e,t,s)=>{s.d(t,{C:()=>S});var n=s(63144),r=s(56618),i=s(62149),a=s(7165),o=s(45836);const c=a.z.union([a.z.object({reason:a.z.union([a.z.custom(),a.z.undefined()]),quota:a.z.union([a.z.object({max:a.z.union([a.z.number(),a.z.undefined()]),remaining:a.z.union([a.z.number(),a.z.undefined()])}),a.z.undefined()]),maxFileSize:a.z.union([a.z.number(),a.z.undefined()]),limit:a.z.union([a.z.number(),a.z.undefined()]),excludedPolicies:a.z.union([a.z.array(a.z.string()),a.z.undefined()])}),a.z.undefined()]),d=a.z.object({paid:a.z.number(),extraFree:a.z.number(),remaining:a.z.number()}),l=a.z.object({billingMethod:a.z.union([a.z.custom(),a.z.undefined()]),creditCardLastDigits:a.z.union([a.z.string(),a.z.undefined()]),duration:a.z.union([a.z.literal("monthly"),a.z.literal("yearly"),a.z.literal("other"),a.z.undefined()]),isFreeTrial:a.z.boolean(),isGracePeriod:a.z.boolean(),planTier:a.z.custom(),lastBillingDateUnix:a.z.number(),nextBillingDetails:a.z.object({amount:a.z.number(),currency:a.z.union([a.z.literal("eur"),a.z.literal("usd")]),dateUnix:a.z.number()}),usersToBeRenewedCount:a.z.number(),planDetails:a.z.object({currency:a.z.union([a.z.literal("eur"),a.z.literal("usd")]),priceRanges:a.z.array(a.z.object({startMembers:a.z.number(),price:a.z.number(),equivalentPrice:a.z.number()}))})}),u=a.z.object({enabled:a.z.boolean(),info:c}),p=a.z.object({samlProvisioning:u,sso:u,scim:u,phoneSupport:u,activeDirectorySync:u,activityLog:u,usageReports:u,adminPolicies:u,groupSharing:u}),m=a.z.object({lastSuccessfulSync:a.z.union([a.z.object({id:a.z.number(),teamId:a.z.number(),status:a.z.string(),proposedCount:a.z.union([a.z.number(),a.z.undefined()]),reproposedCount:a.z.union([a.z.number(),a.z.undefined()]),unproposedCount:a.z.union([a.z.number(),a.z.undefined()]),removedCount:a.z.union([a.z.number(),a.z.undefined()]),validCount:a.z.union([a.z.number(),a.z.undefined()]),durationMs:a.z.number(),eventDateUnix:a.z.number()}),a.z.null()]),lastFailedSync:a.z.union([a.z.object({id:a.z.number(),teamId:a.z.number(),status:a.z.string(),error:a.z.union([a.z.string(),a.z.undefined()]),durationMs:a.z.number(),eventDateUnix:a.z.number()}),a.z.null(),a.z.undefined()]),failedSyncCount:a.z.union([a.z.number(),a.z.undefined()])}),h=a.z.object({provisioningSolution:a.z.nativeEnum({none:"none",confidentialScim:"confidential-scim",selfHostedScim:"self-hosted-scim",adSync:"adsync"}).nullable().optional(),activeDirectoryInfo:a.z.object({activeDirectorySyncType:a.z.union([a.z.string(),a.z.undefined()]),activeDirectoryToken:a.z.union([a.z.string(),a.z.undefined()]),activeDirectorySyncStatus:a.z.union([m,a.z.undefined()])}),duoInfo:a.z.object({duo:a.z.union([a.z.boolean(),a.z.undefined()]),duoApiHostname:a.z.union([a.z.string(),a.z.undefined()]),duoIntegrationKey:a.z.union([a.z.string(),a.z.undefined()]),duoSecretKey:a.z.union([a.z.string(),a.z.undefined()]),recoveryEnabled:a.z.union([a.z.boolean(),a.z.undefined()])}),ssoInfo:a.z.object({ssoEnabled:a.z.boolean(),ssoSolution:a.z.nativeEnum({none:"none",confidentialSaml:"confidential-saml",selfHostedSaml:"self-hosted-saml",ssoConnector:"sso-connector"}).nullable().optional(),ssoIsNitroProvider:a.z.boolean().optional(),ssoServiceProviderUrl:a.z.string().nullable(),ssoIdpMetadata:a.z.string().nullable(),ssoIdpEntrypoint:a.z.string().nullable(),uuid:a.z.string().nullable().optional()})}),g=a.z.enum(["NOT_LOADED","LOADING","LOADED"]),v=a.z.object({isBillingOrFullAdmin:a.z.literal(!0),loadingState:g,lastRefreshDate:a.z.number(),billing:l,seats:d,capabilities:p,securityScore:a.z.number().nullable(),industryBenchmarkData:a.z.custom().nullable(),creationDateUnix:a.z.number(),teamName:a.z.string(),teamRoles:a.z.object({groupManagersIds:a.z.array(a.z.number()),teamCaptainsIds:a.z.set(a.z.string())}),policies:o.ym,settings:h}),y=a.z.object({isBillingOrFullAdmin:a.z.literal(!1),loadingState:g,lastRefreshDate:a.z.number()}),f=a.z.discriminatedUnion("isBillingOrFullAdmin",[v,y]),b=e=>f.safeParse(e).success;class S extends((0,n.Q)({initialValue:{isBillingOrFullAdmin:!1,lastRefreshDate:0,loadingState:"NOT_LOADED"},storeTypeGuard:b,persist:!1,isCache:!0,scope:i.F.User,storeName:"team-admin-store",capacity:r.Y._010KB})){}},95324:(e,t,s)=>{s.d(t,{c:()=>M});var n=s(92336),r=s(86006),i=s(41511),a=s(27006),o=s(60399),c=s(92587),d=s(53344),l=function(e){return e.PaymentMeanIsNotCreditCard="PaymentMeanIsNotCreditCard",e.CurrentPlanStartDateInFuture="CurrentPlanStartDateInFuture",e.ChangeTierMidCycleError="ChangeTierMidCycleError",e.PaymentMeanIsNotInvoice="PaymentMeanIsNotInvoice",e.ChangeTierAmountTooExpensive="ChangeTierAmountTooExpensive",e.ErrorCalculatingTierChange="ErrorCalculatingTierChange",e.InsufficientAmount="InsufficientAmount",e.AssignedPlanSameTierAsCurrentPlan="AssignedPlanSameTierAsCurrentPlan",e.SalesTaxMismatch="SalesTaxMismatch",e.NotBillingAdmin="NotBillingAdmin",e.ChangeTierMidCycleInternalServer="ChangeTierMidCycleInternalServer",e}({}),u=function(e){return e.NoMtuDuringGracePeriod="NoMtuDuringGracePeriod",e.MidCycleTierUpgradePriceInternalServer="MidCycleTierUpgradePriceInternalServer",e}({}),p=s(33312),m=s(52477),h=s(17591);class g{changeTierMidcycle({amountToPay:e,taxes:t,planId:s,couponCode:n,newTotalNumberOfSeats:r,billingContactEmail:i}){return(0,o.z)(this.serverApiClient.v1.teams.changeTierMidCycleV2({amountToPay:e,taxes:t,planId:s,couponCode:n,newTotalNumberOfSeats:r,billingContactEmail:i}).pipe((0,p.DZ)((e=>(0,m.EQ)(e,{BusinessError:e=>this.getFunctionalError(e.code),FetchFailedError:h.j,BadStatus:h.j,InternalServerError:()=>({tag:l.ChangeTierMidCycleInternalServer}),InvalidRequest:h.j,RateLimited:h.j,ServiceUnavailable:h.j,UnspecifiedBadStatus:h.j}))),(0,p.Qn)((e=>e.data))))}getMidcycleTierUpgradePrice({newTotalNumberOfSeats:e,newPlan:t}){return(0,o.z)(this.serverApiClient.v1.teams.getMidCycleTierUpgradePriceV2({newTotalNumberOfSeats:e,newPlan:t}).pipe((0,p.DZ)((e=>(0,m.EQ)(e,{BusinessError:e=>this.getMidCycleTierUpgradePriceFunctionalError(e.code),FetchFailedError:h.j,BadStatus:h.j,InternalServerError:()=>({tag:u.MidCycleTierUpgradePriceInternalServer}),InvalidRequest:h.j,RateLimited:h.j,ServiceUnavailable:h.j,UnspecifiedBadStatus:h.j}))),(0,p.Qn)((e=>e.data))))}constructor(e){this.serverApiClient=e,this.getFunctionalError=e=>{switch(e){case"PAYMENT_MEAN_IS_NOT_CREDITCARD":return{tag:l.PaymentMeanIsNotCreditCard};case"CURRENT_PLAN_START_DATE_IN_FUTURE":return{tag:l.CurrentPlanStartDateInFuture};case"CHANGE_TIER_MID_CYCLE_ERROR":return{tag:l.ChangeTierMidCycleError};case"PAYMENT_MEAN_IS_NOT_INVOICE":return{tag:l.PaymentMeanIsNotInvoice};case"CHANGE_TIER_AMOUNT_TOO_EXPENSIVE":return{tag:l.ChangeTierAmountTooExpensive};case"ERROR_CALCULATING_TIER_CHANGE_DISCOUNT":return{tag:l.ErrorCalculatingTierChange};case"INSUFFICIENT_AMOUNT":return{tag:l.InsufficientAmount};case"ASSIGNED_PLAN_SAME_TIER_AS_CURRENT_PLAN":return{tag:l.AssignedPlanSameTierAsCurrentPlan};case"sales_tax_mismatch":return{tag:l.SalesTaxMismatch};case"not_billing_admin":return{tag:l.NotBillingAdmin};default:throw new Error(`ChangeTierMidCycle: error ${e}`)}},this.getMidCycleTierUpgradePriceFunctionalError=e=>{if("NO_MTU_DURING_GRACE_PERIOD"===e)return{tag:u.NoMtuDuringGracePeriod};throw new Error(`MidCycleTierUpgradePriceV2: error ${e}`)}}}g=(0,n.gn)([(0,c.GS)(),(0,n.w6)("design:type",Function),(0,n.w6)("design:paramtypes",[void 0===d.l?Object:d.l])],g);var v=s(62149),y=s(63144),f=s(56618);class b extends((0,y.Q)({persist:!1,scope:v.F.Device,storeName:"plan-pricing-details",initialValue:{renewal:{seatsCount:0,value:0},additionalSeats:{seatsCount:0,value:0},currency:"usd"},capacity:f.Y._001KB})){}var S=s(82874),w=s(66499),E=s(87065),_=s(78346);class C{constructor(e,t){this.serverApiClient=e,this.computePlanPricingStore=t,this.computePlanPricingInStore=async e=>{const t=await(0,o.z)(this.serverApiClient.v1.teams.computePlanPricing({seats:e}).pipe((0,E.U)((e=>{if((0,_.hx)(e)){if("BusinessError"===e.error.tag)return"cannot_add_seat_during_grace_period"===e.error.code?(0,_.Rn)((0,w.C9)()):(0,_.Rn)((0,w.rm)());throw new Error(e.error.message)}const{renewal:t,additionalSeats:s}=e.data.data;return(0,_.Vp)({renewal:t,additionalSeats:s,currency:t.price.currency})}))));if("failure"===t.tag)throw new Error(t.error.message);const{renewal:s,additionalSeats:n}=t.data;return this.computePlanPricingStore.set({renewal:{seatsCount:s.seatsCount,value:s.price.value,taxes:s.price.taxes},additionalSeats:{seatsCount:n.seatsCount,value:n.price.value,taxes:n.price.taxes},currency:s.price.currency}),(0,_.Vp)(void 0)}}}C=(0,n.gn)([(0,c.GS)(),(0,n.w6)("design:type",Function),(0,n.w6)("design:paramtypes",[void 0===d.l?Object:d.l,void 0===b?Object:b])],C);class I{async execute({body:{numberOfSeats:e}}){return this.planPricingService.computePlanPricingInStore(e)}constructor(e){this.planPricingService=e}}I=(0,n.gn)([(0,S.W)(w.wf),(0,n.w6)("design:type",Function),(0,n.w6)("design:paramtypes",[void 0===C?Object:C])],I);var T=s(51060);class A{upgradeTeamWithExistingCc({planId:e,countryCode:t,membersNumber:s,amountToPayInCents:n,taxesToPayInCents:r,couponCode:i,vatNumber:a}){return(0,o.z)(this.serverApiClient.v1.teams.upgradeTeamWithExistingCc({planId:e,countryCode:t,membersNumber:s,amountToPayInCents:n,taxesToPayInCents:r,couponCode:i,vatNumber:a}).pipe((0,p.DZ)((e=>(0,m.EQ)(e,{BusinessError:e=>this.getFunctionalError(e.code),FetchFailedError:h.j,BadStatus:h.j,InternalServerError:h.j,InvalidRequest:h.j,RateLimited:h.j,ServiceUnavailable:h.j,UnspecifiedBadStatus:h.j}))),(0,p.Qn)((e=>e.data))))}constructor(e){this.serverApiClient=e,this.getFunctionalError=e=>{switch(e){case T.AI.STARTER_PLAN_NOT_10_SEATS:return(0,T.Zy)();case T.AI.USER_SUBSCRIBING_NOT_FOUND:return(0,T.L7)();case T.AI.CANNOT_INVOICE_FREE_PLAN:return(0,T.hY)();case T.AI.PAYMENT_ERROR_DURING_UPGRADE:return(0,T.g3)();case T.AI.SEATS_TO_PURCHASE_LOWER_ACTUAL_USAGE:return(0,T.oH)();case T.AI.NOT_IN_A_TEAM_PLAN:return(0,T.NS)();case T.AI.NOT_TEAM_CAPTAIN:return(0,T.d3)();case T.AI.NOT_IN_FREE_TRIAL:return(0,T._1)();case T.AI.INVALID_PLAN:return(0,T.fu)();case T.AI.WRONG_AMOUNT_TO_PAY:return(0,T.jV)();case T.AI.SALES_TAX_MISMATCH:return(0,T.hS)();case T.AI.B2B_PLAN_NOT_FOUND:return(0,T.aY)();case T.AI.SELECTED_PLAN_IS_NOT_VALID:return(0,T.QF)();case T.AI.FORBIDDEN_EMAIL_DOMAIN:return(0,T.rj)();case T.AI.TEAM_HAS_SSO_ENABLED:return(0,T.KW)();case T.AI.VAT_NUMBER_NOT_UPSERTED:return(0,T.T1)();case T.AI.NO_KEY_FOR_USER:return(0,T.Ls)();case T.AI.UNSUPPORTED_PAYMENT_MEAN:return(0,T.ZP)();default:throw new Error(`UpgradeTeamWithExistingCc: error ${e}`)}}}}A=(0,n.gn)([(0,c.GS)(),(0,n.w6)("design:type",Function),(0,n.w6)("design:paramtypes",[void 0===d.l?Object:d.l])],A);var U=s(33549);class N{execute({body:{amountToPay:e,taxes:t,planId:s,couponCode:n,newTotalNumberOfSeats:r,billingContactEmail:i}}){return this.midcycleTierService.changeTierMidcycle({amountToPay:e,taxes:t,planId:s,couponCode:n,newTotalNumberOfSeats:r,billingContactEmail:i})}constructor(e){this.midcycleTierService=e}}N=(0,n.gn)([(0,S.W)(U.G),(0,n.w6)("design:type",Function),(0,n.w6)("design:paramtypes",[void 0===g?Object:g])],N);class O{execute({body:{planId:e,countryCode:t,membersNumber:s,amountToPayInCents:n,taxesToPayInCents:r,couponCode:i,vatNumber:a}}){return this.upgradeTeamWithExistingCcService.upgradeTeamWithExistingCc({planId:e,countryCode:t,membersNumber:s,amountToPayInCents:n,taxesToPayInCents:r,couponCode:i,vatNumber:a})}constructor(e){this.upgradeTeamWithExistingCcService=e}}O=(0,n.gn)([(0,S.W)(T.gi),(0,n.w6)("design:type",Function),(0,n.w6)("design:paramtypes",[void 0===A?Object:A])],O);var D=s(46449),F=s(54697);class P{execute({body:{couponCode:e}}){return this.serverApiClient.v1.teams.getTeamOffers({couponCode:e,withStarterOffer:!0}).pipe((0,p.Qn)((e=>e.data)),(0,p.DZ)((e=>{throw new Error(e.message)})))}constructor(e){this.serverApiClient=e}}P=(0,n.gn)([(0,D.e)(F.g),(0,n.w6)("design:type",Function),(0,n.w6)("design:paramtypes",[void 0===d.l?Object:d.l])],P);var R=s(162),x=s(39127);class L{execute({body:{newTotalNumberOfSeats:e,newPlan:t}}){return(0,R.D)(this.midcycleTierService.getMidcycleTierUpgradePrice({newTotalNumberOfSeats:e,newPlan:t}))}constructor(e){this.midcycleTierService=e}}L=(0,n.gn)([(0,D.e)(x.X),(0,n.w6)("design:type",Function),(0,n.w6)("design:paramtypes",[void 0===g?Object:g])],L);var k=s(70552);class j{execute(){return this.computePlanPricingStore.state$.pipe((0,E.U)((e=>(0,_.Vp)(e))))}constructor(e){this.computePlanPricingStore=e}}j=(0,n.gn)([(0,D.e)(k.n),(0,n.w6)("design:type",Function),(0,n.w6)("design:paramtypes",[void 0===b?Object:b])],j);class M{}M=(0,n.gn)([(0,r.Y)({api:a.K,imports:[i.n],providers:[g,C,A],stores:[b],handlers:{commands:{changeTierMidcycle:N,computePlanPricingDetails:I,upgradeTeamWithExistingCc:O},events:{},queries:{getTeamOffers:P,getMidcycleTierUpgradePrice:L,getPlanPricingDetails:j}},requiredFeatureFlips:["monetization_extension_policies_repackage","monetization_extension_policies_revert_notice"]})],M)},58172:(e,t,s)=>{s.d(t,{K:()=>A});var n=s(92336),r=s(86006),i=s(41511),a=s(50691),o=s(60399),c=s(85390),d=s(6220),l=s(87065),u=s(92587),p=s(53344),m=s(33312),h=s(78346),g=s(47969),v=s(99706),y=s(38356),f=s(23945),b=s(14122);class S{async deleteTeamVat(){return await(0,o.z)(this.serverApiClient.v1.teams.deleteTeamVat().pipe((0,m.DZ)((e=>{if("BusinessError"===e.tag)return(0,g.zK)(e.code);throw new Error(e.message)})))),(0,h.Vp)(void 0)}getTeamVat(){return this.serverApiClient.v1.teams.getTeamVat().pipe((0,m.DZ)((e=>{if("BusinessError"===e.tag)return(0,v.K$)(e.code);throw new Error(e.message)})),(0,m.lk)((e=>(0,h.Vp)(e.data.vatNumber))))}async upsertTeamVat({newVATNumber:e}){return await(0,o.z)(this.serverApiClient.v1.teams.upsertTeamVat({newVATNumber:e}).pipe((0,m.DZ)((e=>{if("BusinessError"===e.tag)return(0,y.q5)(e.code);throw new Error(e.message)})),(0,m.lk)((e=>(0,h.Vp)(e.data)))))}getExpectedTaxInformation(e){return(0,c.a)([this.getTeamSubscriptionInformation(),this.getUserLogin()]).pipe((0,d.z)((([t,s])=>{if(!t?.billingInformation)throw new Error("Could not retrieve subscription information");const{country:n,address_zip:r}=t.billingInformation;return this.serverApiClient.v1.payments.getExpectedTaxInformation({login:s,zipCode:r??"",country:n??"",taxOrigin:"team",priceInCents:e})})))}constructor(e,t){this.serverApiClient=e,this.carbon=t,this.getTaxAmount=e=>this.getExpectedTaxInformation(e).pipe((0,m.DZ)((e=>{if("BusinessError"===e.tag)return new f.A;throw new Error(e.message)})),(0,m.lk)((e=>(0,h.Vp)({amount:e.data.expectedTaxesInCents})))),this.getUserLogin=()=>this.carbon.queries.getUserLogin().pipe((0,l.U)((e=>{if((0,h.d6)(e)&&"string"==typeof e.data)return e.data;throw new Error("No active login")}))),this.getTeamSubscriptionInformation=()=>{const{getSubscriptionInformation:e}=this.carbon.queries;return e().pipe((0,l.U)((e=>{if(!(0,h.d6)(e))throw new Error("Cannot retrieve subscription information from Carbon");return(0,h.db)(e).b2bSubscription})))}}}S=(0,n.gn)([(0,u.GS)(),(0,n.w6)("design:type",Function),(0,n.w6)("design:paramtypes",[void 0===p.l?Object:p.l,void 0===b._?Object:b._])],S);var w=s(82874);class E{execute(){return this.teamVatService.deleteTeamVat()}constructor(e){this.teamVatService=e}}E=(0,n.gn)([(0,w.W)(g.Hy),(0,n.w6)("design:type",Function),(0,n.w6)("design:paramtypes",[void 0===S?Object:S])],E);class _{async execute({body:{newVATNumber:e}}){return await this.teamVatService.upsertTeamVat({newVATNumber:e}),(0,h.Vp)(void 0)}constructor(e){this.teamVatService=e}}_=(0,n.gn)([(0,w.W)(y.XW),(0,n.w6)("design:type",Function),(0,n.w6)("design:paramtypes",[void 0===S?Object:S])],_);var C=s(46449);class I{execute(){return this.teamVatService.getTeamVat()}constructor(e){this.teamVatService=e}}I=(0,n.gn)([(0,C.e)(v.N7),(0,n.w6)("design:type",Function),(0,n.w6)("design:paramtypes",[void 0===S?Object:S])],I);class T{execute({body:e}){const{totalPrice:t}=e;return this.teamVatService.getTaxAmount(t)}constructor(e){this.teamVatService=e}}T=(0,n.gn)([(0,C.e)(f.B),(0,n.w6)("design:type",Function),(0,n.w6)("design:paramtypes",[void 0===S?Object:S])],T);class A{}A=(0,n.gn)([(0,r.Y)({api:a.a,imports:[i.n],providers:[S],handlers:{commands:{deleteTeamVat:E,upsertTeamVat:_},events:{},queries:{getTeamVat:I,getTaxAmount:T}}})],A)},92169:(e,t,s)=>{s.d(t,{B:()=>u});var n=s(75958),r=s(24307),i=s(57125),a=s(46875),o=s(70588),c=s(20255),d=s(1524),l=s(70850);const u=(0,n.Q)({name:"importOrchestrator",commands:{resetImport:r.O,startDataRetrieval:i.C,setImportSource:a._,setDefaultSpace:o.K},events:{},queries:{importStep:c.s,importSource:d.l,isFileUploaded:l.Z}})},24307:(e,t,s)=>{s.d(t,{O:()=>i});var n=s(13385),r=s(62149);class i extends((0,n.g)({scope:r.F.User})){}},70588:(e,t,s)=>{s.d(t,{K:()=>i});var n=s(13385),r=s(62149);class i extends((0,n.g)({scope:r.F.User})){}},46875:(e,t,s)=>{s.d(t,{_:()=>i});var n=s(13385),r=s(62149);class i extends((0,n.g)({scope:r.F.User})){}},57125:(e,t,s)=>{s.d(t,{C:()=>i});var n=s(13385),r=s(62149);class i extends((0,n.g)({scope:r.F.User})){}},15618:(e,t,s)=>{s.d(t,{DQ:()=>o,NP:()=>r,Xn:()=>a,gS:()=>c,pD:()=>i});var n=s(98124),r=function(e){return e.NOT_STARTED="not_started",e.ITEM_RETRIEVAL="item_retrieval",e.PROCESSING="processing",e.PREVIEW="preview",e.IMPORTING="importing",e.COMPLETED="completed",e}({}),i=function(e){return e.BITWARDEN_CSV="bitwarden_csv",e.DASHLANE_DASH="dashlane_dash",e.LASTPASS_DIRECT="lastpass_direct",e.CHROME_CSV="chrome_csv",e.EDGE_CSV="edge_csv",e.FIREFOX_CSV="firefox_csv",e.KEEPASS_CSV="keepass_csv",e.KEEPER_CSV="keeper_csv",e.LASTPASS_CSV="lastpass_csv",e.ONE_PASSWORD_CSV="one_password_csv",e.OTHER_CSV="other_csv",e.SAFARI_CSV="safari_csv",e}({});const a="WRONG_STEP_ERROR",o=(0,n.Vj)(a,"Wrong step"),c="ON_UPLOAD_FILE_IMPORT"},30442:(e,t,s)=>{s.d(t,{c:()=>n});var n=function(e){return e.ImportOrchestratorGrapheneMigration="activationRetention_web_vaultImportOrchestrator_grapheneMigration_dev",e}({})},1524:(e,t,s)=>{s.d(t,{l:()=>i});var n=s(77535),r=s(62149);class i extends((0,n.k)({scope:r.F.User})){}},20255:(e,t,s)=>{s.d(t,{s:()=>i});var n=s(77535),r=s(62149);class i extends((0,n.k)({scope:r.F.User})){}},70850:(e,t,s)=>{s.d(t,{Z:()=>i});var n=s(77535),r=s(62149);class i extends((0,n.k)({scope:r.F.User})){}},15020:(e,t,s)=>{s.r(t),s.d(t,{CanUserAddNewPasswordQuery:()=>q.K,CollectionsQuery:()=>M.I,Country:()=>b.c,CreateCollectionCommand:()=>k.e,CreateVaultItemCommand:()=>i._,CreatedEvent:()=>l.J,CredentialSchema:()=>E,CredentialsGloballyProtectedQuery:()=>g.R,DeleteCollectionCommand:()=>L.T,DeleteSecureFileCommand:()=>J._8,DeleteSecureFileCommandErrors:()=>J.j6,DeleteVaultItemCommand:()=>c.io,DeleteVaultItemCommandErrors:()=>c.kx,DeleteVaultItemsCommand:()=>a.cR,DeleteVaultItemsCommandErrors:()=>a.c4,DeletedEvent:()=>u.s,DomainIconDetailsMapSchema:()=>S.x,DomainIconDetailsQuery:()=>m.s,DomainIconDetailsSchema:()=>S.N,DownloadSecureFileCommand:()=>ee.J,EmailType:()=>I,EmitTemporaryVaultItemEventCommand:()=>d.c,EventType:()=>d.t,FetchSecureFileQuotaCommand:()=>te.S,FilterOperators:()=>h.l,GetPasswordLimitStatusQuery:()=>H.r,GetSecureFileQuotaQuery:()=>ne.l,GetVaultNotificationsStatusQuery:()=>R.M,IdentityTitle:()=>T.t,ImportOrchestratorFeatureFlips:()=>me.c,ImportSourceQuery:()=>ue.l,ImportSources:()=>he.pD,ImportStepQuery:()=>le.s,ImportSteps:()=>he.NP,IsFileUploadedQuery:()=>pe.Z,IsFreeUserFrozenQuery:()=>W.k,NoteColors:()=>U.L,ON_UPLOAD_FILE_IMPORT_KEY:()=>he.gS,OperationType:()=>j.C,PASSWORD_LIMIT_FEATURE_FLIPS:()=>Q.t,PaymentCardColorType:()=>C.X,PhoneType:()=>A.z,ProgressStatus:()=>se.m,ResetImportCommand:()=>ae.O,RichIconsEnabledQuery:()=>f.M,SecureFileProgressQuery:()=>se.u,SecureFilesClient:()=>Z,SecureFilesFlips:()=>re.a,SecureNoteSchema:()=>U._,SetDefaultSpaceCommand:()=>de.K,SetImportSourceCommand:()=>ce._,SetVaultNotificationsStatusCommand:()=>P.x,SortDirection:()=>v.S,StartDataRetrievalCommand:()=>oe.C,UpdateCollectionCommand:()=>j.s,UpdateVaultItemCommand:()=>o.K,UpdatedEvent:()=>p.V,VaultItemType:()=>N.U,VaultItemTypeToResultDictionary:()=>O.N,VaultItemsCrudClient:()=>r.L,VaultItemsCrudFeatureFlips:()=>D.j,VaultItemsQuery:()=>y.W,VaultOrganizationClient:()=>z.C,VaultSearchClient:()=>B.T,VaultSearchQuery:()=>K.W,VaultSearchRankedQuery:()=>G.$,WRONG_STEP_ERROR:()=>he.Xn,WebAuthnKeyAlgorithm:()=>_.aG,createForbiddenGroupItemError:()=>c.Vf,createForbiddenLastAdminError:()=>c.V$,createIncompleteDeletionError:()=>a.nO,createItemNotFoundError:()=>c.sA,createNoRemoteFileError:()=>J.Kg,createSecureFileQuotaUpdateError:()=>J.qC,createWrongStepError:()=>he.DQ,importOrchestratorApi:()=>ie.B,isCloudPasskey:()=>_.T5,isLegacyPasskey:()=>_._u,isPasskey:()=>_.p3,passwordLimitApi:()=>$.Z,secureFilesApi:()=>Y.e,vaultItemsCrudApi:()=>n.L,vaultNotificationsApi:()=>F.e,vaultOrganizationApi:()=>x.v,vaultSearchApi:()=>V.R});var n=s(70433),r=s(50879),i=s(90404),a=s(56008),o=s(5822),c=s(87263),d=s(44594),l=s(25666),u=s(46578),p=s(34086),m=s(17049),h=s(52402),g=s(68129),v=s(93314),y=s(54676),f=s(96900),b=s(44105),S=s(15531),w=s(7165);const E=w.z.object({alternativeUsername:w.z.string(),email:w.z.string(),itemName:w.z.string(),password:w.z.string(),username:w.z.string(),URL:w.z.string(),linkedURLs:w.z.array(w.z.string())});var _=s(79),C=s(53214),I=function(e){return e.Perso="PERSO",e.Pro="PRO",e.NoType="NO_TYPE",e}({}),T=s(26311),A=s(7325),U=s(30581),N=s(39431),O=s(29289),D=s(53727),F=s(53234),P=s(67304),R=s(71524),x=s(96124),L=s(38644),k=s(95569),j=s(86342),M=s(42645),z=s(77802),V=s(20281),B=s(22449),K=s(352),G=s(88846),$=s(55257),q=s(36723),H=s(70065),W=s(72483),Q=s(37470),Y=s(81042),X=s(8260);class Z extends((0,X.E)(Y.e)){}(0,X.K)(Y.e,Z);var J=s(22337),ee=s(55624),te=s(32892),se=s(50701),ne=s(15973),re=s(71966),ie=s(92169),ae=s(24307),oe=s(57125),ce=s(46875),de=s(70588),le=s(20255),ue=s(1524),pe=s(70850),me=s(30442),he=s(15618)},55257:(e,t,s)=>{s.d(t,{Z:()=>o});var n=s(75958),r=s(36723),i=s(70065),a=s(72483);const o=(0,n.Q)({name:"passwordLimit",commands:{},events:{},queries:{canUserAddNewPassword:r.K,getPasswordLimitStatus:i.r,isFreeUserFrozen:a.k}})},37470:(e,t,s)=>{s.d(t,{t:()=>n});const n={B2CRestrictPasswordFreePlan:"b2c_web_restrict_password_free_plan_dev",B2CFreeUserFrozenState:"b2c_web_free_users_frozen_state",B2CPreventCopy:"b2c_ecommerce_web_restrict_free_copy_passwords"}},36723:(e,t,s)=>{s.d(t,{K:()=>i});var n=s(77535),r=s(62149);class i extends((0,n.k)({scope:r.F.User})){}},70065:(e,t,s)=>{s.d(t,{r:()=>i});var n=s(77535),r=s(62149);class i extends((0,n.k)({scope:r.F.User})){}},72483:(e,t,s)=>{s.d(t,{k:()=>i});var n=s(77535),r=s(62149);class i extends((0,n.k)({scope:r.F.User,useCache:!0})){}},81042:(e,t,s)=>{s.d(t,{e:()=>d});var n=s(75958),r=s(22337),i=s(55624),a=s(32892),o=s(50701),c=s(15973);const d=(0,n.Q)({name:"secureFiles",commands:{deleteSecureFile:r._8,downloadSecureFile:i.J,fetchSecureFileQuota:a.S},events:{},queries:{secureFileProgress:o.u,getSecureFileQuota:c.l}})},22337:(e,t,s)=>{s.d(t,{Kg:()=>o,_8:()=>d,j6:()=>a,qC:()=>c});var n=s(13385),r=s(62149),i=s(98124),a=function(e){return e.NO_REMOTE_FILE="no-remote-file",e.SECURE_FILE_QUOTA_UPDATE="secure-file-quota-update",e}({});const o=(0,i.Vj)("no-remote-file","The user doesn't have access to this secure file or it has already been deleted."),c=(0,i.Vj)("secure-file-quota-update","The secure file quota state update failed.");class d extends((0,n.g)({scope:r.F.User})){}},55624:(e,t,s)=>{s.d(t,{J:()=>i});var n=s(13385),r=s(62149);class i extends((0,n.g)({scope:r.F.User})){}},32892:(e,t,s)=>{s.d(t,{S:()=>i});var n=s(13385),r=s(62149);class i extends((0,n.g)({scope:r.F.User})){}},71966:(e,t,s)=>{s.d(t,{a:()=>n});var n=function(e){return e.SecureFilesMigration="sharingVault_web_secureFilesMigration",e}({})},15973:(e,t,s)=>{s.d(t,{l:()=>i});var n=s(77535),r=s(62149);class i extends((0,n.k)({scope:r.F.User})){}},50701:(e,t,s)=>{s.d(t,{m:()=>i,u:()=>a});var n=s(77535),r=s(62149),i=function(e){return e.NotStarted="NotStarted",e.Started="Started",e.Linked="Linked",e.Fetched="Fetched",e.Ciphered="Ciphered",e.Completed="Completed",e.Error="Error",e}({});class a extends((0,n.k)({scope:r.F.User})){}},70433:(e,t,s)=>{s.d(t,{L:()=>v});var n=s(75958),r=s(87263),i=s(90404),a=s(56008),o=s(5822),c=s(44594),d=s(25666),l=s(46578),u=s(34086),p=s(17049),m=s(54676),h=s(96900),g=s(68129);const v=(0,n.Q)({name:"vaultItemsCrud",commands:{deleteVaultItem:r.io,createVaultItem:i._,deleteVaultItems:a.cR,updateVaultItem:o.K,emitTemporaryVaultItemEvent:c.c},events:{createdEvent:d.J,deletedEvent:l.s,updatedEvent:u.V},queries:{domainIconDetails:p.s,query:m.W,richIconsEnabled:h.M,credentialsGloballyProtected:g.R}})},50879:(e,t,s)=>{s.d(t,{L:()=>i});var n=s(8260),r=s(70433);class i extends((0,n.E)(r.L)){}(0,n.K)(r.L,i)},90404:(e,t,s)=>{s.d(t,{_:()=>i});var n=s(13385),r=s(62149);class i extends((0,n.g)({scope:r.F.User})){}},87263:(e,t,s)=>{s.d(t,{V$:()=>d,Vf:()=>c,io:()=>l,kx:()=>a,sA:()=>o});var n=s(13385),r=s(62149),i=s(98124);const a=Object.freeze({NOT_FOUND:"NOT_FOUND",FORBIDDEN_GROUP_ITEM:"FORBIDDEN_GROUP_ITEM",FORBIDDEN_LAST_ADMIN:"FORBIDDEN_LAST_ADMIN"}),o=(0,i.Vj)(a.NOT_FOUND,"The Vault Item to be deleted couldn't be found."),c=(0,i.Vj)(a.FORBIDDEN_GROUP_ITEM,"The Vault Item cannot be deleted while shared via user group."),d=(0,i.Vj)(a.FORBIDDEN_LAST_ADMIN,"The Vault Item cannot be deleted while the current user is the last admin.");class l extends((0,n.g)({scope:r.F.User})){}},56008:(e,t,s)=>{s.d(t,{c4:()=>a,cR:()=>c,nO:()=>o});var n=s(13385),r=s(62149),i=s(98124);const a=Object.freeze({INCOMPLETE_DELETION:"INCOMPLETE_DELETION"}),o=e=>({...(0,i.Vj)(a.INCOMPLETE_DELETION,"At least some of the Vault Items couldn't be deleted")(),failedDeletionIds:e});class c extends((0,n.g)({scope:r.F.User})){}},44594:(e,t,s)=>{s.d(t,{c:()=>a,t:()=>i});var n=s(13385),r=s(62149),i=function(e){return e.Deleted="deleted",e.Updated="updated",e.Created="created",e}({});class a extends((0,n.g)({scope:r.F.User})){}},5822:(e,t,s)=>{s.d(t,{K:()=>i});var n=s(13385),r=s(62149);class i extends((0,n.g)({scope:r.F.User})){}},80361:(e,t,s)=>{s.d(t,{D:()=>i});var n=s(446),r=s(62149);class i extends((0,n.d)({scope:r.F.User})){}},25666:(e,t,s)=>{s.d(t,{J:()=>r});var n=s(80361);class r extends n.D{}},46578:(e,t,s)=>{s.d(t,{s:()=>r});var n=s(80361);class r extends n.D{}},34086:(e,t,s)=>{s.d(t,{V:()=>r});var n=s(80361);class r extends n.D{}},53727:(e,t,s)=>{s.d(t,{j:()=>n});var n=function(e){return e.ListPerfImprovements="sharingVault_web_vaultPerformanceImp",e.PasskeysInVaultDev="vault_web_passkey_dev",e.PasskeysInVaultProd="vault_web_passkey_prod",e.RichIconsDev="sharingVault_web_rich_icons_setting",e}({})},68129:(e,t,s)=>{s.d(t,{R:()=>i});var n=s(77535),r=s(62149);class i extends((0,n.k)({scope:r.F.User})){}},17049:(e,t,s)=>{s.d(t,{s:()=>i});var n=s(77535),r=s(62149);class i extends((0,n.k)({scope:r.F.User,useCache:!0})){}},52402:(e,t,s)=>{s.d(t,{l:()=>n});var n=function(e){return e.Equal="equal",e.LessThan="lessThan",e.GreaterThan="greaterThan",e}({})},96900:(e,t,s)=>{s.d(t,{M:()=>i});var n=s(77535),r=s(62149);class i extends((0,n.k)({scope:r.F.User})){}},93314:(e,t,s)=>{s.d(t,{S:()=>n});var n=function(e){return e.Ascend="ascend",e.Descend="descend",e}({})},54676:(e,t,s)=>{s.d(t,{W:()=>i});var n=s(77535),r=s(62149);class i extends((0,n.k)({scope:r.F.User})){}},44105:(e,t,s)=>{s.d(t,{c:()=>n});var n=function(e){return e.NO_TYPE="NO_TYPE",e.UNIVERSAL="UNIVERSAL",e.AD="AD",e.AE="AE",e.AF="AF",e.AG="AG",e.AI="AI",e.AL="AL",e.AM="AM",e.AO="AO",e.AQ="AQ",e.AR="AR",e.AS="AS",e.AT="AT",e.AU="AU",e.AW="AW",e.AX="AX",e.AZ="AZ",e.BA="BA",e.BB="BB",e.BD="BD",e.BE="BE",e.BF="BF",e.BG="BG",e.BH="BH",e.BI="BI",e.BJ="BJ",e.BL="BL",e.BM="BM",e.BN="BN",e.BO="BO",e.BR="BR",e.BS="BS",e.BT="BT",e.BV="BV",e.BW="BW",e.BY="BY",e.BZ="BZ",e.CA="CA",e.CC="CC",e.CD="CD",e.CF="CF",e.CG="CG",e.CH="CH",e.CI="CI",e.CK="CK",e.CL="CL",e.CM="CM",e.CN="CN",e.CO="CO",e.CR="CR",e.CU="CU",e.CV="CV",e.CX="CX",e.CY="CY",e.CZ="CZ",e.DE="DE",e.DJ="DJ",e.DK="DK",e.DM="DM",e.DO="DO",e.DZ="DZ",e.EC="EC",e.EE="EE",e.EG="EG",e.EH="EH",e.ER="ER",e.ES="ES",e.ET="ET",e.FI="FI",e.FJ="FJ",e.FK="FK",e.FM="FM",e.FO="FO",e.FR="FR",e.GA="GA",e.GB="GB",e.GD="GD",e.GE="GE",e.GF="GF",e.GG="GG",e.GH="GH",e.GI="GI",e.GL="GL",e.GM="GM",e.GN="GN",e.GP="GP",e.GQ="GQ",e.GR="GR",e.GS="GS",e.GT="GT",e.GU="GU",e.GW="GW",e.GY="GY",e.HK="HK",e.HM="HM",e.HN="HN",e.HR="HR",e.HT="HT",e.HU="HU",e.ID="ID",e.IE="IE",e.IL="IL",e.IM="IM",e.IN="IN",e.IO="IO",e.IQ="IQ",e.IR="IR",e.IS="IS",e.IT="IT",e.JE="JE",e.JM="JM",e.JO="JO",e.JP="JP",e.KE="KE",e.KG="KG",e.KH="KH",e.KI="KI",e.KM="KM",e.KN="KN",e.KP="KP",e.KR="KR",e.KW="KW",e.KY="KY",e.KZ="KZ",e.LA="LA",e.LB="LB",e.LC="LC",e.LI="LI",e.LK="LK",e.LR="LR",e.LS="LS",e.LT="LT",e.LU="LU",e.LV="LV",e.LY="LY",e.MA="MA",e.MC="MC",e.MD="MD",e.ME="ME",e.MF="MF",e.MG="MG",e.MH="MH",e.MK="MK",e.ML="ML",e.MM="MM",e.MN="MN",e.MO="MO",e.MP="MP",e.MQ="MQ",e.MR="MR",e.MS="MS",e.MT="MT",e.MU="MU",e.MV="MV",e.MW="MW",e.MX="MX",e.MY="MY",e.MZ="MZ",e.NA="NA",e.NC="NC",e.NE="NE",e.NF="NF",e.NG="NG",e.NI="NI",e.NL="NL",e.NO="NO",e.NP="NP",e.NR="NR",e.NU="NU",e.NZ="NZ",e.OM="OM",e.PA="PA",e.PE="PE",e.PF="PF",e.PG="PG",e.PH="PH",e.PK="PK",e.PL="PL",e.PM="PM",e.PN="PN",e.PR="PR",e.PS="PS",e.PT="PT",e.PW="PW",e.PY="PY",e.QA="QA",e.RE="RE",e.RO="RO",e.RS="RS",e.RU="RU",e.RW="RW",e.SA="SA",e.SB="SB",e.SC="SC",e.SD="SD",e.SE="SE",e.SG="SG",e.SH="SH",e.SI="SI",e.SJ="SJ",e.SK="SK",e.SL="SL",e.SM="SM",e.SN="SN",e.SO="SO",e.SR="SR",e.ST="ST",e.SV="SV",e.SY="SY",e.SZ="SZ",e.TC="TC",e.TD="TD",e.TF="TF",e.TG="TG",e.TH="TH",e.TJ="TJ",e.TK="TK",e.TL="TL",e.TM="TM",e.TN="TN",e.TO="TO",e.TR="TR",e.TT="TT",e.TV="TV",e.TW="TW",e.TZ="TZ",e.UA="UA",e.UG="UG",e.UM="UM",e.US="US",e.UY="UY",e.UZ="UZ",e.VA="VA",e.VC="VC",e.VE="VE",e.VG="VG",e.VI="VI",e.VN="VN",e.VU="VU",e.WF="WF",e.WS="WS",e.XK="XK",e.YE="YE",e.YT="YT",e.ZA="ZA",e.ZM="ZM",e.ZW="ZW",e}({})},15531:(e,t,s)=>{s.d(t,{N:()=>a,x:()=>o});var n=s(7165);const r=["crawled","xs","sm","sm@2x","md","md.tiff","xmd","xmd@2x","l","l@2x","xl","xl@2x","46x30","46x30@2x","50x33","50x33@2x","56x56","56x56@2x","118x98","118x98@2x","160x106","160x106@2x"];n.z.enum(r);const i=r.reduce(((e,t)=>e.setKey(t,n.z.string().optional().nullable())),n.z.object({})),a=n.z.object({backgroundColor:n.z.string(),mainColor:n.z.string(),urls:i}),o=n.z.map(n.z.string(),a)},79:(e,t,s)=>{s.d(t,{T5:()=>i,_u:()=>a,aG:()=>n,p3:()=>r});var n=function(e){return e[e.CloudPasskey=-65537]="CloudPasskey",e[e.ES256=-7]="ES256",e}({});function r(e){return Boolean(e)&&"KWPasskey"===e.kwType}function i(e){return r(e)&&-65537===e.keyAlgorithm}function a(e){return r(e)&&-7===e.keyAlgorithm}},53214:(e,t,s)=>{s.d(t,{X:()=>n});var n=function(e){return e.Black="BLACK",e.Blue1="BLUE1",e.Blue2="BLUE2",e.Gold="GOLD",e.Green1="GREEN1",e.Green2="GREEN2",e.Orange="ORANGE",e.Red="RED",e.Silver="SILVER",e.White="WHITE",e}({})},26311:(e,t,s)=>{s.d(t,{t:()=>n});var n=function(e){return e.Mr="MR",e.Mrs="MRS",e.Miss="MISS",e.Ms="MS",e.Mx="MX",e.NoneOfThese="NONEOFTHESE",e}({})},7325:(e,t,s)=>{s.d(t,{z:()=>n});var n=function(e){return e.Any="ANY",e.Fax="FAX",e.Landline="LANDLINE",e.Mobile="MOBILE",e.WorkFax="WORKFAX",e.WorkLandline="WORKLANDLINE",e.WorkMobile="WORKMOBILE",e}({})},30581:(e,t,s)=>{s.d(t,{L:()=>r,_:()=>i});var n=s(7165),r=function(e){return e.BLUE="BLUE",e.BROWN="BROWN",e.GRAY="GRAY",e.GREEN="GREEN",e.ORANGE="ORANGE",e.PINK="PINK",e.PURPLE="PURPLE",e.RED="RED",e.YELLOW="YELLOW",e}({});const i=n.z.object({color:n.z.string(),isSecured:n.z.boolean(),title:n.z.string(),content:n.z.string(),categoryId:n.z.string()})},39431:(e,t,s)=>{s.d(t,{U:()=>n});var n=function(e){return e.Address="KWAddress",e.BankAccount="KWBankStatement",e.Company="KWCompany",e.Credential="KWAuthentifiant",e.DriversLicense="KWDriverLicence",e.Email="KWEmail",e.FiscalId="KWFiscalStatement",e.IdCard="KWIDCard",e.Identity="KWIdentity",e.Passkey="KWPasskey",e.Passport="KWPassport",e.PaymentCard="KWPaymentMean_creditCard",e.Phone="KWPhone",e.Secret="KWSecret",e.SecureNote="KWSecureNote",e.SocialSecurityId="KWSocialSecurityStatement",e.Website="KWPersonalWebsite",e}({})},29289:(e,t,s)=>{s.d(t,{N:()=>r});var n=s(39431);const r={[n.U.Address]:"addressesResult",[n.U.BankAccount]:"bankAccountsResult",[n.U.Company]:"companiesResult",[n.U.Credential]:"credentialsResult",[n.U.DriversLicense]:"driversLicensesResult",[n.U.Email]:"emailsResult",[n.U.FiscalId]:"fiscalIdsResult",[n.U.IdCard]:"idCardsResult",[n.U.Identity]:"identitiesResult",[n.U.Passkey]:"passkeysResult",[n.U.Passport]:"passportsResult",[n.U.PaymentCard]:"paymentCardsResult",[n.U.Phone]:"phonesResult",[n.U.Secret]:"secretsResult",[n.U.SecureNote]:"secureNotesResult",[n.U.SocialSecurityId]:"socialSecurityIdsResult",[n.U.Website]:"websitesResult"}},53234:(e,t,s)=>{s.d(t,{e:()=>a});var n=s(75958),r=s(67304),i=s(71524);const a=(0,n.Q)({name:"vaultNotifications",commands:{setVaultNotificationsStatus:r.x},events:{},queries:{getVaultNotificationsStatus:i.M}})},67304:(e,t,s)=>{s.d(t,{x:()=>i});var n=s(13385),r=s(62149);class i extends((0,n.g)({scope:r.F.User})){}},71524:(e,t,s)=>{s.d(t,{M:()=>i});var n=s(77535),r=s(62149);class i extends((0,n.k)({scope:r.F.User})){}},96124:(e,t,s)=>{s.d(t,{v:()=>c});var n=s(75958),r=s(38644),i=s(95569),a=s(86342),o=s(42645);const c=(0,n.Q)({name:"vaultOrganization",commands:{deleteCollection:r.T,createCollection:i.e,updateCollection:a.s},events:{},queries:{queryCollections:o.I}})},95569:(e,t,s)=>{s.d(t,{e:()=>i});var n=s(13385),r=s(62149);class i extends((0,n.g)({scope:r.F.User})){}},38644:(e,t,s)=>{s.d(t,{T:()=>i});var n=s(13385),r=s(62149);class i extends((0,n.g)({scope:r.F.User})){}},86342:(e,t,s)=>{s.d(t,{C:()=>i,s:()=>a});var n=s(13385),r=s(62149),i=function(e){return e.SUBSTRACT_VAULT_ITEMS="subtract_vault_items",e.APPEND_VAULT_ITEMS="append_vault_items",e}({});class a extends((0,n.g)({scope:r.F.User})){}},42645:(e,t,s)=>{s.d(t,{I:()=>i});var n=s(77535),r=s(62149);class i extends((0,n.k)({scope:r.F.User})){}},77802:(e,t,s)=>{s.d(t,{C:()=>i});var n=s(8260),r=s(96124);class i extends((0,n.E)(r.v)){}(0,n.K)(r.v,i)},20281:(e,t,s)=>{s.d(t,{R:()=>a});var n=s(75958),r=s(88846),i=s(352);const a=(0,n.Q)({name:"vaultSearch",commands:{},events:{},queries:{vaultSearchRanked:r.$,search:i.W}})},22449:(e,t,s)=>{s.d(t,{T:()=>i});var n=s(8260),r=s(20281);class i extends((0,n.E)(r.R)){}(0,n.K)(r.R,i)},88846:(e,t,s)=>{s.d(t,{$:()=>i});var n=s(77535),r=s(62149);class i extends((0,n.k)({scope:r.F.User})){}},352:(e,t,s)=>{s.d(t,{W:()=>i});var n=s(77535),r=s(62149);class i extends((0,n.k)({scope:r.F.User})){}},3526:(e,t,s)=>{s.d(t,{F:()=>k});var n=s(92336),r=s(58563),i=s(86006),a=s(92169),o=s(30442),c=s(62149),d=s(63144),l=s(56618),u=s(15618);class p extends((0,d.Q)({persist:!1,scope:c.F.User,storeName:"import-store",initialValue:{step:u.NP.NOT_STARTED},capacity:l.Y._100KB})){}var m=s(82874),h=s(78346),g=s(24307);class v{async execute(){return await this.store.set({step:u.NP.NOT_STARTED}),Promise.resolve((0,h.Vp)(void 0))}constructor(e){this.store=e}}v=(0,n.gn)([(0,m.W)(g.O),(0,n.w6)("design:type",Function),(0,n.w6)("design:paramtypes",[void 0===p?Object:p])],v);var y=s(57125);class f{async execute(){return(await this.store.getState()).step!==u.NP.NOT_STARTED?(0,h.Rn)((0,u.DQ)()):(await this.store.set({step:u.NP.ITEM_RETRIEVAL,isFileUploaded:!1}),Promise.resolve((0,h.Vp)(void 0)))}constructor(e){this.store=e}}f=(0,n.gn)([(0,m.W)(y.C),(0,n.w6)("design:type",Function),(0,n.w6)("design:paramtypes",[void 0===p?Object:p])],f);var b=s(46875);class S{async execute({body:e}){const{importSource:t}=e,s=await this.store.getState();return s.step!==u.NP.ITEM_RETRIEVAL?(0,h.Rn)((0,u.DQ)()):(await this.store.set({...s,importSource:t}),Promise.resolve((0,h.Vp)(void 0)))}constructor(e){this.store=e}}S=(0,n.gn)([(0,m.W)(b._),(0,n.w6)("design:type",Function),(0,n.w6)("design:paramtypes",[void 0===p?Object:p])],S);var w=s(70588);class E{async execute({body:e}){const t=await this.store.getState();return t.step!==u.NP.PREVIEW?(0,h.Rn)((0,u.DQ)()):(await this.store.set({...t,defaultSpace:e}),Promise.resolve((0,h.Vp)(void 0)))}constructor(e){this.store=e}}E=(0,n.gn)([(0,m.W)(w.K),(0,n.w6)("design:type",Function),(0,n.w6)("design:paramtypes",[void 0===p?Object:p])],E);var _=s(38711),C=s(85798),I=s(7262);class T extends _.P{async handleUploadedFile({content:e}){const t=(new TextDecoder).decode(e),s=await this.importStore.getState();if(s.step!==u.NP.ITEM_RETRIEVAL)throw new Error("Wrong Step");return await this.importStore.set({...s,rawData:t,isFileUploaded:!0}),Promise.resolve(void 0)}constructor(e){super(u.gS),this.importStore=e}}T=(0,n.gn)([(0,C.b)(I.W),(0,n.w6)("design:type",Function),(0,n.w6)("design:paramtypes",[void 0===p?Object:p])],T);var A=s(87065),U=s(6136),N=s(46449),O=s(20255);class D{execute(){return this.importStore.state$.pipe((0,A.U)((e=>e.step)),(0,U.x)(),(0,A.U)(h.Vp))}constructor(e){this.importStore=e}}D=(0,n.gn)([(0,N.e)(O.s),(0,n.w6)("design:type",Function),(0,n.w6)("design:paramtypes",[void 0===p?Object:p])],D);var F=s(62760),P=s(1524);class R{execute(){return this.importStore.state$.pipe((0,A.U)((e=>e.step===u.NP.NOT_STARTED||void 0===e.importSource?(0,h.Rn)((0,u.DQ)()):(0,h.Vp)(e.importSource))),(0,U.x)(F.shallowEqualObjects))}constructor(e){this.importStore=e}}R=(0,n.gn)([(0,N.e)(P.l),(0,n.w6)("design:type",Function),(0,n.w6)("design:paramtypes",[void 0===p?Object:p])],R);var x=s(70850);class L{execute(){return this.store.state$.pipe((0,A.U)((e=>e.step!==u.NP.ITEM_RETRIEVAL?(0,h.Rn)((0,u.DQ)()):(0,h.Vp)(e.isFileUploaded))),(0,U.x)())}constructor(e){this.store=e}}L=(0,n.gn)([(0,N.e)(x.Z),(0,n.w6)("design:type",Function),(0,n.w6)("design:paramtypes",[void 0===p?Object:p])],L);class k{}k=(0,n.gn)([(0,i.Y)({api:a.B,stores:[p],requiredFeatureFlips:Object.values(o.c),handlers:{commands:{resetImport:v,startDataRetrieval:f,setImportSource:S,setDefaultSpace:E},events:{...(0,i.g)(r.a,{fileUploaded:T})},queries:{importStep:D,importSource:R,isFileUploaded:L}},domainName:"vault"})],k)},89434:(e,t,s)=>{s.d(t,{a:()=>T});var n=s(92336),r=s(86006),i=s(55257),a=s(37470),o=s(85390),c=s(87065),d=s(46449),l=s(78346),u=s(36723),p=s(6136),m=s(43978),h=s(69885),g=s(14122),v=s(92587),y=s(39431),f=s(71860);class b{constructor(e,t){this.carbon=e,this.vaultRepository=t,this.isPasswordLimitEnabled=()=>this._getPasswordsLimitCapability().pipe((0,c.U)((e=>e?.enabled??!1))),this.getNumberOfPasswordsLeft=()=>{const e=this._getCredentialCount(),t=this._getPasswordsLimitCapability().pipe((0,c.U)((e=>e?.info?.limit)));return(0,o.a)([e,t]).pipe((0,c.U)((([e,t])=>{if("number"==typeof t)return t-e})))},this.isFreeUserFrozen=()=>this._getPasswordsLimitCapability().pipe((0,c.U)((e=>e?.enabled&&"enforce_freeze"===e.info?.action&&e.info?.limit)),(0,p.x)()).pipe((0,m.w)((e=>e?this._getCredentialCount().pipe((0,c.U)((t=>t>e))):(0,h.of)(!1)))),this.getCurrentPasswordLimit=()=>this._getPasswordsLimitCapability().pipe((0,c.U)((e=>{if(e?.enabled&&!e.info?.limit&&0!==e.info?.limit)throw new Error("Cannot get password limit from server");return e?.info?.limit}))),this._getPasswordsLimitCapability=()=>this.carbon.queries.getNodePremiumStatus().pipe((0,c.U)((e=>{if(!(0,l.d6)(e))throw new Error("Cannot retrieve node premium status from carbon");return(0,l.db)(e).capabilities?.passwordsLimit}))),this._getCredentialCount=()=>this.vaultRepository.fetchVaultItems$({vaultItemTypes:[y.U.Credential]}).pipe((0,c.U)((e=>{if(!(0,l.d6)(e))throw new Error("Cannot retrieve credentials from vault");return(0,l.db)(e).credentialsResult.matchCount})))}}b=(0,n.gn)([(0,v.GS)(),(0,n.w6)("design:type",Function),(0,n.w6)("design:paramtypes",[void 0===g._?Object:g._,void 0===f.g?Object:f.g])],b);class S{execute(){const e=this.passwordLimitRepository.isPasswordLimitEnabled(),t=this.passwordLimitRepository.getNumberOfPasswordsLeft();return(0,o.a)(e,t).pipe((0,c.U)((([e,t])=>e&&"number"==typeof t?(0,l.Vp)(t>0):(0,l.Vp)(!0))))}constructor(e){this.passwordLimitRepository=e}}S=(0,n.gn)([(0,d.e)(u.K),(0,n.w6)("design:type",Function),(0,n.w6)("design:paramtypes",[void 0===b?Object:b])],S);var w=s(62760),E=s(70065);class _{execute(){const e=this.passwordLimitRepository.isPasswordLimitEnabled(),t=this.passwordLimitRepository.getNumberOfPasswordsLeft(),s=this.passwordLimitRepository.getCurrentPasswordLimit();return(0,o.a)([e,t,s]).pipe((0,c.U)((([e,t,s])=>e&&"number"==typeof t&&"number"==typeof s?{hasLimit:e,passwordsLeft:t,limit:s}:{hasLimit:!1})),(0,p.x)(w.shallowEqualObjects),(0,c.U)(l.Vp))}constructor(e){this.passwordLimitRepository=e}}_=(0,n.gn)([(0,d.e)(E.r),(0,n.w6)("design:type",Function),(0,n.w6)("design:paramtypes",[void 0===b?Object:b])],_);var C=s(72483);class I{execute(){return this.passwordLimitRepository.isFreeUserFrozen().pipe((0,p.x)(),(0,c.U)(l.Vp))}constructor(e){this.passwordLimitRepository=e}}I=(0,n.gn)([(0,d.e)(C.k),(0,n.w6)("design:type",Function),(0,n.w6)("design:paramtypes",[void 0===b?Object:b])],I);class T{}T=(0,n.gn)([(0,r.Y)({api:i.Z,stores:[],handlers:{commands:{},events:{},queries:{canUserAddNewPassword:S,getPasswordLimitStatus:_,isFreeUserFrozen:I}},providers:[f.g,b],requiredFeatureFlips:[...Object.values(a.t)]})],T)},22432:(e,t,s)=>{s.d(t,{E:()=>H});var n=s(92336),r=s(86006),i=s(75421),a=s(48302),o=s(41511),c=s(40416),d=s(81042),l=s(71966),u=s(60399),p=s(30309),m=s(51592),h=s(14122),g=s(82874),v=s(61798),y=s(53344),f=s(78346),b=s(52477),S=s(22337),w=s(63144),E=s(56618),_=s(62149),C=s(60018),I=s(3873);const T=e=>!(!e||!(0,I.K)(e))&&"remaining"in e;class A extends((0,w.Q)({persist:!0,storage:{initialValue:{remaining:0,max:0},typeGuard:T,schemaVersion:1},scope:_.F.User,storeName:"secure-file-quota",capacity:E.Y._001KB,codec:C.E})){}class U{async execute({body:e}){try{const s=await this.carbonLegacyClient.commands.deleteVaultModuleItem({id:e.id,kwType:p.dJ.KWSecureFileInfo});if(!(0,f.d6)(s)){const n=(0,f.Yv)(s),r=(t=n).error&&"object"==typeof t.error&&"reason"in t.error&&"number"==typeof t.error.reason?t.error.reason:null;if(r!==m.M.NOT_FOUND)throw new Error("Unexpected failure while attemping to delete personal data item in Carbon",{cause:{failure:n,reason:r,id:e.id}})}}catch(e){throw new Error("Unexpectedly unable to attempt deleting personal data item in Carbon",{cause:e})}var t;const s=await(0,u.z)(this.serverApiClient.v1.securefile.deleteSecureFile({secureFileInfoId:e.id}));if(!(0,f.d6)(s))return(0,b.EQ)(s.error,{...(0,v.X)((e=>{throw new Error("Unexpected server error while attempting to delete remote secure file",{cause:e})})),BusinessError:()=>(0,f.Rn)((0,S.Kg)())});const{quota:n}=(0,f.db)(s).data;return await this.secureFilesQuotaStore.set(n),(0,f.Vp)(void 0)}constructor(e,t,s){this.carbonLegacyClient=e,this.serverApiClient=t,this.secureFilesQuotaStore=s}}U=(0,n.gn)([(0,g.W)(S._8),(0,n.w6)("design:type",Function),(0,n.w6)("design:paramtypes",[void 0===h._?Object:h._,void 0===y.l?Object:y.l,void 0===A?Object:A])],U);var N=s(79594),O=s(26549),D=s(85603),F=s(50701),P=s(55624),R=s(63352);class x extends((0,w.Q)({initialValue:{},scope:_.F.User,storeName:"secure-files-progress",persist:!1,capacity:E.Y._001KB})){}class L{async execute({body:e}){const{cryptoKey:t,downloadKey:s,filename:n,type:r}=e;await this.progressStore.set({[s]:F.m.Started});const i=await this.getDownloadLink(s);if(!(0,f.d6)(i))return i;const a=(0,f.db)(i);await this.progressStore.set({[s]:F.m.Linked});const o=await this.fetchDownloadLinkContent(a);if(!(0,f.d6)(o))return o;await this.progressStore.set({[s]:F.m.Fetched});const c=(0,R.R)(t),d=await this.decryptContent(c,(0,f.db)(o));return await this.progressStore.set({[s]:F.m.Ciphered}),await this.downloadFile(n,r,d),await this.progressStore.set({[s]:F.m.Completed}),(0,f.Vp)(void 0)}async getDownloadLink(e){try{const t=await(0,u.z)(this.serverApiClient.v1.securefile.getDownloadLink({key:e}));return(0,f.d6)(t)?(0,f.Vp)(t.data.data.url):(0,b.EQ)(t.error,{...(0,v.X)((e=>{throw new Error("Unexpected server error while attempting to download remote secure file",{cause:e})})),BusinessError:()=>(0,f.Rn)((0,S.Kg)())})}catch(e){throw new Error("Unexpectedly unable to retrieve download link",{cause:e})}}async fetchDownloadLinkContent(e){const t=await this.fetchContent(e);if(!(0,f.d6)(t))return t;try{return(0,f.Vp)(new Uint8Array((0,f.db)(t)))}catch(e){throw new Error("Unexpectedly unable to deserialize downloaded content",{cause:e})}}async fetchContent(e){try{const t=await(0,u.z)(this.httpClient.get(e,{observe:"body",responseType:"arraybuffer"}));return(0,f.d6)(t)?(0,f.Vp)(t.data):(0,b.EQ)(t.error,{...(0,v.X)((e=>{throw new Error("Unexpectedly unable to fetch download link content",{cause:e})})),BadStatus:()=>(0,f.Rn)((0,S.Kg)())})}catch(e){throw new Error("Unexpectedly unable to fetch download link content",{cause:e})}}async decryptContent(e,t){try{return await this.flexibleDecryptor.decrypt(e,t)}catch(e){throw new Error("Unexpectedly unable to decrypt downloaded content",{cause:e})}}async downloadFile(e,t,s){try{return await this.fileDownloadService.downloadFile(e,t,s)}catch(e){throw new Error("Unexpectedly unable to download deciphered content",{cause:e})}}constructor(e,t,s,n,r){this.serverApiClient=e,this.flexibleDecryptor=t,this.fileDownloadService=s,this.progressStore=n,this.httpClient=r}}L=(0,n.gn)([(0,g.W)(P.J),(0,n.w6)("design:type",Function),(0,n.w6)("design:paramtypes",[void 0===y.l?Object:y.l,void 0===D.a?Object:D.a,void 0===N._?Object:N._,void 0===x?Object:x,void 0===O.e?Object:O.e])],L);var k=s(78776),j=s(32892);class M{async execute(){const e=await(0,u.z)(this.serverApiClient.v1.securefile.getUploadLink({contentLength:0,secureFileInfoId:(0,k.Z)()}));if((0,f.hx)(e))throw new Error("Unabled to get quota data from server.");const t=(0,f.db)(e).data,{max:s,remaining:n}=t.quota;return await this.secureFilesQuotaStore.set({max:s,remaining:n}),(0,f.Vp)(void 0)}constructor(e,t){this.secureFilesQuotaStore=e,this.serverApiClient=t}}M=(0,n.gn)([(0,g.W)(j.S),(0,n.w6)("design:type",Function),(0,n.w6)("design:paramtypes",[void 0===A?Object:A,void 0===y.l?Object:y.l])],M);var z=s(46449),V=s(87065),B=s(6136),K=s(66189);class G{execute({body:e}){return this.progressStore.state$.pipe((0,V.U)((t=>t[e.secureFileKey]??F.m.NotStarted)),(0,B.x)(),(0,V.U)(f.Vp),(0,K.x)((()=>this.progressStore.set({}))))}constructor(e){this.progressStore=e}}G=(0,n.gn)([(0,z.e)(F.u),(0,n.w6)("design:type",Function),(0,n.w6)("design:paramtypes",[void 0===x?Object:x])],G);var $=s(15973);class q{execute(){return this.quotaStore.state$.pipe((0,V.U)((e=>(0,f.Vp)(e))))}constructor(e){this.quotaStore=e}}q=(0,n.gn)([(0,z.e)($.l),(0,n.w6)("design:type",Function),(0,n.w6)("design:paramtypes",[void 0===A?Object:A])],q);class H{}H=(0,n.gn)([(0,r.Y)({api:d.e,imports:[i.X,o.n,c.D,a.l],providers:[],handlers:{commands:{deleteSecureFile:U,downloadSecureFile:L,fetchSecureFileQuota:M},events:{},queries:{secureFileProgress:G,getSecureFileQuota:q}},stores:[x,A],domainName:"vault",requiredFeatureFlips:[l.a.SecureFilesMigration]})],H)},8811:(e,t,s)=>{s.d(t,{z:()=>ve});var n=s(92336),r=s(86006),i=s(40416),a=s(70433),o=s(53727),c=s(13800),d=s(92587);class l extends c.f{}l=(0,n.gn)([(0,d.GS)()],l);var u=s(82874),p=s(78346),m=s(14122),h=s(39431),g=s(90404),v=s(12144),y=s(90294),f=s(26311),b=s(53214),S=s(7325),w=s(44105);const E={[f.t.Mr]:"MR",[f.t.Mrs]:"MME",[f.t.Miss]:"MLLE",[f.t.Ms]:"MS",[f.t.Mx]:"MX",[f.t.NoneOfThese]:"NONE_OF_THESE"},_={[b.X.Black]:v.LR.BLACK,[b.X.Blue1]:v.LR.BLUE_1,[b.X.Blue2]:v.LR.BLUE_2,[b.X.Gold]:v.LR.GOLD,[b.X.Green1]:v.LR.GREEN_1,[b.X.Green2]:v.LR.GREEN_2,[b.X.Orange]:v.LR.ORANGE,[b.X.Red]:v.LR.RED,[b.X.Silver]:v.LR.SILVER,[b.X.White]:v.LR.WHITE},C={[S.z.Any]:y.z.PHONE_TYPE_ANY,[S.z.Fax]:y.z.PHONE_TYPE_FAX,[S.z.Landline]:y.z.PHONE_TYPE_LANDLINE,[S.z.Mobile]:y.z.PHONE_TYPE_MOBILE,[S.z.WorkFax]:y.z.PHONE_TYPE_WORK_FAX,[S.z.WorkLandline]:y.z.PHONE_TYPE_WORK_LANDLINE,[S.z.WorkMobile]:y.z.PHONE_TYPE_WORK_MOBILE},I=e=>e?Date.parse(e)/1e3:null,T={[h.U.Address]:e=>({addressFull:e.streetName,addressName:e.itemName,linkedPhone:e.linkedPhoneId,...e}),[h.U.BankAccount]:e=>({...e,bank:e.bankCode,localeFormat:e.country||w.c.US,name:e.accountName,owner:e.ownerName}),[h.U.Company]:e=>({name:e.companyName,...e}),[h.U.Credential]:e=>({login:e.username,otpUrl:e.otpURL,otpSecret:e.otpSecret,secondaryLogin:e.alternativeUsername,title:e.itemName,url:e.URL,linkedWebsites:{addedByUser:e.linkedURLs},...e}),[h.U.DriversLicense]:e=>({...e,country:e.country??w.c.US,expirationDate:I(e.expirationDate),idNumber:e.idNumber??"",issueDate:I(e.issueDate),name:e.idName??"",spaceId:e.spaceId??"",state:e.state??""}),[h.U.Email]:e=>({email:e.emailAddress,emailName:e.itemName,...e}),[h.U.FiscalId]:e=>({...e,country:e.country??w.c.US,idNumber:e.fiscalNumber??"",spaceId:e.spaceId??"",teledeclarantNumber:e.teledeclarantNumber??""}),[h.U.IdCard]:e=>({...e,country:e.country??w.c.US,expirationDate:I(e.expirationDate),idNumber:e.idNumber??"",issueDate:I(e.issueDate),name:e.idName??"",spaceId:e.spaceId??""}),[h.U.Identity]:e=>({...e,title:e.title?E[e.title]:void 0}),[h.U.Passkey]:e=>({...e}),[h.U.Passport]:e=>({...e,country:e.country??w.c.US,expirationDate:I(e.expirationDate),idNumber:e.idNumber??"",issueDate:I(e.issueDate),name:e.idName??"",spaceId:e.spaceId??"",deliveryPlace:e.issuePlace??""}),[h.U.PaymentCard]:e=>({...e,cardName:e.itemName,color:e.color?_[e.color]:void 0,personalNote:e.note}),[h.U.Phone]:e=>({...e,phoneName:e.itemName,number:e.phoneNumber,type:e.type?C[e.type]:void 0}),[h.U.Secret]:e=>({...e,secured:e.isSecured}),[h.U.SecureNote]:e=>({...e}),[h.U.SocialSecurityId]:e=>({...e,country:e.country??w.c.US,idNumber:e.idNumber??"",name:e.idName??"",spaceId:e.spaceId??""}),[h.U.Website]:e=>({name:e.itemName,website:e.URL,...e})};class A{async execute({body:e}){const{vaultItemType:t,content:s,shouldSkipSync:n}=e;if([h.U.DriversLicense,h.U.FiscalId,h.U.IdCard,h.U.Passport,h.U.SocialSecurityId].includes(t))return this.createId(t,s);if(t===h.U.Passkey)return this.createPasskey(s);const{commands:r}=this.carbonLegacyClient,i=await r.carbonLegacyLeeloo({name:"savePersonalDataItem",arg:[{kwType:t,origin:"MANUAL",content:T[t](s),shouldSkipSync:n}]});if((0,p.hx)(i))return this.handleError(t);const a=(0,p.db)(i).carbonResult;return this.handleSuccess(t,a.itemId)}handleError(e){return Promise.resolve((0,p.Rn)({tag:"error",errorMessage:`Failed to create ${e}`}))}handleSuccess(e,t){return this.eventEmitter.sendEvent("created",{ids:[t],vaultItemType:e}),Promise.resolve((0,p.Vp)({id:t}))}async createId(e,t){const{commands:{addDriverLicense:s,addFiscalId:n,addIdCard:r,addPassport:i,addSocialSecurityId:a}}=this.carbonLegacyClient,o={[h.U.DriversLicense]:s,[h.U.FiscalId]:n,[h.U.IdCard]:r,[h.U.Passport]:i,[h.U.SocialSecurityId]:a},c=await o[e](T[e](t));return(0,p.hx)(c)?this.handleError(e):this.handleSuccess(e,(0,p.db)(c).id)}async createPasskey(e){const{commands:{addPasskey:t}}=this.carbonLegacyClient,s=await t(e);return(0,p.hx)(s)?this.handleError(h.U.Passkey):this.handleSuccess(h.U.Passkey,(0,p.db)(s).id)}constructor(e,t){this.carbonLegacyClient=e,this.eventEmitter=t}}A=(0,n.gn)([(0,u.W)(g._),(0,n.w6)("design:type",Function),(0,n.w6)("design:paramtypes",[void 0===m._?Object:m._,void 0===l?Object:l])],A);var U=s(60399),N=s(87457),O=s(48062),D=s(3873),F=s(56008),P=s(4174),R=s(54691),x=s(59664),L=s(59093),k=s(88981),j=s(35594),M=s(31108),z=s(13134),V=s(71937),B=s(71860);const K=Object.freeze({criticality:"critical",moduleName:"VaultItemsCrudModule",useCaseName:"DeleteVaultItemsBulkCommand",applicationComponent:"",anomalyType:"other"});class G{async createActivityLogs(e){const t={};try{const s=await(0,U.z)(this.teamPlanDetailsClient.queries.getTeamId());if((0,p.d6)(s)){const{teamId:n}=(0,p.db)(s);n&&await Promise.allSettled(e.map((async e=>{try{const s=await this.vaultRepository.getCredential(e);s.SpaceId===n&&(t[e]=(0,V.Y)(x.b.UserDeletedCredential,{domain_url:new z.Y(s.Url).getRootDomain()}))}catch(e){this.anomalyReporter.commands.reportAnomaly({...K,message:"Unexpected error while retrieving credential to be deleted for activity logs",additionalInfo:String(e)})}})))}}catch(e){this.anomalyReporter.commands.reportAnomaly({...K,message:"Unexpected error while creating activity logs for credentials to be deleted",additionalInfo:String(e)})}return t}async doSharingConditionChecks({vaultItemType:e,vaultItemIds:t}){const s={canBeDeleted:[],cannotBeDeleted:[]};return await Promise.all(t.map((async t=>{try{const n=await this.sharingItemsClient.commands.refuseSharedItemBeforeDeletion({vaultItemId:t});(0,p.hx)(n)?(s.cannotBeDeleted.push(t),this.anomalyReporter.commands.reportAnomaly({...K,message:"Unexpected failure returned by the sharing conditions check of a vault item to delete in bulk",additionalInfo:JSON.stringify({vaultItemType:e,failure:(0,p.Yv)(n)})})):s.canBeDeleted.push(t)}catch(n){s.cannotBeDeleted.push(t),this.anomalyReporter.commands.reportAnomaly({...K,message:"Unexpected error occurred while handling sharing conditions of the vault item to delete in bulk",additionalInfo:JSON.stringify({vaultItemType:e,error:String(n)})})}}))),s}async execute({body:e}){const{ids:t,vaultItemType:s,ignoreSharing:n=!1}=e,r=Array.from(new Set(t)),{found:i,notFound:a}=await this.vaultRepository.vaultItemsOfTypeExist(r,s);a.length>0&&this.anomalyReporter.commands.reportAnomaly({...K,message:"Vault items to delete could not be found",additionalInfo:JSON.stringify({vaultItemType:s,notFound:a.length,found:i.length})});let o=i;const c=[...a];if(!n&&(0,k.RP)(s)){const e=await this.doSharingConditionChecks({vaultItemType:s,vaultItemIds:o});o=e.canBeDeleted,c.push(...e.cannotBeDeleted)}const d=!n&&o.length>0&&s===h.U.Credential?await this.createActivityLogs(o):null,l=o.length>0?await this.carbonLegacyClient.commands.deleteVaultModuleItemsBulk({kwType:s,items:o.map((e=>({id:e})))}):null;if(null!==l&&(0,p.hx)(l))throw new Error("Unexpected failure trying to bulk-delete vault items of type from Carbon",{cause:{failure:(0,p.Yv)(l)}});let u=o;const m=l&&(0,p.db)(l);if(g=m,(0,D.K)(g)&&"success"in g&&!1===g.success&&"error"in g&&(0,D.K)(g.error)&&"errors"in g.error&&Array.isArray(g.error.errors)&&g.error.errors.every((e=>(0,D.K)(e)&&"id"in e&&"string"==typeof e.id))){const e=m.error.errors;u=(0,N.Z)(o,e.map((({id:e})=>e))),this.anomalyReporter.commands.reportAnomaly({...K,message:"Errors returned by Carbon when attempting to delete Vault Items in Bulk",additionalInfo:JSON.stringify({vaultItemType:s,carbonDeletionErrors:e})})}var g;u.length>0&&(this.eventEmitter.sendEvent("deleted",{ids:u,vaultItemType:s}),this.carbonLegacyClient.commands.removeItemsFromCollections({ids:u})),this.syncClient.commands.sync({trigger:O.Trigger.Save});const v=d&&u.map((e=>d[e])).filter(Boolean);return Array.isArray(v)&&v.length>0&&this.activityLogsClient.commands.storeActivityLogs({activityLogs:v}),u.length!==r.length?(0,p.Rn)((0,F.nO)(c)):(0,p.Vp)(void 0)}constructor(e,t,s,n,r,i,a,o){this.carbonLegacyClient=e,this.eventEmitter=t,this.syncClient=s,this.vaultRepository=n,this.sharingItemsClient=r,this.teamPlanDetailsClient=i,this.activityLogsClient=a,this.anomalyReporter=o}}G=(0,n.gn)([(0,u.W)(F.cR),(0,n.w6)("design:type",Function),(0,n.w6)("design:paramtypes",[void 0===m._?Object:m._,void 0===l?Object:l,void 0===P.Q?Object:P.Q,void 0===B.g?Object:B.g,void 0===j.s?Object:j.s,void 0===M.e?Object:M.e,void 0===L._?Object:L._,void 0===R.G?Object:R.G])],G);var $=s(51424),q=s(87263),H=s(40102);const W=Object.freeze({criticality:"critical",moduleName:"VaultItemsCrudModule",useCaseName:"DeleteVaultItemCommand",applicationComponent:"",anomalyType:"other"});class Q{async createActivityLog(e){try{const[t,s]=await Promise.all([(0,U.z)(this.teamPlanDetailsClient.queries.getTeamId()),this.vaultRepository.getCredential(e)]);if((0,p.d6)(t)&&(0,p.db)(t).teamId===s.SpaceId){return(0,V.Y)(x.b.UserDeletedCredential,{domain_url:new z.Y(s.Url).getRootDomain()})}}catch(e){this.anomalyReporter.commands.reportAnomaly({...W,message:"Unexpected error while creating the activity log for a credential to be deleted",additionalInfo:String(e)})}}async execute({body:e}){const{vaultItemType:t,id:s,ignoreSharing:n=!1}=e,{notFound:r}=await this.vaultRepository.vaultItemsOfTypeExist([s],t);if(r.length>0)return this.anomalyReporter.commands.reportAnomaly({...W,message:"Vault item to delete could not be found",additionalInfo:JSON.stringify({vaultItemType:t})}),(0,p.Rn)((0,q.sA)());if(!n&&(0,k.RP)(t))try{const e=await this.sharingItemsClient.commands.refuseSharedItemBeforeDeletion({vaultItemId:s});if((0,p.hx)(e)){const s=(0,p.Yv)(e);switch(this.anomalyReporter.commands.reportAnomaly({...W,message:"Unexpected failure returned by the sharing conditions check of the vault item to delete",additionalInfo:JSON.stringify({vaultItemType:t,failure:s})}),s.tag){case H.m$.FORBIDDEN_GROUP_ITEM:return(0,p.Rn)((0,H.Vf)());case H.m$.FORBIDDEN_LAST_ADMIN:return(0,p.Rn)((0,q.V$)());default:throw new Error("Unhandled failure returned by the sharing conditions check of the vault item to delete",{cause:{failure:s}})}}}catch(e){throw new Error("Unexpected error occurred while handling sharing conditions of the vault item to delete",{cause:e})}const i=!n&&t===h.U.Credential?await this.createActivityLog(s)??null:null,a=await this.carbonLegacyClient.commands.deleteVaultModuleItem({id:s,kwType:t});if((0,p.hx)(a))throw new Error("Unexpected failure trying to delete vault item of type from Carbon",{cause:{failure:(0,p.Yv)(a)}});const o=(0,p.db)(a);if(d=o,(0,D.K)(d)&&"success"in d&&!1===d.success&&"error"in d&&(0,D.K)(d.error)){const e=(e=>e.error)(o),s="reason"in(c=e)&&"string"==typeof c.reason?c.reason:null;if(s===$.zC.NOT_FOUND)return this.anomalyReporter.commands.reportAnomaly({...W,criticality:"warning",message:"Vault item to delete could not be found during Carbon deletion",additionalInfo:JSON.stringify({vaultItemType:t})}),(0,p.Rn)((0,q.sA)());throw new Error("Unexpected failure trying to delete vault item of type from Carbon",{cause:{vaultItemType:t,error:e,reason:s}})}var c,d;return this.eventEmitter.sendEvent("deleted",{ids:[s],vaultItemType:t}),await this.carbonLegacyClient.commands.removeItemsFromCollections({ids:[s]}),await this.syncClient.commands.sync({trigger:O.Trigger.Save}),null!==i&&this.activityLogsClient.commands.storeActivityLogs({activityLogs:[i]}),(0,p.Vp)(void 0)}constructor(e,t,s,n,r,i,a,o){this.carbonLegacyClient=e,this.eventEmitter=t,this.syncClient=s,this.vaultRepository=n,this.sharingItemsClient=r,this.teamPlanDetailsClient=i,this.activityLogsClient=a,this.anomalyReporter=o}}Q=(0,n.gn)([(0,u.W)(q.io),(0,n.w6)("design:type",Function),(0,n.w6)("design:paramtypes",[void 0===m._?Object:m._,void 0===l?Object:l,void 0===P.Q?Object:P.Q,void 0===B.g?Object:B.g,void 0===j.s?Object:j.s,void 0===M.e?Object:M.e,void 0===L._?Object:L._,void 0===R.G?Object:R.G])],Q);var Y=s(5822);class X{async execute({body:e}){const{content:t,id:s,vaultItemType:n,shouldSkipSync:r}=e;if([h.U.DriversLicense,h.U.FiscalId,h.U.IdCard,h.U.Passport,h.U.SocialSecurityId].includes(n))return this.updateId(n,t,s);if(n===h.U.Passkey)return this.updatePasskey(t,s);const{commands:i}=this.carbonLegacyClient,a=await i.carbonLegacyLeeloo({name:"savePersonalDataItem",arg:[{kwType:n,origin:"MANUAL",content:{...T[n](t),id:s},shouldSkipSync:r}]});return(0,p.hx)(a)?Promise.resolve((0,p.Rn)({tag:"error",errorMessage:`Failed to update ${n}`})):(this.eventEmitter.sendEvent("updated",{ids:[s],vaultItemType:n}),Promise.resolve((0,p.Vp)(void 0)))}handleError(e){return Promise.resolve((0,p.Rn)({tag:"error",errorMessage:`Failed to update ${e}`}))}handleSuccess(e,t){return this.eventEmitter.sendEvent("updated",{ids:[t],vaultItemType:e}),Promise.resolve((0,p.Vp)(void 0))}async updateId(e,t,s){const{commands:{editDriverLicense:n,editFiscalId:r,editIdCard:i,editPassport:a,editSocialSecurityId:o}}=this.carbonLegacyClient,c={[h.U.DriversLicense]:n,[h.U.FiscalId]:r,[h.U.IdCard]:i,[h.U.Passport]:a,[h.U.SocialSecurityId]:o},d=await c[e]({...T[e](t),id:s});return(0,p.hx)(d)?this.handleError(e):this.handleSuccess(e,s)}async updatePasskey(e,t){const{commands:{updatePasskey:s}}=this.carbonLegacyClient,n=await s({...e,id:t});return(0,p.hx)(n)?this.handleError(h.U.Passkey):this.handleSuccess(h.U.Passkey,t)}constructor(e,t){this.carbonLegacyClient=e,this.eventEmitter=t}}X=(0,n.gn)([(0,u.W)(Y.K),(0,n.w6)("design:type",Function),(0,n.w6)("design:paramtypes",[void 0===m._?Object:m._,void 0===l?Object:l])],X);var Z=s(44594);class J{execute({body:e}){const{ids:t,eventType:s}=e;return this.eventEmitter.sendEvent(s,{ids:t,vaultItemType:h.U.Credential}),Promise.resolve((0,p.Vp)(void 0))}constructor(e){this.eventEmitter=e}}J=(0,n.gn)([(0,u.W)(Z.c),(0,n.w6)("design:type",Function),(0,n.w6)("design:paramtypes",[void 0===l?Object:l])],J);var ee=s(46449),te=s(17049),se=s(33312),ne=s(52987),re=s(17991),ie=s(59503),ae=s(15531);class oe{execute({body:{domain:e}}){const{queries:{carbonState:t}}=this.carbonLegacyClient;return t({path:"userSession.iconsCache.domains"}).pipe((0,se.Qn)((t=>{if(s=t,!ae.x.safeParse(s).success)throw new Error("Bad domain icons cache format");var s;return t.get((0,re.k)(this.md5Hasher.compute((0,ie.u)(e))))})))}constructor(e,t){this.carbonLegacyClient=e,this.md5Hasher=t}}oe=(0,n.gn)([(0,ee.e)(te.s),(0,n.w6)("design:type",Function),(0,n.w6)("design:paramtypes",[void 0===m._?Object:m._,void 0===ne.f?Object:ne.f])],oe);var ce=s(54676);class de{execute({body:e}){return this.vaultRepository.fetchVaultItems$(e)}constructor(e){this.vaultRepository=e}}de=(0,n.gn)([(0,ee.e)(ce.W),(0,n.w6)("design:type",Function),(0,n.w6)("design:paramtypes",[void 0===B.g?Object:B.g])],de);var le=s(68129);class ue{execute(){const{queries:{carbonState:e}}=this.carbonLegacyClient;return e({path:"userSession.personalSettings.ProtectPasswords"}).pipe((0,se.Qn)((e=>{if("boolean"!=typeof e)throw new Error("Fail to get ProtectPasswords setting");return e})))}constructor(e){this.carbonLegacyClient=e}}ue=(0,n.gn)([(0,ee.e)(le.R),(0,n.w6)("design:type",Function),(0,n.w6)("design:paramtypes",[void 0===m._?Object:m._])],ue);var pe=s(96900),me=s(69326);const he=e=>{if(!e)return{richIconsEnabled:!0};const t=e;if(!(0,me.u)(t.spaces))return{richIconsEnabled:!0};const s=t.spaces.find((e=>"accepted"===e.status));return{richIconsEnabled:s?.info.richIconsEnabled??!0}};class ge{get(){const{getNodePremiumStatus:e}=this.carbon.queries;return e().pipe((0,se.Qn)(he))}execute(){return this.get().pipe((0,se.Qn)((e=>e.richIconsEnabled)))}constructor(e){this.carbon=e}}ge=(0,n.gn)([(0,ee.e)(pe.M),(0,n.w6)("design:type",Function),(0,n.w6)("design:paramtypes",[void 0===m._?Object:m._])],ge);class ve{}ve=(0,n.gn)([(0,r.Y)({api:a.L,handlers:{commands:{createVaultItem:A,deleteVaultItems:G,deleteVaultItem:Q,updateVaultItem:X,emitTemporaryVaultItemEvent:J},events:{},queries:{domainIconDetails:oe,query:de,credentialsGloballyProtected:ue,richIconsEnabled:ge}},imports:[i.D],providers:[l,B.g],requiredFeatureFlips:Object.values(o.j),domainName:"vault"})],ve)},14186:(e,t,s)=>{s.d(t,{K:()=>w});var n=s(92336),r=s(86006),i=s(53234),a=s(63144),o=s(56618),c=s(62149),d=s(60018);const l=e=>!(!e||"object"!=typeof e)&&"isCollectionGuidedIntroEnabled"in e,u={isCollectionGuidedIntroEnabled:!0,hasSeenFreeUserFrozenState:!1};class p extends((0,a.Q)({persist:!0,storage:{initialValue:u,typeGuard:l,schemaVersion:2,migrateStorageSchema:()=>({isCollectionGuidedIntroEnabled:!0,hasSeenFreeUserFrozenState:!1})},scope:c.F.User,storeName:"vault-notifications",capacity:o.Y._001KB,codec:d.E})){}var m=s(82874),h=s(78346),g=s(67304);class v{async execute({body:e}){const{notificationName:t,isEnabled:s}=e;try{const e=await this.store.getState();return await this.store.set({...e,[t]:s}),(0,h.Vp)(void 0)}catch{throw new Error("SetVaultNotificationsStatus command from vault-core failed")}}constructor(e){this.store=e}}v=(0,n.gn)([(0,m.W)(g.x),(0,n.w6)("design:type",Function),(0,n.w6)("design:paramtypes",[void 0===p?Object:p])],v);var y=s(87065),f=s(46449),b=s(71524);class S{execute(){return this.store.state$.pipe((0,y.U)(h.Vp))}constructor(e){this.store=e}}S=(0,n.gn)([(0,f.e)(b.M),(0,n.w6)("design:type",Function),(0,n.w6)("design:paramtypes",[void 0===p?Object:p])],S);class w{}w=(0,n.gn)([(0,r.Y)({api:i.e,handlers:{commands:{setVaultNotificationsStatus:v},events:{},queries:{getVaultNotificationsStatus:S}},stores:[p]})],w)},39149:(e,t,s)=>{s.d(t,{H:()=>D});var n=s(92336),r=s(86006),i=s(96124),a=s(60399),o=s(38644),c=s(82874),d=s(14122),l=s(78346),u=s(48062),p=s(59664),m=s(59093),h=s(33312);const g=e=>!!Array.isArray(e)&&(0===e.length||e.every((e=>{const t=e;return"string"==typeof t.Id&&"string"==typeof t.Name&&Array.isArray(t.VaultItems)})));function v(e,t){const{queries:{carbonState:s}}=e;return s({path:"userSession.personalData.collections"}).pipe((0,h.Qn)((e=>{if(!g(e))throw new Error("Collection array has a wrong format");return{collections:(t&&t.length>0?e.filter((e=>t.includes(e.Id))):e).map((e=>({id:e.Id,name:e.Name,spaceId:e.SpaceId??"",vaultItems:e.VaultItems.map((e=>({id:e.Id,type:e.Type})))})))}})))}function y(e,t,s,n){const r=new u.UserUpdateCollectionEvent({collectionId:s,action:t,itemCount:n,isShared:!1});return e.commands.carbon({name:"logEvent",args:[{event:r}]})}var f=s(71937);class b{async execute({body:e}){const{id:t,name:s=""}=e,n=await(0,a.z)(v(this.carbonLegacyClient,[t]));if((0,l.hx)(n))throw new Error(`Failed to fetch additional collection info: ${n.error}`);const r=await this.carbonLegacyClient.commands.carbon({name:"deleteCollection",args:[{id:t}]});if((0,l.hx)(r))throw new Error(`Failed to delete collection: ${r.error}`);y(this.carbonLegacyClient,u.CollectionAction.Delete,t,n.data.collections[0]?.vaultItems?.length);const i={collection_name:s},o=(0,f.Y)(p.b.UserDeletedCollection,i);return this.activityLogs.commands.storeActivityLogs({activityLogs:[o]}),Promise.resolve((0,l.Vp)(void 0))}constructor(e,t){this.carbonLegacyClient=e,this.activityLogs=t}}b=(0,n.gn)([(0,c.W)(o.T),(0,n.w6)("design:type",Function),(0,n.w6)("design:paramtypes",[void 0===d._?Object:d._,void 0===m._?Object:m._])],b);var S=s(95569),w=s(7303);class E{async execute({body:e}){const{content:{name:t,spaceId:s="",vaultItems:n=[]}}=e,r=await this.carbonLegacy.commands.carbon({name:"addCollection",args:[{name:t,spaceId:s,vaultItems:n}]});if((0,l.hx)(r))throw new Error(`Failed to create collection: ${r.error}`);if("object"!=typeof(i=r.data.carbonResult)||null===i||!(0,w.l$)(i,"id")||"string"!=typeof i.id||!(0,w.l$)(i,"success")||"boolean"!=typeof i.success)throw new Error("Failed to find created collection id");var i;if(s){const e=[(0,f.Y)(p.b.UserCreatedCollection,{collection_name:t})];this.activityLogs.commands.storeActivityLogs({activityLogs:e})}return y(this.carbonLegacy,u.CollectionAction.Add,r.data.carbonResult.id,n.length),n.length&&y(this.carbonLegacy,u.CollectionAction.AddCredential,r.data.carbonResult.id,n.length),(0,l.Vp)({id:r.data.id})}constructor(e,t){this.activityLogs=e,this.activityLogs=e,this.carbonLegacy=t}}E=(0,n.gn)([(0,c.W)(S.e),(0,n.w6)("design:type",Function),(0,n.w6)("design:paramtypes",[void 0===m._?Object:m._,void 0===d._?Object:d._])],E);var _=s(86342),C=s(39431),I=s(50879),T=s(13134);class A{async execute({body:e}){const{id:t,collection:s,operationType:n=_.C.APPEND_VAULT_ITEMS}=e,r=await(0,a.z)(v(this.carbonLegacyClient,[t]));if((0,l.hx)(r))throw new Error(`Failed to fetch additional collection info: ${r.error}`);const i=r.data.collections[0];let o;if(s.vaultItems){const e=await(0,a.z)(this.vaultItemsCrudClient.queries.query({vaultItemTypes:[C.U.Credential,C.U.SecureNote],ids:s.vaultItems.map((e=>e.id))}));if((0,l.hx)(e))throw new Error("Unable to find items in collection");const t=e.data.credentialsResult.items,r=e.data.secureNotesResult.items,c=[...t.map((e=>({id:e.id,type:C.U.Credential,url:e.URL}))),...r.map((e=>({id:e.id,type:C.U.SecureNote})))];o={id:s.id,name:s.name,spaceId:s.spaceId,vaultItems:c},i.vaultItems=this.mutateCollectionVaultItems(i,n,c)}else o={id:s.id,name:s.name,spaceId:s.spaceId};const c=await this.carbonLegacyClient.commands.carbon({name:"updateCollection",args:[{id:i.id,name:s.name??i.name,spaceId:s.spaceId??i.spaceId,vaultItems:i.vaultItems}]});if((0,l.hx)(c))throw new Error(`Failed to update collection: ${c.error}`);return this.handleLogs(i,o,n),Promise.resolve((0,l.Vp)(void 0))}handleLogs(e,t,s){let n=null;const r={};if(t.name&&(y(this.carbonLegacyClient,u.CollectionAction.Edit,e.id,e.vaultItems.length),t.name!==e.name&&(n=p.b.UserRenamedCollection,r.collection_name=t.name,r.old_collection_name=e.name)),t.vaultItems&&(y(this.carbonLegacyClient,s===_.C.SUBSTRACT_VAULT_ITEMS?u.CollectionAction.DeleteCredential:u.CollectionAction.AddCredential,e.id,1),t.vaultItems[0]?.type===C.U.Credential&&(n=s===_.C.APPEND_VAULT_ITEMS?p.b.UserAddedCredentialToCollection:p.b.UserRemovedCredentialFromCollection,r.collection_name=e.name,r.domain_url=new T.Y(t.vaultItems[0].url).getRootDomain())),e.spaceId&&n){const e=(0,f.Y)(n,r);this.activityLogs.commands.storeActivityLogs({activityLogs:[e]})}}getDeduplicatedList(e){return[...new Map(e.map((e=>[e.id,e]))).values()]}mutateCollectionVaultItems(e,t,s){return t===_.C.SUBSTRACT_VAULT_ITEMS?e.vaultItems.filter((e=>!s.some((t=>t.id===e.id)))):this.getDeduplicatedList([...e.vaultItems,...s])}constructor(e,t,s){this.carbonLegacyClient=e,this.activityLogs=t,this.vaultItemsCrudClient=s}}A=(0,n.gn)([(0,c.W)(_.s),(0,n.w6)("design:type",Function),(0,n.w6)("design:paramtypes",[void 0===d._?Object:d._,void 0===m._?Object:m._,void 0===I.L?Object:I.L])],A);var U=s(42645),N=s(46449);class O{execute({body:e}){const{ids:t}=e;return v(this.carbonLegacyClient,t)}constructor(e){this.carbonLegacyClient=e}}O=(0,n.gn)([(0,N.e)(U.I),(0,n.w6)("design:type",Function),(0,n.w6)("design:paramtypes",[void 0===d._?Object:d._])],O);class D{}D=(0,n.gn)([(0,r.Y)({api:i.v,handlers:{commands:{deleteCollection:b,createCollection:E,updateCollection:A},events:{},queries:{queryCollections:O}},requiredFeatureFlips:["vault_web_collection_migration_space_prod_v2","vault_web_popupSavedState_release","sharingVault_web_bulkaddtocollection_dev"]})],D)},71937:(e,t,s)=>{s.d(t,{Y:()=>n});const n=(e,t)=>({date_time:(new Date).getTime(),log_type:e,properties:t,schema_version:"1.0.0",uuid:crypto.randomUUID().toUpperCase()})},69326:(e,t,s)=>{s.d(t,{u:()=>n});const n=e=>function(e,t){if(!Array.isArray(e))return!1;if(0===e.length)return!0;const s=e[0];for(let e=0;e<t.length;e++){const n=t[e];if(!Object.prototype.hasOwnProperty.call(s,n))return!1}return!0}(e,["teamId"])},71860:(e,t,s)=>{s.d(t,{g:()=>ye});var n=s(92336),r=s(85390),i=s(87065),a=s(69885),o=s(43978),c=s(6136),d=s(60399),l=s(92587),u=s(78346),p=s(33312),m=s(51424),h=s(14122),g=s(39431),v=s(29289),y=s(87263),f=s(52402),b=s(92481);function S(e,t){return e in t}function w(e){const t={};for(const s in e)t[s.charAt(0).toLowerCase()+s.slice(1)]=e[s];return t}const E=e=>{if(!e||3!==e.split("-").length)return"";const t=e.split("-"),s=Number(t[0]),n=Number(t[1])-1,r=Number(t[2]);return(0,b.Z)(new Date(s,n,r),"yyyy-MM-dd")};function _(e,t,s){return t||s?e.filter((e=>!(t&&!t.every((t=>S(t.property,e)&&function(e,t,s=f.l.Equal){return{[f.l.Equal]:()=>e===t,[f.l.LessThan]:()=>e<t,[f.l.GreaterThan]:()=>e>t}[s]()}(e[t.property],t.value,t.operator))))&&(s?.(e)??!0))):e}var C=s(93314);function I(e,t){if(!t||!e.length||!S(t.property,e[0]))return e;const s=t.property,n=t.direction||C.S.Ascend;return e.sort(((e,t)=>{const r=e[s],i=t[s];return r||i?r?i?function(e,t,s){const n=Number(e),r=Number(t);return"string"==typeof e&&"string"==typeof t?s===C.S.Ascend?e.localeCompare(t):t.localeCompare(e):"number"==typeof e&&"number"==typeof t?s===C.S.Ascend?e-t:t-e:isNaN(n)||isNaN(r)?0:s===C.S.Ascend?n-r:r-n}(r,i,n):n===C.S.Ascend?1:-1:n===C.S.Ascend?-1:1:0}))}function T(e,t){if(!Array.isArray(e))return!1;if(0===e.length)return!0;return e[0].kwType===t}const A=e=>T(e,g.U.Secret),U=e=>{const{LocaleFormat:t,Secured:s,...n}=e;return{...w(n),isSecured:s}};var N=s(81813);const O=e=>T(e,g.U.Credential),D=e=>T(e,g.U.Address),F=e=>T(e,g.U.Company),P=e=>T(e,g.U.Email),R=e=>T(e,g.U.Identity),x=e=>T(e,g.U.Phone),L=e=>T(e,g.U.Website);var k=s(69326);const j=e=>{const{AddressName:t,LinkedPhone:s,StreetName:n,AddressFull:r,StateLevel2:i,...a}=e;return{...w(a),itemName:t,linkedPhoneId:s,streetName:n||r}},M=e=>T(e,g.U.BankAccount),z=e=>{const{BankAccountName:t,BankAccountOwner:s,BankAccountIBAN:n,BankAccountBIC:r,BankAccountBank:i,...a}=e,o=i?.split("-"),c=o?.length>1?o[1]??i:i;return{...w(a),accountName:t,bankCode:c||"",BIC:r,country:a.LocaleFormat,IBAN:n,ownerName:s}},V=e=>{const{Name:t,PersonalNote:s,LocaleFormat:n,...r}=e;return{...w(r),companyName:t}},B=e=>{const{CreationDatetime:t,Email:s,Id:n,LastBackupTime:r,LastUse:i,LinkedServices:a,Login:o,Note:c,OtpSecret:d,OtpUrl:l,Password:u,SecondaryLogin:p,SpaceId:m,Title:h,Url:g,UserModificationDatetime:v,UserSelectedUrl:y,kwType:f}=e;return{...w({CreationDatetime:t,Email:s,Id:n,LastBackupTime:r,LastUse:i,Note:c,Password:u,SpaceId:m,UserModificationDatetime:v}),alternativeUsername:p,itemName:h??"",linkedURLs:a?.associated_domains.map((e=>e.domain))??[],kwType:f,otpURL:l,otpSecret:d,URL:g||y||"",username:o}},K=e=>T(e,g.U.DriversLicense),G=e=>T(e,g.U.FiscalId),$=e=>T(e,g.U.IdCard),q=e=>T(e,g.U.Passport),H=e=>T(e,g.U.SocialSecurityId),W=e=>e?[e.FirstName,e.MiddleName,e.LastName,e.LastName2].filter(Boolean).join(" "):"",Q=(e,t)=>{const{DeliveryDate:s,ExpireDate:n,Fullname:r,Number:i,DateOfBirth:a,Sex:o,...c}=e;return{...w(c),idName:W(t)||r||"",idNumber:i,issueDate:E(s),expirationDate:E(n),country:c.LocaleFormat}},Y=e=>{const{EmailName:t,Email:s,Type:n,LocaleFormat:r,...i}=e;return{...w(i),itemName:t,emailAddress:s,type:n}},X=e=>{const{kwType:t}=e;return{...w(e),kwType:t,country:e.LocaleFormat}},Z=(e,t)=>{const{DateOfBirth:s,DeliveryDate:n,ExpireDate:r,Fullname:i,Number:a,Sex:o,...c}=e;return{...w(c),idName:W(t)||i||"",idNumber:a,issueDate:E(n),expirationDate:E(r),country:c.LocaleFormat}};var J=s(26311);const ee={"":void 0,MR:J.t.Mr,MME:J.t.Mrs,MLLE:J.t.Miss,MS:J.t.Ms,MX:J.t.Mx,NONE_OF_THESE:J.t.NoneOfThese},te=e=>{const{Title:t,LocaleFormat:s,...n}=e;return{...w(n),title:ee[t]}},se=e=>T(e,g.U.Passkey),ne=(e,t)=>{const{DeliveryDate:s,DeliveryPlace:n,ExpireDate:r,Fullname:i,Number:a,DateOfBirth:o,Sex:c,...d}=e;return{...w(d),idName:W(t)||i||"",idNumber:a||"",issueDate:E(s),issuePlace:n||"",expirationDate:E(r),country:d.LocaleFormat}},re=e=>T(e,g.U.PaymentCard);var ie=s(53214);const ae={BLACK:ie.X.Black,BLUE_1:ie.X.Blue1,BLUE_2:ie.X.Blue2,GOLD:ie.X.Gold,GREEN_1:ie.X.Green1,GREEN_2:ie.X.Green2,ORANGE:ie.X.Orange,RED:ie.X.Red,SILVER:ie.X.Silver,WHITE:ie.X.White},oe=e=>{const{Name:t,CCNote:s,Color:n,Bank:r,CardNumberLastDigits:i,IssueNumber:a,StartMonth:o,StartYear:c,Type:d,LocaleFormat:l,...u}=e;return{...w(u),itemName:t,color:ae[n],note:s||""}};var ce=s(90294),de=s(7325);const le={[ce.z.PHONE_TYPE_ANY]:de.z.Any,[ce.z.PHONE_TYPE_FAX]:de.z.Fax,[ce.z.PHONE_TYPE_LANDLINE]:de.z.Landline,[ce.z.PHONE_TYPE_MOBILE]:de.z.Mobile,[ce.z.PHONE_TYPE_WORK_FAX]:de.z.WorkFax,[ce.z.PHONE_TYPE_WORK_LANDLINE]:de.z.WorkLandline,[ce.z.PHONE_TYPE_WORK_MOBILE]:de.z.WorkMobile},ue=e=>{const{PhoneName:t,Number:s,Type:n,...r}=e;return{...w(r),itemName:t,phoneNumber:s,type:le[n]}},pe=e=>T(e,g.U.SecureNote);var me=s(30581);const he=e=>{const{Secured:t,Type:s,Category:n,LocaleFormat:r,...i}=e;return{...w(i),isSecured:t,color:me.L[s]||me.L.GRAY}},ge=(e,t)=>{const{DateOfBirth:s,LinkedIdentity:n,Sex:r,SocialSecurityFullname:i,SocialSecurityNumber:a,...o}=e;return{...w(o),idName:W(t)||i||"",idNumber:a,country:o.LocaleFormat}},ve=e=>{const{Website:t,Name:s,PersonalNote:n,LocaleFormat:r,...i}=e;return{...w(i),itemName:s,URL:t}};class ye{mapTypeToCarbonPath(e){return m.kY[e]}initializeVaultItemsQueryParams(e){const{ids:t,pageSize:s,pageNumber:n,propertyFilters:r,propertySorting:i}=e;this.ids=t,this.propertyFilters=r,this.propertySorting=i,this.pageSize=s,this.pageNumber=n}fetchVaultItems$(e,t,s){const{vaultItemTypes:n,...a}=e;this.initializeVaultItemsQueryParams(a),this.additionalFilterFunc=t,this.needDashlaneLinkedWebsites=s;const o=(0,r.a)(n.map((e=>this.getVaultItems$TypeDictionary[e]()))),c=this.getEmptyVaultItemsQueryResult();return o.pipe((0,i.U)((e=>(e.forEach((e=>{if("failure"===e.tag)throw new Error("Error while fetching vault items");Object.assign(c,e.data)})),(0,u.Vp)(c)))))}getDashlaneDefinedLinkedWebsites$(e){if((0,u.d6)(e)&&O(e.data)&&this.needDashlaneLinkedWebsites){const t=e.data,s=t.map((({URL:e})=>e));return this.linkedWebsitesClient.queries.getMultipleDashlaneDefinedLinkedWebsites({urls:s}).pipe((0,p.Qn)((e=>t.map(((t,s)=>({...t,linkedURLs:[...t.linkedURLs,...e[s]]}))))))}return(0,a.of)(e)}getVaultItems$(e,t,s){return(0,r.a)([this.getCarbonVaultItems$(e,t),this.getCarbonVaultItems$(g.U.Identity,R),this.getQuarantinedSpacesTeamIds$()],((e,t,n)=>(0,u.Vp)(function(e,t,s,n,r){return e.flatMap((e=>{if(s.includes(e.SpaceId)||r&&!r.some((t=>t.toUpperCase()===e.Id.toUpperCase())))return[];e.LastUse||(e.LastUse=-1);const i=e.LinkedIdentity?t.find((t=>t.Id===e.LinkedIdentity)):void 0;return n(e,i)}))}(e,t,n,s,this.ids)))).pipe((0,o.w)(this.getDashlaneDefinedLinkedWebsites$.bind(this)),(0,p.Qn)((t=>{const s=I(_(t,this.propertyFilters,this.additionalFilterFunc),this.propertySorting);return{[v.N[e]]:{items:this.getPage(s),matchCount:s.length}}})))}getPage(e){return this.pageNumber&&this.pageSize?e.slice(this.pageSize*(this.pageNumber-1),this.pageSize*this.pageNumber):e}getCarbonVaultItems$(e,t){const{queries:{carbonState:s}}=this.carbonLegacyClient;return s({path:`userSession.personalData.${this.mapTypeToCarbonPath(e)}`}).pipe((0,i.U)((s=>{if((0,u.hx)(s)||!t(s.data))throw new Error(`Bad ${v.N[e]} format`);return s.data})))}getQuarantinedSpacesTeamIds$(){const{queries:{carbonState:e}}=this.carbonLegacyClient;return e({path:"userSession.spaceData.spaces"}).pipe((0,i.U)((e=>{if((0,u.hx)(e)||!(0,k.u)(e.data))throw new Error("Bad spaces format");return e.data.filter((e=>this.isPremiumStatusSpaceQuarantined(e.details)))})),(0,i.U)((e=>e.map((e=>e.teamId)).sort())),(0,c.x)(((e,t)=>JSON.stringify(e)!==JSON.stringify(t))))}isPremiumStatusSpaceQuarantined(e){return"accepted"!==e.status.toLowerCase()&&Boolean(e.info.removeForcedContentEnabled)}async shouldRefuseSharedItemBeforeVaultItemDeletion(e,t){const s=t,n=await(0,d.z)(e.queries.getSharingStatusForItem({itemId:s}));if((0,u.hx)(n))throw new Error("Unexpected failure while attempting to retrieve sharing status of item to be deleted",{cause:{failure:(0,u.Yv)(n)}});const{isSharedViaUserGroup:r,isShared:i}=(0,u.db)(n);if(!i)return(0,u.Vp)(!1);if(r)return(0,u.Rn)((0,y.Vf)());const a=await(0,d.z)(e.queries.getIsLastAdminForItem({itemId:s}));if((0,u.hx)(a))throw new Error("Unexpected failure while attempting to determine if we're the last admin of shared item to be deleted",{cause:{failure:(0,u.Yv)(a)}});const{isLastAdmin:o}=(0,u.db)(a);return o?(0,u.Rn)((0,y.V$)()):(0,u.Vp)(!0)}constructor(e,t){this.carbonLegacyClient=e,this.linkedWebsitesClient=t,this.getVaultItems$TypeDictionary={[g.U.Address]:()=>this.getVaultItems$(g.U.Address,D,j),[g.U.BankAccount]:()=>this.getVaultItems$(g.U.BankAccount,M,z),[g.U.Company]:()=>this.getVaultItems$(g.U.Company,F,V),[g.U.Credential]:()=>this.getVaultItems$(g.U.Credential,O,B),[g.U.DriversLicense]:()=>this.getVaultItems$(g.U.DriversLicense,K,Q),[g.U.Email]:()=>this.getVaultItems$(g.U.Email,P,Y),[g.U.FiscalId]:()=>this.getVaultItems$(g.U.FiscalId,G,X),[g.U.IdCard]:()=>this.getVaultItems$(g.U.IdCard,$,Z),[g.U.Identity]:()=>this.getVaultItems$(g.U.Identity,R,te),[g.U.Passkey]:()=>this.getVaultItems$(g.U.Passkey,se,w),[g.U.Passport]:()=>this.getVaultItems$(g.U.Passport,q,ne),[g.U.PaymentCard]:()=>this.getVaultItems$(g.U.PaymentCard,re,oe),[g.U.Phone]:()=>this.getVaultItems$(g.U.Phone,x,ue),[g.U.Secret]:()=>this.getVaultItems$(g.U.Secret,A,U),[g.U.SecureNote]:()=>this.getVaultItems$(g.U.SecureNote,pe,he),[g.U.SocialSecurityId]:()=>this.getVaultItems$(g.U.SocialSecurityId,H,ge),[g.U.Website]:()=>this.getVaultItems$(g.U.Website,L,ve)},this.getEmptyVaultItemsQueryResult=()=>({addressesResult:this.getEmptyItemsQueryResult(),bankAccountsResult:this.getEmptyItemsQueryResult(),companiesResult:this.getEmptyItemsQueryResult(),credentialsResult:this.getEmptyItemsQueryResult(),driversLicensesResult:this.getEmptyItemsQueryResult(),emailsResult:this.getEmptyItemsQueryResult(),fiscalIdsResult:this.getEmptyItemsQueryResult(),idCardsResult:this.getEmptyItemsQueryResult(),identitiesResult:this.getEmptyItemsQueryResult(),passkeysResult:this.getEmptyItemsQueryResult(),passportsResult:this.getEmptyItemsQueryResult(),paymentCardsResult:this.getEmptyItemsQueryResult(),phonesResult:this.getEmptyItemsQueryResult(),secretsResult:this.getEmptyItemsQueryResult(),secureNotesResult:this.getEmptyItemsQueryResult(),socialSecurityIdsResult:this.getEmptyItemsQueryResult(),websitesResult:this.getEmptyItemsQueryResult()}),this.getEmptyItemsQueryResult=()=>({items:[],matchCount:0}),this.vaultItemsOfTypeExist=async(e,t)=>{const s=this.mapTypeToCarbonPath(t),{queries:{carbonState:n}}=this.carbonLegacyClient;return(0,d.z)(n({path:`userSession.personalData.${s}`}).pipe((0,i.U)((s=>{if((0,u.hx)(s)||!Array.isArray(s.data))throw new Error(`Unexpected error fetching vault item for ${t}`);const n=[],r=[];for(const t of e)s.data.some((e=>e.Id===t))?n.push(t):r.push(t);return{found:n,notFound:r}}))))},this.getCredential=async e=>{const t=this.mapTypeToCarbonPath(g.U.Credential),{queries:{carbonState:s}}=this.carbonLegacyClient;return(0,d.z)(s({path:`userSession.personalData.${t}`}).pipe((0,i.U)((t=>{if((0,u.hx)(t)||!O(t.data))throw new Error("Unexpected error fetching credential");const s=t.data.find((t=>t.Id===e));if(!s)throw new Error("Credential not found in vault");return s}))))}}}ye=(0,n.gn)([(0,l.GS)(),(0,n.w6)("design:type",Function),(0,n.w6)("design:paramtypes",[void 0===h._?Object:h._,void 0===N.X?Object:N.X])],ye)},72600:(e,t,s)=>{s.d(t,{U:()=>S});var n=s(92336),r=s(86006),i=s(20281),a=s(85390),o=s(43978),c=s(87065),d=s(46449),l=s(78346),u=s(20980),p=s(39431),m=s(352),h=s(77802),g=s(71860);class v{execute({body:{vaultItemTypes:e,searchQuery:t,needDashlaneLinkedWebsites:s=!1,...n}}){this.searchQuery=t;const{queries:{queryCollections:r}}=this.vaultOrganizationClient,{queries:{sharedCollectionsWithItems:i}}=this.sharingCollectionsClient;return(0,a.a)([r({}),i()]).pipe((0,o.w)((([t,r])=>{if((0,l.hx)(t)||(0,l.hx)(r))throw new Error("Error querying collections");this.collections=t.data.collections.concat(r.data);const i=e??Object.values(p.U);return this.vaultRepository.fetchVaultItems$({vaultItemTypes:i,...n},this.isVaultItemMatch,s)})),(0,c.U)((t=>{if((0,l.hx)(t))throw new Error("Error");const s=t.data;let n;if(e)n={items:[],matchCount:0};else{const e=this.collections.filter((e=>this.isMatch(e)));n={items:e,matchCount:e.length}}return(0,l.Vp)({...s,collectionsResult:n})})))}isMatch(e,t=""){return t+=Object.values(e).filter((e=>"object"!=typeof e||Array.isArray(e))).map((e=>Array.isArray(e)?e.toString():e)).join(this.separator),this.normalizeString(t).includes(this.normalizeString(this.searchQuery))}constructor(e,t,s){this.vaultRepository=e,this.vaultOrganizationClient=t,this.sharingCollectionsClient=s,this.separator=",",this.collections=[],this.searchQuery="",this.normalizeString=e=>"string"!=typeof e?"":e.normalize("NFD").replace(/[\u0300-\u036f]/g,"").toLowerCase(),this.isVaultItemMatch=e=>{let t="";return this.collections.forEach((s=>{s.vaultItems.some((t=>t.id===e.id))&&(t+=`${s.name}${this.separator}`)})),this.isMatch(e,t)}}}v=(0,n.gn)([(0,d.e)(m.W),(0,n.w6)("design:type",Function),(0,n.w6)("design:paramtypes",[void 0===g.g?Object:g.g,void 0===h.C?Object:h.C,void 0===u.L?Object:u.L])],v);var y=s(88846),f=s(69885);class b{execute({body:e}){const{vaultItemTypes:t,searchQuery:s,pageSize:n,pageNumber:r,...i}=e;if(this.searchQuery=s,!s)return(0,f.of)((0,l.Vp)({items:[],matchCount:0}));const{queries:{queryCollections:d}}=this.vaultOrganizationClient,{queries:{sharedCollectionsWithItems:u}}=this.sharingCollectionsClient;return(0,a.a)([d({}),u()]).pipe((0,o.w)((([e,s])=>{if((0,l.hx)(e)||(0,l.hx)(s))throw new Error("Error querying collections");this.collections=e.data.collections.concat(s.data);const n=t??Object.values(p.U);return this.vaultRepository.fetchVaultItems$({vaultItemTypes:n,...i})})),(0,c.U)((e=>{if((0,l.hx)(e))throw new Error("Error");const t=e.data,s=[],i={collectionsResult:{items:this.collections,matchCount:this.collections.length},...t};Object.keys(i).forEach((e=>{const t=e;i[t].items.forEach((e=>{const n=this.getPrimarySearchFields(t),r=this.getSecondarySearchFields(t),i=this.searchStartsWith(e,this.searchQuery,n),a=i||this.searchStartsWith(e,this.searchQuery,r),o=!(!i&&!a)||this.searchContains(e,this.searchQuery,n),c=!!(i||a||o)||this.searchContains(e,this.searchQuery,r),d=this.calculatePriority(i,o,a,c,t);d&&s.push({item:e,priority:d})}))}),[]);const a=s.length;let o=s.sort(((e,t)=>Number(t.priority)-Number(e.priority))).map((({item:e})=>e));return n&&r&&(o=o.slice(n*(r-1),n*r)),(0,l.Vp)({items:o,matchCount:a})})))}constructor(e,t,s){this.vaultRepository=e,this.vaultOrganizationClient=t,this.sharingCollectionsClient=s,this.collections=[],this.searchQuery="",this.getPrimarySearchFields=e=>{switch(e){case"addressesResult":case"credentialsResult":case"emailsResult":case"passkeysResult":case"paymentCardsResult":case"phonesResult":case"websitesResult":return["itemName"];case"bankAccountsResult":return["accountName"];case"companiesResult":return["companyName"];case"driversLicensesResult":case"idCardsResult":case"passportsResult":case"socialSecurityIdsResult":return["idName"];case"fiscalIdsResult":return["fiscalNumber"];case"identitiesResult":return["fullName"];case"secretsResult":case"secureNotesResult":return["title"];case"collectionsResult":return["name"];default:return[]}},this.getSecondarySearchFields=e=>{switch(e){case"addressesResult":return["building","city","door","floor","streetName","zipCode"];case"bankAccountsResult":return["ownerName","bankCode"];case"companiesResult":return["jobTitle"];case"credentialsResult":return["email","username","URL","linkedURLs","note","alternativeUsername"];case"driversLicensesResult":case"fiscalIdsResult":case"idCardsResult":case"collectionsResult":default:return[];case"emailsResult":return["emailAddress"];case"identitiesResult":return["firstName","middleName","lastName","pseudo"];case"passkeysResult":return["userDisplayName","rpName","note"];case"passportsResult":case"socialSecurityIdsResult":return["idNumber"];case"paymentCardsResult":return["ownerName","note","cardNumber"];case"phonesResult":return["phoneNumber"];case"secretsResult":case"secureNotesResult":return["content"];case"websitesResult":return["URL"]}},this.getItemTypePriority=e=>{switch(e){case"passkeysResult":return"01";case"phonesResult":return"02";case"websitesResult":return"03";case"identitiesResult":return"04";case"emailsResult":return"05";case"companiesResult":return"06";case"addressesResult":return"07";case"socialSecurityIdsResult":return"08";case"passportsResult":return"09";case"idCardsResult":return"10";case"fiscalIdsResult":return"11";case"driversLicensesResult":return"12";case"paymentCardsResult":return"13";case"bankAccountsResult":return"14";case"collectionsResult":return"15";case"secretsResult":return"16";case"secureNotesResult":return"17";case"credentialsResult":return"18";default:return"00"}},this.calculatePriority=(e,t,s,n,r)=>e||t||s||n?`${Number(e)}${Number(t)}${Number(s)}${Number(n)}${this.getItemTypePriority(r)}`:null,this.normalizeString=e=>"string"!=typeof e?"":e.normalize("NFD").replace(/[\u0300-\u036f]/g,"").toLowerCase(),this.searchStartsWith=(e,t,s)=>{for(const n of s){if(this.normalizeString(e[n]?.toString()??"").startsWith(this.normalizeString(t)))return!0}return!1},this.searchContains=(e,t,s)=>{let n="";for(const t of s){const s=e[t];n+=this.normalizeString(s?.toString()??"")}return n.includes(this.normalizeString(t))}}}b=(0,n.gn)([(0,d.e)(y.$),(0,n.w6)("design:type",Function),(0,n.w6)("design:paramtypes",[void 0===g.g?Object:g.g,void 0===h.C?Object:h.C,void 0===u.L?Object:u.L])],b);class S{}S=(0,n.gn)([(0,r.Y)({api:i.R,handlers:{commands:{},events:{},queries:{search:v,vaultSearchRanked:b}},providers:[g.g]})],S)},57842:(e,t,s)=>{s.d(t,{z:()=>c});var n=s(75958),r=s(90717),i=s(41453),a=s(3090),o=s(19186);const c=(0,n.Q)({name:"vpnNotifications",commands:{markVpnProviderSeen:r.M,markInstallVpnSeen:i.b},events:{},queries:{hasSeenVpnProvider:a.D,hasSeenInstallVpn:o.w}})},41453:(e,t,s)=>{s.d(t,{b:()=>i});var n=s(13385),r=s(62149);class i extends((0,n.g)({scope:r.F.User})){}},90717:(e,t,s)=>{s.d(t,{M:()=>i});var n=s(13385),r=s(62149);class i extends((0,n.g)({scope:r.F.User})){}},19186:(e,t,s)=>{s.d(t,{w:()=>r});var n=s(77535);class r extends((0,n.k)()){}},3090:(e,t,s)=>{s.d(t,{D:()=>r});var n=s(77535);class r extends((0,n.k)()){}},19813:(e,t,s)=>{s.d(t,{u:()=>A});var n=s(92336),r=s(86006),i=s(57842),a=s(62149),o=s(63144),c=s(56618),d=s(60018),l=s(7165),u=function(e){return e.VpnProvider="vpnProvider",e.InstallVpn="installVpn",e}({});const p=l.z.object({notifications:l.z.record(l.z.nativeEnum(u),l.z.boolean())}),m=e=>p.safeParse(e).success;class h extends((0,o.Q)({storage:{schemaVersion:1,initialValue:{notifications:{vpnProvider:!1,installVpn:!1}},typeGuard:m},persist:!0,scope:a.F.User,storeName:"vpn-notifications-store",capacity:c.Y._010KB,codec:d.E})){}var g=s(82874),v=s(78346),y=s(90717);class f{async execute(){const e=await this.store.getState(),t={...e.notifications,vpnProvider:!0};return await this.store.set({...e,notifications:t}),(0,v.Vp)(void 0)}constructor(e){this.store=e}}f=(0,n.gn)([(0,g.W)(y.M),(0,n.w6)("design:type",Function),(0,n.w6)("design:paramtypes",[void 0===h?Object:h])],f);var b=s(41453);class S{async execute(){const e=await this.store.getState(),t={...e.notifications,installVpn:!0};return await this.store.set({...e,notifications:t}),(0,v.Vp)(void 0)}constructor(e){this.store=e}}S=(0,n.gn)([(0,g.W)(b.b),(0,n.w6)("design:type",Function),(0,n.w6)("design:paramtypes",[void 0===h?Object:h])],S);var w=s(87065),E=s(46449),_=s(3090);class C{execute(){return this.store.state$.pipe((0,w.U)((e=>(0,v.Vp)(!!e.notifications.vpnProvider))))}constructor(e){this.store=e}}C=(0,n.gn)([(0,E.e)(_.D),(0,n.w6)("design:type",Function),(0,n.w6)("design:paramtypes",[void 0===h?Object:h])],C);var I=s(19186);class T{execute(){return this.store.state$.pipe((0,w.U)((e=>(0,v.Vp)(!!e.notifications.installVpn))))}constructor(e){this.store=e}}T=(0,n.gn)([(0,E.e)(I.w),(0,n.w6)("design:type",Function),(0,n.w6)("design:paramtypes",[void 0===h?Object:h])],T);class A{}A=(0,n.gn)([(0,r.Y)({api:i.z,stores:[h],handlers:{commands:{markVpnProviderSeen:f,markInstallVpnSeen:S},events:{},queries:{hasSeenVpnProvider:C,hasSeenInstallVpn:T}}})],A)},15295:(e,t,s)=>{s.d(t,{d:()=>r});var n=s(86433);class r{addExternalComponentReadyCondition(e){this.externalComponentReadyConditions.push(e)}addAppReadyHook(e){this.appReadyHooks.push(e)}addShutdownHook(e){this.shutdownHooks.push(e)}removeShutdownHook(e){const t=this.shutdownHooks.indexOf(e);t>=0&&this.shutdownHooks.splice(t,1)}startup(e){const t=this.waitAndTriggerAppReady(e);if(!this.externalComponentReadyConditions.length)return t;this.addShutdownHook((async()=>await t))}async shutDown(){for(;this.shutdownHooks.length>0;){const e=this.shutdownHooks.pop();e&&await e()}}async waitAndTriggerAppReady(e){this.logger?.debug("Waiting for external components before running startup hooks");(await Promise.allSettled(this.externalComponentReadyConditions.map((e=>e())))).forEach((t=>{if("rejected"!==t.status)return;const s=t.reason,r=new Error("Failed to init external component",{cause:s});this.logger?.error(`${r.message}`,{cause:s}),e?.captureException(r,{origin:"exceptionBoundary",domainName:"framework",moduleName:"kernel"},n.T.CRITICAL)})),this.logger?.debug(" Done waiting for external components before running startup hooks"),await this.executeStartupHooks(this.appReadyHooks,e)}async executeStartupHooks(e,t){let s=1;for(;e.length>0;){const r=e.shift();if(r){this.logger?.debug(`Executing startup hook ${s}`);try{const e=await r();e&&this.addShutdownHook(e),this.logger?.debug(`Done executing startup hook ${s}`),s++}catch(e){const s=new Error("Failed executing startup hook",{cause:e});this.logger?.error(`${s.message}`,{cause:e}),t?.captureException(s,{origin:"exceptionBoundary",domainName:"framework",moduleName:"kernel"},n.T.CRITICAL)}}}}constructor(e){this.logger=e,this.shutdownHooks=[],this.externalComponentReadyConditions=[],this.appReadyHooks=[]}}},75354:(e,t,s)=>{s.d(t,{O:()=>c,r:()=>d});var n=s(60399),r=s(41842),i=s(58376),a=s(24966),o=s(87065);class c{async waitTimeout(e){await(0,n.z)(this.createObservableTimer(e,e))}}class d extends c{fireTimer(e=1){this.time+=e,[...this.subscribers$.value].forEach((e=>{e.next(this.time)}))}async allSubscribersDisconnected(){await(0,n.z)(this.pendingTimerCount$.pipe((0,r.h)((e=>!e))))}createObservableTimer(){return new i.y((e=>(this.subscribers$.next(new Set([...this.subscribers$.value,e])),()=>{this.subscribers$.next(new Set([...this.subscribers$.value].filter((t=>t!==e))))})))}constructor(...e){super(...e),this.subscribers$=new a.X(new Set),this.time=0,this.pendingTimerCount$=this.subscribers$.pipe((0,o.U)((e=>e.size)))}}},52357:(e,t,s)=>{s.d(t,{t:()=>i,u:()=>a});var n=s(66335),r=s(38430);const i=(e,t)=>(()=>{const e=t=>({define:()=>t,with:s=>{const n={api:s.module,main:s.on,queryOnly:s.queryOnly??[]},r={[s.module.name]:n};return e({...t,...r})}});return e({})})().with({module:n.t$,on:e}).with({module:r.P,on:e}),a=i("node")},46096:(e,t,s)=>{s.d(t,{b:()=>L});var n=s(40284),r=s(93223),i=s(53932),a=s(59590),o=s(40443),c=s(41718),d=s(15295),l=s(59788),u=s(92336),p=s(76301),m=s(6178),h=s(33530),g=s(62149),v=s(56742),y=s(16712),f=s(4373);class b{async execute(e){const t=n.ContextIdFactory.getByRequest(e),{type:s}=e;if(!(e.module in this.introspection.modules))throw new Error("Unknown module "+e.module);const r=this.introspection.modules[e.module],i=r.api??h.w,a=r.handlers??f.TB;switch(s){case m.Y.Query:{const{queries:s}=i;if(e.name in s){const n=new(0,s[e.name])(e.body),r=a.queries[e.name];return{result:(await this.moduleRef.resolve(r,t,{strict:!1})).execute(n,{name:e.name})}}throw new Error("Unknown query "+e.name)}case m.Y.Command:{const{commands:s}=i;if(e.name in s){const n=new(0,s[e.name])(e.body),r=a.commands[e.name],i=await this.moduleRef.resolve(r,t,{strict:!1});return{result:await i.execute(n,{name:e.name})}}throw new Error("Unknown command "+e.name)}case m.Y.Event:{const{events:s}=i;if(e.name in s){const n=new(0,s[e.name])(e.body),r=Object.values(this.introspection.modules).flatMap((t=>(t.handlers??f.TB).events[e.module]?.events[e.name])),i=await Promise.all(r.filter((e=>this.introspection.supportedEventHandlers.has(e))).map((async e=>await this.moduleRef.resolve(e,t,{strict:!1}))));return void await Promise.all(i.map((e=>e.handle(n))))}throw new Error("Unknown event "+e.name)}case m.Y.Cron:{const s=(r.crons??[]).find((t=>t.name===e.name));if(!s)throw new Error("unknown cron "+e.name);if(s.scope===g.F.User){if(!e.context.getOrFail(y.l.UserName,{errorMessage:`Expected ${y.l.UserName} to be set in the request context`}))return{result:!1}}const n=await this.moduleRef.resolve(s.handler,t,{strict:!1});return n.isRunnable&&!await n.isRunnable()?{result:!1}:(await n.run(),{result:!0})}}return(0,v.U)(s)}constructor(e,t){this.introspection=e,this.moduleRef=t}}(0,u.gn)([(0,p.All)(),(0,u.fM)(0,(0,p.Req)()),(0,u.w6)("design:type",Function),(0,u.w6)("design:paramtypes",["undefined"==typeof ApplicationRequest?Object:ApplicationRequest]),(0,u.w6)("design:returntype",Promise)],b.prototype,"execute",null),b=(0,u.gn)([(0,p.Controller)({scope:p.Scope.REQUEST,durable:!1}),(0,u.w6)("design:type",Function),(0,u.w6)("design:paramtypes",[void 0===f.Q1?Object:f.Q1,void 0===n.ModuleRef?Object:n.ModuleRef])],b);var S=s(75354),w=s(2198),E=s(96812),_=s(77931),C=s(94691),I=s(60018),T=s(50423),A=s(63419),U=s(7712);class N{catch(e,t){t.switchToHttp().getResponse().fail(e)}}N=(0,u.gn)([(0,p.Catch)(Error)],N);const O={provide:y.f,scope:p.Scope.REQUEST,inject:[n.REQUEST],useFactory:e=>(()=>{switch(e.type){case m.Y.Command:case m.Y.Event:case m.Y.Query:case m.Y.Cron:case m.Y.Init:return e.context;default:(0,v.U)(e)}})()};var D=s(82194),F=s(60785),P=s(39690),R=s(23337),x=s(25085);class L{static addGlobalNestInterceptor(e){this.globalInterceptors.push(e)}static create({brokers:e,configProviders:t,keyValueStorageInfrastructure:s,managedStorageInfrastructure:u,lifeCycle:p,logger:m,modules:h,nodeConfiguration:g,storeInfrastructureFactory:v,timers:k,jsonFetcher:j,defaultDeviceStorageEncryptionCodecProvider:M,defaultUserStorageEncryptionCodecProvider:z,storeList:V,interceptors:B,introspection:K,moduleClientsProviders:G,userUseCaseScopeProvider:$,queriesCache:q}){return{module:L,providers:[{provide:F.QI,useValue:s},{provide:F.Rx,useValue:u},{provide:d.d,useValue:p},{provide:o.$,useValue:g},{provide:r.d,useValue:e.cqrs},{provide:P.z,useValue:q},{provide:a.a,useValue:e.event},{provide:R.X,useValue:j},i.w,i.m,...t,{provide:l.V,useValue:m},O,{provide:c.G,useValue:v},{provide:S.O,useValue:k},w.u1,{provide:x.u,useValue:new x.u(s)},_.z,M,z,C.b,I.E,{provide:f.Q1,useValue:K},{provide:U.D,useValue:V},A.X,T.J,{provide:n.APP_FILTER,useClass:N},...[...this.globalInterceptors,...B].flatMap((e=>[{provide:n.APP_INTERCEPTOR,useClass:e},e])),...G,$],imports:[...h],exports:[d.d,o.$,r.d,a.a,P.z,i.w,i.m,...t.map((({provide:e})=>e)),l.V,y.f,c.G,S.O,w.u1,_.z,E.h,E.s,C.b,I.E,x.u,F.QI,F.Rx,R.X,A.X,T.J,f.Q1,...G.map((({provide:e})=>e)),D.g],controllers:[b],global:!0}}}L.globalInterceptors=[]},6178:(e,t,s)=>{s.d(t,{Y:()=>a});var n=s(93308),r=s(10894),i=s(16712),a=function(e){return e.Command="command",e.Query="query",e.Event="event",e.Init="init",e.Cron="cron",e}({});const o=n.ContextIdFactory.create();(new i.f).withValue(i.l.UseCaseId,String(o.id)),r.REQUEST_CONTEXT_ID},46044:(e,t,s)=>{s.d(t,{u:()=>Oe,W:()=>De});var n=s(38430),r=s(66335),i=s(60018),a=s(6136),o=s(41842),c=s(60399),d=s(40284),l=s(93308),u=s(7303);var p=s(46096),m=s(76301),h=s(10894),g=s(78346),v=s(56742),y=s(17350),f=s(162),b=s(74081),S=s(24966),w=s(6178),E=s(16712);const _=()=>{},C=()=>{throw new Error("Not supported")};class I{isHeadersSent(){return!1}setAppInstance(e){this.app=e}bindHandler(e){if(this.cqrsCallbacks||this.eventCallbacks)throw new Error("Handler already registered");this.cqrsCallbacks={onCommand:(t,s,n,r)=>new Promise(((i,a)=>{const o=this.initRequest({type:w.Y.Command,module:t,name:s,body:n,context:r}),c={type:w.Y.Command,value:{result:(0,g.Vp)(void 0)},reply:i,fail:a};e(o,c)})),onQuery:(t,s,n,r)=>{const i=new Promise(((i,a)=>{const o=this.initRequest({type:w.Y.Query,module:t,name:s,body:n,context:r}),c={type:w.Y.Query,value:{result:y.E},reply:i,fail:a};e(o,c)}));return(0,f.D)(i).pipe((0,b.J)())}},this.eventCallbacks={onLocalEvent:(t,s,n,r,i)=>new Promise(((s,a)=>{const o=this.initRequest({type:w.Y.Event,body:r,context:i,name:n,module:t}),c={type:w.Y.Event,reply:s,fail:a};e(o,c)}))},this.cronCallbacks=(t,s)=>new Promise(((n,r)=>{const i=(new E.f).withValue(E.l.UseCaseId,String(l.ContextIdFactory.create().id)),a=this.initRequest({type:w.Y.Cron,context:i,module:t,name:s}),o={type:w.Y.Cron,value:{result:!1},reply:n,fail:r};e(a,o)}))}all(e,t){if(!t)throw new Error("Provide a handler");return this.bindHandler(t)}async listen(){if(!this.cqrsCallbacks||!this.eventCallbacks||!this.cronCallbacks)throw new Error("Please call `all(path, handler)` first");const e=await this.cqrsBroker.connect(this.cqrsCallbacks).start(),t=await this.eventsBroker.connect(this.eventCallbacks).start(),s=await this.cronsBroker.connect(this.cronCallbacks).start(),{isListening$:n}=this;this.disconnect=()=>{e.stop(),t.stop(),s.stop(),n.complete()},this.close=this.disconnect,this.isListening$.next(!0)}reply(e,t){switch(e.type){case w.Y.Query:case w.Y.Command:e.reply(t.result);break;case w.Y.Event:e.reply();break;case w.Y.Cron:e.reply(t.result);break;default:(0,v.U)(e)}}getInstance(){return this}getHttpServer(){return{once:_,address:()=>"",removeListener:_}}getType(){return"AppCoreNode"}initRequest(e){const{context:t}=e,s=Number.parseInt(t.getOrFail(E.l.UseCaseId),10);if(Number.isNaN(s))throw new Error("Unexpected contextId format. Not a number.");const n={id:s},r={...e,[h.REQUEST_CONTEXT_ID]:n};if(!this.app)throw new Error("Unexpected null app");return this.app.registerRequestByContextId(r,n),r}constructor(e,t,s){this.cqrsBroker=e,this.eventsBroker=t,this.cronsBroker=s,this.isListening$=new S.X(!1),this.use=C,this.get=C,this.post=C,this.head=C,this.delete=C,this.put=C,this.options=C,this.patch=C,this.end=C,this.applyVersionFilter=C,this.disconnect=_,this.close=_,this.status=C,this.render=C,this.redirect=C,this.setHeader=C,this.enableCors=C,this.initHttpServer=C,this.registerParserMiddleware=C,this.createMiddlewareFactory=C}}const T=()=>{};class A extends d.AbstractHttpAdapter{setAppInstance(e){this.getInstance().setAppInstance(e)}initHttpServer(){this.setHttpServer({once:T,address:()=>"",removeListener:T})}getRequestMethod(){return m.RequestMethod.ALL}getRequestUrl(){return"/"}getType(){return"CoreApp"}isHeadersSent(){return!1}applyVersionFilter(){throw new Error("Versioning not supported")}constructor(e,t,s){super(new I(e,t,s)),this.createMiddlewareFactory=this.instance.createMiddlewareFactory,this.close=this.instance.close,this.reply=this.instance.reply,this.useStaticAssets=T,this.setViewEngine=T,this.getRequestHostname=T,this.status=T,this.render=T,this.redirect=T,this.setNotFoundHandler=T,this.setHeader=T,this.registerParserMiddleware=T,this.enableCors=T,this.setErrorHandler=T,this.end=T,this.getHeader=T,this.appendHeader=T,this.isListening$=this.instance.isListening$}}var U=s(15295),N=s(59590),O=s(93223),D=s(93787),F=s(68860),P=s(96031),R=s(4373);const x=(e,t)=>t.reduce(((t,s)=>{const n=Reflect.getMetadata(P.o,s.module);if(!(0,R.Vy)(n))return t;const r=n.api?.name??n.sharedModuleName??"unnamed";if(n.onFrameworkInit){const e=e=>({moduleName:r,initClass:e});n.onFrameworkInit instanceof Array?t.onFrameworkInits=t.onFrameworkInits.concat(n.onFrameworkInit.map(e)):t.onFrameworkInits.push(e(n.onFrameworkInit))}return t.configProviders.push(...function(e,t,s,n){if(!s.configurations)return[];const{configurations:r}=s,i=[];return Object.keys(r).forEach((e=>{const s=r[e].token,a=n.configurations?.[e];if(!a)throw new Error(`Missing '${e}' configuration for '${t}' module`);i.push({...a,provide:s})})),Object.keys(n.configurations??{}).forEach((n=>{s.configurations?.[n]||e.error(`Unknown '${n}' configuration for '${t}' module will be unused`)})),i}(e,r,n,s)),n.api?.name&&t.modulesMetadata.set(n.api.name,n),t.modules.push(s.module),n.crons&&t.crons.push(...n.crons.map((e=>({...e,moduleName:r})))),n.handlers?.events&&t.eventHandlers.push(...Object.values(n.handlers.events).flatMap((e=>Object.values(e.events)))),n.stores&&t.stores.push(...n.stores),t.allDeclarations[r]=n,t}),{configProviders:new Array,modules:new Array,modulesMetadata:new Map,onFrameworkInits:new Array,crons:new Array,eventHandlers:new Array,stores:new Array,allDeclarations:(0,u.Ay)({})});var L=s(96812),k=s(79386),j=s(41718),M=s(31857),z=s(24748),V=s(86433);function B(e){const{parameterProvider:t,token:s}=e;switch(t.type){case z.j.CLASS_PROVIDER:return{provide:s,useClass:t.useClass};case z.j.VALUE_PROVIDER:return{provide:s,useValue:t.useValue};default:(0,v.U)(t)}}var K=s(7712),G=s(55385),$=s(91743),q=s(15160);let H=class extends q.i{process(e){return Promise.resolve(Object.keys(e).reduce(((e,t)=>(e[t]=!1,e)),{}))}};const W=(0,$.z)(new H);var Q=s(72609),Y=s(92336),X=s(43978),Z=s(69885),J=s(25313),ee=s(82567),te=s(87065),se=s(62149),ne=s(53932),re=s(40443);const ie={tag:""};class ae{intercept(e,t){const s=e.switchToHttp().getRequest(),{appDefinition:n}=this.config;if(s.type===w.Y.Cron)return this.checkCronActiveUser(t,s);if(!(s.module in n))return t.handle();const r=n[s.module].api;switch(s.type){case w.Y.Query:return this.checkQueryActiveUser(t,s,r);case w.Y.Command:return this.checkCommandActiveUser(t,s,r);case w.Y.Event:return this.checkEventActiveUser(t,s,r);default:(0,v.U)(s)}}checkCronActiveUser(e,t){const s=(this.introspection.modules[t.module].crons??[]).find((e=>e.name===t.name));if(!s)throw new Error("No such cron "+t.name);return s.scope===se.F.Device?e.handle():this.checkActiveUserPromise(e,t.context,{noUserError:ie,scope:se.F.User},"Cron")}checkQueryActiveUser(e,t,s){const{queries:n}=s;if(t.name in n){const s=n[t.name],{metadata:r}=s;return this.checkActiveUserObservable(e,t.context,r,`Query ${t.module}.${t.name}`)}return e.handle()}checkCommandActiveUser(e,t,s){const{commands:n}=s;if(t.name in n){const s=n[t.name],{metadata:r}=s;return this.checkActiveUserPromise(e,t.context,r,`Command ${t.module}.${t.name}`)}return e.handle()}checkEventActiveUser(e,t,s){const{events:n}=s;if(t.name in n){const s=n[t.name],{metadata:r}=s;return this.checkActiveUserPromise(e,t.context,r,`Event ${t.module}.${t.name}`)}return e.handle()}checkActiveUserPromise(e,t,s,n){if(s.scope!==se.F.User)return e.handle();const{noUserError:r}=s;return(0,f.D)(t.getOrAdd(E.l.UserName,(()=>this.queryUserName()))).pipe((0,X.w)((t=>{if(t)return e.handle();if(r)return(0,Z.of)({result:(0,g.Rn)(r)});throw new Error(`Not logged in : ${n}`)})))}checkActiveUserObservable(e,t,s,n){if(s.scope!==se.F.User)return e.handle();const{noUserError:r}=s;return(0,Z.of)({result:r?this.createResultObservable(e,t,(()=>new S.X((0,g.Rn)(r)))):this.createResultObservable(e,t,(()=>(0,J._)((()=>new Error(`Not logged in : ${n}`)))))})}createResultObservable(e,t,s){return this.queryUserName$().pipe((0,ee.b)((e=>{t.set(E.l.UserName,e)})),(0,X.w)((t=>t?e.handle().pipe((0,X.w)((({result:e})=>e))):s())))}queryUserName$(){return this.clients.getClient(r.t$).queries.activeUser().pipe((0,te.U)((e=>{if((0,g.d6)(e)&&(0,g.db)(e).userName)return e.data.userName})))}queryUserName(){return(0,c.z)(this.queryUserName$())}constructor(e,t,s){this.clients=e,this.config=t,this.introspection=s}}ae=(0,Y.gn)([(0,m.Injectable)(),(0,Y.w6)("design:type",Function),(0,Y.w6)("design:paramtypes",[void 0===ne.m?Object:ne.m,void 0===re.$?Object:re.$,void 0===R.Q1?Object:R.Q1])],ae);class oe{async setState(e){await this.storage.set(this.storageKey,JSON.stringify(e))}async getState(){const e=await this.storage.get(this.storageKey);if(!e)return{entries:[]};const t=JSON.parse(e);return(s=t)&&"object"==typeof s&&"entries"in s&&Array.isArray(s.entries)&&s.entries.every((e=>function(e){return!!e&&"object"==typeof e&&"dueTimestamp"in e&&"moduleName"in e&&"name"in e&&"string"==typeof e.name&&"string"==typeof e.moduleName&&"number"==typeof e.dueTimestamp}(e)))?t:{entries:[]};var s}constructor(e,t){this.storage=e,this.storageKey=`crons.${t}`}}var ce=s(34987);const de=6e4;function le(e){return Math.ceil(e/de)*de}function ue(e){return Math.floor(e/de)*de}class pe{async init(){const e=le(this.infra.timers.time),t=await this.infra.repository.getState(),s=this.definitions.filter((e=>!t.entries.find((t=>t.name===e.name&&t.moduleName===e.moduleName)))),n={entries:[...t.entries.filter((e=>this.definitions.find((t=>t.name===e.name&&t.moduleName===e.moduleName)))),...s.map((t=>({...t,dueTimestamp:e+t.periodInMinutes*de})))]};await this.infra.repository.setState(n)}connect(e){const{infra:t,definitions:s}=this;return{start:async()=>{await this.init();const n=t.cronSource.alarm$.pipe((0,ce.b)((async()=>{const n=await t.repository.getState(),r=le(t.timers.time),i=ue(t.timers.time),a=n.entries.filter((e=>e.dueTimestamp<=r));await Promise.allSettled(a.map((r=>{const a=s.find((e=>e.moduleName===r.moduleName&&e.name===r.name));if(!a)throw new Error("we should have a declaration");return async function(s,n,r,i){let a=!1;try{a=await e(r.moduleName,r.name)}finally{a&&(r.dueTimestamp=ue(s+i.periodInMinutes*de),await t.repository.setState(n))}}(i,n,r,a)})))}))).subscribe();return{stop:()=>{n.unsubscribe()}}}}}constructor(e,t){this.infra=e,this.definitions=t}}var me=s(79578);class he{intercept(e,t){return this.useCaseStacktraceRepo.append(this.request.name),t.handle()}constructor(e,t){this.request=e,this.useCaseStacktraceRepo=t}}he=(0,Y.gn)([(0,m.Injectable)({scope:m.Scope.REQUEST}),(0,Y.fM)(0,(0,m.Inject)(d.REQUEST)),(0,Y.w6)("design:type",Function),(0,Y.w6)("design:paramtypes",[Object,void 0===me.FT?Object:me.FT])],he);var ge=s(92587);let ve=class{get commands(){return this.client.commands}get queries(){return this.client.queries}constructor(e,t){this.client=e.getClient(t)}};var ye=s(96498),fe=s(82194),be=s(58881);let Se;function we(e){return function(e){return"module"in e}(e)?e:{module:e}}var Ee=s(9363),_e=s(76435),Ce=s(59788),Ie=s(95461),Te=s(67499),Ae=s(57934),Ue=s(73656);const Ne=[he,ae],Oe=async({appDefinition:e,channels:t,currentNode:s,implementations:m,otherModules:g=[],storeInfrastructureFactory:v=new j.N,channelsListener:y=Ae.y,timers:f=new F.m,keyValueStorageInfrastructure:b=new k.s,managedStorageInfrastructure:S=new k.I,logger:_=Ce.V.create({container:"framework",module:"kernel",domain:"framework",infra:b}),externalLoggers:C=[],jsonFetcher:I=new F.k,cronSource:T=new M._C(f),defaultDeviceStorageEncryptionCodec:P={type:z.j.CLASS_PROVIDER,useClass:i.E},defaultUserStorageEncryptionCodec:H={type:z.j.CLASS_PROVIDER,useClass:i.E},exceptionLogging:Y=Q.I,diagnosticsLogProcessor:X=W})=>{try{_.debug("Starting application node");const i=()=>{throw _.error("Unexpected call to process.abort"),new Error("Aborted")};Ue.abort=i;const F=()=>{throw _.error("Unexpected call to process.exit"),new Error("Exited")};Ue.exit=F;const k={...e,[n.P.name]:{api:n.P,main:s,queryOnly:[]},[r.t$.name]:{api:r.t$,main:s,queryOnly:[]}},j=[...[_e.q,G.G.configure(Y),Ie.y.configure({externalDiagnosticsLogsSources:(0,$.z)(new q.U([_.diagnostics.getLogsStream$(),...C.map((e=>e.diagnostics.getLogsStream$()))])),processorAdapter:X})],...g,...Object.keys(m).map((e=>e)).map((e=>m[e]))].map(we),{configProviders:M,modules:z,modulesMetadata:W,onFrameworkInits:Q,crons:Z,eventHandlers:J,stores:ee,allDeclarations:te}=x(_,j),se=new K.D;ee.forEach((e=>{se.registerClass(e)})),((e,t,s)=>{const n=new Set([...s.keys()]),r=new Set(Object.values(e).filter((e=>e.main===t||e.queryOnly.includes(t))).map((e=>e.api.name))),i=[...r].filter((e=>!n.has(e))),a=[...n].filter((e=>!r.has(e)));i.length>0&&console.error("These APIs are not implemented ",JSON.stringify(i)),a.length>0&&console.error("Some implementations do not have APIS",JSON.stringify(a))})(k,s,W);const ie=(e=>[...e.entries()].reduce(((e,[t,s])=>{const n=s.handlers?.events??{};return e[t]=Object.values(n).reduce(((e,t)=>t.name?(e[t.name]=Object.keys(t.events),e):e),(0,u.Ay)({})),e}),(0,u.Ay)({})))(W),ae=new re.$({appDefinition:k,channels:t,channelsListener:y,currentNode:s,subscriptions:ie}),ce=new O.d(ae),de=new N.a(ae),le=new pe({cronSource:T,repository:new oe(b,s),timers:f},Z),ue=new A(ce,de,le),me=B({token:L.h,parameterProvider:P}),he=B({token:L.s,parameterProvider:H}),Ae=new U.d(_),Oe=new R.Q1(new Set(J),te),De=function(e){const t=[];return Object.values(e).forEach((e=>{const{api:s}=e,{ClientClass:n}=s;n&&((0,ge.GS)()(n),t.push({provide:n,useFactory:e=>new ve(e,s),inject:[ne.w]}))})),t}(k),Fe={useFactory:(e,t,s)=>{const n=e.get(E.l.UserName);if(n)return Se&&Se.status!==be.p.Closed||(Se=new fe.g(n,s,t)),Promise.resolve(Se)},provide:fe.g,inject:[E.f,ye.Q,U.d]},Pe=new Te.v(Ae),Re=new ne.m(ae,ce,Pe);Ae.addAppReadyHook((()=>{const e=Re.getClient(r.t$).queries.activeUser().pipe((0,a.x)()).subscribe((()=>{Pe.clearUserCache()}));return()=>e.unsubscribe()}));const xe=p.b.create({nodeConfiguration:ae,brokers:{cqrs:ce,event:de},modules:z,configProviders:M,logger:_,lifeCycle:Ae,storeInfrastructureFactory:v,timers:f,keyValueStorageInfrastructure:b,managedStorageInfrastructure:S,jsonFetcher:I,defaultDeviceStorageEncryptionCodecProvider:me,defaultUserStorageEncryptionCodecProvider:he,storeList:se,interceptors:Ne,introspection:Oe,moduleClientsProviders:De,userUseCaseScopeProvider:Fe,queriesCache:Pe});_.debug("Creating NestApplication");const Le=await d.NestFactory.create(xe,ue,{logger:Ce.V.create({domain:"framework",container:"framework",module:"nest",infra:b})});ue.setAppInstance(Le),_.debug("Initializing NestApplication");const ke=await Le.init(),je=await ke.resolve(Ee.v);try{await async function(e,t,s,n){n.debug(" Run modules initialization handlers...");const r=Object.freeze({id:-1}),i=e.map((async({moduleName:e,initClass:i})=>{try{n.debug(`Running module initialization handler ${e}`);const s={type:w.Y.Init,[h.REQUEST_CONTEXT_ID]:r,module:e,name:"init",context:(new E.f).withValue(E.l.UseCaseId,String(r.id))};t.registerRequestByContextId(s,r);const a=await t.resolve(i,r,{strict:!1});await a.onFrameworkInit(),n.debug(`Done running module initialization handler ${e}`)}catch(t){const r=new Error(`Failed running module initialization handler ${e}`,{cause:t});n.debug(` ${r.message}`,{cause:t}),s.captureException(r,{origin:"exceptionBoundary",moduleName:"kernel",domainName:"framework"},V.T.CRITICAL)}}));await Promise.all(i),n.debug("Done running modules initialization handlers")}(Q,ke,je,_),_.debug("Start CQRS, event & CRON brokers"),Le.listen("");const e=ue.isListening$.pipe((0,o.h)((e=>!!e)));await(0,c.z)(e),Ae.addShutdownHook((()=>Le.close())),await Ae.startup(je)}catch(e){throw je.captureException(e,{origin:"exceptionBoundary",domainName:"framework",moduleName:"kernel"},V.T.CRITICAL),e}return{stop:()=>Ae.shutDown(),createClient:()=>(0,D.R)(s,k,ce,Pe),sendEvent:(e,t,s,n)=>{const r=n??(new E.f).withValue(E.l.UseCaseId,String(l.ContextIdFactory.create().id));return de.publishEvent(e,t,s,r)}}}catch(e){throw _.error("Exception when starting application node",{error:e}),e}},De=e=>Oe({...e,appDefinition:e.appDefinition,channels:{},currentNode:"node"})},93223:(e,t,s)=>{s.d(t,{d:()=>g});var n=s(162),r=s(60399),i=s(41842),a=s(87065),o=s(17350),c=s(56742),d=s(7303);const l=e=>"response"===e.type,u=(e,t,s,n)=>Object.keys(e).reduce(((r,i)=>{const{commandMailbox:a,queryMailbox:o}=(r=>{const{main:i,queryOnly:a}=e[r],o={type:"local",onMessage:n};if(i===t)return{commandMailbox:o,queryMailbox:o};const c={type:"remote",channel:s[i]};return{commandMailbox:c,queryMailbox:t&&a.includes(t)?o:c}})(i);return r[`command-${i}`]=a,r[`query-${i}`]=o,r}),(0,d.Ay)({}));var p=s(10826),m=s(16712);const h=()=>(0,n.D)([]);class g{async sendCommand(e,t,s,n){if(!this.broker)throw new Error("call connect() first");return await(0,r.z)(this.broker.sendMessage(`command-${e}`,{type:"command",module:e,commandName:String(t),command:s,context:n.toSerializable()}).pipe((0,i.h)(l),(0,a.U)((e=>e.response))))}sendQuery(e,t,s,n){if(!this.broker)throw new Error("call connect() first");return this.broker.sendMessage(`query-${e}`,{type:"query",module:e,queryName:String(t),query:s,context:n.toSerializable()}).pipe((0,i.h)(l),(0,a.U)((e=>e.response)))}connect(e){const t=e?(t,s,r)=>{switch(s.type){case"response":return o.E;case"command":return(0,n.D)(e.onCommand(s.module,s.commandName,s.command,m.f.fromSerializable(s.context),{isReminder:r.isReminder})).pipe((0,a.U)((e=>({type:"response",response:e}))));case"query":return(0,n.D)(e.onQuery(s.module,s.queryName,s.query,m.f.fromSerializable(s.context))).pipe((0,a.U)((e=>({type:"response",response:e}))))}(0,c.U)(s)}:h,s=u(this.config.appDefinition,this.config.currentNode,this.config.channels,t);return this.broker=new p.U(s),this.broker.connect(Object.values(this.config.channels),this.config.channelsListener)}constructor(e){this.config=e}}},53932:(e,t,s)=>{s.d(t,{m:()=>u,w:()=>l});var n=s(92336),r=s(92587),i=s(40443),a=s(93223),o=s(93787),c=s(16712),d=s(39690);class l{getClient(e){return(0,o.c)(this.configuration.currentNode,this.configuration.appDefinition,this.broker,e.name,this.queriesCache,this.context)}constructor(e,t,s,n){this.broker=e,this.configuration=t,this.context=s,this.queriesCache=n}}l=(0,n.gn)([(0,r.GS)(),(0,n.w6)("design:type",Function),(0,n.w6)("design:paramtypes",[void 0===a.d?Object:a.d,void 0===i.$?Object:i.$,void 0===c.f?Object:c.f,void 0===d.z?Object:d.z])],l);class u{getClient(e){return(0,o.c)(this.configuration.currentNode,this.configuration.appDefinition,this.broker,e.name,this.queriesCache)}constructor(e,t,s){this.configuration=e,this.broker=t,this.queriesCache=s}}u=(0,n.gn)([(0,r.GS)(),(0,n.w6)("design:type",Function),(0,n.w6)("design:paramtypes",[void 0===i.$?Object:i.$,void 0===a.d?Object:a.d,void 0===d.z?Object:d.z])],u)},93787:(e,t,s)=>{s.d(t,{R:()=>b,c:()=>f});var n=s(82567),r=s(37182),i=s(66189),a=s(69564),o=s(41842),c=s(25859),d=s(97280),l=s(10705),u=s(93308),p=s(78346),m=s(7303),h=s(16712),g=s(79578);const v=!1,y=!1;function f(e,t,s,f,b,S){return{commands:(()=>{const n=!y;return Object.keys(t[f].api.commands).reduce(((t,r)=>(t[r]=async t=>{const i=S??(new h.f).withValue(h.l.UseCaseId,String(u.ContextIdFactory.create().id));n&&console.debug(`[${e}] Sending ${f}.${r} command`,`(id: ${i.get(h.l.UseCaseId)})`,`(useCaseName: ${i.get(g.mH)})`);const a=await s.sendCommand(f,r,t,i);return n&&console.debug(`[${e}] Received ${f}.${r} command result`,`(id: ${i.get(h.l.UseCaseId)})`,`(useCaseName: ${i.get(g.mH)})`,`(success: ${(0,p.d6)(a)})`),a},t)),(0,m.Ay)({}))})(),queries:(()=>{const w=t[f].api.queries;return Object.keys(w).reduce(((m,E)=>(m[E]=m=>{function _(t,a=!y){a&&console.debug(`[${e}] Creating ${f}.${E} ${"carbonState"===E?JSON.stringify(m)+" ":""}observable query`,`(id: ${t.get(h.l.UseCaseId)})`,`(useCaseName: ${t.get(g.mH)})`);return s.sendQuery(f,E,m,t).pipe((0,n.b)((s=>{a&&console.debug(`[${e}] Received ${f}.${E} observable query value`,...["session.selectedOpenSession","vault-access.isAllowed","authentication-flow.authenticationFlowStatus"].includes(f)?[`(result: ${JSON.stringify(s)})`]:[],`(id: ${t.get(h.l.UseCaseId)})`,`(useCaseName: ${t.get(g.mH)})`,`(success: ${(0,p.d6)(s)})`)})),(0,r.K)((s=>{throw y||console.error(`[${e}] Exception during ${f}.${E} observable query`,`(id: ${t.get(h.l.UseCaseId)})`,`(useCaseName: ${t.get(g.mH)})`),s})),(0,i.x)((()=>{a&&console.debug(`[${e}] Completed ${f}.${E} observable query`,`(id: ${t.get(h.l.UseCaseId)})`,`(useCaseName: ${t.get(g.mH)})`)})))}const C=w[E].metadata.useCache??!1;let I;if(C&&b){I=b.for(t,f,E,m);const e=I.get();if(e){if(v){e.pipe((0,a.N)(_(S??(new h.f).withValue(h.l.UseCaseId,String(u.ContextIdFactory.create().id)),!1),l.Z),(0,o.h)((e=>!e)),(0,n.b)((()=>{const e=new Error(`Cache-enabled Observable Query ${f}#${E} is not idempotent`);throw console.error(`[query-caching-safeguard] Cache-enabled Query ${f}#${E} observable emitted a sequence of non-equivalent sequence of values between a new instance of the source observable.\nThis likely means this Observable Query is not idempotent & **must not be cached**!\nIf you see this message, please report it!\n`,e),e}))).subscribe()}return e}}const T=S??(new h.f).withValue(h.l.UseCaseId,String(u.ContextIdFactory.create().id));if(C&&I){const e=(0,c.P)((()=>_(T))).pipe((0,i.x)((()=>I?.invalidate())),(0,d.d)(1));return I.set(e),e}return _(T)},m)),(0,m.Ay)({}))})()}}function b(e,t,s,n){return Object.keys(t).map((e=>e)).reduce(((r,i)=>(r[i]=f(e,t,s,i,n),r)),{})}},13800:(e,t,s)=>{s.d(t,{C:()=>u,f:()=>l});var n=s(92336),r=s(76301),i=s(92587),a=s(3441),o=s(59590),c=s(16712),d=s(93308);class l{sendEvent(e,t){return this.broker.publishEvent(this.apiName,e,t,this.context)}constructor(e,t,s){this.apiName=e,this.broker=t,this.context=s}}l=(0,n.gn)([(0,i.GS)(),(0,n.fM)(0,(0,r.Inject)(a.r)),(0,n.w6)("design:type",Function),(0,n.w6)("design:paramtypes",[Object,void 0===o.a?Object:o.a,void 0===c.f?Object:c.f])],l);class u{sendEvent(e,t,s){const n=s??(new c.f).withValue(c.l.UseCaseId,String(d.ContextIdFactory.create().id));return this.broker.publishEvent(this.apiName,e,t,n)}constructor(e,t){this.apiName=e,this.broker=t}}u=(0,n.gn)([(0,i.GS)(),(0,n.fM)(0,(0,r.Inject)(a.r)),(0,n.w6)("design:type",Function),(0,n.w6)("design:paramtypes",[Object,void 0===o.a?Object:o.a])],u)},16575:(e,t,s)=>{s.d(t,{O:()=>a});var n=s(27149),r=s(60399),i=s(89618);async function a(e,t=1e4){if(!(0,n.b)(e))throw new Error("Error in getQueryValue: the argument is not an observable");try{return await(0,r.z)(e.pipe((0,i.V)({first:t})))}catch(e){throw new Error("Error in getQueryValue: "+e)}}},59590:(e,t,s)=>{s.d(t,{a:()=>b});var n=s(92336),r=s(162),i=s(87065),a=s(17350),o=s(69885),c=s(12768),d=s(86388),l=s(67069),u=s(19990),p=s(7303);const m={type:"ask"},h={type:"eventResponse"};var g=s(92587),v=s(40443),y=s(16712),f=s(10826);class b{async publishEvent(e,t,s,n){const{broker:r,eventToSubscriber:i}=this;if(!r)throw new Error("Not started");const a=(i[e].get(t)??[]).map((r=>({type:"event",context:n.toSerializable(),event:s,eventName:t,moduleSource:e,nodeDestination:r})));await Promise.all(a.map((async e=>{await r.trySendMessage(`event-${e.nodeDestination}`,e)})))}connect(e){const{configuration:t}=this,s=Object.keys(t.subscriptions).reduce(((e,s)=>{const n=t.subscriptions[s];return(0,c.Z)((0,d.Z)(l.Z,u.Z),e,n)}),(0,p.Ay)({})),n={type:"subscriptions",nodeName:t.currentNode,subscribesTo:s},g=((e,t)=>e.getNodeList().reduce(((s,n)=>(n===e.currentNode?s[`event-${n}`]={type:"local",onMessage:t}:s[`event-${n}`]={type:"remote",channel:e.channels[n]},s)),(0,p.Ay)({})))(this.configuration,((t,s,c)=>{switch(s.type){case"event":return(0,r.D)(e.onLocalEvent(s.moduleSource,s.nodeDestination,s.eventName,s.event,y.f.fromSerializable(s.context),c)).pipe((0,i.U)((()=>h)));case"eventResponse":return a.E;case"subscriptions":return this.subscriberToEvent[s.nodeName]=s.subscribesTo,this.eventToSubscriber=this.regenerateReverseSubscriptionMap(),(0,o.of)(h);case"ask":return(0,o.of)(n)}})),v=new f.U(g);return t.getNodeList().map((async e=>{await v.trySendMessage(`event-${e}`,n),await v.trySendMessage(`event-${e}`,m)})),this.broker=v,v.connect(Object.values(t.channels),t.channelsListener)}regenerateReverseSubscriptionMap(){const{configuration:e,subscriberToEvent:t}=this,s=e.getModuleNames().reduce(((e,t)=>({...e,[t]:new Map})),{});return e.getNodeList().reduce(((e,s)=>{const n=t[s];return Object.entries(n).forEach((([t,n])=>{if(!(t in e))throw new Error("A module depends on events from "+t+" but this one is not in the app def");const r=e[t];n.forEach((e=>{const t=[...r.get(e)??[],s];r.set(e,t)}))})),e}),s)}constructor(e){this.configuration=e;const t=Object.entries(e.appDefinition).reduce(((e,[t,s])=>(e[t]=Object.keys(s.api.events),e)),{});this.subscriberToEvent=this.configuration.getNodeList().reduce(((e,s)=>(e[s]={...t},e)),{}),this.eventToSubscriber=this.regenerateReverseSubscriptionMap()}}b=(0,n.gn)([(0,g.GS)(),(0,n.w6)("design:type",Function),(0,n.w6)("design:paramtypes",[void 0===v.$?Object:v.$])],b)},39690:(e,t,s)=>{s.d(t,{z:()=>n});class n{}},67499:(e,t,s)=>{s.d(t,{v:()=>a});var n=s(62149);class r{get(){const{cache:e,key:t}=this;if(e.has(t)){const s=e.get(t)?.deref();if(s)return s;e.delete(t)}return null}set(e){const{key:t}=this;this.cache.set(t,new WeakRef(e))}invalidate(){const{key:e}=this;this.cache.delete(e)}initCacheKey(){const{apiName:e,queryName:t,queryBody:s}=this;return`${e}#${t}#${JSON.stringify(s)}`}constructor(e,t,s,n){this.apiName=e,this.queryName=t,this.queryBody=s,this.cache=n,this.key=this.initCacheKey()}}var i=s(39690);class a extends i.z{for(e,t,s,i){const{scope:a}=e[t].api.queries[s].metadata,o=a===n.F.Device?this.deviceCache:this.userCache;return new r(t,s,i,o)}clearUserCache(){this.userCache.clear()}constructor(e){super(),this.lifeCycle=e,this.deviceCache=new Map,this.userCache=new Map,this.lifeCycle.addShutdownHook((()=>{this.deviceCache.clear(),this.userCache.clear()}))}}},36610:(e,t,s)=>{s.d(t,{j:()=>r});var n=s(25126);class r extends n.c{stop(){this.source.removeListener(this.listener)}internalListener(e,t){if(!this.filter(e,t))return!1;super.emit(e,t)}constructor({source:e,filter:t}){super(),this.source=e,this.filter=t,this.listener=this.internalListener.bind(this),this.source.addListener(this.listener)}}},25126:(e,t,s)=>{s.d(t,{c:()=>r});var n=s(58376);class r{emit(e,t){this.registeredSubscribers.size?this.registeredSubscribers.forEach((s=>s.next([e,t]))):this.queuedEvents.push([e,t])}constructor(){this.queuedEvents=[],this.registeredSubscribers=new Set,this.events$=new n.y((e=>(this.registeredSubscribers.size||(this.queuedEvents.forEach((t=>e.next(t))),this.queuedEvents=[]),this.registeredSubscribers.add(e),()=>{this.registeredSubscribers.delete(e)})))}}},82874:(e,t,s)=>{s.d(t,{W:()=>r});var n=s(92587);function r(e){const t=(0,n.GS)();return s=>{Reflect.defineMetadata("dl-handler",s,e),t(s)}}},2198:(e,t,s)=>{s.d(t,{Tx:()=>u,b2:()=>l,u1:()=>p});var n=s(92336),r=s(58376),i=s(6220),a=s(7074),o=s(92587),c=s(75354),d=s(53932);function l(e){return e}class u{withRefresh(){return e=>new r.y((t=>{const s=this.refreshObservable$.subscribe();return s.add(e.subscribe(t)),s}))}constructor(e,t,{args:s,commandName:n}){const r=t.commands[n];this.refreshObservable$=e.pipe((0,i.z)((async()=>{await r(s)})),(0,a.B)({}))}}class p{getRefresher(e){const t=this.map.get(e);if(t)return t;return new u(this.timers.createObservableTimer(e.period,e.period),this.cqrsClient.getClient(e.api),e)}constructor(e,t){this.timers=e,this.cqrsClient=t,this.map=new WeakMap}}p=(0,n.gn)([(0,o.GS)(),(0,n.w6)("design:type",Function),(0,n.w6)("design:paramtypes",[void 0===c.O?Object:c.O,void 0===d.m?Object:d.m])],p)},85798:(e,t,s)=>{s.d(t,{b:()=>r});var n=s(92587);function r(e){const t=(0,n.GS)();return s=>{if(Reflect.hasMetadata("dl-handlers",e)){const t=Reflect.getMetadata("dl-handlers",e);Reflect.defineMetadata("dl-handlers",[...t,s],e)}else Reflect.defineMetadata("dl-handlers",[s],e);t(s)}}},46449:(e,t,s)=>{s.d(t,{e:()=>r});var n=s(92587);function r(e){const t=(0,n.GS)();return s=>{Reflect.defineMetadata("dl-handler",s,e),t(s)}}},96031:(e,t,s)=>{s.d(t,{o:()=>n});const n="dl-module"},86213:(e,t,s)=>{s.d(t,{H:()=>c});var n=s(40284),r=s(78776),i=s(92587),a=s(64987),o=s(15295);const c=(e,t)=>{const s=t.token??(0,r.Z)();let c=class{getOrCreate(e,t){return this.mutex.runExclusive((async()=>(this.instance||(t.addShutdownHook((()=>{this.invalidate()})),this.instance=await e()),this.instance)))}invalidate(){this.instance=void 0}constructor(){this.mutex=new a.WU}};(0,i.GS)()(c);const d=c,l={token:e,inject:[c,o.d,n.ModuleRef,n.REQUEST],asyncFactory:(e,t,r,i)=>{const a=n.ContextIdFactory.getByRequest(i);return e.getOrCreate((()=>r.resolve(s,a)),t)}};return[{...t,token:s},d,l]}},92587:(e,t,s)=>{s.d(t,{GS:()=>i,ar:()=>a,xB:()=>r});var n=s(76301);function r(){return(0,n.Global)()}function i(e){return(0,n.Injectable)({scope:e?.neverReuseInstance?n.Scope.TRANSIENT:n.Scope.DEFAULT})}const a=()=>i()},86006:(e,t,s)=>{s.d(t,{Y:()=>f,g:()=>v});s(72964);var n=s(96031),r=s(76301),i=s(3441),a=s(92336),o=s(94691),c=s(77931),d=s(60785),l=s(16712);const u=new o.b,p=new c.z;class m{async getBatchState(e){const t=await this.kv.get(`${this.prefix}.${e}`);return t?this.stringToState(t):{queue:[]}}async setBatchState(e,t){const s=this.stateToString(t);return await this.kv.set(`${this.prefix}.${e}`,s)}stateToString(e){const t=u.encode(e);return p.encode(t)}stringToState(e){const t=p.decode(e);return u.decode(t)}constructor(e,t,s){this.kv=e,this.prefix=`batch-storage.${s}.${t.get(l.l.UserName)}`}}m=(0,a.gn)([(0,a.fM)(2,(0,r.Inject)(i.r)),(0,a.w6)("design:type",Function),(0,a.w6)("design:paramtypes",[void 0===d.QI?Object:d.QI,void 0===l.f?Object:l.f,String])],m);class h{getProviders(e){if(!e.length)return[];return[...e.map((e=>({provide:e,inject:[m,e.Definition.chunkProcessor],useFactory:(t,s)=>new e(t,s)}))),...e.map((({Definition:{chunkProcessor:e}})=>e)),m]}}var g=s(60107);const v=(e,t)=>({[e.name]:{name:e.name,events:t}}),y=(e,t)=>{const{exports:s=[],imports:n=[],providers:r=[],onFrameworkInit:i=[],stores:a=[],crons:o=[]}=e,c=[i,t.onFrameworkInit??[]].flat();return{...e,exports:s.concat(t.exports??[]),imports:n.concat(t.imports??[]),providers:r.concat(t.providers??[]),onFrameworkInit:c,stores:a.concat(t.stores??[]),crons:o.concat(t.crons??[])}};function f(e){let t;try{const{composes:s=[]}=e;e=s.reduce(((e,t)=>y(e,t)),e);const{exports:a=[],imports:o=[],handlers:c={commands:{},events:{},queries:{}},providers:d=[],onFrameworkInit:l=[],stores:u,batchExecutors:p,crons:m}=e,v=e.api?.name??e.sharedModuleName,f=v?(0,g.N)(...u??[]):[],b=v?(new h).getProviders(p??[]):[],S=(m??[]).map((e=>e.handler)),w=[...d,...S,...f,...b,...Object.values(c.commands),...Object.values(c.queries),...Object.values(c.events).map((e=>Object.values(e.events))).reduce(((e,t)=>[...e,...t]),new Array),...l instanceof Array?l:[l],{provide:i.r,useValue:v},{provide:i.z,useValue:e.domainName}],{asyncProviders:E,basicClassProviders:_}=w.reduce(((e,t)=>{return"object"==typeof(s=t)&&"token"in s&&"asyncFactory"in s&&"function"==typeof s.asyncFactory?{asyncProviders:[...e.asyncProviders,t],basicClassProviders:e.basicClassProviders}:{asyncProviders:e.asyncProviders,basicClassProviders:[...e.basicClassProviders,t]};var s}),{asyncProviders:new Array,basicClassProviders:new Array}),C=[..._,...E.map((e=>({provide:e.token,useFactory:e.asyncFactory,inject:e.inject})))];return t=(0,r.Module)({exports:a,imports:o,providers:C}),s=>(Reflect.defineMetadata(n.o,e,s),t(s))}catch(e){return console.error("[background/framework] Failed to decorate module"),e=>e}}},3441:(e,t,s)=>{s.d(t,{r:()=>n,z:()=>r});const n="frameworkModuleName",r="moduleDomainName"},4373:(e,t,s)=>{s.d(t,{Q1:()=>i,TB:()=>n,Vy:()=>r});const n={commands:{},events:{},queries:{}},r=e=>!(!e||"object"!=typeof e)&&(!(e.api&&!(e.api.commands&&e.api.events&&e.api.name&&e.api.queries&&e.handlers))&&(!(e.exports&&!Array.isArray(e.exports))&&(!(e.handlers&&!e.api)&&(!(e.imports&&!Array.isArray(e.imports))&&!(e.providers&&!Array.isArray(e.providers))))));class i{constructor(e,t){this.supportedEventHandlers=e,this.modules=t}}},91743:(e,t,s)=>{s.d(t,{$:()=>i,z:()=>r});var n=s(24748);function r(e){return{type:n.j.VALUE_PROVIDER,useValue:e}}function i(e){return{type:n.j.CLASS_PROVIDER,useClass:e}}},24748:(e,t,s)=>{s.d(t,{j:()=>n});var n=function(e){return e.VALUE_PROVIDER="value_provider",e.CLASS_PROVIDER="class_provider",e}({})},77761:(e,t,s)=>{s.d(t,{B:()=>o});var n=s(62149),r=s(56742),i=s(86213),a=s(77198);const o=(e,t,s)=>{switch(e){case n.F.Device:return(0,i.H)(t,s);case n.F.User:return(0,a.M)(t,s);default:(0,r.U)(e)}}},77198:(e,t,s)=>{s.d(t,{M:()=>c});var n=s(40284),r=s(78776),i=s(64987),a=s(16712),o=s(82194);const c=(e,t)=>{const s=t.token??(0,r.Z)();let c=class{getOrCreate(e,t,s){return this.mutex.runExclusive((async()=>{const n=this.instances.get(e);if(n)return n;s.addCloseHook((()=>{this.invalidate(e)}));const r=await t();return this.instances.set(e,r),r}))}invalidate(e){this.instances.delete(e)}constructor(){this.instances=new Map,this.mutex=new i.WU}};const d=c,l={token:e,inject:[c,a.f,n.ModuleRef,n.REQUEST,o.g],asyncFactory:(t,r,i,o,c)=>{const d=n.ContextIdFactory.getByRequest(o),l=r.getOrDefault(a.l.UserName,"");if(""===l)throw new Error(`Provider ${e} is a user-scoped singleton but there is no user`);if(!c)throw new Error("No user scope available");return t.getOrCreate(l,(()=>i.resolve(s,d)),c)}};return[{token:s,asyncFactory:t.asyncFactory,inject:[...t.inject??[],a.f]},d,l]}},36944:(e,t,s)=>{s.d(t,{O:()=>i,f:()=>d});var n=s(25126),r=s(79386);const i="diagnostics.logger";let a=null,o=null,c=!1;class d{static create(e){return new d({...e,infra:e.infra})}static createNull(e={container:"null",module:"null"}){const t=e.infra??new r.s;return new d({...e,infra:t})}getLogsStream$(){return this.bufferedEventStream.events$}async startDiagnosticsSession(){if(await this.initDiagnosticSession(),a)return;const e=(new Date).getTime()+6048e5;a=crypto.randomUUID(),o=e;const t={id:a,ttl:e};await this.infra.set(i,JSON.stringify(t))}async log({message:e,severity:t,metadata:s,timestamp:n}){if(await this.initDiagnosticSession(),this.shouldLog()&&a){const r={message:e,severity:t,diagnosticsId:a,timestamp:n,container:this.container,module:this.module,domain:this.domain,metadata:s};this.bufferedEventStream.emit(r,void 0)}}async clear(){await this.infra.remove(i),a=null,o=null}async getDiagnosticsSessionInfo(){return await this.initDiagnosticSession(),{diagnosticsId:a,diagnosticsTTL:o}}async initDiagnosticSession(){c||(await this.loadDiagnosticsSessionFromLocalStorage(),this.isTTLValid(o)||this.clear(),c=!0)}isTTLValid(e){const t=new Date;return!(!e||t.getTime()>e)}async loadDiagnosticsSessionFromLocalStorage(){try{const t=await this.infra.get(i),s=t?JSON.parse(t):void 0;if("object"!=typeof(e=s)||null===e||"string"!=typeof e.id||"number"!=typeof e.ttl)return;o=s.ttl,a=s.id}catch(e){console.error("error",e)}var e}shouldLog(){return a&&this.isTTLValid(o)}constructor(e){this.container=e.container,this.module=e.module,this.domain=e.domain,this.infra=e.infra,this.bufferedEventStream=new n.c}}},15160:(e,t,s)=>{s.d(t,{U:()=>a,i:()=>i});var n=s(29406),r=s(25126);class i{}class a{addSource(e){this.sub.unsubscribe(),this.events$.push(e),this.sub=(0,n.T)(...this.events$).subscribe((e=>{this.logsSource.emit(e[0],e[1])}))}constructor(e){this.events$=e,this.logsSource=new r.c,this.events$=e,this.sub=(0,n.T)(...e).subscribe((e=>{this.logsSource.emit(e[0],e[1])}))}}},76568:(e,t,s)=>{s.d(t,{A:()=>c});var n=s(92336),r=s(15295),i=s(33247),a=s(15160),o=s(92587);class c{onFrameworkInit(){this.lifeCycle.addAppReadyHook((async()=>{const e=this.diagnosticsLogsSources.logsSource.events$.subscribe(this.onLogEvent.bind(this));return()=>{e.unsubscribe()}}))}onLogEvent(e){const t=e[0];this.logsHandler.handle(t)}constructor(e,t,s){this.logsHandler=e,this.lifeCycle=t,this.diagnosticsLogsSources=s}}c=(0,n.gn)([(0,o.ar)(),(0,n.w6)("design:type",Function),(0,n.w6)("design:paramtypes",[void 0===i.y?Object:i.y,void 0===r.d?Object:r.d,void 0===a.U?Object:a.U])],c)},33247:(e,t,s)=>{s.d(t,{y:()=>p});var n=s(92336),r=s(78776),i=s(76301),a=s(64987),o=s(51899),c=s(9363),d=s(33548),l=s(93714);const u=new a.WU;class p{handle(e){const t=(0,r.Z)(),s=this.convertMetadataToString(e),n=this.redactLog(s);n.message=n.message.slice(0,100),this.queue={...this.queue,[t]:n},this.debouncedPersistLocally()}convertMetadataToString(e){return{...e,metadata:Object.entries(e.metadata??{}).reduce(((e,[t,s])=>s instanceof Error?(e[t]=s.message,void 0!==s.stack&&(e.stack=s.stack),e):(e[t]=s instanceof Object?JSON.stringify(s):String(s),e)),{}),message:e.message}}redactLog(e){const t=(0,l.gS)(e.message),s={};for(const[t,n]of Object.entries(e.metadata?e.metadata:{}))s[t]=(0,l.gS)(n);return{...e,message:t,metadata:s}}async persistLogsLocally(){const e={...this.queue};this.queue={};try{await u.runExclusive((async()=>{const t=await this.store.getState();await this.store.set({logs:{...t.logs,...e}})}))}catch(t){this.queue={...e},this.exceptionLogger.captureException(t,{domainName:"framework",moduleName:"diagnostics",origin:"exceptionBoundary"})}}constructor(e,t){this.exceptionLogger=e,this.store=t,this.queue={},this.debouncedPersistLocally=o(this.persistLogsLocally.bind(this),1e3,{maxWait:5e3})}}p=(0,n.gn)([(0,i.Injectable)(),(0,n.w6)("design:type",Function),(0,n.w6)("design:paramtypes",[void 0===c.v?Object:c.v,void 0===d.C?Object:d.C])],p)},95461:(e,t,s)=>{s.d(t,{y:()=>g});var n=s(92336),r=s(62149),i=s(76568),a=s(15160),o=s(55385),c=s(86006),d=s(64987),l=s(92587),u=s(33548);const p=new d.WU;class m{async isRunnable(){const e=await this.store.getState();return Object.keys(e.logs).length>0}async run(){const{logs:e}=await this.store.getState(),t=Object.keys(e),[s,n]=this.clearExpiredLogs(e);let r;try{r=await this.processor.process(s)}catch(e){console.error("Failed to process diagnotics logs",e)}(n.size||Object.values(r??{}).some(Boolean))&&await p.runExclusive((async()=>{const{logs:e}=await this.store.getState(),s=this.clearProcessedOrExpiredLogs(t,e,n,r);await this.store.set({logs:s})}))}clearProcessedOrExpiredLogs(e,t,s,n){return e.reduce(((e,t)=>((s.has(t)||n&&(!(t in n)||n[t]))&&delete e[t],e)),t)}clearExpiredLogs(e){const t=Date.now(),s=new Set;return[Object.keys(e).reduce(((n,r)=>(e[r].timestamp+6048e5<=t&&(s.add(r),delete n[r]),n)),e),s]}constructor(e,t){this.store=e,this.processor=t}}m=(0,n.gn)([(0,l.GS)(),(0,n.w6)("design:type",Function),(0,n.w6)("design:paramtypes",[void 0===u.C?Object:u.C,void 0===a.i?Object:a.i])],m);var h=s(33247);class g{static configure(e){return{module:g,configurations:{externalDiagnosticsLogsSources:e.externalDiagnosticsLogsSources,processorAdapter:e.processorAdapter}}}}g=(0,n.gn)([(0,c.Y)({sharedModuleName:"diagnostics",configurations:{externalDiagnosticsLogsSources:{token:a.U},processorAdapter:{token:a.i}},domainName:"framework",onFrameworkInit:[i.A],imports:[o.G],providers:[h.y],crons:[{handler:m,periodInMinutes:10,name:"DiagnosticsCron",scope:r.F.Device}],stores:[u.C]})],g)},33548:(e,t,s)=>{s.d(t,{C:()=>l});var n=s(92336),r=s(62149),i=s(60018),a=s(92587),o=s(63144),c=s(56618);function d(e){return!!e&&"object"==typeof e&&"logs"in e&&"object"==typeof e.logs}class l extends((0,o.Q)({persist:!0,scope:r.F.Device,storeName:"diagnostics-logs",capacity:c.Y._100KB,codec:i.E,storage:{schemaVersion:1,initialValue:{logs:{}},typeGuard:d}})){}l=(0,n.gn)([(0,a.GS)()],l)},50423:(e,t,s)=>{s.d(t,{J:()=>f});var n=s(92336),r=s(40284),i=s(76301),a=s(60399),o=s(87065),c=s(89618),d=s(37182),l=s(69885),u=s(43651),p=s(78346),m=s(86433),h=s(9363),g=s(16712),v=s(19464),y=s(79578);class f{async do(e,...t){return(await Promise.all(t.map((t=>this.doOne(t,e))))).every((e=>!!e))}async doOne(e,{criticality:t=m.T.WARNING,methodName:s="methodName"}={}){try{const t=await e();if((0,p.AZ)(t)&&(0,p.hx)(t))throw new Error(`Allowed to fail ${s} has failed`);return!0}catch(e){const{request:s,useCaseStacktraceRepo:n}=this,[r,i]=e instanceof v.c?[e.exception,e.useCaseStacktrace]:[e,n.read()];try{await Promise.race([new Promise((e=>setTimeout(e,100))),this.logger.captureException(r,{moduleName:s?.module,useCaseId:s?.context.get(g.l.UseCaseId),useCaseName:s?.name,useCaseStacktrace:i,featureFlips:await this.getUserFeatureFlips()},t)])}catch(e){}return!1}}async conditionallyAllowToFailOne(e,t){return t?this.doOne(e):(await e(),!0)}getUserFeatureFlips(){const{userFeatureFlips:e}=this.featureFlips.queries;return(0,a.z)(e().pipe((0,o.U)((e=>(0,p.d6)(e)?(0,p.db)(e):{})),(0,c.V)(50),(0,d.K)((()=>(0,l.of)({})))))}constructor(e,t,s,n){this.request=e,this.logger=t,this.useCaseStacktraceRepo=s,this.featureFlips=n}}f=(0,n.gn)([(0,n.fM)(0,(0,i.Inject)(r.REQUEST)),(0,n.w6)("design:type",Function),(0,n.w6)("design:paramtypes",[Object,void 0===h.v?Object:h.v,void 0===y.FT?Object:y.FT,void 0===u.P?Object:u.P])],f)},9363:(e,t,s)=>{s.d(t,{G:()=>d,v:()=>c});var n=s(92336),r=s(76301),i=s(59788),a=s(6423),o=s(86433);class c{setEnableExceptionLogsSend(e){this.enableExceptionLogsSend=e}captureException(e,t,s=o.T.CRITICAL){if(!this.enableExceptionLogsSend)return Promise.resolve();try{const n=e instanceof Error?e:new Error("Invalid exception type",{cause:e}),r=this.createExceptionLogEntry(t,n,s);return this.sink.logException(r)}catch(e){this.logger.warn("Failed to capture exception",{fileLocation:t.fileLocation??"",lineNumber:String(t.lineNumber),moduleName:t.moduleName??"",domainName:t.domainName??"",origin:t.origin??"",useCaseId:t.useCaseId??"",useCaseName:t.useCaseName??"",useCaseStacktrace:String(t.useCaseStacktrace)})}return Promise.resolve()}createExceptionLogEntry(e,t,s){return{callStack:t.stack??"",criticality:s,featuresFlipped:this.mapFeatures(e.featureFlips??{}),fileLocation:e.fileLocation,lineNumber:e.lineNumber,message:t.message,moduleName:e.moduleName,domainName:e.domainName,origin:e.origin,timestamp:Date.now(),useCaseId:e.useCaseId,useCaseName:e.useCaseName,useCaseStacktrace:e.useCaseStacktrace,cause:JSON.stringify(t.cause instanceof Error?{message:t.cause.message,stack:t.cause.stack}:t.cause)}}mapFeatures(e){return Object.keys(e).reduce(((t,s)=>e[s]?[s,...t]:t),[])}constructor(e,t){this.sink=e,this.logger=t,this.enableExceptionLogsSend=!0}}function d(){return new c(new a.p$,i.V.createNull())}c=(0,n.gn)([(0,r.Injectable)(),(0,n.w6)("design:type",Function),(0,n.w6)("design:paramtypes",[void 0===a.qD?Object:a.qD,void 0===i.V?Object:i.V])],c)},72609:(e,t,s)=>{s.d(t,{I:()=>o});var n=s(17350),r=s(6423),i=s(91743);let a=class extends r.fW{constructor(){super(n.E)}};const o={sink:(0,i.z)(new class{logException(){return Promise.resolve()}start(){return Promise.resolve({stop:()=>Promise.resolve()})}}),uncaughtErrorSource:(0,i.z)(new a)}},6423:(e,t,s)=>{s.d(t,{fW:()=>i,p$:()=>r,qD:()=>n});class n{}class r extends n{logException(){return Promise.resolve()}start(){return Promise.resolve({stop:()=>Promise.resolve()})}}class i{constructor(e){this.events$=e}}},19464:(e,t,s)=>{s.d(t,{c:()=>f,x:()=>b});var n=s(92336),r=s(76301),i=s(25313),a=s(60399),o=s(82567),c=s(37182),d=s(87065),l=s(23297),u=s(96498),p=s(78346),m=s(16712),h=s(9363),g=s(79578),v=s(53932),y=s(4373);class f extends Error{constructor(e,t){super("ApplicationRequestError"),this.exception=e,this.useCaseStacktrace=t}}class b{intercept(e,t){const s=e.getArgByIndex(0);return console.log(`[background/framework] Processing incoming request ${s.module}.${s.name}`,`(id: ${s.context.get(m.l.UseCaseId)})`),t.handle().pipe((0,o.b)((()=>{console.log(`[background/framework] Done processing incoming request ${s.module}.${s.name}`,`(id: ${s.context.get(m.l.UseCaseId)})`)})),(0,c.K)(this.handleException(s)))}handleException(e){const{useCaseStacktraceRepo:t}=this;return s=>{if(console.error(`[background/framework] Error while processing incoming ${e.module}.${e.name} ${e.type}`,`(id: ${e.context.get(m.l.UseCaseId)})`,s),t.isInitialUseCase()){const[n,r]=s instanceof f?[s.exception,s.useCaseStacktrace]:[s,t.read()];return this.captureException(e,n,r),(0,i._)((()=>n))}const n=s instanceof f?s:new f(s,t.read());return(0,i._)((()=>n))}}async getUserFeatureFlips(){if(!await(0,a.z)(this.requestContextClient.queries.activeUser().pipe((0,d.U)((e=>(0,p.d6)(e)&&!!(0,p.db)(e).userName)))))return Promise.resolve({});const{queries:{userFeatureFlips:e}}=this.cqrsClient.getClient(l.cV);return await(0,a.z)(e().pipe((0,d.U)((e=>(0,p.d6)(e)?(0,p.db)(e):{}))))}async captureException(e,t,s){const n=e.module,r=this.nodeModulesIntrospection.modules[n].domainName??"unknown";this.logger.captureException(t,{domainName:r,moduleName:n,useCaseName:e.name,useCaseId:e.context.get(m.l.UseCaseId),featureFlips:await this.getUserFeatureFlips(),useCaseStacktrace:s})}constructor(e,t,s,n,r){this.logger=e,this.useCaseStacktraceRepo=t,this.cqrsClient=s,this.requestContextClient=n,this.nodeModulesIntrospection=r}}b=(0,n.gn)([(0,r.Injectable)({scope:r.Scope.REQUEST}),(0,n.w6)("design:type",Function),(0,n.w6)("design:paramtypes",[void 0===h.v?Object:h.v,void 0===g.FT?Object:g.FT,void 0===v.w?Object:v.w,void 0===u.Q?Object:u.Q,void 0===y.Q1?Object:y.Q1])],b)},55385:(e,t,s)=>{s.d(t,{G:()=>R});var n=s(92336),r=s(40284),i=s(38430),a=s(86006),o=s(9363),c=s(72609),d=s(6423),l=s(15295),u=s(92587),p=s(19464),m=s(86433);class h{handle(e){const{error:t,fileLocation:s,lineNumber:n,origin:r}=e,[i,a]=t instanceof p.c?[t.exception,t.useCaseStacktrace]:[t];return this.logger.captureException(i,{fileLocation:s,lineNumber:n,origin:r,useCaseStacktrace:a},m.T.CRITICAL)}constructor(e){this.logger=e}}h=(0,n.gn)([(0,u.GS)(),(0,n.w6)("design:type",Function),(0,n.w6)("design:paramtypes",[void 0===o.v?Object:o.v])],h);class g{onFrameworkInit(){this.lifeCycle.addAppReadyHook((async()=>{const{stop:e}=await this.sink.start(),t=this.uncaughtErrorsSource.events$.subscribe(this.onUncaughtErrorEvent.bind(this));return()=>{t.unsubscribe(),e()}}))}onUncaughtErrorEvent(e){this.moduleRef.get(h).handle(e)}constructor(e,t,s,n){this.sink=e,this.lifeCycle=t,this.moduleRef=s,this.uncaughtErrorsSource=n}}g=(0,n.gn)([(0,u.ar)(),(0,n.w6)("design:type",Function),(0,n.w6)("design:paramtypes",[void 0===d.qD?Object:d.qD,void 0===l.d?Object:l.d,void 0===r.ModuleRef?Object:r.ModuleRef,void 0===d.fW?Object:d.fW])],g);var v=s(79578),y=s(78346),f=s(68327),b=s(82874),S=s(60399),w=s(87065),E=s(89618),_=s(37182),C=s(69885),I=s(76301),T=s(43651),A=s(59788),U=s(16712);class N{async report(e){const t=e.moduleNameOverride??this.request?.module,s=e.useCaseNameOverride??this.request?.name,n=e.additionalInfo,r=e.useCaseIdOverride??this.request?.context.get(U.l.UseCaseId),i=await this.getUserFeatureFlips();try{const a=Date.now(),o=e.anomalyType===f._F.EXCEPTION?{callStack:e.callStack,criticality:e.criticality,featuresFlipped:i,fileLocation:e.fileLocation,lineNumber:e.lineNumber,message:e.message,moduleName:t,origin:e.origin,timestamp:a,useCaseId:r,useCaseName:s,useCaseStacktrace:e.useCaseStacktrace,cause:n}:{criticality:e.criticality,featuresFlipped:i,message:e.message,timestamp:a,cause:n};await this.sink.logException(o)}catch(e){this.logger.error("Failed to report anomaly")}return Promise.resolve()}async getUserFeatureFlips(){if(this.cachedFeatureFlips)return this.cachedFeatureFlips;const{userFeatureFlips:e}=this.featureFlips.queries,t=await(0,S.z)(e().pipe((0,w.U)((e=>(0,y.d6)(e)?(0,y.db)(e):{})),(0,E.V)(50),(0,_.K)((()=>(0,C.of)({})))));this.cachedFeatureFlips=Object.keys(t).filter((e=>!!t[e]))}constructor(e,t,s,n){this.sink=e,this.logger=t,this.featureFlips=s,this.request=n,this.cachedFeatureFlips=void 0}}N=(0,n.gn)([(0,I.Injectable)(),(0,n.fM)(3,(0,I.Inject)(r.REQUEST)),(0,n.w6)("design:type",Function),(0,n.w6)("design:paramtypes",[void 0===d.qD?Object:d.qD,void 0===A.V?Object:A.V,void 0===T.P?Object:T.P,Object])],N);class O{async execute({body:e}){return this.reporter.report({...e,criticality:e.criticality,message:e.message,moduleNameOverride:e.moduleName,useCaseNameOverride:e.useCaseName,additionalInfo:e.additionalInfo??""}),Promise.resolve((0,y.Vp)(void 0))}constructor(e){this.reporter=e}}O=(0,n.gn)([(0,b.W)(f.SU),(0,n.w6)("design:type",Function),(0,n.w6)("design:paramtypes",[void 0===N?Object:N])],O);var D=s(41597);class F{execute({body:{flag:e}}){return this.logger.setEnableExceptionLogsSend(e),Promise.resolve((0,y.Vp)(void 0))}constructor(e){this.logger=e}}F=(0,n.gn)([(0,b.W)(D.w),(0,n.w6)("design:type",Function),(0,n.w6)("design:paramtypes",[void 0===o.v?Object:o.v])],F);class P{setEnableExceptionLogsSend(e){this.enableExceptionLogsSend=e}handleLog(e){if(!this.enableExceptionLogsSend)return Promise.resolve();try{return this.sink.logException(e)}catch(t){console.warn("Failed to capture exception in sink",{fileLocation:e.fileLocation??"",lineNumber:String(e.lineNumber),moduleName:e.moduleName??"",domainName:e.domainName??"",origin:e.origin??"",useCaseId:e.useCaseId??"",useCaseName:e.useCaseName??"",useCaseStacktrace:String(e.useCaseStacktrace)})}return Promise.resolve()}constructor(e){this.sink=e,this.enableExceptionLogsSend=!0}}P=(0,n.gn)([(0,I.Injectable)(),(0,n.w6)("design:type",Function),(0,n.w6)("design:paramtypes",[void 0===d.qD?Object:d.qD])],P);class R{static configure(e){return{module:R,configurations:{...c.I,sink:e.sink,...e.uncaughtErrorSource?{uncaughtErrorSource:e.uncaughtErrorSource}:{}}}}}R=(0,n.gn)([(0,a.Y)({api:i.P,handlers:{commands:{reportAnomaly:O,enableExceptionLog:F},events:{},queries:{}},providers:[N,o.v,P,{provide:r.APP_INTERCEPTOR,useClass:p.x},v.FT,h],configurations:{sink:{token:d.qD},uncaughtErrorSource:{token:d.fW}},exports:[o.v,v.FT],onFrameworkInit:g,requiredFeatureFlips:[],domainName:"framework"})],R)},86433:(e,t,s)=>{s.d(t,{T:()=>n,h:()=>r});const n=Object.freeze({WARNING:"warning",CRITICAL:"critical"});function r(e){return!(!e||"object"!=typeof e)&&("criticality"in e&&"timestamp"in e&&"message"in e&&"callStack"in e&&((e.criticality===n.CRITICAL||e.criticality===n.WARNING)&&"string"==typeof e.message&&"string"==typeof e.callStack))}},79578:(e,t,s)=>{s.d(t,{FT:()=>o,mH:()=>a});var n=s(92336),r=s(76301),i=s(16712);const a="USE_CASE_STACKTRACE";class o{isInitialUseCase(){return(this.requestContext.get(a)??[]).length<=1}read(){return this.requestContext.getOrAddSync(a,(()=>[]))}append(e){const{requestContext:t}=this,s=t.get(a)??[];t.set(a,[...s,e])}constructor(e){this.requestContext=e}}new(o=(0,n.gn)([(0,r.Injectable)(),(0,n.w6)("design:type",Function),(0,n.w6)("design:paramtypes",[void 0===i.f?Object:i.f])],o))(new i.f)},72693:(e,t,s)=>{s.d(t,{o:()=>n});class n{}},80895:(e,t,s)=>{s.d(t,{M:()=>r});var n=s(85045);class r extends((0,n.AJ)()){}},79594:(e,t,s)=>{s.d(t,{_:()=>o});var n=s(92336),r=s(72693),i=s(80895),a=s(92587);class o{downloadFile(e,t,s){return this.logger.info(`downloading file ${e}`),this.emitterChannel.send(e,t,s)}constructor(e,t){this.logger=e,this.emitterChannel=t}}o=(0,n.gn)([(0,a.GS)(),(0,n.w6)("design:type",Function),(0,n.w6)("design:paramtypes",[void 0===i.M?Object:i.M,void 0===r.o?Object:r.o])],o)},48302:(e,t,s)=>{s.d(t,{l:()=>l});var n=s(92336),r=s(4166),i=s(86006),a=s(79594),o=s(72693),c=s(80895),d=s(85045);class l{}l=(0,n.gn)([(0,i.Y)({api:r.L,configurations:{fileDownloadEmitterChannel:{token:o.o}},handlers:{commands:{},events:{},queries:{}},stores:[],providers:[a._,(0,d.ND)(c.M)],exports:[a._],domainName:"framework"})],l)},95962:(e,t,s)=>{s.d(t,{T:()=>a});var n=s(92336),r=s(87201),i=s(92587);class a{onFrameworkInit(){try{this.fileUploadListener.listen()}catch(e){console.error("error while initializing file-upload listener",e)}}constructor(e){this.fileUploadListener=e}}a=(0,n.gn)([(0,i.ar)(),(0,n.w6)("design:type",Function),(0,n.w6)("design:paramtypes",[void 0===r.P?Object:r.P])],a)},38711:(e,t,s)=>{s.d(t,{P:()=>n});class n{handle({body:e}){return e.uploadKey===this.uploadKey?Promise.resolve(this.handleUploadedFile(e.fileUploadData)):Promise.resolve(void 0)}constructor(e){this.uploadKey=e}}},34319:(e,t,s)=>{s.d(t,{i:()=>a});var n=s(92336),r=s(13800),i=s(92587);class a extends r.f{}a=(0,n.gn)([(0,i.GS)()],a)},87201:(e,t,s)=>{s.d(t,{P:()=>a});var n=s(92336),r=s(76301),i=s(34319);class a{constructor(e){this.eventEmitter=e}}a=(0,n.gn)([(0,r.Injectable)(),(0,n.w6)("design:type",Function),(0,n.w6)("design:paramtypes",[void 0===i.i?Object:i.i])],a)},49699:(e,t,s)=>{s.d(t,{O:()=>d});var n=s(92336),r=s(58563),i=s(86006),a=s(87201),o=s(34319),c=s(95962);class d{}d=(0,n.gn)([(0,i.Y)({api:r.a,configurations:{fileUploadListener:{token:a.P}},onFrameworkInit:c.T,handlers:{commands:{},events:{},queries:{}},stores:[],providers:[o.i],exports:[o.i],domainName:"framework"})],d)},26549:(e,t,s)=>{s.d(t,{e:()=>g});var n=s(92336),r=s(97143),i=s(69885),a=s(34987),o=s(97280),c=s(33312),d=s(56742);class l{handle(e){return this.pipeline.handle(e)}dedupeInterceptorsById(e){const t=e.reduce(((e,t)=>(e.set(t.id,t),e)),new Map);return Array.from(t.values())}initPipeline(e,t){return t.reduceRight(((e,t)=>({handle:s=>t.intercept(s,e.handle.bind(e))})),e)}constructor(e,t){(0,r._)(this,"pipeline",void 0),this.pipeline=this.initPipeline(e,this.dedupeInterceptorsById(t))}}var u=s(8624);class p{addInterceptor(e){this.interceptors.set(e.id,e)}request(...e){return this.makeRequest(...e)}delete(e,t){return this.makeRequest("DELETE",e,t)}get(e,t){return this.makeRequest("GET",e,t)}head(e,t){return this.makeRequest("HEAD",e,t)}options(e,t){return this.makeRequest("OPTIONS",e,t)}patch(e,t,s){return this.makeRequest("PATCH",e,{body:t,...s})}post(e,t,s){return this.makeRequest("POST",e,{body:t,...s})}put(e,t,s){return this.makeRequest("PUT",e,{body:t,...s})}makeRequest(...e){let t,s,n;if(1===e.length)t=e[0],s="response";else{const[r,i,a]=e;t=new u.a(r,i,void 0!==a.body?a.body:null,{headers:a.headers,params:a.params,responseType:a.responseType??"json",withCredentials:a.withCredentials}),s=a.observe??"body","json"===a.responseType&&"body"===a.observe&&(n=a.responseBodyDecoder)}const r=new l(this.backend,Array.from(this.interceptors.values())),p=(0,i.of)(this.addContentTypeRequestHeader(t)).pipe((0,a.b)((e=>r.handle(e))),(0,o.d)(1));switch(s){case"body":switch(t.responseType){case"arraybuffer":return p.pipe((0,c.Gx)((e=>e.arrayBuffer())));case"text":return p.pipe((0,c.Gx)((e=>e.text())));case"json":return p.pipe((0,c.Gx)((e=>e.json(n))));default:(0,d.U)(t.responseType)}break;case"response":return p;default:(0,d.U)(s)}}addContentTypeRequestHeader(e){if(!e.headers.has("content-type")){const t=e.detectContentTypeHeader();if(t)return e.clone({headers:e.headers.set("content-type",t)})}return e}constructor(e){(0,r._)(this,"backend",void 0),(0,r._)(this,"interceptors",void 0),this.backend=e,this.interceptors=new Map}}var m=s(33685),h=s(92587);class g extends p{constructor(e){super(e)}}g=(0,n.gn)([(0,h.GS)(),(0,n.w6)("design:type",Function),(0,n.w6)("design:paramtypes",[void 0===m.j?Object:m.j])],g)},75421:(e,t,s)=>{s.d(t,{X:()=>g});var n=s(92336),r=s(40284),i=s(33685),a=s(26549),o=s(82567),c=s(78346),d=s(45888),l=s(92587);class u{intercept(e,t){return this.logger.info(`HTTP ${e.method} request to ${e.url}`),t(e).pipe((0,o.b)((t=>{if((0,c.d6)(t))this.logger.info(`HTTP request to ${e.url} succeeded`);else{"BadStatus"===(0,c.Yv)(t).tag?this.logger.info(`Failure HTTP response from ${e.url} (${(0,c.Yv)(t).tag})`):this.logger.info(`Failed to send HTTP request to ${e.url}`)}})))}constructor(e){this.logger=e,this.id="LoggingHttpInterceptor"}}u=(0,n.gn)([(0,l.GS)(),(0,n.w6)("design:type",Function),(0,n.w6)("design:paramtypes",[void 0===d.c?Object:d.c])],u);var p=s(85045),m=s(86006);const h=[];class g{static configure(e){return{module:g,configurations:{infrastructure:e}}}static addGlobalInterceptor(e){h.push(e)}}(g=(0,n.gn)([(0,m.Y)({providers:[(0,p.ND)(d.c),{asyncFactory:async(e,t)=>{const s=new a.e(e);return(await Promise.all(h.map((e=>t.create(e))))).forEach((e=>s.addInterceptor(e))),s},token:a.e,inject:[i.j,r.ModuleRef]}],configurations:{infrastructure:{token:i.j}},exports:[a.e],sharedModuleName:"http",domainName:"framework"})],g)).addGlobalInterceptor(u)},58965:(e,t,s)=>{s.r(t),s.d(t,{AcknowledgedChannel:()=>$.N,AllowedToFail:()=>De.J,AppLifeCycle:()=>o.d,AppLogger:()=>i.V,AppTimers:()=>c.O,BackgroundStatusManager:()=>He.L,BadStatus:()=>C.R,BaseEventEmitter:()=>re.f,BufferedEventStream:()=>Be.j,ChannelMessageBroker:()=>B.U,ChannelState:()=>K.D,ClientStatusManager:()=>st,CommandHandler:()=>W.W,CommandRefresherFactory:()=>X.u1,ConcurrencyTestTimers:()=>g,ContextLessCqrsClient:()=>ne.m,ContextlessBaseEventEmitter:()=>re.C,CqrsBroker:()=>Z.d,CqrsClient:()=>ne.w,CqrsCommandRefresher:()=>X.Tx,CronLowLevelSource:()=>Ue.R_,DIAGNOSTICS_ID_KEY:()=>qe.O,DefaultEncryptionCodecForDeviceData:()=>he.h,DefaultEncryptionCodecForUserData:()=>he.s,DefaultTimers:()=>n.m,DiagnosticsInit:()=>Ge.A,DiagnosticsLogProcessor:()=>$e.i,DiagnosticsLogger:()=>qe.f,DiagnosticsLogsSources:()=>$e.U,DiagnosticsModule:()=>Ke.y,EventHandler:()=>Y.b,ExceptionCriticalityValues:()=>j.T,ExceptionLogger:()=>z.v,ExceptionLoggingModule:()=>V.G,ExceptionLoggingSink:()=>M.qD,FetchFailedError:()=>C.a,FileDownloadEmitterChannel:()=>Re.o,FileDownloadListenerChannel:()=>Pe,FileDownloadModule:()=>Le.l,FileDownloadService:()=>xe._,FileUploadBootstrap:()=>ze.T,FileUploadListener:()=>je.P,FileUploadModule:()=>ke.O,FileUploadedEventHandler:()=>Ve.P,FileUploadedEventsEmitter:()=>Me.i,FrameworkInit:()=>b.ar,FrameworkRequestContextValues:()=>Fe.l,Global:()=>b.xB,HttpBackend:()=>I.j,HttpClient:()=>D.e,HttpHeaders:()=>T.W,HttpModule:()=>F.X,HttpParams:()=>A.L,HttpRequest:()=>U.a,HttpResponse:()=>N.Z,HttpStatusCode:()=>O.W,Injectable:()=>b.GS,JsonApplicationResourceFetcher:()=>Ne.X,JsonApplicationResourceLoader:()=>Oe.K,KeyValueStorageFactory:()=>me.u,KeyValueStorageInfrastructure:()=>ve.QI,MV3ExtensionHttpInterceptor:()=>R.I,MV3ExtensionResilienceModule:()=>x.f,MV3LongRunningTaskInterceptor:()=>L.V,MV3ServiceWorkerExtenderBase:()=>k.g,ManagedStorageInfrastructure:()=>ve.Rx,ManualTriggeredTimers:()=>c.r,MemoryChannel:()=>K.q,MemoryKeyValueStorageInfrastructure:()=>ge.s,MemoryManagedStorageInfrastructure:()=>ge.I,MemoryStoreInfrastructureFactory:()=>ye.N,Module:()=>f.Y,ModuleLogger:()=>P.uP,NoDynamicChannels:()=>G.y,NodeConfiguration:()=>H.$,NodeEventBroker:()=>J.a,NodeModulesIntrospection:()=>S.Q1,NodeToModuleEventBroker:()=>te,NullCronTaskHandler:()=>Ue.ql,NullLoggingSink:()=>M.p$,NullStorage:()=>ve.hL,ObservableQueriesCache:()=>ce.v,ObservableQueriesCacheBase:()=>ue.z,ParameterProviderType:()=>v.j,QueryHandler:()=>Q.e,RequestContext:()=>Fe.f,RequestContextModule:()=>pe.q,SingleNodeAppBuilder:()=>a.u,Store:()=>Ee.y,StoreCapacity:()=>be.Y,StoreFlusher:()=>we.X,StoreInfrastructureFactory:()=>ye.G,ThrowJsonFetcher:()=>n.k,TimerBasedCronSource:()=>Ue._C,UncaughtErrorSource:()=>M.fW,createApplicationClient:()=>de,createCqrsClient:()=>se.c,createCqrsClients:()=>se.R,createLoggerProvider:()=>P.ND,createNullExceptionLogger:()=>z.G,createSingleChannelListener:()=>G.v,defineApplication:()=>a.t,defineBatchExecutor:()=>Ae,defineLogger:()=>P.AJ,defineStore:()=>fe.Q,deviceScopedSingletonProvider:()=>_.H,getQueryValue:()=>le.O,getStoresProviders:()=>Se.N,isExceptionLogEntry:()=>j.h,isSendMessageRequest:()=>q.F,isVersionedData:()=>ve.Ot,mockTimer:()=>h,provideClass:()=>y.$,provideValue:()=>y.z,refresherCreationToken:()=>X.b2,scopedSingleton:()=>E.B,sendMessageRequest:()=>q.k,startApplicationNode:()=>r.u,startSingleApplicationNode:()=>r.W,useEventsOfModule:()=>f.g,userScopedSingletonProvider:()=>w.M});var n=s(68860),r=s(46044),i=s(59788),a=s(52357),o=s(15295),c=s(75354),d=s(83695),l=s(78263),u=s(87065),p=s(6220),m=s(98187);function h(e,t,s,n){const r=[];if(t<s)return[];if(e<s){if(r.push(s),0===n)return r;let e=s+n;for(;e<=t;)r.push(e),e+=n;return r}if(n<=0)return[];let i=s+(Math.trunc((e-s)/n)+1)*n;for(;i<=t;)r.push(i),i+=n;return r}class g extends c.O{fireTimer(e=1){this.time=this.time+e,this.source$.next(this.time)}createObservableTimer(e,t){return this.source$.pipe((0,d.O)(0),(0,l.G)(),(0,u.U)((([s,n])=>h(s,n,e,t))),(0,p.z)((e=>e)))}constructor(...e){super(...e),this.source$=new m.x,this.time=0}}var v=s(24748),y=s(91743),f=s(86006),b=s(92587),S=s(4373),w=s(77198),E=s(77761),_=s(86213),C=s(13528),I=s(33685),T=s(14940),A=s(30558),U=s(8624),N=s(19313),O=s(18920),D=s(26549),F=s(75421),P=s(85045),R=s(36490),x=s(42631),L=s(57197),k=s(22366),j=s(86433),M=s(6423),z=s(9363),V=s(55385),B=s(10826),K=s(66853),G=s(57934),$=s(12335),q=s(57042),H=s(40443),W=s(82874),Q=s(46449),Y=s(85798),X=s(2198),Z=s(93223),J=s(59590),ee=s(7303);class te{connect(e){const{localSubscribersMap:t,broker:s}=this;return s.connect({onLocalEvent:async(s,n,r,i,a,o)=>{const c=t[s][r];await Promise.all(c.map((async t=>{await e.onEvent(s,t,r,i,a,o)})))}})}constructor(e){this.publishEvent=(e,t,s,n)=>this.broker.publishEvent(e,t,s,n),this.broker=new J.a(e);const t=e.getModuleNames().reduce(((t,s)=>({...t,[s]:Object.keys(e.appDefinition[s].api.events).reduce(((e,t)=>(e[t]=[],e)),(0,ee.Ay)({}))})),(0,ee.Ay)({}));this.localSubscribersMap=Object.keys(e.subscriptions).map((e=>e)).reduce(((t,s)=>{const n=e.subscriptions[s];return Object.keys(n).map((e=>e)).forEach((e=>{const r=n[e]??[],i=t[e];r.forEach((e=>{i[e].push(s)}))})),t}),t)}}var se=s(93787),ne=s(53932),re=s(13800),ie=s(38430),ae=s(66335),oe=s(6136),ce=s(67499);async function de({clientName:e,appDefinition:t,channels:s,channelsListener:n}){const r={...t,[ie.P.name]:{api:ie.P,main:"background",queryOnly:[]}},i=new H.$({appDefinition:r,channels:s,channelsListener:n,currentNode:null,subscriptions:{}}),a=new Z.d(i),c=new o.d,d=()=>{throw new Error("Unexpected request received by detached application client")},l=a.connect({onCommand:d,onQuery:d}).start(),u=new ce.v(c),p=new ne.m(i,a,u);return c.addAppReadyHook((()=>{const e=p.getClient(ae.t$).queries.activeUser().pipe((0,oe.x)()).subscribe((()=>{u.clearUserCache()}));return()=>e.unsubscribe()})),c.addShutdownHook((async()=>{await(await l).stop()})),await c.startup(),{client:(0,se.R)(e??"client",t,a,u),stop:async()=>{await c.shutDown()}}}var le=s(16575),ue=s(39690),pe=s(76435),me=s(25085),he=s(96812),ge=s(79386),ve=s(60785),ye=s(41718),fe=s(63144),be=s(56618),Se=s(60107),we=s(63419),Ee=s(62200),_e=s(64987);const Ce=16,Ie=.5,Te=1.3;function Ae(e){var t;const{chunkControl:{decrement:s=Ie,increment:n=Te,initialSize:r=Ce}={decrement:Ie,increment:Te,initialSize:Ce}}=e;const i=new _e.WU;return(t=class{async dispatchBatch(e){await i.runExclusive((async()=>{const t=await this.pushItemsInQueue(e);for(;t.queue.length>0;)await this.processOneChunkFromQueue(t)}))}async pushItemsInQueue(t){const s=await this.repository.getBatchState(e.name),n=t.filter((e=>!s.queue.find((t=>t===e))));return n.length&&(s.queue.push(...n),await this.repository.setBatchState(e.name,s)),s}async processOneChunkFromQueue(t){const i=function(e){const{lastStartedChunkFirstId:t,lastStartedChunkSize:i=r}=e;if(!t)return r;const a=!e.queue.find((e=>e===t));return Math.max(1,a?Math.ceil(i*n):Math.floor(i*s))}(t),a=Math.min(i,t.queue.length);if(!a)throw new Error("Should have something to process");await this.repository.setBatchState(e.name,{...t,lastStartedChunkSize:a,lastStartedChunkFirstId:t.queue[0]});const o=t.queue.splice(0,a);await this.processor.processChunk(o),await this.repository.setBatchState(e.name,t)}constructor(e,t){this.repository=e,this.processor=t}}).Definition=e,t}var Ue=s(31857),Ne=s(23337),Oe=s(7531),De=s(50423),Fe=s(16712);class Pe{}var Re=s(72693),xe=s(79594),Le=s(48302),ke=s(49699),je=s(87201),Me=s(34319),ze=s(95962),Ve=s(38711),Be=s(36610),Ke=s(95461),Ge=s(76568),$e=s(15160),qe=s(36944),He=s(3764),We=s(41842),Qe=s(85390),Ye=s(60399),Xe=s(24966),Ze=s(6642),Je=s(98138),et=s(3873);function tt(e){return(0,et.K)(e)&&"type"in e&&[Ze.e.FAILURE,Ze.e.LOADING,Ze.e.READY].includes(e.type)}class st{async start(){const e=new B.U({[Je.G]:{type:"remote",channel:this.channelToBackground}}),t=e.connect([this.channelToBackground],G.y),s=await t.start(),n=e.sendMessage("applicationBackgroundStatus",{queryName:"applicationStatus"}).pipe((0,We.h)(tt)).subscribe((e=>{this.backgroundStatus$.next(e)}));return this.stop=async()=>{n.unsubscribe(),await s.stop()},this.stop}getBackgroundAndClientStatusReadyOrFailure$(){return(0,Qe.a)([this.backgroundStatus$,this.clientStatus$]).pipe((0,u.U)((([e,t])=>e.type===Ze.e.FAILURE?{type:Ze.e.FAILURE,error:e.error}:t.type===Ze.e.FAILURE?{type:Ze.e.FAILURE,error:t.error}:e.type===Ze.e.READY&&t.type===Ze.e.READY?{type:Ze.e.READY}:{type:Ze.e.LOADING})),(0,We.h)((({type:e})=>e!==Ze.e.LOADING)))}async waitUntilBackgroundAndClientReady(){const e=await(0,Ye.z)(this.getBackgroundAndClientStatusReadyOrFailure$());if(e.type===Ze.e.FAILURE)throw new Error("Background or client intialization failed.",{cause:e.error})}async waitUntilBackgroundReady(){const e=await(0,Ye.z)(this.backgroundStatus$.pipe((0,We.h)((({type:e})=>e!==Ze.e.LOADING))));if(e.type===Ze.e.FAILURE)throw new Error("Background intialization failed.",{cause:e.error})}ready(){this.clientStatus$.value.type!==Ze.e.LOADING&&console.warn(`[framework/background] Unexpected application state transition, expecting ${Ze.e.LOADING} got ${this.clientStatus$.value.type}`),console.log("[framework/leeloo] Client is ready"),this.clientStatus$.next({type:Ze.e.READY}),this.stop()}failure(e){if(this.clientStatus$.value.type!==Ze.e.LOADING)throw new Error(`Unexpected application state transition, expecting ${Ze.e.LOADING} got ${this.clientStatus$.value.type}`);console.log("[framework/leeloo] Unexpected client failure"),this.clientStatus$.next({type:Ze.e.FAILURE,error:e instanceof Error?e.message:"unexpected failure"}),this.stop()}async stop(){console.log("[framework/leeloo] Client stop function called before initialization")}constructor(e){this.channelToBackground=e,this.clientStatus$=new Xe.X({type:Ze.e.LOADING}),this.backgroundStatus$=new Xe.X({type:Ze.e.LOADING})}}},59788:(e,t,s)=>{s.d(t,{V:()=>u});var n=s(36944),r=s(25126);const i=Object.freeze({TRACE:1,DEBUG:5,INFO:9,WARN:13,ERROR:17,FATAL:21});class a{static create(e){return new a(e.message,e.severity??i.INFO,e.timestamp??Date.now(),e.metadata??{},e.container??"none",e.module??"none",e.domain??"none")}constructor(e,t,s,n,r,i,a){this.message=e,this.severity=t,this.timestamp=s,this.metadata=n,this.container=r,this.module=i,this.domain=a}}class o{static create(e){return new o(e)}async log(e){const t={...e.metadata,criticality:e.severity===i.WARN?"warning":"critical",message:e.message,timestamp:e.timestamp};this.bufferedEventStream.emit(t,void 0)}getLogsStream$(){return this.bufferedEventStream.events$}constructor(e){this.container=e.container,this.module=e.module,this.domain=e.domain,this.bufferedEventStream=new r.c}}function c(e,t,s,n){let r;if("string"==typeof t)r=a.create({message:t,severity:i.ERROR,timestamp:n?.timestamp,metadata:{...n},...e});else if("string"==typeof t)r=a.create({message:t,severity:s,metadata:{...n},...e});else if(function(e){return"object"==typeof e&&null!==e&&"error"in e}(t)){const{fileLocation:i,lineNumber:o,origin:c,error:d}=t,l=d instanceof Error?d:new Error("unknown error",{cause:d});r=a.create({message:l.message,severity:s,metadata:{error:d,fileLocation:i,lineNumber:o,origin:c,...n},...e})}else{const i=t instanceof Error?t:new Error("unknown error",{cause:t});r=a.create({message:i.message,severity:s,metadata:{cause:i,stack:i.stack,...n},...e})}return r}const d=()=>{};class l{static createProd(){return new l({[i.TRACE]:console.debug,[i.DEBUG]:console.debug,[i.INFO]:console.info,[i.WARN]:console.warn,[i.ERROR]:console.error,[i.FATAL]:console.error})}static create(){return new l({[i.TRACE]:console.debug,[i.DEBUG]:console.debug,[i.INFO]:console.info,[i.WARN]:console.warn,[i.ERROR]:console.error,[i.FATAL]:console.error})}static createNull(){return new l({[i.TRACE]:d,[i.DEBUG]:d,[i.INFO]:d,[i.WARN]:d,[i.ERROR]:d,[i.FATAL]:d})}print(e){const t=e.container&&e.module?`[${e.container}/${e.module}]`:"";this.infra[e.severity](`${t} ${e.message}`,e.metadata)}constructor(e){this.infra=e}}class u{static create(e){const t=n.f.create({container:e.container,module:e.module,domain:e.domain,infra:e.infra}),s=o.create({container:e.container,module:e.module,domain:e.domain}),r=l.createProd();let i=e.printer??r;return new u(i,t,s,e)}static createNull(e={}){const t={container:e.container??"none",module:e.module??"none",domain:e.domain??"none"};return new u(l.createNull(),n.f.createNull({...t,infra:e.infra}),o.create(t),t)}fatal(e,t){const s=c(this.locationContext,e,i.FATAL,t);this.diagnostics.log(s),this.anomalyLogger.log(s),this.printer.print(s)}error(e,t){const s=c(this.locationContext,e,i.ERROR,t);this.diagnostics.log(s),this.anomalyLogger.log(s),this.printer.print(s)}warn(e,t){const s=a.create({message:e,severity:i.WARN,timestamp:t?.timestamp,metadata:{...t},...this.locationContext});this.diagnostics.log(s),this.anomalyLogger.log(s),this.printer.print(s)}info(e,t){const s=a.create({message:e,severity:i.INFO,timestamp:t?.timestamp,metadata:{...t},...this.locationContext});this.diagnostics.log(s),this.printer.print(s)}log(e,t){this.info(e,t)}debug(e,t){const s=a.create({message:e,severity:i.DEBUG,timestamp:t?.timestamp,metadata:{...t},...this.locationContext});this.diagnostics.log(s),this.printer.print(s)}trace(e,t){const s=a.create({message:e,severity:i.TRACE,timestamp:t?.timestamp,metadata:{...t},...this.locationContext});this.diagnostics.log(s),this.printer.print(s)}constructor(e,t,s,n){this.printer=e,this.diagnostics=t,this.anomalyLogger=s,this.locationContext=n}}},85045:(e,t,s)=>{s.d(t,{AJ:()=>u,ND:()=>p,uP:()=>l});var n=s(92336),r=s(59788),i=s(3441),a=s(60785),o=s(79386),c=s(92587),d=s(15160);class l{static createNull(){return new l(new o.s,void 0,void 0)}info(e,t){this.logger.info(e,t)}debug(e,t){this.logger.debug(e,t)}error(e,t){this.logger.error(e,t)}fatal(e,t){this.logger.fatal(e,t)}trace(e,t){this.logger.trace(e,t)}warn(e,t){this.logger.warn(e,t)}log(e,t){this.logger.log(e,t)}constructor(e,t,s){this.logger=r.V.create({infra:e,container:"background",module:t??"",domain:s??"no-domain"})}}function u(){const e=class extends l{constructor(e,t,s){super(e,t,s)}};return(0,c.GS)()(e),e}function p(e){return{token:e,inject:[a.QI,d.U,i.r,i.z],asyncFactory:async(t,s,n,r)=>{const i=new e(t,n,r),a=i.logger.diagnostics.getLogsStream$();return s.addSource(a),i}}}l=(0,n.gn)([(0,c.GS)(),(0,n.w6)("design:type",Function),(0,n.w6)("design:paramtypes",[void 0===a.QI?Object:a.QI,Object,Object])],l)},12335:(e,t,s)=>{s.d(t,{N:()=>f});var n=s(6136),r=s(98187),i=s(15023),a=s(41842),o=s(16433),c=s(89618),d=s(37182),l=s(17350),u=s(97280),p=s(42946),m=s(162),h=s(2049),g=s(6220),v=s(7074),y=s(78776);class f{constructor(e,t=3e4){const s=e.status$.pipe((0,n.x)());let f=!1;const b=new r.x,S=b.pipe((0,g.z)((async n=>{const r=(0,y.Z)();let g=!1;const v=e.messages$.pipe((0,i.o)((()=>!f)),(0,a.h)((e=>"acknowledgement"===e.type&&e.id===r)),(0,o.q)(1),(0,c.V)(t),(0,d.K)((()=>l.E)),(0,u.d)(1)),b=v.subscribe((()=>{g=!0,b.unsubscribe()})),S=s.pipe((0,i.o)((()=>!g&&!f)),(0,p.z)((()=>(0,m.D)(e.sendMessage({type:"send",id:r,message:n.message}))))).subscribe();try{await(0,h.n)(v),S.unsubscribe(),n.resolve()}catch(e){S.unsubscribe(),n.reject(e)}}))).subscribe();this.stop=()=>(f=!0,S.unsubscribe(),e.stop()),this.send=e=>new Promise(((t,s)=>{const n={message:e,resolve:t,reject:s};b.next(n)})),this.channelState$=e.status$,this.receivedMessages$=e.messages$.pipe((0,a.h)((e=>"send"===e.type)),(0,g.z)((async t=>{if("send"===t.type)return await e.sendMessage({type:"acknowledgement",id:t.id}),t.message})),(0,v.B)())}}},10826:(e,t,s)=>{s.d(t,{U:()=>_});var n=s(24966),r=s(2049),i=s(41842),a=s(6220),o=s(162),c=s(87065),d=s(37182),l=s(69885),u=s(64659);const p=e=>{if(!e||"object"!=typeof e)return!1;return"unSubscription"===e.type},m=(e,t,s)=>{const n=new Set(s),r=new Map,m=t.receivedMessages$.pipe((0,i.h)(p)).subscribe((e=>{const t=r.get(e.id);t?.unsubscribe(),r.delete(e.id)})),h=t.receivedMessages$.pipe((0,i.h)((e=>{return!(!(t=e)||"object"!=typeof t)&&"start"===t.type&&n.has(e.definition.destination)&&!r.has(e.definition.id);var t})),(0,a.z)((e=>(0,o.D)((async e=>(r.set(e.definition.id,{unsubscribe:()=>{}}),await t.send({type:"initial-acknowledgement",id:e.definition.id}),e))(e))))).subscribe((s=>{const n=s.definition.destination,i=e(n,s.definition.content,s.metadata),p={type:"end",id:s.definition.id},m=i.pipe((0,c.U)((e=>({id:s.definition.id,data:e,type:"data"}))),(0,d.K)((e=>{const t={id:s.definition.id,type:"error",errorMessage:e.message};return(0,l.of)(t)})),(0,u.l)(p),(0,a.z)((e=>(0,o.D)(t.send(e))))).subscribe();r.set(s.definition.id,{unsubscribe:()=>{m.unsubscribe()}})}));return{unsubscribe:()=>{h.unsubscribe(),m.unsubscribe();for(const e of r.values())e.unsubscribe()}}};var h=s(58376),g=s(85390),v=s(15023),y=s(6136),f=s(42946),b=s(60399),S=s(66853),w=s(78776);var E=s(7303);class _{connect(e,t){let s=!1;return{start:()=>{if(s)throw new Error("Already started");s=!0;const n=e=>m(((e,t,s)=>this.routes[e].send(e,t,s)),e,Object.keys(this.routes)),r=e.map(n),i=new Map,a=t.connectedChannels$.subscribe((e=>{const t=[...i.entries()].filter((([t])=>!(t in e))),s=Object.keys(e).filter((e=>!i.has(e)));t.forEach((([e,t])=>{i.delete(e),t.unsubscribe()})),s.forEach((t=>{const s=e[t],r=n(s);i.set(t,r)}))}));return Promise.resolve({stop:()=>([...r,a,...i.values()].forEach((e=>e.unsubscribe())),this.stopped$.next(!0),Promise.resolve())})}}}ensureMessageSerializable(e,t){0}sendMessage(e,t){return this.ensureMessageSerializable(e,t),this.routes[e].send(e,t,{isReminder:!1})}trySendMessage(e,t){return this.ensureMessageSerializable(e,t),this.routes[e].trySend(e,t,{isReminder:!1})}constructor(e){this.stopped$=new n.X(!1);const t={routes:(0,E.Ay)({})};this.routes=(()=>{const{routes:s}=Object.keys(e).reduce(((t,s)=>{const n=e[s];if("local"===n.type&&(t.routes[s]={send:n.onMessage,trySend:async(...e)=>(await(0,r.n)(n.onMessage(...e)),!0)}),"remote"===n.type){const e=((e,t)=>{const s=(s,n,r)=>{const a={content:n,destination:String(s),id:(0,w.Z)()};return new h.y((s=>{let n={type:"start",definition:a,metadata:r};const d=(0,g.a)({message:e.receivedMessages$,stopped:t}).pipe((0,v.o)((({stopped:e})=>!e)),(0,c.U)((({message:e})=>e))).subscribe((e=>{var t;(t=e)&&"object"==typeof t&&"initial-acknowledgement"===t.type&&e.id===a.id?n={...n,metadata:{...n.metadata,isReminder:!0}}:(e=>!(!e||"object"!=typeof e)&&"data"===e.type)(e)&&e.id===a.id?s.next(e.data):(e=>!(!e||"object"!=typeof e)&&"error"===e.type)(e)&&e.id===a.id?s.error(new Error(e.errorMessage)):(e=>!(!e||"object"!=typeof e)&&"end"===e.type)(e)&&e.id===a.id&&s.complete()})),l=(0,g.a)({sendTimes:e.channelState$.pipe((0,y.x)(),(0,i.h)((e=>e===S.D.Connected))),stopped:t}).pipe((0,v.o)((({stopped:e})=>!e)),(0,f.z)((()=>(0,o.D)(e.send(n))))).subscribe();return()=>{e.send({type:"unSubscription",id:a.id}),l.unsubscribe(),d.unsubscribe()}}))};return{send:s,trySend:async(t,n,i)=>await(0,b.z)(e.channelState$)===S.D.Connected&&(await(0,r.n)(s(t,n,i)),!0)}})(n.channel,this.stopped$);t.routes[s]=e}return t}),t);return s})()}}},66853:(e,t,s)=>{s.d(t,{D:()=>i,q:()=>a});var n=s(98187),r=s(24966),i=function(e){return e.Connected="Connected",e.Disconnected="Disconnected",e}({});class a{send(e){if("Connected"!==this.channelStateSubject$.value)throw new Error("Channel is not connected");return this.sentMessages$.next(e),Promise.resolve()}get receivedMessages$(){return this.receivedMessagesSubject$}get channelState$(){return this.channelStateSubject$}stop(){this.receivedMessages$.complete()}connect(e){if("Connected"===this.channelStateSubject$.value)return{disconnect:()=>{}};const t=this.sentMessages$.subscribe((t=>{e.receivedMessages$.next(t)}));return this.channelState$.next("Connected"),{disconnect:()=>{this.channelState$.next("Disconnected"),t.unsubscribe()}}}constructor(){this.sentMessages$=new n.x,this.receivedMessagesSubject$=new n.x,this.channelStateSubject$=new r.X("Disconnected")}}},57934:(e,t,s)=>{s.d(t,{v:()=>i,y:()=>r});var n=s(24966);const r={connectedChannels$:new n.X({})},i=e=>({connectedChannels$:new n.X({channel:e})})},57042:(e,t,s)=>{s.d(t,{F:()=>r,k:()=>n});const n=({channelName:e,message:t})=>({channelName:e,message:t,type:"graphene-message"}),r=e=>{if(!e||"object"!=typeof e)return!1;return"graphene-message"===e.type}},40443:(e,t,s)=>{s.d(t,{$:()=>n});class n{getNodeList(){return this.currentNode?[...this.getRemoteNodeList(),this.currentNode]:this.getRemoteNodeList()}getRemoteNodeList(){return Object.keys(this.channels)}getModuleNames(){return Object.keys(this.appDefinition)}constructor(e){this.appDefinition=e.appDefinition,this.currentNode=e.currentNode,this.channels=e.channels,this.subscriptions=e.subscriptions,this.channelsListener=e.channelsListener}}},36490:(e,t,s)=>{s.d(t,{I:()=>m});var n=s(92336),r=s(97280),i=s(83896),a=s(16433),o=s(66189),c=s(76301),d=s(22366),l=s(45888),u=s(75354);const p=2e4;class m{intercept(e,t){if(e.timeout<3e4)return t(e);this.logger.debug("Starting heartbeat sequence to extend SW lifetime during HTTP request");const s=t(e).pipe((0,r.d)(1));return this.timers.createObservableTimer(p,p).pipe((0,i.R)(s),(0,a.q)(Math.trunc(e.timeout/p)),(0,o.x)((()=>{this.logger.debug("Ending heartbeat sequence to extend SW lifetime during HTTP request")}))).subscribe((()=>this.mv3ServiceWorkerExtender.extendServiceWorkerLifetime())),s}constructor(e,t,s){this.timers=e,this.mv3ServiceWorkerExtender=t,this.logger=s,this.id="MV3ExtensionHttpInterceptor"}}m=(0,n.gn)([(0,c.Injectable)(),(0,n.w6)("design:type",Function),(0,n.w6)("design:paramtypes",[void 0===u.O?Object:u.O,void 0===d.g?Object:d.g,void 0===l.c?Object:l.c])],m)},45888:(e,t,s)=>{s.d(t,{c:()=>r});var n=s(85045);class r extends((0,n.AJ)()){}},42631:(e,t,s)=>{s.d(t,{f:()=>p});var n=s(92336),r=s(36490),i=s(22366),a=s(57197),o=s(46096),c=s(45888),d=s(75421),l=s(86006),u=s(85045);class p{static configure(e){return d.X.addGlobalInterceptor(r.I),o.b.addGlobalNestInterceptor(a.V),{module:p,configurations:{mv3SwExtend:e}}}}p=(0,n.gn)([(0,l.Y)({sharedModuleName:"mv3ExtensionResilience",configurations:{mv3SwExtend:{token:i.g}},providers:[r.I,a.V,(0,u.ND)(c.c)],exports:[r.I,a.V],domainName:"framework"})],p)},57197:(e,t,s)=>{s.d(t,{V:()=>p});var n=s(92336),r=s(97280),i=s(83896),a=s(16433),o=s(76301),c=s(6178),d=s(75354),l=s(22366);const u=2e4;class p{intercept(e,t){const s=e.switchToHttp().getRequest();if(s.type===c.Y.Command||s.type===c.Y.Cron||s.type===c.Y.Event){const e=t.handle().pipe((0,r.d)(1));return this.timers.createObservableTimer(u,u).pipe((0,i.R)(e),(0,a.q)(Math.trunc(45))).subscribe((()=>this.mv3ServiceWorkerExtender.extendServiceWorkerLifetime())),e}return t.handle()}constructor(e,t){this.timers=e,this.mv3ServiceWorkerExtender=t}}p=(0,n.gn)([(0,o.Injectable)(),(0,n.w6)("design:type",Function),(0,n.w6)("design:paramtypes",[void 0===d.O?Object:d.O,void 0===l.g?Object:l.g])],p)},22366:(e,t,s)=>{s.d(t,{g:()=>n});class n{}},16712:(e,t,s)=>{s.d(t,{f:()=>r,l:()=>n});const n={UseCaseId:"USE_CASE_ID",UserName:"USER_NAME"};class r{get(e){return this.entries[e]}getOrDefault(e,t){return this.entries[e]??t}getOrFail(e,t){if(!this.has(e)){throw new Error(t?.errorMessage??`No ${e} in request context`)}return this.entries[e]}has(e){return e in this.entries}async getOrAdd(e,t){return this.has(e)||this.set(e,await t()),this.get(e)}getOrAddSync(e,t){return this.has(e)||this.set(e,t()),this.get(e)}set(e,t){this.entries[e]=t}toSerializable(){return this.entries}static fromSerializable(e){const t=new r;for(const[s,n]of Object.entries(e))t.entries[s]=n;return t}clone(){return r.fromSerializable(JSON.parse(JSON.stringify(this.toSerializable())))}withValue(e,t){return this.set(e,t),this}constructor(){this.entries={}}}},23337:(e,t,s)=>{s.d(t,{X:()=>n});class n{}},7531:(e,t,s)=>{s.d(t,{K:()=>c});var n=s(92336),r=s(162),i=s(25859),a=s(92587),o=s(23337);class c{async load(){await this.get()}async get(){const{value:e}=this;if(e)return e;const t=await this.fetcher.fetch(this.url),s=await this.loadResource(t);return this.value=s,s}constructor(e,t){this.url=e,this.fetcher=t,this.value$=(0,r.D)((0,i.P)((()=>this.get())))}}c=(0,n.gn)([(0,a.GS)(),(0,n.w6)("design:type",Function),(0,n.w6)("design:paramtypes",[String,void 0===o.X?Object:o.X])],c)},76435:(e,t,s)=>{s.d(t,{q:()=>_});var n=s(92336),r=s(78346),i=s(66335),a=s(87065),o=s(6136),c=s(62149),d=s(63144),l=s(56618);const u=e=>!(!e||"object"!=typeof e)&&"userName"in e;class p extends((0,d.Q)({initialValue:{userName:void 0},persist:!1,scope:c.F.Device,storeName:"active-user-store",storeTypeGuard:u,capacity:l.Y._001KB})){}var m=s(46449),h=s(82874),g=s(13800),v=s(92587);class y extends g.f{}y=(0,n.gn)([(0,v.GS)()],y);var f=s(85045);class b extends((0,f.AJ)()){}class S{execute(){return this.activeUserStore.state$.pipe((0,a.U)((e=>e.userName)),(0,o.x)(),(0,a.U)((e=>(0,r.Vp)({userName:e}))))}constructor(e){this.activeUserStore=e}}S=(0,n.gn)([(0,m.e)(i.p),(0,n.w6)("design:type",Function),(0,n.w6)("design:paramtypes",[void 0===p?Object:p])],S);class w{async execute({body:{userName:e}}){return(await this.activeUserStore.getState()).userName===e||(await this.activeUserStore.set({userName:e}),e?(this.logger.debug("Active user set"),this.eventEmitter.sendEvent("activeUserSet",{userName:e})):this.logger.debug("Active user unset")),(0,r.Vp)(void 0)}constructor(e,t,s){this.activeUserStore=e,this.eventEmitter=t,this.logger=s}}w=(0,n.gn)([(0,h.W)(i.r$),(0,n.w6)("design:type",Function),(0,n.w6)("design:paramtypes",[void 0===p?Object:p,void 0===y?Object:y,void 0===b?Object:b])],w);var E=s(86006);class _{}_=(0,n.gn)([(0,E.Y)({api:i.t$,handlers:{commands:{setActiveUser:w},events:{},queries:{activeUser:S}},stores:[p],providers:[y,(0,f.ND)(b)],domainName:"framework"})],_)},68860:(e,t,s)=>{s.d(t,{k:()=>o,m:()=>a});var n=s(90171),r=s(75354),i=s(23337);class a extends r.O{get time(){return Date.now()}createObservableTimer(e,t){return(0,n.H)(e,t)}}class o extends i.X{fetch(){return Promise.reject(new Error("Please add a jsonFetcher to the application. Probably you are seing that in unit tests.\nIf this is the case, please mock whatever service is requiring to fetch the data"))}}},96812:(e,t,s)=>{s.d(t,{h:()=>i,s:()=>a});var n=s(92336),r=s(76301);class i{}i=(0,n.gn)([(0,r.Injectable)()],i);class a{}a=(0,n.gn)([(0,r.Injectable)()],a)},25085:(e,t,s)=>{s.d(t,{u:()=>r});class n{clear(){return this.storage.remove(this.baseKey)}async read(){const e=await this.storage.get(this.baseKey);return!e&&this.initialValueFactory?await this.initialValueFactory():e}async write(e){await this.storage.set(this.baseKey,e)}constructor(e,t,s){this.storage=e,this.baseKey=t,this.initialValueFactory=s}}class r{createBackend(e,t,s,r){const i=s?`${e}.${t}.${s}`:`${e}.${t}`;return new n(this.storage,i,r)}constructor(e){this.storage=e}}},79386:(e,t,s)=>{s.d(t,{I:()=>r,s:()=>n});class n{set(e,t){return this.memory.set(e,t),Promise.resolve()}getAllKeys(){return Promise.resolve([...this.memory.keys()])}remove(e){return this.memory.get(e)?(this.memory.delete(e),Promise.resolve()):Promise.resolve()}get(e){return Promise.resolve(this.memory.get(e))}constructor(){this.memory=new Map}}class r{getAllKeys(){return Promise.resolve([])}get(e){return Promise.resolve(void 0)}}},60785:(e,t,s)=>{function n(e){return null!==e&&"object"==typeof e&&"version"in e&&"number"==typeof e.version&&"content"in e}s.d(t,{Ot:()=>n,QI:()=>i,Rx:()=>a,hL:()=>r});const r={read:()=>Promise.resolve(void 0),write:()=>Promise.resolve(),clear:()=>Promise.resolve()};class i{}class a{}},63144:(e,t,s)=>{s.d(t,{Q:()=>p});var n=s(92587),r=s(75172),i=s(60018),a=s(60785);class o{async read(){const e=await this.backend.read();if(!e)return;const{decoded:t,hasBypassedDecryption:s}=await this.decodeData(e),{definition:n}=this,{storageName:r}=n;if(!(0,a.Ot)(t))throw new Error(`Unable to read storage data that isn't versioned (storage name: ${r}, data shape: ${this.printDataShapeInfo(t)})`);const{content:i}=t,o=t.version,c=n.schemaVersion;if(o<c){if(!n.migrateStorageSchema)throw s&&await this.rawWrite(t),new Error(`Missing storage schema migration function prevents from reading old version data (storage name: ${r})`);const e=n.migrateStorageSchema(t),i=this.getTypecheckedData(e,"read");return await this.writeWithVersion(i),i}if(o>c)throw new Error(`Unable to read storage data with a more recent version than current schema (storage name: ${r})`);{const e=this.getTypecheckedData(i,"read");return s&&await this.writeWithVersion(e),e}}write(e){const t=this.getTypecheckedData(e,"write");return this.writeWithVersion(t)}clear(){return this.backend.clear()}async writeWithVersion(e){const t={version:this.definition.schemaVersion,content:e};await this.rawWrite(t)}async rawWrite(e){const t=await this.codec.encode(e);await this.backend.write(t)}async decodeData(e){const{codec:t,bypassedDecryptionDecoder:s}=this;try{return{decoded:await t.decode(e),hasBypassedDecryption:!1}}catch(t){try{return{decoded:await s.decode(e),hasBypassedDecryption:!0}}catch{throw t}}}getTypecheckedData(e,t){try{if(!this.definition.typeGuard(e))throw new Error("Typeguard check failed")}catch(s){const{storageName:n,initialValue:r}=this.definition,i=`Failed to ${t} storage data because of typeguard failure`,a={details:s instanceof Error?s.message:"",storageInfo:`(storage name: ${n}, data shape: ${this.printDataShapeInfo(e)})`},o=new Error(i,{cause:JSON.stringify(a)});if(this.appLogger.error(i,a),this.definition.isCache)return r;throw o}return e}printDataShapeInfo(e){if(e&&"object"==typeof e){const t=e,s=Object.keys(t).reduce(((e,s)=>(e[s]=typeof t[s],e)),{});return JSON.stringify(s).substring(0,40)}return void 0===e?"undefined":null===e?"null":typeof e}constructor(e,t,s,n,a,o){this.encryptionCodec=e,this.serializationCodec=t,this.transportStorageCodec=s,this.backend=n,this.definition=a,this.appLogger=o,this.codec=(0,r.x)(s,e,t);const c=new i.E;this.bypassedDecryptionDecoder=(0,r.x)(s,c,t)}}const c=e=>{var t;return(t=class extends o{constructor(t,s,n,r,i){super(t,s,n,r,e,i)}}).Definition=e,t};var d=s(56618),l=s(62200);const u=e=>e.persist?{persist:!0,codec:e.codec,scope:e.scope,storeName:e.storeName,storeTypeGuard:e.storeTypeGuard,isCache:e.isCache,storage:c({...e.storage,storageName:e.storeName,isCache:e.isCache??!1}),capacity:(0,d.C)(e)?e.capacity:void 0}:{persist:!1,initialValue:e.initialValue,scope:e.scope,storeName:e.storeName,capacity:(0,d.C)(e)?e.capacity:void 0};function p(e){var t;const s=u(e),r=((t=class extends l.y{constructor(e,t,s,n,r,i,a){super(e,t,s,n,r,i,a)}}).Definition=s,t);return(0,n.GS)()(r),r}},56618:(e,t,s)=>{s.d(t,{C:()=>r,Y:()=>n});var n=function(e){return e._001KB="1KB",e._010KB="10KB",e._100KB="100KB",e._001MB="1MB",e.Unlimited="Unlimited",e}({});function r(e){return"object"==typeof e&&null!==e&&"capacity"in e}},63419:(e,t,s)=>{s.d(t,{X:()=>o});var n=s(92336),r=s(76301),i=s(40284),a=s(7712);class o{async prepare(){const e=i.ContextIdFactory.getByRequest(this.request);this.storeList.instances=await Promise.all(this.storeList.classes.map((t=>this.moduleRef.resolve(t,e,{strict:!1}))))}async flush(){const{instances:e}=this.storeList;if(!e.length)throw new Error("Stores not instantiated");const t=e.map((e=>e.persist()));await Promise.all(t)}constructor(e,t,s){this.moduleRef=e,this.request=t,this.storeList=s}}o=(0,n.gn)([(0,r.Injectable)(),(0,n.fM)(1,(0,r.Inject)(i.REQUEST)),(0,n.w6)("design:type",Function),(0,n.w6)("design:paramtypes",[void 0===i.ModuleRef?Object:i.ModuleRef,"undefined"==typeof Record?Object:Record,void 0===a.D?Object:a.D])],o)},41718:(e,t,s)=>{s.d(t,{N:()=>a,G:()=>i});var n=s(24966);class r{set(e){return this.state$.next(e),Promise.resolve()}init(e){return this.state$.next(e),Promise.resolve()}stop(){this.state$.complete()}getState(){return Promise.resolve(this.state$.value)}clear(){return this.state$.next(this.initValue),Promise.resolve()}clearStorage(){return Promise.resolve()}update(e){return this.set(e(this.state$.value)),Promise.resolve()}persist(){return Promise.resolve()}load(){return Promise.resolve()}constructor(e){this.initValue=e,this.getLimit=()=>Promise.resolve(void 0),this.state$=new n.X(e)}}class i{}class a extends i{createUserScopedInfrastructure(){return new r({timestamp:void 0})}createDeviceScopedInfrastructure(){return new r({timestamp:void 0})}}},7712:(e,t,s)=>{s.d(t,{D:()=>n});class n{get classes(){return this.registeredClasses}get instances(){return this.preparedInstances}set instances(e){this.preparedInstances=e}registerClass(e){this.registeredClasses.push(e)}constructor(){this.registeredClasses=[],this.preparedInstances=[]}}},60107:(e,t,s)=>{s.d(t,{N:()=>S});var n=s(40284),r=s(78776),i=s(62149),a=s(15295),o=s(77761),c=s(41718),d=s(3441),l=s(94691),u=s(77931),p=s(96812),m=s(25085),h=s(16712),g=s(59788);const v={[i.F.Device]:p.h,[i.F.User]:p.s};var y=s(82194),f=s(50423);function b(e){const t=e.Definition.persist?function(e,t,s){const{EncryptionCodec:n=v[t],SerializationCodec:a=l.b,TransportStorageCodec:c=u.z,initialValue:p,schemaVersion:y}=s.Definition;let f=class{constructor(e,t,s,n,r){this.encryptionCodec=e,this.serializationCodec=t,this.transportStorageCodec=s,this.backend=n,this.appLogger=r}},b=class extends s{constructor(e){super(e.encryptionCodec,e.serializationCodec,e.transportStorageCodec,e.backend,e.appLogger)}};const S={token:(0,r.Z)(),inject:[f],asyncFactory:e=>Promise.resolve(new b(e))};return[{token:f,inject:[d.r,n,a,c,m.u,g.V,...t===i.F.User?[h.f]:[]],asyncFactory:async(s,n,r,a,o,c,d)=>{const l=await o.createBackend(s,e,(t===i.F.User?d?.get(h.l.UserName):"")??"",(async()=>{const e={version:y,content:p},t=await r.encode(e),s=await n.encode(t);return await a.encode(s)}));return new f(n,r,a,l,c)}},...(0,o.B)(t,s,S)]}(e.Definition.storeName,e.Definition.scope,e.Definition.storage):[],s={token:(0,r.Z)(),inject:[d.r,a.d,c.G,e.Definition.scope===i.F.User?h.f:n.REQUEST,f.J,y.g,...e.Definition.persist?[e.Definition.storage,e.Definition.codec]:[]],asyncFactory:async(t,s,n,r,a,o,c,d)=>{const l=new e(t,e.Definition,n,(e.Definition.scope===i.F.User?r.get(h.l.UserName):"")??"",a,c,d),u=async()=>{await l.clear(),l.stop()};if(e.Definition.scope===i.F.User){if(!o)throw new Error("No user scope available");o.addCloseHook(u)}else s.addShutdownHook(u);return await l.load(),l}};return[...t,...(0,o.B)(e.Definition.scope,e,s)]}function S(...e){return e.flatMap((e=>b(e)))}},62200:(e,t,s)=>{s.d(t,{y:()=>p});var n=s(60399),r=s(24966),i=s(85390),a=s(87065),o=s(6136),c=s(41842),d=s(62149),l=s(56618);class u{constructor(e,t,s,n){switch(this.conf=t,this.set=async e=>{if(!await this.quickMemoryInfrastructure.getLimit()||this.conf.capacity!==l.Y.Unlimited||!this.conf.persist)return this.quickMemoryInfrastructure.set(e)},this.getState=()=>this.quickMemoryInfrastructure.getState(),this.init=e=>this.quickMemoryInfrastructure.init(e),this.update=async e=>this.set(e(await this.getState())),this.clearStorage=()=>this.quickMemoryInfrastructure.clearStorage(),this.clear=()=>this.quickMemoryInfrastructure.clear(),this.persist=()=>this.quickMemoryInfrastructure.persist(),this.load=()=>this.quickMemoryInfrastructure.load(),this.stop=()=>this.quickMemoryInfrastructure.stop(),this.getLimit=()=>Promise.reject(new Error("not implemented")),t.scope){case d.F.Device:this.quickMemoryInfrastructure=s.createDeviceScopedInfrastructure(e,t.storeName,t.storeTypeGuard),this.key=`graphene.${e}.${t.storeName}`;break;case d.F.User:if(!n)throw new Error("Attempting to create a user-scoped store without a user");this.quickMemoryInfrastructure=s.createUserScopedInfrastructure(e,t.storeName,n,t.storeTypeGuard),this.key=`graphene.${e}.${t.storeName}.${n}`}this.state$=this.quickMemoryInfrastructure.state$}}class p{getState(){return(0,n.z)(this.state$)}async set(e){try{await this.setWithoutPersist(e)}finally{await this.persist()}}async setWithoutPersist(e){const t={data:e,timestamp:this.timeGetter()};let s;this.localState$.next(t);if(!await this.allowedToFail.doOne((()=>this.infrastructure.set(t).catch((e=>{throw s=new Error(`${this.conf.storeName}: ${e.message}`),s})))))return this.conf.persist?this.infrastructure.clear():Promise.reject(s)}init(e){const t={data:e,timestamp:0};return this.localState$.next(t),Promise.resolve()}async clear(){this.localState$.next({timestamp:void 0}),await this.infrastructure.clear()}async clearStorage(){if(!this.storage)throw new Error("Persisted stores should have storage");await this.storage.clear()}stop(){this.localState$.complete()}async update(e){const t=await this.getState();await this.set(e(t))}async load(){const e=await this.infrastructure.getState();if(e.timestamp)return void this.localState$.next(e);const{conf:t,codec:s,storage:n}=this;if(!t.persist)return;if(!s||!n)throw new Error("Persisted stores should have conf/storage");await this.allowedToFail.conditionallyAllowToFailOne((async()=>{const e=await n.read()??t.storage.Definition.initialValue,r=await s.decode(e);await this.setWithoutPersist(r)}),!!t.isCache)||await this.setWithoutPersist(await s.decode(t.storage.Definition.initialValue))}async persist(){const{conf:e,codec:t,storage:s}=this;if(!e.persist)return;if(!t||!s)throw new Error("Persisted stores should have conf/storage");const n=await this.getState(),r=await t.encode(n);await s.write(r)}constructor(e,t,s,n,d,l,p){this.conf=t,this.allowedToFail=d,this.storage=l,this.codec=p,this.getLimit=()=>Promise.reject(new Error("not implemented")),this.infrastructure=new u(e,t,s,n),this.timeGetter=()=>Date.now(),this.localState$=new r.X({timestamp:void 0}),this.mergedState$=(0,i.a)({infra:this.infrastructure.state$,current:this.localState$}).pipe((0,a.U)((({current:e,infra:t})=>t.timestamp&&(!e.timestamp||t.timestamp>e.timestamp)?t:e)),(0,o.x)());const m=t.persist?void 0:t.initialValue;this.state$=this.mergedState$.pipe((0,c.h)((e=>!t.persist||!!e.timestamp)),(0,a.U)((e=>e.data??m)))}}},3764:(e,t,s)=>{s.d(t,{L:()=>c});var n=s(24966),r=s(6642),i=s(3873);var a=s(98138),o=s(10826);class c{async start(){const e=new o.U({[a.G]:{type:"local",onMessage:(e,t)=>{if(s=t,(0,i.K)(s)&&"queryName"in s&&"applicationStatus"===s.queryName)return this.status$;var s;throw new Error("Unknown request type",{cause:t})}}}).connect([],this.clientListener),t=await e.start();return{stop:async()=>{await t.stop()}}}ready(){this.status$.value.type!==r.e.LOADING&&this.logger?.warn(`[framework/background] Unexpected application state transition, expecting ${r.e.LOADING} got ${this.status$.value.type}`),this.logger?.info("[framework/background] Background is ready"),this.status$.next({type:r.e.READY})}failure(e){if(this.status$.value.type!==r.e.LOADING)throw new Error(`Unexpected application state transition, expecting ${r.e.LOADING} got ${this.status$.value.type}`);this.logger?.error("Unexpected background failure",{error:e}),this.status$.next({type:r.e.FAILURE,error:e instanceof Error?e.message:"unexpected failure"})}constructor(e,t){this.clientListener=e,this.logger=t,this.status$=new n.X({type:r.e.LOADING})}}},98138:(e,t,s)=>{s.d(t,{G:()=>n});const n="applicationBackgroundStatus"},6642:(e,t,s)=>{s.d(t,{e:()=>n});var n=function(e){return e.LOADING="loading",e.FAILURE="failure",e.READY="ready",e}({})},31857:(e,t,s)=>{s.d(t,{R_:()=>r,_C:()=>i,ql:()=>n});class n{run(){return Promise.resolve()}isRunnable(){return!1}}class r{}class i extends r{constructor(e){super(),this.alarm$=e.createObservableTimer(6e4,6e4)}}},58881:(e,t,s)=>{s.d(t,{F:()=>r,p:()=>n});const n={Open:"open",Closed:"closed"};class r{async close(){for(;this.closeHooks.length>0;){const e=this.closeHooks.pop();e&&await e()}this.status=n.Closed,this.lifecycle.removeShutdownHook(this.onAppShutdown)}addCloseHook(e){this.closeHooks.push(e)}constructor(e){this.lifecycle=e,this.status=n.Open,this.onAppShutdown=()=>this.close(),this.closeHooks=[],e.addShutdownHook(this.onAppShutdown)}}},82194:(e,t,s)=>{s.d(t,{g:()=>p});var n=s(92336),r=s(78263),i=s(41842),a=s(16433),o=s(76301),c=s(78346),d=s(96498),l=s(58881),u=s(15295);class p extends l.F{thisUserGotDeactivated(e){return([t,s])=>{if(!(0,c.d6)(t)||!(0,c.d6)(s))return!1;const n=(0,c.db)(t).userName,r=(0,c.db)(s).userName;return n===e&&void 0===r}}constructor(e,t,s){super(t),s.queries.activeUser().pipe((0,r.G)(),(0,i.h)(this.thisUserGotDeactivated(e)),(0,a.q)(1)).subscribe((()=>{this.close()}))}}p=(0,n.gn)([(0,o.Injectable)(),(0,n.w6)("design:type",Function),(0,n.w6)("design:paramtypes",[String,void 0===u.d?Object:u.d,void 0===d.Q?Object:d.Q])],p)},24418:(e,t,s)=>{s.d(t,{R:()=>i});var n=s(8260),r=s(5574);class i extends((0,n.E)(r.Yu)){}(0,n.K)(r.Yu,i)},5574:(e,t,s)=>{s.d(t,{L5:()=>a,Yu:()=>c,mf:()=>o});var n=s(13385),r=s(62149),i=s(75958);class a extends((0,n.g)({scope:r.F.Device})){}class o extends((0,n.g)({scope:r.F.Device})){}const c=(0,i.Q)({commands:{TrackEventCommand:a,TrackPageViewCommand:o},events:{},name:"analytics",queries:{}})},58349:(e,t,s)=>{s.d(t,{C:()=>i});var n=s(97143),r=s(62149);class i extends r.z{constructor(e){super(),(0,n._)(this,"body",void 0),this.body=e}}},62149:(e,t,s)=>{s.d(t,{F:()=>i,z:()=>r});var n=s(97143);class r{constructor(){(0,n._)(this,"_",void 0)}}var i=function(e){return e.User="user",e.Device="device",e}({})},13385:(e,t,s)=>{s.d(t,{A:()=>o,g:()=>a});var n=s(97143),r=s(58349),i=s(62149);const a=(...[e={scope:i.F.User}])=>{var t;return t=class extends r.C{},(0,n._)(t,"metadata",e),t},o=(e={scope:i.F.User})=>{var t;return t=class extends r.C{},(0,n._)(t,"metadata",e),t}},77535:(e,t,s)=>{s.d(t,{k:()=>a});var n=s(97143),r=s(75768),i=s(62149);const a=(e={scope:i.F.User,useCache:!1})=>{var t;return t=class extends r.M{},(0,n._)(t,"metadata",e),t}},75768:(e,t,s)=>{s.d(t,{M:()=>i});var n=s(97143),r=s(62149);class i extends r.z{constructor(e){super(),(0,n._)(this,"body",void 0),this.body=e}}},59664:(e,t,s)=>{s.d(t,{b:()=>r,s:()=>n});var n=function(e){return e.Account="account",e.Authentication="authentication",e.DarkWebMonitoring="dark_web_monitoring",e.Groups="groups",e.ImportExport="import_export",e.ItemUsage="item_usage",e.TeamSettings="team_settings",e.TeamSettingsActiveDirectory="team_settings_activedirectory",e.TeamSettingsPolicies="team_settings_policies",e.TeamSettingsSAMLProvisioning="team_settings_samlprovisioning",e.TeamSettingsSIEM="team_settings_siem",e.TeamSettingsSCIM="team_settings_scim",e.TeamSettingsSSO="team_settings_sso",e.Sharing="sharing",e.UserSettings="user_settings",e.UserSettingsAccountRecovery="user_settings_accountrecovery",e.Users="users",e.VaultCollections="vault_collections",e.VaultIDs="vault_ids",e.VaultPasswords="vault_passwords",e.VaultPayments="vault_payments",e.VaultPersonalInfo="vault_personalinfo",e.VaultSecureNotes="vault_securenotes",e.TeamNudges="team_nudges",e.SecurityMonitoring="security_monitoring",e.RiskDetection="risk_detection",e}({}),r=function(e){return e.UserInvited="user_invited",e.UserReinvited="user_reinvited",e.UserRemoved="user_removed",e.TeamCaptainAdded="team_captain_added",e.TeamCaptainRemoved="team_captain_removed",e.GroupManagerAdded="group_manager_added",e.GroupManagerRemoved="group_manager_removed",e.MasterPasswordResetAccepted="master_password_reset_accepted",e.MasterPasswordResetRefused="master_password_reset_refused",e.BillingAdminAdded="billing_admin_added",e.BillingAdminRemoved="billing_admin_removed",e.UserGroupCreated="user_group_created",e.UserGroupRenamed="user_group_renamed",e.UserGroupDeleted="user_group_deleted",e.UserJoinedUserGroup="user_joined_user_group",e.UserLeftUserGroup="user_left_user_group",e.UserInvitedToUserGroup="user_invited_to_user_group",e.UserDeclinedInviteToUserGroup="user_declined_invite_to_user_group",e.UserRemovedFromUserGroup="user_removed_from_user_group",e.DomainRequested="domain_requested",e.DomainValidated="domain_validated",e.SensitiveLogsEnabled="collect_sensitive_data_audit_logs_enabled",e.SensitiveLogsDisabled="collect_sensitive_data_audit_logs_disabled",e.SsoIdpMetadataSet="sso_idp_metadata_set",e.SsoServiceProviderUrlSet="sso_service_provider_url_set",e.SsoEnabled="sso_enabled",e.SsoDisabled="sso_disabled",e.NitroUserProvisioningActivated="nitro_user_provisioning_activated",e.NitroUserProvisioningDeactivated="nitro_user_provisioning_deactivated",e.NitroGroupProvisioningActivated="nitro_group_provisioning_activated",e.NitroGroupProvisioningDeactivated="nitro_group_provisioning_deactivated",e.NitroSiemActivated="nitro_siem_activated",e.NitroSiemDeactivated="nitro_siem_deactivated",e.NitroSiemEdited="nitro_siem_edited",e.NitroSsoDomainProvisioned="nitro_sso_domain_provisioned",e.NitroSsoDomainRemoved="nitro_sso_domain_removed",e.NitroSsoDomainVerified="nitro_sso_domain_verified",e.NitroSsoSetupStarted="nitro_sso_setup_started",e.TeamNameChanged="team_name_changed",e.NewBillingPeriodCreated="new_billing_period_created",e.SeatsAdded="seats_added",e.ContactEmailChanged="contact_email_changed",e.MasterPasswordMobileResetEnabled="master_password_mobile_reset_enabled",e.MasterPasswordMobileResetDisabled="master_password_mobile_reset_disabled",e.MasterPasswordMobileReset="master_password_mobile_reset",e.MasterPasswordChanged="master_password_changed",e.MpToViewPasswordsEnabled="mp_to_view_passwords_enabled",e.MpToViewPasswordsDisabled="mp_to_view_passwords_disabled",e.TwoFactorAuthenticationFailed="two_factor_authentication_failed",e.TwoFactorAuthenticationLoginMethodAdded="two_factor_authentication_login_method_added",e.TwoFactorAuthenticationLoginMethodRemoved="two_factor_authentication_login_method_removed",e.BiometricSignInDisabled="biometric_sign_in_disabled",e.DWMEmailAdded="dwm_email_added",e.DWMEmailRemoved="dwm_email_removed",e.DWMAlertReceived="dwm_alert_received",e.UserDeviceAdded="user_device_added",e.UserDeviceRemoved="user_device_removed",e.UserDeviceLogin="user_device_login",e.MasterPasswordReset="master_password_reset",e.RequestedAccountRecovery="requested_account_recovery",e.CompletedAccountRecovery="completed_account_recovery",e.UserSharedCredentialWithGroup="user_shared_credential_with_group",e.UserSharedCredentialWithEmail="user_shared_credential_with_email",e.UserSharedCredentialWithExternal="user_shared_credential_with_external",e.UserSharedSecureNoteWithGroup="user_shared_secure_note_with_group",e.UserSharedSecureNoteWithEmail="user_shared_secure_note_with_email",e.UserSharedSecureNoteWithExternal="user_shared_secure_note_with_external",e.UserRevokedSharedCredentialGroup="user_revoked_shared_credential_group",e.UserRevokedSharedCredentialEmail="user_revoked_shared_credential_email",e.UserRevokedSharedCredentialExternal="user_revoked_shared_credential_external",e.UserRevokedSharedSecureNoteGroup="user_revoked_shared_secure_note_group",e.UserRevokedSharedSecureNoteEmail="user_revoked_shared_secure_note_email",e.UserRevokedSharedSecureNoteExternal="user_revoked_shared_secure_note_external",e.UserAcceptedSharingInviteSecureNote="user_accepted_sharing_invite_secure_note",e.UserRejectedSharingInviteSecureNote="user_rejected_sharing_invite_secure_note",e.UserAcceptedSharingInviteCredential="user_accepted_sharing_invite_credential",e.UserRejectedSharingInviteCredential="user_rejected_sharing_invite_credential",e.UserAddedCredentialToCollection="user_added_credential_to_collection",e.UserCreatedCollection="user_created_collection",e.UserDeletedCollection="user_deleted_collection",e.UserImportedCollection="user_imported_collection",e.UserRemovedCredentialFromCollection="user_removed_credential_from_collection",e.UserRenamedCollection="user_renamed_collection",e.UserSharedCollectionWithUser="user_shared_collection_with_user",e.UserSharedCollectionWithGroup="user_shared_collection_with_usergroup",e.UserAcceptedCollection="user_accepted_collection_invite",e.UserRejectedCollection="user_rejected_collection_invite",e.UserAddedItemToCollection="user_added_credential_to_shared_collection",e.UserRemovedItemFromCollection="user_removed_credential_from_shared_collection",e.UserUpdatedGroupRoleInCollection="user_updated_collection_usergroup",e.UserUpdatedUserRoleInCollection="user_updated_collection_user",e.UserRenamedSharedCollection="user_renamed_shared_collection",e.UserRevokedGroupFromCollection="user_revoked_collection_usergroup",e.UserRevokedUserFromCollection="user_revoked_collection_user",e.UserCreatedCredential="user_created_credential",e.UserModifiedCredential="user_modified_credential",e.UserDeletedCredential="user_deleted_credential",e.UserImportedCredentials="user_imported_credentials",e.UserCreatedSecureNote="user_created_secure_note",e.UserModifiedSecureNote="user_modified_secure_note",e.UserDeletedSecureNote="user_deleted_secure_note",e.NudgeExecuted="nudge_executed",e.NudgeConfigured="nudge_configured",e.NitroIntegrationAppInstalled="nitro_integration_app_installed",e.NitroIntegrationAppUninstalled="nitro_integration_app_uninstalled",e.UserReceivedNudge="user_received_nudge",e.MassDeploymentConfigurationUpdated="mass_deployment_configuration_updated",e.UserTypedCompromisedPassword="user_typed_compromised_password",e.UserTypedWeakPassword="user_typed_weak_password",e.UserTypedPassword="user_typed_password",e.UserPerformedAutofillCredential="user_performed_autofill_credential",e.UserPerformedAutofillPayment="user_performed_autofill_payment",e.UserAuthenticatedWithPasskey="user_authenticated_with_passkey",e.UserRevealedCredentialField="user_revealed_credential_field",e.UserRevealedCreditCardField="user_revealed_credit_card_field",e.UserRevealedBankAccountField="user_revealed_bank_account_field",e.UserRevealedSecureNote="user_revealed_secure_note_field",e.UserRevealedSecret="user_revealed_secret_field",e.UserCopiedCredentialField="user_copied_credential_field",e.UserCopiedCreditCardField="user_copied_credit_card_field",e.UserCopiedBankAccountField="user_copied_bank_account_field",e.UserCopiedSecureNote="user_copied_secure_note_field",e.UserCopiedSecret="user_copied_secret_field",e.UserExcludedItemFromPasswordHealth="user_excluded_item_from_password_health",e.UserIncludedItemInPasswordHealth="user_included_item_in_password_health",e}({})},78989:(e,t,s)=>{s.d(t,{r:()=>n});var n=function(e){return e.SECURITY_ERROR="SECURITY_ERROR",e.INVALID_STATE_ERROR="INVALID_STATE_ERROR",e.ALGORITHM_NOT_SUPPORTED_ERROR="ALGORITHM_NOT_SUPPORTED_ERROR",e.PASSKEY_NOT_FOUND="PASSKEY_NOT_FOUND",e.PASSKEY_DECRYPTION_ERROR="PASSKEY_DECRYPTION_ERROR",e}({})},446:(e,t,s)=>{s.d(t,{d:()=>a,l:()=>i});var n=s(97143),r=s(62149);class i{constructor(e){(0,n._)(this,"body",void 0),this.body=e}}const a=(e={scope:r.F.User})=>{var t;return t=class extends i{},(0,n._)(t,"metadata",e),t}},59965:(e,t,s)=>{s.d(t,{T:()=>i});var n=s(17482),r=s(50123);const i=(0,s(75958).Q)({name:"icons",commands:{fetchIconForDomain:r.F},events:{},queries:{getIconForDomain:n.el}})},50123:(e,t,s)=>{s.d(t,{F:()=>i});var n=s(13385),r=s(62149);class i extends((0,n.g)({scope:r.F.Device})){}},17482:(e,t,s)=>{s.d(t,{Ct:()=>a,el:()=>c,xF:()=>o});var n=s(98124),r=s(77535),i=s(62149),a=function(e){return e.NotFound="notFound",e}({});const o=(0,n.Vj)("notFound","Icon not found");class c extends((0,r.k)({scope:i.F.User,useCache:!0})){}},4102:(e,t,s)=>{s.r(t),s.d(t,{ActiveUserQuery:()=>f.p,ActiveUserSetEvent:()=>f.W_,AnalyticsClient:()=>r.R,AnomalyCriticalityValues:()=>h.h_,AnomalyTypeValues:()=>h._F,ApplicationBuildType:()=>D.P,AuditLogCategory:()=>z.s,AuditLogType:()=>z.b,CommandMessage:()=>i.C,EMPTY_QUERY_RESULT:()=>c,EditSettingsForStagingCommand:()=>F.bH,EnableExceptionLogCommand:()=>g.w,EventMessage:()=>U.l,ExceptionLoggingClient:()=>m.G,ExceptionOriginValues:()=>h.KR,FeatureFlipsClient:()=>w.P,FetchIconForDomainCommand:()=>x.F,FileDownloadClient:()=>_,FileUploadClient:()=>I,FileUploadedEvent:()=>T.W,FilterOperationName:()=>o,GetIconForDomainQuery:()=>L.el,GetIconForDomainQueryErrorTypes:()=>L.Ct,GetKillSwitchQuery:()=>j.K,GetThemeQuery:()=>$.n,InvalidAuditLogError:()=>V,KillSwitches:()=>M,NullModuleApi:()=>y.w,PasskeyServiceErrorCode:()=>B.r,PlatformInfoClient:()=>O.c,PlatformInfoQuery:()=>N.a,QueryMessage:()=>a.M,RefreshAvailableLabsCommand:()=>S._x,ReportAnomalyCommand:()=>h.SU,RequestContextClient:()=>A.Q,SetActiveUserCommand:()=>f.r$,SetThemeCommand:()=>G.B,SettingsForStagingQuery:()=>F.Lt,ToggleLabCommand:()=>S.YM,TrackEventCommand:()=>n.L5,TrackPageViewCommand:()=>n.mf,UISettingsFeatureFlips:()=>q.H,UseCaseScope:()=>d.F,UserAvailableLabsQuery:()=>S._l,UserFeatureFlipQuery:()=>S.fV,UserFeatureFlipsQuery:()=>S.r6,WebServicesClient:()=>P,analyticsApi:()=>n.Yu,createGetIconForDomainQueryNotFoundError:()=>L.xF,defineCarbonCommand:()=>l.A,defineCommand:()=>l.g,defineEvent:()=>U.d,defineModuleApi:()=>v.Q,defineModuleClient:()=>b.E,defineQuery:()=>u.k,exceptionLoggingApi:()=>p.P,featureFlipsApi:()=>S.cV,fileDownloadApi:()=>E.L,fileUploadApi:()=>C.a,iconsApi:()=>R.T,isThemeName:()=>q.u,killSwitchApi:()=>k.m,platformInfoApi:()=>N.J,registerModuleClient:()=>b.K,requestContextApi:()=>f.t$,uiSettingsApi:()=>K.Z,webServicesApi:()=>F.Dm});var n=s(5574),r=s(24418),i=s(58349),a=s(75768),o=function(e){return e.Equals="equals",e.Differs="differs",e.Matches="matches",e.In="in",e.Contains="contains",e}({});const c={items:[],itemCount:0,page:1,pageCount:1};var d=s(62149),l=s(13385),u=s(77535),p=s(38430),m=s(54691),h=s(68327),g=s(41597),v=s(75958),y=s(33530),f=s(66335),b=s(8260),S=s(23297),w=s(43651),E=s(4166);class _ extends((0,b.E)(E.L)){}(0,b.K)(E.L,_);var C=s(58563);class I extends((0,b.E)(C.a)){}(0,b.K)(C.a,I);var T=s(7262),A=s(96498),U=s(446),N=s(74650),O=s(63604),D=s(69259),F=s(32446);class P extends((0,b.E)(F.Dm)){}(0,b.K)(F.Dm,P);var R=s(59965),x=s(50123),L=s(17482),k=s(35463),j=s(91247),M=function(e){return e.DisableAutofill="disableAutofill",e.BrazeContentCardsDisabled="brazeContentCardsDisabled",e.DisableLoginFlowMigration="disableLoginFlowMigration",e.DisableAutoSSOLogin="disableAutoSSOLogin",e}({}),z=s(59664),V=function(e){return e.AUDIT_LOG_MISSING_JSON_SCHEMA="AUDIT_LOG_MISSING_JSON_SCHEMA",e.AUDIT_LOG_INVALID_JSON_FOR_JSON_SCHEMA="AUDIT_LOG_INVALID_JSON_FOR_JSON_SCHEMA",e.AUDIT_LOG_INVALID_LOG_SCHEMA_TYPE_OR_VERSION="AUDIT_LOG_INVALID_LOG_SCHEMA_TYPE_OR_VERSION",e.AUDIT_LOG_ERROR_READING_JSON_SCHEMA="AUDIT_LOG_ERROR_READING_JSON_SCHEMA",e.STORING_SENSITIVE_AUDIT_LOGS_NOT_ALLOWED="STORING_SENSITIVE_AUDIT_LOGS_NOT_ALLOWED",e.AUDIT_LOG_TYPE_NOT_CLIENT_SIDE="AUDIT_LOG_TYPE_NOT_CLIENT_SIDE",e.AUDIT_LOG_TYPE_NOT_ALLOWED_FOR_MASS_DEPLOYMENT_TEAM_KEY_AUTH="AUDIT_LOG_TYPE_NOT_ALLOWED_FOR_MASS_DEPLOYMENT_TEAM_KEY_AUTH",e.AUDIT_LOG_TYPE_NOT_ALLOWED_WITH_CREDENTIAL_RISK_DETECTION_DISABLED="AUDIT_LOG_TYPE_NOT_ALLOWED_WITH_CREDENTIAL_RISK_DETECTION_DISABLED",e.AUDIT_LOG_TYPE_NOT_TEAM_DEVICE_OR_CLIENT_SIDE="AUDIT_LOG_TYPE_NOT_TEAM_DEVICE_OR_CLIENT_SIDE",e.AUDIT_LOG_MISSING_CATEGORY_TO_LOG_TYPE_MAPPING="AUDIT_LOG_MISSING_CATEGORY_TO_LOG_TYPE_MAPPING",e.AUDIT_LOG_STORE_INTERNAL_ERROR="AUDIT_LOG_STORE_INTERNAL_ERROR",e}({}),B=s(78989),K=s(97111),G=s(82226),$=s(20690),q=s(48484)},35463:(e,t,s)=>{s.d(t,{m:()=>i});var n=s(75958),r=s(91247);const i=(0,n.Q)({name:"killSwitch",commands:{},events:{},queries:{GetKillSwitchQuery:r.K}})},91247:(e,t,s)=>{s.d(t,{K:()=>i});var n=s(77535),r=s(62149);class i extends((0,n.k)({scope:r.F.Device,useCache:!0})){}},38430:(e,t,s)=>{s.d(t,{P:()=>i});var n=s(68327),r=s(41597);const i=(0,s(75958).Q)({name:"exceptionLogging",commands:{reportAnomaly:n.SU,enableExceptionLog:r.w},events:{},queries:{}})},54691:(e,t,s)=>{s.d(t,{G:()=>i});var n=s(38430),r=s(8260);class i extends((0,r.E)(n.P)){}(0,r.K)(n.P,i)},41597:(e,t,s)=>{s.d(t,{w:()=>i});var n=s(13385),r=s(62149);class i extends((0,n.g)({scope:r.F.Device})){}},68327:(e,t,s)=>{s.d(t,{KR:()=>o,SU:()=>c,_F:()=>a,h_:()=>i});var n=s(13385),r=s(62149);const i=Object.freeze({WARNING:"warning",CRITICAL:"critical"}),a=Object.freeze({EXCEPTION:"exception",OTHER:"other"}),o=Object.freeze({EXCEPTION_BOUNDARY:"exceptionBoundary",UNHANDLED_PROMISE_REJECTION:"unhandledPromiseRejection",UNCAUGHT_EXCEPTION:"uncaughtException"});class c extends((0,n.g)({scope:r.F.Device})){}},23297:(e,t,s)=>{s.d(t,{YM:()=>u,_l:()=>c,_x:()=>l,cV:()=>p,fV:()=>d,r6:()=>o});var n=s(75958),r=s(77535),i=s(62149),a=s(13385);class o extends((0,r.k)({scope:i.F.User,useCache:!0})){}class c extends((0,r.k)({scope:i.F.User})){}class d extends((0,r.k)({scope:i.F.User,useCache:!0})){}class l extends((0,a.g)({scope:i.F.User})){}class u extends((0,a.g)({scope:i.F.User})){}const p=(0,n.Q)({events:{},name:"featureFlips",queries:{UserFeatureFlipsQuery:o,UserFeatureFlipQuery:d,UserAvailableLabsQuery:c},commands:{RefreshAvailableLabsCommand:l,ToggleLabCommand:u}})},43651:(e,t,s)=>{s.d(t,{P:()=>i});var n=s(8260),r=s(23297);class i extends((0,n.E)(r.cV)){}(0,n.K)(r.cV,i)},4166:(e,t,s)=>{s.d(t,{L:()=>n});const n=(0,s(75958).Q)({events:{},name:"file-download",queries:{},commands:{}})},58563:(e,t,s)=>{s.d(t,{a:()=>r});var n=s(7262);const r=(0,s(75958).Q)({name:"file-upload",events:{fileUploadedEvent:n.W},queries:{},commands:{}})},7262:(e,t,s)=>{s.d(t,{W:()=>i});var n=s(446),r=s(62149);class i extends((0,n.d)({scope:r.F.User})){}},8260:(e,t,s)=>{s.d(t,{E:()=>r,K:()=>i});var n=s(97143);function r(e){var t;return t=class{get commands(){throw new Error("Not implemented")}get queries(){throw new Error("Not implemented")}},(0,n._)(t,"api",e),t}function i(e,t){e.ClientClass=t}},75958:(e,t,s)=>{s.d(t,{Q:()=>r});const n=(e,t)=>Object.entries(e).reduce(((e,[s,n])=>(e[((e,t)=>e.endsWith(t)?e.charAt(0).toLowerCase()+e.substring(1,e.length-t.length):e)(s,t)]=n,e)),{}),r=e=>({name:e.name,commands:n(e.commands,"Command"),queries:n(e.queries,"Query"),events:n(e.events,"Event")})},66335:(e,t,s)=>{s.d(t,{W_:()=>l,p:()=>c,r$:()=>d,t$:()=>u});var n=s(75958),r=s(77535),i=s(62149),a=s(13385),o=s(446);class c extends((0,r.k)({scope:i.F.Device,useCache:!0})){}class d extends((0,a.g)({scope:i.F.Device})){}class l extends((0,o.d)({scope:i.F.User})){}const u=(0,n.Q)({commands:{SetActiveUserCommand:d},events:{activeUserSet:l},name:"requestContext",queries:{ActiveUserQuery:c}})},96498:(e,t,s)=>{s.d(t,{Q:()=>i});var n=s(8260),r=s(66335);class i extends((0,n.E)(r.t$)){}(0,n.K)(r.t$,i)},33530:(e,t,s)=>{s.d(t,{w:()=>n});const n={name:"api",commands:{},events:{},queries:{}}},74650:(e,t,s)=>{s.d(t,{J:()=>o,a:()=>a});var n=s(77535),r=s(62149),i=s(75958);class a extends((0,n.k)({scope:r.F.Device,useCache:!0})){}const o=(0,i.Q)({name:"platformInfo",commands:{},events:{},queries:{PlatformInfoQuery:a}})},63604:(e,t,s)=>{s.d(t,{c:()=>i});var n=s(74650),r=s(8260);class i extends((0,r.E)(n.J)){}(0,r.K)(n.J,i)},69259:(e,t,s)=>{s.d(t,{P:()=>n});var n=function(e){return e.DEV="DEV",e.QA="QA",e.NIGHTLY="NIGHTLY",e.BETA="BETA",e.PRODUCTION="PRODUCTION",e}({})},97111:(e,t,s)=>{s.d(t,{Z:()=>i});var n=s(82226),r=s(20690);const i=(0,s(75958).Q)({name:"uiSettings",commands:{setThemeCommand:n.B},events:{},queries:{getThemeQuery:r.n}})},82226:(e,t,s)=>{s.d(t,{B:()=>i});var n=s(13385),r=s(62149);class i extends((0,n.g)({scope:r.F.Device})){}},20690:(e,t,s)=>{s.d(t,{n:()=>i});var n=s(77535),r=s(62149);class i extends((0,n.k)({scope:r.F.Device,useCache:!0})){}},48484:(e,t,s)=>{s.d(t,{H:()=>r,u:()=>n});const n=e=>"string"==typeof e&&["light","dark","debug","system"].includes(e);var r=function(e){return e.ThemeSwitch="sharingVault_web_darkModeToggle",e.TACDarkMode="sharingVault_web_darkModeTAC",e.DebugTheme="web_settings_appearance_debug_theme",e}({})},32446:(e,t,s)=>{s.d(t,{Dm:()=>d,Lt:()=>o,bH:()=>c});var n=s(77535),r=s(62149),i=s(13385),a=s(75958);class o extends((0,n.k)({scope:r.F.Device})){}class c extends((0,i.g)({scope:r.F.Device})){}const d=(0,a.Q)({commands:{EditSettingsForStagingCommand:c},events:{},name:"webServices",queries:{SettingsForStagingQuery:o}})},23047:(e,t,s)=>{s.d(t,{I:()=>m});var n=s(92336),r=s(5574),i=s(86006),a=s(82874),o=s(78346),c=s(14122),d=s(92587);class l{async trackEvent(e){const{carbon:t}=this.carbonLegacyClient.commands,s=await t({name:"logEvent",args:[{event:e}]});if((0,o.hx)(s))throw new Error("TrackEvent from carbon failed")}async trackPageView(e,t){const{carbon:s}=this.carbonLegacyClient.commands,n=await s({name:"logPageView",args:[{pageView:e,browseComponent:t}]});if((0,o.hx)(n))throw new Error("TrackPageView from carbon failed")}constructor(e){this.carbonLegacyClient=e}}l=(0,n.gn)([(0,d.GS)(),(0,n.w6)("design:type",Function),(0,n.w6)("design:paramtypes",[void 0===c._?Object:c._])],l);class u{async execute({body:{event:e}}){return await this.analyticsService.trackEvent(e),(0,o.Vp)(void 0)}constructor(e){this.analyticsService=e}}u=(0,n.gn)([(0,a.W)(r.L5),(0,n.w6)("design:type",Function),(0,n.w6)("design:paramtypes",[void 0===l?Object:l])],u);class p{async execute({body:{pageView:e,browseComponent:t}}){return await this.analyticsService.trackPageView(e,t),(0,o.Vp)(void 0)}constructor(e){this.analyticsService=e}}p=(0,n.gn)([(0,a.W)(r.mf),(0,n.w6)("design:type",Function),(0,n.w6)("design:paramtypes",[void 0===l?Object:l])],p);class m{}m=(0,n.gn)([(0,i.Y)({api:r.Yu,providers:[l],handlers:{commands:{trackEvent:u,trackPageView:p},events:{},queries:{}},domainName:"framework"})],m)},71171:(e,t,s)=>{s.d(t,{y:()=>a});var n=s(92336),r=s(92587),i=s(66481);class a{async derive(e,t,s){const{deriveKeyArgon2d:n}=this.config.crypto;return await n(e,t,s)}constructor(e){this.config=e}}a=(0,n.gn)([(0,r.GS)(),(0,n.w6)("design:type",Function),(0,n.w6)("design:paramtypes",[void 0===i.i?Object:i.i])],a)},66481:(e,t,s)=>{s.d(t,{i:()=>a});var n=s(92336),r=s(92587);const i={computeHash:()=>Promise.resolve(new ArrayBuffer(32)),decryptAes256:(e,t,s)=>Promise.resolve(s),deriveKeyArgon2d:()=>Promise.resolve(new ArrayBuffer(32)),deriveKeyPbkdf2:()=>Promise.resolve(new ArrayBuffer(32)),encryptAes256:(e,t,s)=>Promise.resolve(s),generateKeyAes256:()=>Promise.resolve(new ArrayBuffer(32)),generateKeyPairRsaOaep:()=>Promise.resolve({privateKey:new ArrayBuffer(32),publicKey:new ArrayBuffer(32)}),getRandomValues:e=>new Uint8Array(e),signHmacSha:()=>Promise.resolve(new ArrayBuffer(32)),unsafeComputeMd5Hash:()=>new ArrayBuffer(1),verifyHmacSha:()=>Promise.resolve(!0),decryptRsaOaep:function(e,t){return Promise.resolve(t)},encryptRsaOaep:function(e,t){return Promise.resolve(t)},signRsassaPkcs1:function(e,t){return Promise.resolve(t)},verifyRsassaPkcs1:()=>Promise.resolve(!0)};class a{constructor(e){this.crypto=e}}new(a=(0,n.gn)([(0,r.GS)(),(0,n.w6)("design:type",Function),(0,n.w6)("design:paramtypes",["undefined"==typeof CryptoPrimitives?Object:CryptoPrimitives])],a))(i)},40416:(e,t,s)=>{s.d(t,{D:()=>Q});var n=s(92336),r=s(86006),i=s(71171),a=s(66481),o=s(80717),c=s(85603),d=s(82059),l=s(81929),u=s(7473),p=s(36041),m=s(60679),h=s(10363),g=s(58496),v=s(53415),y=s(62623),f=s(61805),b=s(49504),S=s(48702),w=s(92698),E=s(55667),_=s(52987),C=s(66329),I=s(92587),T=s(56742),A=s(44647);const U="flexible";var N=s(83806);const O="KWC3",D=0;var F=s(3440);const P=32,R=4;function x(e){const t=e.slice(P,P+R),s=(0,A.v)(t);var n;if(n=s,[O,F.PD].includes(n))return s}function L(e){const t=x(e);return t||(function(e){const t=new Uint8Array(e).slice(0,1);return(0,A.v)(t.buffer)===N.F}(e)?U:void 0)}var k=s(53048),j=s(11458),M=s(28868),z=s(93704);const V={type:O,derivation:M.Yi,cipher:z.No};function B(e){const t=function({transportableData:e,marker:t}){const{derivation:s,type:n}=t,{saltLength:r}=s,i=D+r+n.length;return{salt:e.slice(D,D+r),encipheredContents:e.slice(i)}}({transportableData:e,marker:V});return{salt:t.salt,type:O,encipheredContents:t.encipheredContents,derivationConfig:M.Yi,cipherConfig:z.No}}var K=s(4557);async function G(e,t,s,n){const r=B(n),{deriveKeyPbkdf2:i}=t,{derivationConfig:a,salt:o}=r,c=await(0,K.E)(i,s,a,e,o),{computeHash:d}=t,{cipherConfig:{ivLength:l,bytesToKey:{iterations:u,keyLength:p}}}=r,m=await async function(e,t,s,n,r,i){const a=(0,j.K)(t,i.slice(0,8));let o=a,c=new ArrayBuffer(0);for(let t=0;t<s;t++){const t=await e(o,"SHA-1");c=(0,j.K)(c,t),o=(0,j.K)(t,a)}const d=r+n;return Promise.resolve(c.slice(r,d))}(d,c,u,l,p,o),{decryptAes256:h}=t,{encipheredContents:g}=r;return h(c,m,g)}var $=s(45302);class q{decrypt(e,t){return async function(e,t,s,n){const r=L(n);if(!r)throw new Error("Cannot find marker type");switch(r){case O:return await G(e,t,s,n);case F.PD:return await(0,$.I)(e,t,n);case U:return(0,k.F)(e,t,s,n);default:(0,T.U)(r)}}(e,this.config.crypto,this.derivationCache,t)}constructor(e,t){this.config=e,this.derivationCache=t}}q=(0,n.gn)([(0,I.GS)(),(0,n.w6)("design:type",Function),(0,n.w6)("design:paramtypes",[void 0===a.i?Object:a.i,void 0===o.E?Object:o.E])],q);var H=s(86308),W=s(15996);class Q{static configure(e){return{module:Q,configurations:{infrastructure:e}}}}Q=(0,n.gn)([(0,r.Y)({sharedModuleName:"cryptography",configurations:{infrastructure:{token:a.i}},providers:[i.y,o.E,c.a,d._,H.y,l.q,u.a,p.c,m.$,h.o,g.k,v.n,y.F,C.Y,f.g,b.H,S.e,w.k,W.u,E.Z,q,_.f],exports:[i.y,o.E,c.a,d._,H.y,l.q,u.a,p.c,m.$,h.o,g.k,v.n,y.F,C.Y,f.g,b.H,S.e,w.k,W.u,E.Z,q,_.f],domainName:"framework"})],Q)},80717:(e,t,s)=>{s.d(t,{E:()=>d});var n=s(92336),r=s(92587),i=s(97143),a=s(11458),o=s(19911);class c{getCacheKey(...e){const t=e.reduce(((e,t)=>(0,a.K)(e,t)),new ArrayBuffer(0));return(0,o.s)(t)}getCachedDerivation(e){return this.derivateKeyCache.get(e)}setCachedDerivation({cacheKey:e,data:t}){this.getCachedDerivation(e)||this.derivateKeyCache.set(e,t)}constructor(){(0,i._)(this,"derivateKeyCache",void 0),this.derivateKeyCache=new Map}}class d extends c{}d=(0,n.gn)([(0,r.GS)()],d)},85603:(e,t,s)=>{s.d(t,{a:()=>c});var n=s(92336),r=s(92587),i=s(53048),a=s(66481),o=s(80717);class c{decrypt(e,t){return(0,i.F)(e,this.config.crypto,this.derivationCache,t)}constructor(e,t){this.config=e,this.derivationCache=t}}c=(0,n.gn)([(0,r.GS)(),(0,n.w6)("design:type",Function),(0,n.w6)("design:paramtypes",[void 0===a.i?Object:a.i,void 0===o.E?Object:o.E])],c)},82059:(e,t,s)=>{s.d(t,{_:()=>b});var n=s(92336),r=s(92587),i=s(11458),a=s(59858),o=s(13574),c=s(97633),d=s(56742),l=s(59503),u=s(83806),p=s(62690),m=s(28868);function h(e){const t=u.F+e.join(u.F)+u.F;return(0,l.u)(t)}function g({cipher:e,derivation:t}){const{algorithm:s}=t;switch(s){case"argon2d":return function({cipher:e,derivation:t}){const{count:s,index:n}=p.ARGON2D_MARKER_SCHEMA,r=new Array(s);return r[n.version]=u.g,r[n.derivation]=t.algorithm,r[n.saltLength]=t.saltLength,r[n.tCost]=t.tCost,r[n.mCost]=t.mCost,r[n.parallelism]=t.parallelism,r[n.cipher]=e.algorithm,r[n.mode]=e.mode,r[n.ivLength]=e.ivLength,h(r)}({cipher:e,derivation:t});case"pbkdf2":return function({cipher:e,derivation:t}){const{count:s,index:n}=p.PBKDF2_MARKER_SCHEMA,r=new Array(s);return r[n.version]=u.g,r[n.derivation]=t.algorithm,r[n.saltLength]=t.saltLength,r[n.iterations]=t.iterations,r[n.hashAlgorithm]=t.hashAlgorithm,r[n.cipher]=e.algorithm,r[n.mode]=e.mode,r[n.ivLength]=e.ivLength,h(r)}({cipher:e,derivation:t});case"noderivation":return function({cipher:e,derivation:t}){const{count:s,index:n}=p.NODERIVATION_MARKER_SCHEMA,r=new Array(s);return r[n.version]=u.g,r[n.derivation]=t.algorithm,r[n.cipher]=e.algorithm,r[n.mode]=e.mode,r[n.ivLength]=e.ivLength,h(r)}({cipher:e,derivation:t});default:(0,d.U)(s)}}async function v(e,t,s,n,r,d,l){const{algorithm:u}=s,p="pbkdf2"===u||"argon2d"===u;if(p&&!l?.salt)throw new Error("Need salt for derivation");const{deriveKeyArgon2d:h,deriveKeyPbkdf2:v}=t,y=p&&l?.salt?await(0,c.b)(e,l.salt,v,h,s,n):e,{mode:f}=r,{computeHash:b}=t,{encryptionKey:S,signatureKey:w}="cbchmac64"===f?await(0,a.U)(y):await(0,o.Y)(y,b),{getRandomValues:E}=t,_=E(r.ivLength),{encryptAes256:C}=t,I=await C(S,_,d),{signHmacSha:T}=t,A=(0,i.K)(_,I),U=await T(w,A);return function(e){const{encipheredContents:t,cipherConfig:s,derivationConfig:n,salt:r,signature:a,iv:o}=e;if((r?.byteLength??0)!==(0,m.m9)(n))throw new Error(`Salt length ${r?.byteLength??0} does not match derivation algorithm ${n.algorithm} expectation`);const c=g({cipher:s,derivation:n});return r&&"noderivation"!==n.algorithm?(0,i.K)(c,r,o,a,t):(0,i.K)(c,o,a,t)}({type:"flexible",version:1,derivationConfig:s,cipherConfig:r,salt:l?.salt,iv:_,signature:U,encipheredContents:I})}var y=s(66481),f=s(80717);class b{async encrypt(e,t,s,n,r){return await v(e,this.config.crypto,s,this.derivationCache,n,t,r)}constructor(e,t){this.config=e,this.derivationCache=t}}b=(0,n.gn)([(0,r.GS)(),(0,n.w6)("design:type",Function),(0,n.w6)("design:paramtypes",[void 0===y.i?Object:y.i,void 0===f.E?Object:f.E])],b)},86308:(e,t,s)=>{s.d(t,{y:()=>c});var n=s(92336),r=s(92587),i=s(53048);var a=s(66481),o=s(80717);class c{verifySignature(e,t){return async function(e,t,s,n){const{verifyHmacSha:r}=t,{signatureKey:a,signature:o,dataToSign:c}=await(0,i.V)(e,t,s,n);return r(a,o,c)}(e,this.config.crypto,this.derivationCache,t)}constructor(e,t){this.config=e,this.derivationCache=t}}c=(0,n.gn)([(0,r.GS)(),(0,n.w6)("design:type",Function),(0,n.w6)("design:paramtypes",[void 0===a.i?Object:a.i,void 0===o.E?Object:o.E])],c)},81929:(e,t,s)=>{s.d(t,{q:()=>o});var n=s(92336),r=s(92587),i=s(56782),a=s(66481);class o{async sign(e,t,s=i.x){const{signHmacSha:n}=this.config.crypto;return await n(e,t,s)}constructor(e){this.config=e}}o=(0,n.gn)([(0,r.GS)(),(0,n.w6)("design:type",Function),(0,n.w6)("design:paramtypes",[void 0===a.i?Object:a.i])],o)},7473:(e,t,s)=>{s.d(t,{a:()=>o});var n=s(92336),r=s(92587),i=s(56782),a=s(66481);class o{async verify(e,t,s,n=i.x){const{verifyHmacSha:r}=this.config.crypto;return await r(e,t,s,n)}constructor(e){this.config=e}}o=(0,n.gn)([(0,r.GS)(),(0,n.w6)("design:type",Function),(0,n.w6)("design:paramtypes",[void 0===a.i?Object:a.i])],o)},36041:(e,t,s)=>{s.d(t,{c:()=>a});var n=s(92336),r=s(92587),i=s(66481);class a{generate(){const{generateKeyAes256:e}=this.config.crypto;return e()}constructor(e){this.config=e}}a=(0,n.gn)([(0,r.GS)(),(0,n.w6)("design:type",Function),(0,n.w6)("design:paramtypes",[void 0===i.i?Object:i.i])],a)},60679:(e,t,s)=>{s.d(t,{$:()=>o});var n=s(92336),r=s(92587),i=s(45302),a=s(66481);class o{decrypt(e,t){return(0,i.I)(e,this.config.crypto,t)}constructor(e){this.config=e}}o=(0,n.gn)([(0,r.GS)(),(0,n.w6)("design:type",Function),(0,n.w6)("design:paramtypes",[void 0===a.i?Object:a.i])],o)},10363:(e,t,s)=>{s.d(t,{o:()=>m});var n=s(92336),r=s(92587),i=s(93704),a=s(11458),o=s(59503),c=s(3440);var d=s(13574);async function l(e,t,s,n,r,i){const{computeHash:l}=t,{encryptionKey:u,signatureKey:p}=await(0,d.Y)(e,l),{getRandomValues:m}=t,{ivLength:h}=n,g=m(h),{encryptAes256:v}=t,y=await v(u,g,r),{signHmacSha:f}=t,b=(0,a.K)(g,y),S={type:"KWC5",derivationConfig:s,cipherConfig:n,iv:g,signature:await f(p,b),encipheredContents:y},{padding:w}=i;return function({secureData:e,randomValues:t}){if(t.byteLength!==c.en)throw new Error("Encoding kwc5 requires 16 random bytes");const{encipheredContents:s,iv:n,type:r,signature:i}=e,d=(0,o.u)(r);return(0,a.K)(n,t,d,i,s)}({secureData:S,randomValues:w})}var u=s(28868),p=s(66481);class m{encrypt(e,t){const{getRandomValues:s}=this.config.crypto,n={padding:s(i.BU.padding)};return l(e,this.config.crypto,u.oo,i.BU,t,n)}constructor(e){this.config=e}}m=(0,n.gn)([(0,r.GS)(),(0,n.w6)("design:type",Function),(0,n.w6)("design:paramtypes",[void 0===p.i?Object:p.i])],m)},85805:(e,t,s)=>{function n(){return new Uint32Array([57920321,977424202,1999259334,3390546403,3917439743,16505144,3027631148,3235565160,2643335823,1420105356,998514539,2704347781,1011257802,823882961,790991339,3929284516]).buffer}s.d(t,{S:()=>n})},58496:(e,t,s)=>{s.d(t,{k:()=>o});var n=s(92336),r=s(92587),i=s(85603),a=s(85805);class o{async decrypt(e){const t=(0,a.S)();return await this.flexibleDecryptor.decrypt(t,e)}constructor(e){this.flexibleDecryptor=e}}o=(0,n.gn)([(0,r.GS)(),(0,n.w6)("design:type",Function),(0,n.w6)("design:paramtypes",[void 0===i.a?Object:i.a])],o)},53415:(e,t,s)=>{s.d(t,{n:()=>c});var n=s(92336),r=s(92587),i=s(44647),a=s(58496),o=s(62623);class c{async encode(e){return await this.obfuscationKeyEncryptor.encrypt(e)}async decode(e){return(0,i.v)(e).startsWith("$1$noderivation$aes256$cbchmac64$16$")?await this.obfuscationKeyDecryptor.decrypt(e):e}constructor(e,t){this.obfuscationKeyDecryptor=e,this.obfuscationKeyEncryptor=t}}c=(0,n.gn)([(0,r.GS)(),(0,n.w6)("design:type",Function),(0,n.w6)("design:paramtypes",[void 0===a.k?Object:a.k,void 0===o.F?Object:o.F])],c)},62623:(e,t,s)=>{s.d(t,{F:()=>d});var n=s(92336),r=s(92587),i=s(28868),a=s(93704),o=s(82059),c=s(85805);class d{async encrypt(e){const t=(0,c.S)();return await this.flexibleEncryptor.encrypt(t,e,i.oo,a.gO)}constructor(e){this.flexibleEncryptor=e}}d=(0,n.gn)([(0,r.GS)(),(0,n.w6)("design:type",Function),(0,n.w6)("design:paramtypes",[void 0===o._?Object:o._])],d)},66329:(e,t,s)=>{s.d(t,{Y:()=>a});var n=s(92336),r=s(92587),i=s(66481);class a{get(e){const{getRandomValues:t}=this.config.crypto;return t(e).buffer}constructor(e){this.config=e}}a=(0,n.gn)([(0,r.GS)(),(0,n.w6)("design:type",Function),(0,n.w6)("design:paramtypes",[void 0===i.i?Object:i.i])],a)},61805:(e,t,s)=>{s.d(t,{g:()=>a});var n=s(92336),r=s(92587),i=s(66481);class a{decrypt(e,t,s="SHA-256"){const{decryptRsaOaep:n}=this.config.crypto;return n(e,t,s)}constructor(e){this.config=e}}a=(0,n.gn)([(0,r.GS)(),(0,n.w6)("design:type",Function),(0,n.w6)("design:paramtypes",[void 0===i.i?Object:i.i])],a)},49504:(e,t,s)=>{s.d(t,{H:()=>a});var n=s(92336),r=s(92587),i=s(66481);class a{encrypt(e,t,s="SHA-256"){const{encryptRsaOaep:n}=this.config.crypto;return n(e,t,s)}constructor(e){this.config=e}}a=(0,n.gn)([(0,r.GS)(),(0,n.w6)("design:type",Function),(0,n.w6)("design:paramtypes",[void 0===i.i?Object:i.i])],a)},48702:(e,t,s)=>{s.d(t,{e:()=>a});var n=s(92336),r=s(92587),i=s(66481);class a{generate(e="SHA-256"){const{generateKeyPairRsaOaep:t}=this.config.crypto;return t(e)}constructor(e){this.config=e}}a=(0,n.gn)([(0,r.GS)(),(0,n.w6)("design:type",Function),(0,n.w6)("design:paramtypes",[void 0===i.i?Object:i.i])],a)},92698:(e,t,s)=>{s.d(t,{k:()=>a});var n=s(92336),r=s(92587),i=s(66481);class a{async sign(e,t,s="SHA-256"){const{signRsassaPkcs1:n}=this.config.crypto;return await n(e,t,s)}constructor(e){this.config=e}}a=(0,n.gn)([(0,r.GS)(),(0,n.w6)("design:type",Function),(0,n.w6)("design:paramtypes",[void 0===i.i?Object:i.i])],a)},15996:(e,t,s)=>{s.d(t,{u:()=>o});var n=s(92336),r=s(92587),i=s(49869),a=s(66481);class o{async verify(e,t,s,n=i.Tt){const{verifyRsassaPkcs1:r}=this.config.crypto;return await r(e,t,s,n)}constructor(e){this.config=e}}o=(0,n.gn)([(0,r.GS)(),(0,n.w6)("design:type",Function),(0,n.w6)("design:paramtypes",[void 0===a.i?Object:a.i])],o)},55667:(e,t,s)=>{s.d(t,{Z:()=>a});var n=s(92336),r=s(92587),i=s(66481);class a{async compute(e,t){const{computeHash:s}=this.config.crypto;return await s(e,t)}constructor(e){this.config=e}}a=(0,n.gn)([(0,r.GS)(),(0,n.w6)("design:type",Function),(0,n.w6)("design:paramtypes",[void 0===i.i?Object:i.i])],a)},52987:(e,t,s)=>{s.d(t,{f:()=>a});var n=s(92336),r=s(92587),i=s(66481);class a{compute(e){const{unsafeComputeMd5Hash:t}=this.config.crypto;return t(e)}constructor(e){this.config=e}}a=(0,n.gn)([(0,r.GS)(),(0,n.w6)("design:type",Function),(0,n.w6)("design:paramtypes",[void 0===i.i?Object:i.i])],a)},76500:(e,t,s)=>{s.d(t,{l:()=>y});var n=s(92336),r=s(92587),i=s(99081),a=s(72394),o=s(67621),c=s(33253),d=s(65967),l=s(43685),u=s(26755),p=s(7493),m=s(35955),h=s(96236),g=s(62306),v=s(81646);class y{get enclaveUrl(){return this.enclaveApiSettings.enclaveUrl}get auditLogs(){return this.auditLogsService}get auditLogsMassDeployment(){return this.auditLogsMassDeploymentService}get authentication(){return this.authenticationService}get domains(){return this.domainsService}get passkeys(){return this.passkeysService}get idps(){return this.idpsService}get scim(){return this.scimService}get siem(){return this.siemService}get slack(){return this.slackService}get teams(){return this.teamService}get uvvs(){return this.uvvsService}constructor(e,t,s,n,r,i,a,o,c,d,l,u){this.auditLogsService=e,this.auditLogsMassDeploymentService=t,this.authenticationService=s,this.domainsService=n,this.idpsService=r,this.passkeysService=i,this.scimService=a,this.siemService=o,this.slackService=c,this.teamService=d,this.enclaveApiSettings=l,this.uvvsService=u}}y=(0,n.gn)([(0,r.GS)(),(0,n.w6)("design:type",Function),(0,n.w6)("design:paramtypes",[void 0===o.Z?Object:o.Z,void 0===c.A?Object:c.A,void 0===d.$?Object:d.$,void 0===l.t?Object:l.t,void 0===u.L?Object:u.L,void 0===p.n?Object:p.n,void 0===m.b?Object:m.b,void 0===h.L?Object:h.L,void 0===g.v?Object:g.v,void 0===v.U?Object:v.U,void 0===i.N6?Object:i.N6,void 0===a.B?Object:a.B])],y)},99081:(e,t,s)=>{s.d(t,{$m:()=>i,Ep:()=>r,N6:()=>n});class n{constructor(e,t,s,n,r){this.appKeys=e,this.cloudflareHeaders=t,this.enclaveUrl=s,this.enclaveProxyUrl=n,this.environment=r}}const r=e=>"local"===e?"MIICqzCCAjKgAwIBAgIUGdKnU0kGWeXtXL7BK1VpIbnjXZkwCgYIKoZIzj0EAwMwgYQxCzAJBgNVBAYTAkZSMQ8wDQYDVQQIDAZGcmFuY2UxDjAMBgNVBAcMBVBhcmlzMQswCQYDVQQKDAJETDELMAkGA1UECwwCREwxFjAUBgNVBAMMDU5pdHJvIFRlc3QgQ0ExIjAgBgkqhkiG9w0BCQEWE3NlcnZlckBkYXNobGFuZS5jb20wHhcNMjIwNDI3MTI0NTQ5WhcNNDIwNDIyMTI0NTQ5WjCBhDELMAkGA1UEBhMCRlIxDzANBgNVBAgMBkZyYW5jZTEOMAwGA1UEBwwFUGFyaXMxCzAJBgNVBAoMAkRMMQswCQYDVQQLDAJETDEWMBQGA1UEAwwNTml0cm8gVGVzdCBDQTEiMCAGCSqGSIb3DQEJARYTc2VydmVyQGRhc2hsYW5lLmNvbTB2MBAGByqGSM49AgEGBSuBBAAiA2IABLeu4raurW6XA9/c13rzPwzbk1aYAR/fPj49YoaZI+K0PFfo75rKUr0m7LawW/jpwkAqWad44SXxj2fF+REDz4ii8tUjVl8Ijp1ohrQEAvDZLcxS98bQV+NFmoyx6QxbQKNjMGEwHQYDVR0OBBYEFM5p3QEkzjDGWRntWRdqC0aWiGiaMB8GA1UdIwQYMBaAFM5p3QEkzjDGWRntWRdqC0aWiGiaMA8GA1UdEwEB/wQFMAMBAf8wDgYDVR0PAQH/BAQDAgGGMAoGCCqGSM49BAMDA2cAMGQCMGdird9+5r9vw9vt2x4q86nMJwu2eGXbcOE6sVRSQ92nWYHk2VX2NZix1tBX3nMGiQIwRHALNGgnkUofNBOoxZ/Pntk14Djv5Kt3/fKd6NWFRhyFZ97jho4c+slS7u9LrttE":"MIICETCCAZagAwIBAgIRAPkxdWgbkK/hHUbMtOTn+FYwCgYIKoZIzj0EAwMwSTELMAkGA1UEBhMCVVMxDzANBgNVBAoMBkFtYXpvbjEMMAoGA1UECwwDQVdTMRswGQYDVQQDDBJhd3Mubml0cm8tZW5jbGF2ZXMwHhcNMTkxMDI4MTMyODA1WhcNNDkxMDI4MTQyODA1WjBJMQswCQYDVQQGEwJVUzEPMA0GA1UECgwGQW1hem9uMQwwCgYDVQQLDANBV1MxGzAZBgNVBAMMEmF3cy5uaXRyby1lbmNsYXZlczB2MBAGByqGSM49AgEGBSuBBAAiA2IABPwCVOumCMHzaHDimtqQvkY4MpJzbolL//Zy2YlES1BR5TSksfbb48C8WBoyt7F2Bw7eEtaaP+ohG2bnUs990d0JX28TcPQXCEPZ3BABIeTPYwEoCWZEh8l5YoQwTcU/9KNCMEAwDwYDVR0TAQH/BAUwAwEB/zAdBgNVHQ4EFgQUkCW1DdkFR+eWw5b6cp3PmanfS5YwDgYDVR0PAQH/BAQDAgGGMAoGCCqGSM49BAMDA2kAMGYCMQCjfy+Rocm9Xue4YnwWmNJVA44fA0P5W2OpYow9OYCVRaEevL8uO1XYru5xtMPWrfMCMQCi85sWBbJwKKXdS6BptQFuZbT73o/gBh1qUxl/nNr12UO8Yfwr6wPLb+6NIwLz3/Y=",i=e=>"local"===e?{0:"9e33eca6497ec3b68ae13735cd28b1a9be1235d3440f10121327150495de4a4f854eb902a62991b366757f3d87ce57e4"}:"staging"===e?{3:"90528150e0f0537fa9e96b067137f6494d525f2fcfd15b478ce28ab2cfaf38dd4e24ad73f9d9d6f238a7f39f2d1956b7"}:{3:"dfb6428f132530b8c021bea8cbdba2c87c96308ba7e81c7aff0655ec71228122a9297fd31fe5db7927a7322e396e4c16",8:"4dbb92401207e019e132d86677857081d8e4d21f946f3561b264b7389c6982d3a86bcf9560cef4a2327eac5c5c6ab820"}},19961:(e,t,s)=>{s.d(t,{G:()=>_});var n=s(92336),r=s(86006),i=s(75421),a=s(5206),o=s(76500),c=s(99081),d=s(43841),l=s(65967),u=s(43685),p=s(26755),m=s(35955),h=s(96236),g=s(62306),v=s(81646),y=s(72394),f=s(41511),b=s(67621),S=s(33253),w=s(40515),E=s(7493);class _{static configure(e){return{module:_,configurations:{enclaveApiSettings:e}}}}_=(0,n.gn)([(0,r.Y)({sharedModuleName:"enclave",providers:[o.l,b.Z,S.A,l.$,d.d,u.t,w.lK,p.L,E.n,m.b,h.L,g.v,v.U,y.B],exports:[o.l],stores:[],imports:[i.X,a.i,f.n],configurations:{enclaveApiSettings:{token:c.N6}},domainName:"framework"})],_)},65967:(e,t,s)=>{s.d(t,{$:()=>p});var n=s(92336),r=s(7165),i=s(92587),a=s(78346),o=s(43841),c=function(e){return e.AUTH_CONFIRM_LOGIN="api/authentication/ConfirmLogin2",e.AUTH_REQUEST_LOGIN="api/authentication/RequestLogin2",e.AUTH_REQUEST_TEST_LOGIN="api/authentication/RequestTestLogin2",e.AUTH_CONFIRM_TEST_LOGIN="api/authentication/ConfirmTestLogin3",e}({});r.z.object({login:r.z.string()});const d=r.z.object({idpAuthorizeUrl:r.z.string(),teamUuid:r.z.string(),spCallbackUrl:r.z.string(),domainName:r.z.string()});r.z.object({teamUuid:r.z.string(),samlResponse:r.z.string(),domainName:r.z.string()});const l=r.z.object({exists:r.z.boolean(),ssoToken:r.z.string(),userServiceProviderKey:r.z.string(),currentAuthenticationMethods:r.z.string().array(),expectedAuthenticationMethods:r.z.string().array()});r.z.object({teamUuid:r.z.string(),adminProvisioningKey:r.z.string(),idpUuid:r.z.string().optional()});const u=r.z.object({idpAuthorizeUrl:r.z.string(),spCallbackUrl:r.z.ostring()});r.z.object({teamUuid:r.z.string(),adminProvisioningKey:r.z.string(),idpUuid:r.z.string(),samlResponse:r.z.string()});class p{async requestLogin(e){const t=await this.enclaveService.callEnclaveEndpoint({endpoint:c.AUTH_REQUEST_LOGIN,body:e,responseSchema:d});return(0,a.Vp)(t)}async confirmLogin(e){const t=await this.enclaveService.callEnclaveEndpoint({endpoint:c.AUTH_CONFIRM_LOGIN,body:e,responseSchema:l});return(0,a.Vp)(t)}async requestTestLogin(e){const t=await this.enclaveService.callEnclaveEndpoint({endpoint:c.AUTH_REQUEST_TEST_LOGIN,body:e,responseSchema:u});return(0,a.Vp)(t)}async confirmTestLogin(e){return await this.enclaveService.callEnclaveEndpoint({endpoint:c.AUTH_CONFIRM_TEST_LOGIN,body:e,responseSchema:r.z.object({})}),(0,a.Vp)(void 0)}constructor(e){this.enclaveService=e}}p=(0,n.gn)([(0,i.GS)(),(0,n.w6)("design:type",Function),(0,n.w6)("design:paramtypes",[void 0===o.d?Object:o.d])],p)},43841:(e,t,s)=>{s.d(t,{d:()=>C});var n=s(92336),r=s(64987),i=s(92587),a=s(26549),o=s(99081);const c=(e,t)=>({clientHelloUrl:`${e}api/tunnel/ClientHello`,terminateHelloUrl:`${e}api/tunnel/TerminateHello`,secureContentUrl:`${e}${t}`});var d=s(75377),l=s(52799),u=s(60399),p=s(78346),m=s(7165);const h=e=>{const t=e.match(/[\da-f]{2}/gi);return t?new Uint8Array(t.map((e=>parseInt(e,16)))).buffer:(new Uint8Array).buffer},g=m.z.object({data:m.z.object({attestation:m.z.string(),clientIdentifier:m.z.string()}),requestId:m.z.string()});class v{decode(e){const t=g.safeParse(e);if(!t.success)throw new Error("Invalid response format");return{attestation:h(t.data.data.attestation),clientIdentifier:t.data.data.clientIdentifier}}}const y=async(e,t)=>{const{headers:s,httpClient:n,publicKey:r}=t,i=await(async e=>(await d.ready,{clientPublicKey:d.to_hex(e)}))(r),a=await(0,u.z)(n.post(e,i,{observe:"body",responseType:"json",responseBodyDecoder:new v,withCredentials:!0,headers:s}));if((0,p.hx)(a))throw new Error("string"==typeof a.error?a.error:"HTTP Error");return a.data};var f=s(1695);const b=async e=>{await d.ready;const{enclaveApiSettings:{cloudflareHeaders:t,enclaveUrl:s},rootCertBER:n,expectedPCRs:r,httpClient:i,platformInfo:a}=e,o={};o["dashlane-client-agent"]=JSON.stringify({platform:a.platformName,osversion:a.osVersion,version:a.appVersion}),t.accessKey&&t.secretKey&&(o["CF-Access-Client-Id"]=t.accessKey,o["CF-Access-Client-Secret"]=t.secretKey);const m=d.crypto_kx_keypair(),{clientHelloUrl:h,terminateHelloUrl:g}=c(s,""),v=await y(h,{headers:o,httpClient:i,publicKey:m.publicKey}),{serverPublicKey:b,serverHeader:S}=await(0,f.j)({attestation:v.attestation,rootCertBER:n,expectedPCRs:r});(0,l.t)({url:s,name:"ClientIdentifier",value:v.clientIdentifier,expirationDate:(new Date).getTime()+15e5,sameSite:"strict",secure:!0});const w=await(async(e,t)=>{const{headers:s,clientKeyPair:n,httpClient:r,serverPublicKey:i,serverHeader:a}=t;await d.ready;const o=d.crypto_kx_client_session_keys(n.publicKey,n.privateKey,new Uint8Array(i)),c=d.crypto_secretstream_xchacha20poly1305_init_push(o.sharedRx),l=c.state,m=c.header,h=d.crypto_secretstream_xchacha20poly1305_init_pull(new Uint8Array(a),o.sharedTx),g={clientHeader:d.to_hex(m)},v=await(0,u.z)(r.post(e,g,{observe:"response",responseType:"json",withCredentials:!0,headers:s}));if((0,p.hx)(v))throw new Error("HTTP error");return{clientStateOut:l,sessionKeys:o,clientStateIn:h}})(g,{headers:o,httpClient:i,clientKeyPair:m,serverPublicKey:b,serverHeader:S});return{clientStateOut:w.clientStateOut,clientStateIn:w.clientStateIn,headers:o}};var S=s(13528);const w=m.z.object({requestId:m.z.string(),errors:m.z.array(m.z.object({status:m.z.string(),code:m.z.string(),message:m.z.string()}))});let E=class{assertData(e){if(!e)throw new Error("toDecode expected to be truthy");if("[object Object]"!=`${e}`||Array.isArray(e))throw new Error("toDecode expected to be object");if(!Object.prototype.hasOwnProperty.call(e,"data"))throw new Error('toDecode expected to contain a "data" property');const t=e;if("string"!=typeof t.data)throw new Error("toDecode.data expected to be type string but was "+typeof t.data)}decode(e){return this.assertData(e),e.data}};var _=s(60590);class C{async callEnclaveEndpoint(e){return await this.MUTEX.runExclusive((async()=>{const t=this.tunnel;try{return await this.tryCallEnclave(e)}catch(s){if(s instanceof Error&&("TUNNEL_UUID_NOT_FOUND"===s.message||"CLIENT_IDENTIFIER_NOT_FOUND"===s.message||"CLIENT_SESSION_NOT_PARSED"===s.message||"CLIENT_STATEIN_NOT_FOUND"===s.message||"SECURE_TUNNEL_MUST_BE_REOPENED"===s.message))return this.tunnel===t&&(this.tunnel=void 0),await this.tryCallEnclave(e);throw s}}))}async tryCallEnclave(e){const{body:t,endpoint:s,responseSchema:n}=e,r=JSON.stringify(t),i=await this.platformInfoService.getPlatformInfo(),a=(0,o.Ep)(this.enclaveApiSettings.environment),l=(0,o.$m)(this.enclaveApiSettings.environment);if(void 0===this.tunnel){this.tunnel=b({enclaveApiSettings:this.enclaveApiSettings,httpClient:this.httpClient,expectedPCRs:l,rootCertBER:a,platformInfo:i});try{await this.tunnel}catch(e){throw this.tunnel=void 0,e}}const m=await this.tunnel,{enclaveUrl:h}=this.enclaveApiSettings,{secureContentUrl:g}=c(h,s),{decryptedResponse:v}=await(async(e,t)=>{const{tunnel:{clientStateOut:s,clientStateIn:n,headers:r},httpClient:i}=t;await d.ready;const a=d.crypto_secretstream_xchacha20poly1305_push(s,d.from_string(t.data),null,d.crypto_secretstream_xchacha20poly1305_TAG_MESSAGE),o={data:d.to_hex(a)},c=await(0,u.z)(i.post(e,o,{observe:"body",responseType:"json",responseBodyDecoder:new E,withCredentials:!0,headers:r}));if((0,p.hx)(c)){if(c.error instanceof S.R){const e=await JSON.parse(await c.error.response.text()),t=w.safeParse(e);if(t.success){const e=t.data.errors[0];throw new Error(e.code)}}throw new Error("HTTP error")}const l=d.crypto_secretstream_xchacha20poly1305_pull(n,d.from_hex(c.data)).message;return{decryptedResponse:d.to_string(l)}})(g,{data:r,httpClient:this.httpClient,tunnel:m}),y=n.safeParse(JSON.parse(v));if(!y.success)throw new Error(`Enclave response parsing failed. Endpoint: ${s}.`);return y.data}getEnclaveApiSettings(){return this.enclaveApiSettings}constructor(e,t,s){this.platformInfoService=e,this.httpClient=t,this.enclaveApiSettings=s,this.tunnel=void 0,this.MUTEX=new r.WU}}C=(0,n.gn)([(0,i.GS)(),(0,n.w6)("design:type",Function),(0,n.w6)("design:paramtypes",[void 0===_.t?Object:_.t,void 0===a.e?Object:a.e,void 0===o.N6?Object:o.N6])],C)},43685:(e,t,s)=>{s.d(t,{t:()=>u});var n=s(92336),r=s(92587),i=function(e){return e.DOMAINS_CREATE_DOMAIN="api/domains/CreateDomain",e.DOMAINS_DELETE_DOMAIN="api/domains/DeleteDomain2",e.DOMAINS_UPDATE_DOMAIN="api/domains/UpdateDomain2",e.DOMAINS_CHECK_DNS_VALIDATION="api/domains/CheckDNSValidation2",e}({}),a=s(7165);a.z.object({domainName:a.z.string(),teamUuid:a.z.string(),adminProvisioningKey:a.z.string(),idpMetadata:a.z.object({certificate:a.z.string(),entrypoint:a.z.string()}).optional()});const o=a.z.object({dnsVerificationToken:a.z.string()});a.z.object({domainName:a.z.string(),teamUuid:a.z.string(),adminProvisioningKey:a.z.string()}),a.z.object({domainName:a.z.string(),teamUuid:a.z.string(),adminProvisioningKey:a.z.string(),idpUuid:a.z.string()}),a.z.object({domainName:a.z.string(),adminProvisioningKey:a.z.string(),teamUuid:a.z.string()});const c=a.z.object({previousStatus:a.z.string(),status:a.z.enum(["valid","pending","expired","invalid"]),verificationToken:a.z.string(),lastCheckDateUnix:a.z.number(),pendingReason:a.z.enum(["tokenNotFound","invalidToken"]).nullable(),tokenFound:a.z.string().optional()});var d=s(43841),l=s(78346);class u{async createDomain(e){const t=await this.enclaveService.callEnclaveEndpoint({endpoint:i.DOMAINS_CREATE_DOMAIN,body:e,responseSchema:o});return(0,l.Vp)(t)}async deleteDomain(e){return await this.enclaveService.callEnclaveEndpoint({body:e,endpoint:i.DOMAINS_DELETE_DOMAIN,responseSchema:a.z.object({})}),(0,l.Vp)(void 0)}async updateDomain(e){return await this.enclaveService.callEnclaveEndpoint({endpoint:i.DOMAINS_UPDATE_DOMAIN,body:e,responseSchema:a.z.object({})}),(0,l.Vp)(void 0)}async checkDnsValidation(e){const t=await this.enclaveService.callEnclaveEndpoint({endpoint:i.DOMAINS_CHECK_DNS_VALIDATION,body:e,responseSchema:c});return(0,l.Vp)(t)}constructor(e){this.enclaveService=e}}u=(0,n.gn)([(0,r.GS)(),(0,n.w6)("design:type",Function),(0,n.w6)("design:paramtypes",[void 0===d.d?Object:d.d])],u)},33253:(e,t,s)=>{s.d(t,{A:()=>c});var n=s(92336),r=s(92587),i=s(35938),a=s(49439),o=s(40515);class c{store(e){const t={auditLogs:e};return this.enclaveProxyService.sendToProxy({authenticationType:"massDeployedTeamKey",endpoint:i.K.AUDIT_LOGS_MASS_DEPLOYMENT_STORE,rawPayload:t,responseBodyDecoder:new a.F})}constructor(e){this.enclaveProxyService=e}}c=(0,n.gn)([(0,r.GS)(),(0,n.w6)("design:type",Function),(0,n.w6)("design:paramtypes",[void 0===o.lK?Object:o.lK])],c)},67621:(e,t,s)=>{s.d(t,{Z:()=>v});var n=s(92336),r=s(92587),i=s(35938),a=s(49439),o=s(7165);const c=o.z.object({queryExecutionId:o.z.string()});class d{decode(e){const t=c.safeParse(e);if(!t.success)throw new Error("AuditLogsQueryStart: invalid response format");return t.data.queryExecutionId}}const l=o.z.object({nextToken:o.z.string().nullable().optional(),results:o.z.array(o.z.string()).optional(),state:o.z.string()});class u{decode(e){const t=l.safeParse(e);if(!t.success)throw new Error("AuditLogsQueryResults: invalid response format");return{nextToken:t.data.nextToken,results:t.data.results,state:t.data.state}}}var p=s(59664);const m=o.z.object({nextToken:o.z.string().nullable().optional(),results:o.z.array(o.z.object({date_time:o.z.number(),schema_version:o.z.string(),uuid:o.z.string(),category:o.z.nativeEnum(p.s).optional(),is_sensitive:o.z.boolean().optional(),log_type:o.z.nativeEnum(p.b),properties:o.z.intersection(o.z.object({domain_url:o.z.string().optional()}),o.z.record(o.z.union([o.z.number(),o.z.boolean(),o.z.string()])))})).optional(),state:o.z.enum(["CANCELLED","FAILED","QUEUED","RUNNING","SUCCEEDED"])});class h{decode(e){const t=m.safeParse(e);if(!t.success)throw new Error("FilteredAuditLogsQueryResults: invalid response format");return{nextToken:t.data.nextToken,results:t.data.results,state:t.data.state}}}var g=s(40515);class v{store(e){const t={auditLogs:e};return this.enclaveProxyService.sendToProxy({authenticationType:"userDevice",endpoint:i.K.AUDIT_LOGS_STORE,rawPayload:t,responseBodyDecoder:new a.F})}queryStart(e){return this.enclaveProxyService.sendToProxy({authenticationType:"userDevice",endpoint:i.K.AUDIT_LOGS_START_QUERY,rawPayload:e,responseBodyDecoder:new d})}queryResults(e){const t={...e,maxResults:e.maxResults??100};return this.enclaveProxyService.sendToProxy({authenticationType:"userDevice",endpoint:i.K.AUDIT_LOGS_QUERY_RESULTS,rawPayload:t,responseBodyDecoder:new u})}filteredQueryStart(e){return this.enclaveProxyService.sendToProxy({authenticationType:"userDevice",endpoint:i.K.AUDIT_LOGS_START_FILTERED_QUERY,rawPayload:e,responseBodyDecoder:new d})}filteredQueryResults(e){return this.enclaveProxyService.sendToProxy({authenticationType:"userDevice",endpoint:i.K.AUDIT_LOGS_GET_FILTERED_QUERY_RESULTS,rawPayload:e,responseBodyDecoder:new h})}constructor(e){this.enclaveProxyService=e}}v=(0,n.gn)([(0,r.GS)(),(0,n.w6)("design:type",Function),(0,n.w6)("design:paramtypes",[void 0===g.lK?Object:g.lK])],v)},49439:(e,t,s)=>{s.d(t,{F:()=>i});var n=s(7165);const r=n.z.object({invalidAuditLogs:n.z.array(n.z.object({error:n.z.string(),uuid:n.z.string()}))});class i{decode(e){const t=r.safeParse(e);if(!t.success)throw new Error("StoreAuditLogs: invalid response format");return{invalidAuditLogs:t.data.invalidAuditLogs}}}},40515:(e,t,s)=>{s.d(t,{lK:()=>R});var n=s(92336),r=s(75377),i=s(64987),a=s(92587),o=s(26549),c=s(52477),d=s(78346),l=s(1695),u=s(99081),p=s(35938);let m=null;const h=e=>{m=e};var g=s(7165);const v=g.z.object({data:g.z.object({attestation:g.z.string(),tunnelUuid:g.z.string()}),requestId:g.z.string()});class y{decode(e){const t=v.safeParse(e);if(!t.success)throw new Error("ClientHello: invalid response format");return{attestation:r.from_hex(t.data.data.attestation),tunnelUuid:t.data.data.tunnelUuid}}}const f=g.z.object({requestId:g.z.string()});class b{decode(e){const t=f.safeParse(e);if(!t.success)throw new Error("TerminateHello: invalid response format");return t.data.requestId}}var S=s(60399),w=s(87244),E=s(11515);const _=async e=>{const{appKeys:t,authenticationType:s,serverApiCredentialsService:n}=e;switch(s){case"app":return{type:"app",...t};case"userDevice":{const{deviceAccessKey:e,deviceSecretKey:s,login:r}=await(0,S.z)(n.getActiveUserDeviceCredentials());return{type:"userDevice",...t,login:r,accessKey:e,secretKey:s}}case"massDeployedTeamKey":{const{massDeployedTeamAccessKey:e,massDeployedTeamSecretKey:s}=await(0,S.z)(n.getMassDeploymentTeamKeyCredentials());return{type:"massDeployedTeamKey",...t,massDeployedTeamAccessKey:e,secretKey:s}}}};var C=s(35159),I=s(60590),T=function(e){return e.DECRYPTION_ERROR="ENCLAVE_PROXY_SERVICE_DECRYPTION_ERROR",e.REPEATED_TUNNEL_FAILURE="ENCLAVE_PROXY_SERVICE_REPEATED_TUNNEL_FAILURE",e}({}),A=function(e){return e.CLIENT_IDENTIFIER_NOT_FOUND="CLIENT_IDENTIFIER_NOT_FOUND",e.CLIENT_SESSION_NOT_PARSED="CLIENT_SESSION_NOT_PARSED",e.CLIENT_STATEIN_NOT_FOUND="CLIENT_STATEIN_NOT_FOUND",e.SECURE_TUNNEL_MUST_BE_REOPENED="SECURE_TUNNEL_MUST_BE_REOPENED",e.TUNNEL_UUID_NOT_FOUND="TUNNEL_UUID_NOT_FOUND",e}({});const U=g.z.object({data:g.z.object({encryptedData:g.z.string()}),requestId:g.z.string()});class N{decode(e){const t=U.safeParse(e);if(!t.success)throw new Error("SendEncrypted: invalid response format");return{encryptedData:t.data.data.encryptedData,requestId:t.data.requestId}}}const O=g.z.object({errors:g.z.array(g.z.object({code:g.z.string(),message:g.z.string(),type:g.z.string().optional()})),requestId:g.z.string()});class D{decode(e){const t=O.safeParse(e);if(!t.success)throw new Error("FailedResponse: invalid response format");return{error:t.data.errors[0],requestId:t.data.requestId}}}const F=async e=>(0,c.EQ)(e.error,{BadStatus:async e=>{const{code:t,message:s}=(await e.response.json(new D)).error;return{code:t,message:s}},FetchFailedError:e=>{throw e}}),P=e=>e===A.TUNNEL_UUID_NOT_FOUND||e===A.CLIENT_IDENTIFIER_NOT_FOUND||e===A.CLIENT_SESSION_NOT_PARSED||e===A.CLIENT_STATEIN_NOT_FOUND||e===A.SECURE_TUNNEL_MUST_BE_REOPENED;class R{async sendToProxy(e){const t=({code:e,message:t})=>(0,d.Rn)({code:e,message:t});return await r.ready,this.MUTEX.runExclusive((async()=>{const{authenticationType:s,endpoint:n,errorDecoder:i=t,rawPayload:a,responseBodyDecoder:o}=e;let c=!0;const l=async()=>{const e=await this.getClientSession();if((0,d.hx)(e)){const{code:t}=await F(e);if(P(t)&&(h(null),c))return c=!1,l();throw new Error(T.REPEATED_TUNNEL_FAILURE)}const{clientHello:t,terminateHello:u}=e.data,{tunnelUuid:p}=t,{clientStateIn:m,clientStateOut:g}=u,v=r.crypto_secretstream_xchacha20poly1305_push(g,r.from_string(JSON.stringify(a)),null,r.crypto_secretstream_xchacha20poly1305_TAG_MESSAGE),y={encryptedData:r.to_hex(v),tunnelUuid:p},f=await this.executeRequest({authenticationType:s,endpoint:n,payload:y,responseBodyDecoder:new N});if((0,d.hx)(f)){const{code:e,message:t}=await F(f);if(P(e)){if(h(null),c)return c=!1,l();throw new Error(T.REPEATED_TUNNEL_FAILURE)}return i({code:e,message:t})}const b=r.crypto_secretstream_xchacha20poly1305_pull(m,r.from_hex(f.data.encryptedData));if(!b)throw h(null),new Error(T.DECRYPTION_ERROR);const S=await o.decode(JSON.parse(r.to_string(b.message)));return(0,d.Vp)(S)};return l()}))}async getClientSession(){const e=m;if(e)return(0,d.Vp)(e);{const e=r.crypto_kx_keypair(),t=await this.clientHello(e);if((0,d.hx)(t))return t;const s=await this.terminateHello({clientKeyPair:e,clientHello:t.data});if((0,d.hx)(s))return s;const n={clientKeyPair:e,clientHello:t.data,terminateHello:s.data};return h(n),(0,d.Vp)(n)}}async clientHello(e){const t={clientPublicKey:r.to_hex(e.publicKey)},s=await this.executeRequest({authenticationType:"app",endpoint:p.K.CLIENT_HELLO,payload:t,responseBodyDecoder:new y});return(0,d.hx)(s)?s:(0,d.Vp)(s.data)}async terminateHello({clientKeyPair:e,clientHello:{attestation:t,tunnelUuid:s}}){const n=await(0,l.j)({attestation:t,rootCertBER:(0,u.Ep)(this.enclaveApiSettings.environment),expectedPCRs:(0,u.$m)(this.enclaveApiSettings.environment)}),i=new Uint8Array(n.serverPublicKey),a=new Uint8Array(n.serverHeader),o=r.crypto_kx_client_session_keys(e.publicKey,e.privateKey,i),{state:c,header:m}=r.crypto_secretstream_xchacha20poly1305_init_push(o.sharedRx),h=r.crypto_secretstream_xchacha20poly1305_init_pull(a,o.sharedTx),g={clientHeader:r.to_hex(m),tunnelUuid:s},v=await this.executeRequest({authenticationType:"app",endpoint:p.K.TERMINATE_HELLO,payload:g,responseBodyDecoder:new b});return(0,d.hx)(v)?v:(0,d.Vp)({clientStateIn:h,clientStateOut:c,sessionKeys:o,serverHeader:a,serverPublicKey:i})}executeRequest(e){const{endpoint:t,...s}=e;return(async e=>{const{authenticationType:t,enclaveApiSettings:s,httpClient:n,path:r,payload:i,platformInfoService:a,responseBodyDecoder:o,serverApiCredentialsService:c}=e,{appKeys:d,cloudflareHeaders:l,enclaveProxyUrl:u}=s,p=await a.getPlatformInfo();return w.postRequestAPI({authentication:await _({appKeys:d,authenticationType:t,serverApiCredentialsService:c}),customHost:new URL(u).host,path:r,payload:i,requestFunction:e=>{const{headers:t,url:s}=e;return(0,S.z)(n.post(s,i,{headers:{...t,...l.accessKey&&l.secretKey&&{"CF-Access-Client-Id":l.accessKey,"CF-Access-Client-Secret":l.secretKey},"dashlane-client-agent":JSON.stringify({platform:p.platformName,osversion:p.osVersion,version:p.appVersion})},observe:"body",responseBodyDecoder:o,responseType:"json"}))},userAgent:E.getUserAgent()})})({enclaveApiSettings:this.enclaveApiSettings,httpClient:this.httpClient,path:`v1-nitro-encryption-service/${t}`,platformInfoService:this.platformInfoService,serverApiCredentialsService:this.serverApiCredentialsService,...s})}constructor(e,t,s,n){this.httpClient=e,this.serverApiCredentialsService=t,this.enclaveApiSettings=s,this.platformInfoService=n,this.MUTEX=new i.WU}}R=(0,n.gn)([(0,a.GS)(),(0,n.w6)("design:type",Function),(0,n.w6)("design:paramtypes",[void 0===o.e?Object:o.e,void 0===C.n?Object:C.n,void 0===u.N6?Object:u.N6,void 0===I.t?Object:I.t])],R)},35938:(e,t,s)=>{s.d(t,{K:()=>n});var n=function(e){return e.CLIENT_HELLO="tunnel/ClientHello",e.TERMINATE_HELLO="tunnel/TerminateHello",e.AUDIT_LOGS_GET_FILTERED_QUERY_RESULTS="logs/GetFilteredAuditLogQueryResults",e.AUDIT_LOGS_START_FILTERED_QUERY="logs/StartFilteredAuditLogsQuery",e.AUDIT_LOGS_START_QUERY="logs/StartAuditLogsQuery",e.AUDIT_LOGS_QUERY_RESULTS="logs/GetAuditLogQueryResults",e.AUDIT_LOGS_STORE="logs/StoreAuditLogs",e.AUDIT_LOGS_MASS_DEPLOYMENT_STORE="logs-massdeployment/StoreAuditLogs",e.PASSKEY_USE="passkeys/UsePasskey",e.PASSKEY_REGISTER="passkeys/RegisterPasskey",e.UVVS_UPLOAD_UVVS="uvvs/Upload",e.UVVS_DOWNLOAD_UVVS="uvvs/Download",e}({})},7493:(e,t,s)=>{s.d(t,{n:()=>h});var n=s(92336),r=s(92587),i=s(78989),a=s(78346),o=s(35938),c=s(7165);const d=c.z.object({uuid:c.z.string(),encryptionKey:c.z.object({uuid:c.z.string(),key:c.z.string()}),credentialRegisterData:c.z.object({type:c.z.literal("public-key"),rawId:c.z.string(),id:c.z.string(),clientDataHash:c.z.string(),attestationObject:c.z.string(),authenticatorAttachment:c.z.string(),authenticatorData:c.z.string(),publicKey:c.z.string(),publicKeyAlgorithm:c.z.number(),transports:c.z.array(c.z.string()),clientExtensionResults:c.z.record(c.z.unknown())})});class l{decode(e){const t=d.safeParse(e);if(!t.success)throw new Error("RegisterPasskey: invalid response format");return t.data}}const u=c.z.object({credentialGetData:c.z.object({type:c.z.literal("public-key"),rawId:c.z.string(),id:c.z.string(),authenticatorAttachment:c.z.string(),response:c.z.object({authenticatorData:c.z.string(),clientDataHash:c.z.string(),signature:c.z.string(),userHandle:c.z.ostring()}),clientExtensionResults:c.z.optional(c.z.record(c.z.unknown()))}),requestEvents:c.z.array(c.z.object({dateUnix:c.z.number(),userLogin:c.z.string(),userId:c.z.number()}))});class p{decode(e){const t=u.safeParse(e);if(!t.success)throw new Error("UsePasskey: invalid response format");return t.data}}var m=s(40515);class h{registerPasskey(e){return this.enclaveProxyService.sendToProxy({authenticationType:"userDevice",endpoint:o.K.PASSKEY_REGISTER,rawPayload:e,responseBodyDecoder:new l,errorDecoder:({code:e,message:t})=>{if(e===i.r.SECURITY_ERROR||e===i.r.INVALID_STATE_ERROR||e===i.r.ALGORITHM_NOT_SUPPORTED_ERROR)return(0,a.Rn)({message:t,code:e});throw new Error(`Unexpected error code ${e}`)}})}usePasskey(e){return this.enclaveProxyService.sendToProxy({authenticationType:"userDevice",endpoint:o.K.PASSKEY_USE,rawPayload:e,responseBodyDecoder:new p,errorDecoder:({code:e,message:t})=>{if(e===i.r.SECURITY_ERROR||e===i.r.ALGORITHM_NOT_SUPPORTED_ERROR||e===i.r.PASSKEY_NOT_FOUND||e===i.r.PASSKEY_DECRYPTION_ERROR)return(0,a.Rn)({message:t,code:e});throw new Error(`Unexpected error code ${e}`)}})}constructor(e){this.enclaveProxyService=e}}h=(0,n.gn)([(0,r.GS)(),(0,n.w6)("design:type",Function),(0,n.w6)("design:paramtypes",[void 0===m.lK?Object:m.lK])],h)},26755:(e,t,s)=>{s.d(t,{L:()=>u});var n=s(92336),r=s(92587),i=function(e){return e.IDPS_CREATE_IDP="api/idps/CreateIdp",e.IDPS_UPDATE_IDP="api/idps/UpdateIdp",e.IDPS_DELETE_IDP="api/idps/DeleteIdp",e}({}),a=s(7165);a.z.object({teamUuid:a.z.string().uuid(),adminProvisioningKey:a.z.string(),idpMetadata:a.z.object({certificates:a.z.array(a.z.string()),entrypoint:a.z.string()})});const o=a.z.object({idpUuid:a.z.string().uuid()});a.z.object({teamUuid:a.z.string().uuid(),adminProvisioningKey:a.z.string(),idpUuid:a.z.string().uuid()});const c=a.z.object({idpUuid:a.z.string().uuid()});a.z.object({teamUuid:a.z.string().uuid(),adminProvisioningKey:a.z.string(),idpMetadata:a.z.object({idpUuid:a.z.string(),certificates:a.z.array(a.z.string()).optional(),entrypoint:a.z.string().optional(),groupProvisioningActivated:a.z.boolean().optional()})}),a.z.object({idpUuid:a.z.string().uuid()});var d=s(43841),l=s(78346);class u{async createIdp(e){const t=await this.enclaveService.callEnclaveEndpoint({endpoint:i.IDPS_CREATE_IDP,body:e,responseSchema:o});return(0,l.Vp)(t)}async deleteIdp(e){const t=await this.enclaveService.callEnclaveEndpoint({body:e,endpoint:i.IDPS_DELETE_IDP,responseSchema:c});return(0,l.Vp)(t)}async updateIdp(e){return await this.enclaveService.callEnclaveEndpoint({endpoint:i.IDPS_UPDATE_IDP,body:e,responseSchema:a.z.object({})}),(0,l.Vp)({idpUuid:e.idpMetadata.idpUuid})}constructor(e){this.enclaveService=e}}u=(0,n.gn)([(0,r.GS)(),(0,n.w6)("design:type",Function),(0,n.w6)("design:paramtypes",[void 0===d.d?Object:d.d])],u)},1695:(e,t,s)=>{s.d(t,{j:()=>h});var n=s(76465);function r(e){return(0,n.Jx)(new Uint8Array(e))}const i=e=>{const t=r(new Uint8Array(e)),s=(n=t,Array.isArray(n)?n:n.value);var n;const[i,,a,o]=s;if(!i)throw new Error("parseSignedMessage: no protected header field");if(!a)throw new Error("parseSignedMessage: no payload field");if(!o)throw new Error("parseSignedMessage: no signature field");return{payload:new Uint8Array(a).buffer,protectedHeaders:new Uint8Array(i).buffer,signature:new Uint8Array(o).buffer}};var a=s(7165),o=s(63352);const c=a.z.object({module_id:a.z.string(),timestamp:a.z.bigint(),digest:a.z.string(),pcrs:a.z.record(a.z.string(),a.z.instanceof(Uint8Array)),certificate:a.z.instanceof(Uint8Array),cabundle:a.z.array(a.z.instanceof(Uint8Array)),user_data:a.z.instanceof(Uint8Array),nonce:a.z.instanceof(Uint8Array).nullable()}),d=a.z.object({header:a.z.string(),publicKey:a.z.string()});var l=s(71833);const u=async(e,t,s,r)=>{const i=l.KBB.fromBER(r),a=await i.getPublicKey(),o=["Signature1",t,new ArrayBuffer(0),s],c=(d=o,(0,n.cv)(d));var d;return crypto.subtle.verify({name:"ECDSA",hash:"SHA-384"},a,e,c)};var p=s(17991);const m=e=>(0,p.k)((e=>new Uint8Array(e).buffer)(e)),h=async e=>{const{attestation:t,rootCertBER:s,expectedPCRs:n}=e,{protectedHeaders:a,payload:p,signature:h}=i(t),g=(e=>{const t=r(e),s=c.safeParse(t);if(!s.success)throw new Error("failed to parse attestation document");const n=s.data,i=new TextDecoder("utf-8").decode(n.user_data),a=JSON.parse(i),l=d.safeParse(a);if(!l.success)throw new Error("failed to parse server crypto info");const u=l.data;return{moduleId:n.module_id,timestamp:n.timestamp,digest:n.digest,pcrs:n.pcrs,certificate:new Uint8Array(n.certificate).buffer,cabundle:(p=n.cabundle,p.map((e=>new Uint8Array(e).buffer))),serverHeader:(0,o.R)(u.header),serverPublicKey:(0,o.R)(u.publicKey),nonce:null!==n.nonce?new Uint8Array(n.nonce).buffer:null};var p})(p),v=await(async(e,t,s)=>{const n=l.KBB.fromBER(e),r=t.map((e=>l.KBB.fromBER(e)));r.push(n);const i=[l.KBB.fromBER((0,o.R)(s))],a=new l.DMg({trustedCerts:i,certs:r});return(await a.verify()).result})(g.certificate,g.cabundle,s);if(!v)throw new Error("Invalid cert chain!");if(!await u(h,a,p,g.certificate))throw new Error("Invalid signature!");return((e,t)=>{for(const[s,n]of Object.entries(t))if(n!==m(e[Number(s)]))throw new Error("PCRs did not match")})(g.pcrs,n),{serverPublicKey:g.serverPublicKey,serverHeader:g.serverHeader}}},35955:(e,t,s)=>{s.d(t,{b:()=>u});var n=s(92336),r=s(92587),i=s(78346),a=function(e){return e.SCIM_GET_CONFIGURATION="api/scim/GetSCIMConfiguration",e.SCIM_SET_CONFIGURATION="api/scim/SetSCIMConfiguration",e}({}),o=s(43841),c=s(7165);c.z.object({teamUuid:c.z.string(),adminProvisioningKey:c.z.string()});const d=c.z.object({token:c.z.string().nullable(),active:c.z.boolean()});c.z.object({teamUuid:c.z.string(),adminProvisioningKey:c.z.string(),token:c.z.string(),active:c.z.boolean()});const l=c.z.object({token:c.z.string().nullable(),active:c.z.boolean()});class u{async getScimConfiguration(e){const t=await this.enclaveService.callEnclaveEndpoint({endpoint:a.SCIM_GET_CONFIGURATION,body:e,responseSchema:d});return(0,i.Vp)(t)}async setScimConfiguration(e){const t=await this.enclaveService.callEnclaveEndpoint({endpoint:a.SCIM_SET_CONFIGURATION,body:e,responseSchema:l});return(0,i.Vp)(t)}constructor(e){this.enclaveService=e}}u=(0,n.gn)([(0,r.GS)(),(0,n.w6)("design:type",Function),(0,n.w6)("design:paramtypes",[void 0===o.d?Object:o.d])],u)},96236:(e,t,s)=>{s.d(t,{L:()=>u});var n=s(92336),r=s(92587),i=s(78346),a=function(e){return e.SIEM_GET_CONFIGURATION="api/siem/GetSIEMConfiguration",e.SIEM_SET_CONFIGURATION="api/siem/SetSIEMConfiguration",e}({}),o=s(43841),c=s(7165);c.z.object({teamUuid:c.z.string(),adminProvisioningKey:c.z.string()});const d=c.z.object({token:c.z.string().nullable(),active:c.z.boolean(),instanceURL:c.z.string().nullable(),siemType:c.z.enum(["splunk"]).nullable(),isSelfSignedCertificateAllowed:c.z.boolean()});c.z.object({teamUuid:c.z.string(),adminProvisioningKey:c.z.string(),token:c.z.string().optional(),active:c.z.boolean().optional(),instanceURL:c.z.string().optional(),siemType:c.z.enum(["splunk"]).nullable().optional(),isSelfSignedCertificateAllowed:c.z.boolean().optional()});const l=c.z.object({token:c.z.string().nullable(),active:c.z.boolean(),instanceURL:c.z.string().nullable(),siemType:c.z.enum(["splunk"]).nullable(),isSelfSignedCertificateAllowed:c.z.boolean()});class u{async getSiemConfiguration(e){const t=await this.enclaveService.callEnclaveEndpoint({endpoint:a.SIEM_GET_CONFIGURATION,body:e,responseSchema:d});return(0,i.Vp)(t)}async setSiemConfiguration(e){const t=await this.enclaveService.callEnclaveEndpoint({endpoint:a.SIEM_SET_CONFIGURATION,body:e,responseSchema:l});return(0,i.Vp)(t)}constructor(e){this.enclaveService=e}}u=(0,n.gn)([(0,r.GS)(),(0,n.w6)("design:type",Function),(0,n.w6)("design:paramtypes",[void 0===o.d?Object:o.d])],u)},62306:(e,t,s)=>{s.d(t,{v:()=>d});var n=s(92336),r=s(92587),i=s(78346),a=function(e){return e.SLACK_INSTALL_SLACK_APP="api/slack/InstallSlackApp",e.SLACK_SEND_SLACK_MESSAGE="api/slack/SendSlackMessage",e.SLACK_UNINSTALL_SLACK_APP="api/slack/UninstallSlackApp",e}({}),o=s(43841),c=s(7165);class d{async installSlackApp(e){return await this.enclaveService.callEnclaveEndpoint({endpoint:a.SLACK_INSTALL_SLACK_APP,body:e,responseSchema:c.z.object({})}),(0,i.Vp)(void 0)}async sendSlackMessage(e){return await this.enclaveService.callEnclaveEndpoint({endpoint:a.SLACK_SEND_SLACK_MESSAGE,body:e,responseSchema:c.z.object({})}),(0,i.Vp)(void 0)}async uninstallSlackApp(e){return await this.enclaveService.callEnclaveEndpoint({endpoint:a.SLACK_UNINSTALL_SLACK_APP,body:e,responseSchema:c.z.object({})}),(0,i.Vp)(void 0)}constructor(e){this.enclaveService=e}}d=(0,n.gn)([(0,r.GS)(),(0,n.w6)("design:type",Function),(0,n.w6)("design:paramtypes",[void 0===o.d?Object:o.d])],d)},81646:(e,t,s)=>{s.d(t,{U:()=>S});var n=s(92336),r=s(92587),i=s(78346),a=function(e){return e.TEAMS_CREATE_TEAM="api/teams/CreateTeam",e.TEAMS_CREATE_TEAM_FOR_MIGRATION="api/teams/CreateTeamForMigration",e.TEAMS_GET_TEAM="api/teams/GetTeam",e.TEAMS_DELETE_TEAM="api/teams/DeleteTeam",e}({}),o=s(43841),c=s(7165);const d=c.z.object({adminProvisioningKey:c.z.string()}),l=c.z.object({}),u=c.z.enum(["valid","pending","expired","invalid"]),p=c.z.enum(["tokenNotFound","invalidToken"]),m=c.z.object({status:u.nullable(),verificationToken:c.z.string(),lastCheckDateUnix:c.z.number(),pendingReason:p.nullable(),expiryDateUnix:c.z.number()}),h=c.z.object({creationDateUnix:c.z.number(),dnsCheckStatus:m,domainName:c.z.string(),idpUuid:c.z.ostring(),updateDateUnix:c.z.number()}),g=c.z.object({idpUuid:c.z.string().uuid(),certificates:c.z.array(c.z.string()),entrypoint:c.z.string(),groupProvisioningActivated:c.z.boolean().optional(),creationDateUnix:c.z.number(),updateDateUnix:c.z.number()}),v=c.z.object({domains:c.z.record(c.z.string(),h),idps:c.z.record(c.z.string(),g),updateDateUnix:c.z.number(),messageIntegrations:c.z.object({slackStatus:c.z.boolean()})});c.z.object({teamDeviceCredentials:c.z.object({teamUuid:c.z.string(),accessKey:c.z.string(),secretKey:c.z.string(),sharingPublicKey:c.z.string(),sharingPrivateKey:c.z.string()}),certificates:c.z.array(c.z.string()),entrypoint:c.z.string(),masterServiceProviderKey:c.z.string(),domains:c.z.array(c.z.string()),scimToken:c.z.string().optional()});const y=c.z.record(c.z.string(),h),f=c.z.object({domains:y,idps:c.z.record(c.z.string(),g),updateDateUnix:c.z.number()}),b=c.z.object({adminProvisioningKey:c.z.string(),team:f});class S{async createTeam(e){const t=await this.enclaveService.callEnclaveEndpoint({endpoint:a.TEAMS_CREATE_TEAM,body:e,responseSchema:d});return(0,i.Vp)(t)}async createTeamForMigration(e){const t=await this.enclaveService.callEnclaveEndpoint({endpoint:a.TEAMS_CREATE_TEAM_FOR_MIGRATION,body:e,responseSchema:b});return(0,i.Vp)(t)}async getTeam(e){const t=await this.enclaveService.callEnclaveEndpoint({endpoint:a.TEAMS_GET_TEAM,body:e,responseSchema:v});return(0,i.Vp)(t)}async deleteTeam(e){const t=await this.enclaveService.callEnclaveEndpoint({endpoint:a.TEAMS_DELETE_TEAM,body:e,responseSchema:l});return(0,i.Vp)(t)}constructor(e){this.enclaveService=e}}S=(0,n.gn)([(0,r.GS)(),(0,n.w6)("design:type",Function),(0,n.w6)("design:paramtypes",[void 0===o.d?Object:o.d])],S)},72394:(e,t,s)=>{s.d(t,{B:()=>h});var n=s(92336),r=s(92587),i=s(35938),a=s(7165);const o=a.z.any();class c{decode(e){if(!o.safeParse(e).success)throw new Error("UVVSUploadResults: invalid response format")}}const d=a.z.object({id:a.z.string(),domain:a.z.string(),risks:a.z.object({isCompromised:a.z.boolean(),isReused:a.z.boolean(),isWeak:a.z.boolean()})});a.z.array(d);const l=a.z.array(d.extend({sharing:a.z.object({isShared:a.z.boolean()})})),u=a.z.object({uvvs:l});class p{decode(e){const t=u.safeParse(e);if(!t.success)throw new Error("UVVSDownloadResults: invalid response format");return t.data}}var m=s(40515);class h{async uploadUVVS(e){return await this.enclaveProxyService.sendToProxy({authenticationType:"userDevice",endpoint:i.K.UVVS_UPLOAD_UVVS,rawPayload:e,responseBodyDecoder:new c})}async downloadUVVS(e){return await this.enclaveProxyService.sendToProxy({authenticationType:"userDevice",endpoint:i.K.UVVS_DOWNLOAD_UVVS,rawPayload:e,responseBodyDecoder:new p})}constructor(e){this.enclaveProxyService=e}}h=(0,n.gn)([(0,r.GS)(),(0,n.w6)("design:type",Function),(0,n.w6)("design:paramtypes",[void 0===m.lK?Object:m.lK])],h)},13002:(e,t,s)=>{s.d(t,{k:()=>Q});var n=s(92336),r=s(86006),i=s(23297),a=s(66335),o=s(85390),c=s(87065),d=s(6136),l=s(41842),u=s(62760),p=s(85798),m=s(50423),h=s(46449),g=s(82874),v=s(78346),y=s(60399),f=s(92587),b=s(33312),S=s(53344);class w{getFeatureFlipsForActiveUser(e){return(0,y.z)(this.serverApiClient.v1.features.getAndEvaluateForUser({features:e}).pipe((0,b.nb)({success:e=>e.data.enabledFeatures,failure:()=>{throw new Error("Unable to fetch enabled feature flips for the active user")}})))}getAvailableFeatureFlips(){return(0,y.z)(this.serverApiClient.v1.features.listAvailableFeatureFlips({}).pipe((0,b.nb)({success:e=>e.data.features.map((e=>e.name)),failure:()=>{throw new Error("Unable to fetch available feature flips")}})))}constructor(e){this.serverApiClient=e}}w=(0,n.gn)([(0,f.GS)(),(0,n.w6)("design:type",Function),(0,n.w6)("design:paramtypes",[void 0===S.l?Object:S.l])],w);var E=s(63144),_=s(56618),C=s(62149),I=s(60018),T=s(3873);const A=e=>(0,T.K)(e)&&"featureFlips"in e;class U extends((0,E.Q)({persist:!0,scope:C.F.Device,storeName:"feature-flip-store",capacity:_.Y._010KB,codec:I.E,storage:{initialValue:{featureFlips:{}},schemaVersion:1,typeGuard:A}})){}class N extends((0,E.Q)({persist:!0,isCache:!0,scope:C.F.User,storeName:"feature-flip-store",capacity:_.Y._010KB,codec:I.E,storage:{initialValue:{featureFlips:{}},schemaVersion:1,typeGuard:A}})){}var O=function(e){return e.Success="Success",e.Pending="Pending",e.Loading="Loading",e.Cache="Cache",e}({});class D extends((0,E.Q)({persist:!1,initialValue:{refreshStatus:"Pending"},scope:C.F.Device,storeName:"feature-flip-refresh-store",capacity:_.Y._001KB})){}function F(e){return[O.Success,O.Cache].includes(e)}const P=(e,t)=>Object.keys(e).reduce(((s,n)=>{const r=t[n];return s[n]=void 0!==r?r.isActivated:e[n],s}),{}),R=e=>(0,T.K)(e)&&"availableLabs"in e&&(0,T.K)(e.availableLabs);class x extends((0,E.Q)({persist:!0,isCache:!0,scope:C.F.User,storeName:"labs-store",capacity:_.Y._001KB,codec:I.E,storage:{initialValue:{availableLabs:{}},schemaVersion:1,typeGuard:R}})){}var L=s(4373),k=s(98124);class j extends((0,k.Hu)("refresh_available_labs_failed","Unable to refresh available labs for the active user")){}class M extends((0,k.Hu)("fetch_available_labs_failed","Unable to fetch labs for the active user")){}class z{async refreshAvailableLabs(){const e=await this.getAvailableLabs();if((0,v.hx)(e))return(0,v.Rn)(new j);const t=await this.labsStore.getState(),s=(0,v.db)(e).reduce(((e,s)=>(e[s.featureName]={...s,isActivated:!!t.availableLabs[s.featureName]?.isActivated},e)),{});return await this.labsStore.set({availableLabs:s}),(0,v.Vp)(void 0)}async getAvailableLabs(){const e=this.getRequiredFeatures(),{featureFlips:t}=await this.featureFlipsStore.getState();return(0,y.z)(this.serverApiClient.v1.features.listAvailableLabs({}).pipe((0,b.DZ)((()=>new M)),(0,b.lk)((s=>(0,v.Vp)(s.data.labs.filter((t=>e.has(t.featureName))).filter((e=>!1===t[e.featureName])))))))}getRequiredFeatures(){const e=this.introspection.modules;return Object.keys(e).reduce(((t,s)=>{const n=e[s];if(n.requiredFeatureFlips)for(const e of n.requiredFeatureFlips)t.add(e);return t}),new Set)}constructor(e,t,s,n){this.serverApiClient=e,this.introspection=t,this.featureFlipsStore=s,this.labsStore=n}}z=(0,n.gn)([(0,f.GS)(),(0,n.w6)("design:type",Function),(0,n.w6)("design:paramtypes",[void 0===S.l?Object:S.l,void 0===L.Q1?Object:L.Q1,void 0===N?Object:N,void 0===x?Object:x])],z);class V{async handle({body:e}){if(!e.userName)return await this.featureFlipsRefreshStore.set({refreshStatus:O.Pending}),void await this.featureFlipsStore.set({featureFlips:{}});await this.featureFlipsRefreshStore.set({refreshStatus:O.Loading});const t=this.labsService.getRequiredFeatures(),s=Array.from(t);let n=[];await this.allowedToFailForGetAvailableFeatureFlips.doOne((()=>this.featureFlipsService.getAvailableFeatureFlips().then((e=>{n=e.filter((e=>t.has(e)))}))));const r=0===n.length?s:n;await this.allowedToFailForGetFeatureFlipsForActiveUser.doOne((async()=>{try{const e=await this.featureFlipsService.getFeatureFlipsForActiveUser(r),t=new Set(e),i=new Set(n),a=s.reduce(((e,s)=>(e[s]=t.has(s)||!i.has(s)&&void 0,e)),{});await this.featureFlipsStore.set({featureFlips:a}),await this.allowedToFailForGetAvailableLabs.doOne((async()=>{await this.labsService.refreshAvailableLabs()})),await this.featureFlipsRefreshStore.set({refreshStatus:O.Success})}catch(e){throw await this.featureFlipsRefreshStore.set({refreshStatus:O.Cache}),e}}))}constructor(e,t,s,n,r,i,a){this.allowedToFailForGetAvailableFeatureFlips=e,this.allowedToFailForGetFeatureFlipsForActiveUser=t,this.allowedToFailForGetAvailableLabs=s,this.featureFlipsService=n,this.featureFlipsStore=r,this.featureFlipsRefreshStore=i,this.labsService=a}}V=(0,n.gn)([(0,p.b)(a.W_),(0,n.w6)("design:type",Function),(0,n.w6)("design:paramtypes",[void 0===m.J?Object:m.J,void 0===m.J?Object:m.J,void 0===m.J?Object:m.J,void 0===w?Object:w,void 0===N?Object:N,void 0===D?Object:D,void 0===z?Object:z])],V);class B{execute(){return(0,o.a)([this.featureFlipsRefreshStore.state$.pipe((0,c.U)((e=>e.refreshStatus))),this.featureFlipsStore.state$.pipe((0,c.U)((e=>e.featureFlips)),(0,d.x)(u.shallowEqualObjects)),this.labsStore.state$.pipe((0,c.U)((e=>e.availableLabs)),(0,d.x)(u.shallowEqualObjects))]).pipe((0,l.h)((([e])=>F(e))),(0,c.U)((([,e,t])=>{const s=P(e,t);return(0,v.Vp)(s)})))}constructor(e,t,s){this.featureFlipsStore=e,this.featureFlipsRefreshStore=t,this.labsStore=s}}B=(0,n.gn)([(0,h.e)(i.r6),(0,n.w6)("design:type",Function),(0,n.w6)("design:paramtypes",[void 0===N?Object:N,void 0===D?Object:D,void 0===x?Object:x])],B);class K{execute({body:e}){return(0,o.a)([this.featureFlipsRefreshStore.state$.pipe((0,c.U)((e=>e.refreshStatus))),this.featureFlipsStore.state$.pipe((0,c.U)((e=>e.featureFlips)),(0,d.x)(u.shallowEqualObjects)),this.labsStore.state$.pipe((0,c.U)((e=>e.availableLabs)),(0,d.x)(u.shallowEqualObjects))]).pipe((0,l.h)((([e])=>F(e))),(0,c.U)((([,t,s])=>P(t,s)[e.featureFlip])),(0,d.x)(),(0,c.U)(v.Vp))}constructor(e,t,s){this.featureFlipsStore=e,this.featureFlipsRefreshStore=t,this.labsStore=s}}K=(0,n.gn)([(0,h.e)(i.fV),(0,n.w6)("design:type",Function),(0,n.w6)("design:paramtypes",[void 0===N?Object:N,void 0===D?Object:D,void 0===x?Object:x])],K);class G{execute(){return(0,o.a)([this.featureFlipsRefreshStore.state$.pipe((0,c.U)((e=>e.refreshStatus))),this.labsStore.state$.pipe((0,c.U)((e=>e.availableLabs)),(0,d.x)(u.shallowEqualObjects))]).pipe((0,l.h)((([e])=>F(e))),(0,c.U)((([,e])=>(0,v.Vp)(e))))}constructor(e,t){this.labsStore=e,this.featureFlipsRefreshStore=t}}G=(0,n.gn)([(0,h.e)(i._l),(0,n.w6)("design:type",Function),(0,n.w6)("design:paramtypes",[void 0===x?Object:x,void 0===D?Object:D])],G);class ${async execute(){return await this.allowedToFailForGetAvailableLabs.doOne((async()=>{await this.labsService.refreshAvailableLabs()})),(0,v.Vp)(void 0)}constructor(e,t){this.allowedToFailForGetAvailableLabs=e,this.labsService=t}}$=(0,n.gn)([(0,g.W)(i._x),(0,n.w6)("design:type",Function),(0,n.w6)("design:paramtypes",[void 0===m.J?Object:m.J,void 0===z?Object:z])],$);class q{async execute({body:e}){const{id:t,isActivated:s}=e,n=await this.labsStore.getState(),r={...n,availableLabs:{...n.availableLabs,[t]:{...n.availableLabs[t],isActivated:s}}};return await this.labsStore.set(r),(0,v.Vp)(void 0)}constructor(e){this.labsStore=e}}q=(0,n.gn)([(0,g.W)(i.YM),(0,n.w6)("design:type",Function),(0,n.w6)("design:paramtypes",[void 0===x?Object:x])],q);class H{onFrameworkInit(){this.featureFlipsStoreLegacy.clearStorage()}constructor(e){this.featureFlipsStoreLegacy=e}}H=(0,n.gn)([(0,f.ar)(),(0,n.w6)("design:type",Function),(0,n.w6)("design:paramtypes",[void 0===U?Object:U])],H);var W=s(41511);class Q{}Q=(0,n.gn)([(0,r.Y)({api:i.cV,providers:[w,z],imports:[W.n],exports:[w],handlers:{commands:{refreshAvailableLabs:$,toggleLab:q},queries:{userFeatureFlips:B,userFeatureFlip:K,userAvailableLabs:G},events:{...(0,r.g)(a.t$,{activeUserSet:V})}},stores:[U,N,D,x],requiredFeatureFlips:Object.values({AuthsyncExtensionArkRelease:"authsync_extension_ark_release",BBCOM238Duo:"BBCOM-238-duo",CollectionsPageEnabled:"vault_web_collectionpage_dev",SAEXSendSharing:"SAEXSendSharing",DwiMultipleDomainsProd:"dwi_multiple_domains_prod",DisableSecureNotes:"disableSecureNotes",EcommerceWebB2BDiscontinuationDev:"ecommerce_web_b2bDiscontinuation_dev",ItadminSAEXCryptoMigrationPhase3V1:"itadmin_SAEX_CryptoMigration_Phase3_v1",ItadminTacEncryptionserviceSSOmigrationReset:"itadmin_tac_encryptionservice_SSOmigration_reset",SearchRevamp:"onboarding_web_search_revamp_prod",SettingsRevamp:"activationRetention_web_refactor_settings_page_dev",EmptyStateBatch1:"onboarding_web_empty_state_batch1_dev",EmptyStateBatch2:"onboarding_web_empty_state_batch2",EmptyStateBatch3:"onboarding_web_empty_state_batch3",TechWeekWebDisplayLabs:"techWeek_web_displayLabs",TechweekWebAttachmentsForIdsV1:"techweek_web_attachmentsForIds_v1",TechweekWebExpiredLabelforIDDev:"techweek_web_expiredLabelforID_dev",WebplatformWebPrideColors:"webplatform_web_prideColors",WebproductExtensionActivateChangeMasterPasswordRelease:"webproduct_extension_ActivateChangeMasterPassword_release",WebproductExtensionShowUserConsentOptions:"webproduct_extension_ShowUserConsentOptions",SupportMarkdownInSecureNotes:"webproduct_extension_securenotesmarkdown_dev",SharingVaultOtpSetupDev:"sharingVault_web_otp_setup_dev"}),onFrameworkInit:H,domainName:"framework"})],Q)},93218:(e,t,s)=>{s.d(t,{p:()=>R});var n=s(92336),r=s(86006),i=s(86213),a=s(59965),o=s(82874),c=s(78346),d=s(50123),l=s(60399),u=s(92587),p=s(17991),m=s(63144),h=s(56618),g=s(62149),v=s(60018);const y=e=>null!==e&&"object"==typeof e&&("cachedIcons"in e&&null!==e.cachedIcons&&"object"==typeof e.cachedIcons);class f extends((0,m.Q)({persist:!0,storage:{schemaVersion:1,initialValue:{cachedIcons:{}},typeGuard:y},scope:g.F.Device,storeName:"icons-store",capacity:h.Y._100KB,codec:v.E})){}const b=e=>e<0?0:24*e*60*60*1e3,S=e=>null!==e&&"object"==typeof e&&"validity"in e&&"updatedAt"in e&&"domainURL"in e,w=e=>e.hash.slice(0,6);var E=s(55667),_=s(53344);class C{async updateIconsCacheEntries(e){const t=await this.store.getState();await this.store.set({...t,cachedIcons:{...t.cachedIcons,...e.reduce(((e,t)=>(e[t.domainURL]=t,e)),{})}})}async computeDomainHash(e){const t=await this.hasher.compute((new TextEncoder).encode(e),"SHA-256");return(0,p.k)(t)}async fetchIconForDomain(e){const t=await this.computeDomainHash(e);this.domainsToFetch[e]={hash:t,domainURL:e},this.fetchAndRequestDomains()}constructor(e,t,s,n){this.hasher=e,this.serverApiClient=t,this.store=s,this.domainsToFetch=n,this.requestDomains=async e=>{0!==e.length&&this.serverApiClient.v1.icons.requestIcons({domains:e.map((e=>e.domainURL))})},this.fetchDomains=async e=>{const t=e.map(w);return await(0,l.z)(this.serverApiClient.v1.icons.getIcons({hashes:t}))},this.fetchAndRequestDomains=((e,t)=>{let s=!1;return(...n)=>{s||(s=!0,setTimeout((()=>{s=!1,e(...n)}),t))}})((async()=>{const e=(await this.store.getState()).cachedIcons,t=Object.values(this.domainsToFetch).filter((t=>{const s=void 0===e[t.domainURL]?void 0:e[t.domainURL],n=(e=>null!==e&&"object"==typeof e&&"updatedAt"in e&&"domainURL"in e&&!S(e))(s)?b(1):b(14);return((e,t)=>!(e&&Date.now()<e.updatedAt+t))(s,n)}));if(0===t.length)return;const s=await this.fetchDomains(t),n=(0,c.d6)(s)?(0,c.db)(s).data.icons:[],r=t.map((e=>{const t=n.find((t=>t.hash===e.hash));return{...t||{},hash:e.hash,domainURL:e.domainURL,updatedAt:Date.now()}}));await this.updateIconsCacheEntries(r);const i=r.filter((e=>!e.url));await this.requestDomains(i),this.domainsToFetch={}}),100)}}C=(0,n.gn)([(0,u.GS)(),(0,n.w6)("design:type",Function),(0,n.w6)("design:paramtypes",[void 0===E.Z?Object:E.Z,void 0===_.l?Object:_.l,void 0===f?Object:f,"undefined"==typeof DomainsToFetch?Object:DomainsToFetch])],C);class I{execute({body:{domainURL:e}}){return this.iconsService.fetchIconForDomain(e),Promise.resolve((0,c.Vp)(void 0))}constructor(e){this.iconsService=e}}I=(0,n.gn)([(0,o.W)(d.F),(0,n.w6)("design:type",Function),(0,n.w6)("design:paramtypes",[void 0===C?Object:C])],I);var T=s(87065),A=s(6136),U=s(62760),N=s(46449),O=s(17482);class D{execute(e){return this.store.state$.pipe((0,T.U)((t=>{const s=t.cachedIcons[e.body.domainURL];return S(s)&&(e=>"valid"===e.validity&&Boolean(e.url))(s)?s:null})),(0,A.x)(U.shallowEqualObjects),(0,T.U)((e=>e?(0,c.Vp)(e):(0,c.Rn)((0,O.xF)()))))}constructor(e){this.store=e}}D=(0,n.gn)([(0,N.e)(O.el),(0,n.w6)("design:type",Function),(0,n.w6)("design:paramtypes",[void 0===f?Object:f])],D);var F=s(40416),P=s(41511);class R{}R=(0,n.gn)([(0,r.Y)({api:a.T,imports:[F.D,P.n],providers:[...(0,i.H)(C,{inject:[E.Z,_.l,f],asyncFactory:(e,t,s)=>Promise.resolve(new C(e,t,s,{}))})],stores:[f],handlers:{commands:{fetchIconForDomain:I},events:{},queries:{getIconForDomain:D}}})],R)},10842:(e,t,s)=>{s.d(t,{B:()=>b});var n=s(92336),r=s(86006),i=s(55385),a=s(35463),o=s(41182),c=s(37182),d=s(69885),l=s(6136),u=s(87065),p=s(14122),m=s(46449),h=s(9363),g=s(91247),v=s(33312),y=s(78346);class f{execute({body:e}){return this.carbon.queries.liveKillSwitch(e.killSwitch).pipe((0,v.nb)({failure:e=>{throw new Error("Unexpected failure getting kill switch value from Carbon",{cause:e})},success:o.y}),(0,c.K)((e=>(this.exceptionLogger.captureException(e,{useCaseName:"getKillSwitchQuery"}),(0,d.of)(void 0)))),(0,l.x)(),(0,u.U)(y.Vp))}constructor(e,t){this.carbon=e,this.exceptionLogger=t}}f=(0,n.gn)([(0,m.e)(g.K),(0,n.w6)("design:type",Function),(0,n.w6)("design:paramtypes",[void 0===p._?Object:p._,void 0===h.v?Object:h.v])],f);class b{}b=(0,n.gn)([(0,r.Y)({api:a.m,handlers:{commands:{},events:{},queries:{getKillSwitch:f}},imports:[i.G],domainName:"framework"})],b)},58484:(e,t,s)=>{s.d(t,{T:()=>o});var n=s(92336),r=s(86006),i=s(41511),a=s(66916);class o{}o=(0,n.gn)([(0,r.Y)({sharedModuleName:"logging-nodews-adapters",imports:[i.n],providers:[a.T],exports:[a.T],domainName:"framework"})],o)},66916:(e,t,s)=>{s.d(t,{T:()=>h});var n=s(92336),r=s(86766),i=s(98722),a=s(53066),o=s(15023),c=s(42946),d=s(22437),l=s(60399),u=s(78346),p=s(92587),m=s(53344);class h{async process(e){const t=this.partitionLogsByDiagnosticsId(e),s=this.prepareBatches(t),n=(0,a.F)(500).pipe((0,o.o)((()=>s.length>0)),(0,c.z)((()=>{const[e]=s.splice(0,1),[t,n]=e;return this.processLogBatch(t,n)})),(0,d.u)(((e,t)=>(0,r.Z)([e,t])),{}));return await(0,l.z)(n)}prepareBatches(e){return(0,i.Z)(Object.entries(e).map((([e,t])=>{const s=[],n=Object.keys(t);for(;n.length>0;){const r=n.splice(0,100);s.push([e,r.reduce(((e,s)=>(e[s]=t[s],e)),{})])}return s})))}async processLogBatch(e,t){const s=Object.values(t).map(this.translateLog),n=await(0,l.z)(this.serverApiClient.v1.monitoring.reportDiagnosticLogs({logs:s,diagnosticsId:e},{timeout:2e3})).catch((e=>(0,u.Rn)(e))),r=e=>Object.keys(t).reduce(((t,s)=>(t[s]=e,t)),{});return(0,u.f2)(n,{success:()=>r(!0),failure:e=>(console.error("Failed to send diagnostic logs to server",e),r(!1))})}partitionLogsByDiagnosticsId(e){return Object.keys(e).reduce(((t,s)=>{const n=e[s],r=n.diagnosticsId in t?t[n.diagnosticsId]:{};return r[s]=n,t[n.diagnosticsId]=r,t}),{})}translateLog(e){return{message:e.message,metadata:e.metadata??{},domainName:e.domain??"no-domain",moduleName:e.module,logTimestamp:e.timestamp}}constructor(e){this.serverApiClient=e}}h=(0,n.gn)([(0,p.GS)(),(0,n.w6)("design:type",Function),(0,n.w6)("design:paramtypes",[void 0===m.l?Object:m.l])],h)},5206:(e,t,s)=>{s.d(t,{i:()=>p});var n=s(92336),r=s(74650),i=s(86006),a=s(60590),o=s(14122),c=s(46449),d=s(33312),l=s(78346);class u{execute(){return this.carbon.queries.getPlatformInfo().pipe((0,d.lk)(l.Vp))}constructor(e){this.carbon=e}}u=(0,n.gn)([(0,c.e)(r.a),(0,n.w6)("design:type",Function),(0,n.w6)("design:paramtypes",[void 0===o._?Object:o._])],u);class p{}p=(0,n.gn)([(0,i.Y)({api:r.J,providers:[a.t],exports:[a.t],handlers:{commands:{},events:{},queries:{platformInfo:u}},domainName:"framework"})],p)},60590:(e,t,s)=>{s.d(t,{t:()=>l});var n=s(92336),r=s(60399),i=s(92587),a=s(53932),o=s(33312),c=s(17591),d=s(14676);class l{getPlatformInfo(){return(0,r.z)(this.client.getClient(d.W).queries.getPlatformInfo().pipe((0,o.nb)({success:e=>e,failure:c.j})))}constructor(e){this.client=e}}l=(0,n.gn)([(0,i.GS)(),(0,n.w6)("design:type",Function),(0,n.w6)("design:paramtypes",[void 0===a.m?Object:a.m])],l)},86999:(e,t,s)=>{s.d(t,{c:()=>d});var n=s(92336),r=s(92587),i=s(78346),a=s(14122),o=s(48062),c=s(37741);class d extends c.tI{async decipher(e,t){const{carbon:s}=this.carbonLegacyClient.commands,n=await s({name:"decipherRemoteFile",args:[{cipheredFileContent:e,fileMetaData:t}]});if((0,i.hx)(n))return(0,i.Rn)(o.RemoteFileUpdateError.DecipherError);const{carbonResult:r}=(0,i.db)(n);return(e=>"object"==typeof e&&null!==e&&Object.entries(e).some((([e,t])=>"decipheredFile"===e&&t instanceof ArrayBuffer)))(r)?(0,i.Vp)(r.decipheredFile):(0,i.Rn)(o.RemoteFileUpdateError.DecipherError)}constructor(e){super(),this.carbonLegacyClient=e}}d=(0,n.gn)([(0,r.GS)(),(0,n.w6)("design:type",Function),(0,n.w6)("design:paramtypes",[void 0===a._?Object:a._])],d)},7301:(e,t,s)=>{s.d(t,{Q:()=>c});var n=s(92336),r=s(92587),i=s(60399),a=s(7537),o=s(58376);class c{publish(e){(0,i.z)(this.publishSubscriber).then((t=>t.next(e)))}fileSubscription(e){return this.filesToCheck={...this.filesToCheck,...e},this.updatedFileStream$}getFilesToCheck(){return this.filesToCheck}constructor(){this.filesToCheck={},this.publishSubscriber=new a.t,this.updatedFileStream$=new o.y((e=>{this.publishSubscriber.next(e),this.publishSubscriber.complete()}))}}c=(0,n.gn)([(0,r.GS)(),(0,n.w6)("design:type",Function),(0,n.w6)("design:paramtypes",[])],c)},39976:(e,t,s)=>{s.d(t,{P:()=>f});var n=s(92336),r=s(78346),i=s(33312),a=s(52477),o=s(48062),c=s(92587),d=s(26549),l=s(69885),u=s(60399),p=s(87065),m=s(37741),h=s(39069),g=s(18920),v=s(53344);const y=e=>e[1].status===h.nQ;class f extends m.gG{async downloadRemoteFileUpdate(e){if(0===Object.keys(e.files).length)return[];const t=await this._getFileMeta(e);return(0,r.hx)(t)?[(0,l.of)(t)]:this._retrieveFilesFromServer((0,r.db)(t))}_getFileMeta(e){return(0,u.z)(this.serverApiClient.v1.file.getFileMetaV2(e).pipe((0,p.U)((e=>{if((0,r.hx)(e))return(0,r.Rn)(o.RemoteFileUpdateError.ServerError);const t=(0,r.db)(e);return"fileInfos"in(s=t.data)&&Object.values(s.fileInfos).every((e=>"object"==typeof e&&null!==e&&"status"in e&&void 0!==e.status&&null!==e.status&&h.PQ.has(e.status)))?(0,r.Vp)(t.data.fileInfos):(0,r.Rn)(o.RemoteFileUpdateError.ServerError);var s}))))}_retrieveFilesFromServer(e){return Object.entries(e).filter(y).map((([e,t])=>this._getBufferFromURL(e,t)))}_getBufferFromURL(e,t){return this.httpClient.get(t.url,{observe:"body",responseType:"arraybuffer"}).pipe((0,i.Qn)(this._handleSuccess(e,t)),(0,i.DZ)(this._handleFailure))}_handleFailure(e){return(0,a.EQ)(e,{BadStatus:e=>e.response.status===g.W.NotModified?h.ek:o.RemoteFileUpdateError.DownloadError,FetchFailedError:()=>o.RemoteFileUpdateError.DownloadError})}_handleSuccess(e,t){return s=>({fileName:e,buffer:s,updatedFile:t})}constructor(e,t){super(),this.httpClient=e,this.serverApiClient=t}}f=(0,n.gn)([(0,c.GS)(),(0,n.w6)("design:type",Function),(0,n.w6)("design:paramtypes",[void 0===d.e?Object:d.e,void 0===v.l?Object:v.l])],f)},1598:(e,t,s)=>{s.d(t,{u:()=>u,w:()=>l});var n=s(59788),r=s(94691),i=s(41842),a=s(87065),o=s(25859),c=s(6220),d=s(7301);class l{initFileObservation(){this.newlyUpdatedFiles$.subscribe(this._handleRFUDownload.bind(this))}streamFileUpdate(){return this.store.state$.pipe((0,i.h)((e=>0!==e.revision)),(0,a.U)((e=>e.data)),(0,i.h)((e=>this.settings.typeguard(e))))}async _handleRFUDownload(e){const{fileName:t}=this.settings;if(!(t in e))return;const s=e[t],n=this.jsonSerializerCodec.decode(s.buffer);this.settings.typeguard(n)&&(await this.store.set({filename:s.fileName,data:n,revision:s.revision,lastDownloadTimestamp:s.lastDownloadTimestamp}),this.rfuDispatcher.fileSubscription({[t]:s.revision}))}constructor(e,t,s,n){this.settings=e,this.store=t,this.appLogger=s,this.rfuDispatcher=n;const{fileName:i}=e;this.jsonSerializerCodec=new r.b,this.newlyUpdatedFiles$=(0,o.P)((async()=>{const e=await this.store.getState();return{[i]:e.revision}})).pipe((0,c.z)((e=>this.rfuDispatcher.fileSubscription(e))))}}function u(e){return{token:l,asyncFactory:(t,s,n)=>Promise.resolve(new l(e,t,s,n)),inject:[e.storeClass,n.V,d.Q]}}},47830:(e,t,s)=>{s.d(t,{Q:()=>h});var n=s(92336),r=s(92587),i=s(1598),a=s(76053),o=s(63144),c=s(56618),d=s(60018),l=s(62149);const u=e=>!("object"!=typeof e||null===e)&&("filename"in e&&null!==e.filename&&void 0!==e.filename&&"string"==typeof e.filename&&"revision"in e&&null!==e.revision&&void 0!==e.revision&&"number"==typeof e.revision),p=e=>({filename:e,revision:0,data:{},lastDownloadTimestamp:Date.now()});class m{onFrameworkInit(){this.rfuClient.initFileObservation()}constructor(e){this.rfuClient=e}}m=(0,n.gn)([(0,r.ar)(),(0,n.w6)("design:type",Function),(0,n.w6)("design:paramtypes",[void 0===i.w?Object:i.w])],m);const h=(e,t)=>{const s=(e=>class extends((0,o.Q)({storeName:"RFUStore",persist:!0,storage:{schemaVersion:1,initialValue:p(e),typeGuard:u},codec:d.E,storeTypeGuard:u,capacity:c.Y._010KB,scope:l.F.Device,isCache:!0})){})(e);return{providers:[(0,i.u)({fileName:e,storeClass:s,typeguard:t})],onFrameworkInit:[m],imports:[a.Q],stores:[s]}}},37741:(e,t,s)=>{s.d(t,{gG:()=>n,pF:()=>i,tI:()=>r});class n{}class r{}class i{}},76053:(e,t,s)=>{s.d(t,{Q:()=>y});var n=s(92336),r=s(86006),i=s(75421),a=s(62149),o=s(39976),c=s(92587),d=s(7301),l=s(37741);class u{run(){const e=this.dispatcherService.getFilesToCheck();this.remoteFileUpdateService.observeRemoteFileUpdates(e).subscribe((e=>{this.dispatcherService.publish(e)})),this.remoteFileUpdateService.downloadAndDecipherRemoteFiles()}constructor(e,t){this.remoteFileUpdateService=e,this.dispatcherService=t}}u=(0,n.gn)([(0,c.GS)(),(0,n.w6)("design:type",Function),(0,n.w6)("design:paramtypes",[void 0===l.pF?Object:l.pF,void 0===d.Q?Object:d.Q])],u);var p=s(86999),m=s(15792),h=s(13002),g=s(41511),v=s(23047);class y{static configure(e,t,s){return{module:y,configurations:{remoteFileUpdateInfrastructure:e,remoteFileUpdateDownloaderInfrastructure:t,decipherInfrastructure:s}}}}y=(0,n.gn)([(0,r.Y)({sharedModuleName:"RemoteFileUpdateModule",configurations:{remoteFileUpdateInfrastructure:{token:l.pF},remoteFileUpdateDownloaderInfrastructure:{token:l.gG},decipherInfrastructure:{token:l.tI}},crons:[{handler:u,periodInMinutes:30,name:"RFUCron",scope:a.F.User}],providers:[m.U,p.c,o.P,d.Q],imports:[h.k,i.X,g.n,v.I],exports:[m.U,p.c,o.P,d.Q],domainName:"framework"})],y)},15792:(e,t,s)=>{s.d(t,{U:()=>b});var n=s(92336),r=s(92587),i=s(53932),a=s(78346),o=s(91501),c=s(6220),d=s(87065),l=s(60399),u=s(7537),p=s(58376),m=s(5574),h=s(86999),g=s(39976),v=s(37741),y=s(39069),f=s(48062);class b extends v.pF{observeRemoteFileUpdates(e){return this._filesToCheck={files:{...this._filesToCheck.files,...e}},this._downloadedFileStream$}async downloadAndDecipherRemoteFiles(){const e=(await this.rfuDownloaderService.downloadRemoteFileUpdate(this._filesToCheck)).map((e=>this._downloadAndDecipherSingleFile(e)));(0,o.D)(e).subscribe((e=>{const t=e.reduce(((e,t)=>{if((0,a.hx)(t)){const s=(0,a.Yv)(t);return s===y.ek||this.sendRFUEvents(f.FlowStep.Error,s),e}const s=(0,a.db)(t);return this.sendRFUEvents(f.FlowStep.Complete),{...e,[s.fileName]:s}}),{});this._callEmitDownloadedFilesUpdate(t)}))}async _applyDecipheringStep(e){const t=e.updatedFile.key?await this.rfuDecipheringService.decipher(e.buffer,e.updatedFile):(0,a.Vp)(e.buffer);return(0,a.d6)(t)?(0,a.Vp)({...e,buffer:(0,a.db)(t)}):t}_downloadAndDecipherSingleFile(e){return e.pipe((0,c.z)((e=>(0,a.d6)(e)?this._applyDecipheringStep((0,a.db)(e)):Promise.resolve(e))),(0,d.U)((e=>{if((0,a.hx)(e))return e;const{fileName:t,updatedFile:s,buffer:n}=(0,a.db)(e);return(0,a.Vp)({fileName:t,revision:s.revision,buffer:n,lastDownloadTimestamp:Date.now()})})))}_callEmitDownloadedFilesUpdate(e){return(0,l.z)(this._emitDownloadedFilesUpdate$).then((t=>{t(e)}))}sendRFUEvents(e,t=undefined){const{trackEvent:s}=this.cqrsClient.getClient(m.Yu).commands;s({event:new f.UserReceiveRemoteFileUpdateEvent({flowStep:e,remoteFileUpdateError:t,packageSource:f.PackageSource.Graphene})})}constructor(e,t,s){super(),this.rfuDownloaderService=e,this.rfuDecipheringService=t,this.cqrsClient=s,this._filesToCheck={files:{}},this._emitDownloadedFilesUpdate$=new u.t,this._downloadedFileStream$=new p.y((e=>{this._emitDownloadedFilesUpdate$.next((t=>{e.next(t)})),this._emitDownloadedFilesUpdate$.complete()}))}}b=(0,n.gn)([(0,r.GS)(),(0,n.w6)("design:type",Function),(0,n.w6)("design:paramtypes",[void 0===g.P?Object:g.P,void 0===h.c?Object:h.c,void 0===i.w?Object:i.w])],b)},39069:(e,t,s)=>{s.d(t,{PQ:()=>r,ek:()=>i,nQ:()=>n});const n="update_available",r=new Set([n,"not_updated","not_found","error_server"]),i="not_modified"},44462:(e,t,s)=>{s.d(t,{L:()=>n});class n{constructor(e){this.serverEndpoint=e.serverEndpoint,this.durationInQueue=e.durationInQueue,this.maxExceptionCountPerSession=e.maxExceptionCountPerSession,this.retryDelay=e.retryDelay}}},87027:(e,t,s)=>{s.d(t,{u:()=>P});var n=s(92336),r=s(60399),i=s(41842),a=s(87065),o=s(6136),c=s(34987),d=s(14888),l=s(24966),u=s(86433),p=s(92587),m=s(26549),h=s(60785),g=s(59788),v=s(94691),y=s(97143);var f=s(77931),b=s(75172),S=s(78346),w=s(69259),E=s(60590),_=s(44462),C=s(30558);function I(e){switch(e){case u.T.CRITICAL:return 2;case u.T.WARNING:return 1}}const T=(e,t)=>({action:"logOnline",code:I(t.criticality),type:e.platformName,version:e.appVersion,additionalInfo:JSON.stringify({manifestVersion:e.manifestVersion,buildType:e.buildType,...t.origin?{origin:t.origin}:{},cause:t.cause,domainName:t.domainName??"unknown"}),browser:e.browser,browserVersion:e.browserVersion,exceptiontype:t.exceptionType??"grapheneException",message:t.message,os:e.os,osVersion:e.osVersion,sessionId:t.sessionId,stack:t.callStack,initialUseCaseModule:t.moduleName,initialUseCaseName:t.useCaseName,errorCount:1,featureFlips:(t.featuresFlipped??[]).join(","),line:t.lineNumber,file:t.fileLocation});function A(e,t){return new C.L("string"==typeof(s=T(e,t))?s:Object.keys(s).reduce(((e,t)=>{const n=s[t];return void 0===n||(e[t]="string"==typeof n?n:JSON.stringify(n)),e}),{}));var s}const U={"Content-Type":"application/x-www-form-urlencoded"},N=".graphene.exceptionLogs",O=new v.b,D=new class{decode(e){if(this.typeGuard(e))return e;throw new Error("Bad type")}encode(e){return e}constructor(e){(0,y._)(this,"typeGuard",void 0),this.typeGuard=e}}((e=>!(!e||"object"!=typeof e)&&(0===Object.keys(e).length||Object.keys(e).every((e=>"string"==typeof e))&&Object.values(e).every((e=>{return!!((t=e)&&"object"==typeof t&&"entry"in t&&"id"in t&&"date"in t)&&"string"==typeof t.id&&"number"==typeof t.date&&(0,u.h)(t.entry);var t}))))),F=new f.z;class P{async logException(e){console.error(e);const t=this.settings.maxExceptionCountPerSession??10,s=e.message.length?e.message:"UNKNOWN_EXCEPTION";if(s in this.logExceptionsCount){const e=this.logExceptionsCount[s];if(e===t)return Promise.resolve();this.logExceptionsCount[s]=e+1}else this.logExceptionsCount[s]=1;const n=await this.enqueue(e);await(0,r.z)(this.queue$.pipe((0,i.h)((e=>!(n in e)||!!e[n].error))))}async start(){await this.safeLoadPlatformInfo(),await this.loadQueue();const e=this.settings.retryDelay??6e4,t=this.queue$.pipe((0,a.U)((e=>Object.keys(e))),(0,o.x)(((e,t)=>t.every((t=>e.includes(t))))),(0,c.b)((()=>this.processQueue())),(0,d.X)({delay:e})).subscribe();return{stop:async()=>{t.unsubscribe(),await this.saveQueue()}}}async safeLoadPlatformInfo(){try{this.platformInfo=await this.platformInfoService.getPlatformInfo()}catch(e){this.logger.error("Failed to get platform info, using defaults"),this.platformInfo={platformName:"server_carbon_unknown",lang:"unknown",browser:"unknown",country:"unknown",buildType:w.P.PRODUCTION,osCountry:"unknown",osVersion:"unknown",appVersion:"unknown",browserVersion:"unknown",os:"unknown"}}}async ignoreError(e){try{return await e(),!0}catch(e){return this.logger.error("Failed to send exception log"),!1}}async saveQueue(){await this.ignoreError((async()=>{const e=await this.codec.encode(this.queue$.value);await this.kvStore.set(N,e)}))}async loadQueue(){await this.ignoreError((async()=>{const e=await this.kvStore.get(N);if(!e||""===e)return void this.queue$.next({});const t=await this.codec.decode(e),s=Date.now()-(this.settings.durationInQueue??864e5);for(const e of Object.keys(t))t[e].date<s&&delete t[e];this.queue$.next(t)}))}async enqueue(e){const t={date:Date.now(),entry:e,id:`${Date.now()}-${Math.random()}`};return this.queue$.value[t.id]=t,await this.saveQueue(),this.queue$.next(this.queue$.value),t.id}async processQueue(){const e=this.platformInfo;if(!e)throw new Error("No platform info");for(;Object.keys(this.queue$.value).length>0;){const t=Object.keys(this.queue$.value)[0],s=this.queue$.value[t];if(!await this.ignoreError((async()=>{const t=await(0,r.z)(this.httpClient.post(this.url,A(e,s.entry),{headers:{...U,"Client-Agent":(n=e,`version:${n.appVersion},platform:${n.platformName}}`)},observe:"response"}));var n;if(!(0,S.d6)(t))throw new Error("Failed to send log")})))throw this.queue$.value[t].error=!0,this.queue$.next(this.queue$.value),new Error("failed to send an item from the queue");delete this.queue$.value[t],await this.saveQueue()}this.queue$.next(this.queue$.value)}constructor(e,t,s,n,r){this.httpClient=e,this.kvStore=t,this.logger=s,this.settings=n,this.platformInfoService=r,this.queue$=new l.X({}),this.logExceptionsCount={},this.platformInfo=null,this.url=`${this.settings.serverEndpoint??"https://kck3hlb9.dashlane.com"}/1/softwarelog/create`,this.codec=(0,b.x)(F,O,D)}}P=(0,n.gn)([(0,p.GS)(),(0,n.w6)("design:type",Function),(0,n.w6)("design:paramtypes",[void 0===m.e?Object:m.e,void 0===h.QI?Object:h.QI,void 0===g.V?Object:g.V,void 0===_.L?Object:_.L,void 0===E.t?Object:E.t])],P)},48058:(e,t,s)=>{s.d(t,{F:()=>l});var n=s(92336),r=s(91743),i=s(86006),a=s(75421),o=s(5206),c=s(87027),d=s(44462);class l{static configure(e){return{module:l,configurations:{settings:(0,r.z)(e)}}}}l=(0,n.gn)([(0,i.Y)({sharedModuleName:"software-exception-sink",imports:[a.X,o.i],providers:[c.u],exports:[c.u],configurations:{settings:{token:d.L}},domainName:"framework"})],l)},14809:(e,t,s)=>{s.d(t,{Y:()=>E});var n=s(92336),r=s(86006),i=s(97111),a=s(48484),o=s(62149),c=s(63144),d=s(56618),l=s(60018),u=s(3873);const p=e=>!!e&&(0,u.K)(e)&&"theme"in e&&(0,a.u)(e.theme);class m extends((0,c.Q)({storage:{schemaVersion:1,initialValue:{theme:"light"},typeGuard:p},persist:!0,isCache:!0,scope:o.F.Device,storeName:"ui-settings",capacity:d.Y._001KB,codec:l.E})){}var h=s(82874),g=s(78346),v=s(82226);class y{async execute({body:e}){return await this.store.set({theme:e}),(0,g.Vp)(void 0)}constructor(e){this.store=e}}y=(0,n.gn)([(0,h.W)(v.B),(0,n.w6)("design:type",Function),(0,n.w6)("design:paramtypes",[void 0===m?Object:m])],y);var f=s(87065),b=s(46449),S=s(20690);class w{execute(){return this.store.state$.pipe((0,f.U)((e=>(0,g.Vp)(e.theme))))}constructor(e){this.store=e}}w=(0,n.gn)([(0,b.e)(S.n),(0,n.w6)("design:type",Function),(0,n.w6)("design:paramtypes",[void 0===m?Object:m])],w);class E{}E=(0,n.gn)([(0,r.Y)({api:i.Z,handlers:{commands:{setTheme:y},events:{},queries:{getTheme:w}},stores:[m],requiredFeatureFlips:Object.values(a.H)})],E)},35536:(e,t,s)=>{s.d(t,{t:()=>d});var n=s(60018),r=s(62149),i=s(63144),a=s(56618);const o={drift:null},c=e=>!(!e||"object"!=typeof e||!("drift"in e))&&(null===e.drift||"number"==typeof e.drift);class d extends((0,i.Q)({storeTypeGuard:c,storeName:"clocksync",storage:{initialValue:o,schemaVersion:1,typeGuard:c},scope:r.F.Device,isCache:!0,persist:!0,capacity:a.Y._001KB,codec:n.E})){}},29458:(e,t,s)=>{s.d(t,{E:()=>X,F:()=>Z});var n=s(92336),r=s(60399),i=s(89618),a=s(92587),o=s(26549),c=s(50423),d=s(86800);class l{async getServerToClientClockDrift(){const{drift:e}=await this.store.getState();return e}storeServerToClientClockDrift(e){return this.store.update((()=>({drift:e})))}constructor(e){this.store=e}}var u=s(21832),p=s(35536),m=s(11445),h=s(85682),g=s(59184),v=s(35995),y=s(89502),f=s(61331),b=s(11011),S=s(531),w=s(41884),E=s(84927),_=s(74609),C=s(50500),I=s(57552),T=s(71533),A=s(73098),U=s(51817),N=s(209),O=s(30515),D=s(44989),F=s(29357),P=s(39376),R=s(66885),x=s(68791),L=s(41063),k=s(55100),j=s(78267),M=s(39024),z=s(10282);const V={v1:{account:m.m,accountrecovery:h.u,authentication:g.V,communication:v.g,darkwebmonitoring:y.D,devices:f.u,features:b.A,feedback:S.x,file:w.$,icons:E.P,integration:_.Y,invitation:C.R,massdeployment:I.W,monitoring:T.C,partners:A.w,payments:U.H,premium:N.j,pwleak:O.J,sharingUserdevice:D.b,secretTransfer:F.V,securefile:P.V,sync:R.f,teams:x.p,time:L.q,user:k.n,useractivity:j.V,userconsents:M.G,vpn:z.V}};var B=s(81929),K=s(55667);const G="CF-Access-Client-Id",$="CF-Access-Client-Secret";class q{intercept(e,t){if(e.url.startsWith("https://api.dashlane.com/")||!this.cloudflareKeys)return t(e);if(!e.headers.has(G)&&!e.headers.has($)){const{cloudflareAccessKey:s,cloudflareSecretKey:n}=this.cloudflareKeys;return t(e.clone({headers:e.headers.set(G,s).set($,n)}))}return t(e)}constructor(e){this.cloudflareKeys=e,this.id="ServerApiForStagingInterceptor"}}var H=s(17032),W=s(69259),Q=s(31777),Y=s(60590);class X{async init(){const{clockDriftStore:e,serverApiSettings:t,secureHasher:s,httpClient:n,hmacSigner:r}=this,i=new l(e),a=await this.platformInfoService.getPlatformInfo(),{appKeys:o}=t,{baseUrl:c,cloudflareKeys:u}=await this.initOverridableConfig(t,a.buildType);this.baseUrl=c,n.addInterceptor(new q(u));const p=(0,d.d)({secureHasher:s,httpClient:n,timeSyncStore:i,hmacSigner:r,apis:V,config:{appKeys:o,baseUrl:this.baseUrl,platformInfo:{platformName:a.platformName,version:a.appVersion||"unknown",osversion:a.osVersion||"unknown",language:a.lang||"unknown"}}});await this.initClockDrift(p),this.rawSdk=p}get sdk(){if(!this.rawSdk)throw new Error("ConfiguredServerSdk not initialized");return this.rawSdk}get url(){if(!this.baseUrl)throw new Error("ConfiguredServerSdk base url not found");return this.baseUrl}async initOverridableConfig(e,t){if([W.P.DEV,W.P.NIGHTLY].includes(t))try{const e=(await this.settingsForStagingStore.getState()).api;if(e.override)return{baseUrl:e.baseUrlOverride,cloudflareKeys:{cloudflareAccessKey:e.cloudflareAccessKeyOverride,cloudflareSecretKey:e.cloudflareSecretKeyOverride}}}catch(e){this.logger.error("Failed to read settings for staging from store",{error:e})}return{baseUrl:e.baseUrl,cloudflareKeys:e.cloudflareKeys}}async initClockDrift(e){await this.allowedToFail.doOne((async()=>{const{drift:t}=await this.clockDriftStore.getState();null===t&&await(0,r.z)(e.refreshClockDrift().pipe((0,i.V)({first:5e3})))}))}constructor(e,t,s,n,r,i,a,o,c){this.serverApiSettings=e,this.httpClient=t,this.clockDriftStore=s,this.hmacSigner=n,this.secureHasher=r,this.platformInfoService=i,this.allowedToFail=a,this.settingsForStagingStore=o,this.logger=c}}function Z(){return{token:X,asyncFactory:async(e,t,s,n,r,i,a,o,c)=>{const d=new X(e,t,s,n,r,i,a,o,c);return await d.init(),d},inject:[u.oN,o.e,p.t,B.q,K.Z,Y.t,c.J,H.L]}}X=(0,n.gn)([(0,a.GS)(),(0,n.w6)("design:type",Function),(0,n.w6)("design:paramtypes",[void 0===u.oN?Object:u.oN,void 0===o.e?Object:o.e,void 0===p.t?Object:p.t,void 0===B.q?Object:B.q,void 0===K.Z?Object:K.Z,void 0===Y.t?Object:Y.t,void 0===c.J?Object:c.J,void 0===H.L?Object:H.L,void 0===Q.k?Object:Q.k])],X)},66610:(e,t,s)=>{s.d(t,{B:()=>a});var n=s(92336),r=s(92587),i=s(29458);class a{get v1(){return this.configuredServerSdk.sdk.v1}constructor(e){this.configuredServerSdk=e}}a=(0,n.gn)([(0,r.GS)(),(0,n.w6)("design:type",Function),(0,n.w6)("design:paramtypes",[void 0===i.E?Object:i.E])],a)},61798:(e,t,s)=>{s.d(t,{J:()=>i,X:()=>r});var n=s(17591);const r=e=>({FetchFailedError:e,InternalServerError:e,InvalidRequest:e,RateLimited:e,ServiceUnavailable:e,UnspecifiedBadStatus:e}),i=r((()=>(0,n.j)("Error calling server API")))},53344:(e,t,s)=>{s.d(t,{l:()=>l});var n=s(92336),r=s(34987),i=s(92587),a=s(45340),o=s(80315),c=s(29458),d=s(35159);class l{get baseUrl(){return this._baseUrl}get v1(){return this.appliedV1Services}buildInjectedServices(e,t){return Object.keys(t[e]).reduce(((s,n)=>({...s,[n]:this.buildInjectedApiServices(e,t,n)})),{})}buildInjectedApiServices(e,t,s){return Object.getOwnPropertyNames(Object.getPrototypeOf(t.v1[s])).filter((e=>"constructor"!==e)).reduce(((n,r)=>({...n,[r]:this.buildInjectedRouteService(t,e,s,r)})),{})}buildInjectedRouteService(e,t,s,n){const i=o.t[s][n];if(!i)throw new Error("Unable to find endpoint descriptor");const{authType:c}=i;return(...i)=>{const o=e[t][s],d=o[n].bind(o);if(c===a.d.USER_DEVICE)return this.credentialsService.getActiveUserDeviceCredentials().pipe((0,r.b)((e=>d(e,...i))));if(c===a.d.MASS_DEPLOYED_TEAM_KEY)return this.credentialsService.getMassDeploymentTeamKeyCredentials().pipe((0,r.b)((e=>d(e,...i))));if([a.d.NONE,a.d.APP].includes(c))return d(...i);throw new Error("Not supported")}}constructor(e,t){this.appliedV1Services=this.buildInjectedServices("v1",e.sdk),this.credentialsService=t,this._baseUrl=e.url}}l=(0,n.gn)([(0,i.GS)(),(0,n.w6)("design:type",Function),(0,n.w6)("design:paramtypes",[void 0===c.E?Object:c.E,void 0===d.n?Object:d.n])],l)},35159:(e,t,s)=>{s.d(t,{n:()=>h});var n=s(92336),r=s(162),i=s(87065),a=s(34987),o=s(78346),c=s(92587),d=s(53932),l=s(60785),u=s(66335),p=s(21832),m=s(31777);class h{getMassDeploymentTeamKeyCredentials(){return(0,r.D)(this.managedStorageInfrastructure.get("MassDeployedTeamKey")).pipe((0,i.U)((e=>{if(!e)throw new Error("Couldn't find MassDeployedTeamKey in browser managed storage");const[t,s]=e.split("-");return{massDeployedTeamAccessKey:t,massDeployedTeamSecretKey:s}})))}getActiveUserDeviceCredentials(){const{queries:{activeUser:e}}=this.cqrsClient.getClient(u.t$);return e().pipe((0,i.U)((e=>{if((0,o.d6)(e))return(0,o.db)(e);throw new Error("Failed to get active user")})),(0,a.b)((({userName:e})=>{if(!e)throw new Error("No active user available");return this.serverApiCredentialsInfra.getDeviceCredentialsForUser(e)})))}constructor(e,t,s,n){this.cqrsClient=e,this.serverApiCredentialsInfra=t,this.managedStorageInfrastructure=s,this.logger=n}}h=(0,n.gn)([(0,c.GS)(),(0,n.w6)("design:type",Function),(0,n.w6)("design:paramtypes",[void 0===d.w?Object:d.w,void 0===p.se?Object:p.se,void 0===l.Rx?Object:l.Rx,void 0===m.k?Object:m.k])],h)},21832:(e,t,s)=>{s.d(t,{oN:()=>n,se:()=>r});class n{constructor(e){this.baseUrl=e.baseUrl,this.appKeys=e.appKeys,this.cloudflareKeys=e.cloudflareKeys}}class r{}new class extends r{getDeviceCredentialsForUser(e){return Promise.resolve({deviceAccessKey:"",deviceSecretKey:"",login:e})}}},41511:(e,t,s)=>{s.d(t,{n:()=>I});var n=s(92336),r=s(91743),i=s(86006),a=s(85045),o=s(75421),c=s(32446),d=s(53344),l=s(66610),u=s(21832),p=s(35536),m=s(35159),h=s(29458),g=s(40416),v=s(17032),y=s(31777),f=s(78346),b=s(82874);class S{async execute(e){const t=await this.store.getState();return await this.store.set({...t,...e.body}),(0,f.Vp)(void 0)}constructor(e){this.store=e}}S=(0,n.gn)([(0,b.W)(c.bH),(0,n.w6)("design:type",Function),(0,n.w6)("design:paramtypes",[void 0===v.L?Object:v.L])],S);var w=s(87065),E=s(46449);class _{execute(){return this.store.state$.pipe((0,w.U)(f.Vp))}constructor(e){this.store=e}}_=(0,n.gn)([(0,E.e)(c.Lt),(0,n.w6)("design:type",Function),(0,n.w6)("design:paramtypes",[void 0===v.L?Object:v.L])],_);var C=s(5206);class I{static configure(e,t){return{module:I,configurations:{serverApi:(0,r.z)(e),serverApiInfrastructure:t}}}}I=(0,n.gn)([(0,i.Y)({api:c.Dm,handlers:{commands:{editSettingsForStaging:S},queries:{settingsForStaging:_},events:{}},providers:[l.B,d.l,m.n,(0,h.F)(),(0,a.ND)(y.k)],exports:[l.B,d.l,m.n],configurations:{serverApi:{token:u.oN},serverApiInfrastructure:{token:u.se}},stores:[p.t,v.L],imports:[g.D,o.X,C.i],domainName:"framework"})],I)},31777:(e,t,s)=>{s.d(t,{k:()=>r});var n=s(85045);class r extends((0,n.AJ)()){}},17032:(e,t,s)=>{s.d(t,{L:()=>c});var n=s(60018),r=s(62149),i=s(63144),a=s(56618);const o={api:{override:!1},nitro:{override:!1}};class c extends((0,i.Q)({storeTypeGuard:e=>!0,storeName:"webServicesSettingsForStaging",storage:{initialValue:o,schemaVersion:1,typeGuard:e=>!0},scope:r.F.Device,persist:!0,isCache:!1,capacity:a.Y._001KB,codec:n.E})){}},19911:(e,t,s)=>{s.d(t,{s:()=>i});var n=s(99428);function r(e){const t=e.length,s=[];for(let r=0;r<t;r+=3)s.push(n.T[e[r]>>2]),s.push(n.T[(3&e[r])<<4|e[r+1]>>4]),s.push(n.T[(15&e[r+1])<<2|e[r+2]>>6]),s.push(n.T[63&e[r+2]]);return s.join("")}function i(e,t=n.V){const s=new Uint8Array(e),i=s.length,a=t%3,o=0===a?t:t+(3-a),c=Math.ceil(i/o);let d="",l=-1;for(;l++<c;){const e=l*o,t=l===c-1?i:(l+1)*o,n=r(s.slice(e,t));d=d.concat(n)}return i%3==2?d.substring(0,d.length-1)+"=":i%3==1?d.substring(0,d.length-2)+"==":d}},88558:(e,t,s)=>{s.d(t,{K:()=>r});var n=s(19911);function r(e){const t=new Uint8Array(e);return(0,n.s)(t).replace(/\+/g,"-").replace(/\//g,"_").replace(/=/g,"")}},44647:(e,t,s)=>{s.d(t,{v:()=>r});const n=Math.pow(2,14)-1;function r(e){const t=new Uint8Array(e),s=t.length;let r="",i=n;for(let e=0;e<s;e+=i){e+i>s&&(i=s-e);const n=t.subarray(e,e+i);r+=String.fromCharCode(...n)}return r}},31162:(e,t,s)=>{s.d(t,{L:()=>r});var n=s(46803);function r(e){const t=new Uint8Array(e),s=[];for(let e=0;e<t.byteLength;e++)s[e>>>2]|=t[e]<<24-e%4*8;return n.lib.WordArray.create(s,t.byteLength)}},57003:(e,t,s)=>{s.d(t,{K:()=>i});const n="ABCDEFGHIJKLMNOPQRSTUVWXYZ234567".split("").reduce(((e,t,s)=>({...e,[t]:s})),{});function r(e){const t=n[e];if(void 0===t)throw new Error(`Invalid character found: ${e}`);return t}function i(e){const t=e.replaceAll("=","").trim().length;let s=0,n=0,i=0;const a=new Uint8Array(5*t/8|0);for(let o=0;o<t;o++)n=n<<5|r(e[o]),s+=5,s>=8&&(a[i++]=n>>>s-8&255,s-=8);return a.buffer}},63352:(e,t,s)=>{s.d(t,{R:()=>i});var n=s(99428);const r=new Uint8Array(256);for(let e=0;e<n.T.length;e++)r[n.T.charCodeAt(e)]=e;function i(e){let t=.75*e.length;const s=e.length;let n,i,a,o,c,d=0;e.endsWith("=")&&(t--,"="===e[e.length-2]&&t--);const l=new ArrayBuffer(t),u=new Uint8Array(l);for(n=0;n<s;n+=4)i=r[e.charCodeAt(n)],a=r[e.charCodeAt(n+1)],o=r[e.charCodeAt(n+2)],c=r[e.charCodeAt(n+3)],u[d++]=i<<2|a>>4,u[d++]=(15&a)<<4|o>>2,u[d++]=(3&o)<<6|63&c;return l}},15340:(e,t,s)=>{s.d(t,{N:()=>r});var n=s(63352);function r(e){const t=e.replace(/-/g,"+").replace(/_/g,"/"),s=(4-t.length%4)%4,r=t.padEnd(t.length+s,"=");return(0,n.R)(r)}},17991:(e,t,s)=>{function n(e){return Array.prototype.map.call(new Uint8Array(e),(e=>("00"+e.toString(16)).slice(-2))).join("")}s.d(t,{k:()=>n})},60605:(e,t,s)=>{s.d(t,{n:()=>i});var n=s(93347),r=s(11458);function i(e){const t=new Uint8Array([0,0,0,0]).buffer,s=new Uint8Array(e),i=n.deflate(s,{level:7}).buffer;return(0,r.K)(t,i)}},11458:(e,t,s)=>{function n(...e){const t=e.reduce(((e,t)=>e+t.byteLength),0),s=new Uint8Array(t);return e.reduce(((e,t)=>(s.set(new Uint8Array(t),e),e+t.byteLength)),0),s.buffer}s.d(t,{K:()=>n})},99428:(e,t,s)=>{s.d(t,{T:()=>r,V:()=>n});const n=Math.pow(10,6),r="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/"},15798:(e,t,s)=>{function n(e){return e.replace(/(?:\\[r]|[\r\n]+)+/g,"\n")}s.d(t,{Y:()=>n})},70273:(e,t,s)=>{s.d(t,{L:()=>i});var n=s(93347);const r=4;function i(e){const t=function(e){return new Uint8Array(e.slice(r))}(e);return n.inflate(t).buffer}},82565:(e,t,s)=>{function n(e){const t=new ArrayBuffer(8);return new DataView(t).setBigUint64(0,BigInt(e)),t}s.d(t,{n:()=>n})},33250:(e,t,s)=>{s.d(t,{B:()=>i});var n=s(3417),r=s(59503);function i(e){const{asn1:t,pki:s}=n,i=s.privateKeyFromPem(e),a=s.privateKeyToAsn1(i),o=s.wrapRsaPrivateKey(a),c=t.toDer(o).getBytes();return(0,r.u)(c)}},24595:(e,t,s)=>{s.d(t,{M:()=>i});var n=s(3417),r=s(59503);function i(e){const{asn1:t,pki:s}=n,i=s.publicKeyFromPem(e),a=s.publicKeyToAsn1(i),o=t.toDer(a).getBytes();return(0,r.u)(o)}},75711:(e,t,s)=>{s.d(t,{R:()=>i});var n=s(3417),r=s(15798);function i(e){const{asn1:t,pki:s,util:i}=n,a=i.createBuffer(e),o=t.fromDer(a),c=s.privateKeyFromAsn1(o),d=s.privateKeyToPem(c);return(0,r.Y)(d)}},98894:(e,t,s)=>{s.d(t,{y:()=>i});var n=s(3417),r=s(15798);function i(e){const{asn1:t,pki:s,util:i}=n,a=i.createBuffer(e),o=t.fromDer(a),c=s.publicKeyFromAsn1(o),d=s.publicKeyToRSAPublicKeyPem(c);return(0,r.Y)(d)}},59503:(e,t,s)=>{function n(e){const t=new ArrayBuffer(e.length),s=new Uint8Array(t);for(let t=0;t<e.length;++t)s[t]=e.charCodeAt(t);return t}s.d(t,{u:()=>n})},46470:(e,t,s)=>{s.d(t,{e:()=>a});var n=s(30543),r=s(99428);function i(e){return e>>6==2}function a(e,t=r.V){const s=e.length;if(0===s)return"";let a="",o=0,c=Math.min(o+t,s);for(;c<=s;){const r=e.charCodeAt(c-1);if((i(d=r)||function(e){return e>>5==6||e>>4==14||e>>3==30}(d))&&c<s){if(i(e.charCodeAt(c))){c++;continue}}const l=e.slice(o,c),u=n.decode(l);if(a=a.concat(u),c===s)break;o=c,c=Math.min(o+t,s)}var d;return a}},79533:(e,t,s)=>{s.d(t,{N:()=>i});var n=s(30543),r=s(99428);function i(e,t=r.V){const s=e.length;if(0===s)return"";let i="",a=0,o=Math.min(a+t,s);for(;o<=s;){const r=e.charCodeAt(o-1);if(r>=55296&&r<=56319){if(o++,o>s)throw new Error("Invalid string provided to utf8ChunkEncode");continue}const c=e.slice(a,o),d=(0,n.encode)(c);if(i=i.concat(d),o===s)break;a=o,o=Math.min(a+t,s)}return i}},61897:(e,t,s)=>{function n(e){const{sigBytes:t,words:s}=e,n=new Uint8Array(t);let r=0,i=0;for(;r!==t;){const e=s[i++];if(n[r++]=(4278190080&e)>>>24,r===t)break;if(n[r++]=(16711680&e)>>>16,r===t)break;if(n[r++]=(65280&e)>>>8,r===t)break;n[r++]=255&e}return n.buffer}s.d(t,{o:()=>n})},39071:(e,t,s)=>{s.d(t,{W:()=>i});var n=s(23337),r=s(96754);class i extends n.X{async fetch(e){const t=(0,r.A)(e);return(await fetch(t)).json()}}},24860:(e,t,s)=>{s.d(t,{x:()=>a});var n=s(46803),r=s(31162),i=s(61897);function a(e,t){if(self.crypto.subtle)return self.crypto.subtle.digest({name:t},e);if("SHA-1"===t){const t=(0,r.L)(e),s=(0,i.o)((0,n.SHA1)(t));return Promise.resolve(s)}return Promise.reject(new Error("Unsupported hash method"))}},34476:(e,t,s)=>{s.d(t,{$:()=>i});var n=s(36826),r=s(8321);async function i(e,t,s){const i=await(0,r.Y)(e);return self.crypto.subtle.decrypt({name:n.z,iv:t},i,s)}},31519:(e,t,s)=>{s.d(t,{G:()=>r});var n=s(49869);async function r(e,t,s){const r={name:n.$k,hash:{name:s}},i=await self.crypto.subtle.importKey("pkcs8",e,r,!1,["decrypt"]);return self.crypto.subtle.decrypt(r,i,t)}},49371:(e,t,s)=>{s.d(t,{f:()=>r});var n=s(35558);async function r(e,t,s){const{tCost:r,mCost:i,parallelism:a}=s,{hash:o}=await n.hash({pass:new Uint8Array(e),salt:new Uint8Array(t),time:r,mem:i,hashLen:32,parallelism:a,type:n.ArgonType.Argon2d});return o.buffer}},6344:(e,t,s)=>{s.d(t,{x:()=>r});var n=s(36826);async function r(e,t,s){const r=await self.crypto.subtle.importKey("raw",e,"PBKDF2",!1,["deriveKey"]),i={name:n.z,length:256},{iterations:a,hashType:o}=s,c={name:"PBKDF2",salt:t,iterations:a,hash:{name:o}},d=await self.crypto.subtle.deriveKey(c,r,i,!0,["encrypt","decrypt"]);return self.crypto.subtle.exportKey("raw",d)}},84810:(e,t,s)=>{s.d(t,{P:()=>i});var n=s(36826),r=s(8321);async function i(e,t,s){const i=await(0,r.Y)(e);return self.crypto.subtle.encrypt({name:n.z,iv:t},i,s)}},91582:(e,t,s)=>{s.d(t,{b:()=>r});var n=s(49869);async function r(e,t,s){const r={name:n.$k,hash:{name:s}},i=await self.crypto.subtle.importKey("spki",e,r,!1,["encrypt"]);return self.crypto.subtle.encrypt(r,i,t)}},76476:(e,t,s)=>{s.d(t,{o:()=>r});var n=s(36826);async function r(){const e=await self.crypto.subtle.generateKey({name:n.z,length:n.N},!0,["encrypt","decrypt"]);return self.crypto.subtle.exportKey("raw",e)}},41480:(e,t,s)=>{s.d(t,{Y:()=>i});var n=s(49869);const r=new Uint8Array([1,0,1]);async function i(e){const t=await self.crypto.subtle.generateKey({name:n.$k,modulusLength:2048,publicExponent:r,hash:{name:e}},!0,["encrypt","decrypt"]),{privateKey:s,publicKey:i}=t;return{privateKey:await self.crypto.subtle.exportKey("pkcs8",s),publicKey:await self.crypto.subtle.exportKey("spki",i)}}},53765:(e,t,s)=>{function n(e){const t=new Uint8Array(e);return self.crypto.getRandomValues(t)}s.d(t,{P:()=>n})},8321:(e,t,s)=>{s.d(t,{Y:()=>r});var n=s(36826);function r(e){return self.crypto.subtle.importKey("raw",e,n.z,!1,["encrypt","decrypt"])}},24352:(e,t,s)=>{function n(e,t){return self.crypto.subtle.importKey("raw",e,{name:"HMAC",hash:{name:t}},!0,["sign","verify"])}s.d(t,{r:()=>n})},97067:(e,t,s)=>{s.d(t,{n:()=>i});var n=s(56782),r=s(24352);async function i(e,t,s=n.x){const i=await(0,r.r)(e,s);return self.crypto.subtle.sign({name:"HMAC",hash:{name:s}},i,t)}},73129:(e,t,s)=>{s.d(t,{f:()=>r});var n=s(49869);async function r(e,t,s){const r={name:n.xJ,hash:{name:s}},i=await self.crypto.subtle.importKey("pkcs8",e,r,!1,["sign"]);return self.crypto.subtle.sign(r,i,t)}},83151:(e,t,s)=>{s.d(t,{H:()=>a});var n=s(46803),r=s(31162),i=s(61897);function a(e){const t=(0,r.L)(e);return(0,i.o)((0,n.MD5)(t))}},59683:(e,t,s)=>{s.d(t,{o:()=>i});var n=s(56782),r=s(24352);async function i(e,t,s,i=n.x){const a=await(0,r.r)(e,i);return self.crypto.subtle.verify({name:"HMAC",hash:{name:i}},a,t,s)}},477:(e,t,s)=>{s.d(t,{e:()=>r});var n=s(49869);async function r(e,t,s,r){const i={name:n.xJ,hash:{name:r}},a=await self.crypto.subtle.importKey("spki",e,i,!1,["verify"]);return self.crypto.subtle.verify(i,a,t,s)}},88586:(e,t,s)=>{s.d(t,{Y:()=>r});var n=s(33156);function r(){return"undefined"!=typeof chrome&&void 0!==chrome.runtime&&void 0!==chrome.runtime.getManifest&&3===(0,n.W)().manifest_version}},43331:(e,t,s)=>{s.d(t,{m:()=>c});var n=s(72693),r=s(96754);const i="file-download";class a extends n.o{async send(e,t,s){try{if(!("serviceWorker"in self&&self instanceof ServiceWorkerGlobalScope))throw new Error("File Download Emitter Channel - Wrong environment. Not in a service worker.");const n=(0,r.A)("").replace(/\/$/,""),a=(await self.clients.matchAll()).find((e=>e.url.includes(n)));a?.postMessage({fileName:e,mimeType:t,fileContent:s,type:i},[s])}catch(e){console.error(e)}}}class o extends n.o{async send(e,t,s){try{if(!chrome?.extension?.getBackgroundPage())throw new Error("Wrong environment. Missing background page.");const n=(0,r.A)("").replace(/\/$/,"");window.postMessage({fileName:e,mimeType:t,fileContent:s,type:i},n,[s])}catch(e){console.error(e)}}}class c{makeFileDownloadEmitterChannel(){if("serviceWorker"in self&&self instanceof ServiceWorkerGlobalScope)return new a;if(chrome?.extension?.getBackgroundPage())return new o;throw new Error("unsupported environment. This module should only be used in a service worker or a background page.")}}},7984:(e,t,s)=>{s.d(t,{b:()=>a});var n=s(87201),r=s(96754),i=s(28286);class a extends n.P{listen(){const e=(0,r.A)("").replace(/\/$/,"");new Promise((e=>{setTimeout((()=>{e(void 0)}),5e3),chrome.runtime.getBackgroundPage((t=>e(t)))})).then((t=>{if(!t)throw new Error("File Upload Listener Channel - Wrong environment.  Missing background page.");t.addEventListener("message",(t=>{if(t.data?.type&&t.data.type===i.M){if(t.origin.toLowerCase()!==e.toLowerCase())return void console.error(`Received message from unauthorized origin: ${t.origin}`);this.eventEmitter.sendEvent("fileUploaded",t.data)}}))}))}}},73139:(e,t,s)=>{s.d(t,{w:()=>a});var n=s(87201),r=s(96754),i=s(28286);class a extends n.P{static initializeListener(){return self.addEventListener("message",(e=>a.listenerEventHandler(e))),a}listen(){if(!("serviceWorker"in self&&self instanceof ServiceWorkerGlobalScope))throw new Error("File Upload Listener Channel - Wrong environment. Not in a service worker.");const e=(0,r.A)("").replace(/\/$/,"");a.listenerEventHandler=t=>{if(t.data?.type&&t.data.type===i.M){if(t.origin.toLowerCase()!==e.toLowerCase())return void console.error(`Received message from unauthorized origin: ${t.origin}`);this.eventEmitter.sendEvent("fileUploaded",t.data)}}}}a.listenerEventHandler=e=>{}},47715:(e,t,s)=>{s.d(t,{A:()=>h});var n=s(87065),r=s(93192),i=s(90171),a=s(47968),o=s(37182),c=s(69885),d=s(51992),l=s(13528),u=s(14940),p=s(19313),m=s(78346);class h{handle(e){const t=this.getTimeout$(e.timeout),s=this.doFetch(e).pipe((0,n.U)(this.toHttpResponse),(0,n.U)(this.toHttpResult));return(0,r.S)(t,s)}getTimeout$(e){return e?(0,i.H)(e).pipe((0,n.U)((()=>(0,m.Rn)(new l.a)))):a.C}doFetch(e){return(0,d.U)(e.url,{method:e.method,body:e.serializeBody(),headers:this.getHeaders(e),credentials:e.withCredentials?"include":"omit",mode:e.mode}).pipe((0,o.K)((e=>{if(!(e instanceof TypeError))throw e;return(0,c.of)(new l.a)})))}mapToHttpHeaders(e){const t=new u.W;return e.forEach(((e,s)=>t.set(s,e))),t}getHeaders(e){return e.headers.keys().reduce(((t,s)=>({...t,[s]:e.headers.get(s)})),{})}constructor(){this.toHttpResult=e=>e instanceof l.a?(0,m.Rn)(e):e.ok?(0,m.Vp)(e):(0,m.Rn)(new l.R(e)),this.toHttpResponse=e=>e instanceof l.a?e:new p.Z({body:e.body,url:e.url,status:e.status,statusText:e.statusText,headers:this.mapToHttpHeaders(e.headers)})}}},43022:(e,t,s)=>{s.d(t,{D:()=>c});var n=s(92336),r=s(6721),i=s(22366),a=s(92587),o=s(59788);class c extends i.g{extendServiceWorkerLifetime(){this.logger.info("Heartbeat to extend SW lifetime"),(0,r.t)({"last-heartbeat":(new Date).getTime()})}constructor(e){super(),this.logger=e}}c=(0,n.gn)([(0,a.GS)(),(0,n.w6)("design:type",Function),(0,n.w6)("design:paramtypes",[void 0===o.V?Object:o.V])],c)},98803:(e,t,s)=>{s.d(t,{Y:()=>m});var n=s(10592),r=s(33091);const i=/^_execute(_browser){0,1}_action$/,a="+";var o=function(e){return e.Command="Command",e.Ctrl="Ctrl",e.MacCtrl="MacCtrl",e.Shift="Shift",e}(o||{});function c(e){return i.test(e.name??"")}function d(e){const t=e.toUpperCase();switch(t){case"":case"CTRL":return n.isMacOS()?"Command":"Ctrl";case"SHIFT":case"":return"Shift";case"COMMAND":case"":return"Command";case"MACCTRL":return"MacCtrl";default:return t}}function l(e){const t=Object.values(o),s=t.indexOf(e);return-1===s?t.length:s}function u(e,t){return l(e)-l(t)}function p(e){switch(e){case"Ctrl":case"MacCtrl":return"Ctrl";case"Shift":return"";case"Command":return"";default:return e}}async function m(){const e=await(0,r.g)(),t=e.find(c)?.shortcut;if(!t)return;const s=function(e){return e.split(e.includes(a)?a:"")}(t);return s.map(d).sort(u).map(p)}},99132:(e,t,s)=>{s.d(t,{D:()=>o});var n=s(71474),r=s(51186),i=s(856);const a=" ";async function o(){const e=["autofillAddressEnabled","autofillCreditCardEnabled","passwordSavingEnabled"].map((e=>async function(e,t){try{const{levelOfControl:t}=await(0,n.U)(e);if("controllable_by_this_extension"!==t&&"controlled_by_this_extension"!==t){const s=[`Impossible to change browser setting: ${e}.`,`Extension prevented from changing: ${t}`].join(a);throw new Error(s)}}catch(t){if((0,r.b)(t))throw new Error(`Browser setting not supported: ${e}`);if((0,r.I)(t))throw t.runtimeError;throw t}try{await(0,i.t)(e,t)}catch(e){throw(0,r.I)(e)?e.runtimeError:e}}(e,!1)));await Promise.allSettled(e)}},97607:(e,t,s)=>{s.d(t,{G3:()=>o});const n=new Set(["en","fr","es","ja","de","pt","it","ko","zh","nl","sv"]),r="en";function i(e){return e.substr(0,2)}function a(e){const t=i(e);return n.has(t)}function o(){const e=[navigator.language].concat(navigator.languages).find(a);if(!e)return r;if(!e.includes("-"))return e;return i(e)}},62822:(e,t,s)=>{s.d(t,{F:()=>o});var n=s(33156),r=s(38649);const i={beta:"icon_beta_auth",mv2:"icon_auth",nightly:"icon_nightly_auth"},a="icon_not_auth";async function o({isUserAuthenticated:e}){const t=`icons/action/${e?function(){const e=(0,n.W)();return e.name.includes("Nightly")?i.nightly:e.name.includes("Beta")?i.beta:i.mv2}():a}`,s={16:`${t}.png`,32:`${t}@2x.png`};await(0,r.B)(s)}},50839:(e,t,s)=>{s.d(t,{$:()=>a});var n=s(37724),r=s(33017);function i(e){return`${"http"+(e.secure?"s":"")}://${e.domain.startsWith(".")?e.domain.substring(1):e.domain}${e.path}`}async function a(e){const t=await(0,n.g)({domain:e});return Promise.all(t.map((e=>(0,r.O)({url:i(e),name:e.name}))))}},76847:(e,t,s)=>{s.d(t,{j:()=>i});var n=s(21352),r=s(6523);async function i(e){if((0,n.G)()){return await(0,n.y)(e)>0}const t=await(0,r.U)(e),s=void 0===t[e],i=null===t[e];return!s&&!i}},41707:(e,t,s)=>{s.d(t,{b:()=>m});var n=s(96754),r=s(87163),i=s(96344),a=s(40841),o=s(21597),c=s(71751);async function d(){const e=await(0,c.I)({}),t=(0,n.A)("");return e.filter((e=>"string"==typeof e.url&&e.url.startsWith(t))).filter((e=>""!==e.url&&e.url!==(0,n.A)("/popup/index.html")))}const l="index.html";function u(){return`${(0,n.A)("")}${l}`}function p({identifier:e,queryInfo:t,name:s}){const n=u();if(!s)return n;const r=e?`#${s}/${e}`:`#${s}`,i=t?`?${function(e){return Object.keys(e).map((t=>`${t}=${e[t]}`)).join("&")}(t)}`:"";return encodeURI(`${n}${r}${i}`)}async function m({id:e,query:t,route:s}){const n=p({identifier:e,queryInfo:t,name:s}),c=await d();c.length?await async function({path:e,tabs:t}){const s=await(0,i.T)(),n=function({existingTabs:e,focusedWindow:t}){const s=e.filter((e=>e.active)),n=s.find((e=>e.windowId===t.id)),r=s.pop(),i=e.pop();return n??r??i}({existingTabs:t,focusedWindow:s});if(!n)return;if(n.windowId!==s.id&&(0,a.V)(n.windowId,{focused:!0}),!n.id)return;const r={active:!0,...e===u()?{}:{url:e}};await(0,o.V)(n.id,r)}({path:n,tabs:c}):await async function(e){const t={url:e};await(0,r.U)(t)}(n)}},17295:(e,t,s)=>{s.d(t,{w:()=>b});var n=s(58376),r=s(7074),i=s(24966),a=s(85390),o=s(15023),c=s(87065),d=s(27420),l=s(4710),u=s(22828),p=s(27880),m=s(41718);function h(e){return JSON.parse(JSON.stringify(e))}class g{constructor(){this.events$=new n.y((e=>{const t=t=>{e.next(t)};return d.r.addListener(t),()=>d.r.removeListener(t)})).pipe((0,r.B)())}}class v{async update(e){return this.set(e(await this.getState()))}persist(){return Promise.resolve()}load(){return Promise.resolve()}set(e){return(0,l.t)(h({[this.key]:e}))}init(e){return(0,l.t)(h({[this.key]:e}))}clear(){return(0,u.O)(this.key)}clearStorage(){return Promise.resolve()}stop(){this.stopped$.next(!0)}getLimit(){return Promise.resolve(9e6)}async getState(){const e=(await(0,p.U)(this.key))[this.key];return this.asDataWithTimestamp(e)}asDataWithTimestamp(e){if(!(e&&"object"==typeof e&&"timestamp"in e&&"number"==typeof e.timestamp&&e.timestamp&&"data"in e))return{timestamp:void 0};try{if(!this.typeGuard(e.data))throw new Error("typeGuard check fail")}catch(e){return console.error("Failed to hydrate store due to typeGuard failure"),{timestamp:void 0}}return{timestamp:e.timestamp,data:e.data}}constructor(e,t,s){this.stopped$=new i.X(!1),this.key=t,this.typeGuard=s??(e=>!0);const r=new n.y((s=>{this.getState().then((e=>{s.next(e)}));const n=e.events$.subscribe((e=>{let n;if(t in e){const{newValue:r}=e[t];n=s.next(this.asDataWithTimestamp(r))}return n}));return()=>n.unsubscribe()}));this.state$=(0,a.a)({state:r,isStopped:this.stopped$}).pipe((0,o.o)((({isStopped:e})=>!e),!1),(0,c.U)((({state:e})=>e)))}}class y extends m.G{createUserScopedInfrastructure(e,t,s,n){const r=`graphene.${e}.${t}.${s}`;return new v(this.source,r,n)}createDeviceScopedInfrastructure(e,t,s){const n=`graphene.${e}.${t}`;return new v(this.source,n,s)}constructor(...e){super(...e),this.source=new g}}var f=s(37730);function b(){return(0,f.G)()?new y:new m.N}},73789:(e,t,s)=>{s.d(t,{e:()=>a});var n=s(6523),r=s(6721),i=s(52913);class a{async getAllKeys(){return Object.keys(await(0,n.U)(null))}async get(e){const t=(await(0,n.U)([e]))[e];if(t){if("string"!=typeof t)throw new Error(`[ChromeLocalStorage] - cannot read content of ${e} properly. Type is\n        ${typeof t} but should be 'string'`);return t}}async set(e,t){await(0,r.t)({[e]:t})}async remove(e){await(0,i.O)([e])}}},43491:(e,t,s)=>{s.d(t,{e:()=>r});var n=s(45368);class r{async getAllKeys(){return Object.keys(await(0,n.U)(void 0)??{})}async get(e){try{const t=await(0,n.U)(e);if(!t)return;const s=t[e];if(!s)return;if("string"!=typeof s)throw new Error("Expected ExtensionManagedStorage entry value to be a string",{cause:{key:e,type:typeof s}});return s}catch(e){throw this.logger.error("Failed to get managed storage key"),new Error("Failed ot get managed storage key",{cause:{error:e}})}}constructor(e){this.logger=e}}},35284:(e,t,s)=>{s.d(t,{y:()=>m});var n=s(31857),r=s(58376),i=s(97280),a=s(23423),o=s(29439),c=s(31261),d=s(63090);const l="cron-source";const u=()=>new r.y((e=>{const t=t=>{t.name===l&&e.next()};return c.i.addListener(t),async function(){await(0,a.U)(l)||await(0,o.U)(l,{delayInMinutes:1,periodInMinutes:1})}(),()=>{c.i.removeListener(t)}})),p=()=>(0,d.G)()?u():new r.y((e=>{const t=self.setInterval((()=>{e.next()}),6e4);return()=>{self.clearInterval(t)}}));class m extends n.R_{stop(){this.subscription.unsubscribe()}constructor(...e){super(...e),this.alarm$=p().pipe((0,i.d)(1)),this.subscription=this.alarm$.subscribe()}}},98455:(e,t,s)=>{s.d(t,{P:()=>p});var n=s(78776),r=s(24966),i=s(58376),a=s(87065),o=s(36610),c=s(57042),d=s(66853),l=s(12335),u=s(19523);class p{stop(){this.subscription.unsubscribe()}constructor(e){this.connectedChannels$=new r.X({});const t=new i.y((t=>{const s={},i=i=>{const u=(0,n.Z)();if(i.name!==e)return;console.log("[background/framework] Detected chrome.runtime.port connection by client",e);const p=new o.j({source:{addListener:e=>i.onMessage.addListener(e),removeListener:e=>i.onMessage.removeListener(e)},filter:t=>(0,c.F)(t)&&t.channelName===e}),m=new Promise((t=>{const s=()=>{chrome.runtime.lastError&&console.log("[background/framework] Error when chrome.runtime.port disconnected by client",e,chrome.runtime.lastError),console.log("[background/framework] chrome.runtime.port disconnected by client",e),i.onDisconnect.removeListener(s),t(null)};i.onDisconnect.addListener(s)})),h=new r.X(d.D.Connected);m.then((()=>{p.stop(),h.next(d.D.Disconnected),delete s[u],t.next(s)}));const g={messages$:p.events$.pipe((0,a.U)((([e])=>e.message))),sendMessage:t=>(i.postMessage((0,c.k)({channelName:e,message:t})),Promise.resolve()),stop:()=>(i.disconnect(),Promise.resolve()),status$:h},v=new l.N(g);s[u]=v,t.next(s)};return u.b.addListener(i),()=>{u.b.removeListener(i)}}));this.subscription=t.subscribe((e=>this.connectedChannels$.next(e)))}}},77931:(e,t,s)=>{s.d(t,{z:()=>i});var n=s(63352),r=s(19911);class i{decode(e){return(0,n.R)(e)}encode(e){return(0,r.s)(e)}}},75172:(e,t,s)=>{function n(...e){const t=[...e].reverse();return{decode:async t=>{for(const s of e)t=await s.decode(t);return t},encode:async e=>{for(const s of t)e=await s.encode(e);return e}}}s.d(t,{x:()=>n})},94691:(e,t,s)=>{s.d(t,{b:()=>n});class n{decode(e){return JSON.parse((new TextDecoder).decode(e))}encode(e){return(new TextEncoder).encode(JSON.stringify(e))}}},60018:(e,t,s)=>{s.d(t,{E:()=>i});var n=s(97143);const r=e=>e;class i{constructor(){(0,n._)(this,"encode",r),(0,n._)(this,"decode",r)}}},93704:(e,t,s)=>{s.d(t,{BU:()=>i,No:()=>a,Nw:()=>n,gO:()=>r});const n={algorithm:"aes256",mode:"cbchmac",ivLength:16},r={algorithm:"aes256",mode:"cbchmac64",ivLength:16},i={algorithm:"aes256",mode:"cbchmac",ivLength:16,padding:16,bytesToKey:0,reuseSalt:!1},a={algorithm:"aes256",mode:"cbc",ivLength:16,saltLength:32,padding:0,bytesToKey:{algorithm:"sha1",iterations:3,keyLength:32}}},28868:(e,t,s)=>{s.d(t,{E1:()=>i,Yi:()=>o,b9:()=>c,m9:()=>d,mr:()=>r,oo:()=>a});var n=s(56742);const r={algorithm:"argon2d",saltLength:16,tCost:3,mCost:32768,parallelism:2},i={algorithm:"pbkdf2",saltLength:16,iterations:2e5,hashAlgorithm:"sha256"},a={algorithm:"noderivation"},o={algorithm:"pbkdf2",saltLength:32,iterations:10204,hashAlgorithm:"sha1"};function c(e){return["argon2d","pbkdf2","noderivation"].some((t=>t===e))}function d(e){switch(e.algorithm){case"argon2d":case"pbkdf2":return e.saltLength;case"noderivation":return 0;default:(0,n.U)(e)}}},83806:(e,t,s)=>{s.d(t,{F:()=>n,g:()=>r});const n="$",r=1},62690:(e,t,s)=>{s.d(t,{ARGON2D_MARKER_SCHEMA:()=>n,NODERIVATION_MARKER_SCHEMA:()=>i,PBKDF2_MARKER_SCHEMA:()=>r});const n={count:9,index:{version:0,derivation:1,saltLength:2,tCost:3,mCost:4,parallelism:5,cipher:6,mode:7,ivLength:8}},r={count:8,index:{version:0,derivation:1,saltLength:2,iterations:3,hashAlgorithm:4,cipher:5,mode:6,ivLength:7}},i={count:5,index:{version:0,derivation:1,cipher:2,mode:3,ivLength:4}}},3440:(e,t,s)=>{s.d(t,{PD:()=>n,RB:()=>a,en:()=>r,jK:()=>i});const n="KWC5",r=16,i=32,a=0},97633:(e,t,s)=>{s.d(t,{b:()=>i});var n=s(59503);var r=s(4557);function i(e,t,s,i,a,o){if(0===e.byteLength)throw new Error("Attempting to derivate a key from an empty input");return"pbkdf2"===a.algorithm?(0,r.E)(s,o,a,e,t):async function(e,t,s,r,i){const{tCost:a,mCost:o,parallelism:c}=s,d=(0,n.u)(Object.values(s).join("")),l=t.getCacheKey(r,i,d),u=t.getCachedDerivation(l);if(u)return u;const p={tCost:a,mCost:o,parallelism:c},m=await e(r,i,p);return t.setCachedDerivation({cacheKey:l,data:m}),m}(i,o,a,e,t)}},4557:(e,t,s)=>{s.d(t,{E:()=>i});var n=s(59503),r=s(56742);async function i(e,t,s,i,a){const o=(0,n.u)(Object.values(s).join("")),c=t.getCacheKey(i,a,o),d=t.getCachedDerivation(c);if(d)return d;const l=function(e){switch(e){case"sha1":return"SHA-1";case"sha256":return"SHA-256";case"sha384":return"SHA-384";case"sha512":return"SHA-512";default:(0,r.U)(e)}}(s.hashAlgorithm),u=await e(i,a,{iterations:s.iterations,hashType:l});return t.setCachedDerivation({cacheKey:c,data:u}),u}},53048:(e,t,s)=>{s.d(t,{F:()=>M,V:()=>j});var n=s(11458),r=s(13574),i=s(59858),a=s(97633),o=s(44647),c=s(56742),d=s(28868);function l({transportableData:e,marker:t,metadata:s}){const n=t.length+s.length;return e.substring(n)}var u=s(59503);function p({encipheredContents:e,marker:t,metadata:s}){const{derivation:n,cipher:r,type:i,version:a}=t,{iv:o,salt:c,signature:d}=s;return{type:i,version:a,derivationConfig:n,cipherConfig:r,salt:(0,u.u)(c),signature:(0,u.u)(d),iv:(0,u.u)(o),encipheredContents:(0,u.u)(e)}}function m({str:e,substr:t,occurrence:s}){if(s<1)return-1;let n=0,r=-1;for(;n<s;){if(r=e.indexOf(t,r+1),r<0)return r;n++}return r}var h=s(83806);function g({transportableData:e,makeMarker:t,schema:s}){const n=s.count+1,r=m({str:e,substr:h.F,occurrence:n}),i=e.substring(1,r).split(h.F);if(i.length!==s.count)throw new Error("Marker and schema length mismatch");return t({bytes:r+1,markerSchema:s,values:i})}var v=s(7165);const y=v.z.object({algorithm:v.z.literal("aes256"),mode:v.z.literal("cbchmac"),ivLength:v.z.literal(16)}),f=v.z.object({algorithm:v.z.literal("aes256"),mode:v.z.literal("cbchmac64"),ivLength:v.z.literal(16)}),b=v.z.union([y,f]),S=v.z.object({algorithm:v.z.literal("argon2d"),saltLength:v.z.literal(16),tCost:v.z.number(),mCost:v.z.number(),parallelism:v.z.number()}),w=v.z.object({algorithm:v.z.literal("pbkdf2"),saltLength:v.z.union([v.z.literal(16),v.z.literal(32)]),iterations:v.z.number(),hashAlgorithm:v.z.enum(["sha1","sha256"])}),E=v.z.object({algorithm:v.z.literal("noderivation")}),_=v.z.literal("flexible"),C=v.z.object({version:v.z.literal(1),type:_,length:v.z.number(),derivation:S,cipher:y});function I({bytes:e,markerSchema:t,values:s}){const{version:n,derivation:r,saltLength:i,tCost:a,mCost:o,parallelism:c,cipher:d,mode:l,ivLength:u}=t.index,p=C.safeParse({version:Number(s[n]),type:"flexible",length:e,derivation:{algorithm:s[r],saltLength:Number(s[i]),tCost:Number(s[a]),mCost:Number(s[o]),parallelism:Number(s[c])},cipher:{algorithm:s[d],mode:s[l],ivLength:Number(s[u])}});if(!p.success)throw new Error(p.error.message);return p.data}var T=s(62690);const A=32;function U({transportableData:e,marker:t}){const{length:s,derivation:n,cipher:r}=t,i=n.saltLength,{ivLength:a}=r,o=s+0,c=o+i,d=c+a;return{iv:e.substring(c,c+a),length:i+a+A,salt:e.substring(o,o+i),signature:e.substring(d,d+A)}}const N=v.z.object({version:v.z.literal(1),type:_,length:v.z.number(),derivation:E,cipher:b});function O({bytes:e,markerSchema:t,values:s}){const{version:n,cipher:r,mode:i,ivLength:a}=t.index,o=N.safeParse({version:Number(s[n]),type:"flexible",length:e,derivation:{algorithm:"noderivation"},cipher:{algorithm:s[r],mode:s[i],ivLength:Number(s[a])}});if(!o.success)throw new Error(o.error.message);return o.data}function D(){return e=>{const t=g({transportableData:e,makeMarker:O,schema:T.NODERIVATION_MARKER_SCHEMA}),s=function({transportableData:e,marker:t}){const{length:s,cipher:n}=t,{ivLength:r}=n,i=s+0,a=i+r;return{iv:e.substring(i,i+r),length:r+A,signature:e.substring(a,a+A)}}({transportableData:e,marker:t});return function({encipheredContents:e,marker:t,metadata:s}){const{derivation:n,cipher:r,type:i,version:a}=t,{iv:o,signature:c}=s;return{type:i,version:a,derivationConfig:n,cipherConfig:r,signature:(0,u.u)(c),iv:(0,u.u)(o),encipheredContents:(0,u.u)(e)}}({encipheredContents:l({transportableData:e,marker:t,metadata:s}),marker:t,metadata:s})}}const F=v.z.object({version:v.z.literal(1),type:_,length:v.z.number(),derivation:w,cipher:y});function P({bytes:e,markerSchema:t,values:s}){const{version:n,derivation:r,saltLength:i,iterations:a,hashAlgorithm:o,cipher:c,mode:d,ivLength:l}=t.index,u=F.safeParse({version:Number(s[n]),type:"flexible",length:e,derivation:{algorithm:s[r],saltLength:Number(s[i]),iterations:Number(s[a]),hashAlgorithm:s[o]},cipher:{algorithm:s[c],mode:s[d],ivLength:Number(s[l])}});if(!u.success)throw new Error(u.error.message);return u.data}function R({transportableData:e,index:t}){const s=t+1,n=m({str:e,substr:h.F,occurrence:s}),r=m({str:e,substr:h.F,occurrence:s+1});if(-1===n||-1===r)throw new Error("Marker info indices not found");return e.substring(n+1,r)}const x=0,L=1;function k(e){switch(e){case"argon2d":return e=>{const t=g({transportableData:e,makeMarker:I,schema:T.ARGON2D_MARKER_SCHEMA}),s=U({transportableData:e,marker:t});return p({encipheredContents:l({transportableData:e,marker:t,metadata:s}),marker:t,metadata:s})};case"pbkdf2":return e=>{const t=g({transportableData:e,makeMarker:P,schema:T.PBKDF2_MARKER_SCHEMA}),s=U({transportableData:e,marker:t});return p({encipheredContents:l({transportableData:e,marker:t,metadata:s}),marker:t,metadata:s})};case"noderivation":return D();default:(0,c.U)(e)}}async function j(e,t,s,c){const l=function(e){const t=(0,o.v)(e),s=R({transportableData:t,index:x});if(Number(s)!==h.g)throw new Error("Marker version not supported");const n=R({transportableData:t,index:L});if(!(0,d.b9)(n))throw new Error("Derivation algorithm not supported");return k(n)(t)}(c),{deriveKeyArgon2d:u,deriveKeyPbkdf2:p}=t,{derivationConfig:m,salt:g}=l,{algorithm:v}=m,y="pbkdf2"===v||"argon2d"===v;if(y&&!g)throw new Error("Need salt for derivation");const f=y&&g?await(0,a.b)(e,g,p,u,m,s):e,{mode:b}=l.cipherConfig,{computeHash:S}=t,{encryptionKey:w,signatureKey:E}="cbchmac64"===b?await(0,i.U)(f):await(0,r.Y)(f,S),{iv:_,encipheredContents:C}=l,I=(0,n.K)(_,C),{signature:T}=l;return{signatureKey:E,signature:T,dataToSign:I,encryptionKey:w,iv:_,encipheredContents:C}}async function M(e,t,s,n){const{verifyHmacSha:r}=t,{signatureKey:i,signature:a,dataToSign:o,encryptionKey:c,iv:d,encipheredContents:l}=await j(e,t,s,n);if(!await r(i,a,o))throw new Error("Signature cannot be verified");const{decryptAes256:u}=t;return u(c,d,l)}},45302:(e,t,s)=>{s.d(t,{I:()=>l});var n=s(11458),r=s(28868),i=s(93704),a=s(3440);const o={type:"KWC5",derivation:r.oo,cipher:i.BU};function c(e){const t=function({transportableData:e,marker:t}){const{cipher:s,type:n}=t,{ivLength:r}=s,i=a.RB+r+a.en+n.length,o=i+a.jK;return{iv:e.slice(a.RB,a.RB+r),signature:e.slice(i,i+a.jK),encipheredContents:e.slice(o)}}({transportableData:e,marker:o});return{iv:t.iv,type:a.PD,signature:t.signature,encipheredContents:t.encipheredContents,derivationConfig:r.oo,cipherConfig:i.BU}}var d=s(13574);async function l(e,t,s){const r=c(s),{computeHash:i}=t,{encryptionKey:a,signatureKey:o}=await(0,d.Y)(e,i),{iv:l,encipheredContents:u}=r,p=(0,n.K)(l,u),{verifyHmacSha:m}=t,{signature:h}=r;if(!await m(o,h,p))throw new Error("Signature cannot be verified");const{decryptAes256:g}=t;return g(a,l,u)}},42775:(e,t,s)=>{s.d(t,{W:()=>a});var n=s(59503),r=s(79533),i=s(17991);async function a(e,t){const s=(0,n.u)((0,r.N)(t)),a=await e(s,"SHA-1");return(0,i.k)(a)}},59858:(e,t,s)=>{function n(e){const t=new Uint8Array(e),s=e.byteLength/2,n=t.slice(0,s),r=t.slice(s);return Promise.resolve({encryptionKey:n.buffer,signatureKey:r.buffer})}s.d(t,{U:()=>n})},13574:(e,t,s)=>{s.d(t,{Y:()=>r});const n="SHA-512";async function r(e,t){const s=await t(e,n),r=new Uint8Array(s),i=s.byteLength/2,a=r.slice(0,i),o=r.slice(i,s.byteLength);return{encryptionKey:a.buffer,signatureKey:o.buffer}}},36826:(e,t,s)=>{s.d(t,{N:()=>r,z:()=>n});const n="AES-CBC",r=256},56782:(e,t,s)=>{s.d(t,{x:()=>n});const n="SHA-256"},49869:(e,t,s)=>{s.d(t,{$k:()=>n,Tt:()=>i,xJ:()=>r});const n="RSA-OAEP",r="RSASSA-PKCS1-v1_5",i="SHA-256"},33685:(e,t,s)=>{s.d(t,{j:()=>n});class n{}},14940:(e,t,s)=>{s.d(t,{W:()=>i});var n=s(97143),r=function(e){return e[e.APPEND=0]="APPEND",e[e.SET=1]="SET",e[e.DELETE=2]="DELETE",e[e.DELETE_MULTIPLE=3]="DELETE_MULTIPLE",e}({});class i{has(e){return this.headers.has(e.toLowerCase())}get(e){const t=this.headers.get(e.toLowerCase());return t?.[0]??null}keys(){return Array.from(this.normalizedNames.values())}getAll(e){return this.headers.get(e.toLowerCase())??null}append(e,t){return this.clone({name:e,value:t,op:r.APPEND})}set(e,t){return this.clone({name:e,value:t,op:r.SET})}delete(e,t){return this.clone({name:e,value:t,op:r.DELETE})}deleteMultiple(e){return this.clone({names:e,op:r.DELETE_MULTIPLE})}toObject(){return Object.fromEntries(this.headers)}maybeSetNormalizedName(e,t){this.normalizedNames.has(t)||this.normalizedNames.set(t,e)}clone(e){const t=new i;return t.initFromOther(this),t.applyUpdate(e),t}applyUpdate(e){switch(e.op){case r.APPEND:case r.SET:{const t=e.name.toLowerCase();let s=e.value;if("string"==typeof s&&(s=[s]),0===s.length)return;this.maybeSetNormalizedName(e.name,t);const n=(e.op===r.APPEND?this.headers.get(t):void 0)??[];n.push(...s),this.headers.set(t,n)}break;case r.DELETE:{const t=e.name.toLowerCase(),s=e.value;if(s){let e=this.headers.get(t);if(!e)return;const n=Array.isArray(s)?s:[s];e=e.filter((e=>!n.includes(e))),0===e.length?(this.headers.delete(t),this.normalizedNames.delete(t)):this.headers.set(t,e)}else this.headers.delete(t),this.normalizedNames.delete(t)}break;case r.DELETE_MULTIPLE:e.names.forEach((e=>{const t=e.toLowerCase();this.headers.delete(t),this.normalizedNames.delete(t)}))}}initFromOther(e){Array.from(e.headers.keys()).forEach((t=>{this.headers.set(t,[...e.headers.get(t)]),this.normalizedNames.set(t,e.normalizedNames.get(t))}))}initFromObject(e){Object.keys(e).forEach((t=>{let s=e[t];const n=t.toLowerCase();"string"==typeof s&&(s=[s]),s.length>0&&(this.headers.set(n,s),this.maybeSetNormalizedName(t,n))}))}initFromString(e){e.split("\n").forEach((e=>{const t=e.indexOf(":");if(t>0){const s=e.slice(0,t),n=s.toLowerCase(),r=e.slice(t+1).trim();this.maybeSetNormalizedName(s,n),this.headers.has(n)?this.headers.get(n).push(r):this.headers.set(n,[r])}}))}constructor(e){(0,n._)(this,"headers",new Map),(0,n._)(this,"normalizedNames",new Map),"string"==typeof e?this.initFromString(e):e&&this.initFromObject(e)}}},30558:(e,t,s)=>{s.d(t,{L:()=>a});var n=s(97143);class r{encodeKey(e){return this.standardEncoding(e)}encodeValue(e){return this.standardEncoding(e)}decodeKey(e){return decodeURIComponent(e)}decodeValue(e){return decodeURIComponent(e)}standardEncoding(e){return encodeURIComponent(e).replace(r.STANDARD_ENCODING_REGEX,((e,t)=>r.STANDARD_ENCODING_REPLACEMENTS[t]??e))}}(0,n._)(r,"STANDARD_ENCODING_REGEX",/%(\d[a-f0-9])/gi),(0,n._)(r,"STANDARD_ENCODING_REPLACEMENTS",{40:"@","3A":":",24:"$","2C":",","3B":";","3D":"=","3F":"?","2F":"/"});var i=function(e){return e[e.APPEND=0]="APPEND",e[e.SET=1]="SET",e[e.DELETE=2]="DELETE",e}({});class a{has(e){return this.map.has(e)}get(e){const t=this.map.get(e);return t?.[0]??null}getAll(e){return this.map.get(e)??null}keys(){return Array.from(this.map.keys())}append(e,t){return this.clone({param:e,value:t,op:i.APPEND})}appendAll(e){const t=[];return Object.keys(e).forEach((s=>{const n=e[s];Array.isArray(n)?n.forEach((e=>{t.push({param:s,value:e,op:i.APPEND})})):t.push({param:s,value:n,op:i.APPEND})})),this.clone(t)}set(e,t){return this.clone({param:e,value:t,op:i.SET})}delete(e,t){return this.clone({param:e,value:t,op:i.DELETE})}toString(){return this.keys().map((e=>{const t=this.encoder.encodeKey(e);return this.map.get(e).map((e=>t+"="+this.encoder.encodeValue(e))).join("&")})).filter((e=>""!==e)).join("&")}clone(e){const t=new a({},{encoder:this.encoder});return t.initFromOther(this),t.applyUpdates(Array.isArray(e)?e:[e]),t}initFromOther(e){e.keys().forEach((t=>this.map.set(t,[...e.map.get(t)])))}initFromObject(e){Object.keys(e).forEach((t=>{const s=e[t],n=a.isValueArray(s)?s.map(a.valueToString):[a.valueToString(s)];this.map.set(t,n)}))}initFromString(e){const{encoder:t}=this;if(e.length>0){e.replace(/^\?/,"").split("&").forEach((e=>{const s=e.indexOf("="),[n,r]=-1===s?[t.decodeKey(e),""]:[t.decodeKey(e.slice(0,s)),t.decodeValue(e.slice(s+1))],i=this.map.get(n)??[];i.push(r),this.map.set(n,i)}))}}applyUpdates(e){e.forEach((e=>{switch(e.op){case i.APPEND:case i.SET:{const t=(e.op===i.APPEND?this.map.get(e.param):void 0)??[];t.push(a.valueToString(e.value)),this.map.set(e.param,t);break}case i.DELETE:if(void 0===e.value){this.map.delete(e.param);break}{const t=this.map.get(e.param)??[],s=t.indexOf(a.valueToString(e.value));-1!==s&&t.splice(s,1),t.length>0?this.map.set(e.param,t):this.map.delete(e.param)}}}))}static valueToString(e){return`${e}`}static isValueArray(e){return Array.isArray(e)}constructor(e={},t={}){(0,n._)(this,"map",new Map),(0,n._)(this,"encoder",void 0),this.encoder=t.encoder??new r,"string"==typeof e?this.initFromString(e):this.initFromObject(e)}}},8624:(e,t,s)=>{s.d(t,{a:()=>a});var n=s(97143),r=s(14940),i=s(30558);class a{serializeBody(){return null===this.body?null:a.isArrayBuffer(this.body)||"string"==typeof this.body?this.body:this.body instanceof i.L?this.body.toString():"object"==typeof this.body||"boolean"==typeof this.body||Array.isArray(this.body)?JSON.stringify(this.body):this.body.toString()}detectContentTypeHeader(){return null===this.body||a.isArrayBuffer(this.body)?null:"string"==typeof this.body?"text/plain":this.body instanceof i.L?"application/x-www-form-urlencoded;charset=UTF-8":"object"==typeof this.body||"number"==typeof this.body||"boolean"==typeof this.body?"application/json":null}clone(e={}){const t=e.method??this.method,s=e.url??this.url,n=e.responseType??this.responseType,r=void 0!==e.body?e.body:this.body,i=void 0!==e.withCredentials?e.withCredentials:this.withCredentials,o=void 0!==e.timeout?e.timeout:this.timeout,c=e.mode??this.mode;let d=e.headers?this.getHeadersFromOptions(e.headers):this.headers,l=e.params?this.getParamsFromOptions(e.params):this.params;const u=e.setHeaders;u&&(d=Object.keys(u).reduce(((e,t)=>e.set(t,u[t])),d));const p=e.setParams;return p&&(l=Object.keys(p).reduce(((e,t)=>e.set(t,p[t])),l)),new a(t,s,r,{params:l,headers:d,responseType:n,withCredentials:i,timeout:o,mode:c})}getHeadersFromOptions(e){return e instanceof r.W?e:new r.W(e)}getParamsFromOptions(e){return e instanceof i.L?e:new i.L(e)}initUrlWithParams(){const e=this.params.toString();if(0===e.length)return this.url;const t=this.url.indexOf("?"),s=-1===t?"?":t<this.url.length-1?"&":"";return this.url+s+e}static mightHaveBody(e){switch(e){case"DELETE":case"GET":case"HEAD":case"OPTIONS":return!1;default:return!0}}static isArrayBuffer(e){return"undefined"!=typeof ArrayBuffer&&e instanceof ArrayBuffer}constructor(e,t,s,o){(0,n._)(this,"body",null),(0,n._)(this,"headers",new r.W),(0,n._)(this,"withCredentials",!1),(0,n._)(this,"timeout",6e4),(0,n._)(this,"responseType","json"),(0,n._)(this,"method",void 0),(0,n._)(this,"params",new i.L({})),(0,n._)(this,"urlWithParams",void 0),(0,n._)(this,"url",void 0),(0,n._)(this,"mode",void 0),this.url=t,this.method=e,a.mightHaveBody(this.method)&&(this.body=s??null),o&&(this.withCredentials=Boolean(o.withCredentials),o.responseType&&(this.responseType=o.responseType),o.headers&&(this.headers=this.getHeadersFromOptions(o.headers)),o.params&&(this.params=this.getParamsFromOptions(o.params)),o.timeout&&o.timeout>0&&(this.timeout=o.timeout),o.mode&&(this.mode=o.mode)),this.urlWithParams=this.initUrlWithParams()}}},19313:(e,t,s)=>{s.d(t,{Z:()=>d});var n=s(97143),r=s(91174),i=s(14940),a=s(18920);async function o(e){const t=e.getReader();let s=new Uint8Array(0),n=await t.read();for(;!n.done;){const e=new Uint8Array(s.byteLength+n.value.byteLength);e.set(s,0),e.set(n.value,s.byteLength),s=e,n=await t.read()}return s}class c{pull(e){const{bytesRead:t,data:s}=this;if(t>=s.byteLength)return void e.close();const n=Math.min(s.byteLength-t,e.desiredSize??1/0);if(n>0){const r=new Uint8Array(s,t,n);e.enqueue(r),this.bytesRead+=n}t>=s.byteLength&&e.close()}constructor(e){(0,n._)(this,"bytesRead",0),(0,n._)(this,"data",void 0),this.data=e}}class d{clone(e={}){return new d({body:void 0!==e.body?e.body:null===this.body?null:this.body instanceof r.Pz?this.body.tee()[0]:this.body,headers:e.headers??this.headers,status:void 0!==e.status?e.status:this.status,statusText:e.statusText??this.statusText,url:e.url??this.url??void 0})}isBodyReadableStream(){return!!this.body&&"object"==typeof this.body&&"ReadableStream"===this.body.constructor.name}async arrayBuffer(){if(null===this.body)throw new Error("Empty response body");if(this.isBodyReadableStream()){return(await o(this.body)).buffer}if(!(this.body instanceof ArrayBuffer))throw new Error("Unexpected body type, not an ArrayBuffer");return this.body}async text(){if(null===this.body)throw new Error("Empty response body");if(this.isBodyReadableStream()){const e=await o(this.body);return(new TextDecoder).decode(e.buffer)}if("string"!=typeof this.body)throw new Error("Unexpected body type, not a string");return this.body}async json(e){if(null===this.body)throw new Error("Empty response body");if(this.isBodyReadableStream()){const t=await o(this.body),s=(new TextDecoder).decode(t.buffer);try{const t=JSON.parse(s);return e.decode(t)}catch(e){throw new Error("Failed to parse response body JSON")}}if(this.body instanceof ArrayBuffer||"string"==typeof this.body)throw new Error("Unexpected body type");return e.decode(this.body)}bodyStream(){if(null===this.body)throw new Error("Empty response body");if("object"==typeof this.body&&"ReadableStream"===this.body.constructor.name)return this.body;const e=new TextEncoder;if("string"==typeof this.body)return new r.Pz(new c(e.encode(this.body).buffer));if(this.body instanceof ArrayBuffer)return new r.Pz(new c(this.body));const t=JSON.stringify(this.body);return new r.Pz(new c(e.encode(t).buffer))}constructor(e={},t=a.W.Ok,s="OK"){(0,n._)(this,"headers",void 0),(0,n._)(this,"status",void 0),(0,n._)(this,"statusText",void 0),(0,n._)(this,"url",void 0),(0,n._)(this,"ok",void 0),(0,n._)(this,"body",void 0),this.headers=e.headers instanceof i.W?e.headers:new i.W(e.headers),this.status=void 0!==e.status?e.status:t,this.statusText=e.statusText??s,this.url=e.url??null,this.ok=this.status>=200&&this.status<300,this.body=void 0!==e.body?e.body:null}}},18920:(e,t,s)=>{s.d(t,{W:()=>n});var n=function(e){return e[e.Continue=100]="Continue",e[e.SwitchingProtocols=101]="SwitchingProtocols",e[e.Processing=102]="Processing",e[e.EarlyHints=103]="EarlyHints",e[e.Ok=200]="Ok",e[e.Created=201]="Created",e[e.Accepted=202]="Accepted",e[e.NonAuthoritativeInformation=203]="NonAuthoritativeInformation",e[e.NoContent=204]="NoContent",e[e.ResetContent=205]="ResetContent",e[e.PartialContent=206]="PartialContent",e[e.MultiStatus=207]="MultiStatus",e[e.AlreadyReported=208]="AlreadyReported",e[e.ImUsed=226]="ImUsed",e[e.MultipleChoices=300]="MultipleChoices",e[e.MovedPermanently=301]="MovedPermanently",e[e.Found=302]="Found",e[e.SeeOther=303]="SeeOther",e[e.NotModified=304]="NotModified",e[e.UseProxy=305]="UseProxy",e[e.Unused=306]="Unused",e[e.TemporaryRedirect=307]="TemporaryRedirect",e[e.PermanentRedirect=308]="PermanentRedirect",e[e.BadRequest=400]="BadRequest",e[e.Unauthorized=401]="Unauthorized",e[e.PaymentRequired=402]="PaymentRequired",e[e.Forbidden=403]="Forbidden",e[e.NotFound=404]="NotFound",e[e.MethodNotAllowed=405]="MethodNotAllowed",e[e.NotAcceptable=406]="NotAcceptable",e[e.ProxyAuthenticationRequired=407]="ProxyAuthenticationRequired",e[e.RequestTimeout=408]="RequestTimeout",e[e.Conflict=409]="Conflict",e[e.Gone=410]="Gone",e[e.LengthRequired=411]="LengthRequired",e[e.PreconditionFailed=412]="PreconditionFailed",e[e.PayloadTooLarge=413]="PayloadTooLarge",e[e.UriTooLong=414]="UriTooLong",e[e.UnsupportedMediaType=415]="UnsupportedMediaType",e[e.RangeNotSatisfiable=416]="RangeNotSatisfiable",e[e.ExpectationFailed=417]="ExpectationFailed",e[e.ImATeapot=418]="ImATeapot",e[e.MisdirectedRequest=421]="MisdirectedRequest",e[e.UnprocessableEntity=422]="UnprocessableEntity",e[e.Locked=423]="Locked",e[e.FailedDependency=424]="FailedDependency",e[e.TooEarly=425]="TooEarly",e[e.UpgradeRequired=426]="UpgradeRequired",e[e.PreconditionRequired=428]="PreconditionRequired",e[e.TooManyRequests=429]="TooManyRequests",e[e.RequestHeaderFieldsTooLarge=431]="RequestHeaderFieldsTooLarge",e[e.UnavailableForLegalReasons=451]="UnavailableForLegalReasons",e[e.InternalServerError=500]="InternalServerError",e[e.NotImplemented=501]="NotImplemented",e[e.BadGateway=502]="BadGateway",e[e.ServiceUnavailable=503]="ServiceUnavailable",e[e.GatewayTimeout=504]="GatewayTimeout",e[e.HttpVersionNotSupported=505]="HttpVersionNotSupported",e[e.VariantAlsoNegotiates=506]="VariantAlsoNegotiates",e[e.InsufficientStorage=507]="InsufficientStorage",e[e.LoopDetected=508]="LoopDetected",e[e.NotExtended=510]="NotExtended",e[e.NetworkAuthenticationRequired=511]="NetworkAuthenticationRequired",e}({})},13528:(e,t,s)=>{s.d(t,{R:()=>i,a:()=>a});var n=s(97143),r=s(98124);class i extends((0,r.Hu)("BadStatus","The HTTP response has a non-successful status code (not 2XX)")){constructor(e){super(),(0,n._)(this,"response",void 0),this.response=e}}class a extends((0,r.Hu)("FetchFailedError","Something happened while communicating to the server")){}},28286:(e,t,s)=>{s.d(t,{M:()=>n});const n="file-upload"},98124:(e,t,s)=>{s.d(t,{As:()=>a,BU:()=>o,Hu:()=>i,Vj:()=>r});var n=s(97143);const r=(e,t="")=>()=>({tag:e,message:t}),i=(e,t)=>class extends Error{constructor(){super(t),(0,n._)(this,"tag",void 0),this.tag=e}};function a(e,t){return t.includes(e.tag)}const o=e=>e.tag},17591:(e,t,s)=>{function n(e){if(e instanceof Error)throw e;if("string"==typeof e)throw new Error(e);throw new Error(e.tag)}s.d(t,{j:()=>n})},66638:(e,t,s)=>{s.r(t),s.d(t,{FILE_UPLOAD:()=>p.M,FunctionalError:()=>r.Hu,assertUnreachable:()=>a.U,assertsSuccess:()=>c.nt,concatMapFailure:()=>d.Tc,concatMapSuccess:()=>d.Gx,concatMatchResult:()=>d.RW,createMatchable:()=>o.H6,defineFunctionalError:()=>r.Vj,failure:()=>c.Rn,getBrander:()=>u.zq,getFailure:()=>c.Yv,getSuccess:()=>c.db,getSuccessOrThrow:()=>c.ho,hasProperty:()=>u.l$,isFailure:()=>c.hx,isFunctionalErrorOfType:()=>r.As,isMatchable:()=>o.cw,isObject:()=>n.K,isResult:()=>c.AZ,isSuccess:()=>c.d6,mapFailure:()=>c.SN,mapFailureObservable:()=>d.DZ,mapResultObservable:()=>d.vg,mapSuccess:()=>c.ty,mapSuccessObservable:()=>d.Qn,mapSuccessResultObservable:()=>d.lk,match:()=>o.EQ,matchMap:()=>l.G,matchResult:()=>c.f2,matchResultObservable:()=>d.nb,panic:()=>i.j,safeCast:()=>u.Ay,success:()=>c.Vp,switchMapFailure:()=>d.pr,switchMapSuccess:()=>d.CP,switchMatchResult:()=>d.bM,toFunctionalErrorCode:()=>r.BU});var n=s(3873),r=s(98124),i=s(17591),a=s(56742),o=s(52477),c=s(78346),d=s(33312),l=s(25937),u=s(7303),p=s(28286)},56742:(e,t,s)=>{function n(e,t){throw new Error(t??`Unreachable code detected (${e})`)}s.d(t,{U:()=>n})},25937:(e,t,s)=>{s.d(t,{G:()=>n});const n=(e,t)=>t[e]()},52477:(e,t,s)=>{s.d(t,{EQ:()=>r,H6:()=>n,cw:()=>i});const n=(e,t)=>({tag:e,...t}),r=(e,t)=>{const s=e.tag,n=s in t?t[s]:null;if(!n)throw new Error("Unmatchable case");return n(e)},i=(e,...t)=>{if("object"!=typeof e||!e)return!1;return"tag"in e&&t.includes(e.tag)}},33312:(e,t,s)=>{s.d(t,{CP:()=>v,DZ:()=>l,Gx:()=>m,Qn:()=>d,RW:()=>g,Tc:()=>h,bM:()=>f,lk:()=>p,nb:()=>c,pr:()=>y,vg:()=>u});var n=s(87065),r=s(34987),i=s(43978),a=s(78346),o=s(52477);function c(e){return t=>t.pipe((0,n.U)((t=>(0,o.EQ)(t,{success:({data:t})=>e.success(t),failure:({error:t})=>e.failure(t)}))))}function d(e){return t=>t.pipe((0,n.U)((t=>(0,a.hx)(t)?t:(0,a.Vp)(e(t.data)))))}function l(e){return t=>t.pipe((0,n.U)((t=>(0,a.d6)(t)?t:(0,a.Rn)(e(t.error)))))}function u(e,t){return s=>s.pipe((0,n.U)((s=>(0,a.hx)(s)?t?t(s.error):s:e(s.data))))}function p(e){return t=>t.pipe((0,n.U)((t=>(0,a.hx)(t)?t:e(t.data))))}function m(e){return t=>t.pipe((0,r.b)((async t=>(0,a.hx)(t)?t:(0,a.Vp)(await e(t.data)))))}function h(e){return t=>t.pipe((0,r.b)((async t=>(0,a.d6)(t)?t:(0,a.Rn)(await e(t.error)))))}function g(e){return t=>t.pipe((0,r.b)((t=>(0,a.f2)(t,e))))}function v(e){return t=>t.pipe((0,i.w)((async t=>(0,a.hx)(t)?t:(0,a.Vp)(await e(t.data)))))}function y(e){return t=>t.pipe((0,i.w)((async t=>(0,a.d6)(t)?t:(0,a.Rn)(await e(t.error)))))}function f(e){return t=>t.pipe((0,i.w)((t=>(0,a.f2)(t,e))))}},78346:(e,t,s)=>{s.d(t,{nt:()=>l,Rn:()=>o,Yv:()=>g,db:()=>m,ho:()=>h,hx:()=>u,AZ:()=>p,d6:()=>d,SN:()=>y,ty:()=>v,f2:()=>c,Vp:()=>a});var n=s(52477);const r="success",i="failure",a=e=>(0,n.H6)("success",{data:e}),o=e=>(0,n.H6)("failure",{error:e}),c=(e,t)=>(0,n.EQ)(e,{success:({data:e})=>t.success(e),failure:({error:e})=>t.failure(e)}),d=e=>e.tag===r;function l(e){if(!d(e))throw new Error("Is not a success")}const u=e=>e.tag===i,p=e=>(0,n.cw)(e,r,i),m=e=>e.data,h=e=>(l(e),e.data),g=e=>e.error,v=(e,t)=>u(e)?e:a(t(e.data)),y=(e,t)=>d(e)?e:o(t(e.error))},3873:(e,t,s)=>{s.d(t,{K:()=>n});const n=e=>"object"==typeof e&&null!==e},7303:(e,t,s)=>{s.d(t,{Ay:()=>r,l$:()=>i,zq:()=>n});const n=e=>t=>Object.assign(t,{brand:e}),r=e=>e;function i(e,t){return t in e}}}]);