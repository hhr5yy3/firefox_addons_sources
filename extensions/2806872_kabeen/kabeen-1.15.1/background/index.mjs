(function(){"use strict";var ge=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function Ne(n){return n&&n.__esModule&&Object.prototype.hasOwnProperty.call(n,"default")?n.default:n}function Pe(n){if(n.__esModule)return n;var e=n.default;if(typeof e=="function"){var t=function r(){return this instanceof r?Reflect.construct(e,arguments,this.constructor):e.apply(this,arguments)};t.prototype=e.prototype}else t={};return Object.defineProperty(t,"__esModule",{value:!0}),Object.keys(n).forEach(function(r){var i=Object.getOwnPropertyDescriptor(n,r);Object.defineProperty(t,r,i.get?i:{enumerable:!0,get:function(){return n[r]}})}),t}var pe={exports:{}};(function(n,e){(function(t,r){r(n)})(typeof globalThis<"u"?globalThis:typeof self<"u"?self:ge,function(t){var r,i;if(!((i=(r=globalThis.chrome)==null?void 0:r.runtime)!=null&&i.id))throw new Error("This script should only be loaded in a browser extension.");if(typeof globalThis.browser>"u"||Object.getPrototypeOf(globalThis.browser)!==Object.prototype){const s="The message port closed before a response was received.",o=m=>{const a={alarms:{clear:{minArgs:0,maxArgs:1},clearAll:{minArgs:0,maxArgs:0},get:{minArgs:0,maxArgs:1},getAll:{minArgs:0,maxArgs:0}},bookmarks:{create:{minArgs:1,maxArgs:1},get:{minArgs:1,maxArgs:1},getChildren:{minArgs:1,maxArgs:1},getRecent:{minArgs:1,maxArgs:1},getSubTree:{minArgs:1,maxArgs:1},getTree:{minArgs:0,maxArgs:0},move:{minArgs:2,maxArgs:2},remove:{minArgs:1,maxArgs:1},removeTree:{minArgs:1,maxArgs:1},search:{minArgs:1,maxArgs:1},update:{minArgs:2,maxArgs:2}},browserAction:{disable:{minArgs:0,maxArgs:1,fallbackToNoCallback:!0},enable:{minArgs:0,maxArgs:1,fallbackToNoCallback:!0},getBadgeBackgroundColor:{minArgs:1,maxArgs:1},getBadgeText:{minArgs:1,maxArgs:1},getPopup:{minArgs:1,maxArgs:1},getTitle:{minArgs:1,maxArgs:1},openPopup:{minArgs:0,maxArgs:0},setBadgeBackgroundColor:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0},setBadgeText:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0},setIcon:{minArgs:1,maxArgs:1},setPopup:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0},setTitle:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0}},browsingData:{remove:{minArgs:2,maxArgs:2},removeCache:{minArgs:1,maxArgs:1},removeCookies:{minArgs:1,maxArgs:1},removeDownloads:{minArgs:1,maxArgs:1},removeFormData:{minArgs:1,maxArgs:1},removeHistory:{minArgs:1,maxArgs:1},removeLocalStorage:{minArgs:1,maxArgs:1},removePasswords:{minArgs:1,maxArgs:1},removePluginData:{minArgs:1,maxArgs:1},settings:{minArgs:0,maxArgs:0}},commands:{getAll:{minArgs:0,maxArgs:0}},contextMenus:{remove:{minArgs:1,maxArgs:1},removeAll:{minArgs:0,maxArgs:0},update:{minArgs:2,maxArgs:2}},cookies:{get:{minArgs:1,maxArgs:1},getAll:{minArgs:1,maxArgs:1},getAllCookieStores:{minArgs:0,maxArgs:0},remove:{minArgs:1,maxArgs:1},set:{minArgs:1,maxArgs:1}},devtools:{inspectedWindow:{eval:{minArgs:1,maxArgs:2,singleCallbackArg:!1}},panels:{create:{minArgs:3,maxArgs:3,singleCallbackArg:!0},elements:{createSidebarPane:{minArgs:1,maxArgs:1}}}},downloads:{cancel:{minArgs:1,maxArgs:1},download:{minArgs:1,maxArgs:1},erase:{minArgs:1,maxArgs:1},getFileIcon:{minArgs:1,maxArgs:2},open:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0},pause:{minArgs:1,maxArgs:1},removeFile:{minArgs:1,maxArgs:1},resume:{minArgs:1,maxArgs:1},search:{minArgs:1,maxArgs:1},show:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0}},extension:{isAllowedFileSchemeAccess:{minArgs:0,maxArgs:0},isAllowedIncognitoAccess:{minArgs:0,maxArgs:0}},history:{addUrl:{minArgs:1,maxArgs:1},deleteAll:{minArgs:0,maxArgs:0},deleteRange:{minArgs:1,maxArgs:1},deleteUrl:{minArgs:1,maxArgs:1},getVisits:{minArgs:1,maxArgs:1},search:{minArgs:1,maxArgs:1}},i18n:{detectLanguage:{minArgs:1,maxArgs:1},getAcceptLanguages:{minArgs:0,maxArgs:0}},identity:{launchWebAuthFlow:{minArgs:1,maxArgs:1}},idle:{queryState:{minArgs:1,maxArgs:1}},management:{get:{minArgs:1,maxArgs:1},getAll:{minArgs:0,maxArgs:0},getSelf:{minArgs:0,maxArgs:0},setEnabled:{minArgs:2,maxArgs:2},uninstallSelf:{minArgs:0,maxArgs:1}},notifications:{clear:{minArgs:1,maxArgs:1},create:{minArgs:1,maxArgs:2},getAll:{minArgs:0,maxArgs:0},getPermissionLevel:{minArgs:0,maxArgs:0},update:{minArgs:2,maxArgs:2}},pageAction:{getPopup:{minArgs:1,maxArgs:1},getTitle:{minArgs:1,maxArgs:1},hide:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0},setIcon:{minArgs:1,maxArgs:1},setPopup:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0},setTitle:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0},show:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0}},permissions:{contains:{minArgs:1,maxArgs:1},getAll:{minArgs:0,maxArgs:0},remove:{minArgs:1,maxArgs:1},request:{minArgs:1,maxArgs:1}},runtime:{getBackgroundPage:{minArgs:0,maxArgs:0},getPlatformInfo:{minArgs:0,maxArgs:0},openOptionsPage:{minArgs:0,maxArgs:0},requestUpdateCheck:{minArgs:0,maxArgs:0},sendMessage:{minArgs:1,maxArgs:3},sendNativeMessage:{minArgs:2,maxArgs:2},setUninstallURL:{minArgs:1,maxArgs:1}},sessions:{getDevices:{minArgs:0,maxArgs:1},getRecentlyClosed:{minArgs:0,maxArgs:1},restore:{minArgs:0,maxArgs:1}},storage:{local:{clear:{minArgs:0,maxArgs:0},get:{minArgs:0,maxArgs:1},getBytesInUse:{minArgs:0,maxArgs:1},remove:{minArgs:1,maxArgs:1},set:{minArgs:1,maxArgs:1}},managed:{get:{minArgs:0,maxArgs:1},getBytesInUse:{minArgs:0,maxArgs:1}},sync:{clear:{minArgs:0,maxArgs:0},get:{minArgs:0,maxArgs:1},getBytesInUse:{minArgs:0,maxArgs:1},remove:{minArgs:1,maxArgs:1},set:{minArgs:1,maxArgs:1}}},tabs:{captureVisibleTab:{minArgs:0,maxArgs:2},create:{minArgs:1,maxArgs:1},detectLanguage:{minArgs:0,maxArgs:1},discard:{minArgs:0,maxArgs:1},duplicate:{minArgs:1,maxArgs:1},executeScript:{minArgs:1,maxArgs:2},get:{minArgs:1,maxArgs:1},getCurrent:{minArgs:0,maxArgs:0},getZoom:{minArgs:0,maxArgs:1},getZoomSettings:{minArgs:0,maxArgs:1},goBack:{minArgs:0,maxArgs:1},goForward:{minArgs:0,maxArgs:1},highlight:{minArgs:1,maxArgs:1},insertCSS:{minArgs:1,maxArgs:2},move:{minArgs:2,maxArgs:2},query:{minArgs:1,maxArgs:1},reload:{minArgs:0,maxArgs:2},remove:{minArgs:1,maxArgs:1},removeCSS:{minArgs:1,maxArgs:2},sendMessage:{minArgs:2,maxArgs:3},setZoom:{minArgs:1,maxArgs:2},setZoomSettings:{minArgs:1,maxArgs:2},update:{minArgs:1,maxArgs:2}},topSites:{get:{minArgs:0,maxArgs:0}},webNavigation:{getAllFrames:{minArgs:1,maxArgs:1},getFrame:{minArgs:1,maxArgs:1}},webRequest:{handlerBehaviorChanged:{minArgs:0,maxArgs:0}},windows:{create:{minArgs:0,maxArgs:1},get:{minArgs:1,maxArgs:2},getAll:{minArgs:0,maxArgs:1},getCurrent:{minArgs:0,maxArgs:1},getLastFocused:{minArgs:0,maxArgs:1},remove:{minArgs:1,maxArgs:1},update:{minArgs:2,maxArgs:2}}};if(Object.keys(a).length===0)throw new Error("api-metadata.json has not been included in browser-polyfill");class T extends WeakMap{constructor(c,f=void 0){super(f),this.createItem=c}get(c){return this.has(c)||this.set(c,this.createItem(c)),super.get(c)}}const b=d=>d&&typeof d=="object"&&typeof d.then=="function",C=(d,c)=>(...f)=>{m.runtime.lastError?d.reject(new Error(m.runtime.lastError.message)):c.singleCallbackArg||f.length<=1&&c.singleCallbackArg!==!1?d.resolve(f[0]):d.resolve(f)},B=d=>d==1?"argument":"arguments",F=(d,c)=>function(l,...x){if(x.length<c.minArgs)throw new Error(`Expected at least ${c.minArgs} ${B(c.minArgs)} for ${d}(), got ${x.length}`);if(x.length>c.maxArgs)throw new Error(`Expected at most ${c.maxArgs} ${B(c.maxArgs)} for ${d}(), got ${x.length}`);return new Promise((g,w)=>{if(c.fallbackToNoCallback)try{l[d](...x,C({resolve:g,reject:w},c))}catch(v){console.warn(`${d} API method doesn't seem to support the callback parameter, falling back to call it without a callback: `,v),l[d](...x),c.fallbackToNoCallback=!1,c.noCallback=!0,g()}else c.noCallback?(l[d](...x),g()):l[d](...x,C({resolve:g,reject:w},c))})},J=(d,c,f)=>new Proxy(c,{apply(l,x,g){return f.call(x,d,...g)}});let $=Function.call.bind(Object.prototype.hasOwnProperty);const q=(d,c={},f={})=>{let l=Object.create(null),x={has(w,v){return v in d||v in l},get(w,v,P){if(v in l)return l[v];if(!(v in d))return;let O=d[v];if(typeof O=="function")if(typeof c[v]=="function")O=J(d,d[v],c[v]);else if($(f,v)){let R=F(v,f[v]);O=J(d,d[v],R)}else O=O.bind(d);else if(typeof O=="object"&&O!==null&&($(c,v)||$(f,v)))O=q(O,c[v],f[v]);else if($(f,"*"))O=q(O,c[v],f["*"]);else return Object.defineProperty(l,v,{configurable:!0,enumerable:!0,get(){return d[v]},set(R){d[v]=R}}),O;return l[v]=O,O},set(w,v,P,O){return v in l?l[v]=P:d[v]=P,!0},defineProperty(w,v,P){return Reflect.defineProperty(l,v,P)},deleteProperty(w,v){return Reflect.deleteProperty(l,v)}},g=Object.create(d);return new Proxy(g,x)},U=d=>({addListener(c,f,...l){c.addListener(d.get(f),...l)},hasListener(c,f){return c.hasListener(d.get(f))},removeListener(c,f){c.removeListener(d.get(f))}}),k=new T(d=>typeof d!="function"?d:function(f){const l=q(f,{},{getContent:{minArgs:0,maxArgs:0}});d(l)}),S=new T(d=>typeof d!="function"?d:function(f,l,x){let g=!1,w,v=new Promise(y=>{w=function(D){g=!0,y(D)}}),P;try{P=d(f,l,w)}catch(y){P=Promise.reject(y)}const O=P!==!0&&b(P);if(P!==!0&&!O&&!g)return!1;const R=y=>{y.then(D=>{x(D)},D=>{let j;D&&(D instanceof Error||typeof D.message=="string")?j=D.message:j="An unexpected error occurred",x({__mozWebExtensionPolyfillReject__:!0,message:j})}).catch(D=>{console.error("Failed to send onMessage rejected reply",D)})};return R(O?P:v),!0}),K=({reject:d,resolve:c},f)=>{m.runtime.lastError?m.runtime.lastError.message===s?c():d(new Error(m.runtime.lastError.message)):f&&f.__mozWebExtensionPolyfillReject__?d(new Error(f.message)):c(f)},W=(d,c,f,...l)=>{if(l.length<c.minArgs)throw new Error(`Expected at least ${c.minArgs} ${B(c.minArgs)} for ${d}(), got ${l.length}`);if(l.length>c.maxArgs)throw new Error(`Expected at most ${c.maxArgs} ${B(c.maxArgs)} for ${d}(), got ${l.length}`);return new Promise((x,g)=>{const w=K.bind(null,{resolve:x,reject:g});l.push(w),f.sendMessage(...l)})},h={devtools:{network:{onRequestFinished:U(k)}},runtime:{onMessage:U(S),onMessageExternal:U(S),sendMessage:W.bind(null,"sendMessage",{minArgs:1,maxArgs:3})},tabs:{sendMessage:W.bind(null,"sendMessage",{minArgs:2,maxArgs:3})}},A={clear:{minArgs:1,maxArgs:1},get:{minArgs:1,maxArgs:1},set:{minArgs:1,maxArgs:1}};return a.privacy={network:{"*":A},services:{"*":A},websites:{"*":A}},q(m,h,a)};t.exports=o(chrome)}else t.exports=globalThis.browser})})(pe);var G=pe.exports;const p=Ne(G);var _=(n=>(n[n.NOT_AUTHORIZED=0]="NOT_AUTHORIZED",n[n.NO_INTERNET_CONNECTION=1]="NO_INTERNET_CONNECTION",n))(_||{});const Me=chrome.tabs.TAB_ID_NONE;class Ce{constructor(e,t,r,i){this.authenticationService=e,this.configService=t,this.pollService=r,this.settingsService=i,this.applicationClient=new De(e,i)}clearCache(){this.applications=void 0}getApplications(e,t=!1){return!t&&this.applications?Promise.resolve({body:JSON.parse(JSON.stringify(this.applications))}):this.applicationClient.getApplications(e).then(r=>(r.body&&(this.applications=r.body,this.pollService.registerApps(r.body)),{body:JSON.parse(JSON.stringify(r.body))}))}getPinApplications(){return p.storage.local.get(["pinApplications"]).then(e=>e.pinApplications||[])}pinApplication(e){return this.getPinApplications().then(t=>p.storage.local.set({pinApplications:t.concat(e)}))}unpinApplication(e){return this.getPinApplications().then(t=>p.storage.local.set({pinApplications:t.filter(r=>r!==e)}))}updateDockApplications(){return this.configService.getOrganization().then(e=>e&&e.businessUnit?this.getApplications(e.businessUnit,!0).then(t=>t.body?this.getPinApplications().then(r=>{const i=(t.body||[]).filter(s=>r.includes(s.id));return p.tabs.query({windowType:"normal"}).then(s=>s.map(o=>o.id!==Me?p.tabs.sendMessage(o.id||0,{type:"updateApplications",applications:i}).catch():Promise.resolve())).then(s=>Promise.resolve())}):(this.clearCache(),Promise.resolve())):Promise.resolve())}sendKnownAppSignal(e,t){return p.tabs.sendMessage(e,{type:"sendKnownAppSignal",applications:t})}downloadDocument(e){return this.applicationClient.downloadApplicationDocument(e)}sendWebVitalsMetric(e){return this.configService.getPlatformBrowserAndExtensionInfo().then(t=>(e.os=t[0],e.browserName=t[1].browser,e.browserVersion=t[1].version,e.extensionVersion=t[2],this.authenticationService.getToken().then(r=>fetch("https://api.kabeen.io/rovers/web-vitals/_archive",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${r}`},body:JSON.stringify(e)})).catch(r=>console.error("Failed to publish web vitals metric.")))).catch(()=>this.authenticationService.getToken().then(t=>fetch("https://api.kabeen.io/rovers/web-vitals/_archive",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${t}`},body:JSON.stringify(e)})).catch(t=>console.error("Failed to publish web vitals metric.")))}}class De{constructor(e,t){this.authenticationService=e,this.settingsService=t}getApplications(e){return this.settingsService.getLocalStorageSettings().then(t=>this.authenticationService.getToken().then(r=>fetch(`https://api.kabeen.io/rovers/organizations/${e}/applications/all?fullData=${t.displayRover}`,{method:"GET",headers:{"Content-Type":"application/json",Authorization:`Bearer ${r}`}})).then(r=>r.ok?r.json().then(i=>({body:i.apps.sort((o,m)=>o.name.localeCompare(m.name)).map(o=>{try{o.url=o.url?new URL(o.url):o.url}catch{o.url=void 0}return o})})):r.text().then(i=>({error:{code:_.NOT_AUTHORIZED,message:i}}))).catch(r=>({error:{code:_.NO_INTERNET_CONNECTION,message:"err"}})))}downloadApplicationDocument(e){return this.authenticationService.getToken().then(t=>fetch(`https://api.kabeen.io/rovers/files/${e.fileLink.fileLinkId}/download`,{method:"GET",headers:{"Content-Type":"application/json",Authorization:`Bearer ${t}`}})).then(t=>t.ok?t.blob():Promise.reject(t)).then(t=>new Promise((r,i)=>{const s=new FileReader;s.onload=function(){typeof s.result=="string"?(p.downloads.download({url:s.result,filename:e.fileLink.name}).then(()=>r()).catch(i),p.downloads.onChanged.addListener(o=>{o.state&&o.state.current==="complete"&&p.tabs.query({active:!0,currentWindow:!0}).then(m=>{m.length>0&&p.tabs.sendMessage(m[0].id||0,{type:"downloadedDocument",document:e})})})):i(new Error("FileReader did not return a string"))},s.onerror=function(){i(s.error)},s.readAsDataURL(t)}))}}class ae{constructor(e,t){this.mapName="changeme",this.map=new Map,this.mapName=e,p.storage.local.get([e]).then(r=>{r[e]&&Object.entries(JSON.parse(r[e])).forEach(([i,s])=>{this.map.set(i,t(s))})}),p.storage.local.onChanged.addListener(r=>{if(r[this.mapName]){const i=r[this.mapName].newValue;i?Object.entries(JSON.parse(i)).forEach(([s,o])=>{this.map.set(s,t(o))}):this.map.clear()}})}has(e){return this.map.has(e)}get(e){return this.map.get(e)}set(e,t){return this.map.set(e,t),p.storage.local.set({[this.mapName]:JSON.stringify(Object.fromEntries(this.map))})}delete(e){return this.map.delete(e),p.storage.local.set({[this.mapName]:JSON.stringify(Object.fromEntries(this.map))})}clear(){return this.map.clear(),p.storage.local.set({[this.mapName]:null})}forEach(e){this.map.forEach(e)}size(){return this.map.size}entries(){return this.map.entries()}}class Be{constructor(e,t,r){this.configService=e,this.authenticationService=t,this.settingsService=r,this.appNextChecks=new ae("appNextChecks",i=>new Date(i)),this.apps=[],this.timeoutId=null}async registerApps(e){const t=new Date;this.settingsService.getLocalStorageSettings().then(r=>{e.forEach(i=>{if(this.appNextChecks.has(i.id)){const s=this.appNextChecks.get(i.id);if(s&&r.activated&&s.getTime()>t.getTime()+r.frequency*30.43*24*60*60*1e3){const o=new Date;o.setMonth(o.getMonth()+r.frequency),this.appNextChecks.set(i.id,o)}}else this.appNextChecks.set(i.id,new Date(new Date().getTime()+r.initialDelay*1e3))})}),this.apps=e}async newCheckEligibleApp(e,t){return this.settingsService.getLocalStorageSettings().then(r=>{r.activated&&(this.timeoutId&&clearTimeout(this.timeoutId),t&&t.length>0&&(this.timeoutId=setTimeout(()=>{const i=new Date;p.storage.local.get(["globalNextCheck"]).then(s=>{let o=s.globalNextCheck;if(o||(o=i.getTime()),i.getTime()>=new Date(o).getTime()&&this.appNextChecks&&this.appNextChecks.size()>0){let m=!0;this.appNextChecks.forEach((a,T)=>{if(i.getTime()>a.getTime())for(const b of t)b.id===T&&m&&(p.tabs.sendMessage(e,{type:"rate",app:b}),m=!1)})}})},5e3)))})}rateApplication(e,t){return p.tabs.query({}).then(r=>{r.forEach(i=>{(i==null?void 0:i.id)!=null&&p.tabs.sendMessage(i.id,{type:"closeRate",appId:e})})}),this.configService.getOrganization().then(r=>{this.settingsService.getLocalStorageSettings().then(i=>{p.storage.local.set({globalNextCheck:new Date(new Date().getTime()+i.retryDelay*1e3).getTime()});const s=new Date,o=new Date(s.setMonth(s.getMonth()+i.frequency));return this.appNextChecks.set(e,o).then(()=>this.doPublish({timestamp:new Date().getTime(),applicationId:e,businessUnit:r.businessUnit,structure:r.structure,satisfaction:t}).catch(m=>{console.error("Failed to publish satisfaction.");const a=new Date;return a.setSeconds(a.getSeconds()+i.retryDelay),this.appNextChecks.set(e,a)}))})})}dismissApplication(e){return p.tabs.query({}).then(t=>{t.forEach(r=>{(r==null?void 0:r.id)!=null&&p.tabs.sendMessage(r.id,{type:"closeRate",appId:e})})}),this.settingsService.getLocalStorageSettings().then(t=>{p.storage.local.set({globalNextCheck:new Date(new Date().getTime()+t.retryDelay*1e3).getTime()});const r=new Date;return r.setSeconds(r.getSeconds()+t.retryDelay),this.appNextChecks.set(e,r).then(()=>this.configService.getOrganization().then(i=>{const s={applicationId:e,timestamp:new Date().getTime(),businessUnit:i.businessUnit,structure:i.structure};return this.doDismiss(s).catch(o=>{console.error("Failed to dismiss satisfaction.")})}))})}doPublish(e){return this.configService.getPlatformBrowserAndExtensionInfo().then(t=>(e.os=t[0],e.browserName=t[1].browser,e.browserVersion=t[1].version,e.extensionVersion=t[2],this.authenticationService.getToken().then(r=>fetch("https://api.kabeen.io/rovers/satisfactions/_archive",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${r}`},body:JSON.stringify(e)})).then(()=>{}).catch(r=>console.error("Failed to publish satisfaction.")))).catch(()=>this.authenticationService.getToken().then(t=>fetch("https://api.kabeen.io/rovers/satisfactions/_archive",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${t}`},body:JSON.stringify(e)})).then(()=>{}).catch(t=>console.error("Failed to publish satisfaction.")))}doDismiss(e){return this.authenticationService.getToken().then(t=>fetch("https://api.kabeen.io/rovers/satisfactions/dismiss/_archive",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${t}`},body:JSON.stringify(e)})).then(()=>{}).catch(t=>console.error("Failed to dismiss satisfaction in back."))}}var me={exports:{}};const fe=Pe(Object.freeze(Object.defineProperty({__proto__:null,default:{}},Symbol.toStringTag,{value:"Module"})));/**
 * [js-sha256]{@link https://github.com/emn178/js-sha256}
 *
 * @version 0.11.0
 * @author Chen, Yi-Cyuan [emn178@gmail.com]
 * @copyright Chen, Yi-Cyuan 2014-2024
 * @license MIT
 */(function(n){(function(){var e="input is invalid type",t=typeof window=="object",r=t?window:{};r.JS_SHA256_NO_WINDOW&&(t=!1);var i=!t&&typeof self=="object",s=!r.JS_SHA256_NO_NODE_JS&&typeof process=="object"&&process.versions&&process.versions.node;s?r=ge:i&&(r=self);var o=!r.JS_SHA256_NO_COMMON_JS&&!0&&n.exports,m=!r.JS_SHA256_NO_ARRAY_BUFFER&&typeof ArrayBuffer<"u",a="0123456789abcdef".split(""),T=[-2147483648,8388608,32768,128],b=[24,16,8,0],C=[1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298],B=["hex","array","digest","arrayBuffer"],F=[];(r.JS_SHA256_NO_NODE_JS||!Array.isArray)&&(Array.isArray=function(h){return Object.prototype.toString.call(h)==="[object Array]"}),m&&(r.JS_SHA256_NO_ARRAY_BUFFER_IS_VIEW||!ArrayBuffer.isView)&&(ArrayBuffer.isView=function(h){return typeof h=="object"&&h.buffer&&h.buffer.constructor===ArrayBuffer});var J=function(h,A){return function(d){return new S(A,!0).update(d)[h]()}},$=function(h){var A=J("hex",h);s&&(A=q(A,h)),A.create=function(){return new S(h)},A.update=function(f){return A.create().update(f)};for(var d=0;d<B.length;++d){var c=B[d];A[c]=J(c,h)}return A},q=function(h,A){var d=fe,c=fe.Buffer,f=A?"sha224":"sha256",l;c.from&&!r.JS_SHA256_NO_BUFFER_FROM?l=c.from:l=function(g){return new c(g)};var x=function(g){if(typeof g=="string")return d.createHash(f).update(g,"utf8").digest("hex");if(g==null)throw new Error(e);return g.constructor===ArrayBuffer&&(g=new Uint8Array(g)),Array.isArray(g)||ArrayBuffer.isView(g)||g.constructor===c?d.createHash(f).update(l(g)).digest("hex"):h(g)};return x},U=function(h,A){return function(d,c){return new K(d,A,!0).update(c)[h]()}},k=function(h){var A=U("hex",h);A.create=function(f){return new K(f,h)},A.update=function(f,l){return A.create(f).update(l)};for(var d=0;d<B.length;++d){var c=B[d];A[c]=U(c,h)}return A};function S(h,A){A?(F[0]=F[16]=F[1]=F[2]=F[3]=F[4]=F[5]=F[6]=F[7]=F[8]=F[9]=F[10]=F[11]=F[12]=F[13]=F[14]=F[15]=0,this.blocks=F):this.blocks=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],h?(this.h0=3238371032,this.h1=914150663,this.h2=812702999,this.h3=4144912697,this.h4=4290775857,this.h5=1750603025,this.h6=1694076839,this.h7=3204075428):(this.h0=1779033703,this.h1=3144134277,this.h2=1013904242,this.h3=2773480762,this.h4=1359893119,this.h5=2600822924,this.h6=528734635,this.h7=1541459225),this.block=this.start=this.bytes=this.hBytes=0,this.finalized=this.hashed=!1,this.first=!0,this.is224=h}S.prototype.update=function(h){if(!this.finalized){var A,d=typeof h;if(d!=="string"){if(d==="object"){if(h===null)throw new Error(e);if(m&&h.constructor===ArrayBuffer)h=new Uint8Array(h);else if(!Array.isArray(h)&&(!m||!ArrayBuffer.isView(h)))throw new Error(e)}else throw new Error(e);A=!0}for(var c,f=0,l,x=h.length,g=this.blocks;f<x;){if(this.hashed&&(this.hashed=!1,g[0]=this.block,this.block=g[16]=g[1]=g[2]=g[3]=g[4]=g[5]=g[6]=g[7]=g[8]=g[9]=g[10]=g[11]=g[12]=g[13]=g[14]=g[15]=0),A)for(l=this.start;f<x&&l<64;++f)g[l>>>2]|=h[f]<<b[l++&3];else for(l=this.start;f<x&&l<64;++f)c=h.charCodeAt(f),c<128?g[l>>>2]|=c<<b[l++&3]:c<2048?(g[l>>>2]|=(192|c>>>6)<<b[l++&3],g[l>>>2]|=(128|c&63)<<b[l++&3]):c<55296||c>=57344?(g[l>>>2]|=(224|c>>>12)<<b[l++&3],g[l>>>2]|=(128|c>>>6&63)<<b[l++&3],g[l>>>2]|=(128|c&63)<<b[l++&3]):(c=65536+((c&1023)<<10|h.charCodeAt(++f)&1023),g[l>>>2]|=(240|c>>>18)<<b[l++&3],g[l>>>2]|=(128|c>>>12&63)<<b[l++&3],g[l>>>2]|=(128|c>>>6&63)<<b[l++&3],g[l>>>2]|=(128|c&63)<<b[l++&3]);this.lastByteIndex=l,this.bytes+=l-this.start,l>=64?(this.block=g[16],this.start=l-64,this.hash(),this.hashed=!0):this.start=l}return this.bytes>4294967295&&(this.hBytes+=this.bytes/4294967296<<0,this.bytes=this.bytes%4294967296),this}},S.prototype.finalize=function(){if(!this.finalized){this.finalized=!0;var h=this.blocks,A=this.lastByteIndex;h[16]=this.block,h[A>>>2]|=T[A&3],this.block=h[16],A>=56&&(this.hashed||this.hash(),h[0]=this.block,h[16]=h[1]=h[2]=h[3]=h[4]=h[5]=h[6]=h[7]=h[8]=h[9]=h[10]=h[11]=h[12]=h[13]=h[14]=h[15]=0),h[14]=this.hBytes<<3|this.bytes>>>29,h[15]=this.bytes<<3,this.hash()}},S.prototype.hash=function(){var h=this.h0,A=this.h1,d=this.h2,c=this.h3,f=this.h4,l=this.h5,x=this.h6,g=this.h7,w=this.blocks,v,P,O,R,y,D,j,ee,le,de,oe;for(v=16;v<64;++v)y=w[v-15],P=(y>>>7|y<<25)^(y>>>18|y<<14)^y>>>3,y=w[v-2],O=(y>>>17|y<<15)^(y>>>19|y<<13)^y>>>10,w[v]=w[v-16]+P+w[v-7]+O<<0;for(oe=A&d,v=0;v<64;v+=4)this.first?(this.is224?(ee=300032,y=w[0]-1413257819,g=y-150054599<<0,c=y+24177077<<0):(ee=704751109,y=w[0]-210244248,g=y-1521486534<<0,c=y+143694565<<0),this.first=!1):(P=(h>>>2|h<<30)^(h>>>13|h<<19)^(h>>>22|h<<10),O=(f>>>6|f<<26)^(f>>>11|f<<21)^(f>>>25|f<<7),ee=h&A,R=ee^h&d^oe,j=f&l^~f&x,y=g+O+j+C[v]+w[v],D=P+R,g=c+y<<0,c=y+D<<0),P=(c>>>2|c<<30)^(c>>>13|c<<19)^(c>>>22|c<<10),O=(g>>>6|g<<26)^(g>>>11|g<<21)^(g>>>25|g<<7),le=c&h,R=le^c&A^ee,j=g&f^~g&l,y=x+O+j+C[v+1]+w[v+1],D=P+R,x=d+y<<0,d=y+D<<0,P=(d>>>2|d<<30)^(d>>>13|d<<19)^(d>>>22|d<<10),O=(x>>>6|x<<26)^(x>>>11|x<<21)^(x>>>25|x<<7),de=d&c,R=de^d&h^le,j=x&g^~x&f,y=l+O+j+C[v+2]+w[v+2],D=P+R,l=A+y<<0,A=y+D<<0,P=(A>>>2|A<<30)^(A>>>13|A<<19)^(A>>>22|A<<10),O=(l>>>6|l<<26)^(l>>>11|l<<21)^(l>>>25|l<<7),oe=A&d,R=oe^A&c^de,j=l&x^~l&g,y=f+O+j+C[v+3]+w[v+3],D=P+R,f=h+y<<0,h=y+D<<0,this.chromeBugWorkAround=!0;this.h0=this.h0+h<<0,this.h1=this.h1+A<<0,this.h2=this.h2+d<<0,this.h3=this.h3+c<<0,this.h4=this.h4+f<<0,this.h5=this.h5+l<<0,this.h6=this.h6+x<<0,this.h7=this.h7+g<<0},S.prototype.hex=function(){this.finalize();var h=this.h0,A=this.h1,d=this.h2,c=this.h3,f=this.h4,l=this.h5,x=this.h6,g=this.h7,w=a[h>>>28&15]+a[h>>>24&15]+a[h>>>20&15]+a[h>>>16&15]+a[h>>>12&15]+a[h>>>8&15]+a[h>>>4&15]+a[h&15]+a[A>>>28&15]+a[A>>>24&15]+a[A>>>20&15]+a[A>>>16&15]+a[A>>>12&15]+a[A>>>8&15]+a[A>>>4&15]+a[A&15]+a[d>>>28&15]+a[d>>>24&15]+a[d>>>20&15]+a[d>>>16&15]+a[d>>>12&15]+a[d>>>8&15]+a[d>>>4&15]+a[d&15]+a[c>>>28&15]+a[c>>>24&15]+a[c>>>20&15]+a[c>>>16&15]+a[c>>>12&15]+a[c>>>8&15]+a[c>>>4&15]+a[c&15]+a[f>>>28&15]+a[f>>>24&15]+a[f>>>20&15]+a[f>>>16&15]+a[f>>>12&15]+a[f>>>8&15]+a[f>>>4&15]+a[f&15]+a[l>>>28&15]+a[l>>>24&15]+a[l>>>20&15]+a[l>>>16&15]+a[l>>>12&15]+a[l>>>8&15]+a[l>>>4&15]+a[l&15]+a[x>>>28&15]+a[x>>>24&15]+a[x>>>20&15]+a[x>>>16&15]+a[x>>>12&15]+a[x>>>8&15]+a[x>>>4&15]+a[x&15];return this.is224||(w+=a[g>>>28&15]+a[g>>>24&15]+a[g>>>20&15]+a[g>>>16&15]+a[g>>>12&15]+a[g>>>8&15]+a[g>>>4&15]+a[g&15]),w},S.prototype.toString=S.prototype.hex,S.prototype.digest=function(){this.finalize();var h=this.h0,A=this.h1,d=this.h2,c=this.h3,f=this.h4,l=this.h5,x=this.h6,g=this.h7,w=[h>>>24&255,h>>>16&255,h>>>8&255,h&255,A>>>24&255,A>>>16&255,A>>>8&255,A&255,d>>>24&255,d>>>16&255,d>>>8&255,d&255,c>>>24&255,c>>>16&255,c>>>8&255,c&255,f>>>24&255,f>>>16&255,f>>>8&255,f&255,l>>>24&255,l>>>16&255,l>>>8&255,l&255,x>>>24&255,x>>>16&255,x>>>8&255,x&255];return this.is224||w.push(g>>>24&255,g>>>16&255,g>>>8&255,g&255),w},S.prototype.array=S.prototype.digest,S.prototype.arrayBuffer=function(){this.finalize();var h=new ArrayBuffer(this.is224?28:32),A=new DataView(h);return A.setUint32(0,this.h0),A.setUint32(4,this.h1),A.setUint32(8,this.h2),A.setUint32(12,this.h3),A.setUint32(16,this.h4),A.setUint32(20,this.h5),A.setUint32(24,this.h6),this.is224||A.setUint32(28,this.h7),h};function K(h,A,d){var c,f=typeof h;if(f==="string"){var l=[],x=h.length,g=0,w;for(c=0;c<x;++c)w=h.charCodeAt(c),w<128?l[g++]=w:w<2048?(l[g++]=192|w>>>6,l[g++]=128|w&63):w<55296||w>=57344?(l[g++]=224|w>>>12,l[g++]=128|w>>>6&63,l[g++]=128|w&63):(w=65536+((w&1023)<<10|h.charCodeAt(++c)&1023),l[g++]=240|w>>>18,l[g++]=128|w>>>12&63,l[g++]=128|w>>>6&63,l[g++]=128|w&63);h=l}else if(f==="object"){if(h===null)throw new Error(e);if(m&&h.constructor===ArrayBuffer)h=new Uint8Array(h);else if(!Array.isArray(h)&&(!m||!ArrayBuffer.isView(h)))throw new Error(e)}else throw new Error(e);h.length>64&&(h=new S(A,!0).update(h).array());var v=[],P=[];for(c=0;c<64;++c){var O=h[c]||0;v[c]=92^O,P[c]=54^O}S.call(this,A,d),this.update(P),this.oKeyPad=v,this.inner=!0,this.sharedMemory=d}K.prototype=new S,K.prototype.finalize=function(){if(S.prototype.finalize.call(this),this.inner){this.inner=!1;var h=this.array();S.call(this,this.is224,this.sharedMemory),this.update(this.oKeyPad),this.update(h),S.prototype.finalize.call(this)}};var W=$();W.sha256=W,W.sha224=$(!0),W.sha256.hmac=k(),W.sha224.hmac=k(!0),o?n.exports=W:(r.sha256=W.sha256,r.sha224=W.sha224)})()})(me);var Ae=me.exports;const ue=class ue{static isManaged(){return G.runtime.sendNativeMessage(this.PROXY_NATIVE_ID,new ve).then(()=>!0).catch(()=>!1)}static isReady(){return G.runtime.sendNativeMessage(this.PROXY_NATIVE_ID,new ve).then(e=>e.error===null).catch(()=>!1)}static getExtensionConfiguration(){return G.runtime.sendNativeMessage(this.PROXY_NATIVE_ID,new Ie({})).then(e=>new Promise((t,r)=>{var i;e.content!=null?t(e.content):r((i=e.error)==null?void 0:i.join(", "))}))}};ue.PROXY_NATIVE_ID="io.kabeen.yutu";let z=ue;class ve{constructor(){this.type="ping"}}class Ie{constructor(e){this.args=e,this.type="getExtensionConfiguration"}}class Re{constructor(e){this.configService=e}isAuthenticated(){return p.storage.local.get(["jwtToken"]).then(e=>e.jwtToken?Promise.resolve(!!e.jwtToken):z.isManaged().then(t=>t?z.isReady().then(r=>{if(r)return z.getExtensionConfiguration().then(i=>this.authenticate(i.apiToken).then(s=>s.isAuthenticated));throw new Error("Proxy not ready")}):p.storage.managed.get(["Authentication"]).then(r=>r&&r.Authentication&&r.Authentication.ApiToken?this.authenticate(r.Authentication.ApiToken).then(i=>i.isAuthenticated):Promise.resolve(!1)).catch(()=>Promise.resolve(!1))))}getIdentity(){return p.storage.local.get(["identity"]).then(e=>{if(e&&e.identity)return e.identity;{const t=self.crypto.randomUUID();return p.storage.local.set({identity:t}),t}})}getManagedInfos(e){return z.isManaged().then(t=>t?z.isReady().then(r=>{if(r)return z.getExtensionConfiguration().then(i=>({userId:i.userId,deviceId:i.deviceId,userName:i.userName,deviceName:i.deviceName}));throw new Error("Proxy not ready")}):p.storage.managed.get(["Authentication"]).then(r=>{if(r&&r.Authentication){let i,s,o,m;return r.Authentication.UserId&&(i=Ae.sha256.create().update(r.Authentication.UserId).hex()),r.Authentication.DeviceId&&(s=Ae.sha256.create().update(r.Authentication.DeviceId).hex()),r.Authentication.UserName&&!e&&(o=r.Authentication.UserName),r.Authentication.DeviceName&&!e&&(m=r.Authentication.DeviceName),{userId:i,deviceId:s,userName:o,deviceName:m}}else return}))}getToken(){return p.storage.local.get(["jwtToken"]).then(e=>e.jwtToken)}authenticate(e){return this.getIdentity().then(t=>fetch("https://api.kabeen.io/rovers/_authenticate",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({roverId:t,token:e})})).then(t=>t.ok?t.json().then(r=>{p.storage.local.set({jwtToken:r.token})}).then(r=>({isAuthenticated:!0})):Promise.resolve({isAuthenticated:!1,error:{code:_.NOT_AUTHORIZED,message:"Not authorized"}})).catch(t=>Promise.resolve({isAuthenticated:!1,error:{code:_.NO_INTERNET_CONNECTION,message:"No internet conenction"}}))}async setExtensionInstalled(){try{const e=await this.getToken();await fetch("https://api.kabeen.io/rovers/onboarding/_set-tenant-extension-installed",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${e}`}})}catch{return console.error("Failed to set extension installed.")}}emitAuthenticationState(e){return p.tabs.query({windowType:"normal"}).then(t=>{t.forEach(r=>{r!=null&&r.id&&p.tabs.sendMessage(r.id||0,{type:"isAuthenticated",isAuthenticated:e})})})}logout(){return p.storage.local.get(["identity"]).then(e=>p.storage.local.clear().then(()=>e&&e.identity?p.storage.local.set({identity:e.identity}):Promise.resolve()))}}const ze={"Amazon Silk":"amazon_silk","Android Browser":"android",Bada:"bada",BlackBerry:"blackberry",Chrome:"chrome",Chromium:"chromium",Electron:"electron",Epiphany:"epiphany",Firefox:"firefox",Focus:"focus",Generic:"generic","Google Search":"google_search",Googlebot:"googlebot","Internet Explorer":"ie","K-Meleon":"k_meleon",Maxthon:"maxthon","Microsoft Edge":"edge","MZ Browser":"mz","NAVER Whale Browser":"naver",Opera:"opera","Opera Coast":"opera_coast",PhantomJS:"phantomjs",Puffin:"puffin",QupZilla:"qupzilla",QQ:"qq",QQLite:"qqlite",Safari:"safari",Sailfish:"sailfish","Samsung Internet for Android":"samsung_internet",SeaMonkey:"seamonkey",Sleipnir:"sleipnir",Swing:"swing",Tizen:"tizen","UC Browser":"uc",Vivaldi:"vivaldi","WebOS Browser":"webos",WeChat:"wechat","Yandex Browser":"yandex",Roku:"roku"},be={amazon_silk:"Amazon Silk",android:"Android Browser",bada:"Bada",blackberry:"BlackBerry",chrome:"Chrome",chromium:"Chromium",electron:"Electron",epiphany:"Epiphany",firefox:"Firefox",focus:"Focus",generic:"Generic",googlebot:"Googlebot",google_search:"Google Search",ie:"Internet Explorer",k_meleon:"K-Meleon",maxthon:"Maxthon",edge:"Microsoft Edge",mz:"MZ Browser",naver:"NAVER Whale Browser",opera:"Opera",opera_coast:"Opera Coast",phantomjs:"PhantomJS",puffin:"Puffin",qupzilla:"QupZilla",qq:"QQ Browser",qqlite:"QQ Browser Lite",safari:"Safari",sailfish:"Sailfish",samsung_internet:"Samsung Internet for Android",seamonkey:"SeaMonkey",sleipnir:"Sleipnir",swing:"Swing",tizen:"Tizen",uc:"UC Browser",vivaldi:"Vivaldi",webos:"WebOS Browser",wechat:"WeChat",yandex:"Yandex Browser"},M={tablet:"tablet",mobile:"mobile",desktop:"desktop",tv:"tv"},I={WindowsPhone:"Windows Phone",Windows:"Windows",MacOS:"macOS",iOS:"iOS",Android:"Android",WebOS:"WebOS",BlackBerry:"BlackBerry",Bada:"Bada",Tizen:"Tizen",Linux:"Linux",ChromeOS:"Chrome OS",PlayStation4:"PlayStation 4",Roku:"Roku"},L={EdgeHTML:"EdgeHTML",Blink:"Blink",Trident:"Trident",Presto:"Presto",Gecko:"Gecko",WebKit:"WebKit"};class u{static getFirstMatch(e,t){const r=t.match(e);return r&&r.length>0&&r[1]||""}static getSecondMatch(e,t){const r=t.match(e);return r&&r.length>1&&r[2]||""}static matchAndReturnConst(e,t,r){if(e.test(t))return r}static getWindowsVersionName(e){switch(e){case"NT":return"NT";case"XP":return"XP";case"NT 5.0":return"2000";case"NT 5.1":return"XP";case"NT 5.2":return"2003";case"NT 6.0":return"Vista";case"NT 6.1":return"7";case"NT 6.2":return"8";case"NT 6.3":return"8.1";case"NT 10.0":return"10";default:return}}static getMacOSVersionName(e){const t=e.split(".").splice(0,2).map(r=>parseInt(r,10)||0);if(t.push(0),t[0]===10)switch(t[1]){case 5:return"Leopard";case 6:return"Snow Leopard";case 7:return"Lion";case 8:return"Mountain Lion";case 9:return"Mavericks";case 10:return"Yosemite";case 11:return"El Capitan";case 12:return"Sierra";case 13:return"High Sierra";case 14:return"Mojave";case 15:return"Catalina";default:return}}static getAndroidVersionName(e){const t=e.split(".").splice(0,2).map(r=>parseInt(r,10)||0);if(t.push(0),!(t[0]===1&&t[1]<5)){if(t[0]===1&&t[1]<6)return"Cupcake";if(t[0]===1&&t[1]>=6)return"Donut";if(t[0]===2&&t[1]<2)return"Eclair";if(t[0]===2&&t[1]===2)return"Froyo";if(t[0]===2&&t[1]>2)return"Gingerbread";if(t[0]===3)return"Honeycomb";if(t[0]===4&&t[1]<1)return"Ice Cream Sandwich";if(t[0]===4&&t[1]<4)return"Jelly Bean";if(t[0]===4&&t[1]>=4)return"KitKat";if(t[0]===5)return"Lollipop";if(t[0]===6)return"Marshmallow";if(t[0]===7)return"Nougat";if(t[0]===8)return"Oreo";if(t[0]===9)return"Pie"}}static getVersionPrecision(e){return e.split(".").length}static compareVersions(e,t,r=!1){const i=u.getVersionPrecision(e),s=u.getVersionPrecision(t);let o=Math.max(i,s),m=0;const a=u.map([e,t],T=>{const b=o-u.getVersionPrecision(T),C=T+new Array(b+1).join(".0");return u.map(C.split("."),B=>new Array(20-B.length).join("0")+B).reverse()});for(r&&(m=o-Math.min(i,s)),o-=1;o>=m;){if(a[0][o]>a[1][o])return 1;if(a[0][o]===a[1][o]){if(o===m)return 0;o-=1}else if(a[0][o]<a[1][o])return-1}}static map(e,t){const r=[];let i;if(Array.prototype.map)return Array.prototype.map.call(e,t);for(i=0;i<e.length;i+=1)r.push(t(e[i]));return r}static find(e,t){let r,i;if(Array.prototype.find)return Array.prototype.find.call(e,t);for(r=0,i=e.length;r<i;r+=1){const s=e[r];if(t(s,r))return s}}static assign(e,...t){const r=e;let i,s;if(Object.assign)return Object.assign(e,...t);for(i=0,s=t.length;i<s;i+=1){const o=t[i];typeof o=="object"&&o!==null&&Object.keys(o).forEach(a=>{r[a]=o[a]})}return e}static getBrowserAlias(e){return ze[e]}static getBrowserTypeByAlias(e){return be[e]||""}}const E=/version\/(\d+(\.?_?\d+)+)/i,je=[{test:[/googlebot/i],describe(n){const e={name:"Googlebot"},t=u.getFirstMatch(/googlebot\/(\d+(\.\d+))/i,n)||u.getFirstMatch(E,n);return t&&(e.version=t),e}},{test:[/opera/i],describe(n){const e={name:"Opera"},t=u.getFirstMatch(E,n)||u.getFirstMatch(/(?:opera)[\s/](\d+(\.?_?\d+)+)/i,n);return t&&(e.version=t),e}},{test:[/opr\/|opios/i],describe(n){const e={name:"Opera"},t=u.getFirstMatch(/(?:opr|opios)[\s/](\S+)/i,n)||u.getFirstMatch(E,n);return t&&(e.version=t),e}},{test:[/SamsungBrowser/i],describe(n){const e={name:"Samsung Internet for Android"},t=u.getFirstMatch(E,n)||u.getFirstMatch(/(?:SamsungBrowser)[\s/](\d+(\.?_?\d+)+)/i,n);return t&&(e.version=t),e}},{test:[/Whale/i],describe(n){const e={name:"NAVER Whale Browser"},t=u.getFirstMatch(E,n)||u.getFirstMatch(/(?:whale)[\s/](\d+(?:\.\d+)+)/i,n);return t&&(e.version=t),e}},{test:[/MZBrowser/i],describe(n){const e={name:"MZ Browser"},t=u.getFirstMatch(/(?:MZBrowser)[\s/](\d+(?:\.\d+)+)/i,n)||u.getFirstMatch(E,n);return t&&(e.version=t),e}},{test:[/focus/i],describe(n){const e={name:"Focus"},t=u.getFirstMatch(/(?:focus)[\s/](\d+(?:\.\d+)+)/i,n)||u.getFirstMatch(E,n);return t&&(e.version=t),e}},{test:[/swing/i],describe(n){const e={name:"Swing"},t=u.getFirstMatch(/(?:swing)[\s/](\d+(?:\.\d+)+)/i,n)||u.getFirstMatch(E,n);return t&&(e.version=t),e}},{test:[/coast/i],describe(n){const e={name:"Opera Coast"},t=u.getFirstMatch(E,n)||u.getFirstMatch(/(?:coast)[\s/](\d+(\.?_?\d+)+)/i,n);return t&&(e.version=t),e}},{test:[/opt\/\d+(?:.?_?\d+)+/i],describe(n){const e={name:"Opera Touch"},t=u.getFirstMatch(/(?:opt)[\s/](\d+(\.?_?\d+)+)/i,n)||u.getFirstMatch(E,n);return t&&(e.version=t),e}},{test:[/yabrowser/i],describe(n){const e={name:"Yandex Browser"},t=u.getFirstMatch(/(?:yabrowser)[\s/](\d+(\.?_?\d+)+)/i,n)||u.getFirstMatch(E,n);return t&&(e.version=t),e}},{test:[/ucbrowser/i],describe(n){const e={name:"UC Browser"},t=u.getFirstMatch(E,n)||u.getFirstMatch(/(?:ucbrowser)[\s/](\d+(\.?_?\d+)+)/i,n);return t&&(e.version=t),e}},{test:[/Maxthon|mxios/i],describe(n){const e={name:"Maxthon"},t=u.getFirstMatch(E,n)||u.getFirstMatch(/(?:Maxthon|mxios)[\s/](\d+(\.?_?\d+)+)/i,n);return t&&(e.version=t),e}},{test:[/epiphany/i],describe(n){const e={name:"Epiphany"},t=u.getFirstMatch(E,n)||u.getFirstMatch(/(?:epiphany)[\s/](\d+(\.?_?\d+)+)/i,n);return t&&(e.version=t),e}},{test:[/puffin/i],describe(n){const e={name:"Puffin"},t=u.getFirstMatch(E,n)||u.getFirstMatch(/(?:puffin)[\s/](\d+(\.?_?\d+)+)/i,n);return t&&(e.version=t),e}},{test:[/sleipnir/i],describe(n){const e={name:"Sleipnir"},t=u.getFirstMatch(E,n)||u.getFirstMatch(/(?:sleipnir)[\s/](\d+(\.?_?\d+)+)/i,n);return t&&(e.version=t),e}},{test:[/k-meleon/i],describe(n){const e={name:"K-Meleon"},t=u.getFirstMatch(E,n)||u.getFirstMatch(/(?:k-meleon)[\s/](\d+(\.?_?\d+)+)/i,n);return t&&(e.version=t),e}},{test:[/micromessenger/i],describe(n){const e={name:"WeChat"},t=u.getFirstMatch(/(?:micromessenger)[\s/](\d+(\.?_?\d+)+)/i,n)||u.getFirstMatch(E,n);return t&&(e.version=t),e}},{test:[/qqbrowser/i],describe(n){const e={name:/qqbrowserlite/i.test(n)?"QQ Browser Lite":"QQ Browser"},t=u.getFirstMatch(/(?:qqbrowserlite|qqbrowser)[/](\d+(\.?_?\d+)+)/i,n)||u.getFirstMatch(E,n);return t&&(e.version=t),e}},{test:[/msie|trident/i],describe(n){const e={name:"Internet Explorer"},t=u.getFirstMatch(/(?:msie |rv:)(\d+(\.?_?\d+)+)/i,n);return t&&(e.version=t),e}},{test:[/\sedg\//i],describe(n){const e={name:"Microsoft Edge"},t=u.getFirstMatch(/\sedg\/(\d+(\.?_?\d+)+)/i,n);return t&&(e.version=t),e}},{test:[/edg([ea]|ios)/i],describe(n){const e={name:"Microsoft Edge"},t=u.getSecondMatch(/edg([ea]|ios)\/(\d+(\.?_?\d+)+)/i,n);return t&&(e.version=t),e}},{test:[/vivaldi/i],describe(n){const e={name:"Vivaldi"},t=u.getFirstMatch(/vivaldi\/(\d+(\.?_?\d+)+)/i,n);return t&&(e.version=t),e}},{test:[/seamonkey/i],describe(n){const e={name:"SeaMonkey"},t=u.getFirstMatch(/seamonkey\/(\d+(\.?_?\d+)+)/i,n);return t&&(e.version=t),e}},{test:[/sailfish/i],describe(n){const e={name:"Sailfish"},t=u.getFirstMatch(/sailfish\s?browser\/(\d+(\.\d+)?)/i,n);return t&&(e.version=t),e}},{test:[/silk/i],describe(n){const e={name:"Amazon Silk"},t=u.getFirstMatch(/silk\/(\d+(\.?_?\d+)+)/i,n);return t&&(e.version=t),e}},{test:[/phantom/i],describe(n){const e={name:"PhantomJS"},t=u.getFirstMatch(/phantomjs\/(\d+(\.?_?\d+)+)/i,n);return t&&(e.version=t),e}},{test:[/slimerjs/i],describe(n){const e={name:"SlimerJS"},t=u.getFirstMatch(/slimerjs\/(\d+(\.?_?\d+)+)/i,n);return t&&(e.version=t),e}},{test:[/blackberry|\bbb\d+/i,/rim\stablet/i],describe(n){const e={name:"BlackBerry"},t=u.getFirstMatch(E,n)||u.getFirstMatch(/blackberry[\d]+\/(\d+(\.?_?\d+)+)/i,n);return t&&(e.version=t),e}},{test:[/(web|hpw)[o0]s/i],describe(n){const e={name:"WebOS Browser"},t=u.getFirstMatch(E,n)||u.getFirstMatch(/w(?:eb)?[o0]sbrowser\/(\d+(\.?_?\d+)+)/i,n);return t&&(e.version=t),e}},{test:[/bada/i],describe(n){const e={name:"Bada"},t=u.getFirstMatch(/dolfin\/(\d+(\.?_?\d+)+)/i,n);return t&&(e.version=t),e}},{test:[/tizen/i],describe(n){const e={name:"Tizen"},t=u.getFirstMatch(/(?:tizen\s?)?browser\/(\d+(\.?_?\d+)+)/i,n)||u.getFirstMatch(E,n);return t&&(e.version=t),e}},{test:[/qupzilla/i],describe(n){const e={name:"QupZilla"},t=u.getFirstMatch(/(?:qupzilla)[\s/](\d+(\.?_?\d+)+)/i,n)||u.getFirstMatch(E,n);return t&&(e.version=t),e}},{test:[/firefox|iceweasel|fxios/i],describe(n){const e={name:"Firefox"},t=u.getFirstMatch(/(?:firefox|iceweasel|fxios)[\s/](\d+(\.?_?\d+)+)/i,n);return t&&(e.version=t),e}},{test:[/electron/i],describe(n){const e={name:"Electron"},t=u.getFirstMatch(/(?:electron)\/(\d+(\.?_?\d+)+)/i,n);return t&&(e.version=t),e}},{test:[/MiuiBrowser/i],describe(n){const e={name:"Miui"},t=u.getFirstMatch(/(?:MiuiBrowser)[\s/](\d+(\.?_?\d+)+)/i,n);return t&&(e.version=t),e}},{test:[/chromium/i],describe(n){const e={name:"Chromium"},t=u.getFirstMatch(/(?:chromium)[\s/](\d+(\.?_?\d+)+)/i,n)||u.getFirstMatch(E,n);return t&&(e.version=t),e}},{test:[/chrome|crios|crmo/i],describe(n){const e={name:"Chrome"},t=u.getFirstMatch(/(?:chrome|crios|crmo)\/(\d+(\.?_?\d+)+)/i,n);return t&&(e.version=t),e}},{test:[/GSA/i],describe(n){const e={name:"Google Search"},t=u.getFirstMatch(/(?:GSA)\/(\d+(\.?_?\d+)+)/i,n);return t&&(e.version=t),e}},{test(n){const e=!n.test(/like android/i),t=n.test(/android/i);return e&&t},describe(n){const e={name:"Android Browser"},t=u.getFirstMatch(E,n);return t&&(e.version=t),e}},{test:[/playstation 4/i],describe(n){const e={name:"PlayStation 4"},t=u.getFirstMatch(E,n);return t&&(e.version=t),e}},{test:[/safari|applewebkit/i],describe(n){const e={name:"Safari"},t=u.getFirstMatch(E,n);return t&&(e.version=t),e}},{test:[/.*/i],describe(n){const e=/^(.*)\/(.*) /,t=/^(.*)\/(.*)[ \t]\((.*)/,i=n.search("\\(")!==-1?t:e;return{name:u.getFirstMatch(i,n),version:u.getSecondMatch(i,n)}}}],We=[{test:[/Roku\/DVP/],describe(n){const e=u.getFirstMatch(/Roku\/DVP-(\d+\.\d+)/i,n);return{name:I.Roku,version:e}}},{test:[/windows phone/i],describe(n){const e=u.getFirstMatch(/windows phone (?:os)?\s?(\d+(\.\d+)*)/i,n);return{name:I.WindowsPhone,version:e}}},{test:[/windows /i],describe(n){const e=u.getFirstMatch(/Windows ((NT|XP)( \d\d?.\d)?)/i,n),t=u.getWindowsVersionName(e);return{name:I.Windows,version:e,versionName:t}}},{test:[/Macintosh(.*?) FxiOS(.*?)\//],describe(n){const e={name:I.iOS},t=u.getSecondMatch(/(Version\/)(\d[\d.]+)/,n);return t&&(e.version=t),e}},{test:[/macintosh/i],describe(n){const e=u.getFirstMatch(/mac os x (\d+(\.?_?\d+)+)/i,n).replace(/[_\s]/g,"."),t=u.getMacOSVersionName(e),r={name:I.MacOS,version:e};return t&&(r.versionName=t),r}},{test:[/(ipod|iphone|ipad)/i],describe(n){const e=u.getFirstMatch(/os (\d+([_\s]\d+)*) like mac os x/i,n).replace(/[_\s]/g,".");return{name:I.iOS,version:e}}},{test(n){const e=!n.test(/like android/i),t=n.test(/android/i);return e&&t},describe(n){const e=u.getFirstMatch(/android[\s/-](\d+(\.\d+)*)/i,n),t=u.getAndroidVersionName(e),r={name:I.Android,version:e};return t&&(r.versionName=t),r}},{test:[/(web|hpw)[o0]s/i],describe(n){const e=u.getFirstMatch(/(?:web|hpw)[o0]s\/(\d+(\.\d+)*)/i,n),t={name:I.WebOS};return e&&e.length&&(t.version=e),t}},{test:[/blackberry|\bbb\d+/i,/rim\stablet/i],describe(n){const e=u.getFirstMatch(/rim\stablet\sos\s(\d+(\.\d+)*)/i,n)||u.getFirstMatch(/blackberry\d+\/(\d+([_\s]\d+)*)/i,n)||u.getFirstMatch(/\bbb(\d+)/i,n);return{name:I.BlackBerry,version:e}}},{test:[/bada/i],describe(n){const e=u.getFirstMatch(/bada\/(\d+(\.\d+)*)/i,n);return{name:I.Bada,version:e}}},{test:[/tizen/i],describe(n){const e=u.getFirstMatch(/tizen[/\s](\d+(\.\d+)*)/i,n);return{name:I.Tizen,version:e}}},{test:[/linux/i],describe(){return{name:I.Linux}}},{test:[/CrOS/],describe(){return{name:I.ChromeOS}}},{test:[/PlayStation 4/],describe(n){const e=u.getFirstMatch(/PlayStation 4[/\s](\d+(\.\d+)*)/i,n);return{name:I.PlayStation4,version:e}}}],$e=[{test:[/googlebot/i],describe(){return{type:"bot",vendor:"Google"}}},{test:[/huawei/i],describe(n){const e=u.getFirstMatch(/(can-l01)/i,n)&&"Nova",t={type:M.mobile,vendor:"Huawei"};return e&&(t.model=e),t}},{test:[/nexus\s*(?:7|8|9|10).*/i],describe(){return{type:M.tablet,vendor:"Nexus"}}},{test:[/ipad/i],describe(){return{type:M.tablet,vendor:"Apple",model:"iPad"}}},{test:[/Macintosh(.*?) FxiOS(.*?)\//],describe(){return{type:M.tablet,vendor:"Apple",model:"iPad"}}},{test:[/kftt build/i],describe(){return{type:M.tablet,vendor:"Amazon",model:"Kindle Fire HD 7"}}},{test:[/silk/i],describe(){return{type:M.tablet,vendor:"Amazon"}}},{test:[/tablet(?! pc)/i],describe(){return{type:M.tablet}}},{test(n){const e=n.test(/ipod|iphone/i),t=n.test(/like (ipod|iphone)/i);return e&&!t},describe(n){const e=u.getFirstMatch(/(ipod|iphone)/i,n);return{type:M.mobile,vendor:"Apple",model:e}}},{test:[/nexus\s*[0-6].*/i,/galaxy nexus/i],describe(){return{type:M.mobile,vendor:"Nexus"}}},{test:[/[^-]mobi/i],describe(){return{type:M.mobile}}},{test(n){return n.getBrowserName(!0)==="blackberry"},describe(){return{type:M.mobile,vendor:"BlackBerry"}}},{test(n){return n.getBrowserName(!0)==="bada"},describe(){return{type:M.mobile}}},{test(n){return n.getBrowserName()==="windows phone"},describe(){return{type:M.mobile,vendor:"Microsoft"}}},{test(n){const e=Number(String(n.getOSVersion()).split(".")[0]);return n.getOSName(!0)==="android"&&e>=3},describe(){return{type:M.tablet}}},{test(n){return n.getOSName(!0)==="android"},describe(){return{type:M.mobile}}},{test(n){return n.getOSName(!0)==="macos"},describe(){return{type:M.desktop,vendor:"Apple"}}},{test(n){return n.getOSName(!0)==="windows"},describe(){return{type:M.desktop}}},{test(n){return n.getOSName(!0)==="linux"},describe(){return{type:M.desktop}}},{test(n){return n.getOSName(!0)==="playstation 4"},describe(){return{type:M.tv}}},{test(n){return n.getOSName(!0)==="roku"},describe(){return{type:M.tv}}}],qe=[{test(n){return n.getBrowserName(!0)==="microsoft edge"},describe(n){if(/\sedg\//i.test(n))return{name:L.Blink};const t=u.getFirstMatch(/edge\/(\d+(\.?_?\d+)+)/i,n);return{name:L.EdgeHTML,version:t}}},{test:[/trident/i],describe(n){const e={name:L.Trident},t=u.getFirstMatch(/trident\/(\d+(\.?_?\d+)+)/i,n);return t&&(e.version=t),e}},{test(n){return n.test(/presto/i)},describe(n){const e={name:L.Presto},t=u.getFirstMatch(/presto\/(\d+(\.?_?\d+)+)/i,n);return t&&(e.version=t),e}},{test(n){const e=n.test(/gecko/i),t=n.test(/like gecko/i);return e&&!t},describe(n){const e={name:L.Gecko},t=u.getFirstMatch(/gecko\/(\d+(\.?_?\d+)+)/i,n);return t&&(e.version=t),e}},{test:[/(apple)?webkit\/537\.36/i],describe(){return{name:L.Blink}}},{test:[/(apple)?webkit/i],describe(n){const e={name:L.WebKit},t=u.getFirstMatch(/webkit\/(\d+(\.?_?\d+)+)/i,n);return t&&(e.version=t),e}}];class xe{constructor(e,t=!1){if(e==null||e==="")throw new Error("UserAgent parameter can't be empty");this._ua=e,this.parsedResult={},t!==!0&&this.parse()}getUA(){return this._ua}test(e){return e.test(this._ua)}parseBrowser(){this.parsedResult.browser={};const e=u.find(je,t=>{if(typeof t.test=="function")return t.test(this);if(t.test instanceof Array)return t.test.some(r=>this.test(r));throw new Error("Browser's test function is not valid")});return e&&(this.parsedResult.browser=e.describe(this.getUA())),this.parsedResult.browser}getBrowser(){return this.parsedResult.browser?this.parsedResult.browser:this.parseBrowser()}getBrowserName(e){return e?String(this.getBrowser().name).toLowerCase()||"":this.getBrowser().name||""}getBrowserVersion(){return this.getBrowser().version}getOS(){return this.parsedResult.os?this.parsedResult.os:this.parseOS()}parseOS(){this.parsedResult.os={};const e=u.find(We,t=>{if(typeof t.test=="function")return t.test(this);if(t.test instanceof Array)return t.test.some(r=>this.test(r));throw new Error("Browser's test function is not valid")});return e&&(this.parsedResult.os=e.describe(this.getUA())),this.parsedResult.os}getOSName(e){const{name:t}=this.getOS();return e?String(t).toLowerCase()||"":t||""}getOSVersion(){return this.getOS().version}getPlatform(){return this.parsedResult.platform?this.parsedResult.platform:this.parsePlatform()}getPlatformType(e=!1){const{type:t}=this.getPlatform();return e?String(t).toLowerCase()||"":t||""}parsePlatform(){this.parsedResult.platform={};const e=u.find($e,t=>{if(typeof t.test=="function")return t.test(this);if(t.test instanceof Array)return t.test.some(r=>this.test(r));throw new Error("Browser's test function is not valid")});return e&&(this.parsedResult.platform=e.describe(this.getUA())),this.parsedResult.platform}getEngine(){return this.parsedResult.engine?this.parsedResult.engine:this.parseEngine()}getEngineName(e){return e?String(this.getEngine().name).toLowerCase()||"":this.getEngine().name||""}parseEngine(){this.parsedResult.engine={};const e=u.find(qe,t=>{if(typeof t.test=="function")return t.test(this);if(t.test instanceof Array)return t.test.some(r=>this.test(r));throw new Error("Browser's test function is not valid")});return e&&(this.parsedResult.engine=e.describe(this.getUA())),this.parsedResult.engine}parse(){return this.parseBrowser(),this.parseOS(),this.parsePlatform(),this.parseEngine(),this}getResult(){return u.assign({},this.parsedResult)}satisfies(e){const t={};let r=0;const i={};let s=0;if(Object.keys(e).forEach(m=>{const a=e[m];typeof a=="string"?(i[m]=a,s+=1):typeof a=="object"&&(t[m]=a,r+=1)}),r>0){const m=Object.keys(t),a=u.find(m,b=>this.isOS(b));if(a){const b=this.satisfies(t[a]);if(b!==void 0)return b}const T=u.find(m,b=>this.isPlatform(b));if(T){const b=this.satisfies(t[T]);if(b!==void 0)return b}}if(s>0){const m=Object.keys(i),a=u.find(m,T=>this.isBrowser(T,!0));if(a!==void 0)return this.compareVersion(i[a])}}isBrowser(e,t=!1){const r=this.getBrowserName().toLowerCase();let i=e.toLowerCase();const s=u.getBrowserTypeByAlias(i);return t&&s&&(i=s.toLowerCase()),i===r}compareVersion(e){let t=[0],r=e,i=!1;const s=this.getBrowserVersion();if(typeof s=="string")return e[0]===">"||e[0]==="<"?(r=e.substr(1),e[1]==="="?(i=!0,r=e.substr(2)):t=[],e[0]===">"?t.push(1):t.push(-1)):e[0]==="="?r=e.substr(1):e[0]==="~"&&(i=!0,r=e.substr(1)),t.indexOf(u.compareVersions(s,r,i))>-1}isOS(e){return this.getOSName(!0)===String(e).toLowerCase()}isPlatform(e){return this.getPlatformType(!0)===String(e).toLowerCase()}isEngine(e){return this.getEngineName(!0)===String(e).toLowerCase()}is(e,t=!1){return this.isBrowser(e,t)||this.isOS(e)||this.isPlatform(e)}some(e=[]){return e.some(t=>this.is(t))}}/*!
 * Bowser - a browser detector
 * https://github.com/lancedikson/bowser
 * MIT License | (c) Dustin Diaz 2012-2015
 * MIT License | (c) Denis Demchenko 2015-2019
 */class we{static getParser(e,t=!1){if(typeof e!="string")throw new Error("UserAgent should be a string");return new xe(e,t)}static parse(e){return new xe(e).getResult()}static get BROWSER_MAP(){return be}static get ENGINE_MAP(){return L}static get OS_MAP(){return I}static get PLATFORMS_MAP(){return M}}class Ue{async getOrganization(){return z.isManaged().then(e=>e?z.isReady().then(t=>{if(t)return z.getExtensionConfiguration().then(r=>({structure:r.structureId,businessUnit:r.teamId}));throw new Error("Proxy not ready")}):p.storage.managed.get(["Authentication"]).then(t=>t&&t.Authentication&&t.Authentication.StructureId&&t.Authentication.TeamId?Promise.resolve({structure:t.Authentication.StructureId,businessUnit:t.Authentication.TeamId}):p.storage.local.get(["organization"]).then(r=>r.organization)).catch(()=>p.storage.local.get(["organization"]).then(t=>t.organization)))}isManaged(){return z.isManaged().then(e=>e?!0:p.storage.managed.get(["Authentication"]).then(t=>t&&t.Authentication?t&&t.Authentication:!1).catch(()=>!1)).catch(e=>Promise.reject(e))}isIncognito(){return p.storage.local.get(["tenantSettings"]).then(e=>e&&e.tenantSettings?!e.tenantSettings.displayRover:!0)}setOrganization(e){return p.storage.local.set({organization:e})}clearOrganization(){return p.storage.local.remove(["organization"])}updateDockPreferences(e,t){return p.storage.local.set({dock:e}).then(r=>(p.tabs.query({windowType:"normal"}).then(i=>{i.forEach(s=>{var o;((o=s==null?void 0:s.id)==null?void 0:o.toString())!==t&&p.tabs.sendMessage(s.id||0,{type:"updateDockPreferences",dockPreferences:e}).catch(()=>{})})}),e))}getDockPreferences(){return p.storage.local.get(["dock"]).then(e=>e.dock)}getPauseState(){return p.storage.local.get(["paused_until"]).then(e=>{const t=e.paused_until;if(t){const r=new Date,i=new Date(t);return{isPaused:r.getTime()<i.getTime(),until:i}}else return{isPaused:!1}})}pause(e,t){if(t)return p.storage.local.set({paused_until:new Date(t).toJSON()}).then(r=>({isPaused:!0,until:t}));{const r=new Date;return r.setMinutes(r.getMinutes()+60*e),p.storage.local.set({paused_until:r.toJSON()}).then(i=>({isPaused:!0,until:r}))}}unpause(){return p.storage.local.remove(["paused_until"]).then(e=>({isPaused:!1}))}getPlatformInfo(){return p.runtime.getPlatformInfo().then(e=>e.os)}getBrowserInfo(){const e=we.getParser(navigator.userAgent).getBrowserName(),t=we.getParser(navigator.userAgent).getBrowserVersion();return{browser:e,version:t}}getExtensionVersion(){return p.runtime.getManifest().version}getPlatformBrowserAndExtensionInfo(){return Promise.all([this.getPlatformInfo(),this.getBrowserInfo(),this.getExtensionVersion()])}}class Le{constructor(e){this.authenticationService=e}async get(){return this.authenticationService.getToken().then(e=>fetch("https://api.kabeen.io/rovers/organizations",{method:"GET",headers:{"Content-Type":"application/json",Authorization:`Bearer ${e}`}})).then(e=>e.ok?e.json().then(t=>({body:t.organization})):this.authenticationService.logout().then(()=>e.text().then(t=>({error:{code:_.NOT_AUTHORIZED,message:t}})))).catch(e=>({error:{code:_.NO_INTERNET_CONNECTION,message:"err"}}))}}class Ve{constructor(e){this.authenticationService=e}getSettings(){return this.authenticationService.getToken().then(e=>fetch("https://api.kabeen.io/rovers/tenant",{method:"GET",headers:{"Content-Type":"application/json",Authorization:`Bearer ${e}`}})).then(e=>e.ok?e.json().then(t=>({body:t.tenant})):e.text().then(t=>({error:{code:_.NOT_AUTHORIZED,message:t}}))).catch(e=>({error:{code:_.NO_INTERNET_CONNECTION,message:e.message}}))}}class He{constructor(){this.elements={},this.head=0,this.tail=0}enqueue(e){this.elements[this.tail]=e,this.tail++}dequeue(){const e=this.elements[this.head];return delete this.elements[this.head],this.head++,e}dequeueAll(){const e=[];for(;!this.isEmpty;){const t=this.dequeue();t&&e.push(t)}return e}peek(){return this.elements[this.head]}get length(){return this.tail-this.head}get isEmpty(){return this.length===0}}class Je{constructor(e,t){this.authenticationService=e,this.configService=t,this.outQueue=new He}publish(e){this.outQueue.enqueue(e)}runBatch(){const t=this.removeDuplicate(this.outQueue.dequeueAll()).map(r=>this.doPublish(r));return Promise.all(t)}doPublish(e){if(e.applications&&e.applications.length>0)e.applications.forEach(t=>{const r={timestamp:e.timestamp,weekend:e.weekend,businessUnit:e.businessUnit,structure:e.structure,title:e.title,url:e.url,fqdn:e.fqdn,domain:e.domain,name:e.name,path:e.path,applicationId:t,managedInfos:e.managedInfos};this.configService.getPlatformBrowserAndExtensionInfo().then(i=>(r.os=i[0],r.browserName=i[1].browser,r.browserVersion=i[1].version,r.extensionVersion=i[2],this.authenticationService.getToken().then(s=>fetch("https://api.kabeen.io/rovers/usages/_archive",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${s}`},body:JSON.stringify(r)})).catch(s=>console.error("Failed to publish visited URL.")))).catch(()=>this.authenticationService.getToken().then(i=>fetch("https://api.kabeen.io/rovers/usages/_archive",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${i}`},body:JSON.stringify(r)})).catch(i=>console.error("Failed to publish visited URL.")))});else{const t={timestamp:e.timestamp,weekend:e.weekend,businessUnit:e.businessUnit,structure:e.structure,title:e.title,url:e.url,fqdn:e.fqdn,domain:e.domain,name:e.name,path:e.path,managedInfos:e.managedInfos};return this.configService.getPlatformBrowserAndExtensionInfo().then(r=>(t.os=r[0],t.browserName=r[1].browser,t.browserVersion=r[1].version,t.extensionVersion=r[2],this.authenticationService.getToken().then(i=>fetch("https://api.kabeen.io/rovers/usages/_archive",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${i}`},body:JSON.stringify(t)})).catch(i=>console.error("Failed to publish visited URL.")))).catch(()=>this.authenticationService.getToken().then(r=>fetch("https://api.kabeen.io/rovers/usages/_archive",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${r}`},body:JSON.stringify(t)})).catch(r=>console.error("Failed to publish visited URL.")))}return Promise.resolve()}removeDuplicate(e){const t=e.sort((i,s)=>i.timestamp>s.timestamp?1:-1),r=new Map;return t.forEach(i=>{var s;if(i.domain&&r.has(i.domain))(s=r.get(i.domain))==null||s.set(i.path||"/",i);else if(i.domain&&!r.has(i.domain)){const o=new Map;o.set(i.path,i),r.set(i.domain,o)}}),Array.from(r.values()).flatMap(i=>Array.from(i.values()))}}class Q{static build(e,t,r){const i=e.url?this.sanitize(e.url):void 0,s=e.title?Q.sanitize(e.title):void 0,o=i?new URL(i):void 0,m=o?this.extractURLData(o):void 0,a=new Date().getDay()===0||new Date().getDay()===6;return{timestamp:Date.now(),weekend:a,structure:t,businessUnit:r,title:s,url:e.url,fqdn:o==null?void 0:o.hostname,domain:m==null?void 0:m.domain,name:m==null?void 0:m.name,path:o==null?void 0:o.pathname}}static buildVisitedUrlFromUrl(e,t,r){const i=this.sanitize(e),s=new URL(i),o=this.extractURLData(s),m=new Date().getDay()===0||new Date().getDay()===6;return{timestamp:Date.now(),weekend:m,structure:t,businessUnit:r,url:e,fqdn:s==null?void 0:s.hostname,domain:o==null?void 0:o.domain,name:o==null?void 0:o.name,path:s==null?void 0:s.pathname}}static extractURLData(e){var o;const t=e.hostname.split("."),r=t.length;let i,s;return r>=2&&(r===4&&t[2].length===2||r===3&&((o=t[r-2])==null?void 0:o.length)<=3?(i=`${t[r-3]}.${t[r-2]}.${t[r-1]}`,s=t[r-3]):(i=`${t[r-2]}.${t[r-1]}`,s=t[r-2])),{domain:i,name:s}}static sanitize(e){const t=/(([^<>()[\]\\.,;:\s@"]+(\.[^<>()[\]\\.,;:\s@"]+)*)|(".+"))@((\[\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3}\])|(([a-z\-0-9]+\.)+[a-z]{2,}))/i;return e.replace(t,"**hidden email**")}}var Y=(n=>(n[n.monthly=1]="monthly",n[n.quarterly=3]="quarterly",n[n.annually=12]="annually",n))(Y||{});class Ge{constructor(e){this.authenticationService=e}changeSideBar(e){return p.tabs.query({active:!0}).then(t=>{t.forEach(r=>{r.id!=null&&p.tabs.sendMessage(r.id,{type:"changeSideBar",sideBarType:e})})})}refreshSettings(){return p.tabs.query({windowType:"normal"}).then(e=>{e.forEach(t=>{t.id!=null&&p.tabs.sendMessage(t.id,{type:"refreshSettings"})})})}async setExtensionSettings(){const e=await this.authenticationService.getToken();if(e===void 0)return Promise.resolve();fetch("https://api.kabeen.io/rovers/settings",{method:"GET",headers:{"Content-Type":"application/json",Authorization:`Bearer ${e}`}}).then(async t=>{if(t.ok){const i=(await t.json()).settings,s=i.satisfactionFrequency==="monthly"?Y.monthly:i.satisfactionFrequency==="quarterly"?Y.quarterly:Y.annually;await this.setLocalStorageSettings({activated:i.satisfactionActivated,frequency:s,initialDelay:10,retryDelay:86400,supportUrlActivated:i.supportUrlActivated,supportUrl:i.supportUrl,displayRover:i.displayRover,publicLogoUrl:i.publicLogoUrl,incognito:i.incognito})}else return Promise.resolve()})}setLocalStorageSettings(e){return p.storage.local.set({tenantSettings:e}).then(()=>this.refreshTenantSettings(e))}refreshTenantSettings(e){return p.tabs.query({windowType:"normal"}).then(t=>{t.forEach(r=>{r.id!=null&&p.tabs.sendMessage(r.id,{type:"refreshTenantSettings",settings:e})})})}getLocalStorageSettings(){return p.storage.local.get(["tenantSettings"]).then(e=>e&&e.tenantSettings?e.tenantSettings:{activated:!1,frequency:Y.monthly,retryDelay:86400,initialDelay:10,supportUrlActivated:!1,supportUrl:"",displayRover:!1,publicLogoUrl:"",incognito:!1})}getLocaStorageSettingsResponse(){return this.getLocalStorageSettings().then(e=>({body:e})).catch(e=>({error:e}))}}function Z(n,e){if(n.length!==e.length)return!1;const t=new Set(n),r=new Set(e);if(t.size!==r.size)return!1;for(const i of t)if(!r.has(i))return!1;return!0}class Ze{constructor(e,t){this.configService=e,this.authenticationService=t,this.timers=new ae("timers",r=>JSON.parse(JSON.stringify(r))),this.windows=new ae("windows",r=>JSON.parse(JSON.stringify(r)))}sendFocusedMessage(e){return p.tabs.sendMessage(e,{type:"focused"})}sendUnfocusedMessage(e){return p.tabs.sendMessage(e,{type:"unfocused"})}createEmptyWindow(e){return this.windows.set(e.toString(),{id:e,tabs:[]})}addTabToWindow(e,t,r){const i=this.windows.get(e.toString());return i?(i.tabs.push({id:t,applications:r}),this.windows.set(e.toString(),i)):this.createEmptyWindow(e).then(()=>{const s=this.windows.get(e.toString());if(s)return s.tabs.push({id:t,applications:r}),this.windows.set(e.toString(),s)})}changeWindowTabApplications(e,t,r){if(t){const i=this.windows.get(t.toString());return i?(i.tabs=i.tabs.map(s=>(s.id===e&&(s.applications=r),s)),this.windows.set(t.toString(),i)):this.createEmptyWindow(t).then(()=>{const s=this.windows.get(t.toString());if(s)return s.tabs=s.tabs.map(o=>(o.id===e&&(o.applications=r),o)),this.windows.set(t.toString(),s)})}return Promise.resolve()}removeTabFromWindow(e,t){const r=this.windows.get(e.toString());return r?(r.tabs=r.tabs.filter(i=>i.id!==t),r.tabs.length===0?this.windows.delete(e.toString()):this.windows.set(e.toString(),r)):Promise.resolve()}getWindows(){const e=[];return this.windows.forEach(t=>e.push(t)),e}getWindow(e){if(e)return this.windows.get(e.toString())}getWindowTab(e,t){if(t){const r=this.windows.get(t.toString());if(r)return r.tabs.find(i=>i.id===e)}}clearWindows(){return this.windows.clear().then(()=>{console.log("Cleared all windows")})}deleteWindow(e){return this.windows.delete(e.toString())}getAllTabsExceptCurrentWhereSameApplications(e,t,r){const i=[];return this.windows.forEach(s=>{s.id!==r?s.tabs.forEach(o=>{o.applications&&Z(o.applications,e)&&o.id!==t&&i.push(o.id)}):s.tabs.forEach(o=>{o.applications&&Z(o.applications,e)&&o.id!==t&&i.push(o.id)})}),i}storeTemporaryDetachedTab(e,t){return p.storage.local.set({temporaryDetachedTab:{applications:t,tabId:e}})}getTemporaryDetachedTab(){return p.storage.local.get(["temporaryDetachedTab"])}deleteTemporaryDetachedTab(){return p.storage.local.remove(["temporaryDetachedTab"])}deleteApplicationTimer(e){return this.timers.delete(e).then(()=>{console.log(`Timer for app ${e} deleted`)})}getTimerByApplicationId(e){return this.timers.get(e)}clearApplicationTimers(){return this.timers.clear().then(()=>{console.log("Cleared all application timers")})}incrementApplicationTimer(e){return e.forEach(t=>{const r=this.timers.get(t),i=Date.now();if(r)r.timer+=1,r.endDate=i,r.paused=!1,this.timers.set(t,r);else{const s={timer:1,paused:!1,timeoutCount:0,applicationId:t,sent:!1,startDate:i,endDate:i};this.timers.set(t,s)}}),Promise.resolve()}timeoutApplicationTimer(e){return e.forEach(t=>{const r=this.timers.get(t);r&&(r.timer=r.timer>1200?r.timer-1200:0,r.timeoutCount+=1,r.paused=!0,this.timers.set(t,r))}),Promise.resolve()}sendActivityData(e){return this.configService.getOrganization().then(t=>{if(t&&t.businessUnit&&t.structure){const r=e.filter(i=>!i.sent&&i.startDate&&i.endDate&&i.timer>60).map(i=>{let s=!1;return i.startDate&&(s=new Date(i.startDate).getDay()===6||new Date(i.startDate).getDay()===0),{startDate:i.startDate,endDate:i.endDate,timer:i.timer,timeoutCount:i.timeoutCount,structure:t.structure,businessUnit:t.businessUnit,applicationId:i.applicationId,weekend:s}});if(r.length>0)return this.configService.getPlatformBrowserAndExtensionInfo().then(i=>(r.forEach(s=>{s.os=i[0],s.browserName=i[1].browser,s.browserVersion=i[1].version,s.extensionVersion=i[2]}),this.authenticationService.getToken().then(s=>fetch("https://api.kabeen.io/rovers/user-activity/_archive",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${s}`},body:JSON.stringify(r)}).then(o=>(console.log("Activity data sent"),Promise.resolve())).catch(o=>{console.error(o)})).catch(s=>{console.error(s)}))).catch(()=>this.authenticationService.getToken().then(i=>fetch("https://api.kabeen.io/rovers/user-activity/_archive",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${i}`},body:JSON.stringify(r)}).then(s=>(console.log("Activity data sent"),Promise.resolve())).catch(s=>{console.error(s)})).catch(i=>{console.error(i)}))}return Promise.resolve().then(()=>{console.log("No activity data to send")})})}pauseTimer(e){return p.tabs.sendMessage(e,{type:"pauseTimer"})}}const Ke=chrome.tabs.TAB_ID_NONE;class Qe{constructor(e,t){this.configService=e,this.authenticationService=t,this.announcementClient=new Ye(t)}getAnnouncements(e,t=!0){return!t&&this.announcements?Promise.resolve({body:JSON.parse(JSON.stringify(this.announcements))}):this.announcementClient.getAnnouncements(e).then(r=>(r.body&&(this.announcements=r.body.map(i=>(i.createdAt=new Date(i.createdAt),i.updatedAt=new Date(i.updatedAt),i))),{body:JSON.parse(JSON.stringify(r.body))}))}updateAnnouncements(){return this.configService.getOrganization().then(e=>{if(e&&e.businessUnit)return this.getAnnouncements(e.businessUnit,!0).then(t=>{if(t.body)return p.tabs.query({windowType:"normal"}).then(r=>r.map(i=>i.id!==Ke?p.tabs.sendMessage(i.id||0,{type:"updateAnnouncements"}).catch():Promise.resolve())).then(r=>Promise.resolve())})})}getPopupAnnouncement(e){return this.announcementClient.getAnnouncements(e).then(t=>{if(t.body){const r=t.body.find(i=>!i.seen);if(r)return p.tabs.query({windowType:"normal"}).then(i=>{i.forEach(s=>{s!=null&&s.id&&p.tabs.sendMessage(s.id,{type:"popupAnnouncement",announcement:r})})}).then(i=>{this.announcementClient.markAllAnnouncementAsSeen(e)})}})}dismissAnnouncement(){return p.tabs.query({windowType:"normal"}).then(e=>{e.forEach(t=>{t!=null&&t.id&&p.tabs.sendMessage(t.id,{type:"dismissAnnouncement"})})})}markAnnouncementAsSeen(e){return this.announcementClient.markAnnouncementAsSeen(e)}likeDislikeAnnouncement(e,t){return this.announcementClient.likeDislikeAnnouncement(e,t)}}class Ye{constructor(e){this.authenticationService=e}likeDislikeAnnouncement(e,t){return this.authenticationService.getToken().then(r=>fetch(`https://api.kabeen.io/rovers/announcements/${e}/like`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${r}`},body:JSON.stringify({status:t})})).then(r=>r.ok?Promise.resolve({}):r.text().then(i=>({error:{code:_.NOT_AUTHORIZED,message:i}}))).catch(r=>({error:{code:_.NO_INTERNET_CONNECTION,message:"err"}}))}getAnnouncements(e){return this.authenticationService.getToken().then(t=>fetch(`https://api.kabeen.io/rovers/organizations/${e}/announcements`,{method:"GET",headers:{"Content-Type":"application/json",Authorization:`Bearer ${t}`}})).then(t=>t.ok?t.json().then(r=>({body:r})):t.text().then(r=>({error:{code:_.NOT_AUTHORIZED,message:r}}))).catch(t=>({error:{code:_.NO_INTERNET_CONNECTION,message:"err"}}))}markAnnouncementAsSeen(e){return this.authenticationService.getToken().then(t=>fetch(`https://api.kabeen.io/rovers/announcements/${e}/seen`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${t}`}})).then(t=>t.ok?Promise.resolve({}):t.text().then(r=>({error:{code:_.NOT_AUTHORIZED,message:r}}))).catch(t=>({error:{code:_.NO_INTERNET_CONNECTION,message:"err"}}))}markAllAnnouncementAsSeen(e){return this.authenticationService.getToken().then(t=>fetch(`https://api.kabeen.io/rovers/organizations/${e}/announcements/seen`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${t}`}})).then(t=>t.ok?Promise.resolve({}):t.text().then(r=>({error:{code:_.NOT_AUTHORIZED,message:r}}))).catch(t=>({error:{code:_.NO_INTERNET_CONNECTION,message:"err"}}))}}class Xe{constructor(e){this.STORAGE_KEY=e,this.items=[],this.loadFromStorage()}enqueue(e){this.items.push(e),this.saveToStorage()}dequeue(){const e=this.items.shift();return this.saveToStorage(),e}dequeueAll(){const e=this.items.slice();return this.items=[],this.saveToStorage(),e}size(){return this.items.length}loadFromStorage(){G.storage.local.get(this.STORAGE_KEY).then(t=>{this.items=t[this.STORAGE_KEY]||[]})}saveToStorage(){const e={[this.STORAGE_KEY]:this.items};G.storage.local.set(e)}}class et{constructor(e,t){this.authenticationService=e,this.configService=t,this.queue=new Xe("availabilityQueue")}publish(e){this.queue.size()>=4096&&this.queue.dequeue(),this.queue.enqueue(e)}async runBatch(){const t=this.queue.dequeueAll().map(r=>this.doPublish(r));return Promise.all(t)}doPublish(e){return this.configService.getPlatformBrowserAndExtensionInfo().then(t=>(e.os=t[0],e.browserName=t[1].browser,e.browserVersion=t[1].version,e.extensionVersion=t[2],this.authenticationService.getToken().then(r=>fetch("https://api.kabeen.io/rovers/availability/_archive",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${r}`},body:JSON.stringify(e)})).catch(r=>{this.queue.enqueue(e)}))).catch(t=>this.authenticationService.getToken().then(r=>fetch("https://api.kabeen.io/rovers/availability/_archive",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${r}`},body:JSON.stringify(e)})).catch(r=>{this.queue.enqueue(e)}))}}class Se{static buildAppAvailability(e,t){if(e.url&&e.fqdn&&e.domain&&e.name&&e.path&&e.applications&&e.applications.length>0){const r="statusCode"in t?t.statusCode:void 0;let i;return r?i=r>=200&&r<300?"success":"http-error":i="other-error",{timestamp:e.timestamp,weekend:e.weekend,businessUnit:e.businessUnit,structure:e.structure,url:e.url,fqdn:e.fqdn,domain:e.domain,name:e.name,path:e.path,applications:e.applications,type:i,statusCode:r,otherError:r?void 0:"error"in t?t.error:void 0}}}}function tt(){const n=new Ue,e=new Re(n),t=new Je(e,n),r=new et(e,n),i=new Ge(e),s=new Le(e),o=new Ve(e),m=new Ze(n,e),a=new Be(n,e,i),T=new Ce(e,n,a,i),b=new Qe(n,e);return{applicationService:T,authenticationService:e,organizationService:s,configService:n,workspaceService:o,usageService:t,pollService:a,settingsService:i,activityService:m,announcementService:b,availabilityService:r}}class rt{constructor(e){this.context=e}runApplicationUpdateTask(){setInterval(async()=>{console.log("Update dock applications"),await this.context.applicationService.updateDockApplications()},5*60*1e3),console.log("Update dock applications")}runAnnouncementPopupTask(){setInterval(()=>{this.context.configService.getPauseState().then(e=>{this.context.authenticationService.isAuthenticated().then(t=>{this.context.configService.getOrganization().then(r=>{t&&!e.isPaused&&this.context.announcementService.getPopupAnnouncement(r.businessUnit)})})})},10*60*1e3)}runUsageDequeueTask(){setInterval(async()=>{await this.context.usageService.runBatch()},5e3)}runAvailabilityDequeueTask(){setInterval(async()=>{await this.context.availabilityService.runBatch()},5e3)}runSettingsRetrievalTask(){setInterval(async()=>{await this.context.settingsService.setExtensionSettings()},10*60*1e3)}runAnnouncementUpdateTask(){setInterval(async()=>{await this.context.announcementService.updateAnnouncements()},5*60*1e3)}run(){this.runApplicationUpdateTask(),this.runUsageDequeueTask(),this.runAvailabilityDequeueTask(),this.runSettingsRetrievalTask(),this.runAnnouncementUpdateTask(),this.runAnnouncementPopupTask()}}const X=class X{constructor(e){this.context=e}static registerHandler(e){console.info("Register handler for :",e.type),this.eventHandlers.set(e.type,e.handle)}async checkIfUrlIsAnApplication(e){return this.context.authenticationService.isAuthenticated().then(t=>this.context.configService.getPauseState().then(r=>this.context.configService.getOrganization().then(i=>{if(t&&!r.isPaused)return this.context.applicationService.getApplications(i.businessUnit).then(s=>{var m;const o=Q.buildVisitedUrlFromUrl(e,i.structure,i.businessUnit);if(o.applications=(m=s.body)==null?void 0:m.filter(a=>{var T;return a.fqdn&&a.fqdn===o.fqdn?a.path&&((T=o.path)!=null&&T.startsWith(a.path))?!0:!a.path:!1}).map(a=>a.id),o.applications&&o.applications.length>0)return o})})))}run(){this.context.configService.getPauseState().then(e=>{this.context.authenticationService.isAuthenticated().then(t=>{this.context.configService.getOrganization().then(r=>{t&&!e.isPaused&&this.context.announcementService.getPopupAnnouncement(r.businessUnit)})})}),p.runtime.onInstalled.addListener(async()=>{for(const e of p.runtime.getManifest().content_scripts)for(const t of await p.tabs.query({url:e.matches}))t.url.match(/(chrome|chrome-extension):\/\//gi)||p.scripting.executeScript({files:e.js,target:{tabId:t.id,allFrames:e.all_frames},injectImmediately:e.run_at==="document_start"})}),p.storage.local.get(["timers"]).then(e=>{if(e.timers){const t=JSON.parse(e.timers);if(t){const r=Object.entries(t).map(([,i])=>({...i})).filter(i=>!i.sent);r.length>0&&this.context.activityService.sendActivityData(r)}}}),this.context.activityService.clearApplicationTimers(),this.context.activityService.clearWindows(),this.context.settingsService.setExtensionSettings(),p.webRequest.onCompleted.addListener(e=>{this.checkIfUrlIsAnApplication(e.url).then(t=>{if(t&&(e.statusCode>=200&&e.statusCode<300||e.statusCode>=400)){const r=Se.buildAppAvailability(t,e);r&&this.context.availabilityService.publish(r)}})},{urls:["<all_urls>"],types:["main_frame"]}),p.webRequest.onErrorOccurred.addListener(e=>{this.checkIfUrlIsAnApplication(e.url).then(t=>{if(t){const r=Se.buildAppAvailability(t,e);r&&this.context.availabilityService.publish(r)}})},{urls:["<all_urls>"],types:["main_frame"]}),p.windows.onCreated.addListener(e=>{if(e.id)return this.context.activityService.createEmptyWindow(e.id)}),p.windows.onRemoved.addListener(async e=>{const t=this.context.activityService.getWindow(e);t&&t.tabs.forEach(i=>{if(i.applications&&i.applications.length>0){const s=i.applications;this.context.activityService.getAllTabsExceptCurrentWhereSameApplications(s,i.id,e).length===0&&s.forEach(m=>{const a=this.context.activityService.getTimerByApplicationId(m);a&&this.context.activityService.sendActivityData([a]).then(()=>{this.context.activityService.deleteApplicationTimer(m)})})}}),await this.context.activityService.deleteWindow(e)}),p.windows.onFocusChanged.addListener(e=>{p.tabs.query({windowId:e,active:!0}).then(t=>{var i;const r=t[0];if(r&&r.id&&r.windowId){const s=(i=this.context.activityService.getWindowTab(r.id,r.windowId))==null?void 0:i.applications;if(s&&s.length>0){const o=this.context.activityService.getAllTabsExceptCurrentWhereSameApplications(s,r.id,r.windowId);o.length>0&&o.forEach(m=>{this.context.activityService.pauseTimer(m).catch(a=>{a.message!=="Could not establish connection. Receiving end does not exist."&&console.error(a)})})}}p.windows.getAll().then(s=>{s.forEach(o=>{o.id!==e&&o.id?p.tabs.query({windowId:o.id}).then(m=>{m.forEach(a=>{a.id&&this.context.activityService.sendUnfocusedMessage(a.id).catch(T=>{T.message!=="Could not establish connection. Receiving end does not exist."&&console.error(T)})})}):p.tabs.query({windowId:o.id}).then(m=>{m.forEach(a=>{a.id&&this.context.activityService.sendFocusedMessage(a.id).catch(T=>{T.message!=="Could not establish connection. Receiving end does not exist."&&console.error(T)})})})})})})}),p.tabs.onCreated.addListener(e=>{if(e.windowId&&e.id)return this.context.activityService.addTabToWindow(e.windowId,e.id,void 0)}),p.tabs.onRemoved.addListener((e,t)=>{var s;const r=(s=this.context.activityService.getWindowTab(e,t.windowId))==null?void 0:s.applications,i=this.context.activityService.getWindow(t.windowId);r&&r.length>0&&i&&i.tabs.length>1?(this.context.activityService.getAllTabsExceptCurrentWhereSameApplications(r,e,t.windowId).length===0&&r.forEach(m=>{const a=this.context.activityService.getTimerByApplicationId(m);a&&this.context.activityService.sendActivityData([a]).then(()=>this.context.activityService.deleteApplicationTimer(m))}),this.context.activityService.removeTabFromWindow(t.windowId,e)):i&&i.tabs.length>1?i&&(i.tabs.forEach(m=>{if(m.applications&&m.applications.length>0){const a=m.applications;this.context.activityService.getAllTabsExceptCurrentWhereSameApplications(a,m.id,i.id).length===0&&a.forEach(b=>{const C=this.context.activityService.getTimerByApplicationId(b);C&&this.context.activityService.sendActivityData([C]).then(()=>{this.context.activityService.deleteApplicationTimer(b)})})}}),this.context.activityService.deleteWindow(i==null?void 0:i.id)):this.context.activityService.removeTabFromWindow(t.windowId,e)}),p.tabs.onDetached.addListener(async(e,t)=>{var r;if(t.oldWindowId&&e){const i=(r=this.context.activityService.getWindowTab(e,t.oldWindowId))==null?void 0:r.applications;return i&&i.length>0&&await this.context.activityService.storeTemporaryDetachedTab(e,i),this.context.activityService.removeTabFromWindow(t.oldWindowId,e)}}),p.tabs.onAttached.addListener((e,t)=>{var r;if(t.newWindowId&&e){let i=(r=this.context.activityService.getWindowTab(e,t.newWindowId))==null?void 0:r.applications;(!i||i.length===0)&&this.context.activityService.getTemporaryDetachedTab().then(s=>{var o;i=(o=s.temporaryDetachedTab)==null?void 0:o.applications,this.context.activityService.deleteTemporaryDetachedTab()}),this.context.activityService.addTabToWindow(t.newWindowId,e,i)}}),p.tabs.onActivated.addListener(e=>{this.context.authenticationService.isAuthenticated().then(r=>{this.context.configService.getPauseState().then(i=>{this.context.configService.getOrganization().then(s=>{r&&!i.isPaused&&this.context.applicationService.getApplications(s.businessUnit).then(o=>{p.tabs.get(e.tabId).then(m=>{var b;const a=Q.build(m,s.structure,s.businessUnit),T=(b=o.body)==null?void 0:b.filter(C=>{var B;return C.fqdn&&C.fqdn===a.fqdn?C.path&&((B=a.path)!=null&&B.startsWith(C.path))?!0:!C.path:!1});m.id&&this.context.pollService.newCheckEligibleApp(m.id,T)})})})})});const t=this.context.activityService.getWindowTab(e.tabId,e.windowId);if(t&&t.applications&&t.applications.length>0){const r=this.context.activityService.getAllTabsExceptCurrentWhereSameApplications(t.applications,e.tabId,e.windowId);r.length>0&&r.forEach(i=>{this.context.activityService.pauseTimer(i).catch(s=>{s.message!=="Could not establish connection. Receiving end does not exist."&&console.error(s)})})}}),p.tabs.onUpdated.addListener(async(e,t,r)=>{if(t.status==="complete"&&e&&r.windowId)return this.context.authenticationService.isAuthenticated().then(i=>this.context.configService.getPauseState().then(s=>this.context.configService.getOrganization().then(o=>{i&&!s.isPaused&&this.context.applicationService.getApplications(o.businessUnit).then(m=>{this.context.settingsService.getLocalStorageSettings().then(a=>{this.context.authenticationService.getManagedInfos(a.incognito).then(T=>{var $,q,U;const b=Q.build(r,o.structure,o.businessUnit);b.managedInfos=T,b.applications=($=m.body)==null?void 0:$.filter(k=>{var S;return k.fqdn&&k.fqdn===b.fqdn?k.path&&((S=b.path)!=null&&S.startsWith(k.path))?!0:!k.path:!1}).map(k=>k.id),this.context.usageService.publish(b);const C=(q=m.body)==null?void 0:q.filter(k=>{var S;return k.fqdn&&k.fqdn===b.fqdn?k.path&&((S=b.path)!=null&&S.startsWith(k.path))?!0:!k.path:!1});r.id&&this.context.pollService.newCheckEligibleApp(r.id,C);const B=this.context.activityService.getWindows(),F=(U=this.context.activityService.getWindowTab(e,r.windowId))==null?void 0:U.applications,J=B.some(k=>k.tabs.some(S=>F&&F.length>0&&S.applications&&Z(S.applications,F)&&S.id!==e));F&&b.applications&&F.length>0&&b.applications.length>0&&!Z(F,b.applications)?J||F.forEach(k=>{const S=this.context.activityService.getTimerByApplicationId(k);S&&!S.sent&&this.context.activityService.sendActivityData([S]).then(async()=>{await this.context.activityService.deleteApplicationTimer(k)})}):J&&B.filter(k=>k.tabs.some(S=>b.applications&&S.applications&&S.applications.length>0&&b.applications.length>0&&Z(S.applications,b.applications)&&S.id!==e)).forEach(k=>{k.tabs.filter(S=>b.applications&&S.applications&&S.applications.length>0&&b.applications.length>0&&Z(S.applications,b.applications)&&S.id!==e).forEach(S=>{this.context.activityService.pauseTimer(S.id)})}),b.applications&&b.applications.length>0&&this.context.applicationService.sendKnownAppSignal(e,b.applications).catch(k=>{k.message!=="Could not establish connection. Receiving end does not exist."&&console.error(k)}),this.context.activityService.changeWindowTabApplications(e,r.windowId,b.applications)})})})})))}),p.runtime.onMessage.addListener((e,t,r)=>{var i;if(X.eventHandlers.has(e.type))return(i=X.eventHandlers.get(e.type))==null||i(this.context,e).then(s=>r(s)),!0;switch(e.type){case"pause":return this.context.configService.pause(e.duration,e.until).then(s=>{r({pauseState:s})}),!0;case"unpause":return this.context.configService.unpause().then(s=>{r({pauseState:s})}),!0;case"updateDockPreferences":return this.context.configService.updateDockPreferences(e.dockPreferences,t.id||"0").then(s=>{r({})}),!0;default:console.log("Dead letter received",e)}})}};X.eventHandlers=new Map;let te=X;function N(n){return function(e,t){te.registerHandler({type:n,handle:e[t]})}}var it=Object.defineProperty,nt=Object.getOwnPropertyDescriptor,V=(n,e,t,r)=>{for(var i=nt(e,t),s=n.length-1,o;s>=0;s--)(o=n[s])&&(i=o(e,t,i)||i);return i&&it(e,t,i),i};class H{pinApplication(e,t){return e.applicationService.pinApplication(t.applicationId).then(r=>e.applicationService.updateDockApplications()).then(()=>({done:!0}))}getApplications(e){return e.authenticationService.isAuthenticated().then(t=>t?e.configService.getOrganization().then(r=>r&&r.businessUnit?e.applicationService.getApplications(r.businessUnit):Promise.resolve({error:{errorCode:_.NOT_AUTHORIZED,message:"Failed to get organization"}})):Promise.resolve({error:{errorCode:_.NOT_AUTHORIZED,message:"Not authenticated"}}))}getPinApplications(e){return e.applicationService.getPinApplications().then(t=>({applications:t}))}downloadDocument(e,t){return e.applicationService.downloadDocument(t.arg)}doPinApplication(e,t){return e.applicationService.pinApplication(t.arg).then(r=>e.applicationService.updateDockApplications()).then(r=>!0)}doUnpinApplication(e,t){return e.applicationService.unpinApplication(t.arg).then(r=>e.applicationService.updateDockApplications()).then(r=>!0)}getDockApplications(e){return e.authenticationService.isAuthenticated().then(t=>t?e.configService.getOrganization().then(r=>r&&r.businessUnit?e.applicationService.getApplications(r.businessUnit).then(i=>e.applicationService.getPinApplications().then(s=>({body:(i.body||[]).filter(m=>s.includes(m.id))}))):{error:{code:_.NOT_AUTHORIZED,message:"Failed to get organization"}}):{error:{code:_.NOT_AUTHORIZED,message:"Not authenticated"}})}async sendWebVitalsMetric(e,t){if(await e.authenticationService.isAuthenticated())return e.configService.getOrganization().then(i=>{if(i&&i.businessUnit){const{applications:s,timestamp:o,...m}=t.arg;s.forEach(a=>e.applicationService.sendWebVitalsMetric({timestamp:o,webVitals:m,applicationId:a,businessUnit:i.businessUnit,structure:i.structure}))}})}}V([N("PinApplication")],H.prototype,"pinApplication"),V([N("GetApplications")],H.prototype,"getApplications"),V([N("GetPinApplications")],H.prototype,"getPinApplications"),V([N("DownloadDocument")],H.prototype,"downloadDocument"),V([N("DoPinApplication")],H.prototype,"doPinApplication"),V([N("DoUnpinApplication")],H.prototype,"doUnpinApplication"),V([N("GetDockApplications")],H.prototype,"getDockApplications"),V([N("SendWebVitalsMetric")],H.prototype,"sendWebVitalsMetric");var st=Object.defineProperty,ot=Object.getOwnPropertyDescriptor,re=(n,e,t,r)=>{for(var i=ot(e,t),s=n.length-1,o;s>=0;s--)(o=n[s])&&(i=o(e,t,i)||i);return i&&st(e,t,i),i};class ie{authenticate(e,t){return e.authenticationService.authenticate(t.arg).then(r=>e.settingsService.setExtensionSettings().then(i=>r))}isAuthenticated(e,t){return e.authenticationService.isAuthenticated().then(r=>r?e.organizationService.get().then(i=>e.configService.isManaged().then(s=>e.configService.isIncognito().then(o=>e.configService.getOrganization().then(m=>e.configService.getDockPreferences().then(a=>e.configService.getPauseState().then(T=>({isAuthenticated:r,isManaged:s,isIncognito:o,organizationPref:m,organization:i,pauseState:T,dockPreferences:a}))))))):e.configService.isManaged().then(i=>e.configService.isIncognito().then(s=>s&&i?{isAuthenticated:r,isManaged:i,isIncognito:s}:e.configService.getDockPreferences().then(o=>({isAuthenticated:r,dockPreferences:o,isIncognito:!1,isManaged:!1}))))).catch(()=>{})}logout(e){return e.authenticationService.logout().then(t=>e.authenticationService.emitAuthenticationState(!1))}setExtensionInstalled(e,t){return e.authenticationService.setExtensionInstalled()}}re([N("DoAuthenticate")],ie.prototype,"authenticate"),re([N("IsAuthenticated")],ie.prototype,"isAuthenticated"),re([N("Logout")],ie.prototype,"logout"),re([N("SetExtensionInstalled")],ie.prototype,"setExtensionInstalled");var at=Object.defineProperty,ct=Object.getOwnPropertyDescriptor,ye=(n,e,t,r)=>{for(var i=ct(e,t),s=n.length-1,o;s>=0;s--)(o=n[s])&&(i=o(e,t,i)||i);return i&&at(e,t,i),i};class Te{getOrganization(e){return e.authenticationService.isAuthenticated().then(t=>t?e.organizationService.get():Promise.resolve({error:{code:_.NOT_AUTHORIZED,message:"Not authenticated"}}))}changeOrganization(e,t){return e.configService.setOrganization(t.arg).then(r=>e.authenticationService.emitAuthenticationState(!0)).then(r=>e.applicationService.updateDockApplications()).then(r=>e.settingsService.refreshSettings())}}ye([N("GetOrganization")],Te.prototype,"getOrganization"),ye([N("ChangeOrganization")],Te.prototype,"changeOrganization");var ht=Object.defineProperty,ut=Object.getOwnPropertyDescriptor,lt=(n,e,t,r)=>{for(var i=ut(e,t),s=n.length-1,o;s>=0;s--)(o=n[s])&&(i=o(e,t,i)||i);return i&&ht(e,t,i),i};class dt{getWorkspaceSettings(e){return e.workspaceService.getSettings()}}lt([N("GetWorkspaceSettings")],dt.prototype,"getWorkspaceSettings");var gt=Object.defineProperty,pt=Object.getOwnPropertyDescriptor,Oe=(n,e,t,r)=>{for(var i=pt(e,t),s=n.length-1,o;s>=0;s--)(o=n[s])&&(i=o(e,t,i)||i);return i&&gt(e,t,i),i};class ke{rate(e,t){return e.authenticationService.isAuthenticated().then(r=>r?e.pollService.rateApplication(t.arg.rate.applicationId,t.arg.rate.rate):Promise.resolve())}dismiss(e,t){return e.pollService.dismissApplication(t.arg.applicationId)}}Oe([N("ApplicationRate")],ke.prototype,"rate"),Oe([N("DismissedApplicationRate")],ke.prototype,"dismiss");var mt=Object.defineProperty,ft=Object.getOwnPropertyDescriptor,ce=(n,e,t,r)=>{for(var i=ft(e,t),s=n.length-1,o;s>=0;s--)(o=n[s])&&(i=o(e,t,i)||i);return i&&mt(e,t,i),i};class he{changeSideBar(e,t){return e.settingsService.changeSideBar(t.arg.sideBarType)}refreshSettings(e){return e.settingsService.refreshSettings()}getTenantSettings(e){return e.settingsService.getLocaStorageSettingsResponse()}}ce([N("ChangeSidebar")],he.prototype,"changeSideBar"),ce([N("RefreshSettings")],he.prototype,"refreshSettings"),ce([N("GetTenantSettings")],he.prototype,"getTenantSettings");var At=Object.defineProperty,vt=Object.getOwnPropertyDescriptor,_e=(n,e,t,r)=>{for(var i=vt(e,t),s=n.length-1,o;s>=0;s--)(o=n[s])&&(i=o(e,t,i)||i);return i&&At(e,t,i),i};class Fe{async applicationTimedOut(e,t){return e.activityService.timeoutApplicationTimer(t.arg.apps)}async incrementTimer(e,t){return e.activityService.incrementApplicationTimer(t.arg)}}_e([N("ApplicationTimedOut")],Fe.prototype,"applicationTimedOut"),_e([N("IncrementTimer")],Fe.prototype,"incrementTimer");var bt=Object.defineProperty,xt=Object.getOwnPropertyDescriptor,ne=(n,e,t,r)=>{for(var i=xt(e,t),s=n.length-1,o;s>=0;s--)(o=n[s])&&(i=o(e,t,i)||i);return i&&bt(e,t,i),i};class se{getAnnouncements(e){return e.authenticationService.isAuthenticated().then(t=>t?e.configService.getOrganization().then(r=>r&&r.businessUnit?e.announcementService.getAnnouncements(r.businessUnit):Promise.resolve({error:{errorCode:_.NOT_AUTHORIZED,message:"Failed to get organization"}})):Promise.resolve({error:{errorCode:_.NOT_AUTHORIZED,message:"Not authenticated"}}))}markAnnouncementAsSeen(e,t){return e.authenticationService.isAuthenticated().then(r=>r?e.configService.getOrganization().then(i=>i&&i.businessUnit?e.announcementService.markAnnouncementAsSeen(t.arg.announcementId):Promise.resolve({error:{errorCode:_.NOT_AUTHORIZED,message:"Failed to get organization"}})):Promise.resolve({error:{errorCode:_.NOT_AUTHORIZED,message:"Not authenticated"}}))}dismissAnnouncement(e){return e.announcementService.dismissAnnouncement()}likeDislikeAnnouncement(e,t){return e.authenticationService.isAuthenticated().then(r=>r?e.configService.getOrganization().then(i=>i&&i.businessUnit?e.announcementService.likeDislikeAnnouncement(t.arg.announcementId,t.arg.status):Promise.resolve({error:{errorCode:_.NOT_AUTHORIZED,message:"Failed to get organization"}})):Promise.resolve({error:{errorCode:_.NOT_AUTHORIZED,message:"Not authenticated"}}))}}ne([N("GetAnnouncements")],se.prototype,"getAnnouncements"),ne([N("MarkAnnouncementAsSeen")],se.prototype,"markAnnouncementAsSeen"),ne([N("DismissAnnouncement")],se.prototype,"dismissAnnouncement"),ne([N("LikeDislikeAnnouncement")],se.prototype,"likeDislikeAnnouncement");const Ee=tt();new te(Ee).run(),new rt(Ee).run()})();
