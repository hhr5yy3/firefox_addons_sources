var Re=Object.defineProperty;var Oe=(e,t,n)=>t in e?Re(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n;var v=(e,t,n)=>(Oe(e,typeof t!="symbol"?t+"":t,n),n);import{B as Le}from"./chunk-b39a70df.js";import{l as r,a as u,E as k,D as x,c as U,M as Me,m as Ie,e as A,f as ke,n as He,o as qe,p as Ae,k as De,h as ye,i as Ve,S as Ne,g as We,q as Qe,r as Ye,s as Ke,t as Ge}from"./chunk-70aa1672.js";import{R as Be,M as y,E as we,F as b,a as je,b as Je,d as $,A as R,I as ze,c as Xe,e as Ze}from"./chunk-4da8f9f7.js";const T="QueueConsumerCriticalPoint";class et{constructor(t,n,s){v(this,"storage");v(this,"func");v(this,"interval");v(this,"_timeout");v(this,"_interval");v(this,"_func_timeout");v(this,"_refId");this.storage=t,this.func=n,this.interval=s,this._timeout=null,this._interval=100,this._func_timeout=null,this._refId=Be()}async getCriticalPoint(){var n;let t=null;do{this._interval=await this.interval(this.storage);const s=(await this.storage.get({[T]:null}))[T];if(!s||s.refId===this._refId||s.time<=new Date().valueOf())await this.storage.set({[T]:{refId:this._refId,time:new Date().valueOf()+(this._interval||0)*1.5}}),await new Promise(o=>setTimeout(o,10)),t=(n=(await this.storage.get({[T]:null}))[T])==null?void 0:n.refId;else return!1}while(t!==this._refId);return!0}async releaseCriticalPoint(){const t=(await this.storage.get({[T]:null}))[T];(t==null?void 0:t.refId)===this._refId&&t.time>new Date().valueOf()&&await this.storage.set({[T]:null})}entropy(){const t=this._interval*.1;return Math.random()*t*2-t}async sync(){await this.getCriticalPoint()?(this._func_timeout===null&&(this._func_timeout=setTimeout(()=>this.func().then(()=>{this._func_timeout=null,this.sync()}).catch(()=>this.stop()),this._interval+this.entropy())),this._timeout=null):(this._func_timeout&&(clearTimeout(this._func_timeout),this._func_timeout=null),this._timeout=setTimeout(()=>this.sync(),this._interval))}start(){this._timeout||this._func_timeout||(console.debug(r,"queue consumer started"),this.sync())}stop(){this._timeout&&(clearTimeout(this._timeout),this._timeout=null),this._func_timeout&&(clearTimeout(this._func_timeout),this._func_timeout=null),this.releaseCriticalPoint(),console.debug(r,"queue consumer stopped")}}const ve=new Le(u.storage.local),D=new Set,O=new Set;function tt(e){u.storage.local.get({headers:{}}).then(t=>{for(const[n,s]of Object.entries(e))t.headers[n.toLowerCase()]=s;u.storage.local.set(t)})}setInterval(D.clear,10*6e4);setInterval(O.clear,10*6e4);const Se=/^https?:\/\/(?:\w+\.)?(?:twitter|x)\.com(?=$|\/)/;function Ee(e,t,n,s=1){O.add(t),u.storage.sync.get({unblocked:{}}).then(d=>{d.unblocked[String(t)]=e.screen_name,u.storage.sync.set(d)});const o=window.location.href.match(Se);if(!o)throw new Error("unexpected or incorrectly formatted url");const c=o[0];let a="";c.includes("tweetdeck")?a="https://api.x.com/1.1/":a=`${c}/i/api/1.1/`,u.storage.sync.get(x).then(d=>{const l=d;l.mute?a+="mutes/users/destroy.json":a+="blocks/destroy.json",u.storage.local.get({headers:null}).then(m=>m.headers).then(m=>{const p=`user_id=${t}`,f={"content-length":p.length.toString(),"content-type":"application/x-www-form-urlencoded"};for(const i of Ie)m[i]&&(f[i]=m[i]);const h=Fe.exec(document.cookie);h?f["x-csrf-token"]=h[1]:f["x-csrf-token"]=m["x-csrf-token"],fetch(a,{body:p,headers:f,method:"POST",credentials:"include"}).then(i=>{i.status===403?(y(`could not un${l.mute?"mute":"block"} @${e.screen_name}, you may have been logged out.`,l),console.log(r,`user is logged out, failed to un${l.mute?"mute":"block"} user.`)):i.status===404?(y(`could not un${l.mute?"mute":"block"} @${e.screen_name}, user has been suspended or no longer exists.`,l),console.log(r,`failed to un${l.mute?"mute":"block"} ${b(e)}, user no longer exists`)):i.status>=300?(y(`could not un${l.mute?"mute":"block"} @${e.screen_name}, twitter gave an unfamiliar response code.`,l),console.error(r,`failed to un${l.mute?"mute":"block"} ${b(e)}:`,e,i)):(je(t).catch(g=>console.error(r,g)),console.log(r,`un${l.mute?"mut":"block"}ed ${b(e)}`),y(`un${l.mute?"mut":"block"}ed @${e.screen_name}, they won't be ${l.mute?"mut":"block"}ed again.`,l))}).catch(i=>{s<3?Ee(e,t,n,s+1):console.error(r,`failed to un${l.mute?"mute":"block"} ${b(e)}:`,e,i)})})})}const V="UserBlockedEvent",N="UserLogoutEvent";u.storage.local.onChanged.addListener(e=>{if(!e.hasOwnProperty(k))return;const t=e[k].newValue;console.debug(r,"received multi-tab event:",t),u.storage.sync.get(x).then(n=>{const s=n;switch(t.type){case Me:s.showBlockPopups&&y(t.message,s,t.options);break;case V:if(s.showBlockPopups){const c=t,{user:a,user_id:d,reason:l}=c,m=a.name.length>25?a.name.substring(0,23).trim()+"...":a.name,p=document.createElement("button");p.innerText="undo",p.onclick=()=>{Ee(a,d,l),p.parentNode.removeChild(p)};const f=document.createElement("span");f.appendChild(document.createTextNode(`${s.mute?"mut":"block"}ed ${we(m)} (`)),f.appendChild((()=>{const h=we(a.screen_name),_=document.createElement("a");return _.href="/"+h,_.innerText="@"+h,_})()),f.appendChild(document.createTextNode(")")),y("",s,{elements:[f,p]})}break;case N:s.showBlockPopups&&y(`You have been logged out, and ${s.mute?"mut":"block"}ing has been paused.`,s,{warn:!0});break;case U:t.message&&console.error(r,t.message,t);const o=document.createElement("p");o.appendChild(document.createTextNode("an error occurred! check the console and create an issue on ")),o.appendChild((()=>{const c=document.createElement("a");return c.href="https://github.com/kheina-com/Blue-Blocker/issues",c.innerText="GitHub",c})()),y("",s,{error:!0,elements:[o]});break;default:console.error(r,"unknown multitab event occurred:",t)}})});function E(e,t,n,s=null){if(D.has(t))return;D.add(t);const o={user_id:t,reason:n,user:{name:e.legacy.name,screen_name:e.legacy.screen_name}};s&&(o.external_reason=s),$(o).then(()=>C.start()).then(()=>u.storage.sync.get(x)).then(c=>c).then(c=>console.log(r,`queued ${b(e.legacy)} for a ${c.mute?"mute":"block"} due to ${A[n]}.`))}function ot(){return new Promise((e,t)=>{Je().then(n=>{if(!n)return t();W(n),e()}).catch(n=>{console.error(r,"unexpected error occurred while processing block queue",n),u.storage.local.set({[k]:{type:U,message:"unexpected error occurred while processing block queue",detail:{error:n,event:null}}}).catch(s=>{console.error(r,"unexpected error occurred while processing block queue",s),u.storage.local.set({[k]:{type:U,message:"unexpected error occurred while processing block queue",detail:{error:s,event:null}}}),e()})})})}const C=new et(u.storage.local,ot,async()=>(await u.storage.sync.get({blockInterval:x.blockInterval})).blockInterval*1e3);C.start();const Fe=/ct0=\s*(\w+);/;function W(e,t=1){const n=window.location.href.match(Se);if(!n)throw new Error("unexpected or incorrectly formatted url");const s=n[0];let o="";s.includes("tweetdeck")?o="https://api.twitter.com/1.1/":o=`${s}/i/api/1.1/`,u.storage.sync.get(x).then(c=>{const a=c;a.mute?o+="mutes/users/create.json":o+="blocks/create.json",u.storage.local.get({headers:null}).then(d=>d.headers).then(d=>{const l=`user_id=${e.user_id}`,m={"content-length":l.length.toString(),"content-type":"application/x-www-form-urlencoded"};for(const h of Ie)d[h]&&(m[h]=d[h]);const p=Fe.exec(document.cookie);p?m["x-csrf-token"]=p[1]:m["x-csrf-token"]=d["x-csrf-token"],fetch(o,{body:l,headers:m,method:"POST",credentials:"include"}).then(h=>{var _,i;console.debug(r,"block response:",h),h.status===403||h.status===401?(C.stop(),$(e),u.storage.local.set({[k]:{type:N}}),console.log(r,"user is logged out, queue consumer has been halted.")):h.status===404?(R(e,ke).catch(g=>console.error(r,g)),console.log(r,`could not block ${b(e.user)}, user no longer exists`)):h.status>=300?(C.stop(),$(e),console.error(r,`failed to block ${b(e.user)}, consumer stopped just in case.`,h)):(ve.increment(),R(e).catch(g=>console.error(r,g)),console.log(r,`blocked ${b(e.user)} due to ${(i=(_=A)==null?void 0:_[e.reason])!=null?i:e==null?void 0:e.external_reason}.`),u.storage.local.set({[k]:{type:V,...e}}))}).catch(h=>{t<3?W(e,t+1):($(e),console.error(r,`failed to block ${b(e.user)}:`,e,h)),fetch(o,{body:l,headers:m,method:"POST",credentials:"include"}).then(i=>{console.debug(r,`${a.mute?"mute":"block"} response:`,i),i.status===403||i.status===401?(C.stop(),$(e),u.storage.local.set({[k]:{type:N}}),console.log(r,"user is logged out, queue consumer has been halted.")):i.status===404?(R(e,ke).catch(g=>console.error(r,g)),console.log(r,`could not ${a.mute?"mute":"block"} ${b(e.user)}, user no longer exists`)):i.status>=300?(C.stop(),$(e),console.error(r,`failed to ${a.mute?"mute":"block"} ${b(e.user)}, consumer stopped just in case.`,i)):(ve.increment(),R(e).catch(g=>console.error(r,g)),console.log(r,`${a.mute?"mut":"block"}ed ${b(e.user)} due to ${A[e.reason]}.`),u.storage.local.set({[k]:{type:V,...e}}))}).catch(i=>{t<3?W(e,t+1):($(e),console.error(r,`failed to ${a.mute?"mute":"block"} ${b(e.user)}:`,e,i))})})})})}const st=new Set([]),Te=new Set(["Business"]);async function B(e,t){var c;if(t.suspendedBlockCollection)return;const n=b(e.legacy);if(await(async()=>{var a,d,l,m,p,f,h,_,i,g,j;try{if((e==null?void 0:e.rest_id)===void 0||((a=e==null?void 0:e.legacy)==null?void 0:a.name)===void 0||((d=e==null?void 0:e.legacy)==null?void 0:d.screen_name)===void 0)throw new Error("invalid user object passed to BlockBlueVerified");const w=Te.has(((l=e.legacy)==null?void 0:l.verified_type)||""),S=st.has(((p=(m=e.affiliates_highlighted_label)==null?void 0:m.label)==null?void 0:p.userLabelType)||"");if(t.unblocked.hasOwnProperty(String(e.rest_id)))return console.debug(r,`skipped user ${n} because you un${t.mute?"mut":"block"}ed them previously.`),!0;if(!t.blockFollowing&&(((f=e.legacy)==null?void 0:f.following)||e.super_following))return console.debug(r,`skipped user ${n} because you follow them.`),!0;if(!t.blockFollowers&&((h=e.legacy)==null?void 0:h.followed_by))return console.debug(r,`skipped user ${n} because they follow you.`),!0;if(((_=e.legacy)==null?void 0:_.blocking)||t.mute&&((i=e.legacy)==null?void 0:i.muting))return!0;if(((g=e.legacy)==null?void 0:g.verified_type)&&!Te.has(e.legacy.verified_type))return!1;const M="could not access the legacy verified database, skip legacy has been disabled.";if(!t.skipBlueCheckmark&&(e.is_blue_verified||w||S))if(t.skipVerified&&await ze(e.rest_id,e.legacy.screen_name))console.log(r,`did not ${t.mute?"mute":"block"} Twitter Blue verified user ${n} because they are legacy verified.`);else if(t.skipAffiliated&&(S||w))console.log(r,`did not ${t.mute?"mute":"block"} Twitter Blue verified user ${n} because they are verified through an affiliated organization.`);else if(t.skip1Mplus&&((j=e.legacy)==null?void 0:j.followers_count)>t.skipFollowerCount)console.log(r,`did not ${t.mute?"mute":"block"} Twitter Blue verified user ${n} because they have over ${Xe(t.skipFollowerCount)} followers and Elon is an idiot.`);else{const P=w?He:qe;return E(e,String(e.rest_id),P),!0}}catch(w){console.error(r,w)}return!1})())return;if(t.blockForUse&&e.used_blue){E(e,String(e.rest_id),Qe);return}if(t.blockDisallowedWords&&((c=t.disallowedWords)==null?void 0:c.test(e.legacy.name.replace(/\s{2,}/g," "))))return E(e,e.rest_id,Ye),console.log(r,`${t.mute?"muted":"blocked"} ${n} for having disallowed words/emojis in their username.`),!0;if(t.blockPromoted&&e.promoted_tweet){E(e,String(e.rest_id),Ke);return}let o=!1;u.storage.local.get({integrations:{}}).then(a=>a.integrations).then(async a=>{t.soupcanIntegration&&(o=!0,a[Ae]={name:"Soupcan",state:De},t.soupcanIntegration=!1,u.storage.sync.set({soupcanIntegration:!1}));for(const[d,l]of Object.entries(a)){if(!d||l.state===ye||l.state===Ve)continue;const m=Be();try{const p={action:"check_twitter_user",data:e,refid:m};console.debug(r,m,"send:",p,l);const f=await u.runtime.sendMessage(d,p);if(console.debug(r,m,"recv:",f),(f==null?void 0:f.status)!==Ne){console.error(r,m,"received a non-success status from",l.name,f);return}const _=f.result;if(_.block){E(e,String(e.rest_id),We,_.reason);return}}catch(p){const f=p;f.message==="Could not establish connection. Receiving end does not exist."?(o=!0,l.state=ye,console.log(r,m,"looks like",l.name,"was uninstalled, disabling integration.")):console.error(r,m,`an unknown error occurred while messaging ${l.name}:`,f)}}o&&u.storage.local.set({integrations:a})}).catch(a=>console.error(r,"an unexpected error occurred while processing integrations:",a))}const nt={HomeLatestTimeline:["data","home","home_timeline_urt","instructions"],HomeTimeline:["data","home","home_timeline_urt","instructions"],SearchTimeline:["data","search_by_raw_query","search_timeline","timeline","instructions"],Favoriters:["data","favoriters_timeline","timeline","instructions"],Retweeters:["data","retweeters_timeline","timeline","instructions"],UserTweets:["data","user","result","timeline_v2","timeline","instructions"],Followers:["data","user","result","timeline","timeline","instructions"],Following:["data","user","result","timeline","timeline","instructions"],UserCreatorSubscriptions:["data","user","result","timeline","timeline","instructions"],FollowersYouKnow:["data","user","result","timeline","timeline","instructions"],BlueVerifiedFollowers:["data","user","result","timeline","timeline","instructions"],TweetDetail:["data","threaded_conversation_with_injections_v2","instructions"],ModeratedTimeline:["data","tweet","result","timeline_response","timeline","instructions"],"search/adaptive.json":["timeline","instructions"]},rt=["tweet_results","result","tweet","core","user_results","result"],Pe=new Set(["TimelineTimelineCursor"]),$e=new Set(["suggest_promoted","Promoted","promoted"]);function lt(e,t,n){var o;let s=(o=e.user_results)==null?void 0:o.result;if(!s){console.log(r,"empty user result");return}if(s.__typename==="UserUnavailable"){console.log(r,"user is unavailable",s);return}if(s.__typename!=="User"){console.error(r,"could not parse user object",s);return}n&&(e.user_results.result.is_blue_verified=!0),B(e.user_results.result,t)}function it(e,t,n){lt(e,t,n)}function q(e,t,n){var c,a,d;let s=e,o=!1;for(const l of rt){if(s.__typename=="TweetTombstone")return;s.hasOwnProperty(l)&&(s=s[l],s.__typename=="Tweet"&&(((c=s==null?void 0:s.note_tweet)==null?void 0:c.is_expandable)==!0||typeof((d=(a=s==null?void 0:s.edit_control)==null?void 0:a.edit_tweet_ids)==null?void 0:d.initial_tweet_id)=="string")&&(o=!0))}if(s.__typename!=="User"){console.error(r,"could not parse tweet",e);return}s.promoted_tweet=n,s.is_blue_verified=s.is_blue_verified||o,s.used_blue=o,B(s,t)}function xe(e,t){var s,o,c,a,d,l,m,p,f,h,_,i,g,j,w,S,M,P,K,G,J,z,X,Z,ee,te,oe,se,ne,re,le,ie,ae,ce,ue,de,me,fe,he,pe,_e,ge,be;if(Pe.has(e.itemContent.itemType))return;let n=!1;(((s=e==null?void 0:e.itemContent)==null?void 0:s.promotedMetadata)!==void 0||$e.has((o=e==null?void 0:e.clientEventInfo)==null?void 0:o.component)||$e.has((d=(a=(c=e==null?void 0:e.clientEventInfo)==null?void 0:c.details)==null?void 0:a.timelinesDetails)==null?void 0:d.injectionType))&&(n=!0);try{if(t.skipFollowingQrts&&((i=(_=(h=(f=(p=(m=(l=e==null?void 0:e.itemContent)==null?void 0:l.tweet_results)==null?void 0:m.result)==null?void 0:p.core)==null?void 0:f.user_results)==null?void 0:h.result)==null?void 0:_.legacy)==null?void 0:i.following)&&(((S=(w=(j=(g=e==null?void 0:e.itemContent)==null?void 0:g.tweet_results)==null?void 0:j.result)==null?void 0:w.legacy)==null?void 0:S.is_quote_status)||((K=(P=(M=e==null?void 0:e.tweet_results)==null?void 0:M.result)==null?void 0:P.legacy)==null?void 0:K.retweeted_status_result))){const H=((oe=(te=(ee=(Z=(X=(z=(J=(G=e==null?void 0:e.itemContent)==null?void 0:G.tweet_results)==null?void 0:J.result)==null?void 0:z.legacy)==null?void 0:X.retweeted_status_result)==null?void 0:Z.result)==null?void 0:ee.core)==null?void 0:te.user_results)==null?void 0:oe.result)||((ce=(ae=(ie=(le=(re=(ne=(se=e==null?void 0:e.itemContent)==null?void 0:se.tweet_results)==null?void 0:ne.result)==null?void 0:re.quoted_status_result)==null?void 0:le.result)==null?void 0:ie.core)==null?void 0:ae.user_results)==null?void 0:ce.result);console.log(r,`skipping ${H.legacy.name} (@${H.legacy.screen_name}) because they got retweeted by someone you follow`)}else(fe=(me=(de=(ue=e==null?void 0:e.itemContent)==null?void 0:ue.tweet_results)==null?void 0:de.result)==null?void 0:me.quoted_status_result)!=null&&fe.result?q(e.itemContent.tweet_results.result.quoted_status_result.result,t,n):(be=(ge=(_e=(pe=(he=e==null?void 0:e.itemContent)==null?void 0:he.tweet_results)==null?void 0:pe.result)==null?void 0:_e.legacy)==null?void 0:ge.retweeted_status_result)!=null&&be.result&&q(e.itemContent.tweet_results.result.legacy.retweeted_status_result.result,t,n);q(e.itemContent,t,n)}catch{console.error(r,"found unexpected tweet shape:",e),u.storage.local.set({[k]:{type:U}})}}function at(e,t,n){var d,l,m,p,f,h,_;let s=t;for(const i of nt[e.detail.parsedUrl[1]])s=s[i];const o=s;console.debug(r,"parsed instructions path:",o);let c,a=!1;for(const i of o)if(i.type==="TimelineAddEntries"||i.type==="TimelineAddToModule"){c=i,a=i.type==="TimelineAddToModule";break}if(c===void 0){console.error(r,"response object does not contain an instruction to add entries",t);return}c.entries=c.entries||[],a&&(c.entries=[{content:{entryType:"TimelineTimelineModule",items:c.moduleItems}}]);for(const i of c.entries)switch((d=i==null?void 0:i.content)==null?void 0:d.entryType){case null:console.error(r,"tweet structure does not match expectation",i);break;case"TimelineTimelineItem":if(((l=i.content.itemContent)==null?void 0:l.itemType)=="TimelineTweet")xe(i.content,n);else if(((m=i.content.itemContent)==null?void 0:m.itemType)=="TimelineUser"){const g=e.detail.parsedUrl[1]=="BlueVerifiedFollowers";it(i.content.itemContent,n,g)}break;case"TimelineTimelineModule":for(const g of i.content.items||[])xe(g.item,n);break;default:if(!Pe.has(i.content.entryType))throw{message:`unexpected tweet type found: ${(p=i==null?void 0:i.content)==null?void 0:p.entryType}`,name:"TweetType",tweet:i}}a&&(c.moduleItems=((_=(h=(f=c.entries)==null?void 0:f[0])==null?void 0:h.content)==null?void 0:_.items)||[],delete c.entries)}function ct(e,t,n){var s,o,c,a;for(const[d,l]of Object.entries(t.globalObjects.users))B({is_blue_verified:l.ext_is_blue_verified,legacy:{blocking:l.blocking,followed_by:l.followed_by,following:l.following,name:l.name,screen_name:l.screen_name,verified:l.verified,verified_type:(l==null?void 0:l.ext_verified_type)||"",followers_count:l.followers_count},super_following:(a=(c=(o=(s=l.ext)==null?void 0:s.superFollowMetadata)==null?void 0:o.r)==null?void 0:c.ok)==null?void 0:a.superFollowing,rest_id:d},n)}function ut(e,t,n){var s;if(!!((s=t==null?void 0:t.users)!=null&&s.length))for(const o of t.users)B({is_blue_verified:o.ext_is_blue_verified,legacy:{blocking:(o==null?void 0:o.is_blocked)||!1,followed_by:(o==null?void 0:o.social_context.followed_by)||!1,following:(o==null?void 0:o.social_context.following)||!1,name:o.name,screen_name:o.screen_name,verified:o.verified,verified_type:(o==null?void 0:o.ext_verified_type)||"",followers_count:1e10},super_following:!1,rest_id:o.id_str},n)}function dt(e,t,n){if((t==null?void 0:t.id_str)===void 0||(t==null?void 0:t.screen_name)===void 0){console.error(r,"got and unknown or mangled response from an unblock request:",t),y("couldn't parse unblock response",n);return}const s=String(t.id_str);if(O.has(s))return;je(s).catch(console.error),O.add(s);const o=n.unblocked;o[s]=t.screen_name,u.storage.sync.set({unblocked:o}).then(()=>y(`okay, @${t.screen_name} won't be blocked again.`,n))}const mt="/assets/chunk-07136654.js",L=document.createElement("script");L.src=u.runtime.getURL(mt);L.id="injected-blue-block-xhr";L.type="text/javascript";document.head.prepend(L);let Y=document.createElement("link");Y.href=u.runtime.getURL("src/injected/style.css");Y.rel="stylesheet";(document.head||document.documentElement).appendChild(Y);const I=document.createElement("div");I.id="injected-blue-block-toasts";document.body.appendChild(I);u.storage.sync.get(x).then(e=>{const t=e;I.classList="",I.classList.add(t.toastsLocation)});u.storage.sync.onChanged.addListener(e=>{e.hasOwnProperty("toastsLocation")&&(I.classList="",I.classList.add(e.toastsLocation.newValue))});const ft=[["is_blue_verified","ext_is_blue_verified"],["rest_id","id_str"],["id","id_str"],["affiliates_highlighted_label","ext_highlighted_label"],["is_blue_verified","ext_is_blue_verified"]];function ht(e){let t={__typename:"User"};for(const n of ft){if(!e[n[1]]){console.log(r,`object missing key: ${n[1]}`);return}t[n[0]]=e[n[1]]}return t.legacy=e,t}function pt(e,t,n){if(!Array.isArray(t)){console.log(r,"recommendations are not an array");return}for(const s of t){let o=s.user;if(!o){console.log(r,"no user object");continue}const c=ht(o);c!==void 0&&B(c,n)}}function _t(e,t,n){var c,a,d;let s=(a=(c=t==null?void 0:t.data)==null?void 0:c.user)==null?void 0:a.result,o=(d=s.user_results)==null?void 0:d.result;if(!o){console.log(r,"empty user result");return}if(o.__typename==="UserUnavailable"){console.log(r,"user is unavailable",o);return}if(o.__typename!=="User"){console.error(r,"could not parse user object",o);return}B(s.user_results.result,n)}function F(e){return{suspendedBlockCollection:e.suspendedBlockCollection,showBlockPopups:e.showBlockPopups,toastsLocation:e.toastsLocation,mute:e.mute,blockFollowing:e.blockFollowing,blockFollowers:e.blockFollowers,skipFollowingQrts:e.skipFollowingQrts,skipBlueCheckmark:e.skipBlueCheckmark,skipVerified:e.skipVerified,skipAffiliated:e.skipAffiliated,skip1Mplus:e.skip1Mplus,blockInterval:e.blockInterval,unblocked:e.unblocked,popupTimer:e.popupTimer,skipFollowerCount:e.skipFollowerCount,soupcanIntegration:e.soupcanIntegration,blockPromoted:e.blockPromoted,blockForUse:e.blockForUse,blockDisallowedWords:e.blockDisallowedWords,disallowedWords:e.disallowedWords.length===0?null:new RegExp(e.disallowedWords.map(t=>t.match(Ge)?t:`(?:^|\\s)${Ze(t)}(?:$|\\s)`).join("|"),"i")}}function Q(e){if(e.detail.status<300)tt(e.detail.request.headers);else return;u.storage.sync.get(x).then(t=>{const n=t,s=e.detail.body;try{const o=JSON.parse(s);if((o==null?void 0:o.error)||(o==null?void 0:o.errors)){console.debug(r,"skipped",e.detail.parsedUrl[1],"response because it contained an error key:",{event:e,body_str:s});return}switch(e.detail.parsedUrl[1]){case"blocks/destroy.json":case"mutes/users/destroy.json":return dt(e,o,n);case"HomeLatestTimeline":case"HomeTimeline":case"SearchTimeline":case"UserTweets":case"TweetDetail":case"ModeratedTimeline":case"Following":case"Followers":case"UserCreatorSubscriptions":case"FollowersYouKnow":case"BlueVerifiedFollowers":case"Favoriters":case"Retweeters":return at(e,o,F(n));case"timeline/home.json":case"search/adaptive.json":return ct(e,o,F(n));case"search/typeahead.json":return ut(e,o,F(n));case"UserByScreenName":return _t(e,o,F(n));case"recommendations.json":return pt(e,o,F(n));default:console.error(r,"found an unexpected url that we don't know how to handle",e),u.storage.local.set({[k]:{type:U}})}}catch(o){console.error(r,"unexpected error occurred while parsing request body",{error:o,body_str:s,event:e}),u.storage.local.set({[k]:{type:U}})}})}var Ce,Ue;(Ue=(Ce=u)==null?void 0:Ce.runtime)!=null&&Ue.getBrowserInfo?exportFunction(e=>{Q(e)},window,{defineAs:"blueBlockerRequest"}):document.addEventListener("blue-blocker-event",Q);window.addEventListener("message",async function(e){if(e.data.type!=="OLDTWITTER_REQUEST_LOAD")return;if(!e.data.url||!e.data.body||!e.data.headers)return console.error(r,"OldTwitter sent an invalid payload.",e.data);const t=JSON.stringify(e.data.body);Q(new CustomEvent("blue-blocker-event",{detail:{parsedUrl:/(.+)/.exec(e.data.url),url:e.data.url,body:t,request:{headers:e.data.headers},status:200}}))});
