!function(){"use strict";const e="BearBy",t={CONTENT:`@/${e}/content-script`,INJECTED:`@/${e}/injected-script`},s={GET_DATA:`@/${e}/get-wallet-data`,REQUEST_RPC_PROXY:`@/${e}/make-request-rpc-proxy`,NEW_SLOT:`@/${e}/new-slot-emited`,ACCOUNT_CHANGED:`@/${e}/accounts-just-changed`,CONNECTION_CHANGED:`@/${e}/connection-account-changed`,CONTENT_PROXY_MEHTOD:`@/${e}/proxy-method`,CONTENT_PROXY_RESULT:`@/${e}/response-from-content`,DISCONNECT_APP:`@/${e}/disconnect_app`,DISCONNECT_APP_RESULT:`@/${e}/disconnect_app_result`,CONNECT_APP:`@/${e}/connect-app`,REQUEST_PUB_KEY:`@/${e}/request-pub-key`,RESPONSE_CONNECT_APP:`@/${e}/respoonse-connect-app`,NETWORK_CHANGED:`@/${e}/network-just-changed`,LOCKED:`@/${e}/guard-just-lock`,TX_TO_SEND:`@/${e}/add-tx-to-send`,TX_TO_SEND_RESULT:`@/${e}/response-tx-result`,SIGN_MESSAGE:`@/${e}/sign-message-call`,SING_MESSAGE_RESULT:`@/${e}/sign-message-response`,RESPONSE_PUB_KEY:`@/${e}/response-pub-key`,CHECK_MASSA_ADDRESS:`@/${e}/check-massa-address`,CHECK_MASSA_ADDRESS_RES:`@/${e}/check-massa-address-response`,REQUEST_PING:`@/${e}/req-content-ping`,PING_RESPONSE:`@/${e}/res-content-ping`},n=globalThis.chrome;class a{#e;get type(){return this.#e.type}get payload(){return this.#e.payload}constructor(e){this.#e=e}send(e,t){const s=JSON.stringify(this.#e),n=JSON.parse(s);e.send(n,t)}}const{document:r}=globalThis;class i{#t;constructor(e){this.#t=e}listen(e){r.addEventListener(this.#t,(t=>{t&&t.detail&&e(JSON.parse(t.detail))}))}send(e,s){e.from=this.#t,Object.values(t).includes(s)&&this.#s(JSON.stringify(e),s)}#s(e,t){r.dispatchEvent(this.#n(e,t))}#a(e){return{detail:e}}#n(e,t){return new CustomEvent(t,this.#a(e))}}var o;!function(e){e[e.V2=2]="V2",e[e.V3=3]="V3"}(o||(o={}));class c{static signal(e){return new c({type:e})}_body;constructor(e){this._body=e}async send(){if(o.V2==n.runtime.getManifest().manifest_version){return await this.#r()}for(let e=0;e<100;e++){const e=await this.#r();if(e)return e}throw new Error("service_worker_stoped")}#r(){return new Promise((e=>{try{let t=JSON.parse(JSON.stringify(this._body));n.runtime.sendMessage(t,e)}catch(e){console.error(this,e),window.location.reload()}}))}}function d(e){if(!e)throw new Error("msg is null");if(e.reject)throw new Error(`${e.reject.name||""}: ${e.reject.message}`);return e.resolve}class E{#i=String(globalThis.location.host).replace("www.","");#o=function(e){return n.runtime.getURL(e)}("phishing.html");#c=!1;get checked(){return this.#c}phishing=!1;async check(){}}class h{#d;#E=globalThis.document.domain;#h=new E;#p=!1;get stream(){return this.#d}get domain(){return this.#E}get connected(){return this.#p}constructor(){this.#d=new i(t.CONTENT),this.#d.listen((e=>this.#N(e))),this.#_()}#N(e){if(e&&e.type)switch(e.payload.domain=this.domain,e.type){case s.GET_DATA:this.#_();break;case s.CHECK_MASSA_ADDRESS:new c(e).send();break;case s.CONTENT_PROXY_MEHTOD:this.#u(e.payload);break;case s.DISCONNECT_APP:case s.CONNECT_APP:case s.REQUEST_PUB_KEY:case s.TX_TO_SEND:case s.NETWORK_CHANGED:case s.SIGN_MESSAGE:new c(e).send();break;case s.REQUEST_PING:new a({type:s.PING_RESPONSE,payload:{uuid:e.payload.uuid,resolve:!0}}).send(this.#d,t.INJECTED)}}async#u(e){const{body:n,uuid:r}=e,i=t.INJECTED;try{const e=d(await new c({type:s.REQUEST_RPC_PROXY,payload:{bodies:n}}).send());return new a({type:s.CONTENT_PROXY_RESULT,payload:{resolve:e,uuid:r}}).send(this.#d,i)}catch(e){return new a({type:s.CONTENT_PROXY_RESULT,payload:{reject:e.message,uuid:r}}).send(this.#d,i)}}async#_(){const e=d(await new c({type:s.GET_DATA,payload:{domain:this.domain}}).send());this.#h.phishing=e.phishing,this.#p=e.connected,new a({type:s.GET_DATA,payload:e}).send(this.#d,t.INJECTED),this.#h.checked}}!function(){const e=new h,r=Object.values(s);n.runtime.onMessage.addListener(((i,o,c)=>{if(o.id!==n.runtime.id)return;const d=new a(i);if(d.type&&d.payload){if(c({}),r.includes(d.type)){if(d.type===s.ACCOUNT_CHANGED&&!e.connected)return;if(d.type===s.NETWORK_CHANGED&&!e.connected)return;new a({type:d.type,payload:d.payload}).send(e.stream,t.INJECTED)}}else c({reject:"Payload is nullish"})}))}()}();
