const configs={convertToCurrency:"USD",hideOnScroll:!0,convertMetrics:!0,addOpenLinks:!0,addPasteButton:!0,addExtendSelectionButton:!0,convertCurrencies:!0,convertTime:!0,performSimpleMathOperations:!1,preferredMetricsSystem:"metric",showTranslateButton:!0,languageToTranslate:navigator.language||navigator.userLanguage||"en",ratesLastFetchedDate:"",useCustomStyle:!1,tooltipBackground:"#333232",tooltipInvertedBackground:"#bfbfbf",tooltipOpacity:1,addTooltipShadow:!1,shadowOpacity:.5,borderRadius:4,changeTextSelectionColor:!1,textSelectionBackground:"#338FFF",textSelectionColor:"#ffffff",shiftTooltipWhenWebsiteHasOwn:!1,addActionButtonsForTextFields:!1,removeSelectionOnActionButtonClick:!0,hideTooltipOnActionButtonClick:!0,draggableTooltip:!0,enabled:!0,preferredSearchEngine:"google",hideOnKeypress:!0,middleClickHidesTooltip:!1,showOnMapButtonEnabled:!0,showEmailButton:!0,preferredNewEmailMethod:"mailto",customSearchUrl:"",preferredMapsService:"google",addColorPreviewButton:!0,secondaryTooltipEnabled:!0,secondaryTooltipIconSize:16,showSecondaryTooltipTitleOnHover:!1,excludedDomains:"",addPhoneButton:!0,showUnconvertedValue:!1,debugMode:!1,buttonsStyle:"onlylabel",addDragHandles:!0,snapSelectionToWord:!0,preferCurrencySymbol:!1,shouldOverrideWebsiteSelectionColor:!1,disableWordSnappingOnCtrlKey:!0,showButtonLabelOnHover:!0,animationDuration:200,wordSnappingBlacklist:"",disableWordSnapForCode:!1,dontSnapTextfieldSelection:!0,tooltipRevealEffect:"moveUpTooltipEffect",textSelectionBackgroundOpacity:1,updateRatesEveryDays:18,fontSize:12.5,maxIconsInRow:5,secondaryTooltipLayout:"verticalLayout",liveTranslation:!0,recreateTooltipAfterScroll:!1,applyConfigsImmediately:!1,invertColorOnDarkWebsite:!0,addPasteOnlyEmptyField:!0,hideTranslateButtonForUserLanguage:!0,showTranslateIfLanguageUnknown:!0,fullOpacityOnHover:!0,preferredTranslateService:"google",tooltipPosition:"selectionCenter",floatingOffscreenTooltip:!1,showUpdateNotification:!0,convertResultClickAction:"search",delayToRevealSearchTooltip:350,delayToRevealTranslateTooltip:550,delayToRevealHoverPanels:700,showDictionaryButton:!0,showDotForHoverButtons:!0,collapseButtons:!0,addMarkerButton:!0,showStatsOnCopyButtonHover:!0,addFontFormatButtons:!0,showButtonBorders:!0,addClearButton:!0,leftClickBackgroundTab:!1,showTooltipArrow:!0,verticalLayoutTooltip:!1,addButtonToCopyLinkToText:!0,addCalendarButton:!0,hideTooltipWhenCursorMovesAway:!1,showInfoPanel:!0,maxTooltipButtonsToShow:3,maxMarkerPagesToStore:10,dictionaryButtonWordsAmount:1,dictionaryButtonResponseCharsAmount:300,correctTooltipPositionByMoreButtonWidth:!0,addQuoteButton:!0,dragHandleStyle:"circle",customSearchOptionsDisplay:"hoverCustomSearchStyle",collapseAsSecondPanel:!1,translateSingleWordsImmediately:!1,customSearchButtons:[{url:"https://www.youtube.com/results?search_query=%s",title:"YouTube",enabled:!0},{url:"https://open.spotify.com/search/%s",title:"Spotify",enabled:!0},{url:"https://aliexpress.ru/wholesale?catId=&SearchText=%s",title:"Ali (ru)",icon:"https://img.icons8.com/color/452/aliexpress.png",enabled:!0},{url:"https://www.aliexpress.com/wholesale?SearchText=%s",title:"Ali (en)",enabled:!1},{url:"https://www.amazon.com/s?k=%s",title:"Amazon",icon:"https://mapleleafdeals.com/wp-content/uploads/2020/08/amazon.png",enabled:!0},{url:"https://wikipedia.org/w/index.php?search=%s",title:"Wikipedia",enabled:!1},{url:"https://www.imdb.com/find?s=alt&q=%s",title:"IMDB",enabled:!1},{url:"https://google.com/search?q=site:%w %s",title:"Search on website",enabled:!1}]},addressKeywords=[" street","broadway"," st.","str."," city","ул. ","пр. ","улица ","переулок ","город ","проспект ","жк ","трц ","вулиця ","вул.","м. ","місто ","трк ","вуліца ","горад ","праспект ","calle ","ciudad ","ville "," rue","straße","strasse"," stadt"],thousandMultipliers=["thousand","тысяч","тыс"],millionMultipliers=["million","millón","millones","млн","миллион","мільйон"],billionMultipliers=["billion","milliard","mil millones","млрд","миллиард","більйон","мільярд"],convertionUnits={inch:{convertsTo:"cm",ratio:2.54,type:"imperial",variations:["pouces","pulgadas","дюймов","дюйма"]},feet:{convertsTo:"m",ratio:.3048,type:"imperial",variations:[" ft"," foot","pieds","pies"," фута","футов"]},pound:{convertsTo:"kg",ratio:.453592,variations:[" lb","lbs"," libras"," livres"," фунтов"," фунта"]},mph:{convertsTo:"km/h",ratio:1.60934}," mile":{convertsTo:"km",ratio:1.60934,variations:["millas","milles"," миль"," мили"]},yard:{convertsTo:"m",variations:[" yd"," ярдов"],ratio:.9144}," oz":{convertsTo:"gr",ratio:28.3495,variations:["oz."," унций"," унции"," унция"]}," qt":{convertsTo:"L",ratio:.95,variations:[" quarts"]}," gal":{convertsTo:"L",ratio:4.54609,variations:[" gallon"," галлон"," галон"]},"°F":{convertsTo:"°C",convertFunction:function(e){return"metric"==configs.preferredMetricsSystem?5/9*(e-32):9*e/5+32}},"°K":{convertsTo:"°C",convertFunction:function(e){return e-273.15}}},imprerialConvertionUnits={cm:{convertsTo:"inch",ratio:2.54,variations:["см"]},meter:{convertsTo:"ft.",ratio:.3048,variations:[" m."," metros"," mètres"]},kg:{convertsTo:"lbs",ratio:.453592,variations:[" kilogram"]},"km/h":{convertsTo:"mph",ratio:1.60934},km:{convertsTo:"miles",ratio:1.60934,variations:["killometer","kilometr","kilómetros"]}," gr":{convertsTo:"oz",ratio:28.3495,variations:[" gramm"," gramos"]}," liters":{convertsTo:"gal",ratio:4.54609},"°C":{convertsTo:"°F",convertFunction:function(e){return 9*e/5+32}},"°K":{convertsTo:"°F",convertFunction:function(e){return 1.8*e-459.67}}},timeZoneKeywords={GMT:"GMT",UTC:"UTC",WET:"UTC",AKST:"-0900",PST:"-0800",PDT:"-0700",MST:"-0700",MDT:"-0600",CST:"-0600",EST:"-0500",AST:"-0400",EDT:"-0400",NST:"-0330",HAST:"-1000",AEST:"+1000",CET:"+0100",WAT:"+0100",BST:"+0100",MET:"+0100",CEST:"+0200",EET:"+0200",EEST:"+0200",EET:"+0200",CAT:"+0200",MSK:"+0300",EAT:"+0300",IST:"+0530",AWST:"+0800",JST:"+0900",KST:"+0900",ACST:"+0930","по Московскому времени":"+0300","по московскому времени":"+0300","по Москве":"+0300","по центральноевропейскому времени":"+0100","по европейскому времени":"+0100","по тихоокеанскому времени":"-0800","по Гринвичу":"GMT"},filetypesToIgnoreAsDomains=["txt","zip","rar","7z","mp3","mp4","png","jpg","gif","wav","exe","cfg","ini","js","html","css","log","php"],codeMarkers=["const ","var ","let ","async ","await ","/>","{","}","()"," = ","='",'="',"('",'("','": "',"//","/*"],dateKeywords={month:["jan","feb","mar","apr","may","june","july","aug","sept","oct","nov","dec","янв","фев","март","апр","мая","июн","июл","авг","сен.","окт.","ноя.","дек.","enero","feb.","marzo","abr.","mayo","jun.","jul.","agosto","set.","oct.","nov.","dic."],weekday:["monday","tuesday","wednesday","thursday","friday","saturday","sunday","понедельник","вторник","среда","четверг","пятница","суббота","воскресенье","lunes","martes","miércoles","jueves","viernes","sábado","domingo"],tomorrow:["tomorrow","завтра","mañana","demain"]},currenciesList={AUD:{currencyName:"Australian Dollar",currencySymbol:"A$",rate:1.29009,currencyKeywords:["australian dollar","австралийских доллар"]},BGN:{currencyName:"Bulgarian Lev",currencySymbol:"лв",rate:1.640562},BRL:{currencyName:"Brazilian real",currencySymbol:"R$",rate:5.616101},BTC:{currencyName:"Bitcoin",rate:18e-6,currencyKeywords:["bitcoins","биткоин"]},BYN:{currencyName:"Belarussian Ruble",rate:2.596137,currencyKeywords:["белорусских рублей"]},CAD:{currencyName:"Canadian Dollar",currencySymbol:"C$",rate:1.269384,currencyKeywords:["canadian dollar","канадских доллар"]},CHF:{currencyName:"Swiss Franc",currencySymbol:"CHF",rate:.926525},CNY:{currencyName:"Chinese Yuan",currencySymbol:"¥",rate:6.497301,currencyKeywords:["yuan","юаней"]},CRC:{currencyName:"Costa Rican Colon",currencySymbol:"₡",rate:610.339772},CZK:{currencyName:"Czech Koruna",currencySymbol:"Kč",rate:21.936455},DKK:{currencyName:"Danish Krone",currencySymbol:" kr",rate:6.229502},EUR:{currencyName:"Euro",currencySymbol:"€",rate:.8378,currencyKeywords:["euro","евро"]},GBP:{currencyName:"British Pound",currencySymbol:"£",rate:.721124,currencyKeywords:["фунтов стерлингов","british pound"]},HKD:{currencyName:"Hong Kong dollar",currencySymbol:"HK$",rate:7.765632},HUF:{currencyName:"Hungarian forint",rate:316.005504},IDR:{currencyName:"Indonesian Rupiah",currencySymbol:"Rp",rate:15711.86182839,currencyKeywords:["Rp","Rupiah"]},ILS:{currencyName:"Israeli New Sheqel",currencySymbol:"₪",rate:3.310401},INR:{currencyName:"Indian Rupee",currencySymbol:"₹",rate:72.452006,currencyKeywords:["rupees","рупий"]},IRR:{currencyName:"Iranian Rial",currencySymbol:"﷼",rate:42105.017329},JPY:{currencyName:"Japanese Yen",currencySymbol:"¥",rate:109.188027,currencyKeywords:[" yen"," йен"]},KRW:{currencyName:"South Korean Won",currencySymbol:"₩",rate:1193.057307},KPW:{currencyName:"North Korean Won",currencySymbol:"₩",rate:900.00022},KZT:{currencyName:"Kazakhstani Tenge",currencySymbol:"₸",rate:418.821319,currencyKeywords:["тенге"]},MNT:{currencyName:"Mongolian Tugrik",currencySymbol:"₮",rate:2849.930035},MXN:{currencyName:"Mexican Peso",currencySymbol:"peso",rate:20.655212,currencyKeywords:["peso","песо"]},MYR:{currencyName:"Malaysian Ringgit",currencySymbol:"RM",rate:4.208613,currencyKeywords:["myr"]},NGN:{currencyName:"Nigerian Naira",currencySymbol:"₦",rate:410.317377},NOK:{currencyName:"Norwegian Krone",currencySymbol:" kr",rate:8.51191},PHP:{currencyName:"Philippine Peso",currencySymbol:"₱",rate:56.012,currencyKeywords:["pesos","php"],searchInText:!1},PLN:{currencyName:"Polish złoty",currencySymbol:"zł",rate:3.845051},RON:{currencyName:"Romanian leu",currencySymbol:"leu",rate:5.058587},RUB:{currencyName:"Russian Ruble",currencySymbol:"₽",rate:72.880818,currencyKeywords:["rubles","рублей","руб"," р."]},SAR:{currencyName:"Saudi Riyal",currencySymbol:"﷼",rate:3.750694},SEK:{currencyName:"Swedish Krona",currencySymbol:" kr",rate:8.514027},THB:{currencyName:"Thai Baht",currencySymbol:"฿",rate:34.700854,currencyKeywords:["THB","Baht","baht"]},TRY:{currencyName:"Turkish Lira",currencySymbol:"₺",rate:.14},TWD:{currencyName:"New Taiwan dollar",currencySymbol:"NT$",rate:31.99368752},UAH:{currencyName:"Ukrainian Hryvnia",currencySymbol:"₴",rate:27.852288,currencyKeywords:["hryvnia","гривен","грн"]},USD:{currencyName:"United States Dollar",currencySymbol:"$",rate:1,currencyKeywords:["dollar","dolar","доллар"]},VND:{currencyName:"Vietnamese Dong",currencySymbol:"₫",rate:23054.385489},ZAR:{currencyName:"Rand",rate:14.856969},ETH:{currencyName:"Ethereum",rate:3208e-7,crypto:!0},LTC:{currencyName:"Litecoin",rate:.006242,crypto:!0},ADA:{currencyName:"Cardano",rate:.4492,crypto:!0},MIOTA:{currencyName:"MIOTA",rate:.7418,crypto:!0},EOS:{currencyName:"EOS",rate:.2336,crypto:!0},BCH:{currencyName:"BCH",rate:.001843,crypto:!0},XRP:{currencyName:"XRP",rate:1.016,crypto:!0},ZEC:{currencyName:"ZEC",rate:.008209,crypto:!0},XMR:{currencyName:"XMR",rate:.004037,crypto:!0},ZCL:{currencyName:"XMR",rate:7.348,crypto:!0},DOGE:{currencyName:"DOGE",rate:4.537,crypto:!0}};function returnSearchUrl(e,t=!0){let o=e;switch(t&&(o=encodeURI(e)),o=o.replaceAll("&","%26").replaceAll("+","%2B"),configs.preferredSearchEngine){case"google":return`https://www.google.com/search?q=${o}`;case"duckduckgo":return`https://duckduckgo.com/?q=${o}`;case"bing":return`https://www.bing.com/search?q=${o}`;case"yandex":return`https://yandex.ru/search/?text=${o}`;case"baidu":return`http://www.baidu.com/s?wd=${o}`;case"yahoo":return`https://search.yahoo.com/search?p=${o}`;case"custom":return configs.customSearchUrl.replaceAll("%s",o)}}function returnNewEmailUrl(e,t=!0){let o=e;switch(t&&(o=encodeURI(e)),o=o.replaceAll("&","%26").replaceAll("+","%2B"),configs.preferredNewEmailMethod){case"mailto":return`mailto:${e}`;case"gmail":return`https://mail.google.com/mail/?view=cm&fs=1&to=${o}`;case"yahoo":return`https://compose.mail.yahoo.com/?to=${o}`;case"outlook":return`https://outlook.com/?path=/mail/action/compose&to=${o}`}}function returnShowOnMapUrl(e,t=!0){let o=e;switch(t&&(o=encodeURI(e)),o=o.replaceAll("&","%26").replaceAll("+","%2B"),configs.preferredMapsService){case"google":return`https://www.google.com/maps/place/${o}`;case"2gis":case"2gisUA":return`https://2gis.ua/search/${o}`;case"2gisRU":return`https://2gis.ru/search/${o}`;case"yandexmaps":return`https://yandex.ru/maps/geo/${o}`;case"waze":return`https://www.waze.com/ru/live-map?q=${o}`;case"mapquest":return`https://www.mapquest.com/search/results?query=${o}`}}function returnTranslateUrl(e,t){let o=encodeURI(e.trim());switch(configs.preferredTranslateService){case"google":return`https://translate.google.com/?sl=auto&tl=${t??configs.languageToTranslate}&text=${o}`;case"yandex":return`https://translate.yandex.ru/?lang=auto-${t??configs.languageToTranslate}&text=${o}`;case"bing":return`https://www.bing.com/translator?from=auto&to=${t??configs.languageToTranslate}&text=${o}`;case"deepl":return`https://www.deepl.com/translator#auto/${t??configs.languageToTranslate}/${o}`}}var selection,selectedText,tooltip,secondaryTooltip,arrow,infoPanel,searchButton,copyButton,verticalSecondaryTooltip,draggingHandleIndex,lastMouseUpEvent,ratesLastFetchedDate,browserLanguage,browserCurrency,browserMetricSystem,domainIsBlacklistedForSnapping,selectedTextIsCode,addButtonIcons,timerToRecreateOverlays,convertWhenOnlyFewWordsSelected=!0,wordsLimitToProccessText=5,secondaryColor="lightBlue",linkSymbolsToShow=20,selectionHandleLineHeight=21,copyLabel="Copy",searchLabel="Search",openLinkLabel="Open",translateLabel="Translate",showOnMapLabel="Show on map",cutLabel="Cut",pasteLabel="Paste",dictionaryLabel="Dictionary",markerLabel="Highlight",italicLabel="Italic",boldLabel="Bold",strikeLabel="Strike",clearLabel="Clear",tooltipIsShown=!1,dontShowTooltip=!1,isDraggingTooltip=!1,isDraggingDragHandle=!1,isDarkTooltip=!0,firstButtonBorderRadius="3px 0px 0px 3px",lastButtonBorderRadius="0px 3px 3px 0px",onlyButtonBorderRadius="3px",tooltipOnBottom=!1,configsWereLoaded=!1,currencyRatesWereLoaded=!1,isTextFieldFocused=!1,isTextFieldEmpty=!0,delayToRecreateOverlays=150,floatingTooltipTop=!1,floatingTooltipBottom=!1;const searchButtonIcon=chrome.runtime.getURL("assets/icons/button-icons/search.svg"),copyButtonIcon=chrome.runtime.getURL("assets/icons/button-icons/copy.svg"),translateButtonIcon=chrome.runtime.getURL("assets/icons/button-icons/translate.svg"),dictionaryButtonIcon=chrome.runtime.getURL("assets/icons/button-icons/dictionary.svg"),openLinkButtonIcon=chrome.runtime.getURL("assets/icons/button-icons/open.svg"),cutButtonIcon=chrome.runtime.getURL("assets/icons/button-icons/cut.svg"),pasteButtonIcon=chrome.runtime.getURL("assets/icons/button-icons/paste.svg"),mapButtonIcon=chrome.runtime.getURL("assets/icons/button-icons/map.svg"),emailButtonIcon=chrome.runtime.getURL("assets/icons/button-icons/email.svg"),phoneIcon=chrome.runtime.getURL("assets/icons/button-icons/call.svg"),boldTextIcon=chrome.runtime.getURL("assets/icons/button-icons/bold.svg"),italicTextIcon=chrome.runtime.getURL("assets/icons/button-icons/italic.svg"),strikeTextIcon=chrome.runtime.getURL("assets/icons/button-icons/strike.svg"),clockIcon=chrome.runtime.getURL("assets/icons/button-icons/time.svg"),markerIcon=chrome.runtime.getURL("assets/icons/button-icons/highlighter.svg"),clearIcon=chrome.runtime.getURL("assets/icons/button-icons/clear.svg"),linkIcon=chrome.runtime.getURL("assets/icons/button-icons/link.svg"),calendarIcon=chrome.runtime.getURL("assets/icons/button-icons/calendar.svg"),quoteIcon=chrome.runtime.getURL("assets/icons/button-icons/quote.svg"),extendSelectionIcon=chrome.runtime.getURL("assets/icons/button-icons/extend-selection.svg");function getCurrentClipboard(){const e=document.activeElement;let t;const o=document.createElement("input");return o.setAttribute("style","position: fixed; top: 0px; left: 0px; opacity: 0;"),document.body.appendChild(o),o.focus(),document.execCommand("paste"),t=o.value,document.execCommand("undo"),o.blur(),document.body.removeChild(o),e.focus(),t}function copyManuallyToClipboard(e){try{const t=document.createElement("input");t.setAttribute("style","position: fixed; top: 0px; left: 0px; opacity: 0.0;"),document.body.appendChild(t),t.value=e,t.focus(),t.select(),document.execCommand("Copy"),t.remove()}catch(t){navigator.clipboard.writeText(e)}}function getTextColorForBackground(e){var t=hexToRgb(e),o=(.299*t.red+.587*t.green+.114*t.blue)/255;isDarkTooltip=!(o>.5)}function hexToRgb(e){var t=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(e);return t?{red:parseInt(t[1],16),green:parseInt(t[2],16),blue:parseInt(t[3],16)}:null}function rgbToHex(e,t,o){return"#"+((1<<24)+(e<<16)+(t<<8)+o).toString(16).slice(1)}var UTILS={};function fetchCurrencyRates(){chrome.runtime.sendMessage({type:"check_currencies",currenciesList,debugMode:configs.debugMode})}function loadCurrencyRatesFromMemory(){currencyRatesWereLoaded||chrome.storage.local.get("rates",(function(e){if(null==e||null==e||e=={})return;const t=e.rates,o=Object.keys(currenciesList);for(let e=0,n=o.length;e<n;e++)try{let n=o[e],i=t[n];null!=i&&(currenciesList[n].rate=i)}catch(e){}currencyRatesWereLoaded=!0,configs.debugMode&&(console.log("Selecton currency rates loaded from memory:"),console.log(t))}))}function addAstrixToHoverButton(e){if(0==configs.showDotForHoverButtons)return;const t=document.createElement("span");return t.className="selecton-hover-button-indicator",e.appendChild(t),t}function showHoverIndicator(e){0!=configs.showDotForHoverButtons&&(e.style.opacity=.3)}function hideHoverIndicator(e){0!=configs.showDotForHoverButtons&&(e.style.opacity=0)}function createHoverPanelForButton(e,t,o,n=!1,i=!0,l=!1,s=!0,r=!1){let c,a,d=i?addAstrixToHoverButton(e):void 0;const u=configs.showInfoPanel?"107%":"112%";let g=document.createElement("div");g.className="hover-vertical-tooltip selecton-entity",g.style.borderRadius=`${configs.useCustomStyle?configs.borderRadius:3}px`,g.style.opacity=0,g.style.visibility="collapse",g.style.width="0px",g.style.pointerEvents="none",g.style.width="max-content",t&&(g.innerHTML=t),tooltipOnBottom?g.style.top=r?u:"125%":g.style.bottom=r?u:"125%",n?g.style.left="0px":g.style.right="0px",configs.addTooltipShadow&&(g.style.boxShadow=`0 1px 5px rgba(0,0,0,${configs.shadowOpacity/1.5})`);let p=configs.verticalLayoutTooltip?"2px":n?"-2px":"2px",f=!1;if(setTimeout((function(){g.isConnected&&(configs.verticalLayoutTooltip||(tooltipOnBottom?(f=!0,m(g,e)):f=function(e,t){try{return e.getBoundingClientRect().top<0&&(m(e,t),!0)}catch(e){return!1}}(g,e),s&&e&&e.classList.add(f?"button-with-bottom-hover-panel":"button-with-top-hover-panel")),g.style.transform=configs.verticalLayoutTooltip?"translate(-100%, 0)":`translate(${p}, ${f?-100:100}%)`)}),configs.animationDuration),r&&setTimeout((()=>{e&&e.classList.toggle("highlighted-popup-button"),h(g,p),i&&hideHoverIndicator(d),o&&o()}),configs.animationDuration),e){const t=i?configs.delayToRevealHoverPanels??700:3;let n=!1;l&&e.addEventListener("mousedown",(function(t){t.stopPropagation(),n=!n,e.classList.toggle("highlighted-popup-button")})),e.addEventListener("mouseover",(function(){try{clearTimeout(c),clearTimeout(a)}catch(e){}c=null,a=setTimeout((function(){h(g,p),i&&hideHoverIndicator(d),o&&o()}),t)})),e.addEventListener("mouseout",(function(){n||(clearTimeout(a),c=setTimeout((function(){g&&(!function(e,t,o){e.style.transform=configs.verticalLayoutTooltip?"translate(-100%, 0)":`translate(${t}, ${o?-100:100}%)`,e.style.opacity=0,e.style.pointerEvents="none",setTimeout((function(){e&&tooltipIsShown&&(e.style.width="0",e.style.visibility="collapse")}),configs.animationDuration)}(g,p,f),i&&showHoverIndicator(d))}),150))})),e.addEventListener("mousedown",(function(e){try{clearTimeout(a)}catch(e){}}))}function m(e,t){e.style.bottom="unset",e.style.top=r?u:"125%",t?t.classList.add("higher-z-index"):e.parentNode&&e.parentNode.classList.add("higher-z-index")}function h(e,t){e.style.opacity>0||(e.style.width="max-content",e.style.visibility="visible",setTimeout((function(){e.style.opacity=1,e.style.transform=`translate(${t},0)`,function(e){try{const t=e.getBoundingClientRect();if(window.innerWidth-t.left-2*t.width<0)return configs.verticalLayoutTooltip&&(e.style.transform="translate(-215%, 0)"),!0;if(!(t.left<0))return!1;e.style.right=`${t.left}px`}catch(e){return!1}}(e),setTimeout((function(){e&&tooltipIsShown&&(e.style.pointerEvents="all")}),configs.animationDuration)}),3))}return g}function setDefaultLocales(){let e,t=navigator.language||navigator.userLanguage;if(configs.debugMode&&(console.log("Browser locale is: "+t),console.log("Configuring default locale settings...")),t.replaceAll(" ",""),t.includes("-")){let o=t.split("-");browserLanguage=o[0],e=o[1]}else browserLanguage=t,e=t.toUpperCase();if(null!=e&&""!==e){browserMetricSystem="US"==e?"imperial":"metric";let t=Object.keys(currenciesList);for(let o=0,n=t.length;o<n;o++){let n=t[o];n.includes(e)&&(browserCurrency=n)}configs.debugMode&&(console.log(`Default browser language: ${browserLanguage}`),console.log(`Default browser metrics: ${browserMetricSystem}`),console.log(`Default browser currency: ${browserCurrency}`),console.log("Saved default locales to memory"))}chrome.storage.local.set({convertToCurrency:browserCurrency||"USD",languageToTranslate:browserLanguage||"en",preferredMetricsSystem:browserMetricSystem||"metric"})}UTILS.cssPath=function(e,t){if(e.nodeType!==Node.ELEMENT_NODE)return"";for(var o=[],n=e;n;){var i=UTILS._cssPathStep(n,!!t,n===e);if(!i)break;if(o.push(i),i.optimized)break;n=n.parentNode}return o.reverse(),o.join(" > ")},UTILS._cssPathStep=function(e,t,o){if(e.nodeType!==Node.ELEMENT_NODE)return null;var n=e.getAttribute("id");if(t){if(n)return new UTILS.DOMNodePathStep(c(n),!0);var i=e.nodeName.toLowerCase();if("body"===i||"head"===i||"html"===i)return new UTILS.DOMNodePathStep(e.nodeName.toLowerCase(),!0)}var l=e.nodeName.toLowerCase();if(n)return new UTILS.DOMNodePathStep(l.toLowerCase()+c(n),!0);var s=e.parentNode;if(!s||s.nodeType===Node.DOCUMENT_NODE)return new UTILS.DOMNodePathStep(l.toLowerCase(),!0);function r(e){var t=e.getAttribute("class");return t?t.split(/\s+/g).filter(Boolean).map((function(e){return"$"+e})):[]}function c(e){return"#"+a(e)}function a(e){if(/^-?[a-zA-Z_][a-zA-Z0-9_-]*$/.test(e))return e;var t=/^(?:[0-9]|-[0-9-]?)/.test(e),o=e.length-1;return e.replace(/./g,(function(e,n){return t&&0===n||!function(e){return!!/[a-zA-Z0-9_-]/.test(e)||e.charCodeAt(0)>=160}(e)?function(e,t){return"\\"+function(e){var t=e.charCodeAt(0).toString(16);1===t.length&&(t="0"+t);return t}(e)+(t?"":" ")}(e,n===o):e}))}for(var d=r(e),u=!1,g=!1,p=-1,f=s.children,m=0;(-1===p||!g)&&m<f.length;++m){var h=f[m];if(h!==e){if(!g&&h.nodeName.toLowerCase()===l.toLowerCase()){u=!0;var y=d,T=0;for(var b in y)++T;if(0!==T)for(var w=r(h),x=0;x<w.length;++x){var v=w[x];if(!y.indexOf(v)&&(delete y[v],! --T)){g=!0;break}}else g=!0}}else p=m}var S=l.toLowerCase();if(o&&"input"===l.toLowerCase()&&e.getAttribute("type")&&!e.getAttribute("id")&&!e.getAttribute("class")&&(S+='[type="'+e.getAttribute("type")+'"]'),g)S+=":nth-child("+(p+1)+")";else if(u)for(var C in d)S+="."+a(d[C].substr(1));return new UTILS.DOMNodePathStep(S,!1)},UTILS.DOMNodePathStep=function(e,t){this.value=e,this.optimized=t||!1},UTILS.DOMNodePathStep.prototype={toString:function(){return this.value}};const markers=[];function createSelectionHighlightSpan(e,t,o,n){let i=document.createElement("span");return i.style.backgroundColor=e??"yellow",i.style.color=t??"black",i.style.position="relative",i.className="selecton-marker-highlight",configs.debugMode&&setTimeout((function(){console.log("created text marker:"),console.log(i)}),3),setTimeout((function(){let e=document.createElement("div");if(e.className="marker-highlight-delete",e.textContent="✕",e.title=chrome.i18n.getMessage("deleteLabel"),i.appendChild(e),o.timeAdded){let e=new Date;e.setTime(o.timeAdded),i.title=chrome.i18n.getMessage("markedLabel")+" "+e.toLocaleString()}e.onclick=function(){try{n.remove(),i.outerHTML=i.innerHTML;const e=markers.indexOf(o);e>-1&&(markers.splice(e,1),saveAllMarkers())}catch(e){configs.debugMode&&console.log(e)}}}),100),i}function markTextSelection(e,t,o,n){const i=n?{}:getSelectionRectDimensions();let l=o,s=document.createElement("div");s.className="marker-scrollbar-hint",s.style.backgroundColor=e??"yellow";let r=n?n.hintDy:(i.dy+window.scrollY)*window.innerHeight/document.body.scrollHeight;r<5&&(r=5),r>window.innerHeight-5&&(r=window.innerHeight-5),s.style.top=`${r}px`;let c=n?n.hintHeight:i.height*window.innerHeight/document.body.scrollHeight;c<10&&(c=10),s.style.height=`${c}px`;const a=markers.filter((e=>e.hintDy===r)),d=a.length;let u;0!==d&&(u=100*d,s.style.transform=`translate(-${u+5}%, 0)`);let g=document.createElement("span");g.innerText=o,g.className="marker-scrollbar-tooltip",g.style.maxWidth=.3*window.innerWidth+"px",g.style.maxHeight=.6*window.innerHeight+"px",s.appendChild(g),document.body.appendChild(s);let p,f;if(g.getBoundingClientRect().top<0&&g.classList.add("marker-scrollbar-tooltip-bottom"),n)p=n.startContainer;else{f=selection.getRangeAt(0);let e=f.startContainer,t=1==e.nodeType?e:e.parentNode;if(f.startContainer!=f.endContainer){let e,n="",i=t.innerHTML;for(let t=0,l=o.length;t<l;t++)if(n+=o[t],!i.includes(n)){e=t;break}e&&e>0&&(l=l.substr(0,e)),f.setEnd(t,1)}p=getNodeSelector(t)}let m=n??{hintDy:r,hintHeight:c,startContainer:p,background:e??"yellow",foreground:t??"black",text:l,timeAdded:n?n.timeAdded??"":(new Date).getTime()};markers.push(m);let h=createSelectionHighlightSpan(e,t,m,s);if(n){const e=document.querySelector(n.startContainer);if(!e)return;const t=e.innerHTML;let i=t.indexOf(o);null!=i&&i>-1&&(h.innerHTML=t.substring(i,i+o.length),e.innerHTML=t.substring(0,i),e.appendChild(h),e.insertAdjacentHTML("beforeend",t.substring(i+o.length,t.length)))}else{const e=f.extractContents();h.appendChild(e),f.insertNode(h),f.detach()}s.onmousedown=function(){h.scrollIntoView({block:"center",inline:"nearest",behavior:"smooth"})}}function getNodeSelector(e){return UTILS.cssPath(e)}function saveAllMarkers(){setTimeout((function(){if(markers)try{chrome.storage.local.get(["websiteMarkers"],(function(e){let t=e.websiteMarkers;if(t||(t={}),markers.length<=0)delete t[window.location.href];else{let e=Object.keys(t);e.length==(configs.maxMarkerPagesToStore??10)&&delete t[e[0]],t[window.location.href]||(t[window.location.href]={}),document.title&&(t[window.location.href].title=document.title),t[window.location.href].timeUpdated=(new Date).getTime(),t[window.location.href].markers=markers}chrome.storage.local.set({websiteMarkers:t})}))}catch(e){console.log(e)}}),5)}function restoreMarkers(){configs.debugMode&&(console.log("--------"),console.log("Searching for markers on current page...")),chrome.storage.local.get(["websiteMarkers"],(function(e){if(configs.debugMode&&(console.log("restored markers:"),console.log(e)),e.websiteMarkers&&e.websiteMarkers[window.location.href]){let t=e.websiteMarkers[window.location.href].markers;if(t){configs.debugMode&&(console.log("Found markers for current page:"),console.log(t));const e=t.length;if(e&&e>0)for(let o=0;o<e;o++){const e=t[o];try{markTextSelection(e.background,e.foreground,e.text,e)}catch(e){configs.debugMode&&console.log(e)}}}}}))}function initMarkersRestore(){function e(){try{restoreMarkers()}catch(e){console.log(e)}try{chrome.runtime.onMessage.addListener((e=>{if(e.command.includes("selecton-scroll-to-marker-message")){const t=parseInt(e.command.split(":")[1]);if(!t||isNaN(t))return;console.log("selectedHintDy"),console.log(t);const o=t*document.body.scrollHeight/window.innerHeight;window.scrollTo(0,o-window.innerHeight/2)}}))}catch(e){console.log(e)}}"complete"===document.readyState||"interactive"===document.readyState?e():document.addEventListener("DOMContentLoaded",e)}function getSelectionCoordinates(e){const t=selection??window.getSelection();if(!t.rangeCount)return null;const o=t.getRangeAt(0).cloneRange();if(!o.getClientRects)return null;o.collapse(e);const n=o.getBoundingClientRect();let i;try{let e=document.createRange();e.setStart(t.anchorNode,t.anchorOffset),e.setEnd(t.focusNode,t.focusOffset),i=e.collapsed,e.detach()}catch(e){console.log(e)}let l={dx:n.x,dy:n.y,backwards:i,lineHeight:n.height};if(0==n.x&&0==n.y){let t=getSelectionRectDimensions();l=e?{dx:t.dx,dy:t.dy,backwards:i}:{dx:t.dx+t.width,dy:t.dy+t.height-(selectionHandleLineHeight-7.5),backwards:i}}return 0==l.dx&&0==l.dy&&(l={dx:lastMouseUpEvent.clientX,dy:lastMouseUpEvent.clientY-8,backwards:i,dontAddDragHandles:!0}),l}function snapSelectionByWords(e){if(configs.debugMode&&console.log("Snapping selection by word..."),e&&!e.isCollapsed){let t=e.toString();const o=t.length;let n,i=t[0],l=t[o-1];const s=e.focusNode,r=e.focusOffset,c=e.anchorNode,a=document.createRange();a.setStart(e.anchorNode,e.anchorOffset),a.setEnd(e.focusNode,e.focusOffset);const d=a.collapsed;let u;a.detach(),e.collapse(e.anchorNode,e.anchorOffset),u=d?["backward","forward"]:["forward","backward"],e.modify("move",u[0],"character"),n=d?l:i," "==n&&e.modify("move",u[0],"character"),e.modify("move",u[1],"word"),e.extend(s,r),t=e.toString(),i=t[0],l=t[t.length-1],n=d?l:i," "==n&&(e.collapse(e.anchorNode,e.anchorOffset),e.modify("move",u[0],"character"),e.extend(s,r));const g=15,p=50;if(e.anchorNode!=c&&o<p){let t=0;for(e.collapse(e.anchorNode,e.anchorOffset);e.anchorNode!=c&&!(t>=g);)t+=1,e.modify("move",u[0],"character");e.modify("move",u[1],"character"),e.extend(s,r)}if(e.modify("extend",u[1],"character"),n=d?i:l," "!==n&&""!==n&&e.modify("extend",u[0],"word"),e.focusNode!=s&&o<p){let t=0;for(;e.focusNode!=s&&!(t>=g);)t+=1,e.modify("extend",u[1],"character");e.modify("extend",u[0],"character")}t=e.toString();const f=t.length;i=t[0],l=t[f-1],n=d?i:l;let m=!1;switch(n){case" ":case"(":case")":m=!0;break;case",":")"==t[f-2]&&e.modify("extend",u[1],"character"),m=!0;break;case":":'"'==t[f-2]&&e.modify("extend",u[1],"character"),m=!0}m&&e.modify("extend",u[1],"character")}}function getSelectionRectDimensions(){let e,t,o=0,n=0,i=0,l=0;if(e=selection??window.getSelection(),e.rangeCount&&(t=e.getRangeAt(0).cloneRange(),t.getBoundingClientRect)){const e=t.getBoundingClientRect();o=e.right-e.left,n=e.bottom-e.top,i=e.left,l=e.top}return{width:o,height:n,dx:i,dy:l}}function extendSelectionByWord(e,t){function o(){e.modify("extend",l?"backward":"forward","word")}function n(){var t=e.focusNode,o=e.focusOffset;e.collapse(e.anchorNode,e.anchorOffset),l?e.modify("move","forward","word"):e.modify("move","backward","word"),e.extend(t,o)}var i=document.createRange();i.setStart(e.anchorNode,e.anchorOffset),i.setEnd(e.focusNode,e.focusOffset);var l=i.collapsed;i.detach(),0==t?l?o():n():l?n():o()}function removeSelectionOnPage(){if(configs.removeSelectionOnActionButtonClick){const e=window.getSelection?window.getSelection():document.selection;e&&(e.removeAllRanges?e.removeAllRanges():e.empty&&e.empty(),configs.addDragHandles&&hideDragHandles())}else dontShowTooltip=!0,setTimeout((function(){dontShowTooltip=!1}),configs.animationDuration)}function createSelectionFromPoint(e,t,o,n,i){var l,s,r,c,a,d,u=document,g=null;const p=selection??window.getSelection();let f=document.createRange();f.setStart(p.anchorNode,p.anchorOffset),f.setEnd(p.focusNode,p.focusOffset);let m=f.collapsed;if(f.detach(),m?(r=o,c=n,a=e,d=t):(r=e,c=t,a=o,d=n),void 0!==u.body.createTextRange){(g=u.body.createTextRange()).moveToPoint(r,c);const e=g.duplicate();e.moveToPoint(a,d),g.setEndPoint("EndToEnd",e),g.select()}else{if(void 0!==u.caretPositionFromPoint)l=u.caretPositionFromPoint(r-2,c),s=u.caretPositionFromPoint(a-2,d),g=u.createRange(),0==i?m?(g.setStart(l.offsetNode,l.offset),g.setEnd(p.anchorNode,p.anchorOffset)):(g.setStart(s.offsetNode,s.offset),g.setEnd(p.focusNode,p.focusOffset)):m?(g.setStart(p.focusNode,p.focusOffset),g.setEnd(l.offsetNode,l.offset)):(g.setStart(p.anchorNode,p.anchorOffset),g.setEnd(s.offsetNode,s.offset));else if(void 0!==u.caretRangeFromPoint){const e=window.innerHeight||document.documentElement.clientHeight||document.body.clientHeight;c<0&&(c=0),d>e&&(d=e-15),l=u.caretRangeFromPoint(r,c),s=u.caretRangeFromPoint(a,d),g=u.createRange(),0==i?m?(g.setStart(l.startContainer,l.startOffset),g.setEnd(p.anchorNode,p.anchorOffset)):(g.setStart(s.startContainer,s.startOffset),g.setEnd(p.focusNode,p.focusOffset)):m?(g.setStart(p.focusNode,p.focusOffset),g.setEnd(l.startContainer,l.startOffset)):(g.setStart(p.anchorNode,p.anchorOffset),g.setEnd(s.startContainer,s.startOffset))}else void 0!==u.elementFromPoint&&"getClientRects"in u.createRange()&&(l=positionFromPoint(u,r,c),s=positionFromPoint(u,a,d),g=u.createRange(),0==i?m?(g.setStart(l.offsetNode,l.offset),g.setEnd(p.anchorNode,p.anchorOffset)):(g.setStart(s.offsetNode,s.offset),g.setEnd(p.focusNode,p.focusOffset)):m?(g.setStart(p.focusNode,p.focusOffset),g.setEnd(l.offsetNode,l.offset)):(g.setStart(p.anchorNode,p.anchorOffset),g.setEnd(s.offsetNode,s.offset)));if(null!==g&&void 0!==window.getSelection){if(p.removeAllRanges(),m&&p.extend){const e=g.cloneRange();e.collapse(!1),p.addRange(e),p.extend(g.startContainer,g.startOffset)}else p.addRange(g);g.detach()}}}function getNodeIndex(e){for(var t=0;e=e.previousSibling;)t++;return t}function getLastRangeRect(e){var t=e.getClientRects();return t.length>0?t[t.length-1]:null}function pointIsInOrAboveRect(e,t,o){return t<o.bottom&&e>=o.left&&e<=o.right}function positionFromPoint(e,t,o,n){var i=e.elementFromPoint(t,o),l=e.createRange();l.selectNodeContents(i),l.collapse(!0);var s,r,c=i.firstChild;if(c){e:for(;c;){if(3==c.nodeType){for(s=0,textLen=c.length;s<=textLen;++s)if(l.setEnd(c,s),(r=getLastRangeRect(l))&&pointIsInOrAboveRect(t,o,r)){r.right-t>t-r.left&&--s;break e}}else if(l.setEndAfter(c),(r=getLastRangeRect(l))&&pointIsInOrAboveRect(t,o,r)){s=getNodeIndex(c),c=i.parentNode,n||++s;break e}c=c.nextSibling}c||(c=i,s=i.childNodes.length)}else c=i.parentNode,s=getNodeIndex(i),n||++s;return{offsetNode:c,offset:s}}function selectionChangeListener(e){1==tooltipIsShown&&(selection=null,hideTooltip(),hideDragHandles(),document.removeEventListener("selectionchange",selectionChangeListener))}function extendSelectionToParentEl(){const e=selection??window.getSelection(),t=document.createRange(),o=e.toString().trim(),n=e.anchorNode!==e.focusNode?e.anchorNode.parentNode.parentNode:e.anchorNode.parentNode;t.selectNodeContents(n),setTimeout((function(){e.removeAllRanges(),e.addRange(t);const n=e.toString().trim();o===n&&extendParentSelectionCounter<5?(configs.debugMode&&console.log("Selection has not changed! Attempting one more time: "+extendParentSelectionCounter),extendParentSelectionCounter+=1,extendSelectionToParentEl()):(configs.debugMode&&console.log("Finished extending text selection"),extendParentSelectionCounter=0)}),0)}let extendParentSelectionCounter=0;const convertTime12to24=e=>{const[t,o]=e.split(" ");let[n,i]=t.split(":");if("12"===n&&(n="00"),"PM"===o){if(n=parseInt(n,10)+12,n>24||n<0)return e}else if("AM"!==o)return e;return isNaN(n)?e:`${n}:${i??"00"}`},convertTime24to12=e=>{let[t,o]=e.split(":");"00"===t&&(t="12");let n="AM";return t=parseInt(t,10),t>12&&(t-=12,n="PM"),isNaN(t)?e:`${t}:${o??"00"} ${n}`};function splitNumberInGroups(e){const t=e.split(".");return t[0]=t[0].replace(/\B(?=(\d{3})+(?!\d))/g," "),"00"==t[1]&&(t[1]=""),""==t[1]?t[0]:t.join(".")}function returnDomainFromUrl(e,t=!0){if(null==e||null==e||""==e)return"";try{let o,n=e.split(".");return o=2==n.length?n[0]:3==n.length?n[1].includes("/")?n[0]:n[1]:e.textContent.split("/")[2].split(".")[0],o=o.replaceAll("https://",""),null==o||null==o?"":0==t?o:o.charAt(0).toUpperCase()+o.slice(1)}catch(e){return""}}function calculateString(e){return new Function("return "+e)()}function extractNumber(e){return parseFloat(e.replace(/[^\d\.]*/g,""))}function isStringNumeric(e){return!isNaN(parseFloat(e))&&isFinite(e)}function extractAmountFromSelectedText(e){let t;try{let o=extractNumber(e);null==o||""===o||isNaN(o)||0===o||0===o||(t=o)}catch(e){}return t}function returnTooltipRevealTransform(e=!0,t=!0){const o=t?"-50%":"0",n=configs.verticalLayoutTooltip?30:100;switch(configs.tooltipRevealEffect){case"noTooltipEffect":return`translate(${o},0)`;case"moveUpTooltipEffect":return e?`translate(${o},0)`:`translate(${o}, ${n}%)`;case"moveDownTooltipEffect":return e?`translate(${o},0)`:`translate(${o}, -${n}%)`;case"scaleUpTooltipEffect":case"scaleUpFromBottomTooltipEffect":return e?`translate(${o},0) scale(1.0)`:`translate(${o},0) scale(0.0)`}}function onTooltipButtonClick(e,t,o){try{const n=e||window.event;"buttons"in n&&(0==n.button?(hideTooltip(),removeSelectionOnPage(),"copy"==configs.convertResultClickAction&&o?copyManuallyToClipboard(o):chrome.runtime.sendMessage({type:"selecton-open-new-tab",url:t,focused:!0})):1==n.button&&(n.preventDefault(),configs.middleClickHidesTooltip&&(hideTooltip(),removeSelectionOnPage()),chrome.runtime.sendMessage({type:"selecton-open-new-tab",url:t,focused:!1})))}catch(e){window.open(t,"_blank")}}function checkTooltipForCollidingWithSideEdges(){if(configs.debugMode&&console.log("Checking Selecton tooltip for colliding with side edges..."),null==tooltip)return;let e=tooltip.getBoundingClientRect().left,t=4;if(t=tooltip.clientWidth,"scaleUpTooltipEffect"!=configs.tooltipRevealEffect&&"scaleUpFromBottomTooltipEffect"!=configs.tooltipRevealEffect||(e-=t/2),e<0){if(configs.debugMode&&console.log("Tooltip is colliding with left edge. Fixing..."),tooltip.style.left=5+t/2+"px",configs.showTooltipArrow&&arrow){const o=(5-e)/t*100;arrow.style.left=50-o+"%"}}else{const o=e+t-(document.body.clientWidth||window.innerWidth||document.documentElement.clientWidth);if(o>0){if(configs.debugMode&&console.log(`Tooltip is colliding with right edge by ${o}px`),tooltip.style.left="unset",tooltip.style.right=5-t/2+"px",configs.showTooltipArrow&&arrow){const e=(o+5)/t*100;arrow.style.left=`${50+e}%`}}else if(configs.debugMode&&console.log("Tooltip is not colliding with side edges"),configs.correctTooltipPositionByMoreButtonWidth&&!configs.verticalLayoutTooltip&&!configs.collapseAsSecondPanel){const e=tooltip.querySelector(".more-button");if(!e)return;const o=e.clientWidth;if(tooltip.style.left=parseInt(tooltip.style.left.replaceAll("px",""))+o/2+"px",configs.showTooltipArrow&&arrow){const e=o/2/t*100;arrow.style.left=50-e+"%"}}}}function createImageIconForButton(e,t,o=!1,n){const i=document.createDocumentFragment(),l=document.createElement("img");l.setAttribute("src",e),l.setAttribute("class","selecton-button-img-icon");const s="onlyicon"==configs.buttonsStyle;if(l.style.opacity=n??("onlylabel"==configs.buttonsStyle?.65:s?.75:.5),s&&!o||(l.style.marginRight="3px"),i.appendChild(l),null!=t&&""!=t){const e=document.createElement("span");e.textContent=t,i.appendChild(e)}return i}function setBorderRadiusForSideButtons(e,t=!0){const o=t?e.querySelectorAll(".selection-tooltip > .selection-popup-button"):e.children,n=o.length;if(n>1){const e=configs.verticalLayoutTooltip&&tooltipOnBottom;o[0].style.borderRadius=e?lastButtonBorderRadius:firstButtonBorderRadius,o[n-1].style.borderRadius=e?firstButtonBorderRadius:lastButtonBorderRadius}else o[0].style.borderRadius=onlyButtonBorderRadius}function setCopyButtonTitle(e,t,o){let n=`${t??selectedText.length} ${chrome.i18n.getMessage("symbolsCount").toLowerCase()}`;if(selectedTextIsCode){const e=(selectedText.match(/\n/g)||"").length;e>0&&(n+=` · ${e+1} `+chrome.i18n.getMessage("linesCount").toLowerCase())}else o&&o>1&&(n+=` · ${o} ${chrome.i18n.getMessage("wordsCount").toLowerCase()}`);configs.showStatsOnCopyButtonHover&&setTimeout((function(){e.isConnected&&(e.title=("onlyicon"==configs.buttonsStyle?copyLabel+" ":"")+n)}),3),configs.showInfoPanel&&((infoPanel=document.createElement("div")).className="selecton-info-panel",configs.verticalLayoutTooltip?tooltip.appendChild(infoPanel):tooltip.insertBefore(infoPanel,tooltip.children[1]),makeTooltipElementDraggable(infoPanel,!1),1==selectedTextIsCode&&(infoPanel.innerText+=" · code"),infoPanel.innerText=n)}function addBasicTooltipButton(e,t,o,n=!1,i){const l=document.createElement("button");return l.setAttribute("class",n||0==configs.showButtonBorders?"selection-popup-button":"selection-popup-button button-with-border"),"onlyicon"==configs.buttonsStyle&&configs.showButtonLabelOnHover&&l.setAttribute("title",e),addButtonIcons?l.appendChild(createImageIconForButton(t,"onlyicon"==configs.buttonsStyle?"":e,!1,i)):l.textContent=e,l.onmousedown=function(e){e.stopPropagation(),e.preventDefault()},l.onmouseup=function(e){0==e.button&&(o(),configs.hideTooltipOnActionButtonClick&&(hideDragHandles(),hideTooltip()),removeSelectionOnPage())},tooltip.appendChild(l),l}function addContextualTooltipButton(e,t=!1){const o=document.createElement("button");return o.setAttribute("class",t||0==configs.showButtonBorders?"selection-popup-button":"selection-popup-button button-with-border"),o.onmousedown=function(e){e.stopPropagation(),e.preventDefault()},o.onmouseup=function(t){0==t.button&&(e(),configs.hideTooltipOnActionButtonClick&&(hideDragHandles(),hideTooltip()),removeSelectionOnPage())},tooltip.appendChild(o),o}function addLinkTooltipButton(e,t,o,n=!1,i){const l=document.createElement("a");return l.setAttribute("class",n||0==configs.showButtonBorders?"selection-popup-button":"selection-popup-button button-with-border"),e&&t&&("onlyicon"==configs.buttonsStyle&&configs.showButtonLabelOnHover&&l.setAttribute("title",e),addButtonIcons?l.appendChild(createImageIconForButton(t,"onlyicon"==configs.buttonsStyle?"":e,!1,i)):l.textContent=e),l.onmousedown=function(e){e.stopPropagation(),e.preventDefault()},l.onmouseup=function(e){0==e.button&&(configs.hideTooltipOnActionButtonClick&&(hideDragHandles(),hideTooltip()),removeSelectionOnPage())},l.classList.add("link-button"),l.href=o,l.target="_blank",tooltip.appendChild(l),l}function mouseMoveToHideListener(e){if(0!=tooltipIsShown&&0!=configs.hideTooltipWhenCursorMovesAway){if(Math.abs(e.clientX-lastMouseUpEvent.clientX)>this.window.screen.width/4||Math.abs(e.clientY-lastMouseUpEvent.clientY)>this.window.screen.height/4){window.removeEventListener("mousemove",mouseMoveToHideListener);try{hideTooltip(),hideDragHandles()}catch(e){}}}else window.removeEventListener("mousemove",mouseMoveToHideListener)}function setTooltipOnBottom(){arrow.classList.add("arrow-on-bottom"),tooltipOnBottom=!0,configs.showInfoPanel&&infoPanel&&infoPanel.isConnected&&(infoPanel.classList.add("info-panel-on-bottom"),tooltip.appendChild(infoPanel))}function makeTooltipElementDraggable(e,t=!0){e.style.cursor="grab",e.onmousedown=function(e){isDraggingTooltip=!0,e.preventDefault(),configs.debugMode&&console.log("Started dragging tooltip..."),tooltip.style.left="0px",tooltip.style.top="0px",tooltip.style.transition=`opacity ${configs.animationDuration}ms ease-in-out`,document.body.style.cursor="grabbing";const o=tooltipOnBottom?arrow.clientHeight/3:t?tooltip.clientHeight:0;tooltip.style.transform=`translate(${e.clientX-tooltip.clientWidth/2}px, ${tooltipOnBottom?e.clientY+o:e.clientY-o}px)`,tooltip.style.pointerEvents="none",document.onmousemove=function(e){e.preventDefault(),tooltip.style.transform=`translate(${e.clientX-tooltip.clientWidth/2}px, ${tooltipOnBottom?e.clientY+o:e.clientY-o}px)`},document.onmouseup=function(e){e.preventDefault(),document.onmousemove=null,document.onmouseup=null,isDraggingTooltip=!1,document.body.style.cursor="unset",tooltip.style.left=e.clientX-tooltip.clientWidth/2+"px",tooltip.style.top=`${tooltipOnBottom?e.clientY+o:e.clientY-o}px`,tooltip.style.transform=null,tooltip.style.pointerEvents="auto",configs.debugMode&&console.log("Dragging tooltip finished")},configs.hideTooltipWhenCursorMovesAway&&window.removeEventListener("mousemove",mouseMoveToHideListener)}}function setDragHandles(e,t){let o=document.getElementById("selecton-draghandle-0");null!=o&&null!=o||addDragHandle(0,e,t),o=document.getElementById("selecton-draghandle-1"),null!=o&&null!=o||addDragHandle(1,e,t)}function addDragHandle(e,t,o){if(configs.debugMode&&console.log("Adding drag handle "+e.toString()+"..."),null==selection||null==selection)return;const n=10,i=-1.5;try{if(!(selectionHandleLineHeight=(0==e?t.lineHeight:o.lineHeight)+6)){const e=window.getComputedStyle(selection.anchorNode.parentElement,null).getPropertyValue("line-height");null!=e&&e.includes("px")&&(selectionHandleLineHeight=parseInt(e.replaceAll("px",""))+5)}}catch(e){configs.debugMode&&console.log("Selecton failed to compute font size of selected text")}try{var l;if(0==o.dx&&0==o.dy&&(o={dx:lastMouseUpEvent.clientX,dy:lastMouseUpEvent.clientY-selectionHandleLineHeight/2-n}),0==t.dx&&0==t.dy&&(t={dx:lastMouseUpEvent.clientX,dy:lastMouseUpEvent.clientY-selectionHandleLineHeight/2-n}),null==t||null==o)return;let s=tooltipOnBottom,r=document.createElement("div");r.className="selection-tooltip-draghandle",r.id=`selecton-draghandle-${e}`,r.style.transform=`translate(${0==e?t.dx-2.5:o.dx}px, ${(0==e?t.dy:o.dy)+i}px)`,r.style.transition=`opacity ${configs.animationDuration}ms ease-out`;let c=document.createElement("div");c.className="selection-tooltip-draghandle-line",c.style.height=`${selectionHandleLineHeight}px`,c.style.width="2.25px",r.appendChild(c);let a=document.createElement("div");a.className="selection-tooltip-draghandle-circle",a.style.cursor="grab",a.style.transition=`opacity ${configs.animationDuration}ms ease-out, top 200ms ease, bottom 200ms ease`,s?a.style.top="-9px":a.style.bottom=`-${selectionHandleLineHeight-1}px`,"triangle"==configs.dragHandleStyle?(a.classList.add("draghandle-triangle"),0==e?(a.style.clipPath="polygon(0% 0%, 100% 100%, 0% 100%)",a.style.right="-2.25px"):a.style.clipPath="polygon(0% 0%, 100% 100%, 100% 0%)"):a.style.right="3.875px",r.appendChild(a),setTimeout((function(){r.style.opacity=configs.useCustomStyle?configs.tooltipOpacity:1}),1),configs.useCustomStyle&&1!=configs.tooltipOpacity&&1!=configs.tooltipOpacity&&configs.fullOpacityOnHover&&(r.onmouseover=function(e){setTimeout((function(){if(1!=dontShowTooltip)try{r.style.opacity=1}catch(e){}}),1)},r.onmouseout=function(){setTimeout((function(){if(1!=dontShowTooltip)try{r.style.opacity=configs.tooltipOpacity}catch(e){}}),1)}),a.onmousedown=function(d){if(hideTooltip(),isDraggingDragHandle=!0,draggingHandleIndex=e,d.preventDefault(),window.getSelection?l=window.getSelection().toString():document.selection&&(l=document.selection.createRange().toString()),t=getSelectionCoordinates(!0),o=getSelectionCoordinates(!1),null==t||null==o)return void hideDragHandles();document.body.style.cursor="grabbing",a.style.cursor="grabbing",r.style.transition="";let u=null;document.onmousemove=function(n){try{n.preventDefault();const c=0==e?t.dx-n.clientX:o.dx-n.clientX,a=0==e?t.dy-n.clientY:n.clientY-o.dy;if(r.style.transform=0==e?`translate(${n.clientX}px, ${t.dy-selectionHandleLineHeight-a+i}px)`:`translate(${n.clientX}px, ${o.dy-(s?-5:selectionHandleLineHeight)+a+i}px)`,null!=l&&""!==l)try{0==e?createSelectionFromPoint(o.dx-2,o.dy+selectionHandleLineHeight/2,t.dx-c-.05,t.dy-a-selectionHandleLineHeight,e):createSelectionFromPoint(t.dx+3,t.dy,o.dx-c-.05,o.dy+a-(s?-selectionHandleLineHeight/2:selectionHandleLineHeight/2),e)}catch(n){configs.debugMode&&(console.log("Error while creating selection range:"),console.log(n))}}catch(n){configs.debugMode&&(console.log("Error while moving the right drag handle:"),console.log(n))}let c=n.clientY;c>window.innerHeight-20?null==u&&(u=setInterval((function(){window.scrollTo({top:window.scrollY+3,behavior:"smooth"})}),1)):c<20?null==u&&(u=setInterval((function(){window.scrollTo({top:window.scrollY-3,behavior:"smooth"})}),1)):(clearInterval(u),u=null)},document.onmouseup=function(t){t.preventDefault(),document.onmousemove=null,document.onmouseup=null,document.body.style.cursor="unset",a.style.cursor="grab",clearInterval(u),u=null,setTimeout((function(){let t=window.getSelection();t.toString()==l.toString()&&(configs.debugMode&&console.log("Single click on drag handle"),extendSelectionByWord(t,e)),setTimeout((function(){isDraggingDragHandle=!1,draggingHandleIndex=null;let t=getSelectionCoordinates(!0),o=getSelectionCoordinates(!1);const l=(0==e?t.lineHeight:o.lineHeight)+6;l&&(selectionHandleLineHeight=l,c.style.height=`${selectionHandleLineHeight}px`),null!=t&&null!=o?(0==o.dx&&0==o.dy&&(o={dx:lastMouseUpEvent.clientX,dy:lastMouseUpEvent.clientY-selectionHandleLineHeight/2-n}),0==t.dx&&0==t.dy&&(t={dx:lastMouseUpEvent.clientX,dy:lastMouseUpEvent.clientY-selectionHandleLineHeight/2-n}),o.dx>window.innerWidth-25&&(o.dx=lastMouseUpEvent.clientX),r.style.transition=`transform 200ms ease-in-out, opacity ${configs.animationDuration}ms ease-in-out`,r.style.transform=0==e?`translate(${t.dx-1}px, ${t.dy+i}px)`:`translate(${o.dx}px, ${o.dy+i}px)`,1==e&&tooltipOnBottom?(a.style.bottom="unset",a.style.top="-9px"):(a.style.bottom=`-${selectionHandleLineHeight-1}px`,a.style.top="unset"),setTimeout((function(){r.style.transition=`opacity ${configs.animationDuration}ms ease-in-out`}),200)):hideDragHandles()}),2)}),1),configs.debugMode&&console.log("Changing selection finished")}},document.body.appendChild(r),configs.debugMode&&console.log("Successfully added drag handle "+e.toString())}catch(t){configs.debugMode&&console.log("Failed to configure drag handle "+e.toString()+". Error is: "+t.toString())}}let dragHandles,oldTooltips;function hideDragHandles(e=!0,t=!1){if(configs.addDragHandles){dragHandles||(dragHandles=document.getElementsByClassName("selection-tooltip-draghandle"));for(let o=0,n=dragHandles.length;o<n;o++){const n=dragHandles[o];if(t&&null!=draggingHandleIndex)try{let e=n.id;if(parseInt(e.split("-")[2])==draggingHandleIndex)continue}catch(e){console.log(e)}e||(n.style.transition=""),n.style.opacity=0,setTimeout((function(){n.remove()}),e?configs.animationDuration:0)}}}function createTooltip(e,t=!1){isDraggingTooltip||1!=dontShowTooltip&&(null!=e&&0!==e.button||setTimeout((function(){if(lastMouseUpEvent=e,null!=selection&&null!=selection){if(tooltipOnBottom=!1,configs.snapSelectionToWord)if(1==isTextFieldFocused)configs.debugMode&&console.log("Word snapping rejected while textfield is focused");else if(!configs.disableWordSnappingOnCtrlKey||void 0===e||1!=e.ctrlKey&&1!=e.metaKey){if(selectedTextIsCode=!1,configs.disableWordSnapForCode||configs.showInfoPanel)for(let e=0,t=codeMarkers.length;e<t;e++)if(selectedText.includes(codeMarkers[e])){selectedTextIsCode=!0;break}0!=isDraggingDragHandle||0!=selectedTextIsCode&&configs.disableWordSnapForCode||!(0==domainIsBlacklistedForSnapping&&e.detail<2)||null!=timerToRecreateOverlays&&null!=timerToRecreateOverlays||"selecton-extend-selection-button"===e.target.id||e.target.parentNode&&"selecton-extend-selection-button"===e.target.parentNode.id||snapSelectionByWords(selection)}else configs.debugMode&&console.log("Word snapping rejected due to pressed CTRL key");if(isTextFieldFocused){if(0==configs.addActionButtonsForTextFields)return;if(setUpTooltip(),addBasicTooltipButtons("textfield"),tooltip.children.length<2)return void tooltip.remove();document.body.appendChild(tooltip);let t=e.clientY-tooltip.clientHeight-arrow.clientHeight-9;return t<=0&&(t=e.clientY+arrow.clientHeight,arrow.classList.add("arrow-on-bottom"),tooltipOnBottom=!0),void showTooltip(e.clientX,t)}tooltip&&hideTooltip(),selection=window.getSelection(),""!=(selectedText=selection.toString().trim())?(setUpTooltip(t),addBasicTooltipButtons(null),0==dontShowTooltip&&null!==selectedText&&""!==selectedText?addContextualButtons((function(){setBorderRadiusForSideButtons(tooltip),document.body.appendChild(tooltip),calculateTooltipPosition(e),"hoverCustomSearchStyle"==configs.customSearchOptionsDisplay&&setTimeout((function(){configs.secondaryTooltipEnabled&&configs.customSearchButtons&&setHoverForSearchButton(searchButton)}),5),setTimeout((function(){0!=tooltipIsShown&&document.addEventListener("selectionchange",selectionChangeListener)}),configs.animationDuration)})):hideTooltip()):hideDragHandles()}}),0))}function setUpTooltip(e=!1){(tooltip=document.createElement("div")).className="selection-tooltip selecton-entity",configs.verticalLayoutTooltip&&(tooltip.classList.add("vertical-layout-tooltip"),tooltip.classList.add("reversed-order")),"onlyicon"!=configs.buttonsStyle&&"iconlabel"!=configs.buttonsStyle||tooltip.classList.add("tooltip-with-icons"),tooltip.style.opacity=0,tooltip.style.position="fixed",tooltip.style.pointerEvents="none",tooltip.style.transition=`opacity ${configs.animationDuration}ms ease-out, transform ${configs.animationDuration}ms ease-out`,e&&(tooltip.style.transition=`opacity ${configs.animationDuration}ms ease-out`),tooltip.style.transform=returnTooltipRevealTransform(!1),tooltip.style.transformOrigin="scaleUpTooltipEffect"==configs.tooltipRevealEffect?"50% 30% 0":"scaleUpFromBottomTooltipEffect"==configs.tooltipRevealEffect?"50% 125% 0":"50% 100% 0",configs.useCustomStyle&&1!=configs.tooltipOpacity&&1!=configs.tooltipOpacity&&configs.fullOpacityOnHover&&(tooltip.onmouseover=function(){setTimeout((function(){if(1!=dontShowTooltip)try{tooltip.style.opacity=1}catch(e){}}),1)},tooltip.onmouseout=function(){setTimeout((function(){if(1!=dontShowTooltip)try{tooltip.style.opacity=configs.tooltipOpacity}catch(e){}}),1)},configs.debugMode&&(console.log("Selecton tooltip inactive opacity: "+configs.tooltipOpacity.toString()),console.log("Set tooltip opacity listeners"))),arrow=document.createElement("div"),configs.showTooltipArrow&&arrow.setAttribute("class","selection-tooltip-arrow"),tooltip.appendChild(arrow),configs.showTooltipArrow&&configs.draggableTooltip&&makeTooltipElementDraggable(arrow),configs.useCustomStyle?(configs.addTooltipShadow&&(tooltip.style.boxShadow=`0 2px 7px rgba(0,0,0,${configs.shadowOpacity})`,arrow.style.boxShadow=`1px 1px 3px rgba(0,0,0,${configs.shadowOpacity/1.5})`),configs.verticalLayoutTooltip?(firstButtonBorderRadius=`0px 0px ${configs.borderRadius/1.5}px ${configs.borderRadius/1.5}px`,lastButtonBorderRadius=`${configs.borderRadius/1.5}px ${configs.borderRadius/1.5}px 0px 0px`):(firstButtonBorderRadius=`${configs.borderRadius/1.5}px 0px 0px ${configs.borderRadius/1.5}px`,lastButtonBorderRadius=`0px ${configs.borderRadius/1.5}px ${configs.borderRadius/1.5}px 0px`),onlyButtonBorderRadius=configs.borderRadius/1.5+"px"):(firstButtonBorderRadius="3px 0px 0px 3px",lastButtonBorderRadius="0px 3px 3px 0px",onlyButtonBorderRadius="3px"),configs.debugMode&&console.log("Selecton tooltip was created")}function calculateTooltipPosition(e){const t=getSelectionCoordinates(!0),o=getSelectionCoordinates(!1);let n=!0;t.dontAddDragHandles&&(n=!1);let i,l,s=window.innerHeight/3,r=tooltip.clientHeight;if("overCursor"==configs.tooltipPosition&&e.clientX<window.innerWidth-30){if(l=t.dy-r-arrow.clientHeight/1.5-2,l<=0||o.dy-t.dy>2&&!0!==o.backwards){let e=o.dy+(o.lineHeight??0)+arrow.clientHeight;e<window.innerHeight&&(l=e,setTooltipOnBottom(),configs.verticalLayoutTooltip&&tooltip.classList.remove("reversed-order"))}l<0&&0==tooltipOnBottom&&(l=s),i=e.clientX}else{if(l=t.dy-r-arrow.clientHeight,l<=0){let e=o.dy+(o.lineHeight??0)+arrow.clientHeight;e<window.innerHeight?(l=e,setTooltipOnBottom(),configs.verticalLayoutTooltip&&tooltip.classList.remove("reversed-order")):l=s}configs.showTooltipArrow&&(l+=2);try{const e=o.dx>t.dx?o.dx-t.dx:t.dx-o.dx;i=o.dx>t.dx?t.dx+e/2:o.dx+e/2}catch(e){configs.debugMode&&console.log(e);const t=getSelectionRectDimensions();i=t.dx+t.width/2}}configs.floatingOffscreenTooltip&&(floatingTooltipTop=!1,floatingTooltipBottom=!1,l<0?(l=15,floatingTooltipTop=window.scrollY):l>window.innerHeight&&(l=window.innerHeight-(r??50)-15,floatingTooltipBottom=window.scrollY)),showTooltip(i,l),configs.addDragHandles&&n&&setDragHandles(t,o)}function showTooltip(e,t){tooltip.style.pointerEvents="none",tooltip.style.opacity=configs.useCustomStyle?configs.tooltipOpacity:1,tooltip.style.top=`${t}px`,tooltip.style.left=`${e}px`,tooltip.style.transform=returnTooltipRevealTransform(!0),checkTooltipForCollidingWithSideEdges(),configs.debugMode&&console.log("Selecton tooltip is shown"),tooltipIsShown=!0;let o=tooltip;setTimeout((function(){0!=tooltipIsShown&&null!=tooltip&&(o.style.pointerEvents="all")}),configs.animationDuration)}function hideTooltip(e=!0){if(tooltip){if(configs.debugMode&&(console.log("--- Hiding Selecton tooltips ---"),console.log("Checking for existing tooltips...")),oldTooltips||(oldTooltips=document.getElementsByClassName("selecton-entity")),oldTooltips&&oldTooltips.length){tooltipIsShown=!1,configs.debugMode&&console.log(`Found ${oldTooltips.length} tooltips to hide`);for(let t=0,o=oldTooltips.length;t<o;t++){const o=oldTooltips[t];e||(o.style.transition=""),o.style.opacity=0,o.style.pointerEvents="none",setTimeout((function(){o.remove()}),e?configs.animationDuration:0)}}else configs.debugMode&&console.log("No existing tooltips found");tooltip.style.pointerEvents="none",tooltip=null,secondaryTooltip=null,timerToRecreateOverlays=null,isTextFieldFocused=!1,document.removeEventListener("selectionchange",selectionChangeListener),window.removeEventListener("mousemove",mouseMoveToHideListener)}}function addBasicTooltipButtons(e){if("textfield"==e){const e=document.activeElement,t=null!==e.getAttribute("contenteditable");if(""!==selection.toString())try{if(addBasicTooltipButton(cutLabel,cutButtonIcon,(function(){document.execCommand("cut")}),!0),copyButton=addBasicTooltipButton(copyLabel,copyButtonIcon,(function(){try{e.focus(),document.execCommand("copy"),removeSelectionOnPage()}catch(e){console.log(e)}})),addBasicTooltipButton(pasteLabel,pasteButtonIcon,(function(){if(e.focus(),t){let e=getCurrentClipboard();null!=e&&""!=e&&document.execCommand("insertHTML",!1,e)}else document.execCommand("paste");removeSelectionOnPage(),hideTooltip()})),configs.addFontFormatButtons&&(addBasicTooltipButton(italicLabel,italicTextIcon,(function(){e.focus(),document.execCommand(t?"insertHTML":"insertText",!1,"<i>"+selectedText+"</i>"),hideTooltip()})),addBasicTooltipButton(boldLabel,boldTextIcon,(function(){e.focus(),document.execCommand(t?"insertHTML":"insertText",!1,"<b>"+selectedText+"</b>"),hideTooltip()})),addBasicTooltipButton(strikeLabel,strikeTextIcon,(function(){e.focus(),document.execCommand(t?"insertHTML":"insertText",!1,"<strike>"+selectedText+"</strike>"),hideTooltip()}))),configs.collapseButtons)try{collapseButtons()}catch(e){configs.debugMode&&console.log(e)}setCopyButtonTitle(copyButton)}catch(e){configs.debugMode&&console.log(e)}else{if(configs.addPasteButton)try{addBasicTooltipButton(pasteLabel,pasteButtonIcon,(function(t){if(e.focus(),null!==e.getAttribute("contenteditable")){let e=getCurrentClipboard();null!=e&&""!=e&&document.execCommand("insertHTML",!1,e)}else document.execCommand("paste");removeSelectionOnPage()}),!0)}catch(e){configs.debugMode&&console.log(e)}configs.addClearButton&&0==isTextFieldEmpty&&addBasicTooltipButton(clearLabel,clearIcon,(function(t){removeSelectionOnPage(),e.focus(),null!==e.getAttribute("contenteditable")?e.innerHTML="":e.value=""}))}setBorderRadiusForSideButtons(tooltip)}else{if(searchButton=addLinkTooltipButton(searchLabel,searchButtonIcon,returnSearchUrl(selectedText.trim()),!0),"panelCustomSearchStyle"==configs.customSearchOptionsDisplay&&configs.customSearchButtons)for(var t=0,o=configs.customSearchButtons.length;t<o;t++){const e=configs.customSearchButtons[t],o=e.url.replace("%s",selectedText),n=e.enabled,i=o.split("/")[2],l=e.title??i,s=e.icon??"https://www.google.com/s2/favicons?domain="+i;if(n){addLinkTooltipButton(l??o,s,o).classList.add("custom-search-image-button")}}copyButton=addBasicTooltipButton(copyLabel,copyButtonIcon,(function(){document.execCommand("copy")}))}}function addContextualButtons(e){if(configs.debugMode&&console.log("Checking to add contextual buttons..."),null==selection)return;const t=selectedText.toLowerCase(),o=selectedText.split(" ").length,n=selectedText.includes(" "),l=selectedText.length;let s=!1;if(0==convertWhenOnlyFewWordsSelected||o<=wordsLimitToProccessText){let u;if(configs.convertCurrencies){let g,p,f,m,h=!1;for(const[y,T]of Object.entries(currenciesList)){if(selectedText.includes(" "+y)||void 0!==T.currencySymbol&&selectedText.includes(T.currencySymbol))configs.debugMode&&console.log("found currency match for: "+(selectedText.includes(y)?y:T.currencySymbol)),h=!0;else{const b=T.currencyKeywords;if(null!=b)for(i in b)t.includes(b[i])&&(configs.debugMode&&console.log("found currency match for: "+b[i]),h=!0)}if(0==T.searchInText&&(h=!1),h){if(g=y,f=T.rate,m=T.currencySymbol,selectedText.includes(",")){let w=selectedText.split(",");if(2==w.length){let x=w[1].match(/[+-]?\d+(\.\d)?/g);x&&x.join("").length<3&&(selectedText=selectedText.replaceAll(",","."))}}p=extractAmountFromSelectedText(selectedText);break}}if(void 0!==g&&g!==configs.convertToCurrency&&null!=p&&null!=f){configs.debugMode&&(console.log(`Found rate for currency ${g}: ${f}`),console.log("User currency is: "+configs.convertToCurrency));const v=currenciesList[configs.convertToCurrency];if(v&&null!==v.rate&&void 0!==v.rate){let S=v.rate;for(i in billionMultipliers)if(t.includes(billionMultipliers[i])){p*=1e9;break}for(i in millionMultipliers)if(t.includes(millionMultipliers[i].toLowerCase())){p*=1e6;break}for(i in thousandMultipliers)if(t.includes(thousandMultipliers[i].toLowerCase())){p*=1e3;break}let C=S/f;configs.debugMode&&console.log("conversion rate: "+C);let B=p*C;if(null!=B&&!isNaN(B)&&""!==B.toString()){try{B=parseFloat(B),B=B.toFixed(2)}catch(N){console.log(N)}let L=B.toString();L=splitNumberInGroups(L);const M=addContextualTooltipButton((function(e){onTooltipButtonClick(e,returnSearchUrl(`${p+" "+g} to ${configs.convertToCurrency}`),L+` ${configs.convertToCurrency}`)}));configs.showUnconvertedValue&&(configs.preferCurrencySymbol&&void 0!==m?M.textContent=` ${p} ${m} →`:M.textContent=` ${p} ${g} →`);const k=document.createElement("span"),E=currenciesList[configs.convertToCurrency].currencySymbol;configs.preferCurrencySymbol,k.textContent=` ${L}`,k.classList.add("color-highlight"),M.appendChild(k);const D=document.createElement("span");D.textContent=` ${configs.preferCurrencySymbol?E:configs.convertToCurrency}`,D.style.color="var(--selection-button-foreground)",M.appendChild(D)}}}}if(configs.convertMetrics){let R,H,I;if(!n&&"metric"==configs.preferredMetricsSystem&&/['||"]/.test(selectedText)&&!/[a-zA-Z]/g.test(selectedText))if(selectedText.includes("'")){let P,F;const U=selectedText.split("'"),W=U.length;2==W||4==W?(P=extractAmountFromSelectedText(U[0]),F=extractAmountFromSelectedText(U[1].split('"')[0])):1==W&&(P=extractAmountFromSelectedText(U[0])),null!==P&&(null==F&&(F=0),R=P*convertionUnits.feet.ratio*100+F*convertionUnits.inch.ratio,H="",I="cm",u=selectedText)}else if(selectedText.includes('"')){2==selectedText.split('"').length&&(inches=extractAmountFromSelectedText(selectedText),R=inches*convertionUnits.inch.ratio,H="",I="cm",u=selectedText)}let A=!1;const $="metric"==configs.preferredMetricsSystem?convertionUnits:imprerialConvertionUnits,O=Object.keys($);for(let K=0,z=O.length;K<z;K++){const Y=O[K];let j=Y;if(selectedText.includes(j)){if("pound"==j&&4==tooltip.children.length)return;configs.debugMode&&console.log("found key: "+j),A=K;break}if($[Y].variations){const q=$[Y].variations;for(let X=0,_=q.length;X<_;X++)if(selectedText.includes(q[X])){configs.debugMode&&console.log("found key: "+q[X]),A=K;break}}}if(!1!==A){if(selectedText.includes(",")){2==selectedText.split(",").length&&(selectedText=selectedText.replaceAll(",","."))}if(u=extractAmountFromSelectedText(selectedText),null!==u&&""!==u&&NaN!==u&&void 0!==u){let Z=O[A],G=$[Z];for(i in billionMultipliers)if(t.includes(billionMultipliers[i])){u*=1e9;break}for(i in millionMultipliers)if(t.includes(millionMultipliers[i].toLowerCase())){u*=1e6;break}for(i in thousandMultipliers)if(t.includes(thousandMultipliers[i].toLowerCase())){u*=1e3;break}H=Z,I=G.convertsTo,R=H.includes("°")?G.convertFunction(u):"metric"==configs.preferredMetricsSystem?u*G.ratio:u/G.ratio}}if(null!=R&&0!==R&&!isNaN(R)){R=R.toFixed(2),R=splitNumberInGroups(R.toString());const V=addContextualTooltipButton((function(e){onTooltipButtonClick(e,returnSearchUrl(`${u+" "+H.trim()} to ${I}`),`${R} ${I}`)}));configs.showUnconvertedValue&&(V.textContent=u+" "+H+" →");const J=document.createElement("span");J.textContent=` ${R}`,J.classList.add("color-highlight"),V.appendChild(J);const Q=document.createElement("span");Q.textContent=` ${I}`,Q.style.color="var(--selection-button-foreground)",V.appendChild(Q)}}if(configs.addPhoneButton&&!n&&"+"==selectedText[0]&&13==l){const ee=addContextualTooltipButton((function(e){hideTooltip(),removeSelectionOnPage(),window.open(`tel:${selectedText}`,"_self")}));let te=selectedText;if("onlylabel"==configs.buttonsStyle){let oe=8;ee.textContent=chrome.i18n.getMessage("callLabel")+" ";let ne=document.createElement("div");ne.style.display="inline",ne.textContent=te.length>oe?te.substring(0,oe)+"...":te,ne.classList.add("color-highlight"),ne.length>oe&&ee.setAttribute("title",te),ee.appendChild(ne)}else ee.appendChild(createImageIconForButton(phoneIcon,te,!0)),ee.classList.add("color-highlight")}if(null==u&&configs.performSimpleMathOperations&&"+"!==selectedText[0]&&!selectedText.includes("{")&&(selectedText.includes("+")||selectedText.includes("-")||selectedText.includes("*")||selectedText.includes("^")))try{let ie=selectedText.match(/[+-]?\d+(\.\d)?/g);if(null!=ie&&ie.length>0){let le=calculateString(selectedText.replaceAll(" ","").replaceAll("}",""));if(null!=le&&""!==le&&NaN!==le){let se;if(se=le.toString().match(/[+-]?\d+(\.\d)?/g)[0],null!==se){const re=addContextualTooltipButton((function(e){onTooltipButtonClick(e,returnSearchUrl(selectedText.replaceAll("+","%2B")),le)}));configs.showUnconvertedValue&&(re.textContent=selectedText+" →");const ce=document.createElement("span");configs.showUnconvertedValue||(ce.textContent="="),ce.textContent+=` ${le}`,ce.classList.add("color-highlight"),re.appendChild(ce)}}}}catch(ae){configs.debugMode&&console.log(ae)}if(configs.showOnMapButtonEnabled){let de=!1;for(let ue=0,ge=addressKeywords.length;ue<ge;ue++)if(t.includes(addressKeywords[ue])){de=!0;break}if(de){const pe=returnShowOnMapUrl(selectedText);addLinkTooltipButton(showOnMapLabel,createImageIconForButton(mapButtonIcon,"onlyicon"==configs.buttonsStyle?"":showOnMapLabel),pe)}}if(configs.showEmailButton&&!n&&selectedText.includes("@")){const fe=selectedText.split("@");if(2==fe.length&&fe[1].includes("."))try{const me=t,he=addContextualTooltipButton((function(e){onTooltipButtonClick(e,returnNewEmailUrl(me))}));if("onlylabel"==configs.buttonsStyle){he.textContent=chrome.i18n.getMessage("email")+" ";let ye=document.createElement("div");ye.style.display="inline",ye.textContent=me.length>linkSymbolsToShow?me.substring(0,linkSymbolsToShow)+"...":me,ye.classList.add("color-highlight"),me.length>linkSymbolsToShow&&he.setAttribute("title",me),he.appendChild(ye)}else he.appendChild(createImageIconForButton(emailButtonIcon,me.length>linkSymbolsToShow?me.substring(0,linkSymbolsToShow)+"...":me,!0)),he.classList.add("color-highlight")}catch(Te){console.log(Te)}}if(configs.addColorPreviewButton&&(!n&&7==l&&selectedText.includes("#")||selectedText.includes("rgb")&&selectedText.includes("(")))try{let be;if(selectedText.includes("rgb"))try{let Se=selectedText.toUpperCase().split("(")[1].split(")")[0].replaceAll(" ","").split(",");for(i in Se)Se[i]=parseInt(Se[i],10);be=rgbToHex(Se[0],Se[1],Se[2]).toUpperCase()}catch(Ce){be=selectedText.toUpperCase()}else be=selectedText.toUpperCase().replaceAll(",","").replaceAll(".","").replaceAll("'","").replaceAll('"',"");be=be.toLowerCase();const we=addContextualTooltipButton((function(e){onTooltipButtonClick(e,returnSearchUrl(be.replaceAll("#","%23"),!1),be)})),xe=document.createElement("div");xe.setAttribute("class","selection-popup-color-preview-circle"),xe.style.background=be,xe.style.marginRight="4.5px";const ve=hexToRgb(be);we.setAttribute("title",`red: ${ve.red}, green: ${ve.green}, blue: ${ve.blue}`),we.appendChild(xe),we.insertAdjacentHTML("beforeend"," "+(be.length>linkSymbolsToShow?be.substring(0,linkSymbolsToShow)+"...":be)),we.classList.add("color-highlight")}catch(Be){console.log(Be)}if(configs.convertTime)try{let Le=selectedText;"metric"==configs.preferredMetricsSystem?(Le.includes(" PM")||Le.includes(" AM"))&&(configs.debugMode&&console.log("converting from 12h to 24..."),Le=convertTime12to24(Le),configs.debugMode&&console.log("result: "+Le)):!Le.includes(":")||Le.includes(" ")||Le.includes("AM")||Le.includes("PM")||(configs.debugMode&&console.log("converting from 12h to 24..."),Le=convertTime24to12(Le),configs.debugMode&&console.log("result: "+Le));const Me=Object.keys(timeZoneKeywords);let ke,Ee,De;for(let Ne=0,Re=Me.length;Ne<Re;Ne++)if(De=Me[Ne],selectedText.includes(" "+De)){let He=selectedText.trim().split(" ");for(Ne in He){let Ie=He[Ne];if(Ie.includes(":")){Ee=Ie;break}}if(null!=Ee&&""!==Ee){let Ae=Ee.split(":");if(2==Ae.length||3==Ae.length){let $e=new Date;function r(e){let t=new Date(e.getFullYear(),0,1).getTimezoneOffset(),o=new Date(e.getFullYear(),6,1).getTimezoneOffset();return Math.max(t,o)!==e.getTimezoneOffset()}configs.debugMode&&(console.log("today:"),console.log($e));const Oe=r($e);"EST"==De&&Oe&&(De="EDT"),"CET"==De&&Oe&&(De="CEST");let Pe=selectedText.includes(" PM")?" PM":selectedText.includes(" AM")?" AM":"",Fe=`${$e.getMonth()+1}/${$e.getDate()}/${$e.getFullYear()} ${Ae[0]}:${Ae[1]}${Pe} ${timeZoneKeywords[De]}`;configs.debugMode&&(console.log("setting date from:"),console.log(Fe));let Ue=new Date(Fe);configs.debugMode&&(console.log("setted date:"),console.log(Ue)),ke=Ue.toLocaleTimeString().substring(0,5),configs.debugMode&&(console.log("converted time:"),console.log(ke))}}break}if(null!=ke&&""!==ke&&"Inval"!==ke||Le!==selectedText){const We=Le.match(/[+-]?\d+(\.\d)?/g).slice(0,2).join(":"),Ke=addContextualTooltipButton((function(e){onTooltipButtonClick(e,returnSearchUrl(Ee?`${Ee} ${De}`:Le),ke??We)}));Ke.classList.add("color-highlight"),addButtonIcons?Ke.appendChild(createImageIconForButton(clockIcon,ke??We,!0)):Ke.textContent=ke??We}}catch(ze){configs.debugMode&&console.log(ze)}if(configs.addCalendarButton&&checkToAddCalendarButton(selectedText),configs.addOpenLinks)if(n||!selectedText.includes(".")||tooltip.children[3]){if(!n&&"r"==selectedText[0]&&"/"==selectedText[1]){let Ye=addLinkTooltipButton(chrome.i18n.getMessage("openLinkLabel"),"https://www.redditstatic.com/desktop2x/img/favicon/apple-icon-57x57.png","https://www.reddit.com/"+selectedText,!1,1),je=document.createElement("span");je.style.display="inline",je.textContent=" reddit",je.classList.add("color-highlight"),Ye.appendChild(je);let qe=Ye.querySelector(".selecton-button-img-icon");qe&&qe.classList.add("no-filter-icon")}}else{let Xe=selectedText;const _e=Xe.split(".");if(_e[0].length>1){const Ze=_e.length,Ge=_e[Ze-1].split("/")[0],Ve=Ge.length,Je=selectedText.includes("://");if(Je||(2==Ze||3==Ze)&&Ve>1&&Ve<4&&!isStringNumeric(Ge)){for(let Qe=0,et=filetypesToIgnoreAsDomains.length;Qe<et;Qe++)if(Ge.includes(filetypesToIgnoreAsDomains[Qe])){s=!0;break}if(0==s||Je){Xe=Xe.replaceAll(",","").replaceAll(")","").replaceAll("(","").replaceAll("\n"," ");let tt=Xe.length,ot=Xe[tt-1];"."!=ot&&","!=ot||(Xe=Xe.substring(0,tt-1)),ot=Xe[Xe.length-1],"/"==ot&&(Xe=Xe.substring(0,Xe.length-1));const nt=Xe[0];tt=Xe.length,ot=Xe[tt-1],"'"!=nt&&'"'!=nt&&"«"!=nt&&"“"!=nt||(Xe=Xe.substring(1,tt)),"'"!=ot&&'"'!=ot&&"»"!=ot&&"”"!=ot||(Xe=Xe.substring(0,tt-1));const it=addLinkTooltipButton(void 0,void 0,Xe.includes("://")||Xe.includes("about:")?Xe:"https://"+Xe);let lt=document.createElement("div");lt.style.display="inline";let st=Xe.replaceAll("http://","").replaceAll("https://","");lt.textContent=st.length>linkSymbolsToShow?st.substring(0,linkSymbolsToShow)+"...":st,lt.classList.add("color-highlight"),Xe.length>linkSymbolsToShow&&it.setAttribute("title",Xe),addButtonIcons?it.appendChild(createImageIconForButton(openLinkButtonIcon,void 0,!0)):it.textContent=openLinkLabel+" ",it.appendChild(lt);let rt=it.querySelector(".selecton-button-img-icon");if(rt){rt.style.backgroundImage="url("+openLinkButtonIcon+")";const ct=e=>{rt.src!=openLinkButtonIcon&&(rt.style.backgroundImage="none",16==rt.naturalHeight?(rt.removeEventListener("load",ct),rt.src=openLinkButtonIcon):rt.classList.add("no-filter-icon"))};rt.addEventListener("load",ct),rt.onerror=function(e){rt.removeEventListener("load",ct),rt.src=openLinkButtonIcon,rt.classList.remove("no-filter-icon"),rt.style.backgroundImage="none"},rt.src="https://t2.gstatic.com/faviconV2?client=SOCIAL&type=FAVICON&fallback_opts=TYPE,SIZE,URL&size=24&url=https://"+st.split("/")[0]}}}}}}const c=/[`#$^*_\\[\]{};|<>~]/.test(selectedText)||s||1==l&&/[,.()]/.test(selectedText),a=tooltip.children[3]&&"panelCustomSearchStyle"!==configs.customSearchOptionsDisplay;function d(){if(configs.addQuoteButton){const e=document.body.querySelectorAll("textarea:not([readonly]):not([aria-readonly])");let t,o;for(i in e){const n=e[i];if(n&&n.getBoundingClientRect&&(o=n.getBoundingClientRect(),0!=o.height&&0!=o.width)){t=n;break}}if(t){addBasicTooltipButton(chrome.i18n.getMessage("quote"),quoteIcon,(function(){let e;t.scrollIntoView({block:"nearest",inline:"nearest",behavior:"smooth"}),t.focus(),e=t.value,t.value="",t.value=e,document.execCommand("insertText",!1,o.height<50||1==t.rows?" "+selectedText:(0==e.length?"":"\n\n")+"> "+selectedText+"\n\n"),setTimeout((()=>t.focus()),50)}))}}if(configs.showDictionaryButton&&!c&&!a&&o<=configs.dictionaryButtonWordsAmount&&addDictionaryButton(l),configs.addMarkerButton&&addMarkerButton(),configs.addButtonToCopyLinkToText){addBasicTooltipButton(chrome.i18n.getMessage("linkToTextLabel"),linkIcon,(function(){copyManuallyToClipboard(window.location.href+"#:~:text="+encodeURIComponent(selectedText))})).title=chrome.i18n.getMessage("linkToTextDescription")}if(configs.addExtendSelectionButton){const e=addBasicTooltipButton(chrome.i18n.getMessage("extendSelection"),extendSelectionIcon,extendSelectionToParentEl);e.title=chrome.i18n.getMessage("extendSelectionTooltip"),e.id="selecton-extend-selection-button"}configs.collapseButtons&&collapseButtons(),setCopyButtonTitle(copyButton,l,o),e()}!configs.showTranslateButton||c||a?d():addTranslateButton(d,l,o)}function checkToAddCalendarButton(e){let t,o,n,i,l,s=!1,r=!1;const c=e.toLowerCase().split(" "),a=new Date;e:for(let e=0,d=c.length;e<d;e++){const d=c[e];for(j in dateKeywords.month){const e=dateKeywords.month[j];if(d.includes(e)){n=dateKeywords.month[j%12];continue e}}for(j in dateKeywords.weekday){const e=dateKeywords.weekday[j];if(d.includes(e)){t=dateKeywords.weekday[j%7],s=!0;continue e}}for(j in dateKeywords.tomorrow){const e=dateKeywords.tomorrow[j];if(d.includes(e)){const e=new Date((new Date).getTime()+864e5);t=dateKeywords.weekday[e.getDay()],o=e.getDate(),n=dateKeywords.month[a.getMonth()],s=!0,r=!0;continue e}}const u=d.length,g=isStringNumeric(d);if(g&&u>=1&&u<3){const t=c[e+1];if(t&&("am"==t.toLowerCase()||"pm"==t.toLowerCase()))continue;o&&!i?i=d:(o=d,s=!0)}else g&&4==u?(i=d,n&&(s=!0)):d.includes(":")&&(l=d,2==l.split(":").length&&(l+=":00"))}if(!s){if(e.includes("/")){const t=new Date(e);if(isNaN(t))return;return void addCalendarButtonFromDate(t,a,r)}if(e.includes(".")){const t=e.split("."),o=t.length;if(o>=2&&o<=3){let e=t[0],n=t[1],i=o<3?a.getFullYear():t[2];if(""==e||""==n)return;if(0==parseInt(e))return;if(i.length<2)return;const l=new Date(`${i}/${n}/${e}`);if(isNaN(l))return;addCalendarButtonFromDate(l,a,r)}return}return}if(i||(i=a.getFullYear()),!n&&!o&&t){let e=new Date,i=(dateKeywords.weekday.indexOf(t)+7-e.getDay())%7;e.setDate(e.getDate()+i),n=dateKeywords.month[e.getMonth()],o=e.getDate()+1}let d="";t&&(d+=`${t}, `),o&&(d+=`${o} `),n&&(d+=`${n} `),i&&(d+=`${i} `),l&&(d+=`${l} `);const u=new Date(Date.parse(d));isNaN(u)||addCalendarButtonFromDate(u,a,r,l)}function addCalendarButtonFromDate(e,t,o,n){const i=t-e,l=-1*Math.floor(i/864e5);let s,r;if(o)s=e.toLocaleDateString(void 0,{month:"short",day:"numeric"});else if(l<=-360){const e=-1*Math.ceil(l/360);s=1==e?chrome.i18n.getMessage("yearAgo"):chrome.i18n.getMessage("yearsAgo",`${e}`)}else if(l<-30&&l>-360){const e=-1*Math.ceil(l/30);s=1==e?chrome.i18n.getMessage("monthAgo"):chrome.i18n.getMessage("monthsAgo",`${e}`)}else if(l<0&&l>=-30){const e=-1*l;s=1==e?chrome.i18n.getMessage("dayAgo"):chrome.i18n.getMessage("daysAgo",`${e}`)}else if(0==l)s=chrome.i18n.getMessage("today");else if(l>0&&l<30)s=1==l?chrome.i18n.getMessage("inDay"):chrome.i18n.getMessage("inDays",`${l}`);else if(l>=29&&l<360){const e=Math.floor(l/30);s=1==e?chrome.i18n.getMessage("inMonth"):chrome.i18n.getMessage("inMonths",`${e}`)}else if(l>=360){const e=Math.floor(l/360);s=1==e?chrome.i18n.getMessage("inYear"):chrome.i18n.getMessage("inYears",`${e}`)}else s=e.toLocaleDateString(void 0,{month:"short",day:"numeric"});if(n){let t=e.toISOString().replaceAll(":","").replaceAll("-","");r=`https://calendar.google.com/calendar/u/0/r/eventedit?&dates=${t}/${t}&sf=true`}else r=`https://calendar.google.com/calendar/u/0/r/day/${e.getFullYear()}/${e.getMonth()+1}/${e.getDate()}`;const c=addLinkTooltipButton(s,calendarIcon,r);c.title=e.toLocaleDateString(),c.classList.add("color-highlight"),"onlyicon"==configs.buttonsStyle&&(c.innerHTML+=" "+s)}function collapseButtons(){const e=configs.maxTooltipButtonsToShow??3,t=tooltip.children.length-1;if(t>e){let o,n;if(configs.collapseAsSecondPanel)o=createHoverPanelForButton(void 0,void 0,void 0,!1,!1,!0,!1,!0),o.style.right="2px",setTimeout((()=>{o.style.transform=returnTooltipRevealTransform(!1,!1),o.style.zIndex="-1",tooltip&&tooltip.appendChild(o)}),2);else{n=document.createElement("button"),n.setAttribute("class",configs.showButtonBorders?"selection-popup-button button-with-border":"selection-popup-button"),n.classList.add("more-button"),n.innerText=configs.verticalLayoutTooltip?"⋯":"⋮",tooltip.appendChild(n),o=createHoverPanelForButton(n,void 0,void 0,!1,!0,!0,!1);const i=n.querySelector(".selecton-hover-button-indicator");i&&(i.innerText=t-e,i.classList.add("selecton-more-button-child-count"))}o.style.maxWidth="unset",o.style.zIndex="2",o.classList.add("default-padding-tooltip");for(let n=t;n>e;n--){const e=tooltip.children[n];configs.verticalLayoutTooltip?o.prepend(e):o.appendChild(e)}configs.collapseAsSecondPanel||n.appendChild(o),setBorderRadiusForSideButtons(o,!1)}}function addDictionaryButton(e){try{const t=configs.languageToTranslate,o="https://"+(t?t+".":"")+`wikipedia.org/w/index.php?search=${encodeURIComponent(selectedText)}`,n=addLinkTooltipButton(dictionaryLabel,dictionaryButtonIcon,o);e<500&&setLiveWikiButton(selectedText,n)}catch(e){configs.debugMode&&console.log(e)}}function setLiveWikiButton(e,t){let o=!1,n=createHoverPanelForButton(t,`${chrome.i18n.getMessage("searchingDefinitions")??"Searching"}...`,(function(){0==o&&(o=!0,fetchDefinition(e,n,t))}));t.appendChild(n)}async function fetchDefinition(e,t,o){let n,i=chrome.i18n.getMessage("noDefinitionFound")??"No definition found",l=configs.languageToTranslate,s=encodeURIComponent(e.replaceAll(" ","_"));function r(e,t,i){try{let i=e;i.includes("-")&&(i=i.split("-")[0]),i.includes("_")&&(i=i.split("_")[0]);const l=`https://${i}.wikipedia.org/w/api.php?action=query&exsectionformat=plain&prop=extracts&origin=*&exchars=${configs.dictionaryButtonResponseCharsAmount??300}&exlimit=1&explaintext=0&formatversion=2&format=json&titles=${s}`;chrome.runtime.sendMessage({type:"background_fetch",url:l},(i=>{let l=i,s=l.query.pages[0].extract;s&&(n=s),l.query.pages[0].pageid&&(o.href=`https://${e}.wikipedia.org/?curid=${l.query.pages[0].pageid}`),t(i)}))}catch(e){console.log(e),i(e)}}r(l,(e=>{function o(){t.innerText=n,t.classList.add("selecton-live-translation"),t.style.maxWidth="450%",n.includes("\n        ")&&(t.style.textAlign="start");let e,o=configs.fontSize/1.5;null!=l&&""!==l&&(e=document.createElement("span"),e.textContent=l,e.setAttribute("style",`opacity: 0.7; position: absolute; right: 6px; bottom: 6px; font-size: ${o}px;color: var(--selection-button-foreground) !important`),t.appendChild(e))}null==n||null==n||""==n?(l="en",r("en",(e=>{null!=n&&null!=n&&""!=n?o():t.innerText=i}))):o()}))}let possibleMarkerColors=[{color:"yellow",foreground:"black"},{color:"lightblue",foreground:"black"},{color:"lightgreen",foreground:"black"},{color:"red",foreground:"white"}];function addMarkerButton(){const e=addBasicTooltipButton(markerLabel,markerIcon,(function(){markTextSelection(void 0,void 0,selection.toString()),saveAllMarkers(),removeSelectionOnPage()}));e.classList.add("higher-z-index"),setTimeout((function(){let t=createHoverPanelForButton(e,void 0,void 0,!1,!0,!1,!1);t.style.maxWidth="500%",t.classList.add("default-padding-tooltip");for(let e=0,o=possibleMarkerColors.length;e<o;e++){let o=possibleMarkerColors[e];const n=document.createElement("button");n.className="selection-popup-button",configs.showButtonBorders&&n.classList.add("button-with-border");const i=document.createElement("div");i.setAttribute("class","selection-popup-color-preview-circle"),i.style.background=o.color,n.appendChild(i),n.addEventListener("mousedown",(function(e){e.stopPropagation(),markTextSelection(o.color,o.foreground,selection.toString()),saveAllMarkers(),removeSelectionOnPage()})),t.prepend(n)}setBorderRadiusForSideButtons(t,!1),e.appendChild(t)}),5)}function setHoverForSearchButton(e){let t=createHoverPanelForButton(e,void 0,void 0,!0);t.classList.add("no-padding-tooltip"),t.style.textAlign="start";let o=configs.customSearchButtons.filter(((e,t)=>e.enabled));const n=o.length;if(0==n)return;const i=document.createElement("a");i.style.display=verticalSecondaryTooltip?"block":"inline-block",i.style.textAlign="start",i.className="custom-search-image-button",verticalSecondaryTooltip||(i.style.padding="0px");const l=configs.maxIconsInRow;for(var s=0;s<n;s++){const e=o[s],n=e.url,l=e.enabled,r=e.title,c=e.icon;if(l&&""!==n){let e=document.createElement("img");e.setAttribute("class","selecton-search-tooltip-icon"),e.addEventListener("error",(function(){configs.debugMode&&console.log("error loading favicon for: "+n+" because of security policies of website")})),e.setAttribute("src",null!=c&&""!==c?c:"https://www.google.com/s2/favicons?domain="+n.split("/")[2]);let o=null!=r&&""!==r?r:returnDomainFromUrl(n);const l=i.cloneNode(!0);if(verticalSecondaryTooltip){l.appendChild(e);const t=document.createElement("span");t.textContent=o.charAt(0).toUpperCase()+o.slice(1),l.appendChild(t)}else e.style.margin="3px 6px",e.title=o,l.appendChild(e);t.appendChild(l),l.addEventListener("mousedown",(function(e){e.stopPropagation()})),l.href=returnSearchButtonUrl(n),l.target="_blank"}}i.remove(),!verticalSecondaryTooltip&&n>l&&(t.style.display="grid",t.style.gridTemplateColumns=`repeat(${l}, 1fr)`),e.appendChild(t)}function returnSearchButtonUrl(e){let t=selection.toString();t=encodeURI(t),t=t.replaceAll("&","%26").replaceAll("+","%2B");let o=e.replaceAll("%s",t);if(o.includes("%w"))try{let e=window.location.href.split("/")[2];o=o.replaceAll("%w",e)}catch(e){configs.debugMode&&console.log(e)}return o}function onSearchButtonClick(e,t){let o=returnSearchButtonUrl(t);try{let t=e||window.event;"buttons"in t&&(0==t.button?(hideTooltip(),removeSelectionOnPage(),chrome.runtime.sendMessage({type:"selecton-open-new-tab",url:o,focused:!0})):1==t.button&&(t.preventDefault(),configs.middleClickHidesTooltip&&(hideTooltip(),removeSelectionOnPage()),chrome.runtime.sendMessage({type:"selecton-open-new-tab",url:o,focused:!1})))}catch(e){window.open(o,"_blank")}}function addTranslateButton(e,t,o){try{chrome.i18n.detectLanguage?chrome.i18n.detectLanguage(selectedText,(function(e){configs.debugMode&&console.log("Checking if its needed to add Translate button...");let t=!1;configs.debugMode&&console.log(`User language is: ${configs.languageToTranslate}`);let o,i=e;if(null!=i){const e=i.languages;e.length>0?(o=e[0].language,configs.debugMode&&console.log("Detected language: "+o),configs.showInfoPanel&&i.isReliable&&!configs.verticalLayoutTooltip&&setTimeout((function(){infoPanel&&infoPanel.isConnected&&(infoPanel.innerText+=" · "+o)}),5),t=o!=configs.languageToTranslate||!configs.hideTranslateButtonForUserLanguage):(configs.debugMode&&console.log("Selecton failed to detect language of selected text"),t=configs.showTranslateIfLanguageUnknown??!1)}else configs.debugMode&&console.log("Selecton failed to detect language of selected text"),t=configs.showTranslateIfLanguageUnknown??!1;configs.debugMode&&console.log(`Should translate: ${t}`),n(t,o)})):n(!0)}catch(e){configs.debugMode&&console.log(e)}function n(n,i){1==n&&setRegularTranslateButton(i,t,o),e&&e()}}function setRegularTranslateButton(e,t,o){const n=e!=configs.languageToTranslate||configs.hideTranslateButtonForUserLanguage?returnTranslateUrl(selectedText):returnTranslateUrl(selectedText,"en"),i=addLinkTooltipButton(translateLabel,translateButtonIcon,n);i.setAttribute("id","selecton-translate-button"),configs.liveTranslation&&t<500&&setTimeout((function(){configs.translateSingleWordsImmediately&&1==o&&!/[:\/"'']/.test(selectedText)?fetchTranslation(selectedText,"auto",configs.languageToTranslate,void 0,i,!0):setLiveTranslateOnHoverButton(selectedText,"auto",configs.languageToTranslate,i)}),5)}function setLiveTranslateOnHoverButton(e,t,o,n){let i=!1,l=createHoverPanelForButton(n,`${chrome.i18n.getMessage("translating")??"Translating"}...`,(function(){0==i&&(i=!0,fetchTranslation(e,t,o,l,n))}));n.appendChild(l)}async function fetchTranslation(e,t,o,n,i,l=!1){let s=chrome.i18n.getMessage("noTranslationFound");const r=`https://translate.googleapis.com/translate_a/single?client=gtx&sl=${t}&tl=${o}&dt=t&dt=bd&dj=1&q=${encodeURIComponent(e)}`;chrome.runtime.sendMessage({type:"background_fetch",url:r},(t=>{let o,r,c=t;if(configs.debugMode&&(console.log("Response from Google Translate:"),console.log(c)),c){try{o=c.dict[0].terms[0]}catch(e){o="",c.sentences.forEach((function(e){o+=e.trans}))}try{r=c.src}catch(e){}if(null!=o&&""!==o&&o.replaceAll(" ","")!==e.replaceAll(" ","")){if(l){let e=i.querySelector("span");e||(e=i),e.innerText=o,e.classList.add("selecton-live-translation"),i.title="Provided by Google Translate"}else n.innerText=o,n.classList.add("selecton-live-translation");let e,t=configs.fontSize/1.5,s=3.5;null!=r&&""!==r&&(e=document.createElement("span"),e.textContent=r,e.setAttribute("style",`opacity: 0.7; position: relative; right: -${s}px; bottom: -2.5px; font-size: ${t}px;color: var(--selection-button-foreground) !important`),l?i.appendChild(e):n.appendChild(e))}else n.innerHTML=s}else n.innerText=s}))}function initConfigs(e){const t=Object.keys(configs);chrome.storage.local.get(t,(function(t){if(configs.changeTextSelectionColor=t.changeTextSelectionColor??!1,configs.textSelectionBackground=t.textSelectionBackground||"#338FFF",configs.textSelectionColor=t.textSelectionColor||"#ffffff",configs.textSelectionBackgroundOpacity=t.textSelectionBackgroundOpacity||1,configs.shouldOverrideWebsiteSelectionColor=t.shouldOverrideWebsiteSelectionColor??!1,configs.enabled=t.enabled??!0,configs.ratesLastFetchedDate=t.ratesLastFetchedDate,configs.excludedDomains=t.excludedDomains||"",null!==configs.excludedDomains&&void 0!==configs.excludedDomains&&""!==configs.excludedDomains&&configs.excludedDomains.split(",").forEach((function(e){window.location.href.includes(e.trim().toLowerCase())&&(configs.enabled=!1)})),configs.enabled){configs.changeTextSelectionColor&&setTimeout((function(){setTextSelectionColor()}),1);const o=Object.keys(configs);for(let e=0,n=o.length;e<n;e++)try{let n=o[e];null!==t[n]&&void 0!==t[n]&&(configs[n]=t[n])}catch(t){console.log("Selecton failed to restore config: "+o[e].toString()),console.log("Error: "+t.toString())}if(configs.animationDuration<0&&(configs.animationDuration=0),configs.updateRatesEveryDays<0&&(configs.updateRatesEveryDays=14),addButtonIcons="onlyicon"==configs.buttonsStyle||"iconlabel"==configs.buttonsStyle,verticalSecondaryTooltip="verticalLayout"==configs.secondaryTooltipLayout,configs.debugMode&&(console.log("Loaded Selecton settings from memory:"),console.log(configs)),0==configsWereLoaded&&(setTimeout((function(){configs.addActionButtonsForTextFields?initMouseListeners():document.addEventListener("selectionchange",selectionChangeInitListener),configs.addMarkerButton&&initMarkersRestore()}),1),configsWereLoaded=!0,String.prototype.replaceAll||(String.prototype.replaceAll=function(e,t){return this.replace(new RegExp(e.replace(/[-\/\\^$*+?.()|[\]{}]/g,"\\$&"),"g"),t)})),null==t.preferredMetricsSystem||null==t.preferredMetricsSystem)try{setDefaultLocales()}catch(e){}domainIsBlacklistedForSnapping=!1,configs.snapSelectionToWord&&null!==configs.wordSnappingBlacklist&&void 0!==configs.wordSnappingBlacklist&&""!==configs.wordSnappingBlacklist&&configs.wordSnappingBlacklist.split(",").forEach((function(e){window.location.href.includes(e.trim().toLowerCase())&&(domainIsBlacklistedForSnapping=!0)})),e&&e()}}))}function setTextSelectionColor(){let e=configs.shouldOverrideWebsiteSelectionColor?"!important":"",t=hexToRgb(configs.textSelectionBackground),o=`::selection {background-color: rgba(${t.red}, ${t.green}, ${t.blue}, ${configs.textSelectionBackgroundOpacity}) ${e}; color: ${configs.textSelectionColor} ${e}; }`;o+=`::-moz-selection {background-color: rgba(${t.red}, ${t.green}, ${t.blue}, ${configs.textSelectionBackgroundOpacity}) ${e}; color: ${configs.textSelectionColor} ${e};}`;let n=document.createElement("style");n.type="text/css",n.appendChild(document.createTextNode(o)),document.getElementsByTagName("head")[0].appendChild(n),configs.debugMode&&console.log("Selecton applied custom selection color")}function setDocumentStyles(){switch(document.documentElement.style.setProperty("--selecton-font-size",`${configs.useCustomStyle?configs.fontSize:12.5}px`),document.documentElement.style.setProperty("--selecton-button-icon-height",1.35*configs.fontSize+"px"),document.documentElement.style.setProperty("--selecton-border-radius",`${configs.useCustomStyle?configs.borderRadius:4}px`),document.documentElement.style.setProperty("--selecton-button-border-left","1px solid var(--selection-button-background-hover)"),document.documentElement.style.setProperty("--selecton-tooltip-inner-padding","2px"),configs.buttonsStyle){case"onlylabel":default:document.documentElement.style.setProperty("--selecton-button-padding","4px 10px");break;case"onlyicon":document.documentElement.style.setProperty("--selecton-button-padding","3px 10px");break;case"iconlabel":document.documentElement.style.setProperty("--selecton-button-padding","3px 8px")}document.documentElement.style.setProperty("--selecton-handle-circle-radius","10px"),document.documentElement.style.setProperty("--selecton-search-tooltip-icon-size",`${configs.secondaryTooltipIconSize}px`),document.documentElement.style.setProperty("--selecton-anim-duration",`${configs.animationDuration}ms`)}function loadCurrencyRates(){if(configs.convertCurrencies){let e=configs.updateRatesEveryDays;if(e<7&&(e=7),null==(ratesLastFetchedDate=configs.ratesLastFetchedDate)||null==ratesLastFetchedDate||""==ratesLastFetchedDate)fetchCurrencyRates();else{let t=new Date,o=new Date(ratesLastFetchedDate);const n=864e5;configs.debugMode&&(console.log("--- Check dates to update currency rates ---"),console.log("Today: "+t),console.log("Date of last fetch: "+o)),t=t.getTime(),o=new Date(o.getTime()+e*n),configs.debugMode&&(console.log("Rates update interval: "+e),console.log("Date of next fetch: "+o),console.log("--- Finished checking dates ---")),loadCurrencyRatesFromMemory(),t>=o&&(configs.debugMode&&console.log("Trying to fetch updated currency rates..."),fetchCurrencyRates())}}}function loadTranslatedLabels(){copyLabel=chrome.i18n.getMessage("copyLabel"),searchLabel=chrome.i18n.getMessage("searchLabel"),translateLabel=chrome.i18n.getMessage("translateLabel"),openLinkLabel=chrome.i18n.getMessage("openLinkLabel"),showOnMapLabel=chrome.i18n.getMessage("showOnMap"),cutLabel=chrome.i18n.getMessage("cutLabel"),pasteLabel=chrome.i18n.getMessage("pasteLabel"),dictionaryLabel=chrome.i18n.getMessage("dictionaryLabel"),markerLabel=chrome.i18n.getMessage("markerLabel"),italicLabel=chrome.i18n.getMessage("italicLabel"),boldLabel=chrome.i18n.getMessage("boldLabel"),strikeLabel=chrome.i18n.getMessage("strikeLabel"),clearLabel=chrome.i18n.getMessage("clearLabel")}function initMouseListeners(){function e(){configs.debugMode&&console.log("--- Creating Selecton tooltip ---"),setTimeout((function(){let e=!1;if(configs.invertColorOnDarkWebsite)try{e=window.matchMedia&&window.matchMedia("(prefers-color-scheme: dark)").matches}catch(e){}if(configs.useCustomStyle){const t=e?configs.tooltipInvertedBackground:configs.tooltipBackground;document.documentElement.style.setProperty("--selecton-background-color",t),getTextColorForBackground(t),document.documentElement.style.setProperty("--selection-button-foreground",isDarkTooltip?"rgb(255,255,255)":"rgb(0,0,0)"),document.documentElement.style.setProperty("--selection-button-background-hover",isDarkTooltip?"rgba(255,255,255, 0.3)":"rgba(0,0,0, 0.5)"),document.documentElement.style.setProperty("--selecton-outline-color",isDarkTooltip?"rgba(255,255,255, 0.2)":"rgba(0,0,0, 0.2)"),document.documentElement.style.setProperty("--selecton-info-panel-color",isDarkTooltip?"rgba(255,255,255, 0.7)":"rgba(0,0,0, 0.7)"),secondaryColor=isDarkTooltip?"lightBlue":"royalBlue"}else document.documentElement.style.setProperty("--selecton-background-color",e?"#bfbfbf":"#333232"),document.documentElement.style.setProperty("--selection-button-foreground",e?"#000000":"#ffffff"),document.documentElement.style.setProperty("--selection-button-background-hover",e?"rgba(0, 0, 0, 0.5)":"rgba(255, 255, 255, 0.3)"),document.documentElement.style.setProperty("--selecton-outline-color",e?"rgba(0, 0, 0, 0.2)":"rgba(255, 255, 255, 0.2)"),document.documentElement.style.setProperty("--selecton-info-panel-color",e?"rgba(0,0,0, 0.7)":"rgba(255,255,255, 0.7)"),secondaryColor=e?"royalBlue":"lightBlue",isDarkTooltip=!e;document.documentElement.style.setProperty("--selecton-button-icon-invert",`invert(${isDarkTooltip?"100":"0"}%)`),document.documentElement.style.setProperty("--selecton-secondary-color",secondaryColor)}),0)}function t(e){createTooltip(e),setTimeout((function(){document.documentElement.style.getPropertyValue("--selecton-font-size")||setDocumentStyles()}),0),configs.hideTooltipWhenCursorMovesAway&&"overCursor"==configs.tooltipPosition&&window.addEventListener("mousemove",mouseMoveToHideListener)}document.addEventListener("mousedown",(function(e){0!=tooltipIsShown&&0!=isTextFieldFocused&&(isDraggingTooltip||isDraggingDragHandle||0==e.button&&(hideTooltip(),configs.addDragHandles&&hideDragHandles()))})),document.addEventListener("mouseup",(function(o){if(!configs.enabled)return;if(isDraggingTooltip)return;const n=document.activeElement;"BUTTON"!=n.tagName&&setTimeout((function(){3==o.detail&&hideDragHandles(!1),selection=window.getSelection(),selectedText=selection.toString().trim();try{if("A"==n.tagName){let e=selection.focusNode.parentNode;if(e!==n&&e.parentNode!==n)return}}catch(e){}!function(e){if((isTextFieldFocused="INPUT"===e.tagName&&("text"==e.type||"email"==e.type||"search"==e.type||"text"==e.type)||"TEXTAREA"===e.tagName||e.hasAttribute("contenteditable"))&&configs.addActionButtonsForTextFields){if(""==selectedText&&navigator.userAgent.indexOf("Firefox")>-1){const e=document.querySelector(":focus");null!=e&&null!=e.value&&(selectedText=e.value.substring(e.selectionStart,e.selectionEnd),selection=e.value.substring(e.selectionStart,e.selectionEnd))}try{isTextFieldEmpty=!0,(null!=e.getAttribute("contenteditable")&&""!=e.innerHTML&&""==selectedText&&"<br>"!=e.innerHTML||e.value&&""!==e.value.trim()&&""==selectedText)&&(isTextFieldEmpty=!1,configs.addPasteOnlyEmptyField&&(isTextFieldFocused=!1))}catch(e){console.log(e)}}}(n),(selectedText.length>0||configs.addActionButtonsForTextFields&&isTextFieldFocused)&&(e(),t(o))}),3==o.detail?200:0)}));try{window.addEventListener("popstate",(function(){hideTooltip(),hideDragHandles(),configs.debugMode&&console.log("Selecton tooltip was hidden on url change")}))}catch(e){configs.debugMode&&console.log(e)}document.addEventListener("scroll",(function(e){if(0==tooltipIsShown)return;isDraggingDragHandle&&hideDragHandles(!0,!0);if(configs.floatingOffscreenTooltip)if(0!=floatingTooltipTop){if(window.scrollY>=floatingTooltipTop)return}else if(0!=floatingTooltipBottom&&window.scrollY<=floatingTooltipBottom)return;hideTooltip(!configs.recreateTooltipAfterScroll),hideDragHandles(!configs.recreateTooltipAfterScroll),recreateTooltip()})),window.addEventListener("resize",(function(e){0!=tooltipIsShown&&(configs.debugMode&&console.log("hiding all Selecton overlays on window resize..."),hideTooltip(!1),hideDragHandles(!1),recreateTooltip())})),document.addEventListener("dragstart",(function(e){0!=tooltipIsShown&&(e.target.classList&&e.target.classList.contains("selection-popup-button")||(configs.debugMode&&console.log("hiding all Selecton overlays on drag start..."),hideTooltip(),hideDragHandles()))})),configs.hideOnKeypress&&document.addEventListener("keydown",(function(e){0!=tooltipIsShown&&"Control"!=e.key&&(e.shiftKey||(hideTooltip(),hideDragHandles()))})),configs.debugMode&&console.log("Selecton initiated mouse listeners"),loadCurrencyRates(),setDocumentStyles(),loadTranslatedLabels(),chrome.storage.onChanged.addListener((o=>{o.expandedSettingsSections||initConfigs((()=>{setDocumentStyles(),e(),tooltipIsShown&&t(lastMouseUpEvent)}))}))}function recreateTooltip(){0!=configs.recreateTooltipAfterScroll&&(null!==timerToRecreateOverlays&&(clearTimeout(timerToRecreateOverlays),timerToRecreateOverlays=null),timerToRecreateOverlays=setTimeout((function(){selection=window.getSelection(),selectedText=selection.toString().trim(),selection&&selectedText.length>0&&createTooltip(lastMouseUpEvent,!0)}),650))}function selectionChangeInitListener(){if(configs.enabled&&!(document.getSelection().toString().length<1)){document.removeEventListener("selectionchange",selectionChangeInitListener);try{initMouseListeners()}catch(e){configs.debugMode&&console.log("Error while setting Selecton mouse listeners: "+e)}}}initConfigs();