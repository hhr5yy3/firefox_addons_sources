(()=>{"use strict";var t,e={9995:function(t,e,n){var i=this&&this.__awaiter||function(t,e,n,i){return new(n||(n=Promise))((function(a,o){function s(t){try{r(i.next(t))}catch(t){o(t)}}function u(t){try{r(i.throw(t))}catch(t){o(t)}}function r(t){var e;t.done?a(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(s,u)}r((i=i.apply(t,e||[])).next())}))},a=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const o=a(n(2293)),s=a(n(4516)),u=n(8309);e.default=class{constructor(t){this.baseUrl=t,this.solutionEndpoint=t+"quiz/solution",this.attemptEndpoint=t+"quiz/attempt",this.reviewEndpoint=t+"quiz/review"}requestSolution(t){return i(this,void 0,void 0,(function*(){const e=this.solutionEndpoint+"?"+new URLSearchParams(Object.assign(Object.assign({},t),s.default)),n=yield(0,u.fetchWithTimeout)(e,{method:"GET"});return n.ok?yield n.json():(o.default.warn("Solution request failed",n),[])}))}sendAttemptData(t){(0,u.fetchWithTimeout)(this.attemptEndpoint,{timeout:2e4,method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(Object.assign(Object.assign({},t),s.default))}).then((t=>{if(!t.ok)return o.default.warn("Failed to send attempt data",t),t.json()})).then((t=>{t&&o.default.warn("Response body",t)}))}sendReviewData(t){(0,u.fetchWithTimeout)(this.reviewEndpoint,{timeout:2e4,method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(Object.assign(Object.assign({},t),s.default))}).then((t=>{if(!t.ok)return o.default.warn("Failed to send review data",t,t.json()),t.json()})).then((t=>{t&&o.default.warn("Response body",t)}))}}},677:function(t,e,n){var i=this&&this.__awaiter||function(t,e,n,i){return new(n||(n=Promise))((function(a,o){function s(t){try{r(i.next(t))}catch(t){o(t)}}function u(t){try{r(i.throw(t))}catch(t){o(t)}}function r(t){var e;t.done?a(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(s,u)}r((i=i.apply(t,e||[])).next())}))},a=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0}),e.SystemApi=void 0;const o=a(n(4516)),s=a(n(2293)),u=n(8309);e.SystemApi=class{constructor(t){this.baseUrl=t,this.checkStatusEndpoint=t+"status",this.checkUpdateEndpoint=t+"update"}getServiceStatus(){return i(this,void 0,void 0,(function*(){const t=this.checkStatusEndpoint+"?"+new URLSearchParams(Object.assign({},o.default));try{const e=yield(0,u.fetchWithTimeout)(t,{method:"GET",timeout:8e3});return e.ok?yield e.json():(s.default.warn("Status request failed",e),null)}catch(t){return null}}))}checkUpdate(){return i(this,void 0,void 0,(function*(){const t=this.checkUpdateEndpoint+"?"+new URLSearchParams(Object.assign({},o.default));try{const e=yield(0,u.fetchWithTimeout)(t,{method:"GET"});return e.ok?yield e.json():(s.default.warn("Update check request failed",e),null)}catch(t){return null}}))}}},4516:(t,e)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.default={client:"1.1.6"}},851:function(t,e,n){var i=this&&this.__awaiter||function(t,e,n,i){return new(n||(n=Promise))((function(a,o){function s(t){try{r(i.next(t))}catch(t){o(t)}}function u(t){try{r(i.throw(t))}catch(t){o(t)}}function r(t){var e;t.done?a(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(s,u)}r((i=i.apply(t,e||[])).next())}))},a=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const o=a(n(8651)),s=a(n(9686)),u=a(n(313)),r=a(n(1718)),l=a(n(9995)),d=a(n(8394)),c=n(677),f=a(n(1422));!function(){i(this,void 0,void 0,(function*(){const t=new u.default,e=new l.default("https://syncshare.naloaty.me/api/v2/"),n=new c.SystemApi("https://syncshare.naloaty.me/api/v2/"),i=new s.default,a=new r.default(e);yield i.init(t),yield a.init(t);const h=new d.default,p=new o.default(n),v=new f.default(n);yield h.init(t),yield p.init(t),yield v.init(t)}))}()},8394:function(t,e,n){var i=this&&this.__awaiter||function(t,e,n,i){return new(n||(n=Promise))((function(a,o){function s(t){try{r(i.next(t))}catch(t){o(t)}}function u(t){try{r(i.throw(t))}catch(t){o(t)}}function r(t){var e;t.done?a(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(s,u)}r((i=i.apply(t,e||[])).next())}))},a=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const o=a(n(4643)),s=a(n(3150)),u=a(n(2293)),r={install:{title:s.default.i18n.getMessage("installTitle"),content:s.default.i18n.getMessage("installContent"),construct:!0,keyboard:!1,backdrop:"static",headerClose:!1,buttons:[{text:s.default.i18n.getMessage("gotIt"),value:!1,attr:{class:"btn btn-primary","data-dismiss":"modal"}}]}};e.default=class{init(t){return i(this,void 0,void 0,(function*(){t.bind(o.default.GetInstallationMessage,(t=>this.getInstallationMessage())),u.default.info("ChangelogMessage: initialized")}))}getInstallationMessage(){return i(this,void 0,void 0,(function*(){const t=yield s.default.storage.local.get({installationMessage:"none"});return u.default.info(`ChangelogMessages: Installation message status is '${t.installationMessage}'`),"none"===t.installationMessage?(yield s.default.storage.local.set({installationMessage:"1.1.6"}),r.install):null}))}}},8651:function(t,e,n){var i=this&&this.__awaiter||function(t,e,n,i){return new(n||(n=Promise))((function(a,o){function s(t){try{r(i.next(t))}catch(t){o(t)}}function u(t){try{r(i.throw(t))}catch(t){o(t)}}function r(t){var e;t.done?a(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(s,u)}r((i=i.apply(t,e||[])).next())}))},a=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const o=a(n(2293)),s=a(n(4643)),u=a(n(3150)),r={maintenance:{title:u.default.i18n.getMessage("maintenanceTitle"),content:u.default.i18n.getMessage("maintenanceContent"),construct:!0,keyboard:!1,backdrop:"static",headerClose:!1,buttons:[{text:u.default.i18n.getMessage("gotIt"),value:!1,attr:{class:"btn btn-primary","data-dismiss":"modal"}}]},highDemand:{title:u.default.i18n.getMessage("highDemandTitle"),content:u.default.i18n.getMessage("highDemandContent"),construct:!0,keyboard:!1,backdrop:"static",headerClose:!1,buttons:[{text:u.default.i18n.getMessage("Donate"),value:!0,tag:"url",data:"https://syncshare.naloaty.me/#donation",attr:{class:"btn btn-default","data-dismiss":"modal"}},{text:u.default.i18n.getMessage("gotIt"),value:!1,attr:{class:"btn btn-primary","data-dismiss":"modal"}}]},unreachable:{title:u.default.i18n.getMessage("serviceUnreachableTitle"),content:u.default.i18n.getMessage("serviceUnreachableContent"),construct:!0,keyboard:!1,backdrop:"static",headerClose:!1,buttons:[{text:u.default.i18n.getMessage("gotIt"),value:!1,attr:{class:"btn btn-primary","data-dismiss":"modal"}}]}};e.default=class{constructor(t){this.systemApi=t}init(t){return i(this,void 0,void 0,(function*(){t.bind(s.default.GetStatusMessage,(t=>this.getStatusMessage())),o.default.info("StatusMessage: initialized")}))}getStatusMessage(){return i(this,void 0,void 0,(function*(){const t=yield this.systemApi.getServiceStatus();return o.default.info(`Service status is '${t}'`),null===t?r.unreachable:t.maintenance?r.maintenance:t.highDemand?r.highDemand:void 0}))}}},1422:function(t,e,n){var i=this&&this.__awaiter||function(t,e,n,i){return new(n||(n=Promise))((function(a,o){function s(t){try{r(i.next(t))}catch(t){o(t)}}function u(t){try{r(i.throw(t))}catch(t){o(t)}}function r(t){var e;t.done?a(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(s,u)}r((i=i.apply(t,e||[])).next())}))},a=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const o=a(n(2293)),s=a(n(4643)),u=a(n(3150)),r={title:u.default.i18n.getMessage("updateAvailableTitle"),content:u.default.i18n.getMessage("updateAvailableContent"),construct:!0,keyboard:!1,backdrop:"static",headerClose:!1,buttons:[{text:u.default.i18n.getMessage("Update"),value:!0,tag:"url",data:"https://syncshare.naloaty.me/#install",attr:{class:"btn btn-primary","data-dismiss":"modal"}}]};e.default=class{constructor(t){this.systemApi=t}init(t){return i(this,void 0,void 0,(function*(){t.bind(s.default.GetUpdateMessage,(t=>this.getUpdateMessage())),o.default.info("UpdateMessage: initialized")}))}getUpdateMessage(){return i(this,void 0,void 0,(function*(){const t=yield this.systemApi.checkUpdate();return null===t?null:t.updateRequired?r:null}))}}},1718:function(t,e,n){var i=this&&this.__awaiter||function(t,e,n,i){return new(n||(n=Promise))((function(a,o){function s(t){try{r(i.next(t))}catch(t){o(t)}}function u(t){try{r(i.throw(t))}catch(t){o(t)}}function r(t){var e;t.done?a(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(s,u)}r((i=i.apply(t,e||[])).next())}))},a=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const o=a(n(2293)),s=a(n(4643)),u=n(1742),r=n(42),l=a(n(3150));e.default=class{constructor(t){this.quizApi=t}init(t){return i(this,void 0,void 0,(function*(){o.default.info("AttemptService: initializing..."),l.default.runtime.onStartup.addListener((function(){l.default.storage.local.remove("attemptData"),l.default.storage.local.remove("magicButtonsState"),o.default.info("AttemptService: Saved state invalidated"),l.default.storage.local.remove("attempts")})),t.bind(s.default.QuizAttemptData,(t=>{(0,r.isObject)(t)&&"quizMeta"in t&&(0,u.isPageData)(t.quizMeta)&&"questions"in t&&(0,r.isArray)(t.questions)?this.onAttemptData(t.quizMeta,t.questions):o.default.warn("AttemptService: got invalid attempt data",t)})),t.bind(s.default.QuizReviewData,(t=>{(0,r.isObject)(t)&&"quizMeta"in t&&(0,u.isPageData)(t.quizMeta)&&"reviewSummary"in t&&("string"==typeof t.reviewSummary||null===t.reviewSummary)&&"questions"in t&&(0,r.isArray)(t.questions)?this.onReviewData(t.quizMeta,t.questions,t.reviewSummary):o.default.warn("AttemptService: got invalid review data",t)})),t.bind(s.default.SolutionRequest,(t=>{if((0,r.isObject)(t)&&"quizMeta"in t&&(0,u.isPageData)(t.quizMeta)&&"questionId"in t&&"number"==typeof t.questionId&&"questionType"in t&&"string"==typeof t.questionType)return this.onSolutionRequest(t.quizMeta,t.questionId,t.questionType);o.default.warn("AttemptService: got invalid solution request",t)})),o.default.info("AttemptService: initialized")}))}onAttemptData(t,e){if(null===t.moodleId||null===t.host||null===t.courseId||null===t.courseName||null===t.quizId||null===t.quizName||null===t.attemptId)return void o.default.warn("Failed to send attempt data: some of the required properties are null.",t);const n={moodleId:t.moodleId,quizMeta:{host:t.host,courseId:t.courseId,courseName:t.courseName,quizId:t.quizId,quizName:t.quizName,attemptId:t.attemptId},questions:e};o.default.info("AttemptService: Sent attempt data",n),this.quizApi.sendAttemptData(n)}onReviewData(t,e,n){if(null===t.moodleId||null===t.host||null===t.courseId||null===t.courseName||null===t.quizId||null===t.quizName||null===t.attemptId)return void o.default.warn("AttemptService: Failed to send review data: some of the required properties are null.",t);const i={moodleId:t.moodleId,quizMeta:{host:t.host,courseId:t.courseId,courseName:t.courseName,quizId:t.quizId,quizName:t.quizName,attemptId:t.attemptId},questions:e,reviewSummary:n};o.default.info("AttemptService: Sent review data",i),this.quizApi.sendReviewData(i)}onSolutionRequest(t,e,n){return i(this,void 0,void 0,(function*(){if(null===t.moodleId||null===t.host||null===t.courseId||null===t.quizId||null===t.attemptId)return void o.default.warn("AttemptService: Failed to request solution: some of the required properties are null.",this);const i={host:t.host,courseId:t.courseId.toString(),quizId:t.quizId.toString(),attemptId:t.attemptId.toString(),moodleId:t.moodleId.toString(),questionId:e.toString(),questionType:n};o.default.info("AttemptService: Sent solution request",i);const a=yield this.quizApi.requestSolution(i);return o.default.info("AttemptService: Received solution",a),a}))}}},9686:function(t,e,n){var i=this&&this.__awaiter||function(t,e,n,i){return new(n||(n=Promise))((function(a,o){function s(t){try{r(i.next(t))}catch(t){o(t)}}function u(t){try{r(i.throw(t))}catch(t){o(t)}}function r(t){var e;t.done?a(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(s,u)}r((i=i.apply(t,e||[])).next())}))},a=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const o=a(n(2293)),s=a(n(4643)),u=n(8319),r=a(n(3150)),l={widgetToggleHotkey:"esc",widgetToggleDoubleClick:!0,hideWidgetByDefault:!1};e.default=class{init(t){return i(this,void 0,void 0,(function*(){t.bind(s.default.GetSettings,(t=>this.getSettings())),t.bind(s.default.SetSettings,(t=>{(0,u.isSettings)(t)?this.setSettings(t):o.default.warn("SettingService: got invalid settings object",t)})),this.bus=t,o.default.info("SettingService: initialized")}))}setSettings(t){return i(this,void 0,void 0,(function*(){yield r.default.storage.local.set({settings:t}),this.bus.publishToActiveTab(s.default.SettingsUpdated,t),this.bus.publishLocally(s.default.SettingsUpdated,t),o.default.info("SettingService: settings updated",t)}))}getSettings(){return i(this,void 0,void 0,(function*(){const t=yield r.default.storage.local.get({settings:l});return(0,u.isSettings)(t.settings)?t.settings:Object.assign(Object.assign({},t.settings),l)}))}}},8309:function(t,e){var n=this&&this.__awaiter||function(t,e,n,i){return new(n||(n=Promise))((function(a,o){function s(t){try{r(i.next(t))}catch(t){o(t)}}function u(t){try{r(i.throw(t))}catch(t){o(t)}}function r(t){var e;t.done?a(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(s,u)}r((i=i.apply(t,e||[])).next())}))};Object.defineProperty(e,"__esModule",{value:!0}),e.fetchWithTimeout=void 0,e.fetchWithTimeout=function(t,e={}){return n(this,void 0,void 0,(function*(){const{timeout:n=8e3}=e,i=new AbortController,a=setTimeout((()=>i.abort()),n),o=yield fetch(t,Object.assign(Object.assign({},e),{signal:i.signal}));return clearTimeout(a),o}))}}},n={};function i(t){var a=n[t];if(void 0!==a)return a.exports;var o=n[t]={exports:{}};return e[t].call(o.exports,o,o.exports,i),o.exports}i.m=e,t=[],i.O=(e,n,a,o)=>{if(!n){var s=1/0;for(d=0;d<t.length;d++){for(var[n,a,o]=t[d],u=!0,r=0;r<n.length;r++)(!1&o||s>=o)&&Object.keys(i.O).every((t=>i.O[t](n[r])))?n.splice(r--,1):(u=!1,o<s&&(s=o));if(u){t.splice(d--,1);var l=a();void 0!==l&&(e=l)}}return e}o=o||0;for(var d=t.length;d>0&&t[d-1][2]>o;d--)t[d]=t[d-1];t[d]=[n,a,o]},i.n=t=>{var e=t&&t.__esModule?()=>t.default:()=>t;return i.d(e,{a:e}),e},i.d=(t,e)=>{for(var n in e)i.o(e,n)&&!i.o(t,n)&&Object.defineProperty(t,n,{enumerable:!0,get:e[n]})},i.o=(t,e)=>Object.prototype.hasOwnProperty.call(t,e),i.r=t=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},i.j=352,(()=>{var t={352:0};i.O.j=e=>0===t[e];var e=(e,n)=>{var a,o,[s,u,r]=n,l=0;if(s.some((e=>0!==t[e]))){for(a in u)i.o(u,a)&&(i.m[a]=u[a]);if(r)var d=r(i)}for(e&&e(n);l<s.length;l++)o=s[l],i.o(t,o)&&t[o]&&t[o][0](),t[o]=0;return i.O(d)},n=self.webpackChunksyncshare_extension=self.webpackChunksyncshare_extension||[];n.forEach(e.bind(null,0)),n.push=e.bind(null,n.push.bind(n))})();var a=i.O(void 0,[351],(()=>i(851)));a=i.O(a)})();