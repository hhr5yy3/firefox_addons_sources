(window.webpackJsonp=window.webpackJsonp||[]).push([[8],{1012:function(e,t,n){"use strict";n.r(t);n(15),n(11);var r=n(0),i=n.n(r),a=n(3),o=n(34),s=n(221),l=n(8),c=n(17),d=n(174),h=n(693),p=n(1633),m=n(14),u=n(339),g=n(1466);function b(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function f(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?b(Object(n),!0).forEach((function(t){y(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):b(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function y(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}class S extends a.a{constructor(){super(...arguments),this.handleClickFind=()=>{h.c({environment:this.environment,analyticsFrom:"mobile-bottom-bar"}),m.ge(this.environment,{itemName:"search"})},this.handleClickQuickAdd=()=>{s.f({environment:this.environment,from:"mobile_bottom_bar"}),m.ge(this.environment,{itemName:"add_page"})},this.handleUndo=()=>{u.f(this.environment,!0),m.ge(this.environment,{itemName:"undo"})},this.handleRedo=()=>{u.e(this.environment,!0),m.ge(this.environment,{itemName:"redo"})},this.canQuickAdd=this.createComputedStore(()=>Boolean(c.a.state.currentSpaceStore&&c.a.state.currentSpaceStore.canEdit()))}renderComponent(){const e=g.a.state;if(e){const{isTablet:t}=this.environment.device;return i.a.createElement("div",{style:this.getWrapStyle(e)},t?this.renderTabletButtons():this.renderPhoneButtons())}}renderPhoneButtons(){return i.a.createElement(r.Fragment,null,this.renderSearchButton(),this.renderUpdatesButton(),this.renderQuickAddPageButton())}renderTabletButtons(){return i.a.createElement(r.Fragment,null,this.renderSearchButton(),this.renderUpdatesButton(),this.renderQuickAddPageButton(),this.renderUndoRedoButtons())}renderSearchButton(){return i.a.createElement(o.a,{style:this.getSearchButtonStyle(),onClick:this.handleClickFind,mobileFeedback:!0},l.a.mobileBottomBarSearch(this.getIconStyle()))}renderUpdatesButton(){const{isTablet:e}=this.environment.device;return i.a.createElement(p.a,{format:e?p.a.Format.MobileBottomBarTablet:p.a.Format.MobileBottomBarPhone})}renderQuickAddPageButton(){return i.a.createElement(o.a,{style:this.getQuickAddButtonStyle(),onClick:this.handleClickQuickAdd,mobileFeedback:!0,disabled:!this.canQuickAdd.state,disabledFeedback:!0},l.a.mobileBottomBarAddPage(this.getIconStyle()))}renderUndoRedoButtons(){return i.a.createElement(r.Fragment,null,i.a.createElement(o.a,{style:this.getUndoButtonStyle(),onClick:this.handleUndo,mobileFeedback:!0,disabled:!u.b(),disabledFeedback:!0},l.a.mobileBottomBarUndo(this.getIconStyle())),i.a.createElement(o.a,{style:this.getRedoButtonStyle(),onClick:this.handleRedo,mobileFeedback:!0,disabled:!u.a(),disabledFeedback:!0},l.a.mobileBottomBarRedo(this.getIconStyle())))}getWrapStyle(e){const{WindowSizeStore:t}=this.environment,{isTablet:n}=this.environment.device;return{position:"absolute",left:0,right:0,bottom:0,display:"flex",justifyContent:n?"flex-start":"space-around",height:t.getSafePaddingBottomCSS(S.height),paddingBottom:t.state.paddingBottomCSS,background:this.theme.contentBackground,borderTop:"1px ".concat(this.theme.darkDividerColor," solid"),zIndex:d.h,opacity:e?1:0,pointerEvents:e?"auto":"none",cursor:"pointer"}}getSearchButtonStyle(){const{WindowSizeStore:e}=this.environment,{isTablet:t}=this.environment.device;return f({display:"flex",alignItems:"center",justifyContent:"flex-start",flex:1,paddingLeft:e.getSafePaddingLeftCSS(18)},t&&{flex:"none",paddingLeft:2,width:S.tabletButtonWidth,justifyContent:"center"})}getQuickAddButtonStyle(){const{WindowSizeStore:e}=this.environment,{isTablet:t}=this.environment.device;return f({display:"flex",alignItems:"center",justifyContent:"flex-end",flex:1,paddingRight:e.getSafePaddingRightCSS(18)},t&&{justifyContent:"center",flex:"none",paddingRight:0,width:S.tabletButtonWidth,marginRight:"auto"})}getUndoButtonStyle(){const{WindowSizeStore:e}=this.environment;return{display:"flex",alignItems:"center",justifyContent:"flex-start",flex:"none",paddingLeft:e.getSafePaddingLeftCSS(18),width:S.tabletButtonWidth}}getRedoButtonStyle(){return{display:"flex",alignItems:"center",justifyContent:"center",flex:"none",width:S.tabletButtonWidth,paddingRight:4}}getIconStyle(){return{width:26,fill:this.theme.regularTextColor}}}S.height=44,S.tabletButtonWidth=54,t.default=S},1092:function(e,t,n){"use strict";n.r(t);n(15),n(11);var r=n(0),i=n.n(r),a=n(174),o=n(14),s=n(8),l=n(27),c=n(111),d=n(82),h=n(757),p=n(47),m=n(3),u=n(768),g=n(773),b=n(331),f=n(1455),y=n(1248),S=n(84),v=n(221),w=n(25),E=n(619),O=n(507),k=n(552),P=n(34),C=n(68),M=n(161),T=n(76),j=n(1457),I=n(693),B=n(17),x=n(128),A=n(23),L=n(366),D=n(90),R=n(118),F=n(80),W=n(1633),U=n(19),V=n(41),N=n(465),_=n(12),H=n(281),z=n(10),q=n(349),G=n(210),Q=n(83),K=n(265),Z=n(391),X=n(775),Y=n(1),J=n(1456),$=n(416),ee=n(116),te=n(769),ne=n(170);function re(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function ie(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}class ae extends m.a{constructor(){super(...arguments),this.storeTypes={shareButtonPopupStore:d.a},this.handleOpenQuickFind=()=>{I.b({environment:this.environment,analyticsFrom:"public-page-topbar"})},this.handleShareClick=()=>{o.Oc(this.environment),S.e(this.environment)},this.handleTopbarClick=()=>{w.e(this.environment)},this.navigateToFirstSpace=()=>{const{currentUserRootStore:e,currentUserSettingsStore:t}=B.a.state;e&&t&&x.n({environment:this.environment,userRootStore:e,userSettingsStore:t})},this.handleMoveToClick=e=>{L.d({blocks:[this.props.store],analyticsFrom:"quick_add",onAccept:this.handleMoveToAccept,isAddTo:!0})},this.handleMoveToAccept=e=>{const{currentSpaceStore:t}=B.a.state;t&&this.props.saveParent&&F.C({currentUserId:this.environment.currentUser.id,spaceId:t.id,value:e}),o.lc(this.environment)},this.handleCancelQuickAdd=e=>{const t=B.a.state.currentBlockStore,n=q.a.state.lastPageId;t&&n&&(V.h({environment:this.environment,store:l.a.createChildStore(t,{table:z.a,id:n}),showMoveTo:!1,saveParent:!1}),_.d(this.environment,e=>{N.b({environment:this.environment,blocks:[t],transaction:e})}))}}renderComponent(){const{store:e}=this.props,{WindowSizeStore:t,device:n}=this.environment,r=Object(M.g)(this.environment,this.props.store);return i.a.createElement(b.a,{capture:!0,render:a=>i.a.createElement("div",Object.assign({},a,{style:this.getWrapStyle()}),r?this.renderPublicPageTopbar():this.renderNormalTopbar(),e.canEdit()&&n.isPhone&&i.a.createElement(E.a,{store:this.props.store,isMobile:!0,key:this.props.store.id}),this.props.isOffline&&i.a.createElement(H.b,{type:H.a.White,isMobile:!0},i.a.createElement("div",{style:{display:"flex",alignItems:"center",width:"100%",paddingLeft:t.getSafePaddingLeftCSS(10),paddingRight:t.getSafePaddingRightCSS(14)}},s.a.mobileOffline({width:26,marginRight:12}),i.a.createElement("div",null,i.a.createElement(Y.a,{defaultMessage:"You're offline",id:"topbarMobile.offline.message"})))),i.a.createElement(u.a,{banners:this.props.banners,isMobile:!0}))})}renderPublicPageTopbar(){const{store:e}=this.props;return i.a.createElement("div",{onClick:this.handleTopbarClick,style:this.getStyle(),className:C.tb},this.environment.currentUser.isLoggedIn()&&i.a.createElement(r.Fragment,null,i.a.createElement(P.a,{style:{display:"flex",alignItems:"center",height:"100%",paddingLeft:14,paddingRight:14,fontWeight:A.a.fontWeight.medium,color:this.theme.regularTextColor},mobileFeedback:!0,onClick:this.navigateToFirstSpace},i.a.createElement(Y.a,{defaultMessage:"Back",id:"topbarMobile.backButton.label"})),i.a.createElement("div",{style:{height:18,width:1,flexShrink:0,marginRight:6,background:this.theme.darkDividerColor}})),i.a.createElement(h.a,{store:this.props.store,style:this.getBreadcrumbsStyle(),maxAncestorCount:1,showCurrentPageControls:!1,ancestorMaxWidth:100,currentPageMaxWidth:220,isMobile:!0}),i.a.createElement("div",{style:{flexGrow:1,flexShrink:1}}),i.a.createElement(T.a,{onClick:this.handleOpenQuickFind},s.a.searchThick({width:20,height:20})),i.a.createElement(j.a,{store:e,buttonPopupStore:O.a}))}renderNormalTopbar(){const{store:e,pageVisitStore:t,presenceStore:n}=this.props,{isTablet:r}=this.environment.device,a=this.props.isInvalidPage;return i.a.createElement("div",{onClick:this.handleTopbarClick,style:this.getStyle(),className:C.tb},this.renderHamburgerButton(),r&&i.a.createElement(J.a,null),!a&&this.renderBreadcrumbs(),e.canEdit()&&r&&i.a.createElement(E.a,{store:e,isMobile:!1,key:e.id}),i.a.createElement(f.a,null),e.isRestricted()&&i.a.createElement(te.a,{style:{marginRight:8},onClick:()=>{this.stores.shareButtonPopupStore.setState({open:!0})}}),r&&e.canEdit()&&t&&n&&i.a.createElement(X.a,{rootStore:e,pageVisitStore:t,presenceStore:n}),this.props.shouldShowMoveTo?this.renderCancelQuickAdd():this.renderRightButtons())}renderHamburgerButton(){const e=k.a.getUnreadMentionsCountForOtherSpaces();return i.a.createElement(P.a,{mobileFeedback:!0,style:{position:"relative",display:"flex",alignItems:"center",justifyContent:"center",flexShrink:0,height:"100%",width:36,marginLeft:4},onClick:()=>{Object(Z.a)(this.environment)?v.g({environment:this.environment,isExpanded:!K.a.get()}):v.d(),o.Ic(this.environment)}},s.a.hamburgerMenu({width:18,height:18}),i.a.createElement(y.a,{color:y.a.Color.Red,count:e,style:{position:"absolute",top:9,right:1}}))}renderBreadcrumbs(){const{isTablet:e}=this.environment.device;return this.props.shouldShowMoveTo?this.renderMoveTo():i.a.createElement(h.a,{store:this.props.store,style:this.getBreadcrumbsStyle(),maxAncestorCount:e?2:1,showCurrentPageControls:!1,ancestorMaxWidth:e?160:100,currentPageMaxWidth:e?240:220,isMobile:!0})}renderMoveTo(){var e=this;const{store:t}=this.props,n=t.getParentStore(),{currentSpaceStore:r}=B.a.state,a=n instanceof c.a&&r&&n.id===r.id;if(n){if(a)return i.a.createElement(P.a,{mobileFeedback:!0,style:ae.moveToButtonStyle,onClick:this.handleMoveToClick},i.a.createElement(Y.a,{defaultMessage:"<mediumcolor>Add to</mediumcolor>{userAvatar}<mediumweight>Private pages</mediumweight>",id:"topbarMobile.addToPrivateSectionButton.label",values:{mediumcolor:function(){for(var t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];return i.a.createElement("span",{style:{color:e.theme.mediumTextColor,marginRight:8}},n)},mediumweight:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return i.a.createElement("span",{style:{fontWeight:A.a.fontWeight.medium,marginLeft:4}},t)},userAvatar:i.a.createElement(G.a,{size:22,avatarShouldShowShadow:!0,userValue:Object(Q.g)(this.environment)})}}),this.renderChevron());{const e=t instanceof c.a?Object(ee.getSpaceIcon)(this.environment,t):t.getIcon();return i.a.createElement(P.a,{mobileFeedback:!0,style:ae.moveToButtonStyle,onClick:this.handleMoveToClick},i.a.createElement("span",{style:{color:this.theme.mediumTextColor}},i.a.createElement(Y.a,{defaultMessage:"Add to",id:"topbarMobile.addToPageOrWorkspaceSectionButton.label",description:"Displayed to the user in front of a page or space, like 'Add to Page', where 'Page' is an existing page."})," "),i.a.createElement(D.a,{disabled:!0,icon:e,isEmptyPage:n.table===z.a&&n.isEmptyPage(),title:n instanceof c.a?Object(ee.getSpaceName)(this.environment,n):void 0,size:24,style:{marginLeft:8,marginRight:4}}),i.a.createElement(R.a,{style:{fontWeight:A.a.fontWeight.semibold},store:n}),this.renderChevron())}}}renderChevron(){return s.a.chevronDown({marginLeft:4,width:10,fill:this.theme.lightTextColor})}renderRightButtons(){const{device:e}=this.environment;if(!this.props.isInvalidPage)return e.isReactNative?i.a.createElement(r.Fragment,null,this.renderShare(),this.renderShowMore()):i.a.createElement(r.Fragment,null,this.renderShowMore(),this.renderShare(),this.renderUpdatesButton())}renderCancelQuickAdd(){return i.a.createElement(P.a,{mobileFeedback:!0,style:{display:"flex",alignItems:"center",height:"100%",paddingLeft:16,paddingRight:16,fontWeight:A.a.fontWeight.medium,color:U.f.blue},onClick:this.handleCancelQuickAdd},i.a.createElement(Y.a,{defaultMessage:"Cancel",id:"topbarMobile.cancelQuickAddButton.label"}))}renderShowMore(){return i.a.createElement(g.a,{store:this.props.store,collectionViewStore:this.props.collectionViewStore,buttonPopupStore:O.a})}renderShare(){const{device:e}=this.environment;return i.a.createElement(p.a,{popupType:e.isMobile?p.a.PopupType.SlideUp:p.a.PopupType.Popup,style:{width:460},buttonPopupStore:this.stores.shareButtonPopupStore,onClick:this.handleShareClick,renderOrigin:t=>i.a.createElement(P.a,Object.assign({mobileFeedback:!0,style:ae.actionButtonStyle},t),e.isAndroid?s.a.androidShare({width:16,height:16}):s.a.iOSShare({width:26})),render:()=>i.a.createElement(ne.b,{buttonPopupStore:this.stores.shareButtonPopupStore,store:this.props.store,onClose:()=>{this.stores.shareButtonPopupStore.setState(function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?re(Object(n),!0).forEach((function(t){ie(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):re(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}({},this.stores.shareButtonPopupStore.state,{open:!1}))}})})}renderUpdatesButton(){return i.a.createElement(W.a,{format:W.a.Format.TopbarMobile})}getWrapStyle(){return{width:"100%",maxWidth:"100vw",zIndex:a.p}}getStyle(){const{WindowSizeStore:e}=this.environment;return{display:"flex",justifyContent:"space-between",alignItems:"center",width:"100%",maxWidth:"100vw",height:$.b,marginTop:e.state.paddingTopCSS,paddingLeft:e.getSafePaddingLeftCSS(0),paddingRight:this.props.shouldShowMoveTo?e.getSafePaddingRightCSS(0):e.getSafePaddingRightCSS(7),boxShadow:"0 1px 0 ".concat(this.theme.darkDividerColor),background:this.theme.contentBackground,transition:"box-shadow 300ms",WebkitUserSelect:"none",cursor:"pointer"}}getBreadcrumbsStyle(){const{isTablet:e}=this.environment.device;return{flexGrow:0,marginLeft:2,overflow:"auto",WebkitOverflowScrolling:"touch",marginRight:e?16:8,height:"100%"}}}ae.actionButtonStyle={display:"flex",alignItems:"center",height:"100%",paddingLeft:6,paddingRight:6},ae.moveToButtonStyle={display:"flex",alignItems:"center",paddingLeft:8,paddingRight:12,fontSize:A.a.fontSize.UIRegular.mobile,lineHeight:A.a.lineHeight.UIRegular.mobile,whiteSpace:"nowrap",minWidth:0},t.default=ae},1093:function(e,t,n){"use strict";n.r(t);n(15),n(11);var r=n(0),i=n.n(r),a=n(153),o=n(200),s=n(3),l=n(8),c=n(25),d=n(48),h=n(408),p=n(331),m=n(415),u=n(1);function g(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function b(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?g(Object(n),!0).forEach((function(t){f(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):g(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function f(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}class y extends s.a{constructor(){super(...arguments),this.storeTypes={store:o.a},this.handleFocused=()=>{c.e(this.environment),d.f(this.environment),this.stores.store.setState(b({},this.stores.store.state,{focus:!0}))},this.handleBlurred=()=>{this.stores.store.setState(b({},this.stores.store.state,{focus:!1}))},this.handleSearchQueryChange=e=>{this.props.onChange({searchQuery:e.target.value})}}renderComponent(){const{searchQuery:e,intl:t}=this.props,{focus:n}=this.stores.store.state;return i.a.createElement(h.a,{capture:n},i.a.createElement(p.a,{capture:!0,render:r=>i.a.createElement("div",Object.assign({},r),i.a.createElement(a.b,{style:this.getStyle(),format:a.a.Transparent,value:e,placeholder:t.formatMessage({defaultMessage:"Type to search…",id:"database.mobileSearch.placeholder"}),onChange:this.handleSearchQueryChange,autoComplete:"on",autoCorrect:"on",onFocus:this.handleFocused,onBlur:this.handleBlurred,showClearButton:!0,left:l.a.searchThick(this.getSearchIconStyle())}),i.a.createElement(m.a,{show:n}))}))}getStyle(){return{boxShadow:this.theme.inputBoxShadow,background:this.theme.inputBackground,flexGrow:0,flexShrink:0,height:32,paddingLeft:8,paddingRight:12,borderRadius:3,fontSize:14,marginBottom:4}}getSearchIconStyle(){return{width:14,height:14,marginRight:6,flexGrow:0,flexShrink:0,fill:this.theme.mediumIconColor}}}t.default=Object(u.g)(y)},1102:function(e,t,n){"use strict";n.r(t);n(15),n(11);var r=n(0),i=n.n(r),a=n(3),o=n(7),s=n(8),l=n(514),c=n(27),d=n(588),h=n(222),p=n(756),m=n(67),u=n(72),g=n(16);class b extends g.a{getInitialState(){return{open:!1,focused:!1}}}var f=b,y=n(59),S=n(112),v=n(90),w=n(134),E=n(1145),O=n(40),k=n(118),P=n(17),C=n(23),M=n(1),T=n(276);function j(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function I(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?j(Object(n),!0).forEach((function(t){B(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):j(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function B(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}class x extends a.a{constructor(){super(...arguments),this.handleClick=()=>{const{onNavigate:e,store:t}=this.props;e&&e(t)}}renderComponent(){const{store:e,collectionViewStore:t}=this.props,n=Object(m.a)({store:e,fullyQualified:!1,collectionViewId:t.id}),r=t.getValue();if(r)return i.a.createElement(S.a,{href:n,style:{width:"100%"},onClick:this.handleClick},i.a.createElement(E.a,{icon:this.renderIcon(),style:this.getSidebarItemStyle(),isMobile:this.props.isMobile},i.a.createElement(T.a,{collectionViewName:r.name,collectionViewType:r.type})))}renderIcon(){return i.a.createElement("div",{style:I({},this.getInitialIconStyle())},"•")}getInitialIconStyle(){return{fontSize:12,fontWeight:500,color:this.theme.mediumTextColor}}getSidebarItemStyle(){const{device:e}=this.environment;return I({},this.isCurrentPage()&&I({background:this.theme.buttonHoveredBackground,color:this.theme.regularTextColor,fontWeight:C.a.fontWeight.semibold},e.isMobile&&{boxShadow:"\n\t\t\t\t\t\t0 1px 0 ".concat(this.theme.buttonHoveredBackground,"\n\t\t\t\t\t")}),{},this.props.style)}isCurrentPage(){const{store:e,collectionViewStore:t}=this.props,{currentBlockStore:n,currentCollectionViewStore:r}=P.a.state;return n&&e.id===n.id&&r&&r.id===t.id}}var A=Object(M.g)(x),L=n(43);class D extends a.a{constructor(){super(...arguments),this.renderCollectionView=e=>{const{store:t}=this.props;return i.a.createElement(A,{key:e.id,store:t,collectionViewStore:e,style:this.props.itemStyle,isMobile:this.props.isMobile,onNavigate:this.props.onNavigate})},this.handleContextMenu=e=>{e.preventDefault(),Object(L.d)({event:e,context:L.a.EditorContextMenu,callback:()=>{}})}}renderComponent(){const{store:e}=this.props,t=e.getCollectionViewStores();return i.a.createElement("div",{onContextMenu:this.handleContextMenu},t.map(this.renderCollectionView))}}var R=D,F=n(28),W=n(12),U=n(14),V=n(102),N=n(25),_=n(84),H=n(175),z=n(830),q=n(34),G=n(433),Q=n(195),K=n(63),Z=n(148),X=n(41),Y=n(223),J=n(349),$=n(66);function ee(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function te(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?ee(Object(n),!0).forEach((function(t){ne(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):ee(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function ne(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}class re extends y.a{constructor(){super(...arguments),this.showAsLoadingSpinner=!1,this.registries=[G.a],this.storeTypes={outlinerItemStore:f},this.toggleOpen=e=>{this.stores.outlinerItemStore.setState(te({},this.stores.outlinerItemStore.state,{open:e})),this.shouldPersistToggleState()&&K.a.set({userId:this.environment.currentUser.id,key:this.getLocalStoreKey(),value:e})},this.isCurrentPage=this.createComputedStore(()=>{const{store:e}=this.props,{currentBlockStore:t}=P.a.state;return t&&e.id===t.id}),this.handleLinkClick=()=>{const{store:e}=this.props;U.F(this.environment,{type:this.props.isTopLevelItem?"top_level":"nested"}),this.props.onNavigate&&this.props.onNavigate(e)},this.handleMouseMove=e=>{Q.a.state.isDragging||this.stores.outlinerItemStore.setState(te({},this.stores.outlinerItemStore.state,{focused:!0}))},this.handleMouseLeave=e=>{this.stores.outlinerItemStore.setState(te({},this.stores.outlinerItemStore.state,{focused:!1}))},this.handleDrop=async e=>{const{droppedDirection:t,droppedStores:n,duplicate:r}=e,{store:i,type:a,isTopLevelItem:o,parentStore:s}=this.props;await p.b({type:a,droppedStores:n,droppedDirection:t})&&s&&W.d(this.environment,e=>{p.e({environment:this.environment,type:a,targetParentStore:s,targetStore:i,isTopLevelItem:o,droppedDirection:t,droppedStores:n,duplicate:r,transaction:e})})},this.handleShowMenuButtonClick=e=>{const{store:t}=this.props;N.k({environment:this.environment,store:t}),h.c({environment:this.environment,stores:[this.props.store],left:e.clientX,top:e.clientY,showInput:!1,actions:H.l,analyticsFrom:"sidebar_more_menu"})},this.handleToggleClick=()=>{const{outlinerItemStore:e}=this.stores,t=!e.state.open;U.dd(this.environment,{type:this.props.isTopLevelItem?"top_level":"nested",is_toggled:t}),this.toggleOpen(t)},this.handleInsertBefore=e=>{const{store:t,type:n}=this.props;return p.f({environment:this.environment,store:t,insertStores:e.insertStores,parentStore:e.parentStore,before:!0,transaction:e.transaction,type:n})},this.handleInsertAfter=e=>{const{store:t,type:n}=this.props;return p.f({environment:this.environment,store:t,insertStores:e.insertStores,parentStore:e.parentStore,before:!1,transaction:e.transaction,type:n})},this.handleRemove=e=>{const{store:t}=this.props,n=t.recordStoreParent();n&&$.e({remove:t,parent:n,transaction:e.transaction})},this.handleRecordIconChange=e=>{const{store:t}=this.props,n=t.getIconStore();n&&W.d(this.environment,t=>{F.c({store:n,value:e,transaction:t})})},this.handleAddPageButtonClick=e=>{const{device:t}=this.environment;if(Object(_.j)(this.environment)){this.props.onCreatePage&&this.props.onCreatePage();const e=W.d(this.environment,e=>p.a({environment:this.environment,store:this.props.store,transaction:e}));J.a.setState(te({},J.a.state,{lastPageId:P.a.state.currentBlockStore?P.a.state.currentBlockStore.id:void 0})),t.isMobile?X.h({environment:this.environment,store:e,showMoveTo:!1,saveParent:!1,visitType:Y.c.Link}):X.m({environment:this.environment,store:e,showMoveTo:!0,saveParent:!1}),this.props.store.isCollectionView()||this.toggleOpen(!0)}}}toggleStore(){return this.stores.outlinerItemStore}didMount(){if(super.didMount(),this.shouldPersistToggleState()){const e=K.a.get({userId:this.environment.currentUser.id,key:this.getLocalStoreKey()});this.stores.outlinerItemStore.setState(te({},this.stores.outlinerItemStore.state,{open:e}))}const{store:e}=this.props;this.showAsLoadingSpinner="copy_indicator"===e.getType()&&Z.a.isPendingTransactionForRecord(e.pointer)}renderPersisted(){const{store:e,isFirstItem:t,type:n,parentStore:r}=this.props,a=e.canRead()&&"copy_indicator"!==e.getType()&&"offline"!==n,o=this.canEdit(),s=a&&r?{onInsertAfter:e=>this.handleInsertAfter(te({},e,{parentStore:r})),onInsertBefore:e=>this.handleInsertBefore(te({},e,{parentStore:r}))}:{};return i.a.createElement(w.a,Object.assign({analyticsName:"outliner_item",blockMenuActions:H.l,canDrag:a,canDropAbove:t,canDropBelow:a,canDropOnto:o,canInsertAfter:a,canInsertBefore:a,canSelect:a,canTriggerContextMenu:!0,onRemove:this.handleRemove,onSelectableDrop:this.handleDrop,shouldShowDropZone:!0,showBlockMenuInput:!1,store:e},s),this.renderItem(),this.shouldShowChildren()&&this.renderOutliner())}renderOutliner(){const{store:e,disabled:t}=this.props;return e.isCollectionView()?i.a.createElement(R,{store:e,itemStyle:this.getSubOutlinerStyle(),isMobile:this.props.isMobile,onNavigate:this.props.onNavigate}):i.a.createElement(pe,{isMobile:this.props.isMobile,type:this.props.type,isTopLevel:!1,spaceStore:this.props.spaceStore,spaceViewStore:this.props.spaceViewStore,parentStore:e.getContentStore(),itemStyle:this.getSubOutlinerStyle(),itemToggleStyle:this.props.toggleStyle,onCreatePage:this.props.onCreatePage,onNavigate:this.props.onNavigate,disabled:t})}renderItem(){const{store:e}=this.props;if("copy_indicator"===e.getType())return this.showAsLoadingSpinner?i.a.createElement(E.a,{style:this.getSidebarItemStyle(),childrenStyle:re.sidebarChildrenStyle,onMouseMove:this.handleMouseMove,onMouseLeave:this.handleMouseLeave,isMobile:this.props.isMobile},i.a.createElement(V.a,null)):void 0;{let e=i.a.createElement(E.a,{style:this.getSidebarItemStyle(),childrenStyle:re.sidebarChildrenStyle,left:this.renderLeftToggleButton(),icon:this.renderIcon(),right:this.renderRightIcons(),onMouseMove:this.handleMouseMove,onMouseLeave:this.handleMouseLeave,isMobile:this.props.isMobile},this.isAlias()&&this.renderAliasIcon(),this.renderTitle());const t=this.getURL();return t&&(e=i.a.createElement(S.a,{style:{width:"100%"},href:t,onClick:this.handleLinkClick},e)),e}}renderRightIcons(){const{isMobile:e,store:t}=this.props;if(e||this.stores.outlinerItemStore.state.focused){const e=t.getType()&&this.canEdit();return i.a.createElement("div",{style:{display:"flex",paddingLeft:3}},this.renderMenuButton(),e&&this.renderAddPageButton())}}renderAliasIcon(){const{store:e}=this.props;return i.a.createElement(O.a,{renderTooltip:()=>e.isCollectionView()?"This is a linked database":"This is a link to the original page",render:e=>i.a.createElement("div",Object.assign({style:{marginRight:"0.125em"}},e),re.aliasIcon)})}renderLeftToggleButton(){return i.a.createElement(z.a,{isSidebar:!0,fill:!0,open:Boolean(this.stores.outlinerItemStore.state.open),color:this.theme.mediumIconColor,onClick:this.handleToggleClick})}renderAddPageButton(){const{isMobile:e}=this.props;return i.a.createElement(O.a,{renderTooltip:()=>i.a.createElement(M.a,{defaultMessage:"Quickly add a page inside",id:"sidebarItem.addAPageInside.tooltip"}),placement:O.a.Placement.Bottom,render:t=>i.a.createElement(q.a,Object.assign({mobileFeedback:e,style:te({},this.getButtonStyle(),{marginLeft:e?0:4},!e&&{border:"1px solid ".concat(this.theme.outlineButtonBorder)}),onClick:this.handleAddPageButtonClick},t),s.a.plus(this.getButtonIconStyle()))})}renderMenuButton(){const{isMobile:e}=this.props;return i.a.createElement(O.a,{renderTooltip:()=>"bookmarks"===this.props.type?i.a.createElement(M.a,{defaultMessage:"Remove, rename, and more…",id:"sidebarItem.favoritedPageMenuButton.tooltip"}):i.a.createElement(M.a,{defaultMessage:"Delete, duplicate, and more…",id:"sidebarItem.pageMenuButton.tooltip"}),placement:O.a.Placement.Bottom,render:t=>i.a.createElement(q.a,Object.assign({mobileFeedback:e,style:this.getButtonStyle(),onClick:this.handleShowMenuButtonClick},t),s.a.dots(te({},this.getButtonIconStyle(),{width:e?18:14})))})}renderIcon(){const{store:e}=this.props,t=e.getIcon(),n=!this.props.isMobile&&this.canEdit()&&!e.isLocked();return i.a.createElement(O.a,{renderTooltip:()=>i.a.createElement(M.a,{defaultMessage:"Change icon",id:"sidebarItem.changeIconButton.tooltip"}),placement:O.a.Placement.Bottom,render:r=>n?i.a.createElement(v.a,Object.assign({bucket:"secure",disabled:!1,icon:t,store:e,title:void 0,isEmptyPage:e.isEmptyPage(),size:this.props.isMobile?24:20,onChange:this.handleRecordIconChange,pageIconStyle:{fill:this.theme.mediumIconColor}},r)):i.a.createElement(v.a,{disabled:!0,icon:t,title:void 0,isEmptyPage:e.isEmptyPage(),size:this.props.isMobile?24:20,pageIconStyle:{fill:this.theme.mediumIconColor}})})}renderTitle(){const{store:e}=this.props;return i.a.createElement(k.a,{store:e})}shouldPersistToggleState(){return this.props.isTopLevelItem}shouldShowChildren(){return this.stores.outlinerItemStore.state.open}getURL(){const{store:e}=this.props;if(e.isNavigableBlock())return Object(m.a)({store:e,fullyQualified:!1});{const t=u.c(e);if(t)return Object(m.a)({store:t,scrollToBlockId:e.id,fullyQualified:!1})}}getLocalStoreKey(){const{store:e}=this.props;return"Outliner-".concat(e.id)}isAlias(){const{store:e,parentStore:t,isTopLevelItem:n}=this.props;if(e.isCollectionView()){const t=e.getCollectionViewCollectionStore();if(t){const n=t.getValue();if(n&&n.parent_id!==e.id)return!0}}if(n)return!1;if(!t)return!1;const r=e.getValue();return!!r&&r.parent_id!==t.id}getPaddingLeftUnit(){return this.props.isMobile?22:14}getSidebarItemStyle(){const{device:e}=this.environment;return te({},this.isCurrentPage.state&&te({background:this.theme.buttonHoveredBackground,color:this.theme.regularTextColor,fontWeight:C.a.fontWeight.semibold},e.isMobile&&{boxShadow:"\n\t\t\t\t\t\t0 1px 0 ".concat(this.theme.buttonHoveredBackground,"\n\t\t\t\t\t")}),{},this.props.style)}getSubOutlinerStyle(){const e=te({},this.props.style),t=this.getSidebarItemStyle(),n="number"==typeof t.paddingLeft?t.paddingLeft:this.getInitialPaddingLeft();return e.paddingLeft=n+this.getPaddingLeftUnit(),e}getInitialPaddingLeft(){return this.props.isMobile?6:14}getButtonStyle(){const{isMobile:e}=this.props;return{display:"flex",alignItems:"center",justifyContent:"center",width:e?32:20,height:e?32:20,borderRadius:3}}getButtonIconStyle(){const{isMobile:e}=this.props;return{fill:e?this.theme.lightIconColor:this.theme.sidebarTextColor,width:e?18:12}}}re.aliasIcon=s.a.alias({width:"1em",height:"1em",marginRight:2}),re.sidebarChildrenStyle={display:"flex",alignItems:"center"};var ie=re,ae=n(68),oe=n(4),se=n(10);function le(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function ce(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?le(Object(n),!0).forEach((function(t){de(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):le(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function de(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}class he extends a.a{constructor(){super(...arguments),this.outlinerItemTree=this.createComputedStore(()=>{const{parentStore:e}=this.props,t=[];if(e){const n=c.a.createChildStore(e,{table:se.a,id:e.id});this.getOutlinerItemsInSubtree(n,n,t,new Set)}return t}),this.handleCreatePageClick=async()=>{const{spaceStore:e,spaceViewStore:t,type:n,onCreatePage:r}=this.props;await p.c({environment:this.environment,spaceStore:e,spaceViewStore:t,type:n,prepend:!1})&&r&&r()},this.handleEmptyDrop=async e=>{const{droppedDirection:t,droppedStores:n,duplicate:r}=e,{type:i,isTopLevel:a,parentStore:o}=this.props;if(o){await p.b({type:i,droppedStores:n,droppedDirection:t})&&W.d(this.environment,e=>{p.e({environment:this.environment,type:i,targetParentStore:o,isTopLevelItem:a,droppedDirection:t,droppedStores:n,duplicate:r,transaction:e})})}}}renderComponent(){const{device:e}=this.environment,{parentStore:t,isTopLevel:n,childStores:r,disabled:a}=this.props;let o=[],s=!1;if(r)o=r.map((e,n)=>this.renderPageItem(e,!0,n,t)),s=!0;else if(t){const e=c.a.createChildStore(t,{table:se.a,id:t.id});o=this.outlinerItemTree.state,s=l.b(e)}const h=0===o.length,p=(h||this.props.isHeaderless||e.isMobile)&&this.props.showAddPageButton&&!a,m=h&&!p&&!n,u={offline:ae.I,bookmarks:ae.G,workspace:ae.O,shared:ae.M,private:ae.K}[this.props.type];return i.a.createElement(d.a,{style:this.props.style,className:u,loaded:s,showSpinnerTimeout:3e3,spinnerSize:"1em"},o,h&&n&&this.renderEmptyDroppable(),p&&this.renderAddPageButton(),m&&this.renderEmptyChildrenPlaceholder())}renderEmptyChildrenPlaceholder(){const{device:e}=this.environment;return i.a.createElement(E.a,{style:this.props.itemStyle,isMobile:this.props.isMobile},i.a.createElement("div",{style:ce({color:this.theme.lightTextColor,paddingLeft:12},e.isMobile&&{display:"flex",alignItems:"center",height:32})},i.a.createElement(M.a,{defaultMessage:"No pages inside",id:"outliner.NoPagesInside.placeholder"})))}renderAddPageButton(){return i.a.createElement(q.a,{mobileFeedback:this.props.isMobile,onClick:this.handleCreatePageClick},i.a.createElement(E.a,{style:{color:this.theme.mediumTextColor},left:this.getPlusIcon(),isMobile:this.props.isMobile,disableMobileBorder:!0},this.props.addPageTitle))}renderPageItem(e,t,n,r){return i.a.createElement(ie,{isMobile:this.props.isMobile,type:this.props.type,spaceStore:this.props.spaceStore,spaceViewStore:this.props.spaceViewStore,key:e.id,store:e,style:this.props.itemStyle,toggleStyle:this.props.itemToggleStyle,isFirstItem:0===n,isTopLevelItem:t,parentStore:r,onNavigate:this.props.onNavigate,onCreatePage:this.props.onCreatePage,disabled:this.props.disabled})}renderEmptyDroppable(){const{currentBlockStore:e}=P.a.state;if(e){const t=c.a.createChildStore(this.props.spaceStore,e.pointer);return i.a.createElement(w.a,{store:t,canDropBelow:!0,onSelectableDrop:this.handleEmptyDrop,analyticsName:"outliner_item",shouldShowDropZone:!0})}}getPlusIcon(){return i.a.createElement("div",{style:{display:"flex",alignItems:"center",justifyContent:"center"}},s.a.plus({fill:this.theme.mediumIconColor,width:16,height:16}))}getOutlinerItemsInSubtree(e,t,n,r){let i=!0;const a=e.getType();if(!r.has(e.id)&&(r.add(e.id),a&&he.shouldSkipItemTypes[a]?i=!1:a&&e!==t&&he.shouldShowItemTypes[a]&&(i=!1,n.push(this.renderPageItem(e,!1,n.length,e.recordStoreParent()))),i)){const i=e.getContentStores();for(const e of i){const i=e.getValue();if(i&&i.properties){const t=i.properties.title,r=oe.W(t);if(r)for(const a of r){const t=c.a.createChildStore(e,{table:se.a,id:a});t.getParentId()===i.id&&n.push(this.renderPageItem(t,!1,n.length,t.recordStoreParent()))}}this.getOutlinerItemsInSubtree(e,t,n,r)}}}}he.shouldShowItemTypes={[o.a.page]:!0,[o.a.collectionView]:!0,[o.a.collectionViewPage]:!0},he.shouldSkipItemTypes={[o.a.factory]:!0};var pe=he,me=n(693),ue=n(173),ge=n(2),be=n.n(ge),fe=n(746),ye=n(32),Se=n(47),ve=n(1241),we=n(174),Ee=n(95),Oe=n(55),ke=n(24),Pe=n(53),Ce=n(22),Me=n(120),Te=n(79),je=n(83),Ie=n(845),Be=n(296);class xe extends g.a{getInitialState(){return{showUpdateInfo:!1}}}var Ae=xe,Le=n(623),De=n(216),Re=n(154),Fe=n(69);class We extends a.a{constructor(){super(...arguments),this.storeTypes={store:Ae},this.renderUpdateInfo=()=>{const{AppUpdateStore:e}=this.environment,t=e.state.appUpdate?this.renderUpdateState("App.js - ",e.state.appUpdate):i.a.createElement(M.a,{defaultMessage:"App.js - Waiting…",id:"appVersionMenuItem.waitingForAppJsUpdate.message"}),n=e.state.electronUpdate&&this.renderUpdateState("Electron - ",e.state.electronUpdate);return i.a.createElement("div",null,t,n)},this.handleResetCache=()=>{const{AppUpdateStore:e,reactNative:t}=this.environment;e.setState({appUpdate:void 0,electronUpdate:e.state.electronUpdate}),t&&t.resetAssetCache()},this.handleShowUpdateInfo=()=>{this.stores.store.setState({showUpdateInfo:!0})}}renderComponent(){const{device:e}=this.environment,t="Notion 2.10.".concat(ye.a.version),n=i.a.createElement(M.a,{id:"appVersionMenuItem.lastUpdatedTime.menuItem",defaultMessage:"Updated {lastUpdatedTime}",description:"Message to tell the user when their current version of the Notion app was last updated.",values:{lastUpdatedTime:Object(Fe.a)(ye.a.lastUpdatedTime).fromNow()}});let r=i.a.createElement(i.a.Fragment,null,t,i.a.createElement("br",null),n);if(e.isReactNative){const e=Le.a(),a=i.a.createElement(M.a,{defaultMessage:"Mobile {reactNativeVersionFormatted}",values:{reactNativeVersionFormatted:Object(De.g)(e)},id:"appVersionMenuItem.lastUpdatedReactNativeVersion.menuItem"});r=i.a.createElement(i.a.Fragment,null,t,i.a.createElement("br",null),a,i.a.createElement("br",null),n)}if(e.isElectron){const e=Me.h(),a=i.a.createElement(M.a,{defaultMessage:"Desktop {desktopVersionFormatted}",values:{desktopVersionFormatted:Object(De.g)(e)},id:"appVersionMenuItem.desktopVersion.menuItem"});r=i.a.createElement(i.a.Fragment,null,t,i.a.createElement("br",null),a,i.a.createElement("br",null),n)}const a=ye.a.isLocalhost||"local"===ye.a.env||"development"===ye.a.env;if(e.isMobile){const e=a&&this.stores.store.state.showUpdateInfo&&i.a.createElement("div",null,this.renderUpdateInfo(),i.a.createElement(q.a,{style:{paddingTop:4},onClick:this.handleResetCache},i.a.createElement(M.a,{defaultMessage:"Clear cache",id:"appVersionMenuItem.mobile.clearCache.message"})));return i.a.createElement(Re.a,{caption:i.a.createElement("div",{style:{color:this.theme.lightTextColor}},i.a.createElement("div",{style:{userSelect:"none",WebkitUserSelect:"none"}},r),e),onClick:a?this.handleShowUpdateInfo:void 0})}return a?i.a.createElement(O.a,{renderTooltip:this.renderUpdateInfo,placement:O.a.Placement.Left,render:e=>i.a.createElement(Re.a,Object.assign({caption:i.a.createElement("div",{style:{color:this.theme.lightTextColor}},r)},e))}):i.a.createElement(Re.a,{caption:i.a.createElement("div",{style:{color:this.theme.lightTextColor}},r)})}renderUpdateState(e,t){return"checking"===t.state?i.a.createElement("div",null,e," ",i.a.createElement(M.a,{defaultMessage:"Checking for updates…",id:"appVersionMenuItem.updateStateForApp.checking.message"})):"no-update"===t.state?i.a.createElement("div",null,e," ",i.a.createElement(M.a,{defaultMessage:"No update {timeFromNow}",id:"appVersionMenuItem.noUpdatesForApp.message",description:"timeFromNow is a translated message like '2 hours ago' that refers to the time of the last update.",values:{timeFromNow:Object(Fe.a)(t.timestamp).fromNow()}})):"downloading"===t.state?i.a.createElement("div",null,e," ",i.a.createElement(M.a,{defaultMessage:"Downloading {version} {percentComplete}",id:"appVersionMenuItem.downloadingUpdate.message",values:{percentComplete:this.props.intl.formatNumber(t.progress,{style:"percent",maximumFractionDigits:0}),version:Object(De.g)(t.version)}})):"ready"===t.state?i.a.createElement("div",null,e," ",i.a.createElement(M.a,{defaultMessage:"Update ready {version}",id:"appVersionMenuItem.updateReady.message",values:{version:Object(De.g)(t.version)}})):"error"===t.state?i.a.createElement("div",null,e," ",i.a.createElement(M.a,{defaultMessage:"Update error {errorMessage}",id:"appVersionMenuitem.updateError.message",values:{errorMessage:t.error&&t.error.message}})):void 0}}var Ue=Object(M.g)(We),Ve=n(100),Ne=n(89),_e=n(133),He=n(172);var ze=function(e){const{locale:t,children:n}=e;return t===He.a?i.a.createElement(i.a.Fragment,null,n):null},qe=n(1462),Ge=n(762),Qe=n(1245),Ke=n(96);function Ze(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function Xe(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}class Ye extends a.a{constructor(){super(...arguments),this.renderOrigin=e=>this.props.isMobile?i.a.createElement(q.a,Object.assign({hovered:Ie.a.state.open,mobileFeedback:this.props.isMobile},e),i.a.createElement(E.a,{isMobile:this.props.isMobile,left:s.a.help({fill:this.theme.mediumIconColor,width:16,height:16}),disableMobileBorder:!0},i.a.createElement(M.a,{defaultMessage:"Help & feedback",id:"helpButton.mobileHelpFeedbackButton.label"}))):i.a.createElement(i.a.Fragment,null,i.a.createElement(O.a,{renderTooltip:()=>i.a.createElement("span",null,i.a.createElement(M.a,{defaultMessage:"Help, feedback, and {br}keyboard shortcuts",id:"helpButton.desktopHelpButton.tooltip",values:{br:i.a.createElement("br",null)}})),render:t=>i.a.createElement(q.a,Object.assign({className:"notion-help-button",style:this.getRoundButtonStyle(),hoveredStyle:{background:this.theme.whiteButtonHoveredBackground},pressedStyle:{background:this.theme.whiteButtonPressedBackground}},Object(Ee.a)(e,t)),"?")})),this.renderMessageItem=e=>{const{device:t}=this.environment;return t.isElectron?this.renderMessageButton(e):i.a.createElement(O.a,{key:e.key,renderTooltip:()=>this.renderIntercomTooltip(),delayThreshold:0,placement:O.a.Placement.Right,render:t=>this.renderMessageButton(Object(Ee.a)(e,t))})},this.renderSalesItem=e=>{const{device:t}=this.environment;return t.isElectron?this.renderSalesButton(e):i.a.createElement(O.a,{key:e.key,renderTooltip:()=>this.renderIntercomTooltip(),delayThreshold:0,placement:O.a.Placement.Right,render:t=>this.renderSalesButton(Object(Ee.a)(e,t))})},this.renderGuideItem=e=>i.a.createElement(Pe.a,Object.assign({},e,{isTokenTitle:!0,icon:s.a.helpButtonGuide(this.getIconStyle()),title:i.a.createElement(M.a,{defaultMessage:"Help & support guide",id:"helpButton.helpSupportGuide.menuItem"})})),this.renderMessageButton=e=>i.a.createElement(Pe.a,Object.assign({},e,{isTokenTitle:!0,icon:s.a.helpButtonMessage(this.getIconStyle()),title:i.a.createElement(M.a,{defaultMessage:"Send us a message",id:"helpButton.sendMessage.menuItem"})})),this.renderCsatButton=e=>i.a.createElement(Pe.a,Object.assign({},e,{isTokenTitle:!0,icon:s.a.feedback(this.getIconStyle()),title:i.a.createElement(M.a,{defaultMessage:"Give feedback",id:"helpButton.giveFeedback.menuItem"})})),this.renderSalesButton=e=>i.a.createElement(Pe.a,Object.assign({},e,{isTokenTitle:!0,icon:s.a.helpButtonSales(this.getIconStyle()),title:i.a.createElement(M.a,{defaultMessage:"Chat with sales",id:"helpButton.salesChat.menuItem"})})),this.renderJoinUsItem=e=>i.a.createElement(ze,{locale:"en-US"},i.a.createElement(Pe.a,Object.assign({},e,{title:i.a.createElement(M.a,{defaultMessage:"Join us",id:"helpButton.joinUs.menuItem"})}))),this.renderKeyboardShortcutsItem=e=>i.a.createElement(Pe.a,Object.assign({},e,{title:i.a.createElement(M.a,{defaultMessage:"Keyboard shortcuts",id:"helpButton.keyboardShortcuts.menuItem"})})),this.renderNewsItem=e=>i.a.createElement(Pe.a,Object.assign({},e,{title:"What's new?"})),this.renderTermsItem=e=>{const{device:t}=this.environment;return t.isMobile?i.a.createElement(Pe.a,Object.assign({},e,{title:"Terms & privacy"})):i.a.createElement(Pe.a,Object.assign({},e,{caption:"Terms & privacy"}))},this.renderTwitterItem=e=>{const{device:t}=this.environment;return t.isMobile?i.a.createElement(Pe.a,Object.assign({},e,{title:i.a.createElement(M.a,{defaultMessage:"Twitter – @{notionHandle}",id:"helpButton.mobileTwitter.menuItem",values:{notionHandle:"NotionHQ"}})})):i.a.createElement(Pe.a,Object.assign({},e,{caption:i.a.createElement(M.a,{defaultMessage:"Twitter – @{notionHandle}",id:"helpButton.twitter.menuItem",values:{notionHandle:"NotionHQ"}})}))},this.renderStatusItem=e=>{const{device:t}=this.environment;return t.isMobile?i.a.createElement(Pe.a,Object.assign({},e,{title:"Status"})):i.a.createElement(Pe.a,Object.assign({},e,{caption:"Status"}))},this.acceptMessageItem=()=>{this.analyticsTrackClickItem("help_feedback"),fe.a({environment:this.environment,from:"help_button"}),this.closePopup()},this.acceptSalesItem=()=>{this.analyticsTrackClickItem("sales_chat");const{currentUserStore:e}=P.a.state,t=e&&e.getValue();Qe.a.setState({open:!0,email:t&&t.email,name:t&&Object(Ke.d)(this.props.intl,t)}),this.closePopup()},this.acceptCsatItem=()=>{this.analyticsTrackClickItem("csat"),qe.a.setState({open:!0,type:Ge.f}),this.closePopup()},this.acceptGuideItem=()=>{this.analyticsTrackClickItem("guides"),X.i({environment:this.environment,url:Object(_e.a)("guides.guides")}),this.closePopup()},this.acceptKeyboardShortcutsItem=()=>{this.analyticsTrackClickItem("keyboard_shortcuts"),X.i({environment:this.environment,url:Object(_e.a)("guides.keyboardShortcuts")}),this.closePopup()},this.acceptTwitterItem=()=>{this.analyticsTrackClickItem("twitter"),X.i({environment:this.environment,url:Te.d.notionTwitter}),this.closePopup()},this.acceptStatusItem=()=>{this.analyticsTrackClickItem("status"),X.i({environment:this.environment,url:Te.d.statusPage}),this.closePopup()},this.acceptJoinUsItem=()=>{this.analyticsTrackClickItem("join_us"),X.i({environment:this.environment,url:Te.c.careers}),this.closePopup()},this.acceptNewsItem=()=>{X.i({environment:this.environment,url:Te.d.whatsNew}),this.analyticsTrackClickItem("whats_new"),this.closePopup()},this.acceptTermsItem=()=>{X.i({environment:this.environment,url:Te.d.termsAndPrivacy}),this.analyticsTrackClickItem("terms"),this.closePopup()},this.trackClickHelp=()=>{U.A(this.environment)}}renderComponent(){const{device:e}=this.environment,t=this.props.isMobile;return i.a.createElement(Se.a,{popupType:e.isMobile?Se.a.PopupType.SlideUp:Se.a.PopupType.Popup,renderOrigin:this.renderOrigin,originGap:t?0:12,placementToOrigin:t?Se.a.Placement.Right:Se.a.Placement.Top,alignmentToOrigin:t?Se.a.Alignment.Center:Se.a.Alignment.End,buttonPopupStore:Ie.a,onClick:this.trackClickHelp,render:()=>{const t=this.getSections();let n;return n=e.isMobile?{menuType:Ce.b.MenuType.ActionSheet}:{menuType:Ce.b.MenuType.Popup,minWidth:208},i.a.createElement(Ce.b,Object.assign({},n),i.a.createElement(Oe.a,{type:Oe.a.Type.Vertical,initialFocus:void 0,sections:t}))}})}getSections(){const{device:e}=this.environment,t=Ne.i(this.environment),n="team"===t||"enterprise"===t,r=!Be.a.state.isIntercomEnabled||Object(Ne.N)(this.environment)&&"on"===Ve.a.getGroup(this.environment,"hazelnut"),a="on"===Ve.a.getGroup(this.environment,"csat")&&!this.environment.device.isMobile;return be.a.compact([{key:"guide",render:e=>i.a.createElement(ke.a,Object.assign({},e)),items:be.a.compact([{key:"guide",action:this.acceptGuideItem,render:this.renderGuideItem},r?void 0:{key:"message",action:this.acceptMessageItem,render:this.renderMessageItem},n?{key:"sales",action:this.acceptSalesItem,render:this.renderSalesItem}:void 0,a?{key:"csat",action:this.acceptCsatItem,render:this.renderCsatButton}:void 0])},{key:"middle section",render:e=>i.a.createElement(ke.a,Object.assign({},e,{topBorder:!0})),items:be.a.compact([{key:"keyboardshortcut",action:this.acceptKeyboardShortcutsItem,render:this.renderKeyboardShortcutsItem},{key:"news",action:this.acceptNewsItem,render:this.renderNewsItem},{key:"join-us",action:this.acceptJoinUsItem,render:this.renderJoinUsItem}])},{key:"botttom section",render:e=>i.a.createElement(ke.a,Object.assign({},e,{topBorder:!0})),items:be.a.compact([{key:"twitter",action:this.acceptTwitterItem,render:this.renderTwitterItem},{key:"terms",action:this.acceptTermsItem,render:this.renderTermsItem},{key:"status",action:this.acceptStatusItem,render:this.renderStatusItem},e.isElectron&&"production"!==ye.a.env?{key:"devtools",action:Me.k,render:e=>i.a.createElement(Pe.a,Object.assign({},e,{caption:"Open Dev Tools"}))}:void 0])},{key:"version",render:e=>i.a.createElement(ke.a,Object.assign({},e,{topBorder:!0})),items:be.a.compact([{key:"version",action:()=>{},render:e=>i.a.createElement(Ue,Object.assign({},e))}])}])}renderIntercomTooltip(){return i.a.createElement("span",null,i.a.createElement(M.a,{defaultMessage:"We use Intercom for messaging.{br}Make sure it's not blocked by your browser.",values:{br:i.a.createElement("br",null)},id:"helpButton.sendUsAMessage.tooltip"}))}analyticsTrackClickItem(e){U.C(this.environment,{item:e})}closePopup(){Ie.a.setState(function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Ze(Object(n),!0).forEach((function(t){Xe(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Ze(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}({},Ie.a.state,{open:!1}))}getRoundButtonStyle(){const{device:e}=this.environment;return{position:"absolute",display:"flex",alignItems:"center",justifyContent:"center",background:this.theme.buttonBackground,bottom:16+e.scrollbarWidth,right:16+e.scrollbarWidth,width:36,height:36,borderRadius:"100%",fontSize:20,boxShadow:this.theme.lightBoxShadow,zIndex:we.e,opacity:je.p.state?0:1,transition:"\n\t\t\t\topacity ".concat(ve.a.transitionDuration,"ms,\n\t\t\t\tcolor ").concat(ve.a.transitionDuration,"ms\n\t\t\t")}}getIconStyle(){return{width:16,height:16,color:this.theme.regularTextColor,fill:this.theme.regularTextColor}}}var Je=Object(M.g)(Ye),$e=n(110),et=n(846),tt=n(29);function nt(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function rt(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?nt(Object(n),!0).forEach((function(t){it(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):nt(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function it(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}class at extends a.a{constructor(){super(...arguments),this.storeTypes={mouseStore:$e.a,labelMouseStore:$e.a,outlinerToggleButtonStore:et.a},this.headerRef=i.a.createRef(),this.handleHideClick=()=>{const{isHidden:e}=this.stores.outlinerToggleButtonStore.state,t=!e;p.g({spaceViewStore:this.props.spaceViewStore,type:this.props.type,outlinerToggleButtonStore:this.stores.outlinerToggleButtonStore,newValue:t})},this.handleCreatePageClick=()=>{const{type:e,spaceStore:t,spaceViewStore:n}=this.props,{outlinerToggleButtonStore:r}=this.stores;p.c({environment:this.environment,spaceStore:t,spaceViewStore:n,type:e,outlinerToggleButtonStore:r,prepend:!0})}}willMount(e){super.willMount(e);const t=K.a.get({userId:this.environment.currentUser.id,key:p.d(e.spaceViewStore,e.type)});t&&this.stores.outlinerToggleButtonStore.setState(rt({},this.stores.outlinerToggleButtonStore.state,{isHidden:t}))}renderComponent(){const{renderSidebar:e}=this.props,{isHidden:t}=this.stores.outlinerToggleButtonStore.state;return i.a.createElement("div",{ref:this.headerRef,onMouseMove:()=>this.stores.mouseStore.setState(rt({},this.stores.mouseStore.state,{mouseEntered:!0})),onMouseLeave:()=>this.stores.mouseStore.setState(rt({},this.stores.mouseStore.state,{mouseEntered:!1})),style:{marginBottom:t?0:at.marginBottom}},this.renderLabel(),!t&&e(this.headerRef))}renderLabel(){const{showAddPageButton:e}=this.props,{isHidden:t}=this.stores.outlinerToggleButtonStore.state,{labelMouseStore:n}=this.stores,{mouseEntered:r}=n.state,a={bookmarks:ae.H,workspace:ae.P,shared:ae.N,private:ae.L,offline:ae.J}[this.props.type],o=t?i.a.createElement(M.a,{defaultMessage:"Click to show section",id:"sidebar.sectionHeaderShow.tooltip"}):i.a.createElement(M.a,{defaultMessage:"Click to hide section",id:"sidebar.sectionHeaderHide.tooltip"});return i.a.createElement(E.a,{className:a,isMobile:this.props.isMobile,disableMobileBorder:t,shouldShowMobileMarginBotton:t,style:this.getSectionSidebarItemStyle(),childrenStyle:{overflow:"visible"},right:e&&this.renderAddPageButton()},i.a.createElement("div",{style:{display:"flex",alignItems:"center"}},i.a.createElement(O.a,{style:at.tooltipStyle,textWrap:!0,renderTooltip:()=>i.a.createElement("div",null,i.a.createElement("div",null,o),i.a.createElement("span",{style:{color:this.theme.mediumInvertedTextColor,whiteSpace:"nowrap"}},this.props.labelTooltip)),placement:O.a.Placement.Top,render:e=>{const t=rt({},this.props.isMobile?this.getMobileSectionLabelStyle():this.getSectionLabelStyle(),{transition:"color 100ms ease-out"});return r&&Object.assign(t,this.getSectionLabelHoverStyles()),i.a.createElement(q.a,Object.assign({mobileFeedback:this.props.isMobile,style:this.getLabelButtonStyle(),onClick:this.handleHideClick},Object(Ee.a)(e,{onMouseMove:()=>n.setState(rt({},n.state,{mouseEntered:!0})),onMouseLeave:()=>n.setState(rt({},n.state,{mouseEntered:!1}))})),i.a.createElement("span",{style:t},this.renderLabelContent()))}})))}renderAddPageButton(){return i.a.createElement(O.a,{style:at.tooltipStyle,textWrap:!0,renderTooltip:()=>i.a.createElement(r.Fragment,null,i.a.createElement(M.a,{defaultMessage:"Add a page",id:"sidebar.addAPageButton.tooltip"}),i.a.createElement("br",null),i.a.createElement("span",{style:{color:this.theme.mediumInvertedTextColor}},this.props.labelTooltip)),placement:O.a.Placement.Right,render:e=>i.a.createElement(q.a,Object.assign({style:this.getPlusButtonStyle(),mobileFeedback:this.props.isMobile,onClick:this.handleCreatePageClick,className:ae.t},e),s.a.plus({fill:this.theme.mediumIconColor,width:12,height:12}))})}renderLabelContent(){const{type:e}=this.props;switch(e){case"bookmarks":return i.a.createElement(M.a,{defaultMessage:"Favorites",id:"sidebar.favoritesSection.header"});case"workspace":return i.a.createElement(M.a,{defaultMessage:"Workspace",id:"sidebar.workspaceSection.header"});case"private":return i.a.createElement(M.a,{defaultMessage:"Private",id:"sidebar.privateSection.header"});case"shared":return i.a.createElement(M.a,{defaultMessage:"Shared",id:"sidebar.sharedSection.header"});case"offline":return i.a.createElement(M.a,{defaultMessage:"Offline",id:"sidebar.offlineSection.header"});default:Object(tt.e)(e)}}getSectionSidebarItemStyle(){return{paddingTop:0,paddingBottom:0,paddingRight:14,paddingLeft:15,minHeight:24}}getSectionLabelStyle(){return{letterSpacing:"0.03em",textTransform:"uppercase",fontSize:11.5,lineHeight:1,marginBottom:1,color:this.theme.lightTextColor,fontWeight:C.a.fontWeight.semibold}}getMobileSectionLabelStyle(){return{textTransform:"uppercase",fontSize:13,lineHeight:1,color:this.theme.lightTextColor,fontWeight:C.a.fontWeight.semibold}}getSectionLabelHoverStyles(){return{color:this.theme.mediumTextColor}}getLabelButtonStyle(){return rt({display:"flex",alignItems:"center",borderRadius:3,padding:"2px 4px",marginLeft:-4},this.props.isMobile&&{marginBottom:8})}getPlusButtonStyle(){return{display:"flex",alignItems:"center",justifyContent:"center",borderRadius:3,height:20,width:20,border:"1px solid ".concat(this.theme.outlineButtonBorder)}}}at.tooltipStyle={minWidth:200},at.marginBottom=20;var ot=at,st=n(432),lt=n(255),ct=n(183),dt=n(199),ht=n(301),pt=n(221),mt=n(169),ut=n(1244),gt=n(1363),bt=n(155),ft=n(287),yt=n(465),St=n(264),vt=n(171),wt=n(81),Et=n(508),Ot=n(76),kt=n(359),Pt=n(587),Ct=n(6),Mt=n(94);function Tt(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function jt(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Tt(Object(n),!0).forEach((function(t){It(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Tt(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function It(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}const Bt=Object(M.f)({filterByPlaceholder:{id:"sidebarTrash.filterBy.placeholder",defaultMessage:"Filter by page title…"}});class xt extends a.a{constructor(){super(...arguments),this.storeTypes={requestStore:lt.a},this.renderTrashPages=(e,t)=>{const{device:n}=this.environment,a=t?t.results:[],{currentBlockStore:o}=P.a.state;if(!o)return;const l=a.map(e=>c.a.createChildStore(o,{table:se.a,id:e})).filter(e=>e.getValue()&&!st.a.state.excludePages.has(e.id)).map(e=>({key:e.id,action:t=>{let{event:r}=t;if(r.metaKey){const t=Object(St.a)({baseUrl:ye.a.baseURL,pageId:e.id});X.i({environment:this.environment,url:t})}else X.h({environment:this.environment,store:e}),Et.a.setState(jt({},Et.a.state,{open:!1}));n.isMobile&&pt.b()},render:t=>i.a.createElement(ft.a,Object.assign({},t,{dontShrinkRight:!0,store:e,right:i.a.createElement("div",{style:{display:"flex"}},i.a.createElement(O.a,{placement:O.a.Placement.Bottom,renderTooltip:()=>i.a.createElement(M.a,{defaultMessage:"Restore",id:"sidebarTrash.restorePageButton.tooltip"}),render:t=>i.a.createElement(Ot.a,Object.assign({isGray:!0,onClick:()=>this.handleRestoreClick(e)},t),s.a.undo({width:18,height:18}))}),i.a.createElement(O.a,{placement:O.a.Placement.Bottom,renderTooltip:()=>i.a.createElement(M.a,{defaultMessage:"Delete permanently",id:"sidebarTrash.deletePagePermanentlyButton.tooltip"}),render:t=>i.a.createElement(Ot.a,Object.assign({isGray:!0,onClick:()=>this.handleDeleteClick(e)},t),s.a.trash({width:18,height:18}))}))}))}));return 0===l.length?i.a.createElement(ke.a,null,n.isMobile?i.a.createElement(bt.a,{title:i.a.createElement(M.a,{defaultMessage:"No matches found.",id:"sidebarTrash.mobileFilterBy.noMatchesPrompt"})}):i.a.createElement("div",{style:{fontSize:14,color:this.theme.mediumTextColor,textAlign:"center"}},i.a.createElement(M.a,{defaultMessage:"No matches found.",id:"sidebarTrash.filterBy.noMatchesPrompt"}))):i.a.createElement(r.Fragment,null,i.a.createElement(Oe.a,{type:Oe.a.Type.Vertical,initialFocus:void 0,sections:[{key:0,items:l,render:e=>i.a.createElement(ke.a,Object.assign({},e))}]}),i.a.createElement(ht.a,{show:this.stores.requestStore.state.loading,showDelay:500,showHold:200,render:e=>{if(e)return i.a.createElement("div",{style:{height:44,display:"flex",flex:1,alignItems:"center",justifyContent:"center"}},i.a.createElement(V.a,null))}}),i.a.createElement(dt.a,{onChange:this.handleScrollOffsetChange}))},this.handleSwipeLeft=()=>{const e=xt.tabs.indexOf(st.a.state.currentTab)+1,t=xt.tabs[e];void 0!==t&&this.changeTab(t)},this.handleSwipeRight=()=>{const e=xt.tabs.indexOf(st.a.state.currentTab)-1,t=xt.tabs[e];void 0!==t&&this.changeTab(t)},this.handleTabChange=e=>{const t=xt.tabs[e];this.changeTab(t)},this.handleRestoreClick=e=>{const{currentSpaceStore:t}=P.a.state;t&&yt.d({environment:this.environment,block:e,spaceId:t.id})},this.handleDeleteClick=e=>{yt.a({environment:this.environment,blocks:[e]})},this.handleSearchInputChange=e=>{st.a.setState(jt({},st.a.state,{filter:e.target.value,limit:st.a.startLimit}))},this.handleClose=()=>{Et.a.setState(jt({},Et.a.state,{open:!1}))},this.handleScrollOffsetChange=e=>{const{requestStore:t}=this.stores,{ready:n,loading:r,result:i}=t.state,a=i;e<=st.a.loadMoreOffset&&a&&n&&!r&&!a.endOfResultsReached&&st.a.setState(jt({},st.a.state,{limit:st.a.state.limit+st.a.limitIncrement}))},this.performSearchRequest=async e=>{const{currentSpaceStore:t,currentBlockStore:n}=P.a.state;if(!t||!n)return;const{limit:r,filter:i,currentTab:a}=st.a.state;let o;if("in_current_page"===a)if(n.isCollectionView()){const e=n.getValue();if(!e||!e.collection_id)return;o=e.collection_id}else o=n.id;return await vt.m({environment:this.environment,query:i,limit:r,ancestorId:o,spaceId:t.id})}}willMount(e){super.willMount(e),st.a.setState(jt({},st.a.state,{filter:"",limit:st.a.startLimit,excludePages:new Set}))}renderComponent(){const{device:e}=this.environment;let t;return t=e.isMobile?{menuType:Ce.b.MenuType.Modal,title:i.a.createElement(M.a,{defaultMessage:"Trash",id:"sidebarTrash.menu.header"}),left:this.renderMobileHelpButton(),right:i.a.createElement(Mt.DoneMenuText,null),onClickRight:this.handleClose,header:this.renderHeader()}:{menuType:Ce.b.MenuType.Popup,height:"50vh",width:414,header:this.renderHeader(),footer:this.renderFooter()},i.a.createElement(gt.a,{onSwipeLeft:this.handleSwipeLeft,onSwipeRight:this.handleSwipeRight,render:e=>i.a.createElement(Ce.b,Object.assign({},t,e,{className:ae.hb}),this.renderPages())})}renderHeader(){const{device:e}=this.environment,t=st.a.state.currentTab,n=xt.tabs.indexOf(t);return i.a.createElement(r.Fragment,null,i.a.createElement(ut.a,{tabs:[i.a.createElement(M.a,{defaultMessage:"All pages",id:"sidebarTrash.allPages.tabHeader"}),i.a.createElement(M.a,{defaultMessage:"In current page",id:"sidebarTrash.inCurrentPage.tabHeader"})],selectedIndex:n,onChange:this.handleTabChange}),i.a.createElement("div",{style:{margin:e.isMobile?0:"10px 0"}},i.a.createElement(mt.a,{left:i.a.createElement(ht.a,{show:this.stores.requestStore.state.loading,showDelay:500,showHold:200,render:e=>e?i.a.createElement(V.a,{style:this.getSearchIconStyle()}):s.a.searchThick(this.getSearchIconStyle())}),style:jt({},e.isAndroid&&{borderBottom:"none"}),showClearButton:!0,placeholder:Ct.a.formatMessage(Bt.filterByPlaceholder),focus:!e.isMobile||void 0,value:st.a.state.filter,onChange:this.handleSearchInputChange})))}renderFooter(){return i.a.createElement(ke.a,{topBorder:!0,disableDesktopPadding:!0},i.a.createElement(kt.a,{title:i.a.createElement(M.a,{defaultMessage:"Learn about deleting and restoring pages",id:"sidebarTrash.learnMore.prompt"}),href:Object(_e.a)("guides.trash"),analyticsFrom:"trash"}))}renderMobileHelpButton(){return i.a.createElement(Pt.a,{href:Object(_e.a)("guides.trash"),analyticsFrom:"trash"})}renderPages(){if(!wt.a.state.online)return i.a.createElement(ke.a,null,i.a.createElement(bt.a,{title:i.a.createElement(M.a,{defaultMessage:"Please go online to view the Trash.",id:"sidebarTrash.goOnline.prompt"})}));{const{filter:e,limit:t,currentTab:n}=st.a.state,r="".concat(e,":").concat(t).concat(n);return i.a.createElement(ct.a,{requestStore:this.stores.requestStore,request:r,performRequest:this.performSearchRequest,render:this.renderTrashPages,debounce:vt.b})}}changeTab(e){st.a.setState(jt({},st.a.state,{currentTab:e,limit:st.a.startLimit})),this.stores.requestStore.setState(jt({},this.stores.requestStore.state,{result:null})),U.xe(this.environment,{tab:e})}getSearchIconStyle(){return{width:14,height:14,marginRight:6,flexGrow:0,flexShrink:0,color:this.theme.regularIconColor}}}xt.tabs=["all_pages","in_current_page"];var At=xt,Lt=n(99);function Dt(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function Rt(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Dt(Object(n),!0).forEach((function(t){Ft(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Dt(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function Ft(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function Wt(e,t){if(null==e)return{};var n,r,i=function(e,t){if(null==e)return{};var n,r,i={},a=Object.keys(e);for(r=0;r<a.length;r++)n=a[r],t.indexOf(n)>=0||(i[n]=e[n]);return i}(e,t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);for(r=0;r<a.length;r++)n=a[r],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(i[n]=e[n])}return i}class Ut extends a.a{constructor(){super(...arguments),this.renderOrigin=e=>{const t=Object(Ee.a)(e,{onClick:this.props.onClick}),{onClick:n}=t,r=Wt(t,["onClick"]);return i.a.createElement(w.a,{store:this.clonedStore,canDropOnto:!0,onSelectableDrop:this.handleDrop,analyticsName:"sibebar_trash",shouldShowDropZone:!0},i.a.createElement(q.a,Object.assign({},r,{onClick:n||this.handleClick,mobileFeedback:this.props.isMobile}),i.a.createElement(E.a,{left:this.renderIcon(),style:Rt({},Et.a.state.open&&{background:this.theme.buttonHoveredBackground}),isMobile:this.props.isMobile,disableMobileBorder:!0},i.a.createElement(M.a,{defaultMessage:"Trash",id:"sidebarTrashButton.text"}))))},this.renderSidebarTrash=()=>{const{currentSpaceStore:e}=P.a.state;if(e)return i.a.createElement(At,{spaceStore:e})},this.handleClick=e=>{st.a.setState(Rt({},st.a.state,{currentTab:"all_pages"})),U.ad(this.environment)},this.handleDrop=e=>{const{droppedStores:t,duplicate:n}=e;n||W.d(this.environment,e=>{Lt.o({environment:this.environment,blocks:t,transaction:e})})}}willMount(e){super.willMount(e),this.clonedStore=e.store.clone()}renderComponent(){const{device:e}=this.environment;return i.a.createElement(Se.a,{popupType:e.isMobile?Se.a.PopupType.SlideUp:Se.a.PopupType.Popup,buttonPopupStore:Et.a,alignmentToOrigin:Se.a.Alignment.Start,placementToOrigin:Se.a.Placement.Right,originGap:0,onClick:this.handleClick,isFullWidthOnMobile:!0,render:this.renderSidebarTrash,preventScaleTransition:!0,renderOrigin:this.renderOrigin})}renderIcon(){const{device:e}=this.environment,t=this.theme.mediumIconColor;return e.isMobile?s.a.sidebarTrash({fill:t,height:16}):s.a.sidebarTrash({fill:t,width:14})}}var Vt=Ut,Nt=n(491),_t=n(147),Ht=n(1446),zt=n(763),qt=n(1450),Gt=n(1353),Qt=n(1140),Kt=n(586),Zt=n(86),Xt=n(1634),Yt=n(489),Jt=n(119),$t=n(1444),en=n(744),tn=n(1451);class nn extends a.a{constructor(){super(...arguments),this.storeTypes={passwordRequestStore:lt.a},this.handleClose=()=>{zt.a.setState({open:!1})},this.handleStartOfWeekToggle=()=>{1===this.getStartDayOfWeek()?Object(Yt.d)(this.environment):Object(Yt.c)(this.environment)}}renderComponent(){const{device:e}=this.environment,{data:t}=Jt.a.state,n=zt.a.state.open,r="on"===Ve.a.getGroup(this.environment,"user-data-consent"),a=e.isIOS&&Ne.y(t);return i.a.createElement(Se.a,{popupType:e.isMobile?Se.a.PopupType.SlideUp:Se.a.PopupType.Popup,buttonPopupStore:zt.a,renderOrigin:e=>i.a.createElement(q.a,Object.assign({mobileFeedback:this.props.isMobile},e),i.a.createElement(E.a,{left:this.renderIcon(),style:{background:n?this.theme.buttonHoveredBackground:"none"},isMobile:this.props.isMobile,disableMobileBorder:!0},i.a.createElement(M.a,{defaultMessage:"Notifications & settings",id:"notificationSettingsButton.mobileSidebar.label"}))),render:()=>{let n;if(n=e.isMobile?{menuType:Ce.b.MenuType.Modal,title:i.a.createElement(M.a,{defaultMessage:"Notifications & settings",id:"notificationSettingsButton.mobileSidebar.title"}),right:i.a.createElement(M.a,{defaultMessage:"Done",id:"notificationSettingsButton.rightActionButton.done"}),onClickRight:this.handleClose,whiteBackground:!0}:{menuType:Ce.b.MenuType.Popup},wt.a.state.online){const{passwordRequestStore:e}=this.stores;return i.a.createElement(Ce.b,Object.assign({},n),e.state.loading?i.a.createElement(V.a,{style:{margin:"50% auto"}}):i.a.createElement(Qt.a,null,i.a.createElement(Ht.a,null),i.a.createElement(Kt.a,{size:48,isHidden:!0}),i.a.createElement(en.a,{divider:"full"},i.a.createElement(M.a,{id:"notificationSettingsButton.generalSection.title",defaultMessage:"General"})),i.a.createElement(Xt.a,{requestStore:e,isEducationPlan:Ne.x(t)}),this.renderAppearanceSettings(),a&&this.renderSubscriptionSettings(),r&&this.renderUserDataConsentSettings(),i.a.createElement(Kt.a,{size:32}),i.a.createElement(Gt.a,{onClick:this.handleStartOfWeekToggle,startDayOfWeek:this.getStartDayOfWeek()||0})))}return i.a.createElement(Qt.a,null,i.a.createElement(Zt.a,{isSmall:!0,style:{textAlign:"center"}},i.a.createElement(M.a,{defaultMessage:"Please go online to manage settings.",id:"notificationSettingsButton.goOnline.prompt"})))}})}renderUserDataConsentSettings(){return i.a.createElement(i.a.Fragment,null,i.a.createElement(Kt.a,{size:32}),i.a.createElement($t.a,null))}renderAppearanceSettings(){return i.a.createElement(i.a.Fragment,null,i.a.createElement(Kt.a,{size:32}),i.a.createElement(qt.a,null))}renderSubscriptionSettings(){return i.a.createElement(i.a.Fragment,null,i.a.createElement(Kt.a,{size:32}),i.a.createElement(tn.a,null))}renderIcon(){return s.a.sidebarSettings({fill:this.theme.mediumIconColor,width:16})}getStartDayOfWeek(){const{currentUserSettingsStore:e}=P.a.state;if(e){const t=e.getSettings();if(t)return t.start_day_of_week}}}var rn=nn,an=n(417);class on extends a.a{renderComponent(){const e=i.a.createElement(M.a,{defaultMessage:"Upgrade to Pro",id:"upgradeMobileButton.upgradeButton.label"});return i.a.createElement(q.a,{mobileFeedback:!0,onClick:this.showUpgradeModal(this.environment)},i.a.createElement(E.a,{left:this.renderIcon(),isMobile:!0,disableMobileBorder:!0},e))}renderIcon(){return s.a.settingsUpgradeFilled({fill:this.theme.mediumIconColor,width:16})}showUpgradeModal(e){return()=>{Object(U.I)(e,{from:"mobile_sidebar",for_subscription_tier:"personal"});const{reactNative:t}=e;t&&t.openUpgradeModal(Object(an.a)())}}}var sn=on,ln=n(82),cn=n(1631);class dn extends a.a{constructor(){super(...arguments),this.storeTypes={buttonPopupStore:ln.a},this.handleClose=()=>{this.stores.buttonPopupStore.setState({open:!1})}}renderComponent(){if(!Ne.O(this.environment))return;const{store:e}=this.props,{buttonPopupStore:t}=this.stores;return i.a.createElement(Se.a,{buttonPopupStore:t,popupType:Se.a.PopupType.SlideUp,renderOrigin:e=>i.a.createElement(q.a,Object.assign({mobileFeedback:!0},e),i.a.createElement(E.a,{left:this.renderIcon(),isMobile:!0,disableMobileBorder:!0},i.a.createElement(M.a,{defaultMessage:"Members",id:"memberSettingsButton.mobileSidebar.label"}))),render:()=>{if(wt.a.state.online){const t={menuType:Ce.b.MenuType.Modal,title:i.a.createElement(M.a,{defaultMessage:"Members",id:"memberSettingsButton.mobileMemberSettings.title"}),right:i.a.createElement(M.a,{defaultMessage:"Done",id:"memberSettingsButton.rightActionButton.done"}),onClickRight:this.handleClose};return i.a.createElement(Ce.b,Object.assign({},t),i.a.createElement(cn.a,{store:e,isMobile:!0}))}this.renderOffline()}})}renderIcon(){return s.a.teamSize({fill:this.theme.mediumIconColor,width:16})}renderOffline(){return i.a.createElement(Qt.a,null,i.a.createElement(Zt.a,{isSmall:!0,style:{textAlign:"center"}},i.a.createElement(M.a,{defaultMessage:"Please go online to manage members.",id:"memberSettingsButton.goOnline.prompt"})))}}var hn=dn,pn=n(103),mn=(n(168),n(75)),un=n(265),gn=n(624),bn=n(391);class fn extends a.a{constructor(){super(...arguments),this.handleTouchStart=e=>{const t={x:e.touches[0].clientX,y:e.touches[0].clientY};un.b.state?t.x>Object(bn.c)(this.environment)?gn.a.setState({touching:!0,swiping:!1,start:t}):this.handleReset():Object(bn.g)(this.environment)&&t.x<100?gn.a.setState({touching:!0,swiping:!1,start:t}):this.handleReset()},this.handleTouchMove=e=>{if(Q.a.state.isDragging)return void this.handleReset();const t=gn.a.state;if(!t.touching)return;const n={x:e.touches[0].clientX,y:e.touches[0].clientY};if(t.swiping)gn.a.setState({touching:!0,swiping:!0,start:t.start,speed:un.b.state?t.end.x-n.x:n.x-t.end.x,end:n});else{if(Math.abs(n.y-t.start.y)>=25)return void this.handleReset();(!un.b.state&&n.x-t.start.x>25||un.b.state&&t.start.x-n.x>25)&&gn.a.setState({touching:!0,swiping:!0,start:t.start,speed:0,end:n})}this.updateTransform()},this.handleTouchEnd=async()=>{const{ThemeStore:e}=this.environment,t=gn.a.state;if(!t.swiping)return;const n=Object(bn.c)(this.environment),r=document.querySelector(Object(bn.g)(this.environment)?".".concat(ae.fb):".".concat(ae.w)),i=document.querySelector(".".concat(ae.w)),a=Math.abs(t.speed)>=8,o=a?"ease-out":"ease-in-out",s="dark"===e.state.mode?", 1px 0 0 ".concat(this.theme.shadowColor.alpha(2*this.theme.shadowOpacity).css()):"",l="\n\t\t\t".concat(this.theme.mediumBoxShadow,"\n\t\t\t").concat(s,"\n\t\t");if(un.b.state){const e=t.start.x-t.end.x;if(e+25*t.speed>n/2){let t=a?(n-e)/n*200:200;t=Math.max(t,1),r.style.transition="transform ".concat(t,"ms ").concat(o),r.style.transform="translateZ(0)translateX(0px)",Object(bn.g)(this.environment)&&(r.style.boxShadow=l,i.style.transition="filter ".concat(t,"ms ").concat(o),i.style.filter="brightness(1)"),await Sn(r),pt.b(),this.handleReset()}else r.style.transition="transform ".concat(200,"ms ").concat(o),r.style.transform="translateZ(0)translateX(".concat(n,"px)"),Object(bn.g)(this.environment)&&(r.style.boxShadow=l,i.style.transition="filter ".concat(200,"ms ").concat(o),i.style.filter="brightness(0.7)"),await Sn(r),this.handleReset()}else{const e=t.end.x-t.start.x;if(e+25*t.speed>n/2){let t=a?(n-e)/n*200:200;t=Math.max(t,1),r.style.transition="transform ".concat(t,"ms ").concat(o),r.style.transform="translateZ(0)translateX(".concat(n,"px)"),Object(bn.g)(this.environment)&&(r.style.boxShadow=l,i.style.transition="filter ".concat(t,"ms ").concat(o),i.style.filter="brightness(0.7)"),await Sn(r),pt.d(),this.handleReset()}else r.style.transition="transform ".concat(200,"ms ").concat(o),r.style.transform="translateZ(0)translateX(0px)",Object(bn.g)(this.environment)&&(r.style.boxShadow=l,i.style.transition="filter ".concat(200,"ms ").concat(o),i.style.filter="brightness(1)"),await Sn(r),this.handleReset()}},this.handleSidebarToggle=()=>{this.updateTransform()},this.updateTransform=()=>{const e=document.querySelector(Object(bn.g)(this.environment)?".".concat(ae.fb):".".concat(ae.w)),t=document.querySelector(".".concat(ae.w)),n=Object(bn.c)(this.environment),r=gn.a.state;if(r.swiping)if(un.b.state){const i=n-(r.start.x-r.end.x)+25,a=Math.min(Math.max(0,i),n);if(e.style.transition="none",e.style.transform="translateZ(0)translateX(".concat(a,"px)"),Object(bn.g)(this.environment)){e.style.boxShadow=this.theme.mediumBoxShadow,t.style.transition="none";const r=(1-.3*a/n).toString();t.style.filter="brightness(".concat(r,")")}}else{const i=r.end.x-r.start.x-25,a=Math.min(Math.max(0,i),n);if(e.style.transition="none",e.style.transform="translateZ(0)translateX(".concat(a,"px)"),Object(bn.g)(this.environment)){e.style.boxShadow=this.theme.mediumBoxShadow,t.style.transition="none";const r=(1-.3*a/n).toString();t.style.filter="brightness(".concat(r,")")}}else un.b.state?(e.style.transition="transform 200ms",e.style.transform="translateZ(0)translateX(".concat(n,"px)"),Object(bn.g)(this.environment)&&(e.style.transform="translateZ(0)translateX(calc(".concat(n,"px - 1px))"),e.style.boxShadow=this.theme.mediumBoxShadow,t.style.transition="filter 200ms",t.style.filter="brightness(0.7)"),N.e(this.environment)):(e.style.transition="transform 200ms",e.style.transform="translateZ(0)translateX(0)",Object(bn.g)(this.environment)&&(e.style.boxShadow="none",t.style.transition="filter 200ms",t.style.filter="brightness(1)"))}}didMount(){const{device:e}=this.environment;e.isMobile&&(window.addEventListener("touchstart",this.handleTouchStart),window.addEventListener("touchmove",this.handleTouchMove),window.addEventListener("touchend",this.handleTouchEnd),un.b.addListener(this.handleSidebarToggle))}willUnmount(){const{device:e}=this.environment;e.isMobile&&(window.removeEventListener("touchstart",this.handleTouchStart),window.removeEventListener("touchmove",this.handleTouchMove),window.removeEventListener("touchend",this.handleTouchEnd),un.b.removeListener(this.handleSidebarToggle))}handleReset(){gn.a.reset(),this.updateTransform()}}var yn=fn;async function Sn(e){const t=mn.c();e.addEventListener("transitionend",t.resolve),e.addEventListener("webkitTransitionEnd",t.resolve),await t.promise,e.removeEventListener("transitionend",t.resolve),e.removeEventListener("webkitTransitionEnd",t.resolve)}var vn=n(504),wn=n(364),En=n(19),On=n(127),kn=n(416),Pn=n(765),Cn=n(252),Mn=n(128),Tn=n(1248),jn=n(529);function In(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function Bn(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?In(Object(n),!0).forEach((function(t){xn(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):In(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function xn(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}class An extends a.a{renderComponent(){const{device:e}=this.environment,{onClick:t,focused:n,isAddButton:r,title:a,caption:o,shortcut:l,isOnlySpace:c,disabled:d}=this.props,h=this.environment.device.isMobile,p=this.props.isCheck;return i.a.createElement(q.a,{mobileFeedback:this.environment.device.isMobile,onClick:t,hovered:n,disabled:d,style:this.getStyle()},!c&&!h&&this.renderDragHandle(),r?this.renderAddIcon():this.renderIcon(),i.a.createElement("div",{style:{marginLeft:12,marginRight:l||p?12:0,minWidth:0}},i.a.createElement(Zt.a,{className:"notranslate",isMobile:e.isMobile},a),o&&i.a.createElement(Zt.a,{isSmall:!0,isMobile:e.isMobile},o)),p&&s.a.check({width:16,height:16,marginLeft:"auto"}),l&&!h&&!p&&i.a.createElement("div",{style:this.getShortcutStyle()},l))}renderDragHandle(){return i.a.createElement(jn.a,{iconSize:12,style:{marginLeft:-6,marginRight:4,visibility:this.props.isAddButton?"hidden":"visible"}})}renderIcon(){const e=this.environment.device.isMobile;return i.a.createElement("div",{style:{display:"flex",alignItems:"center"}},i.a.createElement("div",{style:{position:"relative"}},this.props.id&&i.a.createElement(v.a,{disabled:!0,icon:this.props.icon,isEmptyPage:!1,title:this.props.title,size:e?An.mobileIconSize:An.desktopIconSize,isLarge:!0}),i.a.createElement(Tn.a,{color:Tn.a.Color.Red,count:this.props.unreadMentions,style:{position:"absolute",top:-5,right:-5}})))}renderAddIcon(){const e=this.environment.device.isMobile?An.mobileIconSize:An.desktopIconSize;return i.a.createElement("div",{style:Bn({},this.getIconWrapStyle(),{width:e,height:e})},this.getPlusIcon())}getStyle(){const e=this.environment.device.isMobile,{WindowSizeStore:t}=this.environment,{disabled:n}=this.props;return Bn({display:"flex",alignItems:"center",lineHeight:"120%",width:"100%",paddingTop:e?8:4,paddingBottom:e?8:4,paddingLeft:e?t.getSafePaddingLeftCSS(16):14,paddingRight:e?t.getSafePaddingRightCSS(16):14},e&&{boxShadow:"0 1px 0 ".concat(this.theme.regularDividerColor)},{marginBottom:1,fontSize:e?16:14},e&&{background:this.theme.popoverBackground},{height:e?54:48},this.props.isAddButton&&!e&&{boxShadow:"none",marginBottom:0},{},n&&{opacity:.4})}getPlusIcon(){return s.a.plus({flexGrow:0,flexShrink:0,width:16,height:16,fill:this.theme.popoverBackground})}getIconWrapStyle(){return{width:32,height:32,display:"flex",alignItems:"center",justifyContent:"center",background:this.theme.lightIconColor,borderRadius:3,flexShrink:0}}getShortcutStyle(){return{color:this.theme.lightTextColor,fontSize:12,whiteSpace:"nowrap",marginLeft:"auto",flexShrink:0}}}An.contextTypes=Bn({},Ce.c),An.mobileIconSize=36,An.desktopIconSize=32,An.dragHandleEffectiveWidth=16;var Ln=An,Dn=n(407),Rn=n(151);function Fn(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function Wn(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Fn(Object(n),!0).forEach((function(t){Un(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Fn(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function Un(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}class Vn extends a.a{renderComponent(){const{device:e}=this.environment,t=e.isElectronMac&&je.p.state;return i.a.createElement(O.a,{renderTooltip:()=>i.a.createElement("div",null,i.a.createElement("div",null,i.a.createElement(M.a,{defaultMessage:"Close sidebar",id:"sidebarUnexpandButton.closeSidebar.tooltip"})),i.a.createElement(Dn.a,{style:{color:this.theme.mediumInvertedTextColor},name:"toggleSidebar"})),originGap:6,render:n=>i.a.createElement(On.a,{isVisible:!0,animationStyle:{opacity:t?0:1},render:()=>i.a.createElement(Rn.a,Object.assign({icon:s.a.doubleChevronLeft,style:Wn({position:"relative"},e.isMobile&&{height:"100%"}),mobileFeedback:e.isMobile,onClick:()=>pt.g({environment:this.environment,isExpanded:!1}),className:ae.n},n))})})}}var Nn=Vn,_n=n(344);class Hn extends a.a{constructor(){super(...arguments),this.storeTypes={buttonPopupStore:ln.a}}renderComponent(){const{device:e}=this.environment;let t;return t=e.isMobile?{menuType:Ce.b.MenuType.ActionSheet}:{menuType:Ce.b.MenuType.Popup},i.a.createElement("div",{style:this.getContainerStyle()},i.a.createElement("div",{style:this.getTextStyle()},this.props.emailAddress),this.props.showAccountOptions&&i.a.createElement(Se.a,{popupType:e.isMobile?Se.a.PopupType.SlideUp:Se.a.PopupType.Popup,buttonPopupStore:this.stores.buttonPopupStore,renderOrigin:e=>{if(!this.props.disabled)return i.a.createElement(q.a,Object.assign({},e,{style:this.getButtonStyle()}),s.a.dots(this.getButtonIconStyle()))},render:()=>i.a.createElement(Ce.b,Object.assign({},t),i.a.createElement(_n.a,{sections:Object(H.f)(this.props.userId),context:{environment:this.environment,blocks:[]}}))}))}getButtonStyle(){const{device:e}=this.environment;return{display:"flex",alignItems:"center",justifyContent:"center",flexShrink:0,width:e.isMobile?24:20,height:e.isMobile?24:20,borderRadius:3}}getButtonIconStyle(){const{device:e}=this.environment;return{width:e.isMobile?18:12,height:e.isMobile?18:12}}getContainerStyle(){return{marginTop:this.environment.device.isMobile?20:8,marginLeft:12,marginRight:12,display:"flex",alignItems:"center",justifyContent:"space-between",color:this.theme.mediumTextColor}}getTextStyle(){return{fontSize:this.environment.device.isMobile?14:11,lineHeight:C.a.lineHeight.UISmall.desktop,fontWeight:C.a.fontWeight.medium}}}var zn=Hn,qn=n(157),Gn=n(632),Qn=n(552),Kn=n(232),Zn=n(627);class Xn extends a.a{renderComponent(){return i.a.createElement("div",{style:this.getPlaceholderPageStyle()},this.props.showIcon&&s.a.templates({width:16,height:16,fill:this.theme.buttonHoveredBackground}),i.a.createElement("div",{style:this.getPlaceholderTextWrapStyle()},i.a.createElement("div",{style:Xn.getPlaceholderTextStyle(this.theme)})))}getPlaceholderPageStyle(){return{height:28,display:"flex",alignItems:"center",width:"100%",padding:this.props.showIcon?"0 15px":"0 0px"}}getPlaceholderTextWrapStyle(){return{flexGrow:1,marginLeft:this.props.showIcon?10:0,height:28,display:"flex",alignItems:"center"}}static getPlaceholderTextStyle(e){const t=Math.ceil(60),n=Math.floor(85),r=Math.floor(Math.random()*(n-t+1))+t,i="".concat(r,"%");return{height:4,background:e.buttonHoveredBackground,width:i}}}var Yn=Xn,Jn=n(116);function $n(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function er(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?$n(Object(n),!0).forEach((function(t){tr(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):$n(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function tr(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}class nr extends a.a{willMountOrUpdate(){"store"===this.props.type&&this.props.spaceStore.getValue()}renderComponent(){const{device:e}=this.environment,{props:t}=this,{activeUserEmailAddress:n,isMobile:r,style:a,showExpand:o}=t,l="store"===t.type?Object(Jn.getSpaceName)(this.environment,t.spaceStore):t.spaceName;return i.a.createElement(E.a,{style:er({overflow:"hidden",width:"100%"},r&&{fontSize:14,padding:0,marginRight:12},{},a||{}),left:l?this.renderRecordIcon(l,"store"===t.type?void 0:t.spaceIcon,r,"store"===t.type?t.spaceStore:void 0):this.renderPlaceholderRecordIcon(),isMobile:r,disableMobileBorder:!0},!l&&this.renderPlaceholderTitle(),l&&i.a.createElement("div",{style:{display:"flex",alignItems:"center",justifyContent:n?"space-between":"start"},className:"notranslate"},i.a.createElement("div",{style:er({display:"flex",flexDirection:"column",marginRight:6,marginTop:e.isAndroid?3:0},nr.truncateStyle)},i.a.createElement("div",{style:er({color:this.theme.regularTextColor,fontWeight:C.a.fontWeight.medium},nr.truncateStyle)},l),i.a.createElement("div",{style:er({color:this.theme.mediumTextColor,fontSize:11,lineHeight:"12px",fontWeight:C.a.fontWeight.regular},nr.truncateStyle)},n)),o&&i.a.createElement("div",{style:{flexGrow:0,flexShrink:0,width:12,height:12,fill:this.theme.mediumIconColor}},s.a.expand())))}renderRecordIcon(e,t,n,r){const a=r?Object(Jn.getSpaceIcon)(this.environment,r):t?{icon:t,table:"space",id:"undefined"}:void 0,o=r?Object(Jn.getSpaceName)(this.environment,r):e;return i.a.createElement(v.a,{disabled:!0,icon:a,isEmptyPage:!1,title:o,size:n?24:20,style:{marginTop:1,color:this.theme.regularTextColor}})}renderPlaceholderRecordIcon(){return i.a.createElement("div",{style:{opacity:.25}},i.a.createElement(Zn.a,{size:20,title:void 0}))}renderPlaceholderTitle(){return i.a.createElement(Yn,{showIcon:!1})}}nr.truncateStyle={whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis"};var rr=nr,ir=n(1278),ar=n(751),or=n(509);const sr=new ln.a,lr=new ln.a;var cr=n(743),dr=(n(136),n(153)),hr=n(750),pr=n(761);function mr(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function ur(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}class gr extends a.a{renderComponent(){return i.a.createElement(q.a,{onClick:this.props.onClick,style:this.getStyle(),hoveredStyle:this.getHoveredStyle()},s.a.appleLogo({width:16,height:16,marginRight:6,marginBottom:2}),i.a.createElement(M.a,{id:"loginForm.loginWithAppleButton.label",defaultMessage:"Continue with Apple"}))}getStyle(){return function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?mr(Object(n),!0).forEach((function(t){ur(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):mr(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}({display:"inline-flex",alignItems:"center",justifyContent:"center",whiteSpace:"nowrap",height:36,borderRadius:3,color:En.f.regularTextColor,fill:En.f.regularTextColor,background:En.f.white,fontSize:14,lineHeight:1,paddingLeft:12,paddingRight:12,fontWeight:C.a.fontWeight.medium,border:"light"===this.theme.mode?"1px solid ".concat(this.theme.regularTextColor):"none",width:"100%"},this.props.style,{boxShadow:"0 1px 2px rgba(15, 15, 15, 0.1)"})}getHoveredStyle(){return{background:"light"===this.theme.mode?this.theme.buttonHoveredBackground:En.f.whiteWithAlpha(.8)}}}var br=gr,fr=n(487),yr=n(39),Sr=n(224);function vr(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function wr(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?vr(Object(n),!0).forEach((function(t){Er(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):vr(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function Er(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}class Or extends a.a{constructor(){super(...arguments),this.emailInputId=be.a.uniqueId("notion-email-input-"),this.passwordInputId=be.a.uniqueId("notion-password-input-"),this.storeTypes={loginStore:ar.a,loginPermissionsStore:ir.a},this.handleHiddenPasswordInputChange=e=>{const{loginStore:t}=this.stores,n=wr({},t.state,{password:e.currentTarget.value,alert:void 0});t.setState(n)},this.handleEmailChange=e=>{const{loginStore:t}=this.stores,n=wr({},t.state,{email:e.target.value,alert:void 0});t.isPassword()||t.isTemporaryPasscode()||t.isReverifying()?t.setState(wr({},n,{loginType:"email",password:""})):t.setState(n)},this.handleEmailLoginClick=async()=>{const{loginStore:e}=this.stores;if(e.isEmail()){const{email:t}=e.state,n=await yr.m(this.environment,{email:t,allowAdminBypass:!0});if("failed"===n.type)return;const r=n.data.samlRedirect;if(r&&r.enforced)return e.setState(wr({},e.state,{loginType:"saml",alert:"Redirecting you to use SAML SSO"})),void this.handleSamlLoginClick();n.data.hasPassword?n.data.mustReverify?await Cn.r({environment:this.environment,store:e,reverify:!0}):e.setState(wr({},e.state,{loginType:"password",alert:void 0})):(e.setState(wr({},e.state,{hasAccount:Boolean(n.data.hasAccount)})),Cn.r({environment:this.environment,store:e}))}},this.handleTemporaryPasscodeLoginClick=async()=>{const{redirectURL:e}=this.props,{loginStore:t}=this.stores;if(t.isReverifying()){const{password:e,sentEmailPasscodeState:n}=t.state,r=await Cn.t({environment:this.environment,state:n,password:e});r?t.setState(wr({},t.state,{alert:r})):t.setState(wr({},t.state,{loginType:"password",password:"",reverified:!0,alert:void 0}))}if(t.isTemporaryPasscode()){const{password:n,sentEmailPasscodeState:r}=t.state,i=await Cn.j({environment:this.environment,state:r,password:n,redirectURL:e});i&&t.setState(wr({},t.state,{alert:i}))}},this.handlePasswordLoginClick=async()=>{const{redirectURL:e}=this.props,{loginStore:t}=this.stores,{email:n,password:r}=t.state,i=await Cn.i({environment:this.environment,email:n,password:r,redirectURL:e});t.setState(wr({},t.state,{alert:i}))},this.handleResetPasswordClick=()=>{Cn.q({environment:this.environment,store:this.stores.loginStore})},this.handleSamlLoginClick=async()=>{const{device:e}=this.environment,{loginStore:t}=this.stores;if(t.isSaml()){const{email:n}=t.state;if(n){const r=e.isElectron?"nativeredirect":e.isNative?"native":void 0,i=await yr.X(this.environment,{email:n,callbackType:r});if("failed"===i.type)return void t.setState(wr({},t.state,{alert:Object(Sr.b)(this.props.intl,i)}));t.setState(wr({},t.state,{alert:void 0}));const a=i.data.redirectUrl;a&&Cn.n(this.environment,a)}}},this.handleLoginWithAppleClick=()=>{Cn.o({environment:this.environment,store:this.stores.loginStore})}}renderComponent(){const{loginStore:e}=this.stores,{isSignup:t}=this.props;return i.a.createElement("div",{className:ae.C,style:wr({},Or.wrapStyle,{},this.props.style)},this.renderLoginWithGoogleButton(),this.renderLoginWithAppleButton(),i.a.createElement("div",{style:{width:"100%"}},this.renderLoginForm(),this.renderAlert(),!t&&this.renderForgotPassword(),!ye.a.isAdminMode&&this.renderLoginOptions({email:!(e.isEmail()||e.isTemporaryPasscode()||e.isPassword()||e.isReverifying()),saml:!e.isSaml()})),this.renderDisclaimer())}renderLoginForm(){var e=this;const{loginStore:t}=this.stores,{email:n,password:a}=t.state;return t.isEmail()?i.a.createElement("form",{onSubmit:this.onFormSubmit},this.renderEmailInput({email:n,onSubmit:this.handleEmailLoginClick}),i.a.createElement(dr.b,{type:"password",autoComplete:"current-password",style:{opacity:0,height:0,padding:0,pointerEvents:"none"},inputElementAttributes:{tabIndex:-1,"aria-hidden":!0},onChange:this.handleHiddenPasswordInputChange}),i.a.createElement(pr.a,{variant:"secondary",style:{marginTop:6,marginBottom:12},isFullWidth:!0,onClick:this.handleEmailLoginClick},i.a.createElement(M.a,{id:"loginForm.continueWithEmailButton.label",defaultMessage:"Continue with email"}))):t.isPassword()?i.a.createElement("form",{onSubmit:this.onFormSubmit},this.renderEmailInput({email:n,onSubmit:this.handlePasswordLoginClick}),t.state.reverified&&i.a.createElement("div",{style:this.getEmailSentCaptionStyle()},i.a.createElement("span",{style:{paddingRight:4}},this.renderCheck()),i.a.createElement(M.a,{id:"loginForm.reverifyPasswordLabel",defaultMessage:"<emailverifiedtext>Email verified</emailverifiedtext>. You can continue logging in with your password.",values:{emailverifiedtext:function(){for(var t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];return i.a.createElement("span",{style:{color:e.theme.regularTextColor}},n)}}})),i.a.createElement(hr.a,{forId:this.passwordInputId},i.a.createElement(M.a,{id:"loginForm.passwordInput.label",defaultMessage:"Password"})),this.renderPasswordInput({password:a,inputType:"password",placeholderType:"enter_password",onSubmit:this.handlePasswordLoginClick,intl:this.props.intl}),i.a.createElement(pr.a,{variant:"secondary",style:{marginTop:6,marginBottom:12},isFullWidth:!0,onClick:this.handlePasswordLoginClick},i.a.createElement(M.a,{id:"loginForm.continueWithPasswordButton.label",defaultMessage:"Continue with password"}))):t.isPasswordResetSent()?i.a.createElement(r.Fragment,null,i.a.createElement(Kt.a,{size:42}),i.a.createElement("div",{style:this.getEmailSentCaptionStyle()},i.a.createElement(M.a,{id:"loginForm.passwordResetSentMessage",defaultMessage:"Check your inbox for the link to reset your password."}))):t.isForgotPassword()?i.a.createElement("form",{onSubmit:this.onFormSubmit},this.renderEmailInput({email:n,onSubmit:this.handleResetPasswordClick}),i.a.createElement(pr.a,{variant:"secondary",style:{marginTop:6,marginBottom:12},isFullWidth:!0,onClick:this.handleResetPasswordClick},i.a.createElement(M.a,{id:"loginForm.sendResetLink",defaultMessage:"Send reset link"}))):t.isReverifying()?i.a.createElement("form",{onSubmit:this.onFormSubmit},this.renderEmailInput({email:n,onSubmit:this.handleTemporaryPasscodeLoginClick}),i.a.createElement("div",{style:this.getEmailSentCaptionStyle()},i.a.createElement(M.a,{id:"loginForm.reverifySentMessage",defaultMessage:"This account requires email verification. Please check your inbox and paste in the verification code."})),i.a.createElement(hr.a,{forId:this.passwordInputId},i.a.createElement(M.a,{id:"loginForm.verificationCodeInput.label",defaultMessage:"Verification code"})),this.renderPasswordInput({password:a,inputType:"text",placeholderType:"reverify",onSubmit:this.handleTemporaryPasscodeLoginClick,intl:this.props.intl}),i.a.createElement(pr.a,{variant:"secondary",style:{marginTop:6,marginBottom:12},isFullWidth:!0,onClick:this.handleTemporaryPasscodeLoginClick},i.a.createElement(M.a,{id:"loginForm.continueWithReverifyButton.label",defaultMessage:"Verify email"}))):t.isTemporaryPasscode()?i.a.createElement("form",{onSubmit:this.onFormSubmit},this.renderEmailInput({email:n,onSubmit:this.handleTemporaryPasscodeLoginClick}),i.a.createElement("div",{style:this.getEmailSentCaptionStyle()},this.stores.loginStore.state.hasAccount||!Pn.a(this.environment)?i.a.createElement(M.a,{id:"loginForm.temporaryPasscodeSentMessage",defaultMessage:"We just sent you a temporary login code.{br}Please check your inbox.",values:{br:i.a.createElement("br",null)}}):i.a.createElement(M.a,{id:"loginForm.temporaryPasscodeSentMessageNoAccount",defaultMessage:"We just sent you a temporary sign up code. Please check your inbox and paste the sign up code below."})),i.a.createElement(hr.a,{forId:this.passwordInputId},this.stores.loginStore.state.hasAccount||!Pn.a(this.environment)?i.a.createElement(M.a,{id:"loginForm.loginCodeInput.label",defaultMessage:"Login code"}):i.a.createElement(M.a,{id:"loginForm.signUpCodeInput.label",defaultMessage:"Sign up code"})),this.renderPasswordInput({password:a,inputType:"text",placeholderType:this.props.emailPasscodePlaceholderType,onSubmit:this.handleTemporaryPasscodeLoginClick,intl:this.props.intl}),i.a.createElement(pr.a,{variant:"secondary",style:{marginTop:6,marginBottom:12},isFullWidth:!0,onClick:this.handleTemporaryPasscodeLoginClick},this.stores.loginStore.state.hasAccount||!Pn.a(this.environment)?i.a.createElement(M.a,{id:"loginForm.continueWithLoginCodeButton.label",defaultMessage:"Continue with login code"}):i.a.createElement(M.a,{id:"loginForm.createNewAccountButton.label",defaultMessage:"Create new account"}))):t.isSaml()?i.a.createElement("form",{onSubmit:this.onFormSubmit},this.renderEmailInput({email:t.state.email,onSubmit:this.handleSamlLoginClick}),i.a.createElement(pr.a,{variant:"secondary",style:{marginTop:6,marginBottom:12},isFullWidth:!0,onClick:this.handleSamlLoginClick},i.a.createElement(M.a,{id:"loginForm.continueWithSAMLButton.label",defaultMessage:"Continue with SAML"}))):void 0}renderLoginWithGoogleButton(){return i.a.createElement(pr.a,{variant:"primary",isFullWidth:!0,style:{marginBottom:4},onClick:e=>{Cn.p({environment:this.environment,store:this.stores.loginStore,permissionsStore:this.stores.loginPermissionsStore})}},s.a.googleLogo({fill:"currentColor",width:14,height:14,marginRight:6}),i.a.createElement(M.a,{id:"loginForm.loginWithGoogleButton.label",defaultMessage:"Continue with Google"}))}renderLoginWithAppleButton(){if(!ye.a.isAdminMode)return i.a.createElement(br,{style:{marginTop:10},onClick:this.handleLoginWithAppleClick})}renderCheck(){return s.a.thinCheck({display:"inline",height:12,width:12,color:this.theme.regularTextColor})}renderLoginOptions(e){const{email:t,saml:n}=e;if(t||n)return i.a.createElement("div",{style:this.getCaptionStyle()},t&&n?this.renderContinueWithEmailOrSaml():t?this.renderContinueWithEmail():this.renderContinueWithSaml())}renderContinueWithEmailOrSaml(){var e=this;return i.a.createElement(M.a,{id:"loginForm.otherLoginOptions.continueWithEmailOrSAML",defaultMessage:"You can also <emailloginlink>continue with email</emailloginlink> or <samlloginlink>continue with SAML SSO</samlloginlink>",values:{emailloginlink:function(){for(var t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];return i.a.createElement(fr.a,{onClick:()=>{e.stores.loginStore.setState(wr({},e.stores.loginStore.state,{loginType:"email",alert:void 0}))}},n)},samlloginlink:function(){for(var t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];return i.a.createElement(fr.a,{onClick:()=>{e.stores.loginStore.setState(wr({},e.stores.loginStore.state,{loginType:"saml",alert:void 0}))}},n)}}})}renderContinueWithEmail(){var e=this;return i.a.createElement(M.a,{id:"loginForm.otherLoginOptions.continueWithEmail",defaultMessage:"You can also <emailloginlink>continue with email</emailloginlink>",values:{emailloginlink:function(){for(var t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];return i.a.createElement(fr.a,{onClick:()=>{e.stores.loginStore.setState(wr({},e.stores.loginStore.state,{loginType:"email",alert:void 0}))}},n)}}})}renderContinueWithSaml(){var e=this;return i.a.createElement(M.a,{id:"loginForm.otherLoginOptions.continueWithSAML",defaultMessage:"You can also <samlloginlink>continue with SAML SSO</samlloginlink>",values:{samlloginlink:function(){for(var t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];return i.a.createElement(fr.a,{onClick:()=>{e.stores.loginStore.setState(wr({},e.stores.loginStore.state,{loginType:"saml",alert:void 0}))}},n)}}})}renderEmailInput(e){const{email:t,onSubmit:n}=e,a="email"===this.props.emailLabelType?i.a.createElement(M.a,{id:"loginForm.emailInput.label",defaultMessage:"Email",description:"Label for email input field if user is logging in with a normal email address"}):i.a.createElement(M.a,{id:"loginForm.workEmailInput.label",defaultMessage:"Work email",description:"Label for email input field if user is logging in with a company email address"});return i.a.createElement(r.Fragment,null,i.a.createElement(Kt.a,{size:42}),i.a.createElement(hr.a,{forId:this.emailInputId},a),i.a.createElement(dr.b,{id:this.emailInputId,value:t,type:"email",format:dr.b.Format.Large,style:this.getInputStyle(),placeholder:this.props.intl.formatMessage({id:"loginForm.emailInput.placeholder",defaultMessage:"Enter your email address..."}),onSubmit:n,autoComplete:"username",showClearButton:!0,autoFocus:this.props.emailInputAutoFocus,onChange:this.handleEmailChange}))}renderPasswordInput(e){const{password:t,inputType:n,placeholderType:r,intl:a,onSubmit:o}=e;let s="";const l=this.stores.loginStore.state.hasAccount,c=!Pn.a(this.environment);switch(r){case"enter_password":s=a.formatMessage({id:"loginForm.passcodeInput.enterPasswordPlaceholder",defaultMessage:"Enter your password..."});break;case"enter_code":s=l||!c?a.formatMessage({id:"loginForm.passcodeInput.enterCodePlaceholder",defaultMessage:"Enter login code"}):a.formatMessage({id:"loginForm.passcodeInput.enterSignupCodePlaceholder",defaultMessage:"Enter sign up code"});break;case"paste_code":s=l||!c?a.formatMessage({id:"loginForm.passcodeInput.pasteCodePlaceholder",defaultMessage:"Paste login code"}):a.formatMessage({id:"loginForm.passcodeInput.pasteSignupCodePlaceholder",defaultMessage:"Paste sign up code"});break;case"reverify":s=a.formatMessage({id:"loginForm.passcodeInput.reverifyPlaceholder",defaultMessage:"Paste verification code"})}return i.a.createElement(dr.b,{id:this.passwordInputId,type:n,value:t,style:this.getInputStyle(),format:dr.b.Format.Large,placeholder:s,onSubmit:o,autoFocus:!0,autoComplete:"text"===n?"one-time-code":"current-password",autoCorrect:"off",autoCapitalize:"off",spellCheck:!1,onChange:e=>{this.stores.loginStore.setState(wr({},this.stores.loginStore.state,{password:"text"===n?e.target.value.trim():e.target.value,alert:void 0}))}})}renderForgotPassword(){const{loginStore:e}=this.stores;if(e.isPassword()||e.isEmail())return i.a.createElement("div",{style:this.getCaptionStyle()},i.a.createElement(fr.a,{onClick:()=>{e.setState(wr({},e.state,{loginType:"forgot",password:"",alert:void 0}))}},i.a.createElement(M.a,{id:"loginForm.forgotPasswordLink",defaultMessage:"Forgot password?"})))}renderAlert(){const{alert:e}=this.stores.loginStore.state,t=e&&e.split("User:")[1]||e;return i.a.createElement("div",{style:{fontSize:14,color:En.f.redWithAlpha(1),textAlign:"center",display:t?"block":"none",width:"100%"}},t)}renderDisclaimer(){const{device:e}=this.environment;return this.props.disableDisclaimer?null:i.a.createElement("div",{style:{width:e.isMobile?"100%":500,marginTop:64,fontSize:12,color:this.theme.lightTextColor,textAlign:e.isMobile?"left":"center"}},i.a.createElement("p",{style:{marginBottom:0}},i.a.createElement(M.a,{id:"loginForm.disclaimer",description:"Terms and conditions for using the app",defaultMessage:"By clicking “Continue with Google/Email/SAML” above, you acknowledge that you have read and understood, and agree to Notion's <termsandconditionslink>Terms & Conditions</termsandconditionslink> and <privacypolicylink>Privacy Policy</privacypolicylink>.",values:{termsandconditionslink:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return i.a.createElement(fr.a,{href:Te.d.termsAndConditions},t)},privacypolicylink:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return i.a.createElement(fr.a,{href:Te.d.privacyPolicy},t)}}})))}onFormSubmit(e){e.preventDefault()}getInputStyle(){const{device:e}=this.environment;return wr({marginTop:4,marginBottom:8,boxShadow:this.theme.inputBoxShadow},e.isMobile&&{lineHeight:"30px"})}getCaptionStyle(){return wr({color:this.theme.mediumTextColor,fontSize:14,lineHeight:1.6,marginTop:8,textAlign:"center"},this.props.captionStyle)}getEmailSentCaptionStyle(){return wr({fontSize:14,textAlign:"center",marginTop:8,marginBottom:8,width:"100%",color:this.theme.mediumTextColor},this.props.emailPasswordSentPromptStyle)}}Or.wrapStyle={width:"100%",display:"flex",flexDirection:"column",alignItems:"center"};var kr=Object(M.g)(Or);function Pr(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function Cr(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Pr(Object(n),!0).forEach((function(t){Mr(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Pr(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function Mr(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}class Tr extends a.a{constructor(){super(...arguments),this.storeTypes={loginStore:ar.a,loginPermissionsStore:ir.a},this.renderLoginAction=e=>{const{redirectURL:t}=this.props,{device:n}=this.environment;return i.a.createElement("div",{style:{height:"100%"}},!n.isMobile&&i.a.createElement("div",{style:this.getCancelStyle(),onClick:()=>or.a.setState(Cr({},or.a.getState(),{open:!1}))},i.a.createElement(M.a,{defaultMessage:"Cancel",id:"sidebarSwitcherMultiAccount.addAccountModal.cancelButton.label"})),i.a.createElement("div",{style:this.getLoginActionWrapperStyle()},!n.isMobile&&i.a.createElement("div",{style:this.getTitleStyle()},i.a.createElement(M.a,Object.assign({},Object(bn.e)(this.props.intl,e)))),i.a.createElement("div",{style:this.getDescriptionStyle()},this.renderDescription(e)),i.a.createElement(pn.a,{capture:!0,onBackspace:be.a.identity,onLeft:be.a.identity,onRight:be.a.identity,onSelectAll:be.a.identity,onRedo:be.a.identity,onUndo:be.a.identity,onCut:be.a.identity,onCopy:be.a.identity,onPaste:be.a.identity,onKeypress:be.a.identity,onDelete:be.a.identity,onTab:be.a.identity},i.a.createElement(kr,Object.assign({style:this.getLoginActionStyle(),emailPasscodePlaceholderType:"enter_code",emailLabelType:"email",emailInputAutoFocus:!0,disableDisclaimer:!0,redirectURL:t},this.stores)))))},this.renderAccountActionModal=()=>{const{open:e,createType:t}=or.a.state;return i.a.createElement(cr.a,{open:e,innerStyle:this.getModalStyle(),onDismiss:()=>{or.a.reset(),this.stores.loginStore.reset()},render:()=>{if(t)return this.renderLoginAction(t)},className:ae.ib})},this.getAccountActionStyle=()=>{const{device:e}=this.environment;return{display:"flex",color:this.theme.mediumTextColor,whiteSpace:"nowrap",fontSize:e.isMobile?16:12}}}willMount(e){super.willMount(e);const{loginStore:t}=this.stores;"email"===t.state.loginType&&this.environment.device.isMobile&&t.setState(Cr({},t.state,{loginType:"google"}))}renderComponent(){const{online:e}=wt.a.state,{device:t}=this.environment,{createType:n}=this.props;return t.isMobile?i.a.createElement(Se.a,{popupType:Se.a.PopupType.SlideUp,buttonPopupStore:"add-account"===n?lr:sr,alignmentToOrigin:Se.a.Alignment.Start,placementToOrigin:Se.a.Placement.Top,originGap:0,isFullWidthOnMobile:!0,render:e=>this.renderAccountActionMenu(n,e),preventScaleTransition:!0,renderOrigin:t=>i.a.createElement(Pe.a,Object.assign({focused:!1,disabled:!e,title:this.renderMenuButtonLoginTitle(n)},t))}):i.a.createElement("div",{onClick:()=>{e&&or.a.setState(Cr({},or.a.getState(),{open:!0,createType:n}))}},i.a.createElement(Pe.a,{focused:!1,disabled:!e,title:this.renderMenuButtonLoginTitle(n)}),this.renderAccountActionModal())}renderMenuButtonLoginTitle(e){switch(e){case"create-work":return i.a.createElement("div",{style:this.getAccountActionStyle()},i.a.createElement(M.a,{defaultMessage:"Create work account",id:"sidebarSwitcherMultiAccount.menuItem.createWorkAccountButton.label"}));case"add-account":return i.a.createElement("div",{style:this.getAccountActionStyle()},i.a.createElement(M.a,{defaultMessage:"Add another account from email",id:"sidebarSwitcherMultiAccount.addAccountButton.label"}))}}renderAccountActionMenu(e,t){const n={menuType:Ce.b.MenuType.Modal,left:i.a.createElement(Mt.CancelMenuText,null),onClickLeft:t.close,whiteBackground:!0,title:i.a.createElement(M.a,Object.assign({},Object(bn.e)(this.props.intl,e)))};return i.a.createElement(Ce.b,Object.assign({},n),this.renderLoginAction(e))}renderDescription(e){switch(e){case"add-account":return i.a.createElement(M.a,{id:"sidebarSwitcherMultiAccount.addAccount.description",defaultMessage:"Use an existing account, or sign up with a new email. Your current account will remain logged in.",description:"Description when adding an account"});case"create-work":return i.a.createElement(M.a,{id:"sidebarSwitcherMultiAccount.createWork.description",defaultMessage:"We’ll check if your teammates are already on Notion. If not, we’ll create a new home for you and your team.",description:"Description when creating a work account"})}}getBaseMobileStyle(){return this.environment.device.isMobile?{maxWidth:343}:{}}getModalStyle(){return{width:480,maxWidth:"calc(100vw - 100px)",borderRadius:3}}getTitleStyle(){return Cr({fontSize:28,fontWeight:C.a.fontWeight.semibold,marginTop:90,textAlign:"center",lineHeight:1.1},this.getBaseMobileStyle())}getDescriptionStyle(){return Cr({fontSize:14,color:this.theme.mediumTextColor,width:350,marginTop:12,marginBottom:20,textAlign:"center",lineHeight:1.3},this.getBaseMobileStyle())}getCancelStyle(){return{fontSize:14,color:this.theme.mediumTextColor,position:"absolute",right:0,marginTop:16,marginRight:16,cursor:"pointer"}}getLoginActionWrapperStyle(){return{display:"flex",alignItems:"center",justifyContent:"center",flexDirection:"column",userSelect:"none",WebkitUserSelect:"none"}}getLoginActionStyle(){return Cr({width:320,marginTop:24,marginBottom:64},this.getBaseMobileStyle())}}var jr,Ir=Object(M.g)(Tr),Br=n(338),xr=n(184),Ar=n(257),Lr=n(187),Dr=n(414);function Rr(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function Fr(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Rr(Object(n),!0).forEach((function(t){Wr(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Rr(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function Wr(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}!function(e){e[e.Regular=0]="Regular",e[e.DesktopMac=1]="DesktopMac",e[e.Mobile=2]="Mobile",e[e.Oauth=3]="Oauth"}(jr||(jr={}));class Ur extends a.a{constructor(){super(...arguments),this.storeTypes={loginStore:ar.a,loginPermissionsStore:ir.a},this.height={[jr.Regular]:ve.a.defaultHeight,[jr.DesktopMac]:ve.a.desktopMacHeight,[jr.Mobile]:"auto"},this.handleDesktopAppClick=()=>{const{device:e}=this.environment;this.close(),e.isWindows?U.ub(this.environment,{from:"sidebar",platform:"windows"}):U.ub(this.environment,{from:"sidebar",platform:"mac"})},this.handleMobileAppClick=()=>{this.close(),U.vb(this.environment,{from:"sidebar"})},this.handleClick=()=>{Gn.a.setState(Fr({},Gn.a.state,{open:!0})),U.Yc(this.environment),or.a.getUserIds(this.environment).forEach(e=>{or.a.getSpaceViewStores(this.environment,e).forEach(t=>{const n=t.getSpaceId();n&&Object(Dr.a)({environment:this.environment,spaceId:n,userId:e})})})},this.logout=()=>{const{online:e}=wt.a.state;e&&(Gn.a.setState(Fr({},Gn.a.state,{open:!1})),U.Wd(this.environment),Cn.k(this.environment))},this.handleDraggableListDrop=e=>t=>{const n=new Br.a(this.environment,{table:Lr.a,id:e},{userId:e});W.d(this.environment,e=>{Mn.u({userRootStore:n,transaction:e,spaceViewIds:t})},e),U.Ed(this.environment,{workspace_count:t.length})},this.getAccountActionStyle=()=>({display:"flex",color:this.theme.mediumTextColor,whiteSpace:"nowrap",fontSize:this.isMobile?16:12,paddingLeft:this.isMobile||this.isOnlySpace()?0:Ln.dragHandleEffectiveWidth}),this.getFooterStyle=()=>this.environment.device.isMobile?{}:{backgroundColor:this.theme.sidebarSwitcherFooterBackground}}renderComponent(){const{device:e}=this.environment,{shouldShowUnexpandButton:t}=this.props,{currentSpaceStore:n,currentUserStore:a}=P.a.state,o=or.a.getUserIds(this.environment);if(!n||!a)return;const s=Qn.a.getUnreadMentionsCountForOtherSpaces(),l=o.length>1?a.getEmail():void 0;return i.a.createElement(Se.a,{popupType:e.isMobile?Se.a.PopupType.SlideUp:Se.a.PopupType.Popup,buttonPopupStore:Gn.a,renderOrigin:()=>i.a.createElement(q.a,{style:Fr({},Ur.buttonStyle,{height:this.height[this.props.format],marginBottom:l?e.isMobile?0:8:0}),mobileFeedback:e.isMobile,onClick:this.handleClick,className:ae.gb},i.a.createElement(rr,{isMobile:this.isMobile,spaceStore:n,activeUserEmailAddress:l,showExpand:!0,type:"store"}),t&&i.a.createElement("div",{className:ae.t,style:{display:"flex",alignItems:"center",height:"100%",marginLeft:"auto",marginRight:s?0:12}},i.a.createElement(Nn,null)),i.a.createElement(Tn.a,{color:Tn.a.Color.Red,count:s,style:{marginLeft:6,marginRight:14}})),originGap:0,disableMutationObserver:!0,render:t=>{let n;return n=e.isMobile?{menuType:Ce.b.MenuType.Modal,title:i.a.createElement(M.a,{defaultMessage:"Accounts & Workspaces",id:"sidebarSwitcherMultiAccount.mobileMenu.title"}),right:i.a.createElement(Mt.DoneMenuText,null),onClickRight:t.close}:{menuType:Ce.b.MenuType.Popup,minWidth:270,maxWidth:360,footer:this.renderFooter()},i.a.createElement(Ce.b,Object.assign({},n),o.map(t=>i.a.createElement(r.Fragment,{key:t},this.renderAccountHeader(t),i.a.createElement("div",{style:e.isMobile?{paddingTop:10}:{}},i.a.createElement(Oe.a,{type:Oe.a.Type.Vertical,sections:this.getMenuListSections(t),initialFocus:void 0})))),e.isMobile&&this.renderFooter())}})}renderAccountHeader(e){const{online:t}=wt.a.state,n=or.a.getUserEmailAddress(this.environment,e),r=!this.isOauth;return n&&i.a.createElement(zn,{emailAddress:n,userId:e,disabled:!t,showAccountOptions:r})}renderFooter(){const{redirectURL:e}=this.props,t=i.a.createElement(i.a.Fragment,null,!this.hasAtLeastOneTeamPlan()&&i.a.createElement(Ir,Object.assign({createType:"create-work",redirectURL:e},this.stores)),i.a.createElement(Ir,Object.assign({createType:"add-account",redirectURL:e},this.stores)));return i.a.createElement("div",{style:this.getFooterStyle()},i.a.createElement(ke.a,null,Pn.b(this.environment)&&t,this.renderLogoutAll()),!this.isMobile&&!this.isOauth&&i.a.createElement(ke.a,{topBorder:!0},this.renderDownloadApps()))}renderDownloadApps(){const{device:e}=this.environment;return e.isElectron?i.a.createElement(xr.a,{external:!0,href:Te.c.mobile,onClick:this.handleMobileAppClick},i.a.createElement(Pe.a,{focused:!1,title:i.a.createElement("div",{style:{color:this.theme.mediumTextColor,fontSize:12,paddingLeft:this.isMobile||this.isOnlySpace()?0:Ln.dragHandleEffectiveWidth}},i.a.createElement(M.a,{defaultMessage:"Get mobile app",id:"sidebarMultiSwitcher.desktopAppGetMobileApp.prompt"}))})):i.a.createElement(Re.a,{isTokenTitle:!0,title:i.a.createElement("div",{style:{display:"flex",color:this.theme.mediumTextColor,fontSize:12,alignItems:"center",marginLeft:-5}},i.a.createElement(xr.a,{external:!0,href:Te.c.desktop},i.a.createElement(Ar.a,{onClick:this.handleDesktopAppClick},e.isWindows?i.a.createElement(M.a,{defaultMessage:"Get Windows app",id:"sidebarMultiSwitcher.windowsAppButton.text"}):i.a.createElement(M.a,{defaultMessage:"Get Mac app",id:"sidebarMultiSwitcher.macAppButton.text"}))))})}renderLogoutAll(){const{online:e}=wt.a.state;if(!this.isOauth)return i.a.createElement(Pe.a,{onClick:this.logout,focused:!1,disabled:!e,title:i.a.createElement("div",{style:Fr({},this.getAccountActionStyle(),{paddingLeft:0})},i.a.createElement(M.a,{defaultMessage:"Log out all",id:"sidebarSwitcherMultiAccount.menuItem.logoutAllButton.label"}))})}getMenuListSections(e){const{device:t}=this.environment,n=or.a.getSpaceViewStores(this.environment,e).map(e=>e.id);return[{key:"spaces",render:a=>i.a.createElement(ke.a,Object.assign({},a,{disableMobilePadding:!0,topBorder:t.isMobile,style:{borderBottom:"1px solid ".concat(this.theme.regularDividerColor)},children:t.isMobile?a.children:i.a.createElement(r.Fragment,null,i.a.createElement(qn.b,{direction:qn.a.Vertical,keys:n,renderKey:e=>a.children[n.indexOf(e)],onDrop:this.handleDraggableListDrop(e),isSidebarSwitcher:!0}))})),items:this.getSpaceMenuListItems(e)}]}renderSpaceMenuItem(e){const{device:t}=this.environment,{online:n}=wt.a.state;return i.a.createElement(Ln,Object.assign({},e.props,{id:e.id,icon:e.icon,title:e.title,caption:e.subtitle,isCheck:e.isCurrentSpace,unreadMentions:e.unreadMentions,isOnlySpace:this.isOnlySpace(e.userId),shortcut:void 0!==e.shortcutIndex&&e.shortcutIndex<=9?t.isElectronMac?"⌘".concat(e.shortcutIndex):"ctrl+".concat(e.shortcutIndex):void 0,disabled:!n&&this.environment.currentUser.id!==e.userId}))}getSpaceMenuListItems(e){const{onSpaceClick:t}=this.props,{device:n}=this.environment,r=[],{currentUserRootStore:i,currentSpaceStore:a}=P.a.state,o=or.a.getSpaceViewStores(this.environment,e),s=or.a.getAllSpaceViewStores(this.environment);if(!i||!a)return[];for(const[l,c]of o.entries()){const o=c.getSpaceStore();if(o){const l=e===i.id&&o.id===a.id,{results:d}=Qn.a.state,h=d.find(e=>e.spaceId===o.id),p=Object(Jn.getSpaceName)(this.environment,o);let m;const u=Kn.a.getPublicSpaceData(this.environment,o.id);if(u){const e=u.productId?this.props.intl.formatMessage(Object(bn.d)(u.productId)):this.props.intl.formatMessage("team"===o.getPlanType()?bn.h.teamTrialPlan:bn.h.personalPlan);m=this.props.intl.formatMessage("personal"===o.getPlanType()?bn.h.workspaceSubtitleWithoutMembers:bn.h.workspaceSubtitleWithMembers,{numberOfWorkspaceMembers:this.props.intl.formatNumber(u.memberCount),planType:e})}const g=be.a.findIndex(s,e=>e.id===c.id)+1;r.push({key:c.id,render:t=>this.renderSpaceMenuItem({id:o.id,props:t,title:p,subtitle:m,shortcutIndex:n.isElectron?g:void 0,icon:Object(Jn.getSpaceIcon)(this.environment,o),isCurrentSpace:l,userId:e,unreadMentions:h&&h.spaceId!==a.id&&h.unread.mentions>0?h.unread.mentions:void 0}),action:async e=>{let{event:n}=e;this.close(),l||await t({event:n,spaceViewStore:c}),U.Xd(this.environment)}})}}return r}close(){Gn.a.setState(Fr({},Gn.a.state,{open:!1}))}get isMobile(){return this.props.format===jr.Mobile}get isOauth(){return this.props.format===jr.Oauth}isOnlySpace(e){return 1===(e?or.a.getSpaceViewStores(this.environment,e):or.a.getAllSpaceViewStores(this.environment)).length}hasAtLeastOneTeamPlan(){return or.a.hasAtLeastOneTeamPlan(this.environment)}}Ur.Format=jr,Ur.buttonStyle={display:"flex",alignItems:"center",minWidth:0,height:"100%",width:"100%"};var Vr,Nr=Object(M.g)(Ur),_r=n(621),Hr=n(767),zr=n.n(Hr),qr=n(42),Gr=n(13);function Qr(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function Kr(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function Zr(e,t){const n="today",r="past-week",i="earlier",a=Gr.ob(Gr.m).startOf("day").valueOf(),o=zr()(a).subtract(1,"week").valueOf(),s=be.a.groupBy(e,e=>{let{timestamp:s}=e;return t===Vr.Relevance?i:s>a?n:s>o?r:i});let l=-1;return be.a.compact([n,r,i].map(e=>{const t=s[e];if(t&&0!==t.length)return{key:e,pages:t.map(e=>(l+=1,function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Qr(Object(n),!0).forEach((function(t){Kr(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Qr(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}({},e,{index:l})))}}))}!function(e){e.Relevance="Relevance",e.LastEditedNewest="LastEditedNewest"}(Vr||(Vr={}));var Xr=n(486),Yr=n(753),Jr=n(729),$r=n(406),ei=n(251),ti=n(690);function ni(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function ri(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function ii(e,t){if(null==e)return{};var n,r,i=function(e,t){if(null==e)return{};var n,r,i={},a=Object.keys(e);for(r=0;r<a.length;r++)n=a[r],t.indexOf(n)>=0||(i[n]=e[n]);return i}(e,t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);for(r=0;r<a.length;r++)n=a[r],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(i[n]=e[n])}return i}function ai(e){const{actorPointer:t,timestamp:n,store:r}=e,a=Object(M.h)(),o=Object(Fe.a)(Math.min(n,Date.now())).calendar(),s=Object($r.a)(()=>t?Object(Jr.a)({parentStore:r,pointer:t}):void 0,[r]),l=s&&Object(Ke.b)(a,s);return l?i.a.createElement("div",null,i.a.createElement(M.a,{id:"sharedWithMePage.menuItem.caption",defaultMessage:"Edited by {actorName} · {time}",values:{time:o,actorName:l},description:"Caption for a shared page that shows the time the page was last edited or the time at which the user was invited, and by whom (e.g. 'Today at 11:00am • Ivan Zhao'"})):i.a.createElement("div",null,o)}function oi(e){const{store:t,type:n}=e,[r,a]=i.a.useState(!1),o=Object(Xr.b)(),l=Object(Xr.d)(),c=r?i.a.createElement(M.a,{defaultMessage:"Link copied",id:"sharedWithMePageMenuItem.linkCopied.tooltip",description:"Tooltip shown when user copied link to a shared page"}):i.a.createElement(M.a,{defaultMessage:"Copy link",id:"sharedWithMePageMenuItem.copylinkToPage.tooltip",description:"Shortcut for copying a link to a shared page from the 'Shared With Me' pop-up"});return i.a.createElement(O.a,{placement:O.a.Placement.Bottom,renderTooltip:()=>c,forceVisibleState:r||void 0,render:e=>i.a.createElement(Ot.a,Object.assign({isGray:!0,style:{marginRight:2},onClick:e=>{ei.b({environment:o,blocks:[t],event:e}),l&&(Yr.b.update(e=>function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?ni(Object(n),!0).forEach((function(t){ri(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):ni(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}({},e,{[n]:!1})),pt.b()),U.Z(o,{type:n}),a(!0),setTimeout(()=>{a(!1)},1e3)}},e,{onMouseLeave:t=>{a(!1),e.onMouseLeave(t)}}),s.a.link({width:l?18:16,height:l?18:16}))})}function si(e){const{isPinned:t,store:n,spaceViewStore:r,type:a}=e,o=Object(Xr.b)(),l=Object(Xr.d)(),[{online:c}]=Object($r.b)(wt.a),[{currentUserSettingsStore:d}]=Object($r.b)(P.a),h=Object(ti.a)(e=>({pinned:{width:l?18:16,height:l?18:16,fill:e.regularIconColor},unpinned:{width:l?18:16,height:l?18:16}}),[l]);return i.a.createElement(O.a,{disableTooltip:!c,placement:O.a.Placement.Bottom,renderTooltip:()=>t?i.a.createElement(M.a,{defaultMessage:"Remove from sidebar",id:"outlinerViewAllMenuList.removeFromSidebar.tooltip",description:"Tooltip displayed when user can remove a pinned page from the sidebar"}):i.a.createElement(M.a,{defaultMessage:"Add to sidebar",id:"outlinerViewAllMenuList.addToSidebar.tooltip",description:"Tooltip displayed when user can pin a page to the sidebar"}),render:e=>i.a.createElement(Ot.a,Object.assign({},e,{isGray:!0,onClick:()=>{d&&Object(W.d)(o,e=>{t?(pt.i({environment:o,store:n,spaceViewStore:r,userSettingsStore:d,transaction:e}),U.fd(o,{type:a,from:"sidebar_dropdown_menu"})):(pt.e({environment:o,store:n,spaceViewStore:r,userSettingsStore:d,transaction:e}),U.ed(o,{type:a}))})},disabled:!c,style:c?void 0:{cursor:"default"}}),t?s.a.pinFilled(h.unpinned):s.a.pin(h.pinned))})}var li=i.a.forwardRef((e,t)=>{const{store:n,timestamp:r,actorPointer:a,type:o}=e,s=ii(e,["store","timestamp","actorPointer","type"]),l=Object($r.a)(()=>n.getIcon(),[n]),c=Object($r.a)(()=>n.isEmptyPage(),[n]);return i.a.createElement(Pe.a,Object.assign({},s,{ref:t,title:i.a.createElement(k.a,{store:n}),icon:i.a.createElement(v.a,{disabled:!0,icon:l,isEmptyPage:c,size:19}),caption:i.a.createElement(ai,{actorPointer:a,store:n,timestamp:r}),right:i.a.createElement("div",{style:{display:"flex"}},i.a.createElement(oi,{store:n,type:o}),i.a.createElement(si,Object.assign({},e)))}))});function ci(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function di(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?ci(Object(n),!0).forEach((function(t){hi(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):ci(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function hi(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function pi(e){const{sections:t}=e,n=1===t.length;return t.map((t,r)=>{let{key:a,pages:o}=t;return{key:a,items:mi(di({},e,{pages:o})),render:e=>i.a.createElement(ke.a,Object.assign({},e,{topBorder:0!==r,title:n?void 0:ui(a)}))}})}function mi(e){const{environment:t,spaceStore:n,pages:r,visiblePageIds:a,closePopover:o,type:s,query:l,sortBy:d}=e,h=a.length;return r.map(r=>{let{blockId:p,timestamp:m,authorId:u,authorTable:g,index:b}=r;const f=c.a.createChildStore(n,{table:se.a,id:p}),y=u&&g?{table:g,id:u}:void 0,S=a.includes(p);return{key:p,action:e=>{let{event:n}=e;o(),X.h({environment:t,store:f,metaClick:n.metaKey}),t.device.isPhone&&pt.b(),U.Md(t,{type:s,sortBy:d,queryStringLength:l.length,selectedItemIndex:b})},render:t=>i.a.createElement(li,Object.assign({},t,e,{store:f,timestamp:m,actorPointer:y,isPinned:S,spaceId:n.id,pinnedAmount:h}))}})}function ui(e){switch(e){case"today":return i.a.createElement(M.a,{id:"sharedWithMePopover.todaySection.label",defaultMessage:"Today"});case"past-week":return i.a.createElement(M.a,{id:"sharedWithMePopover.pastWeekSection.label",defaultMessage:"Past week"});case"earlier":return i.a.createElement(M.a,{id:"sharedWithMePopover.earlierSection.label",defaultMessage:"Earlier"});default:throw tt.e(e)}}var gi=function(e){const t=Object(Xr.b)(),[n,r]=Object($r.b)(Yr.b);return i.a.createElement(Oe.a,{type:Oe.a.Type.Vertical,initialFocus:void 0,sections:pi(di({},e,{environment:t,closePopover:()=>{r(di({},n,{[e.type]:!1}))}}))})},bi=n(1465),fi=n(299);function yi(e){const{userSettingsStore:t,helpDocsHref:n}=e,r=Object(Xr.b)(),{WindowSizeStore:a}=r,o=Object(Xr.d)(),l=Object($r.a)(()=>t.getSettings().completed_enhanced_sidebar_intro,[t]),c=Object(ti.a)(e=>({banner:{boxShadow:"0 1px 0 ".concat(e.regularDividerColor),width:"100%",minHeight:52,paddingTop:o?16:14,paddingBottom:o?18:10,paddingLeft:o?a.getSafePaddingLeftCSS(18):a.getSafePaddingLeftCSS(16),paddingRight:o?a.getSafePaddingRightCSS(20):a.getSafePaddingRightCSS(12),backgroundColor:o?e.darkBannerBackground:e.sidebarSecondaryBackground,display:"flex",alignItems:"center",justifyContent:"space-between",position:"relative"},dismissButton:{backgroundColor:e.buttonBackground},learnMoreText:{color:e.mediumTextColor},learnMoreMobile:{marginTop:10,width:110}}),[a,o]);return l?null:i.a.createElement("div",{style:c.banner},i.a.createElement("div",{style:{display:"flex",flexDirection:"column",fontSize:o?14:12,lineHeight:o?"24px":"20px",marginLeft:o?22:20}},i.a.createElement("div",{style:{fontWeight:C.a.fontWeight.medium,position:"relative"}},i.a.createElement("div",{style:{position:"absolute",top:o?5:3,left:o?-22:-20}},s.a.pinFilled({width:10,opacity:"65%"})),i.a.createElement("div",null,i.a.createElement(M.a,{id:"enhancedSidebarFeatureTour.pinPages.primaryText",defaultMessage:"Organize your shared pages here"}))),i.a.createElement("div",null,i.a.createElement(M.a,{id:"enhancedSidebarFeatureTour.pinPages.secondaryText",defaultMessage:"Pin frequently visited pages to the sidebar"})),o?i.a.createElement(fi.a,{style:c.learnMoreMobile,onClick:e=>{e.preventDefault(),Object(X.i)({environment:r,url:n})}},i.a.createElement(M.a,{id:"enhancedSidebarFeatureTour.pinPages.actionButton",defaultMessage:"Learn more"})):i.a.createElement(S.a,{underline:!0,style:c.learnMoreText,inline:!0,external:!0,href:Object(_e.a)("guides.sharing")},i.a.createElement(M.a,{id:"enhancedSidebarFeatureTour.pinPages.actionText",defaultMessage:"Learn more"}))),i.a.createElement(Ar.a,{style:{position:"absolute",top:o?12:7,right:o?12:8},onClick:e=>{e.stopPropagation(),Yt.a({environment:r,userSettingsStore:t})}},s.a.closeThick({width:o?12:10,opacity:"65%"})))}function Si(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function vi(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Si(Object(n),!0).forEach((function(t){wi(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Si(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function wi(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}const Ei=Object(M.f)({searchPlaceholder:{id:"outlinerViewAllPopover.search.placeholder",defaultMessage:"Search for shared pages",description:"Search placeholder text in 'Shared' overflow popover menu"}});function Oi(e){const t=Object(Xr.a)(),{isMobile:n}=t,{isLoading:r,query:a,onInputChange:o}=e,l=Object(ti.a)(e=>({iconStyle:{width:14,height:14,marginRight:6,flexGrow:0,flexShrink:0,color:e.regularIconColor},headerContainer:{marginTop:n?0:14,backgroundColor:e.popoverBackground,borderBottom:"1px solid ".concat(e.regularDividerColor)},sortContainer:{margin:n?"4px 14px":"4px 14px 0"}}),[n]),[{currentUserSettingsStore:c}]=Object($r.b)(P.a);return i.a.createElement(i.a.Fragment,null,c&&i.a.createElement(yi,{userSettingsStore:c,helpDocsHref:Object(_e.a)("guides.sharing")}),i.a.createElement("div",{style:l.headerContainer},i.a.createElement(mt.a,{style:vi({},t.isAndroid&&{borderBottom:"none"}),left:i.a.createElement(ht.a,{show:r,showDelay:500,showHold:300,render:e=>e?i.a.createElement(V.a,{style:l.iconStyle}):s.a.searchThick(l.iconStyle)}),showClearButton:!0,placeholder:Ct.a.formatMessage(Ei.searchPlaceholder),focus:!t.isMobile||void 0,value:a,onChange:e=>{o(e.target.value)}}),i.a.createElement("div",{style:l.sortContainer},i.a.createElement(bi.a,{currentSortBy:e.sortBy,setSortBy:e.setSortBy,sortOptions:Ti}))))}function ki(){return i.a.createElement(ke.a,{topBorder:!0,disableDesktopPadding:!0},i.a.createElement(kt.a,{title:i.a.createElement(M.a,{defaultMessage:"Learn about shared pages",id:"sharedWithMePopover.learnMore.prompt",description:"Link to a guide to learn more about 'Shared with Me' in popover menu"}),href:Object(_e.a)("guides.sharing"),analyticsFrom:"sharing"}))}function Pi(){return i.a.createElement(Pt.a,{href:Object(_e.a)("guides.sharing"),analyticsFrom:"sharing"})}function Ci(e){const{pages:t,sortBy:n}=e,r=Zr(t,n);return 0===r.length?i.a.createElement(Mi,null):i.a.createElement(gi,Object.assign({},e,{sections:r}))}function Mi(){const e=Object(Xr.a)(),{isMobile:t}=e,n=Object(ti.a)(e=>({placeHolderStyle:{textAlign:"center",padding:"".concat(t?64:0,"px 20px 0"),display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",height:t?void 0:"100%",minHeight:t?void 0:200},iconStyle:{width:36,fill:e.lightIconColor},contentStyle:{fontSize:14,color:e.mediumTextColor,maxWidth:260}}),[t]),r=i.a.createElement(M.a,{defaultMessage:"No pages found",id:"outlinerViewAllPopover.search.noMatchesPrompt",description:"Message when 'View all' popover query results are empty"});return i.a.createElement("div",{style:n.placeHolderStyle},i.a.createElement("div",{style:{paddingBottom:12}},s.a.paperAirplane(n.iconStyle)),i.a.createElement("div",{style:vi({},n.contentStyle,{fontWeight:500})},r))}const Ti=[{key:Vr.Relevance,formattedName:i.a.createElement(M.a,{id:"sharedWithMePopover.sortOrder.relevance",defaultMessage:"Relevance"})},{key:Vr.LastEditedNewest,formattedName:i.a.createElement(M.a,{id:"sharedWithMePopover.sortOrder.lastEditedNewest",defaultMessage:"Last edited"})}];var ji=function(e){const t=Object(Xr.b)(),{device:n}=t,[r,a]=Object($r.b)(Yr.b),o=i.a.createElement(Oi,Object.assign({},e));let s;return s=n.isMobile?{menuType:Ce.b.MenuType.Modal,title:i.a.createElement(M.a,{defaultMessage:"Shared",id:"outlinerViewAllPopover.menu.header",description:"Label for mobile popover menu that displays overflow of shared pages"}),left:i.a.createElement(Pi,null),right:i.a.createElement(Mt.DoneMenuText,null),onClickRight:()=>{a(vi({},r,{[e.type]:!1}))},header:o}:{menuType:Ce.b.MenuType.Popup,width:400,header:o,footer:i.a.createElement(ki,null)},i.a.createElement(Ce.b,Object.assign({},s),i.a.createElement(Ci,Object.assign({},e,{pages:e.sharedPages})))},Ii=n(45),Bi=n(31),xi=n(337);function Ai(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function Li(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function Di(e){const{allSharedPages:t,query:n,intl:r}=e;return t.map(e=>{const t=e.getValue();if(!t)return;const i=t.last_edited_time||t.created_time;if(!i)return;const{id:a,last_edited_by_id:o,last_edited_by_table:s,created_by_id:l,created_by_table:c}=t;let d,h;return o&&s?(d=o,h=s):(d=l,h=c),function(e){const{block:t,query:n,getRecordValue:r,userTimeZone:i,intl:a}=e;if(!n)return!0;const o=t?qr.h({table:se.a,value:t,getRecordValue:r,userTimeZone:i,intl:a}):void 0;return!!o&&o.toLowerCase().indexOf(n.trim().toLowerCase())>=0}({block:t,query:n,getRecordValue:e.getRecordValue,userTimeZone:Gr.m,intl:r})?{blockId:a,timestamp:i,authorId:d,authorTable:h}:void 0}).filter(tt.a)}function Ri(e){const{sharedPageItems:t,sortBy:n,currentUserId:r}=e;switch(n){case Vr.Relevance:return xi.a.sortFrecencyHighToLow({items:t.map(e=>function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Ai(Object(n),!0).forEach((function(t){Li(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Ai(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}({},e,{id:e.blockId,score:e.timestamp})),now:Date.now(),currentUserId:r});case Vr.LastEditedNewest:return be.a.sortBy(t,e=>{let{timestamp:t}=e;return t}).reverse();default:return t}}var Fi=n(511),Wi=n(692);function Ui(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function Vi(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Ui(Object(n),!0).forEach((function(t){Ni(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Ui(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function Ni(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function _i(e){const{isPopoverOpen:t,isMobile:n,onClick:r,total:a,userSettingsStore:o}=e,s=Object(ti.a)(e=>({item:{background:t?e.buttonHoveredBackground:void 0,marginBottom:n?16:void 0},flexRow:{display:"flex",alignItems:"center",fontSize:n?16:12}}),[t,n]),l=Object($r.a)(()=>o.getSettings().completed_enhanced_sidebar_intro,[o]);return i.a.createElement(q.a,{mobileFeedback:n,onClick:r},i.a.createElement(E.a,{style:s.item,isMobile:n,disableMobileBorder:!0},i.a.createElement("div",{style:s.flexRow},i.a.createElement(M.a,{defaultMessage:"View all ({total})",id:"viewMoreOutlinerButton.label",description:"Label for popover menu that displays all pages for an overflowing section in the sidebar. The count represents total number of pages  (e.g. View all (8))",values:{total:a}}),!l&&i.a.createElement("div",{style:{marginLeft:8}},i.a.createElement(Fi.a,{margin:!1})))))}var Hi=function(e){const{isMobile:t,allSharedPages:n,type:r,originRef:a,userSettingsStore:o,spaceStore:s}=e,l=Object(Xr.b)(),c=Object(M.h)(),d=s.id,h=o.id,[p,m]=i.a.useState(void 0),[u,g]=Object($r.b)(Yr.b),b=Boolean(u[r]),[{status:f}]=Object(Wi.a)(async()=>{await Object(Dr.b)({environment:l,spaceId:d,userId:h})},[l,d,h],{debounce:vt.b,interval:b?30*Bi.e:5*Bi.d}),y=i.a.useCallback(()=>{g(e=>Vi({},e,{[r]:!0})),m(a.current?a.current.getBoundingClientRect():void 0),U.Nc(l,{type:r,from:t?"sidebar_mobile":"sidebar"})},[l,g,r,a,t]),S=i.a.useCallback(()=>{g(e=>Vi({},e,{[r]:!1}))},[g,r]),[v,w]=i.a.useState(""),E=i.a.useRef(void 0);i.a.useEffect(()=>(b?E.current&&(clearTimeout(E.current),E.current=void 0):E.current=setTimeout(()=>{w("")},2*Bi.d),()=>{E.current&&(clearTimeout(E.current),E.current=void 0)}),[b]);const O=i.a.useMemo(()=>function(e){const{spaceId:t,type:n}=e;return"".concat(t,"-").concat(n,"-outliner-sort")}({spaceId:d,type:r}),[d,r]),[k,P]=i.a.useState(()=>K.a.get({userId:h,key:O})||Vr.Relevance),C=Object($r.a)(()=>Di({allSharedPages:n,query:v,intl:c}),[n,v,c]),T=i.a.useMemo(()=>Ri({sharedPageItems:C,sortBy:k,currentUserId:h}),[C,k,h]);return i.a.createElement(Ii.c,{popupType:t?Ii.c.PopupType.SlideUp:Ii.c.PopupType.Popup,originRect:p,alignmentToOrigin:Ii.c.Alignment.Start,placementToOrigin:Ii.c.Placement.Right,originGap:0,isFullWidthOnMobile:!0,preventScaleTransition:!0,open:b,onDismiss:S,render:()=>i.a.createElement(ji,Object.assign({},e,{isLoading:"pending"===f,query:v,onInputChange:w,sortBy:k,setSortBy:e=>{K.a.set({userId:h,key:O,value:e}),P(e),U.Ee(l,{type:r,from:k,to:e})},sharedPages:T,allSharedPageIds:n.map(e=>{let{id:t}=e;return t})})),origin:i.a.createElement(_i,{isPopoverOpen:b,isMobile:t,onClick:y,total:n.length,userSettingsStore:o})})},zi=n(553);function qi(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function Gi(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?qi(Object(n),!0).forEach((function(t){Qi(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):qi(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function Qi(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}class Ki extends a.a{constructor(){super(...arguments),this.sidebarState=this.createComputedStore(()=>Object(je.i)(this.environment)),this.storeTypes={scrollerStore:vn.a},this.handleScrollerMount=e=>{wn.a.SidebarMobileScroller=e},this.handleCloseSidebar=()=>{pt.b()},this.handleClickFind=()=>me.c({environment:this.environment,analyticsFrom:"sidebar-mobile"}),this.handleOrientationChange=()=>{pt.b()},this.isScrolledToTop=this.createComputedStore(()=>0===this.stores.scrollerStore.state.scrollTop),this.currentOfflinePages=this.createComputedStore(()=>_r.a.getCurrentOfflinePagesStore()),this.isCurrentIAPSubscriber=()=>{const{currentUserRootStore:e}=P.a.state,t=Object(Ne.b)({environment:this.environment,userRootStore:e});return!(!t||!t.includes(ye.a.revenueCat.productIDs.personal.monthly)&&!t.includes(ye.a.revenueCat.productIDs.personal.yearly))}}willMount(){window.addEventListener("resize",this.handleOrientationChange)}willUnmount(){window.removeEventListener("resize",this.handleOrientationChange)}renderComponent(){const e=bn.a(this.environment);return e?i.a.createElement(On.a,{render:()=>i.a.createElement("div",{className:ae.fb,style:this.getWrapStyle()},!e&&i.a.createElement(yn,null),this.renderSidebar()),isVisible:!0,animationStyle:{width:e?bn.b(this.environment):"100vw"}}):i.a.createElement("div",{className:ae.fb,style:Gi({},this.getWrapStyle(),{width:"100vw"})},!e&&i.a.createElement(yn,null),this.renderSidebar())}renderSidebar(){return i.a.createElement(pn.a,{capture:!bn.a(this.environment)&&un.b.get(),onBackButton:this.handleCloseSidebar},i.a.createElement("div",{style:this.getStyle()},this.renderTopbar(),this.renderOutliner()))}renderTopbar(){const{device:e}=this.environment,t=e.isReactNative&&e.isTablet&&bn.a(this.environment);return i.a.createElement("div",{style:this.getTopbarStyle()},i.a.createElement(Nr,{shouldShowUnexpandButton:t,format:jr.Mobile,onSpaceClick:async e=>{let{event:t,spaceViewStore:n}=e;await Mn.o({environment:this.environment,spaceViewStore:n,userSettingsStore:P.a.state.currentUserSettingsStore,userRootStore:P.a.state.currentUserRootStore,metaClick:t.ctrlKey||t.metaKey})}}),!e.isReactNative&&i.a.createElement(q.a,{onClick:this.handleClickFind,mobileFeedback:!0,style:Ki.actionButtonStyle},s.a.mobileBottomBarSearch({width:26})))}renderOutliner(){const{currentSpaceStore:e,currentSpaceViewStore:t,currentUserRootStore:n,currentUserStore:r,currentUserSettingsStore:a,currentBlockStore:o}=P.a.state,s=this.sidebarState.state;if(!(s&&o&&t&&n&&e&&r&&a))return;const l=e.canEdit(),c=Object(zi.b)({environment:this.environment})&&"personal_free"===Object(Ne.i)(this.environment)&&Jt.a.state.data&&"unsubscribed_admin"===Jt.a.state.data.type&&Jt.a.state.data.revenueCatEnabled&&!this.isCurrentIAPSubscriber();return i.a.createElement(Nt.a,{store:e,disableEditNearestBlock:!0,render:n=>i.a.createElement(ue.b,{store:this.stores.scrollerStore,ref:this.handleScrollerMount,style:Ki.outlinerStyle,disableScroll:_t.e(this.environment),type:ue.a.Y},s.showOfflineSection&&i.a.createElement(ot,{isMobile:!0,type:"offline",spaceStore:e,spaceViewStore:t,showAddPageButton:!1,renderSidebar:()=>i.a.createElement(pe,{isMobile:!0,type:"offline",isTopLevel:!0,spaceStore:e,spaceViewStore:t,childStores:this.currentOfflinePages.state,showAddPageButton:!1,onNavigate:this.handleCloseSidebar,onCreatePage:this.handleCloseSidebar,disabled:!l})}),s.showBookmarksSection&&i.a.createElement(ot,{isMobile:!0,type:"bookmarks",spaceStore:e,spaceViewStore:t,showAddPageButton:!1,renderSidebar:()=>i.a.createElement(pe,{isMobile:!0,type:"bookmarks",isTopLevel:!0,spaceStore:e,spaceViewStore:t,parentStore:t.getBookmarkedPagesStore(),childStores:t.getBookmarkedPages(),showAddPageButton:!1,onNavigate:this.handleCloseSidebar,onCreatePage:this.handleCloseSidebar,disabled:!l})}),s.showWorkspaceSection&&i.a.createElement(ot,{isMobile:!0,type:"workspace",spaceStore:e,spaceViewStore:t,showAddPageButton:!1,renderSidebar:()=>i.a.createElement(pe,{isMobile:!0,type:"workspace",isTopLevel:!0,spaceStore:e,spaceViewStore:t,parentStore:e.getPagesStore(),childStores:t.getWorkspacePages(),addPageTitle:i.a.createElement(M.a,{defaultMessage:"Add a page",id:"sidebarMobile.addPageToWorkspace.title"}),onNavigate:this.handleCloseSidebar,onCreatePage:this.handleCloseSidebar,showAddPageButton:!0,disabled:!l})}),s.showSharedSection&&i.a.createElement(ot,{isMobile:!0,type:"shared",spaceStore:e,spaceViewStore:t,showAddPageButton:!1,renderSidebar:n=>i.a.createElement(i.a.Fragment,null,i.a.createElement(pe,{isMobile:!0,type:"shared",isTopLevel:!0,spaceStore:e,spaceViewStore:t,parentStore:t.getSharedPagesStore(),childStores:s.visibleSharedPagesStores,showAddPageButton:!1,onNavigate:this.handleCloseSidebar,onCreatePage:this.handleCloseSidebar,disabled:!l}),this.isEnhancedSidebarEnabled&&s.showSharedOverflowButton&&i.a.createElement(Hi,{originRef:n,isMobile:!0,type:"shared",spaceStore:e,spaceViewStore:t,userSettingsStore:a,allSharedPages:s.allSharedPagesStores,visiblePageIds:s.visibleSharedPagesStores.map(e=>{let{id:t}=e;return t})}))}),s.showPrivateSection&&!s.showOnlyPrivateSection&&i.a.createElement(ot,{isMobile:!0,type:"private",spaceStore:e,spaceViewStore:t,showAddPageButton:!1,renderSidebar:()=>i.a.createElement(pe,{isMobile:!0,type:"private",isTopLevel:!0,spaceStore:e,spaceViewStore:t,parentStore:e.getPagesStore(),childStores:t.getPrivatePages(),addPageTitle:i.a.createElement(M.a,{defaultMessage:"Add a page",id:"sidebarMobile.addAPrivatePage.title"}),showAddPageButton:!0,onNavigate:this.handleCloseSidebar,onCreatePage:this.handleCloseSidebar,disabled:!l})}),s.showOnlyPrivateSection&&i.a.createElement(pe,{isMobile:!0,type:"private",isTopLevel:!0,spaceStore:e,spaceViewStore:t,parentStore:e.getPagesStore(),childStores:t.getPrivatePages(),addPageTitle:i.a.createElement(M.a,{defaultMessage:"Add a page",id:"sidebarMobile.addAPageToOnlyPrivateSection.title"}),showAddPageButton:!0,onNavigate:this.handleCloseSidebar,onCreatePage:this.handleCloseSidebar,disabled:!l}),s.showOnlyPrivateSection&&i.a.createElement("div",{style:{height:20}}),i.a.createElement(hn,{store:e}),i.a.createElement(rn,{isMobile:!0}),e.canEdit()&&i.a.createElement(Vt,{store:o,isMobile:!0}),c&&i.a.createElement(sn,null),i.a.createElement(Je,{isMobile:!0}),i.a.createElement("div",{style:{height:128}}))})}get isEnhancedSidebarEnabled(){return"on"===Ve.a.getGroup(this.environment,"sidebar-enhancements")}getWrapStyle(){return bn.a(this.environment)?{display:"block",height:"100vh",position:"relative",zIndex:3}:bn.g(this.environment)?{display:"block",height:"100vh",position:"fixed",top:0,right:"100%",zIndex:3}:{display:"block",height:"100vh",position:"fixed",top:0,left:0}}getStyle(){return Gi({display:"flex",flexDirection:"column",width:bn.c(this.environment),height:"100%",background:bn.g(this.environment)?this.theme.mobileSidebarAndroidBackground:this.theme.mobileSidebarIOSBackground,willChange:"transform",color:this.theme.mediumTextColor},bn.g(this.environment)&&{marginLeft:"auto"},{},bn.a(this.environment)&&{position:"absolute",right:0},{cursor:"pointer"})}getTopbarStyle(){const{WindowSizeStore:e}=this.environment;return{display:"flex",alignItems:"center",justifyContent:"space-between",flex:"none",height:kn.b,marginTop:e.state.paddingTopCSS,paddingLeft:12,boxShadow:bn.g(this.environment)&&!bn.a(this.environment)&&un.b.state?this.isScrolledToTop.state?this.theme.topbarAndroidShadowCollapsed:this.theme.topbarAndroidShadow:"0 1px 0 ".concat(this.theme.darkDividerColor),background:bn.g(this.environment)?this.theme.androidSidebarBackground:En.f.transparent,transition:"box-shadow 300ms",width:"100%",zIndex:1}}}Ki.outlinerStyle={flexGrow:1,paddingTop:12,userSelect:"none",WebkitUserSelect:"none"},Ki.actionButtonStyle={display:"flex",alignItems:"center",justifyContent:"center",flex:"none",height:"100%",width:44,paddingRight:6};t.default=Ki},1113:function(e,t,n){"use strict";n.r(t);n(15),n(11);var r=n(0),i=n.n(r),a=n(2),o=n.n(a),s=n(8),l=n(394),c=n(341),d=n(339),h=n(99),p=n(25),m=n(14),u=n(23),g=n(175),b=n(16);class f extends b.a{getInitialState(){return{isOpen:!1,isInsertOpen:!1,isTurnIntoOpen:!1,isColorOpen:!1,isTemplatesOpen:!1}}}var y=f,S=n(344),v=n(22),w=n(3),E=n(1452),O=n(1453),k=n(1458),P=n(749),C=n(395),M=n(250),T=n(12),j=n(280),I=n(83),B=n(33);var x=n(48),A=n(174),L=n(222),D=n(45),R=n(98),F=n(363),W=n(74),U=n(30),V=n(279),N=n(462),_=n(330),H=n(320),z=n(188),q=n(34),G=n(1460),Q=n(590),K=n(140),Z=n(9),X=n(122),Y=n(1),J=n(17),$=n(245),ee=n(55),te=n(453),ne=n(468),re=n(444),ie=n(412),ae=n(84),oe=n(24),se=n(94),le=n(1454),ce=n(42),de=n(1466),he=n(1012),pe=n(553);function me(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function ue(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?me(Object(n),!0).forEach((function(t){ge(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):me(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function ge(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}class be extends w.a{constructor(){super(...arguments),this.storeTypes={store:y,ignoreSelectionAreaStore:Q.a,templatePickerMenuListStore:$.a},this.renderMobileTemplatePreviewItem=e=>({key:e.name,render:t=>i.a.createElement(re.a,Object.assign({},t,{key:e.name,title:e.name,type:"page_template",format:"phone-modal",emoji:e.emoji,locked:!1})),action:()=>{ie.h({environment:this.environment,item:e,createNewPage:!1,isPrivate:!1})}}),this.renderPageTemplatePickerItem=e=>{const t=this.props.currentBlockStore;return{key:e.name,render:t=>i.a.createElement(re.a,Object.assign({},t,{key:e.name,format:"phone-modal",title:e.name,type:e.type,icon:e.icon,locked:!1})),action:n=>{t&&Object(ae.j)(this.environment)&&(m.Pd(this.environment,{name:e.name,is_keyboard:"keydown"===n.event.type}),e.onClick(this.environment,t))}}},this.handleScrollerRef=e=>{e&&(this.scrollerDiv=e)},this.handleCloseColorPopup=()=>{this.stores.store.setState(ue({},this.stores.store.state,{isColorOpen:!1}))},this.handleCloseInsertPopup=()=>{this.stores.store.setState(ue({},this.stores.store.state,{isInsertOpen:!1}))},this.handleCloseTurnIntoPopup=()=>{this.stores.store.setState(ue({},this.stores.store.state,{isTurnIntoOpen:!1}))},this.handleCloseTemplatesPopup=()=>{this.stores.store.setState(ue({},this.stores.store.state,{isTemplatesOpen:!1}))},this.handleUnindent=e=>{if("editing"!==U.a.state.mode)return;const t=U.a.state.store,n=Object(X.c)(t);n&&(T.d(this.environment,e=>{W.t({environment:this.environment,store:t,closestSelectable:n,shiftKey:!0,transaction:e})}),this.trackItemTap("unindent"))},this.handleIndent=e=>{if("editing"!==U.a.state.mode)return;const t=U.a.state.store,n=Object(X.c)(t);n&&(T.d(this.environment,e=>{W.t({environment:this.environment,store:t,closestSelectable:n,shiftKey:!1,transaction:e})}),this.trackItemTap("indent"))},this.handleMoveUp=e=>{if("editing"!==U.a.state.mode)return;const t=U.a.state.store,n=Object(X.c)(t);n&&(T.d(this.environment,e=>{W.q({environment:this.environment,store:t,closestSelectable:n,transaction:e})}),this.trackItemTap("move-up"))},this.handleMoveDown=e=>{if("editing"!==U.a.state.mode)return;const t=U.a.state.store,n=Object(X.c)(t);n&&(T.d(this.environment,e=>{W.p({environment:this.environment,store:t,closestSelectable:n,transaction:e})}),this.trackItemTap("move-down"))},this.handleUndo=()=>{d.f(this.environment),this.trackItemTap("undo")},this.handleRedo=()=>{d.e(this.environment),this.trackItemTap("redo")},this.handleDismissKeyboard=e=>{p.e(this.environment),this.handleCloseInsertPopup(),this.trackItemTap("hide_keyboard"),x.e()},this.handleInsert=e=>{this.stores.store.setState(ue({},this.stores.store.state,{isInsertOpen:!0})),this.trackItemTap("insert")},this.handleTakePicture=e=>{!async function(e){const t=await M.b({multiple:!0,accept:e.device.isIOS?"image/*, video/*":"image/*"}),n=B.b.getCurrentRecordCache(),r=I.b(e);0!==t.length&&n&&T.d(e,i=>{const a=j.a({environment:e,files:t,inMemoryRecordCache:n,pageWidth:r,transaction:i});h.k({environment:e,blocks:a,selection:B.b.state.stores,transaction:i}),p.e(e)})}(this.environment),this.trackItemTap("take_picture")},this.handleMention=e=>{F.e(this.environment,{page:!0,createPage:!0,user:!0,bot:!0,date:!0,reminder:!0}),this.trackItemTap("mention")},this.handleComment=e=>{const t=B.b.state.stores[0];t&&(l.d({environment:this.environment,blockStore:t}),this.trackItemTap("discuss"))},this.handleDelete=e=>{const t=B.b.state.stores[0],n=U.a.state;if(t&&"editing"===n.mode){const e=n.store,r=Object(K.g)(e)||Object(K.h)(e);if(T.d(this.environment,e=>{h.n({store:t,transaction:e})}),r){const e=Object(X.c)(r);p.f({environment:this.environment,store:e}),p.g(this.environment)}else p.e(this.environment);this.trackItemTap("remove")}},this.handleActionsScroll=()=>{m.d(this.environment)},this.handleActionsScrollDebounced=o.a.debounce(this.handleActionsScroll,500),this.handleMoreClick=e=>{p.q({environment:this.environment,stores:B.b.state.stores}),L.c({environment:this.environment,stores:B.b.state.stores,actions:g.c,left:e.clientX,top:e.clientY,showInput:!1,analyticsFrom:"mobile_more_menu"})},this.listenForPositionChanges=this.createComputedStore(()=>{const e=U.a.state;return"editing"===e.mode?{scrollTop:N.a.state.scrollTop,editing:!0,store:e.store.id,selection:e.selection.endIndex}:{scrollTop:N.a.state.scrollTop,editing:!1}}),this.shouldShow=this.createComputedStore(()=>{const{device:e}=this.environment;if(!e.isMobile)return!1;if(H.a.state.open)return!1;if(_.a.state.isOpen)return!1;if(!e.isReactNative&&z.a.state.open)return!1;if(U.a.isEditingComment())return!1;if(this.stores.ignoreSelectionAreaStore.state.savedTextSelectionStoreState&&"editing"===this.stores.ignoreSelectionAreaStore.state.savedTextSelectionStoreState.mode)return!0;if("editing"!==U.a.state.mode)return!1;const t=V.a.findEditableWithStore(U.a.state.store);return(!t||!t.props.disableMobileActionBar)&&!!Object(Z.C)()}),this.shouldShowTextActions=this.createComputedStore(()=>{const e=U.a.state;if("editing"===e.mode){const t=e.selection;if(t)return t.startIndex!==t.endIndex}const t=this.stores.ignoreSelectionAreaStore.state.savedTextSelectionStoreState;if(t&&"editing"===t.mode){const e=t.selection;if(e)return e.startIndex!==e.endIndex}return!1}),this.shouldShowBlockActions=this.createComputedStore(()=>!this.shouldShowTextActions.state),this.canTriggerBlockActions=this.createComputedStore(()=>{if(!this.shouldShowBlockActions.state)return!1;const e=this.pageContext&&this.pageContext.publicEditModeStore.state;if(e&&"edit"!==e)return!1;const{stores:t}=B.b.state;return t.length>0&&t[0].canEdit()&&!t[0].isNavigableBlock()}),this.canTriggerTextActions=this.createComputedStore(()=>{const e=this.pageContext&&this.pageContext.publicEditModeStore.state;return(!e||"edit"===e)&&this.props.currentBlockStore.canEdit()})}willMountOrUpdate(){const{device:e}=this.environment;if(e.isMobileBrowser){const e=this.shouldShow.state,t=this.stores.store.state.isOpen;e?t?void 0!==this.currentlyShownTimer&&(window.clearTimeout(this.currentlyShownTimer),this.currentlyShownTimer=void 0):(this.stores.store.setState(ue({},this.stores.store.state,{isOpen:!0})),this.scrollerDiv&&(this.scrollerDiv.scrollLeft=0)):t&&void 0===this.currentlyShownTimer&&(this.currentlyShownTimer=window.setTimeout(()=>{this.currentlyShownTimer=void 0,this.stores.store.setState(ue({},this.stores.store.state,{isOpen:!1}))},200))}else this.scrollerDiv&&(this.scrollerDiv.scrollLeft=0)}renderComponent(){const{device:e,WindowSizeStore:t}=this.environment,n=this.isOpen();return i.a.createElement(r.Fragment,null,i.a.createElement(C.a,{capture:!0,render:e=>i.a.createElement("div",Object.assign({},e,{style:{position:"relative",width:"100%",height:0,zIndex:A.g}}),this.renderActionBar(),this.renderInsertPopup(),this.renderTurnIntoPopup(),this.renderColorPopup(),this.renderTemplatesPopup())}),!n&&e.isIPhoneX&&e.isNative&&i.a.createElement("div",{style:{position:"absolute",bottom:0,background:"transparent",height:t.state.paddingBottomCSS,width:"100%",pointerEvents:"none",WebkitUserSelect:"none"}}))}renderActionBar(){const{device:e,WindowSizeStore:t}=this.environment,n=this.isOpen(),r=e.isMobile&&de.a.state;if(this.props.position===pe.a.Bottom)return i.a.createElement("div",{style:{position:"absolute",bottom:r?t.getSafePaddingBottomCSS(he.default.height):0,left:0,height:be.height,width:"100%",pointerEvents:n?"auto":"none",opacity:n?1:0,transform:n?"translateY(0)":"translateY(".concat(be.height,"px)"),transition:"opacity 120ms ease-out, transform 120ms ease-out"}},this.renderActionButtons());{const e=this.stores.ignoreSelectionAreaStore.state.savedTextSelectionRect||R.d();if(!e)return;const t=document.body.getBoundingClientRect(),r=ue({},e,{left:10,top:e.top+10-t.top});this.listenForPositionChanges.state;const{device:a}=this.environment;return i.a.createElement(D.c,{popupType:a.isReactNative?D.c.PopupType.SlideUp:D.c.PopupType.Popup,open:n,preventBlockRenderQueueOnEnter:!0,placementToOrigin:D.c.Placement.Bottom,alignmentToOrigin:D.c.Alignment.Start,originRect:r,disableMouseCapture:!0,keepFocus:!0,render:()=>i.a.createElement("div",{style:{height:be.height,width:"calc(80wv)",borderRadius:3,overflow:"hidden"}},this.renderActionButtons())})}}renderActionButtons(){const e=this.shouldShowTextActions.state,t=this.shouldShowBlockActions.state,n=this.shouldShowTemplatesButton();return i.a.createElement("div",{style:this.getActionButtonStyles()},n&&this.renderTemplatesButton(),!n&&t&&this.renderBlockActions(),!n&&e&&this.renderTextActions(),i.a.createElement(q.a,{mobileFeedback:!0,disabledFeedback:!0,style:ue({},this.getItemStyle(),{borderLeft:this.getItemBorder(),borderRight:"none"}),onClick:this.handleDismissKeyboard},be.keyboardIcon))}renderBlockActions(){const e=this.canTriggerBlockActions.state;let t=!1,n=!1;const r=this.props.currentBlockStore.getValue();r&&(Object(ce.A)(r)||(t=!0),Object(ce.B)(r)||(n=!0));const{device:a}=this.environment;return i.a.createElement("div",{ref:this.handleScrollerRef,style:this.getActionMenuStyle(),onScroll:this.handleActionsScrollDebounced},i.a.createElement(q.a,{mobileFeedback:!0,disabledFeedback:!0,style:ue({},this.getItemStyle(),{},!a.isSmallPhone&&{paddingLeft:12,paddingRight:12}),onClick:this.handleInsert,disabled:!e},be.plusIcon,this.renderChevronDown()),i.a.createElement(q.a,{mobileFeedback:!0,disabledFeedback:!0,style:ue({},this.getItemStyle(),{fontWeight:u.a.fontWeight.medium}),onClick:e=>{this.stores.store.setState(ue({},this.stores.store.state,{isTurnIntoOpen:!0})),this.trackItemTap("turn_into")},disabled:!e},i.a.createElement(Y.a,{defaultMessage:"Turn into",id:"mobileActionBar.turnInto.buttonTitle"}),this.renderChevronDown()),i.a.createElement(C.a,{capture:!0,render:e=>i.a.createElement(q.a,Object.assign({mobileFeedback:!0,disabledFeedback:!0},e,{style:this.getItemStyle(),onClick:this.handleMention,disabled:!n}),i.a.createElement("span",{style:{fontSize:19,lineHeight:1,fontWeight:u.a.fontWeight.medium,marginBottom:a.isAndroid?4:0}},"@"))}),i.a.createElement(q.a,{mobileFeedback:!0,disabledFeedback:!0,style:this.getItemStyle(),onClick:this.handleComment,disabled:!t},be.discussionIcon),i.a.createElement(q.a,{mobileFeedback:!0,disabledFeedback:!0,style:this.getItemStyle(),onClick:this.handleTakePicture,disabled:!e},be.imageIcon),i.a.createElement(q.a,{mobileFeedback:!0,disabledFeedback:!0,style:this.getItemStyle(),onClick:this.handleDelete,disabled:!e},be.trashIcon),this.renderBlockMovementActions(),this.renderBlockUndoActions(),i.a.createElement(q.a,{mobileFeedback:!0,disabledFeedback:!0,style:ue({},this.getItemStyle(),{fontWeight:u.a.fontWeight.medium}),onClick:e=>{this.stores.store.setState(ue({},this.stores.store.state,{isColorOpen:!0})),this.trackItemTap("color")},disabled:!e},i.a.createElement(Y.a,{defaultMessage:"Color",id:"mobileActionBar.color.buttonTitle"}),this.renderChevronDown()),i.a.createElement(q.a,{mobileFeedback:!0,disabledFeedback:!0,style:ue({},this.getItemStyle(),{fontWeight:u.a.fontWeight.medium}),onClick:this.handleMoreClick,disabled:!e},i.a.createElement(Y.a,{defaultMessage:"More",id:"mobileActionBar.more.buttonTitle"}),this.renderChevronDown()))}renderBlockMovementActions(){const e=this.canTriggerBlockActions.state,t=B.b.state.stores[0];return i.a.createElement("div",{style:ue({},this.getItemStyle(),{paddingLeft:6,paddingRight:6})},i.a.createElement(q.a,{mobileFeedback:!0,disabledFeedback:!0,style:be.minorItemStyle,disabled:!e||!c.b(t),onClick:this.handleUnindent},be.unindentIcon),i.a.createElement(q.a,{mobileFeedback:!0,disabledFeedback:!0,style:be.minorItemStyle,disabled:!e||!c.a(t),onClick:this.handleIndent},be.indentIcon),i.a.createElement(q.a,{mobileFeedback:!0,disabledFeedback:!0,style:be.minorItemStyle,disabled:!e,onClick:this.handleMoveUp},be.moveUpIcon),i.a.createElement(q.a,{mobileFeedback:!0,disabledFeedback:!0,style:be.minorItemStyle,disabled:!e,onClick:this.handleMoveDown},be.moveDownIcon))}renderBlockUndoActions(){return i.a.createElement("div",{style:ue({},this.getItemStyle(),{paddingLeft:6,paddingRight:6})},i.a.createElement(q.a,{mobileFeedback:!0,disabledFeedback:!0,style:be.minorItemStyle,disabled:!d.b(),onClick:this.handleUndo},be.undoIcon),i.a.createElement(q.a,{mobileFeedback:!0,disabledFeedback:!0,style:be.minorItemStyle,disabled:!d.a(),onClick:this.handleRedo},be.redoIcon))}renderTextActions(){const e=this.canTriggerTextActions.state,t=this.props.currentBlockStore.canComment();return i.a.createElement("div",{style:this.getActionMenuStyle(),onScroll:this.handleActionsScrollDebounced},i.a.createElement(k.a,{style:this.getItemStyle(),blockStore:B.b.state.stores[0],disabled:!t}),i.a.createElement(E.a,{type:"b",style:this.getItemStyle(),onClick:()=>this.trackItemTap("bold"),disabled:!e},i.a.createElement("span",{style:{fontWeight:u.a.fontWeight.semibold}},i.a.createElement(Y.a,{defaultMessage:"B",id:"mobileActionBar.bold.symbol",description:"Letter 'B' which represents 'bold' format option."}))),i.a.createElement(E.a,{type:"i",style:this.getItemStyle(),onClick:()=>this.trackItemTap("italic"),disabled:!e},i.a.createElement("span",{style:{fontStyle:"italic",fontWeight:u.a.fontWeight.semibold}},i.a.createElement(Y.a,{defaultMessage:"i",id:"mobileActionBar.italic.symbol",description:"Letter 'i' which represents 'italic' format option."}))),i.a.createElement(E.a,{type:"_",style:this.getItemStyle(),onClick:()=>this.trackItemTap("underline"),disabled:!e},i.a.createElement("span",{style:{textDecoration:"underline"}},i.a.createElement(Y.a,{defaultMessage:"U",id:"mobileActionBar.underline.symbol",description:"Letter 'U' which represents 'underline' format option."}))),i.a.createElement(E.a,{type:"s",style:this.getItemStyle(),onClick:()=>this.trackItemTap("strike_through"),disabled:!e},i.a.createElement("span",{style:{textDecoration:"line-through"}},i.a.createElement(Y.a,{defaultMessage:"S",id:"mobileActionBar.strikeThrough.symbol",description:"Letter 'S' which represents 'strike-through' format option."}))),i.a.createElement(E.a,{type:"c",style:this.getItemStyle(),onClick:()=>this.trackItemTap("code"),disabled:!e},i.a.createElement("span",{style:{fontFamily:u.a.fontFamily.githubMono}},i.a.createElement(Y.a,{defaultMessage:"Code",id:"mobileActionBar.code.symbol",description:"Word 'code' which represents 'code' format option."}))),i.a.createElement(O.a,{style:this.getItemStyle(),disabled:!e},i.a.createElement("span",{style:{borderBottom:"1px solid ".concat(this.theme.linkDecorationColor)}},i.a.createElement(Y.a,{defaultMessage:"Link",id:"mobileActionBar.link.symbol",description:"Word 'link' which represents 'link' format option."}))),i.a.createElement(le.a,{onClick:()=>this.trackItemTap("equation"),disabled:!e,style:this.getItemStyle()},s.a.equation({width:16,height:16})),i.a.createElement(G.a,{style:this.getItemStyle(),ignoreSelectionAreaStore:this.stores.ignoreSelectionAreaStore,disabled:!e}))}renderTemplatesButton(){return i.a.createElement("div",{style:this.getActionMenuStyle()},i.a.createElement(q.a,{mobileFeedback:!0,disabledFeedback:!0,style:ue({},this.getItemStyle(),{borderRight:"none",fontWeight:u.a.fontWeight.medium}),onClick:e=>{this.stores.store.setState(ue({},this.stores.store.state,{isTemplatesOpen:!0})),this.trackItemTap("templates")}},s.a.templatesColor({width:20,marginRight:8}),i.a.createElement(Y.a,{defaultMessage:"Choose a template...",id:"mobileActionBar.templates.buttonTitle"}),this.renderChevronDown()))}renderInsertPopup(){const{device:e}=this.environment;return i.a.createElement(P.a,{capture:this.stores.store.state.isInsertOpen,ignoreBlockSelection:!1,focusOffscreenInput:!1,restoreSelection:!1,render:t=>i.a.createElement(D.c,{popupType:e.isMobile?D.c.PopupType.SlideUp:D.c.PopupType.Popup,preventBlockRenderQueueOnEnter:!0,open:this.stores.store.state.isInsertOpen,keepFocus:!0,onDismiss:()=>{t(),this.handleCloseInsertPopup()},render:()=>i.a.createElement(v.b,{menuType:v.b.MenuType.Modal,title:i.a.createElement(Y.a,{defaultMessage:"Insert block",id:"mobileActionBar.insertBlock.modalTitle"}),right:i.a.createElement(se.CancelMenuText,null),onClickRight:()=>{t(),this.handleCloseInsertPopup()}},i.a.createElement(S.a,{sections:g.i,context:{environment:this.environment,blocks:B.b.state.stores},onAccept:this.handleCloseInsertPopup}))})})}renderTurnIntoPopup(){const{device:e}=this.environment;return i.a.createElement(P.a,{capture:this.stores.store.state.isTurnIntoOpen,ignoreBlockSelection:!1,focusOffscreenInput:!1,restoreSelection:!0,render:()=>i.a.createElement(D.c,{popupType:e.isMobile?D.c.PopupType.SlideUp:D.c.PopupType.Popup,open:this.stores.store.state.isTurnIntoOpen,keepFocus:!0,onDismiss:this.handleCloseTurnIntoPopup,preventBlockRenderQueueOnEnter:!0,render:()=>i.a.createElement(v.b,{menuType:v.b.MenuType.Modal,title:i.a.createElement(Y.a,{defaultMessage:"Turn into",id:"mobileActionBar.turnInto.modalTitle"}),right:i.a.createElement(se.CancelMenuText,null),onClickRight:this.handleCloseTurnIntoPopup},i.a.createElement(S.a,{sections:[ue({},g.r,{title:""})],context:{environment:this.environment,blocks:B.b.state.stores},onAccept:this.handleCloseTurnIntoPopup}))})})}renderColorPopup(){const{device:e}=this.environment;return i.a.createElement(P.a,{capture:this.stores.store.state.isColorOpen,ignoreBlockSelection:!1,focusOffscreenInput:!1,restoreSelection:!0,render:()=>i.a.createElement(D.c,{popupType:e.isMobile?D.c.PopupType.SlideUp:D.c.PopupType.Popup,open:this.stores.store.state.isColorOpen,keepFocus:!0,onDismiss:this.handleCloseColorPopup,preventBlockRenderQueueOnEnter:!0,render:()=>i.a.createElement(v.b,{menuType:v.b.MenuType.Modal,title:i.a.createElement(Y.a,{defaultMessage:"Block color",id:"mobileActionBar.blockColor.modalTitle"}),right:i.a.createElement(se.CancelMenuText,null),onClickRight:this.handleCloseColorPopup},i.a.createElement(S.a,{sections:[g.p,g.o,g.b],context:{environment:this.environment,blocks:B.b.state.stores},onAccept:this.handleCloseColorPopup}))})})}renderTemplatesPopup(){const{device:e}=this.environment;return i.a.createElement(P.a,{capture:this.stores.store.state.isTemplatesOpen,ignoreBlockSelection:!1,focusOffscreenInput:!1,restoreSelection:!1,render:()=>i.a.createElement(D.c,{popupType:e.isMobile?D.c.PopupType.SlideUp:D.c.PopupType.Popup,open:this.stores.store.state.isTemplatesOpen,keepFocus:!0,render:()=>i.a.createElement(v.b,{menuType:v.b.MenuType.Modal,title:i.a.createElement(Y.a,{defaultMessage:"Templates",id:"mobileActionBar.templates.modalTitle"}),right:i.a.createElement(se.CancelMenuText,null),onClickRight:this.handleCloseTemplatesPopup},i.a.createElement(ee.a,{type:ee.a.Type.Vertical,store:this.stores.templatePickerMenuListStore,initialFocus:void 0,disableInitialScroll:!0,disableCommandEnter:!0,onAccept:this.handleCloseTemplatesPopup,sections:[{key:"Basic",render:e=>i.a.createElement(oe.a,null,e.children),items:te.e.map(this.renderPageTemplatePickerItem)},{key:"Database",render:e=>i.a.createElement(oe.a,{title:i.a.createElement(Y.a,{defaultMessage:"Database",id:"mobileActionBar.databaseSection.title"})},e.children),items:te.a.filter(e=>e.shouldShow(this.environment)).map(this.renderPageTemplatePickerItem)},...ne.a(this.environment,this.props.intl).map(e=>({key:e.name,render:t=>i.a.createElement(oe.a,{title:e.name,key:e.name},t.children),items:e.items.map(this.renderMobileTemplatePreviewItem)}))]}))})})}renderChevronDown(){return s.a.chevronDown({width:10,marginLeft:4,fill:this.theme.lightIconColor})}isOpen(){const{device:e}=this.environment;return e.isMobileBrowser?this.stores.store.state.isOpen:this.shouldShow.state}trackItemTap(e){m.fe(this.environment,{itemName:e})}shouldShowTemplatesButton(){const{isPhone:e}=this.environment.device,t=this.props.currentBlockStore,n=J.a.state.currentLoadingContainerStore,r=Boolean(t&&t.isCollectionView()),i=Boolean(t&&t.getParentCollectionStore()),a=this.environment.currentUser.isLoggedIn();return Boolean(!i&&!r&&e&&t&&n&&t.hasValue()&&t.canEdit()&&0===t.getContentIds().length&&a&&n.state.ready)}getItemBorder(){return"1px solid ".concat(this.theme.regularDividerColor)}getActionButtonStyles(){const{device:e,WindowSizeStore:t}=this.environment;return{height:"100%",width:"100%",fontSize:15,display:"flex",boxShadow:this.props.position===pe.a.Bottom?this.theme.bottomActionBarShadow:this.theme.mediumBoxShadow,backgroundColor:this.theme.keyboardActionBarBackground,paddingLeft:e.isReactNative?t.state.paddingLeftCSS:0,paddingRight:e.isReactNative?t.state.paddingRightCSS:0}}getActionMenuStyle(){return{flexGrow:1,flexShrink:1,marginRight:-1,display:"flex",overflowX:"auto",overflowY:"hidden",WebkitOverflowScrolling:"touch"}}getItemStyle(){const{device:e}=this.environment;return{display:"flex",alignItems:"center",justifyContent:"center",paddingLeft:e.isSmallPhone?8:10,paddingRight:e.isSmallPhone?8:10,borderRight:this.getItemBorder(),whiteSpace:"nowrap",height:be.height,flexShrink:0,flexGrow:0,flexBasis:"auto",color:this.theme.regularTextColor,minWidth:e.isSmallPhone?42:44}}}be.unindentIcon=s.a.indentDown({width:18,height:18,transform:"rotate(90deg)",position:"relative",left:1}),be.indentIcon=s.a.indentDown({width:18,height:18,transform:"rotate(-90deg)",position:"relative",left:-1}),be.moveUpIcon=s.a.moveUp({width:18,height:18,position:"relative",left:2}),be.moveDownIcon=s.a.moveUp({width:18,height:18,transform:"rotate(180deg)",position:"relative",left:2}),be.undoIcon=s.a.undo({width:19,height:19}),be.redoIcon=s.a.redo({width:19,height:19}),be.trashIcon=s.a.trash({width:18,height:18}),be.discussionIcon=s.a.speechBubbleThin({width:18,height:18}),be.plusIcon=s.a.thinPlus({width:14,height:14}),be.keyboardIcon=s.a.keyboard({width:18,height:18}),be.imageIcon=s.a.image({width:18,height:18}),be.height=42,be.minorItemStyle={width:34,justifyContent:"center"};t.default=Object(Y.g)(be)},1114:function(e,t,n){"use strict";n.r(t);n(15),n(11);var r=n(0),i=n.n(r),a=n(69),o=n(3),s=n(8),l=n(16);class c extends l.a{getInitialState(){return{}}}var d=c,h=n(23),p=n(67),m=n(90),u=n(118),g=n(108),b=n(93),f=n(13),y=n(91),S=n(184),v=n(53),w=n(6);function E(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function O(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?E(Object(n),!0).forEach((function(t){k(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):E(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function k(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}class P extends o.a{constructor(){super(...arguments),this.renderProperty=e=>{const{schema:t,store:n,blockPropertyValueOverlayStore:r}=this.props;if(t[e])return i.a.createElement(b.b,{key:e,store:n,property:e,schema:t,disabled:!0,locked:!1,format:b.b.Format.Calendar,tableWrap:!1,blockPropertyValueOverlayStore:r})}}renderComponent(){const{time:e,store:t}=this.props,n=t.hasIcon()||!t.isEmptyPage(),a=Object(p.a)({store:t,fullyQualified:!1}),o=y.h(t);return i.a.createElement(S.a,{href:a},i.a.createElement(v.a,{focused:!1,title:i.a.createElement(r.Fragment,null,e&&i.a.createElement("div",{style:{display:"flex",color:this.theme.mediumTextColor,fontSize:14,marginTop:8,marginBottom:6}},e),i.a.createElement("div",{style:O({display:"flex",alignItems:"center"},e&&{marginBottom:8})},n&&i.a.createElement(m.a,{disabled:!0,icon:t.getIcon(),isEmptyPage:t.isEmptyPage(),size:24,style:{flexShrink:0,marginRight:8}}),i.a.createElement(u.a,{store:t,style:{fontWeight:h.a.fontWeight.semibold}}),o>0&&i.a.createElement("div",{style:{display:"flex",alignItems:"center",color:this.theme.regularDividerColor,fontSize:12,marginLeft:4,flexShrink:0}},s.a.speechBubble({width:12,height:12,marginRight:4,fill:this.theme.mediumIconColor}),o))),caption:this.renderProperties()}))}renderProperties(){const{format:e,schema:t,store:n}=this.props,r=(e.calendar_properties?e.calendar_properties.filter(e=>e.visible).map(e=>e.property):[]).filter(e=>g.e({blockValue:n.getValue(),property:e,schema:t,getRecordValue:n.getRecordValue,userTimeZone:f.m,intl:w.a.getIntl()}));if(r.length>0)return i.a.createElement("div",{style:{marginTop:8}},r.map(this.renderProperty))}}var C=P,M=n(27),T=n(183),j=n(39),I=n(255),B=n(342),x=n(12),A=n(22),L=n(24),D=n(317),R=n(512),F=n(155),W=n(151),U=n(41),V=n(83),N=n(205),_=n(165),H=n(1),z=n(94),q=n(10);function G(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function Q(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?G(Object(n),!0).forEach((function(t){K(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):G(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function K(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}class Z extends o.a{constructor(){var e;super(...arguments),e=this,this.storeTypes={store:d,requestStore:I.a},this.renderResults=function(t){let n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];const{requestStore:r}=e.stores,{disabled:a}=e.props,o=e.getCurrentStartOfDay(),l=o.clone().endOf("day");return i.a.createElement(A.b,{menuType:A.b.MenuType.Modal,title:i.a.createElement("div",{style:Z.headerStyle},i.a.createElement(W.a,{onClick:e.handleLeftClick,icon:s.a.chevronLeft,style:{marginRight:8,marginTop:2},mobileFeedback:!0}),i.a.createElement("div",null,o.format("MMMM Do")),i.a.createElement(W.a,{onClick:e.handleRightClick,icon:s.a.chevronRight,style:{marginLeft:8,marginTop:2},mobileFeedback:!0})),right:i.a.createElement(z.DoneMenuText,null),onClickRight:e.props.onDismiss},r.state.loading&&i.a.createElement(L.a,null,i.a.createElement(R.a,null)),!r.state.loading&&0===n.length&&i.a.createElement(L.a,null,i.a.createElement(F.a,{title:i.a.createElement(H.a,{defaultMessage:"No items",id:"mobileCalendarDayMenu.noResults.message"})})),!r.state.loading&&n.length>0&&i.a.createElement(L.a,null,n.map(t=>e.renderItem(t,o,l))),!a&&i.a.createElement(L.a,{topBorder:!0},i.a.createElement(D.a,{focused:!1,onClick:e.handleAddItemClick,title:i.a.createElement(H.a,{defaultMessage:"New item",id:"mobileCalendarDayMenu.newItemButton.label"})})))},this.handleLeftClick=()=>{const e=this.getCurrentStartOfDay();this.stores.store.setState(Q({},this.stores.store.state,{currentStartOfDay:e.clone().add(-1,"day").valueOf()}))},this.handleRightClick=()=>{const e=this.getCurrentStartOfDay();this.stores.store.setState(Q({},this.stores.store.state,{currentStartOfDay:e.clone().add(1,"day").valueOf()}))},this.handleAddItemClick=()=>{const{collectionViewLocalStore:e,collectionStore:t,calendarBy:n}=this.props,r=this.getCurrentStartOfDay(),i=x.d(this.environment,i=>B.e({environment:this.environment,collectionStore:t,collectionViewLocalStore:e,calendarBy:n,startOfDay:r.valueOf(),transaction:i})),a=Object(p.a)({store:i});this.navigate(a)},this.performRequest=async e=>{const{collectionStore:t,collectionViewStore:n,query:r}=this.props,i=Object(a.a)(e).endOf("day").valueOf(),o=await j.Kb(this.environment,{collectionId:t.id,collectionViewId:n.id,query:r,loader:{type:"calendar",dateRangeStart:e,dateRangeEnd:i,searchQuery:void 0,scale:"day",userTimeZone:f.m,startDayOfWeek:V.q.state}});if("failed"===o.type)throw o.error;return"calendar"===o.data.result.type?o.data.result.groups[0].items:[]}}navigate(e){this.context.overrideLinkClick?this.context.overrideLinkClick(e):U.f({environment:this.environment,url:e})}renderComponent(){const{requestStore:e}=this.stores;return i.a.createElement(T.a,{requestStore:e,request:this.getCurrentStartOfDay().valueOf(),performRequest:this.performRequest,render:this.renderResults})}renderItem(e,t,n){const{collectionStore:r,disabled:a,blockPropertyValueOverlayStore:o}=this.props,s=M.a.createChildStore(r,{table:q.a,id:e.id});return i.a.createElement(C,{key:e.id,store:s,time:e.includeTime?this.renderTime(e,t,n):void 0,disabled:a,format:this.props.format,schema:this.props.schema,blockPropertyValueOverlayStore:o})}renderTime(e,t,n){const{schema:r,calendarBy:i,intl:o}=this.props,s=r[i];if(!s||"date"!==s.type)return;const l=s.date_format||f.v,c=s.time_format||f.x,d=Object(a.a)(e.start),h=e.end?Object(a.a)(e.end):void 0,p=Boolean(!d.isBetween(t,n)&&h&&!h.isBetween(t,n));if(e.end){const t=f.s(e.start,e.end,e.timeZone);return p?Object(N.a)({value:t,date_format:l,time_format:c,userTimeZone:e.timeZone,allowRelativeDates:!0,intl:o}):Object(N.d)({start_time:t.start_time,end_time:t.end_time,time_format:c,humanReadable:!0,intl:o})}return Object(N.c)({start_time:f.r(e.start,e.timeZone).start_time,time_format:c,humanReadable:!0,intl:o})}getCurrentStartOfDay(){const{currentStartOfDay:e}=this.stores.store.state;return e?Object(a.a)(e):Object(a.a)(this.props.initialStartOfDay)}}Z.contextTypes=_.a,Z.headerStyle={display:"flex",alignItems:"center",height:"100%"};t.default=Object(H.g)(Z)},1466:function(e,t,n){"use strict";var r=n(178),i=n(770),a=n(320);t.a=new r.a(()=>{const{phase:e}=i.b.state;return!!a.a.state.open||(e===i.a.hidden||e===i.a.willHide)})},1633:function(e,t,n){"use strict";n(15),n(11);var r=n(0),i=n.n(r),a=n(159),o=n(47),s=n(3),l=n(1145),c=n(95),d=n(40),h=n(23),p=n(8),m=n(2),u=n.n(m),g=n(852),b=n(31),f=n(183),y=n(39),S=n(61),v=n(102),w=n(199),E=n(91),O=n(52),k=n(17),P=n(81),C=n(179),M=n(246),T=n(336),j=n(464),I=n(1);function B(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function x(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?B(Object(n),!0).forEach((function(t){A(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):B(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function A(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}const L={mentions:!0,following:!0,archive:!1};class D extends s.a{constructor(){super(...arguments),this.storeTypes={size:S.a.of(20),checkpoint:S.a.of(Math.random())},this.renderRequest=(e,t,n)=>{const r=k.a.state.currentSpaceStore;if(!r||e)return i.a.createElement("div",{style:this.getPlaceholderContentStyle()},i.a.createElement(I.a,{defaultMessage:"Something went wrong.",id:"notificationUpdates.unknownErrorMessage"}));if(!t)return i.a.createElement("div",{style:this.getContentStyle()},this.renderSpinner());const a=t.map(e=>Object(O.c)(r,{table:T.a,id:e})),o=u.a.compact(a.map(e=>{const t=e.getValue();if(!t)return;if(t.invalid)return;if(t.visited&&L[this.props.type]||!t.visited&&"archive"===this.props.type)return;const n=E.c(e);if(!n)return;const r=n.getValue();return r&&!r.invalid?{activity:r,notification:t}:void 0})),s=this.stores.size.get(),l=0===o.length;return j.a.setState(x({},j.a.state,{isCurrentTabEmpty:l})),i.a.createElement("div",{style:l?this.getPlaceholderContentStyle():this.getContentStyle()},l&&this.props.empty,i.a.createElement("div",{className:"notranslate"},o.map((e,t,n)=>{let{activity:a,notification:o}=e;const s=n.length-1===t;return i.a.createElement(g.a,{key:a.id,activity:a,rootStore:r,isLast:s,notification:o,analyticsContext:this.props.analyticsContext,isTopbarUpdatesMenu:!1,source:"notifications"})})),i.a.createElement(w.a,{onChange:e=>{e<200&&n&&t&&t.length>=s&&this.stores.size.set(t.length+20)}},!n&&this.renderSpinner(!0)))},this.handleActivityEmit=()=>{this.stores.checkpoint.set(Math.random())},this.handleActivityEmitThrottled=u.a.throttle(this.handleActivityEmit,1e3),this.handleNotificationEmit=b.g(this.handleActivityEmitThrottled)}willMount(){this.startMessageListeners()}willUnmount(){this.stopMessageListeners()}renderComponent(){return P.a.state.online?this.renderOnline():this.renderOffline()}renderOffline(){return i.a.createElement("div",{style:this.getPlaceholderContentStyle()},i.a.createElement("div",null,i.a.createElement(I.a,{defaultMessage:"Please go online to view updates.",id:"notificationUpdates.offline.message"})))}renderOnline(){const{currentUserStore:e,currentSpaceStore:t}=k.a.state;if(!e||!t)return;const n=t.id,r=this.stores.size.get(),a=this.stores.checkpoint.get(),o=this.props.type;return i.a.createElement(f.a,{throttle:1e3,request:{spaceId:n,size:r,type:o,checkpoint:a},performRequest:async e=>{let{spaceId:t,size:n,type:r}=e;const i=await y.R(this.environment,{spaceId:t,size:n,type:r});if("failed"===i.type)throw i.error;return i.data.notificationIds},render:this.renderRequest})}renderSpinner(e){return i.a.createElement("div",{style:this.getSpinnerStyle(e)},i.a.createElement(v.a,null))}startMessageListeners(){const{currentUserStore:e}=k.a.state;if(e){const t=Object(M.f)(e.id);this.notificationListenerReference=C.a.addListener(t,this.handleNotificationEmit,void 0)}}stopMessageListeners(){this.notificationListenerReference&&(C.a.removeListener(this.notificationListenerReference),this.notificationListenerReference=void 0)}getContentStyle(){const{device:e}=this.environment;return{minHeight:e.isMobile?void 0:"mentions"===this.props.type?void 0:"75vh",paddingBottom:e.isMobile?44:0}}getPlaceholderContentStyle(){const{device:e}=this.environment;return x({},this.getContentStyle(),{paddingTop:e.isMobile?64:void 0,minHeight:e.isMobile?void 0:220,display:"flex",textAlign:"center",alignItems:"center",justifyContent:"center",fontSize:14,color:this.theme.mediumTextColor,overflow:"hidden"})}getSpinnerStyle(e){return x({},this.getPlaceholderContentStyle(),{minHeight:e?64:220})}}var R,F=D,W=n(839),U=n(1248),V=n(22),N=n(350),_=n(14),H=n(42),z=n(855),q=n(1244),G=n(1363),Q=n(566),K=n(763),Z=n(105),X=n(300),Y=n(552),J=n(19),$=n(151),ee=n(34),te=n(68),ne=n(76),re=n(94),ie=n(161),ae=n(29),oe=n(220);function se(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function le(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?se(Object(n),!0).forEach((function(t){ce(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):se(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function ce(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}!function(e){e[e.Sidebar=0]="Sidebar",e[e.SidebarMobile=1]="SidebarMobile",e[e.MobileBottomBarPhone=2]="MobileBottomBarPhone",e[e.MobileBottomBarTablet=3]="MobileBottomBarTablet",e[e.TopbarMobile=4]="TopbarMobile"}(R||(R={}));class de extends s.a{constructor(){super(...arguments),this.renderSpaceUpdates=()=>{const{device:e}=this.environment;let t;return t=e.isMobile?{menuType:V.b.MenuType.Modal,title:i.a.createElement(I.a,{defaultMessage:"All Updates",id:"updatesModal.mobileMenu.title"}),right:i.a.createElement(re.DoneMenuText,null),onClickRight:this.closeMenu,left:p.a.settings({fill:J.f.blue,width:18,height:18}),onClickLeft:this.handleOpenSettings,header:this.renderHeader(),whiteBackground:!0,footer:this.renderFooter()}:{menuType:V.b.MenuType.Popup,header:this.renderHeader(),maxHeight:"80vh",height:"auto",footer:this.renderFooter()},i.a.createElement(G.a,{onSwipeLeft:this.handleSwipeLeft,onSwipeRight:this.handleSwipeRight,render:e=>i.a.createElement(V.b,Object.assign({},t,e,{className:te.Ab}),i.a.createElement(oe.a,{capture:!0,allowUndo:!0,allowEsc:!0,render:()=>this.renderContent()}))})},this.closeMenu=()=>{Q.a.setState(le({},Q.a.state,{open:!1})),this.setCurrentTabAsRead()},this.handleDismiss=()=>{this.setCurrentTabAsRead()},this.handleClick=()=>{this.handleTrackTab()},this.handleSwipeLeft=()=>{const e=this.tabs.indexOf(j.a.state.currentTab)+1,t=this.tabs[e];void 0!==t&&this.changeTab(t)},this.handleSwipeRight=()=>{const e=this.tabs.indexOf(j.a.state.currentTab)-1,t=this.tabs[e];void 0!==t&&this.changeTab(t)},this.handleTabClick=e=>{const t=this.tabs[e];j.a.state.currentTab!==t&&this.changeTab(t)},this.handleOpenSettings=()=>{const{device:e}=this.environment;_.Mc(this.environment),e.isMobile?K.a.setState({open:!0}):(Q.a.setState(le({},Q.a.state,{open:!1})),X.a.setState(le({},X.a.state,{currentTab:"notifications"})),X.a.setState(le({},X.a.state,{open:!0})))},this.handleArchiveAll=()=>{const e=j.a.state.currentTab;Object(j.b)(e)&&N.a(this.environment,e)},this.setCurrentTabAsRead=()=>{N.c(this.environment)}}willMount(){const e=Z.a.get(de.lastUpdatesTabKey);e&&this.tabs.includes(e)&&this.setTabState(e)}renderComponent(){const{device:e}=this.environment;return i.a.createElement(d.a,{renderTooltip:()=>i.a.createElement(I.a,{defaultMessage:"Updates for all pages in this space",id:"updatesButton.tooltip"}),originGap:6,placement:a.b.Right,render:t=>i.a.createElement(o.a,{popupType:e.isMobile?o.a.PopupType.SlideUp:o.a.PopupType.Popup,alignmentToOrigin:a.a.Start,placementToOrigin:a.b.Right,onClick:this.handleClick,originGap:0,style:le({},!e.isMobile&&{width:500,overflow:"hidden"}),isWideTabletWidth:!0,render:this.renderSpaceUpdates,onClose:this.handleDismiss,isFullWidthOnMobile:!0,preventScaleTransition:!0,buttonPopupStore:Q.a,renderOrigin:e=>this.renderButton(t,e)})})}renderButton(e,t){const n=this.props.format,r=Y.a.getUnreadCountForCurrentSpace(),a=r.mentions>0||r.following>0,o=Q.a.state.open,s=r.mentions;return n===R.MobileBottomBarPhone?i.a.createElement(ee.a,Object.assign({style:de.mobileBottomBarPhoneButtonStyle,mobileFeedback:!0},t),i.a.createElement("div",{style:{position:"relative"}},p.a.mobileBottomBarUpdates({width:26,fill:this.theme.regularTextColor}),i.a.createElement(U.a,{color:U.a.Color.Red,count:s,style:{position:"absolute",top:-3,right:s<99?-5:-8}}))):n===R.MobileBottomBarTablet?i.a.createElement(ee.a,Object.assign({style:de.mobileBottomBarTabletButtonStyle,mobileFeedback:!0},t),i.a.createElement("div",{style:{position:"relative"}},p.a.mobileBottomBarUpdates({width:26,fill:this.theme.regularTextColor}),i.a.createElement(U.a,{color:U.a.Color.Red,count:s,style:{position:"absolute",top:-3,right:s<99?-5:-8}}))):n===R.TopbarMobile?i.a.createElement(ee.a,Object.assign({style:le({},de.actionButtonStyle,{marginLeft:2,marginRight:2}),mobileFeedback:!0},t),p.a.mobileBottomBarUpdates({width:26}),i.a.createElement(U.a,{color:U.a.Color.Red,count:s,style:{position:"absolute",top:8,right:0}})):n===R.SidebarMobile?i.a.createElement(ee.a,Object.assign({style:de.actionButtonStyle,mobileFeedback:!0},t),p.a.mobileBottomBarUpdates({width:26}),i.a.createElement(U.a,{color:U.a.Color.Red,count:s,style:{position:"absolute",top:8,right:0}})):n===R.Sidebar?i.a.createElement(ee.a,Object.assign({style:le({},a&&{fontWeight:h.a.fontWeight.medium,color:this.theme.regularTextColor})},Object(c.a)(e,t)),i.a.createElement(l.a,{isMobile:!1,left:i.a.createElement("div",{style:{color:a?this.theme.regularTextColor:"inherit"}},p.a.typesCreatedAt({fill:a?this.theme.regularIconColor:this.theme.mediumIconColor,width:14})),right:i.a.createElement(U.a,{color:U.a.Color.Red,count:s,style:{marginBottom:2,marginLeft:6}}),style:{background:o?this.theme.buttonHoveredBackground:"none"}},i.a.createElement(I.a,{defaultMessage:"All Updates",id:"updatesButton.allUpdates.sidebarButton"}))):void 0}renderHeader(){const{device:e}=this.environment,{currentTab:t}=j.a.state,n=this.tabs.indexOf(t),a=Y.a.getUnreadCountForCurrentSpace(),o={mentions:i.a.createElement("div",{style:{display:"flex",alignItems:"center",justifyContent:"center",fontWeight:a.mentions>0?h.a.fontWeight.medium:void 0},className:te.zb},i.a.createElement("div",null,i.a.createElement(I.a,{defaultMessage:"Inbox",id:"updatesModal.mentionsTab.title"})),i.a.createElement(U.a,{color:U.a.Color.Red,count:a.mentions,style:{marginLeft:6},numberStyle:{marginBottom:e.isMobile?0:2}})),following:i.a.createElement("div",{style:{display:"flex",alignItems:"center",justifyContent:"center",fontWeight:a.following>0?h.a.fontWeight.medium:void 0}},i.a.createElement("div",null,i.a.createElement(I.a,{defaultMessage:"Following",id:"updatesModal.followedUpdatesTab.title"})),i.a.createElement(U.a,{color:U.a.Color.Gray,count:a.following,style:{marginLeft:6},numberStyle:{marginBottom:e.isMobile?0:2}})),allPages:i.a.createElement("div",{className:te.xb},i.a.createElement(I.a,{defaultMessage:"All",id:"updatesModal.allUpdatesTab.title"})),archive:i.a.createElement("div",{className:te.yb},i.a.createElement(I.a,{defaultMessage:"Archived",id:"updatesModal.archiveTab.title"})),currentPage:e.isMobile&&i.a.createElement("div",null,i.a.createElement(I.a,{defaultMessage:"This page",id:"updatesModal.mobielThisPage.title"}))};let s;if("currentPage"===j.a.state.currentTab){const{currentBlockStore:e}=k.a.state;e&&(s=i.a.createElement(z.a,{store:e}))}const l=this.tabs.map(e=>o[e]);return i.a.createElement(r.Fragment,null,i.a.createElement(q.a,{tabs:l,selectedIndex:n,onChange:this.handleTabClick,separatorIndexes:[this.tabs.indexOf("archive")-1],right:!e.isMobile&&this.renderNotificationSettingsButton()}),s)}renderNotificationSettingsButton(){return i.a.createElement(d.a,{renderTooltip:()=>i.a.createElement(I.a,{defaultMessage:"Open notifications settings",id:"updatesModal.openNotifications.tooltip"}),render:e=>i.a.createElement($.a,Object.assign({icon:p.a.sidebarSettings,onClick:this.handleOpenSettings},e))})}renderContent(){const e=j.a.state.currentTab;if("following"===e)return i.a.createElement(F,{key:"following",type:"following",empty:this.renderEmptyState(i.a.createElement(I.a,{defaultMessage:"Turn on “Follow this page” in the Updates menu on any page to receive updates here.",id:"updatesModal.followedUpdatesTab.allArchived"}),i.a.createElement(I.a,{defaultMessage:"No new updates",id:"updatesModal.followedUpdatesTab.allArchivedTitle"})),analyticsContext:"click_followed_pages"});if("allPages"===e){const{currentSpaceStore:e}=k.a.state;return e?i.a.createElement(W.a,{key:"all-pages",spaceId:e.id,empty:this.renderEmptyState(i.a.createElement(I.a,{defaultMessage:"Updates on pages in your workspace will appear here.",id:"updatesModal.allPagesTab.emptyPrompt"}),i.a.createElement(I.a,{defaultMessage:"No new updates",id:"updatesModal.allPagesTab.emptyPromptTitle"})),source:"all_updates",analyticsContext:"click_all_updates",isTopbarUpdatesMenu:!1}):null}if("mentions"===e)return i.a.createElement(F,{key:"mentions",type:"mentions",empty:this.renderEmptyState(Object(ie.f)(this.environment)?i.a.createElement(I.a,{defaultMessage:"When someone @mentions you, replies to your comments, sends you a request, or invites you to a page, you’ll be notified here.",id:"updatesModal.spaceUpdatesTab.allArchivedRequests"}):i.a.createElement(I.a,{defaultMessage:"When someone @mentions you, replies to your comments, or invites you to a page, you’ll be notified here.",id:"updatesModal.spaceUpdatesTab.allArchived"}),i.a.createElement(I.a,{defaultMessage:"You're all caught up",id:"updatesModal.spaceUpdatesTab.allArchivedTitle"})),analyticsContext:"click_comments_and_mentions"});if("archive"===e)return i.a.createElement(F,{key:"archive",type:"archive",empty:this.renderEmptyState(i.a.createElement(I.a,{defaultMessage:"Any Inbox updates you archived will show up here.",id:"updatesModal.arvhiveTab.emptyPrompt"}),i.a.createElement(I.a,{defaultMessage:"No archived updates",id:"updatesModal.arvhiveTab.emptyPromptTitle"})),analyticsContext:"click_followed_pages"});if("currentPage"===e){const{currentSpaceStore:e,currentBlockStore:t}=k.a.state;if(!e||!t)return null;const n=t.getValue(),r=n&&H.q(n)?n.collection_id:void 0;return i.a.createElement(W.a,{key:"current-page",navigableBlockId:t.id,collectionId:r,spaceId:e.id,empty:this.renderEmptyState(i.a.createElement(I.a,{defaultMessage:"Any changes to this page will show up here.",id:"updatesModal.currentPageTab.emptyPrompt"}),i.a.createElement(I.a,{defaultMessage:"No page updates",id:"updatesModal.currentPageTab.emptyPromptTitle"})),analyticsContext:"click_all_updates",isTopbarUpdatesMenu:!0,source:"notifications"})}Object(ae.e)(e)}renderEmptyState(e,t){const{device:n}=this.environment;return i.a.createElement("div",{style:{textAlign:"center",paddingLeft:20,paddingRight:20,paddingTop:n.isMobile?64:void 0,height:n.isMobile?void 0:"100%",display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",overflow:"hidden",minHeight:n.isMobile?void 0:220}},i.a.createElement("div",{style:{paddingBottom:12}},p.a.inbox({width:48,fill:this.theme.lightIconColor})),i.a.createElement("div",{style:{fontSize:14,fontWeight:500,color:this.theme.mediumTextColor,maxWidth:380}},t),i.a.createElement("div",{style:{fontSize:14,color:this.theme.mediumTextColor,marginTop:2,marginBottom:4,maxWidth:380}},e))}renderFooter(){const{currentTab:e,isCurrentTabEmpty:t}=j.a.state;if("mentions"!==e)return;if(t)return;const{device:n}=this.environment;return i.a.createElement("div",{style:this.getInboxActionsStyle()},i.a.createElement(ne.a,{onClick:this.handleArchiveAll,style:this.getArchiveButtonStyle(),mobileFeedback:n.isMobile},p.a.archive({width:n.isMobile?16:14,fill:"inherit",marginLeft:n.isMobile?6:0,marginRight:n.isMobile?8:6}),i.a.createElement(I.a,{defaultMessage:"Archive all",id:"updatesModal.spaceUpdatesTab.archiveAllButtonTitle"})))}setTabState(e){Z.a.get(de.lastUpdatesTabKey)!==e&&Z.a.set(de.lastUpdatesTabKey,e),j.a.state.currentTab!==e&&j.a.setState(le({},j.a.state,{currentTab:e}))}handleTrackTab(){let e;switch(j.a.state.currentTab){case"mentions":e="mentions_comments";break;case"following":e="followed_pages";break;default:e="all_updates"}_.zc(this.environment,{tab:e}),_.ge(this.environment,{itemName:"updates"})}changeTab(e){this.setCurrentTabAsRead(),this.setTabState(e),this.handleTrackTab()}get tabs(){return this.environment.device.isMobile?["mentions","following","allPages","currentPage","archive"]:["mentions","following","allPages","archive"]}getInboxActionsStyle(){const{device:e}=this.environment;return{display:"flex",alignItems:e.isMobile?"flex-start":"center",background:e.isMobile?this.theme.contentBackground:this.theme.sidebarBackground,boxShadow:"0 -1px 0 ".concat(this.theme.regularDividerColor),marginTop:1,position:e.isMobile?"relative":"sticky",left:0,right:0,bottom:0}}getArchiveButtonStyle(){const{device:e}=this.environment;return{paddingLeft:e.isMobile?0:14,paddingRight:e.isMobile?8:12,marginRight:"auto",width:"100%",color:e.isMobile?this.theme.blueColor:this.theme.mediumTextColor,fill:e.isMobile?this.theme.blueColor:this.theme.mediumTextColor,height:e.isMobile?44:36,borderRadius:0,fontSize:e.isMobile?16:12,fontWeight:e.isMobile?500:400,justifyContent:e.isMobile?"center":void 0}}}de.Format=R,de.lastUpdatesTabKey="LastUpdatesTab",de.actionButtonStyle={display:"flex",alignItems:"center",justifyContent:"center",flexGrow:0,flexShrink:0,height:"100%",minWidth:34,position:"relative"},de.mobileBottomBarPhoneButtonStyle={display:"flex",alignItems:"center",justifyContent:"center",flex:1},de.mobileBottomBarTabletButtonStyle={display:"flex",alignItems:"center",justifyContent:"center",width:62,flex:"none"};t.a=de}}]);