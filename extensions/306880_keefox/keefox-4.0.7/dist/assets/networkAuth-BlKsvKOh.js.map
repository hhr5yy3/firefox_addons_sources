{"version":3,"file":"networkAuth-BlKsvKOh.js","sources":["../../../src/dialogs/NetworkAuth.ts"],"sourcesContent":["import { KeeLog } from \"../common/Logger\";\nimport { configManager } from \"../common/ConfigManager\";\nimport { Entry } from \"../common/model/Entry\";\nimport {setup as i18nSetup } from \"../common/i18n\";\n\nclass NetworkAuth {\n    public setupPage(entries: Entry[], realm: string, url: string, isProxy: boolean) {\n        const instructions = isProxy\n            ? $STRF(\"network_auth_proxy_description\", [url])\n            : $STRF(\"network_auth_http_auth_description\", [url, realm]);\n        document.getElementById(\"network_auth_instructions\").textContent = instructions;\n        this.createNearNode(document.getElementById(\"network_auth_choose\"), entries);\n    }\n\n    async supplyNetworkAuth(entryIndex: number) {\n        const tab = await chrome.tabs.getCurrent();\n        await chrome.runtime.sendMessage({\n            action: \"NetworkAuth_ok\",\n            selectedEntryIndex: entryIndex\n        });\n        await chrome.tabs.remove(tab.id);\n    }\n\n    public createNearNode(node: HTMLElement, entries: Entry[]) {\n        const container = document.createElement(\"div\");\n        container.id = \"Kee-MatchedLoginsList\";\n        const list = document.createElement(\"ul\");\n        this.setLogins(entries, list);\n        container.appendChild(list);\n        node.parentNode.insertBefore(container, node.nextSibling);\n        (list.firstChild as HTMLElement).focus();\n    }\n\n    private setLogins(entries: Entry[], container) {\n        KeeLog.debug(\"setting \" + entries.length + \" matched entries\");\n\n        // add every matched entry to the container(s)\n        for (let i = 0; i < entries.length; i++) {\n            const entry = entries[i];\n            let usernameDisplayValue = \"[\" + $STR(\"noUsername_partial_tip\") + \"]\";\n            const displayGroupPath = entry.database.name + \"/\" + entry.parentGroup.path;\n\n            const usernameField = Entry.getUsernameField(entry);\n            if (usernameField && usernameField.value) {\n                usernameDisplayValue = usernameField.value;\n            }\n\n            const loginItem = document.createElement(\"li\");\n            loginItem.className = \"\";\n            loginItem.style.backgroundImage =\n                \"url(data:image/png;base64,\" + entry.icon.iconImageData + \")\";\n            loginItem.dataset.filename = entry.database.fileName;\n            loginItem.dataset.formIndex = entry.formIndex != null ? entry.formIndex.toString() : \"\";\n            loginItem.dataset.entryIndex = i.toString();\n            loginItem.dataset.uuid = entry.uuid;\n            loginItem.title = $STRF(\"matchedLogin_tip\", [\n                entry.title,\n                displayGroupPath,\n                usernameDisplayValue\n            ]);\n            loginItem.tabIndex = i == 0 ? 0 : -1;\n\n            loginItem.textContent = $STRF(\"matchedLogin_label\", [\n                usernameDisplayValue,\n                entry.title\n            ]);\n\n            loginItem.addEventListener(\"keydown\", this.keyboardNavHandler, false);\n            loginItem.addEventListener(\n                \"click\",\n                function (event) {\n                    event.stopPropagation();\n                    if (event.button == 0 || event.button == 1) {\n                        this.dispatchEvent(new Event(\"keeCommand\"));\n                    }\n                },\n                false\n            );\n            loginItem.addEventListener(\n                \"keeCommand\",\n                function (this: HTMLElement) {\n                    networkAuth.supplyNetworkAuth(parseInt(this.dataset.entryIndex));\n                },\n                false\n            );\n\n            container.appendChild(loginItem);\n        }\n    }\n\n    private keyboardNavHandler(event: KeyboardEvent) {\n        const target = event.target as HTMLLIElement;\n\n        switch (event.keyCode) {\n            case 13: // enter\n                event.preventDefault();\n                event.stopPropagation();\n                target.dispatchEvent(new Event(\"keeCommand\"));\n                break;\n            case 40: // down\n                event.preventDefault();\n                event.stopPropagation();\n                if (target.nextElementSibling) {\n                    (target.nextElementSibling as HTMLLIElement).focus();\n                }\n                break;\n            case 38: // up\n                event.preventDefault();\n                event.stopPropagation();\n                if (target.previousElementSibling) {\n                    (target.previousElementSibling as HTMLLIElement).focus();\n                }\n                break;\n            case 27: // esc\n                event.preventDefault();\n                event.stopPropagation();\n                window.close();\n                break;\n        }\n    }\n}\n\nlet networkAuth: NetworkAuth;\n\nasync function setupNetworkAuthDialog() {\n    await configManager.load();\n    KeeLog.attachConfig(configManager.current);\n    networkAuth = new NetworkAuth();\n    chrome.runtime.onMessage.addListener(message => {\n        if (message && message.action && message.action === \"NetworkAuth_matchedEntries\") {\n            networkAuth.setupPage(message.entries, message.realm, message.url, message.isProxy);\n        }\n    });\n    chrome.runtime.sendMessage({ action: \"NetworkAuth_load\" });\n    document.getElementById(\"i18n_root\").style.display = \"block\";\n}\n\nif (document.readyState === \"loading\") {\n    document.addEventListener(\"DOMContentLoaded\", async () => await setupNetworkAuthDialog());\n} else {\n    (async () => {\n        await setupNetworkAuthDialog();\n    })();\n}\n\ni18nSetup();\n"],"names":["i18nSetup"],"mappings":"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"}