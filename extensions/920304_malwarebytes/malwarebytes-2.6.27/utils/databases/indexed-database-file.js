import*as fzstd from"fzstd";import{chrome}from"../polyfill";import{binaryToString,isZstd}from"../utils";import{clearFiles,queuedFetchBinary,queuedFileRead}from"../file";import{DB_DIR}from"./db-consts";export class IndexedDatabaseFile{constructor(e,a){this.name=e,this.cleanName=a}async read(){const e=await queuedFileRead(this.name);return this.unpack(e)}async readBundled(){console.debug("READ BUNDLED FOR: ",{name:this.name,cleanName:this.cleanName});let e=await queuedFetchBinary(chrome.runtime.getURL(DB_DIR+"/"+this.name));return this.unpack(e)}unpack(e){console.debug("UNPACKING: ",{name:this.name,cleanName:this.cleanName});let a=this.unpackInflate(e);return JSON.parse(a)}unpackInflate(e){const a=new Uint8Array(e);return isZstd(a)?binaryToString(fzstd.decompress(a)):binaryToString(a)}static async clear(){return clearFiles()}}