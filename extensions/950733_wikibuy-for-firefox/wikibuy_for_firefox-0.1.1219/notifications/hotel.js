import{a as rt}from"../chunks/chunk-TH3N6NCF.js";import{a as $,b as _t,c as L,d as wt}from"../chunks/chunk-D63ZIPV5.js";import{a as X,c as Y}from"../chunks/chunk-UP7HC4SX.js";import{a as Q}from"../chunks/chunk-OAYN3TMF.js";import{a as G}from"../chunks/chunk-4GQADNUW.js";import{a as st}from"../chunks/chunk-5VY5EMKN.js";import{a as at}from"../chunks/chunk-3REBBJSH.js";import{c as it}from"../chunks/chunk-L4RDDWJP.js";import{a as et}from"../chunks/chunk-RIL6IOBV.js";import{k as nt}from"../chunks/chunk-LG525BKV.js";import{a as ot}from"../chunks/chunk-WOENBU2A.js";import"../chunks/chunk-JDV5FZKX.js";import{a as J}from"../chunks/chunk-FVPQGETT.js";import{a as tt}from"../chunks/chunk-Z64FBUPL.js";import{a as B}from"../chunks/chunk-KWDMUJJA.js";import{a as y}from"../chunks/chunk-MT4LVDUX.js";import{a as yt}from"../chunks/chunk-WN4MFSKN.js";import{a as K}from"../chunks/chunk-7S3YJSN5.js";import{K as U,L as Z,M as S,a as N,e as j,f as D,n as bt}from"../chunks/chunk-LADTODTA.js";import"../chunks/chunk-O4TFJKJQ.js";import{B as f,c as w,d as R,l as O,m as V,r as E,x as A}from"../chunks/chunk-WRHUMLYF.js";import"../chunks/chunk-XSKOAVIS.js";import{E as dt,J as x,K as ft,q}from"../chunks/chunk-OEPSEZ5A.js";import"../chunks/chunk-XERCZVWP.js";import"../chunks/chunk-AT6M4CEW.js";import{e as h}from"../chunks/chunk-3GYLW4KZ.js";var be=h(N()),b=h(q()),gt=h(dt());ft();wt();_t();var M=n=>A("findHotel",n);var $t=h(N()),lt=h(N()),ct=h(bt()),T=h(yt()),d=h(q());var I=n=>A("visitHotel",n);var g=h(D()),z=class extends lt.Component{state={};constructor(...e){super(...e),this.state={hideNotification:!0}}componentDidMount(){let e=d.default.get(this.props,"view.hotel");if(e){let t=this.getWikibuyHotelEventData(e);t.searchId=d.default.get(this.props.view,"searchId"),f("page","wbHotelNotification",t)}setTimeout(()=>{this.setState({hideNotification:!1})},500)}render(){let{hideNotification:e}=this.state,{hotel:t,url:s,discount:o,rewards:a,headerText:r,subheaderText:i,imageUrl:c,buttonText:p,footerText:m}=d.default.get(this.props,"view",{}),{stars:_,distance:v}=t,k=!0,H=!0;if(r)return(0,g.jsx)(J,{className:e?"disabled hotel-page":"hotel-page",style:{top:k?"0":"auto",bottom:k?"auto":"0",left:H?"auto":"0",right:H?"0":"auto"},dragSelector:"header",isDraggable:E("ext_notif_drag"),onDragEnd:this.trackFirstDragEnd,children:(0,g.jsx)(T.Motion,{style:{opacity:(0,T.spring)(e?0:1,{stiffness:180,damping:20}),y:(0,T.spring)(e?k?-100:100:0,{stiffness:180,damping:20})},children:({opacity:ut,y:mt})=>(0,g.jsxs)("div",{className:"hotel-notification",style:{transform:`translate3d(0,${mt}%,0)`,opacity:`${ut}`},children:[(0,g.jsxs)("header",{children:[(0,g.jsx)(K,{width:120}),(0,g.jsx)(it,{}),(0,g.jsx)(B,{onClick:this.onClosePopup.bind(this,"x")})]}),(0,g.jsxs)("section",{children:[(0,g.jsx)("h2",{children:this.formatHeader(r,t,o,a)}),i&&(0,g.jsx)("h4",{style:{marginBottom:0},children:i.replace("{stars}",_).replace("{distance}",v)}),c&&(0,g.jsx)("img",{src:c,style:{width:"100%",marginTop:10},onError:F=>{F.target.onError=null,F.target.src=O+"/images/upload_content/hotel_placeholder_light.jpeg"}}),(0,g.jsx)("div",{className:"button-wrapper",children:(0,g.jsx)("button",{className:"primary-btn-large",onClick:()=>this.onClickDeal(s),children:p})}),m&&(0,g.jsx)("h6",{style:{fontStyle:"italic",marginTop:5},children:m})]})]})})})}trackFirstDragEnd=d.default.once((e,t)=>{at("hotelNotification",e,t)});formatHeader(e,t,s,o){let a,r=t.address;return a=e.replace("{discount}",y(s,{removeCents:!0})).replace("{title}",t.name).replace("{city}",r.cityName).replace("{state}",r.stateCode!==""?r.stateCode:r.stateName),o&&o.amount&&o.type=="fixed"&&(a=a.replace("{rewards}",y(o.amount*100,{removeCents:!0}))),o&&o.amount&&o.type=="percentage"&&(a=a.replace("{rewards}",`${Math.floor(o.amount)}%`)),a}getTextProperties(){let e=ct.default.findDOMNode(this),t=e.querySelector("section"),o=e.querySelector("button").innerText;return{notificationText:t.innerText.replace(`
${o}`,""),ctaText:o}}async onClickDeal(e,t){let s=d.default.get(this.props,"view.hotel");s&&(f("trackClick","wbViewHotelDeal","view hotel",{...this.getWikibuyHotelEventData(s),dest_domain:"capitaloneshopping.com",dest_url:e,searchId:d.default.get(this.props.view,"searchId")}),I({redirect:e})),t||this.setState({hideNotification:!0})}onClosePopup(e){this.setState({hideNotification:!0});let t=d.default.get(this.props,"view.hotel.wikibuyHotel");if(t){let s=this.getWikibuyHotelEventData(t);s.searchId=d.default.get(this.props.view,"hotel.searchId"),f("trackClick","wbDismissHotelNotification",e,s)}else f("trackClick","dismissHotelNotification",e,{...this.getTextProperties(),type:"notification",view:"hotelNotification",searchId:d.default.get(this.props.view,"hotel.searchId")})}getWikibuyHotelEventData(e){let{address:t,id:s,name:o,offers:a}=e,r=d.default.get(this.props,"view.hotel.searchParams"),i={...this.getTextProperties(),...r,hotelId:s,hotelLocation:`${t.cityName}, ${t.stateCode}`,hotelName:o,pricePostDiscount:a[0].pricing.pricePostDiscount.toString(),pricePreDiscount:a[0].pricing.pricePreDiscount.toString(),type:"notification",url:location.href,view:"hotelNotification",searchId:d.default.get(this.props.view,"hotel.searchId")};return i.latitude=i.latitude?i.latitude.toString():i.latitude,i.longitude=i.longitude?i.longitude.toString():i.longitude,i}},W=j({view:["hotelView"],events:["events"],session:["session"]},z);var oe=h(N()),pt=h(N()),u=h(q());var l=h(D()),vt=({savings:n,rewards:e,savingsBtn:t,rewardsBtn:s,onClickDeal:o})=>{let a;if(n){let r=y(n,{removeCents:!0});a=t?t.replace("{discount}",r):`Save ${r}`}else if(e){let r=y(e,{removeCents:!0});a=s?s.replace("{rewards}",r):`Earn ${r} in rewards`}return(0,l.jsx)("div",{className:"wikibuy-savings-component",onClick:o,children:(0,l.jsx)("h4",{children:a})})},kt=({displayData:n,savings:e,rewards:t,hotel:s,onClickDeal:o,onClose:a})=>{let r,i,c,p,m,_,v="",k="",H=u.default.get(s,"photoUrl");if(e)({headerText:r,subheaderText:i,showImage:c,showHotelImage:p,buttonText:m,footerText:_}=n.savings),v=y(e,{removeCents:!0});else if(t)({headerText:r,subheaderText:i,showImage:c,showHotelImage:p,buttonText:m,footerText:_}=n.rewards),k=y(t,{removeCents:!0});else return;return(0,l.jsx)("section",{className:"annotation-tooltip-component",children:(0,l.jsxs)("div",{className:"annotation-tooltip-container",children:[(0,l.jsxs)("div",{className:"annotation-tooltip-header",children:[(0,l.jsx)("h2",{children:v?r.replace("{discount}",v):(0,l.jsx)("span",{className:"green-text",children:r.replace("{rewards}",`${k} in Rewards`)})}),(0,l.jsx)(B,{onClick:a.bind(void 0,"x")})]}),(0,l.jsxs)("div",{onClick:o,children:[i&&(0,l.jsx)("h4",{className:"text",style:{marginBottom:0},children:i.replace("{discount}",v).replace("{hotel_name}",s.name)}),c&&(0,l.jsx)(rt,{className:"credits-icon"}),p&&H&&(0,l.jsx)("img",{src:H,style:{width:"100%",margin:"5px"}}),(0,l.jsx)("div",{className:"button-wrapper",children:(0,l.jsx)("button",{className:"primary-btn-large",children:m})}),_&&(0,l.jsx)("h6",{style:{fontStyle:"italic",marginTop:5},children:_})]})]})})},P=class extends pt.Component{state={isComplete:!1,savings:!1,rewards:!1,showSavingsDetails:!1};componentWillMount(){let e=this.props.inputData;M(e).then(t=>{this.setState({isComplete:!0}),w.set("hotelView",{data:t}),this.setState({responseData:t});let{discount:s,showNotif:o,wikibuyCreditsPerNight:a,wikibuyCredits:r,cashback:i,wikibuyHotel:c,url:p}=t,m={...c,url:p};this.setState({hotel:m}),o&&s?this.setState({savings:s}):a>0&&i&&this.setState({rewards:r})})}componentDidMount(){let e=this.state.responseData;f("page","hotelNotification",{type:"notification",view:"hotelNotification_inline",credits:!!u.default.get(e,"cashback.reward.amount"),creditsAmount:u.default.get(e,"cashback.reward.amount"),creditsType:u.default.get(e,"cashback.reward.type")})}onEnterSavingsButton(){this.props.hideDetails||(this.savingsDetailsLeaveTimeout&&clearTimeout(this.savingsDetailsLeaveTimeout),this.showSavingsDetails())}onLeaveSavingsButton(){this.savingsDetailsLeaveTimeout=setTimeout(()=>{this.hideSavingsDetails(),this.setState({preventInitialShow:!0})},500)}hideSavingsDetails(){this.setState({showSavingsDetails:!1,preventInitialShow:!0})}showSavingsDetails(){this.setState({showSavingsDetails:!0})}render(){let{displayData:e,hideDetails:t,btnStyle:s}=this.props,{savingsBtn:o,rewardsBtn:a}=e,{isComplete:r,savings:i,rewards:c,hotel:p}=this.state,m=this.state.showSavingsDetails;!this.state.preventInitialShow&&r&&(i||c)&&!t&&(m=!0,setTimeout(()=>{this.hideSavingsDetails()},2e3));let _=this.state.showSavingsDetails;return(0,l.jsx)("div",{className:`hotel-page-annotation ${_?"tooltip-open":""}`,children:(0,l.jsxs)("div",{className:`savings-button ${`${r?`${i||c?"savings":"no-savings"}`:"searching"}`}`,style:s||{},onMouseEnter:this.onEnterSavingsButton.bind(this),onMouseLeave:this.onLeaveSavingsButton.bind(this),children:[(0,l.jsx)(G,{}),r?i||c?(0,l.jsx)(vt,{savings:i,rewards:c,savingsBtn:o,rewardsBtn:a,onClickDeal:()=>{p&&(i||c)&&this.onClickDeal(p.url)}}):(0,l.jsx)(Y,{}):(0,l.jsx)(X,{}),r&&(i||c)&&m?(0,l.jsx)(kt,{savings:i,rewards:c,displayData:e,url:p.url,hotel:p,onClickDeal:()=>this.onClickDeal(p.url),onClose:this.hideSavingsDetails.bind(this)}):null]})})}async onClickDeal(e,t){let s=u.default.get(this.state,"hotel"),o=u.default.get(this.state,"responseData.searchId"),a=u.default.get(this.state);if(s)f("trackClick","wbViewHotelDeal","view hotel",{...this.getWikibuyHotelEventData(s),dest_domain:"capitaloneshopping.com",dest_url:e,searchId:o}),I({redirect:e});else{let{clickId:r,redirectId:i}=tt(),c=u.default.get(this.props,"view.hotel.source");f("trackClick","viewHotelDeal","view hotel",{type:"notification",view:"hotelNotification_inline",source:c,redirectId:i,clickId:r,credits:!!u.default.get(a,"cashback.reward.amount"),creditsAmount:u.default.get(a,"cashback.reward.amount"),creditsType:u.default.get(a,"cashback.reward.type"),searchId:o});let p=`${e}&wsid=${r}`;p=V({params:{clickEvent:"viewHotelDeal",destUrl:p,redirectId:i,subExperience:"hotels_view_offer"},isWbPublisher:!0}),I({redirect:p})}t||this.setState({showSavingsDetails:!0})}getWikibuyHotelEventData(e){let{address:t,id:s,name:o,offers:a}=e,i={...u.default.get(this.state.responseData,"searchParams"),hotelId:s,hotelLocation:`${t.cityName}, ${t.stateCode}`,hotelName:o,pricePostDiscount:a[0].pricing.pricePostDiscount.toString(),pricePreDiscount:a[0].pricing.pricePreDiscount.toString(),type:"notification",url:location.href,view:"hotelNotification_inline",searchId:u.default.get(this.props.view,"hotel.searchId")};return i.latitude=i.latitude?i.latitude.toString():i.latitude,i.longitude=i.longitude?i.longitude.toString():i.longitude,i}componentWillUnmount(){this.savingsDetailsLeaveTimeout&&clearTimeout(this.savingsDetailsLeaveTimeout)}};var C=h(D());window.__wb_timing.hotelRequireAt=performance.now();async function xt(){let n=await et();st(n)}function Dt(n){return(0,C.jsx)(U,{children:(0,C.jsx)(W,{...n})})}async function St(n){let{props:e,...t}=n,s=location.hostname.replace(/^www\./,""),o=await M(b.default.assign({domain:s,pagePath:location.pathname},t));if(w.set("checkingHotels",!1),o&&(o.discount||o.rewards))R({active:!0}),w.set("hotelView",o),S({initialRoute:"/hotel",cssUrl:"hotel.css",app:Dt(e)});else{let a=w.get("displayDealsViewIfDeal");typeof a=="function"&&a()}}function Ct(n){let{domain:e,contentData:t,...s}=n,o=b.default.assign({domain:e,pagePath:location.pathname},s),a=t&&t.selectorsByDomain?b.default.get(t.selectorsByDomain,e,null):null;if(!a)return;let r=t&&t.displayByDomain?b.default.get(t.displayByDomain,e,null):null;function i(c){return(0,C.jsx)(U,{children:(0,C.jsx)(P,{...c})})}if(R({active:!0}),e=="airbnb.com"){let[c,p]=a,m=document.querySelector(c.selector),_=document.querySelector(p.selector);S({initialRoute:"/hotel",cssUrl:"hotel.css",app:i({inputData:o,displayData:r,btnStyle:c.btnStyle}),insertAfterElement:m}),S({initialRoute:"/hotel",cssUrl:"hotel.css",app:i({inputData:o,displayData:r,hideDetails:!0,btnStyle:p.btnStyle}),insertAfterElement:_,mountClass:"_14f4nnk",allowToHide:!0})}else S({initialRoute:"/hotel",cssUrl:"hotel.css",app:i({inputData:o,displayData:r,btnStyle:a.btnStyle}),insertBeforeElement:document.querySelector(a.selector)})}var Ht=(n,e)=>{let t={...n};t.title=$(n.name),t.address=$(n.address),t.rooms=parseInt(n.room_count),t.adults=parseInt(n.adults_stay),t.children=parseInt(n.children_stay),t.latitude=n.latitude?n.latitude.toString():"",t.longitude=n.longitude?n.longitude.toString():"",x(["loading dewey hotel:",t]),f("track","deweyHotelSearch",{...t,url:e})},Nt=n=>{let e=[];for(let t of n){let s=t.key.toLowerCase();if(s=="hotels"&&(s="hcom"),t.value){let o={};o[s]=t.value,e.push(o)}}return e};async function It(n,e){let t=b.default.get(n,"pageData.hotel",{}),s=b.default.get(n,"pageData.meta");x(["dewey meta",s]),s&&(t={...s,...t}),t.domain=e,t.checkIn=L(t.check_in_date?t.check_in_date:t.checkIn),t.checkOut=L(t.check_out_date?t.check_out_date:t.checkOut);let o=b.default.get(t,"meta_partner_id[0]"),a=[];o&&(a=Nt(o),t.exactMatchMap=a),Ht(t,location.href),t.domain=e;let r=E("hotel_inline_conquesting"),i;r&&(e==="airbnb.com"||e==="google.com")&&(i=await ot({contentSlug:"hotel-inline-conquesting",contentProps:{domain:e}})),i?Ct({data:t,domain:e,deweyResult:n,exactMatchMap:a,inlineConquestingContentData:i}):St({data:t,deweyResult:n,exactMatchMap:a})}async function Tt(n){x(["*** hotels flights: loading conquest notification",n]);let e=await nt({deweyResult:n});x(["*** hotels flights conquest content",e]),e&&e.ui&&S({initialRoute:"/hotelsForFlights",blankSlate:!0,app:(0,C.jsx)(Q,{content:e})})}async function ht(){w.set("checkingHotels",!0),await xt();let n=gt.default.getDomain(window.location.href);Z("/hotel");try{let e=b.default.cloneDeep(w.get("deweyResult")||{});if(x(["dewey page type",e.pageType]),e.pageType==="hotelsPage")await It(e,n);else if(e.pageType==="confirmationPage")await Tt(e);else return}catch(e){w.set("checkingHotels",!1),console.error(e)}}document.readyState!=="loading"?ht():document.addEventListener("DOMContentLoaded",ht);
