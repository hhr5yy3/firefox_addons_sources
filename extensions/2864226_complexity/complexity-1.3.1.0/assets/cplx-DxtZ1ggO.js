import{j as t,t as M}from"./cplx-DEt7CUyc.js";import{P as N}from"./cplx-BsCYqTWz.js";import{r as c}from"./cplx-M4JPizzD.js";import{b as y,t as n,L,e as T,V as w,M as D}from"./cplx-CejnDNPm.js";import{b as f}from"./cplx-DewpVJ-0.js";import{B as k}from"./cplx-CCGYIZQf.js";import{D as z,a as E,b as g,c as l,d as I,e as $}from"./cplx-D6x2E8AM.js";import{u as R}from"./cplx-n_Xg7oLY.js";import{b as S}from"./cplx-BqwXc_LR.js";import{u as F}from"./cplx-hUtawQMb.js";import{r as O}from"./cplx-Cdcyb6EG.js";import{$ as m}from"./cplx-BbAh7E-i.js";import{a as U,u as A,g as P}from"./cplx-CWPpH3dB.js";import"./cplx-CVsLL7Ku.js";import"./cplx-CzQHx1MX.js";import"./cplx-DSnlyBAv.js";import"./cplx-CXGk_GMP.js";import"./cplx-B19A3gYQ.js";import"./cplx-B42KOvrD.js";import"./cplx-km2FGkQ4.js";import"./cplx-2ekRUlSR.js";import"./cplx-AFeO3sEC.js";import"./cplx-D37zsf-y.js";import"./cplx-BpeHHEix.js";import"./cplx-CIDXzIHh.js";import"./cplx-CvSOQQlQ.js";import"./cplx-Bzmv935M.js";import"./cplx-Bey00KRS.js";import"./cplx-DC-QQLj-.js";import"./cplx-B814hFp-.js";import"./cplx-wwbq-DDb.js";import"./cplx-CZMWhpfy.js";import"./cplx-SsoyhRxE.js";import"./cplx-Mn-h5XDX.js";import"./cplx-Cqfmi6PF.js";import"./cplx-CCS6eJc0.js";import"./cplx-DD6dUv5H.js";import"./cplx-Dy60Fcq0.js";import"./cplx-CgmVhoKz.js";const V=c.memo(function(){const{isMobile:e}=S(),{copyThread:i,isFetching:o,getContent:u}=R(),x=c.useMemo(()=>o?t.jsxs("div",{className:"tw-flex tw-items-center tw-gap-2",children:[t.jsx(y,{className:"tw-size-4 tw-animate-spin"}),!e&&t.jsx("span",{children:n("plugin-export-thread:exportButton.action")})]}):t.jsxs("div",{className:"tw-flex tw-items-center tw-gap-2",children:[t.jsx(L,{className:"tw-size-4"}),!e&&t.jsx("span",{children:n("plugin-export-thread:exportButton.action")})]}),[o,e]),[j,b]=F({defaultText:null}),C=c.useCallback(async s=>{try{const a=(O().pathname.split("/").pop()||`thread-${new Date().getTime()}`)+(s?"":" (no-citations)"),B=await u({withCitations:s}),v=new Blob([B],{type:"text/markdown"}),h=URL.createObjectURL(v),p=document.createElement("a");p.href=h,p.download=`${a}.md`,document.body.appendChild(p),p.click(),document.body.removeChild(p),URL.revokeObjectURL(h)}catch(a){console.error("Failed to download:",a),M({title:"âŒ Failed to download",description:a instanceof Error?a.message:"Unknown error occurred"})}},[u]);return t.jsxs(z,{positioning:{placement:"bottom-end"},onSelect:({value:s})=>{i({withCitations:s!=="without-citations",onComplete:()=>b(t.jsxs("div",{className:"tw-flex tw-items-center tw-gap-2",children:[t.jsx(T,{className:"tw-size-4"}),!e&&t.jsx("span",{children:n("plugin-export-thread:exportButton.copied")})]}))})},children:[t.jsx(E,{asChild:!0,disabled:o,children:t.jsx(k,{variant:e?"default":"outline",size:"sm",className:"tw-h-8 tw-px-2",children:o?x:j??x})}),t.jsxs(g,{className:"tw-font-medium",children:[t.jsxs(l,{value:"default",children:[t.jsx(f,{className:"tw-mr-2 tw-size-4"}),t.jsx("span",{children:n("plugin-export-thread:exportButton.options.default")})]}),t.jsxs(l,{value:"without-citations",children:[t.jsx(w,{className:"tw-mr-2 tw-size-4"}),t.jsx("span",{children:n("plugin-export-thread:exportButton.options.withoutCitations")})]}),t.jsxs(I,{onSelect:({value:s})=>{C(s==="default")},children:[t.jsxs($,{className:"tw-p-2",children:[t.jsx(D,{className:"tw-mr-2 tw-size-4"}),t.jsx("span",{children:n("plugin-export-thread:exportButton.options.download")})]}),t.jsxs(g,{className:"tw-font-medium",children:[t.jsxs(l,{value:"default",children:[t.jsx(f,{className:"tw-mr-2 tw-size-4"}),t.jsx("span",{children:n("plugin-export-thread:exportButton.options.default")})]}),t.jsxs(l,{value:"without-citations",children:[t.jsx(w,{className:"tw-mr-2 tw-size-4"}),t.jsx("span",{children:n("plugin-export-thread:exportButton.options.withoutCitations")})]})]})]})]})]})}),G='[data-cplx-component=thread-navbar] a[role=button][href*="https://perplexity.sng"]{display:none}',d="cplx-thread-export-button";function W(){U();const{navbarChildren:r,messageBlocks:e}=A(o=>({navbarChildren:o.threadComponents.navbarChildren,messageBlocks:o.threadComponents.messageBlocks}));return c.useMemo(()=>e==null?void 0:e.some(o=>o.isInFlight),[e])?(setTimeout(()=>{m(`[data-cplx-component="${d}"]`).remove()},0),null):_(r)}function _(r){if(r==null)return null;const e=m(r).last().children().first();if(!e.length)return null;const i=e.find(`[data-cplx-component="${d}"]`);return i.length?i[0]:m("<div>").internalComponentAttr(d).appendTo(e)[0]}function zt(){const r=W();return P({id:"hide-open-in-app-btn",css:G}),t.jsx(N,{container:r,children:t.jsx(V,{})})}export{zt as default};
