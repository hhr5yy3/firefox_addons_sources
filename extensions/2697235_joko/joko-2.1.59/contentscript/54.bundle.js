"use strict";(self.webpackChunkchrome_extension=self.webpackChunkchrome_extension||[]).push([[54],{43420:function(e,n,t){var o=this&&this.__awaiter||function(e,n,t,o){return new(t||(t=Promise))((function(r,a){function i(e){try{u(o.next(e))}catch(e){a(e)}}function s(e){try{u(o.throw(e))}catch(e){a(e)}}function u(e){var n;e.done?r(e.value):(n=e.value,n instanceof t?n:new t((function(e){e(n)}))).then(i,s)}u((o=o.apply(e,n||[])).next())}))},r=this&&this.__generator||function(e,n){var t,o,r,a,i={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return a={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function s(s){return function(u){return function(s){if(t)throw new TypeError("Generator is already executing.");for(;a&&(a=0,s[0]&&(i=0)),i;)try{if(t=1,o&&(r=2&s[0]?o.return:s[0]?o.throw||((r=o.return)&&r.call(o),0):o.next)&&!(r=r.call(o,s[1])).done)return r;switch(o=0,r&&(s=[2&s[0],r.value]),s[0]){case 0:case 1:r=s;break;case 4:return i.label++,{value:s[1],done:!1};case 5:i.label++,o=s[1],s=[0];continue;case 7:s=i.ops.pop(),i.trys.pop();continue;default:if(!(r=i.trys,(r=r.length>0&&r[r.length-1])||6!==s[0]&&2!==s[0])){i=0;continue}if(3===s[0]&&(!r||s[1]>r[0]&&s[1]<r[3])){i.label=s[1];break}if(6===s[0]&&i.label<r[1]){i.label=r[1],r=s;break}if(r&&i.label<r[2]){i.label=r[2],i.ops.push(s);break}r[2]&&i.ops.pop(),i.trys.pop();continue}s=n.call(e,i)}catch(e){s=[6,e],o=0}finally{t=r=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,u])}}};Object.defineProperty(n,"__esModule",{value:!0});var a=t(55015),i=t(70992),s=t(46863),u=t(99556),c=t(92204),l=t(38542),d=t(74137),p=t(66499),f=t(13093),m=t(42934),y=t(17504),_=t(76372),h=t(81082),v=t(92134),g=t(46239),C=t(84009);!function(){o(this,void 0,void 0,(function(){var e,n;return r(this,(function(t){switch(t.label){case 0:return t.trys.push([0,2,,3]),(0,g.sendMessageToBackgroundScript)({message:"contentScriptReady",data:{timeToSendContentScriptReadyMessageAfterPageLoadingStart:Date.now()-performance.timeOrigin}}),(0,s.setBackgroundScriptMonitoring)(),(0,h.setContentScriptPortMessageListener)(),(0,v.setMessageListener)(),(0,p.setWebAppListener)(),(0,C.handleUrlChangeMessage)(window.location.href),(0,p.retrieveConsentToTermsOfServiceAndPrivacyPolicyFromWebApp)(),(0,c.checkShouldLoadImagesThroughBackgroundScript)(),a.browserKind===a.Browser.mobileAppWebView&&(0,l.addTestElementForMobileAppWebView)("webViewContentScriptTestElement"),[4,(0,i.checkIsSignedIn)()];case 1:return t.sent()&&((e=(0,m.getSearchEngineMatchingUrl)(window.location.href))?((0,y.initializeEmbeddedProductDiscoveryExperience)(e),(0,_.handleSearchResultEmbeddedInfoDisplay)(e)):(0,f.startCouponAutomation)()),(0,u.handleOfferWidgetDisplayLogicHealthCheckAfterContentScriptRestart)(),[3,3];case 2:throw n=t.sent(),(0,d.captureSentryException)(n),n;case 3:return[2]}}))}))}()},45948:function(e,n,t){var o=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(n,"__esModule",{value:!0}),n.useBnplSuggestionAtCheckoutWidgetInnerState=void 0;var r=o(t(96540)),a=o(t(95093)),i=t(55015),s=t(7444),u=t(31229),c=t(46239),l=t(89710),d=t(74617),p=t(59003),f=t(94700);function m(e,n){var t={offerId:e.offerId,fromScreen:"browserCheckoutButton",isTemporaryUser:n};(0,c.sendMessageToBackgroundScript)({message:"logUserEvent",data:{event:{type:"clickedPayWithJoko",payload:t}}}),(0,c.sendMessageToBackgroundScript)({message:"logAmplitudeEvent",data:{event:{type:"BNPL - Clicked Pay with Joko",properties:t}}})}n.useBnplSuggestionAtCheckoutWidgetInnerState=function(e){var n=(0,i.useUserRegion)(),t=(0,u.useIsTemporaryUser)(),o=(0,f.useWidgetDisplay)(),y=o.isWidgetDisplayed,_=o.closeWidget,h=o.onWidgetInnerStateLoadEnd,v=(0,s.useAppFeature)(i.Feature.shouldUseFactorizedBnplSubscriptionWidgetIntoPanelInExtensions),g=r.default.useCallback((function(){t||v?(m(e,t),_(),(0,d.displayPanelAndLogEvents)({offer:e,bnpl:{isBnplSectionEnabledForOffer:!0,shouldOpenBnplSubscription:!t,isFromBnplSuggestionAtCheckoutWidget:!0},isTemporaryUser:t,userOfferActivationInfo:void 0,defaultPanelLocationOverride:{panelTab:i.PanelTab.offerDetails,offerDetailsSection:i.OfferDetailsSection.bnpl}},"bnplSuggestionAtCheckoutWidget")):((0,p.displayBnplSubscriptionWidget)({offer:e,isFromBnplSuggestionAtCheckoutWidget:!0}),m(e,t),_()),(0,l.handleUserInterfaceComponentInteractionInBackgroundOrLoadTrackingLink)({offer:e,triggeringEventType:i.UserInterfaceComponentInteractionEventType.bnplSuggestionAtCheckoutWidgetStartButton})}),[e,t,v]),C=r.default.useCallback((function(){var n;!function(e,n){var t={offerId:e.offerId,offerType:e.type,isTemporaryUser:n,widgetType:"bnplSuggestionAtCheckout"};(0,c.sendMessageToBackgroundScript)({message:"logUserEvent",data:{event:{type:"closedBrowserExtensionWidget",payload:t}}}),(0,c.sendMessageToBackgroundScript)({message:"logAmplitudeEvent",data:{event:{type:"Browser Extension - Widget Closed",properties:t}}})}(e,t),_();var o=(0,a.default)().unix();(0,i.setLocalStorageItem)(i.LocalStorageKey.lastDismissedBnplSuggestionAtCheckoutWidgetAt,o),(0,i.updateLocalStorageItem)(i.LocalStorageKey.lastDismissedBnplSuggestionAtCheckoutWidgetTimestampMap,((n={})[e.offerId]=o,n))}),[e,t]);return r.default.useEffect(h,[]),{onClickCloseButton:C,onClickDisplayBnplSubscriptionWidget:g,userRegion:n,isWidgetDisplayed:y}}},14568:function(e,n,t){var o=this&&this.__awaiter||function(e,n,t,o){return new(t||(t=Promise))((function(r,a){function i(e){try{u(o.next(e))}catch(e){a(e)}}function s(e){try{u(o.throw(e))}catch(e){a(e)}}function u(e){var n;e.done?r(e.value):(n=e.value,n instanceof t?n:new t((function(e){e(n)}))).then(i,s)}u((o=o.apply(e,n||[])).next())}))},r=this&&this.__generator||function(e,n){var t,o,r,a,i={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return a={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function s(s){return function(u){return function(s){if(t)throw new TypeError("Generator is already executing.");for(;a&&(a=0,s[0]&&(i=0)),i;)try{if(t=1,o&&(r=2&s[0]?o.return:s[0]?o.throw||((r=o.return)&&r.call(o),0):o.next)&&!(r=r.call(o,s[1])).done)return r;switch(o=0,r&&(s=[2&s[0],r.value]),s[0]){case 0:case 1:r=s;break;case 4:return i.label++,{value:s[1],done:!1};case 5:i.label++,o=s[1],s=[0];continue;case 7:s=i.ops.pop(),i.trys.pop();continue;default:if(!(r=i.trys,(r=r.length>0&&r[r.length-1])||6!==s[0]&&2!==s[0])){i=0;continue}if(3===s[0]&&(!r||s[1]>r[0]&&s[1]<r[3])){i.label=s[1];break}if(6===s[0]&&i.label<r[1]){i.label=r[1],r=s;break}if(r&&i.label<r[2]){i.label=r[2],i.ops.push(s);break}r[2]&&i.ops.pop(),i.trys.pop();continue}s=n.call(e,i)}catch(e){s=[6,e],o=0}finally{t=r=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,u])}}},a=this&&this.__read||function(e,n){var t="function"==typeof Symbol&&e[Symbol.iterator];if(!t)return e;var o,r,a=t.call(e),i=[];try{for(;(void 0===n||n-- >0)&&!(o=a.next()).done;)i.push(o.value)}catch(e){r={error:e}}finally{try{o&&!o.done&&(t=a.return)&&t.call(a)}finally{if(r)throw r.error}}return i},i=this&&this.__spreadArray||function(e,n,t){if(t||2===arguments.length)for(var o,r=0,a=n.length;r<a;r++)!o&&r in n||(o||(o=Array.prototype.slice.call(n,0,r)),o[r]=n[r]);return e.concat(o||Array.prototype.slice.call(n))},s=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(n,"__esModule",{value:!0}),n.checkIsBnplEnabled=n.checkIsBnplEnabledForOffer=n.useCreateUserBnplTransactionStartPollingAndHandleNavigation=n.formatPhoneNumber=n.checkIsNameValid=n.checkDoesContainOnlyDigits=n.isFormattedBirthDateValid=n.checkIsEmailValid=n.checkShouldAskEmailForAppleUser=n.isPhoneNumberValid=n.useBnplUserInformation=n.checkIsFloaPaymentSessionReady=n.checkIsFloaEligibilityAccepted=n.useUpdateProvisionedUserBnplTransactionsLocalStorage=n.handleUnfinishedBnplSubscription=n.handleRefreshUserBnplTransactionsInLocalStorage=n.getUserBnplTransactionsFromLocalStorage=n.useUserBnplTransactionsFromBackend=n.useUserBnplTransactionWithPolling=n.useUserBnplTransaction=void 0;var u=s(t(96540)),c=s(t(95093)),l=t(55015),d=t(47615),p=t(7444),f=t(32668),m=t(31229),y=t(46239),_=t(72886),h=t(13897),v=6e5,g="provisionedUserBnplTransactionsLocalStorage";function C(e){var n=a(u.default.useState(void 0),2),t=n[0],o=n[1],r=a(u.default.useState(!1),2),i=r[0],s=r[1];return u.default.useEffect((function(){if(i){var n=setInterval((function(){(0,y.sendMessageToBackgroundScript)({message:"getUserBnplTransaction",data:{createdAt:(0,c.default)(e).unix()}},(function(e){(null==e?void 0:e.bnplTransaction)&&o(e.bnplTransaction)}))}),500),t=setTimeout((function(){return clearInterval(n)}),v);return function(){clearInterval(n),clearTimeout(t)}}}),[i]),{userBnplTransaction:t,startPolling:function(){return s(!0)},stopPolling:function(){return s(!1)}}}function b(e,n){return e.offerId===n&&e.status===l.BnplTransactionStatus.provisioned}function S(e){return Date.now()-new Date(e.createdAt).getTime()<864e5}function T(e){return!!e.swanPaymentCard&&e.swanPaymentCard.hasEverReceivedAnAuthorization}function I(e){localStorage.setItem(g,JSON.stringify(e.map((function(e){return{createdAt:e.createdAt,amount:e.amount,status:e.status,offerId:e.offerId}}))))}function A(){return o(this,void 0,void 0,(function(){return r(this,(function(e){switch(e.label){case 0:return[4,new Promise((function(e){return(0,y.sendMessageToBackgroundScript)({message:"getUserBnplTransactions"},(function(n){return e((null==n?void 0:n.bnplTransactions)?n.bnplTransactions:void 0)}))}))];case 1:return[2,e.sent()]}}))}))}function E(e){if(!e)return!1;try{return new RegExp("^(0|\\+".concat(l.PHONE_NUMBER_PREFIX_INDICATOR,")[6-7](\\d{2}){4}$"),"g").test(e.replace(/\s/g,""))}catch(e){return!1}}function w(e){var n=!(!e||!O(e)||function(e){return/@privaterelay\.appleid\.com/.test(e)}(e));return!n}function O(e){return/^[^\s@]+@[^\s@]+\.[^\s@]{2,}$/.test(e)}function P(e){var n=(0,c.default)(e,"DD/MM/YYYY"),t=/^\d{1,2}\/\d{1,2}\/\d{4}$/.test(e),o=n.isValid(),r=n<(0,c.default)(),a=n>=(0,c.default)("01/01/1900","DD/MM/YYYY");return t&&o&&r&&a}function N(e){return/^[0-9]+$/.test(e)}function k(e){return/^[a-zA-Z\u00C0-\u017F']+(?:[-\s][a-zA-Z\u00C0-\u017F']+)*$/.test(e)}n.useUserBnplTransaction=function(e){var n=a(u.default.useState(void 0),2),t=n[0],o=n[1];return u.default.useEffect((function(){(0,y.sendMessageToBackgroundScript)({message:"getUserBnplTransaction",data:{createdAt:(0,c.default)(e).unix()}},(function(e){(null==e?void 0:e.bnplTransaction)&&o(e.bnplTransaction)}))}),[]),t},n.useUserBnplTransactionWithPolling=C,n.useUserBnplTransactionsFromBackend=function(e){var n=function(){var e=a(u.default.useState(void 0),2),n=e[0],t=e[1];return u.default.useEffect((function(){(0,y.sendMessageToBackgroundScript)({message:"getUserBnplTransactions"},(function(e){(null==e?void 0:e.bnplTransactions)&&t(e.bnplTransactions)}))}),[]),n}(),t=(0,l.useHasFeature)(l.Feature.bnplNewCardReadyDisplayInExtensions);return u.default.useMemo((function(){if(void 0!==n){var o=n.filter((function(n){return b(n,e)&&S(n)&&(!t||!T(n))})).reverse();return I(o),o}}),[n,e,t])},n.getUserBnplTransactionsFromLocalStorage=function(e){if(!e)return[];var n=localStorage.getItem(g);return n?JSON.parse(n).filter((function(n){return b(n,e.offerId)&&S(n)})):[]},n.handleRefreshUserBnplTransactionsInLocalStorage=function(e){return o(this,void 0,void 0,(function(){var n;return r(this,(function(t){switch(t.label){case 0:return[4,A()];case 1:return void 0===(n=t.sent())||I(n.filter((function(n){return b(n,e)&&S(n)&&!T(n)})).reverse()),[2]}}))}))},n.handleUnfinishedBnplSubscription=function(e){var n=e.offer,t=e.unfinishedBnplSubscriptionStateByTabIdMap,o=e.tabId,r=e.isResumptionOfUnfinishedBnplSubscriptionOnUrlChangeEnabled,a=e.shouldUseFactorizedBnplSubscriptionWidgetIntoPanel;if(!(r&&n&&t&&o&&t[o]))return(0,_.submitWidgetDisplayDecision)({widgetName:_.PriorityOrderedWidgetName.bnplSubscriptionWidget,shouldDisplayWidget:!1}),!1;var i=t[o];return n.offerId!==i.offerId||i.updatedAt<Date.now()-9e5||i.currentBnplScreenName===l.BnplScreenName.cardErrorScreen?((0,h.removeUnfinishedBnplSubscriptionStateInLocalStorage)(o),(0,_.submitWidgetDisplayDecision)({widgetName:_.PriorityOrderedWidgetName.bnplSubscriptionWidget,shouldDisplayWidget:!1}),!1):((0,_.submitWidgetDisplayDecision)({widgetName:_.PriorityOrderedWidgetName.bnplSubscriptionWidget,shouldDisplayWidget:!0,props:{offer:n,unfinishedBnplSubscriptionState:i,shouldUseFactorizedBnplSubscriptionWidgetIntoPanel:a}}),!0)},n.useUpdateProvisionedUserBnplTransactionsLocalStorage=function(e){u.default.useEffect((function(){var n,t,o,r;if(e){var s=localStorage.getItem(g),u=s?JSON.parse(s):[];if(!u.some((function(n){return n.createdAt===e.createdAt}))){var c={createdAt:e.createdAt,amount:e.amount,status:e.status,offerId:e.offerId,panLastFourDigits:null!==(r=null===(o=null===(t=null===(n=e.swanPaymentCard)||void 0===n?void 0:n.confidentialCardData)||void 0===t?void 0:t.pan)||void 0===o?void 0:o.slice(-4))&&void 0!==r?r:null};localStorage.setItem(g,JSON.stringify(i([c],a(u),!1)))}}}),[e])},n.checkIsFloaEligibilityAccepted=function(e){var n;return!!((null===(n=null==e?void 0:e.amount)||void 0===n?void 0:n.valueInCents)&&e.floaEligibility&&e.floaEligibility.hasAgreement&&e.floaEligibilityInstallmentSchedule&&e.floaEligibilityInstallmentSchedule.eligibilityInstallments&&3===e.floaEligibilityInstallmentSchedule.eligibilityInstallments.length&&e.floaEligibilityInstallmentSchedule.eligibilityInstallments.every((function(e){return e.amount&&e.date&&e.rank})))},n.checkIsFloaPaymentSessionReady=function(e){var n;return!!((null===(n=null==e?void 0:e.lastFloaPaymentSession)||void 0===n?void 0:n.sessionId)&&e.lastFloaPaymentSession.sessionUrl&&e.lastFloaPaymentSession.status)},n.useBnplUserInformation=function(){var e=a(u.default.useState(),2),n=e[0],t=e[1],o=a(u.default.useState(),2),r=o[0],i=o[1],s=a(u.default.useState(),2),d=s[0],p=s[1],f=a(u.default.useState(),2),y=f[0],_=f[1],h=a(u.default.useState(),2),v=h[0],g=h[1],C=a(u.default.useState(),2),b=C[0],S=C[1],T=a(u.default.useState(),2),I=T[0],A=T[1],R=a(u.default.useState(),2),L=R[0],M=R[1],D=a(u.default.useState(),2),x=D[0],U=D[1],B=a(function(){var e=a(u.default.useState(void 0),2),n=e[0],t=e[1],o=u.default.useRef(n),r=/^\d{2}$|^\d{2}\/\d{2}$/,i=/^\d{3}$|^\d{2}\/\d{3}$/;return u.default.useEffect((function(){o.current&&n&&o.current.length<n.length&&(r.test(n)?t("".concat(n,"/")):i.test(n)&&t("".concat(n.slice(0,n.length-1),"/").concat(n[n.length-1]))),o.current=n}),[n]),[n,t]}(),2),F=B[0],W=B[1],H=a(u.default.useState(),2),G=H[0],j=H[1],V=a(u.default.useState(),2),q=V[0],K=V[1];!function(e){var n=e.setFirstName,t=e.setLastName,o=e.setBirthLastName,r=e.setPhoneNumber,a=e.setEmail,i=e.setBnplEmail,s=e.setGender,d=e.setFormattedBirthDate,p=e.setPostalAddress,f=e.setZipCode,y=e.setCity,_=e.setBirthFrenchDepartment,h=(0,m.useUser)();u.default.useEffect((function(){if(null==h?void 0:h.userInfo){if(h.userInfo.firstName&&n&&n(h.userInfo.firstName),h.userInfo.lastName&&t&&t(h.userInfo.lastName),h.userInfo.birthLastName&&o?o(h.userInfo.birthLastName):h.userInfo.lastName&&o&&o(h.userInfo.lastName),h.phoneNumber&&r&&r(h.phoneNumber),h.email&&a&&a(h.email),h.bnplEmail&&i&&i(h.bnplEmail),h.userInfo.gender&&(h.userInfo.gender===l.Gender.Male||h.userInfo.gender===l.Gender.Female)&&s&&s(h.userInfo.gender),h.userInfo.birthDate&&d){var e=c.default.utc(h.userInfo.birthDate).format("DD/MM/YYYY");P(e)&&d(e)}h.userInfo.postalAddress&&(h.userInfo.postalAddress.postalAddress&&p&&p(h.userInfo.postalAddress.postalAddress),h.userInfo.postalAddress.zipCode&&f&&f(h.userInfo.postalAddress.zipCode),h.userInfo.postalAddress.city&&y&&y(h.userInfo.postalAddress.city),h.userInfo.birthFrenchDepartment&&_&&_(h.userInfo.birthFrenchDepartment))}}),[h])}({setFirstName:t,setLastName:i,setBirthLastName:j,setPhoneNumber:p,setEmail:_,setBnplEmail:g,setGender:S,setFormattedBirthDate:W,setPostalAddress:A,setZipCode:U,setCity:M,setBirthFrenchDepartment:K});var z={firstName:n,lastName:r,phoneNumber:d,email:y,bnplEmail:v,gender:b,postalAddress:I,city:L,zipCode:x,formattedBirthDate:F,birthLastName:G,birthFrenchDepartment:q,setFirstName:t,setLastName:i,setPhoneNumber:p,setBnplEmail:g,setGender:S,setPostalAddress:A,setCity:M,setZipCode:U,setFormattedBirthDate:W,setBirthLastName:j,setBirthFrenchDepartment:K},J=function(e){var n=e.firstName,t=e.lastName,o=e.birthLastName,r=e.phoneNumber,a=e.email,i=e.bnplEmail,s=e.gender,c=e.postalAddress,d=e.city,p=e.zipCode,f=e.formattedBirthDate,m=e.birthFrenchDepartment;return u.default.useMemo((function(){return!!(n&&k(n)&&t&&k(t)&&o&&k(o)&&r&&E(r)&&(a&&!w(a)||i&&O(i))&&s&&[l.Gender.Male,l.Gender.Female].includes(s)&&c&&d&&p&&N(p)&&5===p.length&&f&&P(f)&&m)}),[n,t,o,r,i,s,c,d,p,f,m])}(z);return{bnplUserInformation:z,isBnplUserInformationValid:J}},n.isPhoneNumberValid=E,n.checkShouldAskEmailForAppleUser=w,n.checkIsEmailValid=O,n.isFormattedBirthDateValid=P,n.checkDoesContainOnlyDigits=N,n.checkIsNameValid=k,n.formatPhoneNumber=function(e){return null==e?void 0:e.replace(/\s/g,"").replace(/^0([6-7](\d{2}){4})$/,"+".concat(l.PHONE_NUMBER_PREFIX_INDICATOR,"$1"))},n.useCreateUserBnplTransactionStartPollingAndHandleNavigation=function(e){var n=e.offerId,t=a(u.default.useState(void 0),2),o=t[0],r=t[1],i=C(o),s=i.userBnplTransaction,l=i.startPolling,p=i.stopPolling,f=a(u.default.useState(!1),2),m=f[0],_=f[1];return(0,d.useEligibilityNavigation)({userBnplTransaction:s,isLoading:m,setIsLoading:_,userBnplTransactionCreatedAt:o,offerId:n}),{createUserBnplTransactionStartPollingAndHandleNavigation:function(e){n&&function(e){var n=e.setUserBnplTransactionCreatedAt,t=e.startPollingUserBnplTransaction,o=e.stopPollingUserBnplTransaction,r=e.valueInCents,a=e.offerId,i=c.default.utc().milliseconds(0).toISOString();n(i),s={createdAt:i,amount:{valueInCents:r,currency:"EUR"},offerId:a},(0,y.sendMessageToBackgroundScript)({message:"createUserBnplTransaction",data:s}),t(),setTimeout((function(){return o()}),v);var s}({setUserBnplTransactionCreatedAt:r,startPollingUserBnplTransaction:l,stopPollingUserBnplTransaction:p,valueInCents:e,offerId:n})},userBnplTransactionCreatedAt:o,isLoading:m,setIsLoading:_}},n.checkIsBnplEnabledForOffer=function(e){var n,t;return null===(t=null===(n=e.browserExtension)||void 0===n?void 0:n.bnpl)||void 0===t?void 0:t.active},n.checkIsBnplEnabled=function(){return o(this,void 0,void 0,(function(){var e;return r(this,(function(n){switch(n.label){case 0:return(e=(0,f.checkIsOnMobileScreen)())?[4,(0,m.checkIsTemporaryUser)()]:[3,2];case 1:e=n.sent(),n.label=2;case 2:return e?[2,!1]:[2,(0,p.checkHasFeatureByPlatform)({desktopFeature:l.Feature.bnplEnabledDesktopBrowserExtensionNew,mobileFeature:l.Feature.bnplEnabledMobileBrowserExtensionNew})]}}))}))}},47615:function(e,n,t){var o=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(n,"__esModule",{value:!0}),n.useShouldUseBnplTopBar=n.useFloaPaymentNavigation=n.useCardNavigation=n.usePaymentSessionNavigation=n.useEligibilityNavigation=n.HAS_SEEN_BNPL_CARD_DETAILS_LOCAL_STORAGE_KEY=void 0;var r=o(t(96540)),a=t(55015),i=t(47248),s=t(14568),u=t(32668),c=t(74137),l=t(46239),d=t(74617),p=t(13897),f=t(97669);function m(){var e=(0,a.useHasFeature)(a.Feature.bnplTopBarInDesktopBrowserExtension),n=(0,a.useHasFeature)(a.Feature.bnplTopBarInMobileBrowserExtension),t=(0,u.checkIsOnMobileScreen)();return!t&&e||t&&n}n.HAS_SEEN_BNPL_CARD_DETAILS_LOCAL_STORAGE_KEY="hasSeenBnplCardDetails",n.useEligibilityNavigation=function(e){var n=e.userBnplTransaction,t=e.isLoading,o=e.setIsLoading,u=e.userBnplTransactionCreatedAt,c=e.offerId,d=r.default.useRef(void 0);!function(e){var n=e.userBnplTransaction,t=e.setIsLoading,o=e.eligibilityTimeoutHandleRef,u=e.userBnplTransactionCreatedAt,c=e.offerId,d=(0,p.useBnplNavigationContext)().setCurrentBnplScreenNameAndLogEvents;r.default.useEffect((function(){var e={offerId:c,userBnplTransactionCreatedAt:u};(0,s.checkIsFloaEligibilityAccepted)(n)?(t(!1),o.current&&clearTimeout(o.current),(0,l.sendMessageToBackgroundScript)({message:"logUserEvent",data:{event:{type:"floaEligibilityAccepted",payload:e}}}),(0,l.sendMessageToBackgroundScript)({message:"logAmplitudeEvent",data:{event:{type:"FLOA - Eligibility Accepted",properties:e}}}),d({screenName:a.BnplScreenName.eligibilityScheduleScreen})):(null==n?void 0:n.floaEligibility)&&!1===n.floaEligibility.hasAgreement&&(t(!1),(0,l.sendMessageToBackgroundScript)({message:"logUserEvent",data:{event:{type:"floaEligibilityRejected",payload:e}}}),(0,l.sendMessageToBackgroundScript)({message:"logAmplitudeEvent",data:{event:{type:"FLOA - Eligibility Rejected",properties:e}}}),d({screenName:a.BnplScreenName.cardErrorScreen,errorType:i.BnplErrorType.floaEligibilityRejected}))}),[n])}({userBnplTransaction:n,setIsLoading:o,eligibilityTimeoutHandleRef:d,userBnplTransactionCreatedAt:u,offerId:c}),function(e){var n=e.isLoading,t=e.eligibilityTimeoutHandleRef,o=e.userBnplTransactionCreatedAt,s=e.offerId,u=(0,p.useBnplNavigationContext)().setCurrentBnplScreenNameAndLogEvents;r.default.useEffect((function(){if(n)return t.current&&clearTimeout(t.current),t.current=setTimeout((function(){var e={offerId:s,userBnplTransactionCreatedAt:o};(0,l.sendMessageToBackgroundScript)({message:"logUserEvent",data:{event:{type:"floaEligibilityTimeout",payload:e}}}),(0,l.sendMessageToBackgroundScript)({message:"logAmplitudeEvent",data:{event:{type:"FLOA - Eligibility Timeout",properties:e}}}),u({screenName:a.BnplScreenName.cardErrorScreen,errorType:i.BnplErrorType.floaEligibilityTimeout})}),3e4),function(){t.current&&clearTimeout(t.current)}}),[n])}({isLoading:t,eligibilityTimeoutHandleRef:d,userBnplTransactionCreatedAt:u,offerId:c})},n.usePaymentSessionNavigation=function(e){var n=e.setIsLoading,t=e.userBnplTransactionCreatedAt,o=e.hasPressedContinue,u=(0,p.useBnplNavigationContext)(),c=u.offer,d=u.setCurrentBnplScreenNameAndLogEvents,f=(0,s.useUserBnplTransactionWithPolling)(t),m=f.userBnplTransaction,y=f.startPolling,_=f.stopPolling,h=r.default.useRef();r.default.useEffect((function(){o&&(y(),h.current=setTimeout((function(){var e={offerId:c.offerId,userBnplTransactionCreatedAt:t};(0,l.sendMessageToBackgroundScript)({message:"logUserEvent",data:{event:{type:"floaPaymentSessionCreationTimeout",payload:e}}}),(0,l.sendMessageToBackgroundScript)({message:"logAmplitudeEvent",data:{event:{type:"BNPL - Floa Payment Session Creation Timeout",properties:e}}}),_(),d({screenName:a.BnplScreenName.cardErrorScreen,errorType:i.BnplErrorType.floaPaymentSessionCreationTimeout})}),3e4))}),[o]),r.default.useEffect((function(){(0,s.checkIsFloaPaymentSessionReady)(m)&&(clearTimeout(h.current),_(),n(!1),d({screenName:a.BnplScreenName.floaPaymentScreen}))}),[m])},n.useCardNavigation=function(e){var t=(0,p.useBnplNavigationContext)(),o=t.offer,y=t.setCurrentBnplScreenNameAndLogEvents,_=t.closeBnplPanelAndLogEvents,h=(0,s.useUserBnplTransactionWithPolling)(e),v=h.userBnplTransaction,g=h.startPolling,C=h.stopPolling,b=r.default.useRef(),S=m(),T=(0,a.useHasFeature)(a.Feature.bnplNewCardReadyDisplayInExtensions),I=(0,a.useHasFeature)(a.Feature.shouldUseFactorizedBnplSubscriptionWidgetIntoPanelInExtensions),A=((0,f.usePanelDisplayContext)()||{bnpl:{}}).bnpl,E=A.setIsInBnplSubscription,w=A.setLastUserBnplTransaction;return r.default.useEffect((function(){g(),b.current=setTimeout((function(){var n={offerId:o.offerId,userBnplTransactionCreatedAt:e};(0,l.sendMessageToBackgroundScript)({message:"logUserEvent",data:{event:{type:"jokoCardCreationTimeout",payload:n}}}),(0,l.sendMessageToBackgroundScript)({message:"logAmplitudeEvent",data:{event:{type:"BNPL - Joko Card Creation Timeout",properties:n}}}),C(),y({screenName:a.BnplScreenName.cardErrorScreen,errorType:i.BnplErrorType.jokoCardCreationTimeout})}),3e4)}),[]),r.default.useEffect((function(){if(null==v?void 0:v.swanPaymentCard){var t=(0,u.checkIsOnMobileScreen)(),r={offerId:o.offerId,userBnplTransactionCreatedAt:e};(0,l.sendMessageToBackgroundScript)({message:"logUserEvent",data:{event:{type:"jokoCardCreationSuccess",payload:r}}}),(0,l.sendMessageToBackgroundScript)({message:"logAmplitudeEvent",data:{event:{type:"BNPL - Joko Card Creation Success",properties:r}}}),C(),clearTimeout(b.current),I&&(null==w||w(v));var i=setTimeout((0,c.withSentry)((function(){if(T){if(localStorage.setItem(n.HAS_SEEN_BNPL_CARD_DETAILS_LOCAL_STORAGE_KEY,"false"),I)return void(null==E||E(!1));_(!0),(0,d.displayPanelAndLogEvents)({offer:o,bnpl:{isBnplSectionEnabledForOffer:!0,lastUserBnplTransactionFromBnplSubscriptionWidget:v},isTemporaryUser:!1,userOfferActivationInfo:void 0,defaultPanelLocationOverride:{panelTab:a.PanelTab.offerDetails,offerDetailsSection:a.OfferDetailsSection.bnpl}},"bnplWidget")}else if(!t&&S&&e){if(I)return void(null==E||E(!1));var r={offer:o,userBnplTransactionCreatedAt:e};(0,l.sendMessageToBackgroundScript)({message:"displayBnplCardReadyWidget",data:r}),_(!0)}else y({screenName:a.BnplScreenName.cardReadyScreen})})),1250);return function(){return clearTimeout(i)}}}),[v]),v},n.useFloaPaymentNavigation=function(e){var n=e.offerId,t=e.userBnplTransaction,o=e.startPollingUserBnplTransaction,s=e.stopPollingUserBnplTransaction,u=(0,p.useBnplNavigationContext)().setCurrentBnplScreenNameAndLogEvents,c=r.default.useRef(void 0),d={offerId:n,userBnplTransactionCreatedAt:(null==t?void 0:t.createdAt)?t.createdAt:void 0};r.default.useEffect((function(){return o(),c.current=setTimeout((function(){(0,l.sendMessageToBackgroundScript)({message:"logUserEvent",data:{event:{type:"floaPaymentTimeout",payload:d}}}),(0,l.sendMessageToBackgroundScript)({message:"logAmplitudeEvent",data:{event:{type:"BNPL - Floa Payment Timeout",properties:d}}}),s(),u({screenName:a.BnplScreenName.cardErrorScreen,errorType:i.BnplErrorType.floaPaymentTimeout})}),3e5),function(){return clearTimeout(c.current)}}),[]),r.default.useEffect((function(){var e;if(null===(e=null==t?void 0:t.lastFloaPaymentSession)||void 0===e?void 0:e.status)switch(t.lastFloaPaymentSession.status){case"retryable":case"failed":s(),clearTimeout(c.current),u({screenName:a.BnplScreenName.cardErrorScreen,errorType:i.BnplErrorType.floaPaymentRejected}),(0,l.sendMessageToBackgroundScript)({message:"focusCurrentContentScriptTab"});break;case"succeeded":s(),clearTimeout(c.current),u({screenName:a.BnplScreenName.cardPendingScreen}),(0,l.sendMessageToBackgroundScript)({message:"focusCurrentContentScriptTab"})}}),[t])},n.useShouldUseBnplTopBar=m},94576:function(e,n,t){var o=this&&this.__read||function(e,n){var t="function"==typeof Symbol&&e[Symbol.iterator];if(!t)return e;var o,r,a=t.call(e),i=[];try{for(;(void 0===n||n-- >0)&&!(o=a.next()).done;)i.push(o.value)}catch(e){r={error:e}}finally{try{o&&!o.done&&(t=a.return)&&t.call(a)}finally{if(r)throw r.error}}return i},r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(n,"__esModule",{value:!0}),n.unmountBottomSheet=n.useBottomSheetContainerInnerState=n.useBottomSheetDisplay=void 0;var a=r(t(96540)),i=r(t(40961)),s=t(55015),u=t(17621),c=t(26368);function l(e){var n=(0,u.getHashedElementId)(u.JokoExtensionRootElement[e]),t=document.getElementById(n);null!==t&&(i.default.unmountComponentAtNode(t),t.remove())}n.useBottomSheetDisplay=function(){var e=o(a.default.useState(void 0),2),n=e[0],t=e[1],r=a.default.useCallback((function(){return t(!1)}),[]);return{isBottomSheetDisplayed:n,setIsBottomSheetDisplayed:t,closeBottomSheet:r}},n.useBottomSheetContainerInnerState=function(e,n,t,r,i){var d=(0,u.useHashedElementId)(e),p=o(a.default.useState(void 0),2),f=p[0],m=p[1],y=a.default.useCallback((function(){return setTimeout((function(){var e=n.current;e&&(m(e.clientHeight),r(!0))}),100)}),[]),_=a.default.useCallback((function(n,t){!1===t&&"transform"===n.propertyName&&l(e)}),[t]);!function(e){a.default.useEffect((function(){var e,n,t=(0,u.getHashedElementId)(u.JokoExtensionRootElement.snoozingBottomSheet),o=function(e){e.preventDefault(),e.stopPropagation()};return n=setTimeout((function(){if(null==(e=document.getElementById(t))?void 0:e.children){var n=null==e?void 0:e.children[0];(null==n?void 0:n.contentWindow)&&n.contentWindow.document.addEventListener("touchmove",o,{passive:!1})}}),100),function(){if(n&&clearTimeout(n),null==e?void 0:e.children){var t=null==e?void 0:e.children[0];(null==t?void 0:t.contentWindow)&&t.contentWindow.document.removeEventListener("touchmove",o)}}}),[e])}(d);var h=f?f-c.BOTTOM_SHEET_BAR_HEIGHT:0,v=(0,s.useMakeMobileBottomSheetSlidable)({onSlideToBottom:function(){r(!1),null==i||i()},maximumTopOffset:h,initialTopOffset:0,isMobileExtension:!0,shouldSetTopOffsetToMaximumValueOnDragToBottom:!0}),g=v.topOffset,C=v.isBeingDragged,b=v.onDragListener,S=v.onPressListener,T=v.onReleaseListener;return{onBottomSheetTransitionEnd:_,height:f,elementId:d,handleMountedBottomSheetInnerContainer:y,topOffset:C?t?g:Math.min(h,h+g):t?0:h,isBeingDragged:C,onDragListener:b,onPressListener:S,onReleaseListener:T}},n.unmountBottomSheet=l},2073:function(e,n,t){var o=this&&this.__assign||function(){return o=Object.assign||function(e){for(var n,t=1,o=arguments.length;t<o;t++)for(var r in n=arguments[t])Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r]);return e},o.apply(this,arguments)},r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(n,"__esModule",{value:!0}),n.displaySnoozingBottomSheet=void 0;var a=r(t(96540)),i=r(t(40961)),s=t(55015),u=t(17621),c=r(t(92328)),l=r(t(40549));n.displaySnoozingBottomSheet=function(e){var n=e.offer,t=e.closingActionOnSnoozing,r=e.widgetInnerContainerRef,d=e.panelInnerContainerRef,p=document.createElement("div");p.id=(0,u.getHashedElementId)(u.JokoExtensionRootElement.snoozingBottomSheet),document.documentElement.appendChild(p),i.default.render(a.default.createElement(l.default,null,a.default.createElement(s.LocalesContextProvider,null,a.default.createElement(c.default,o({},{offer:n,closingActionOnSnoozing:t,widgetInnerContainerRef:r,panelInnerContainerRef:d})))),p)}},31814:function(e,n,t){var o=this&&this.__awaiter||function(e,n,t,o){return new(t||(t=Promise))((function(r,a){function i(e){try{u(o.next(e))}catch(e){a(e)}}function s(e){try{u(o.throw(e))}catch(e){a(e)}}function u(e){var n;e.done?r(e.value):(n=e.value,n instanceof t?n:new t((function(e){e(n)}))).then(i,s)}u((o=o.apply(e,n||[])).next())}))},r=this&&this.__generator||function(e,n){var t,o,r,a,i={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return a={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function s(s){return function(u){return function(s){if(t)throw new TypeError("Generator is already executing.");for(;a&&(a=0,s[0]&&(i=0)),i;)try{if(t=1,o&&(r=2&s[0]?o.return:s[0]?o.throw||((r=o.return)&&r.call(o),0):o.next)&&!(r=r.call(o,s[1])).done)return r;switch(o=0,r&&(s=[2&s[0],r.value]),s[0]){case 0:case 1:r=s;break;case 4:return i.label++,{value:s[1],done:!1};case 5:i.label++,o=s[1],s=[0];continue;case 7:s=i.ops.pop(),i.trys.pop();continue;default:if(!(r=i.trys,(r=r.length>0&&r[r.length-1])||6!==s[0]&&2!==s[0])){i=0;continue}if(3===s[0]&&(!r||s[1]>r[0]&&s[1]<r[3])){i.label=s[1];break}if(6===s[0]&&i.label<r[1]){i.label=r[1],r=s;break}if(r&&i.label<r[2]){i.label=r[2],i.ops.push(s);break}r[2]&&i.ops.pop(),i.trys.pop();continue}s=n.call(e,i)}catch(e){s=[6,e],o=0}finally{t=r=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,u])}}},a=this&&this.__read||function(e,n){var t="function"==typeof Symbol&&e[Symbol.iterator];if(!t)return e;var o,r,a=t.call(e),i=[];try{for(;(void 0===n||n-- >0)&&!(o=a.next()).done;)i.push(o.value)}catch(e){r={error:e}}finally{try{o&&!o.done&&(t=a.return)&&t.call(a)}finally{if(r)throw r.error}}return i},i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(n,"__esModule",{value:!0}),n.handlePostLoadingAdBlockerDetection=n.useAdBlockerDetectionInOfferWidget=void 0;var s=i(t(96540)),u=t(55015),c=t(17621),l=t(74137),d=t(46239);function p(e){(0,d.sendMessageToBackgroundScript)({message:"logUserEvent",data:{event:{type:"adBlockerDetected",payload:{from:e}}}}),(0,d.sendMessageToBackgroundScript)({message:"logAmplitudeEvent",data:{event:{type:"Offers - Ad Blocker Detected",properties:{from:e}}}})}n.useAdBlockerDetectionInOfferWidget=function(){var e=a(s.default.useState(void 0),2),n=e[0],t=e[1];return s.default.useEffect((function(){m().then((function(e){e&&p("browserExtensionOfferWidget"),t(e)}))}),[]),n};var f=250;function m(){var e;return o(this,void 0,void 0,(function(){var n;return r(this,(function(t){switch(t.label){case 0:return[4,(0,u.getSetting)(u.SettingKey.adBlockerDetectionAssetUrl)];case 1:return n=null!==(e=t.sent())&&void 0!==e?e:u.DEFAULT_AD_BLOCKER_DETECTION_ASSET_URL,[2,new Promise((function(e){var t=(0,c.getHashedElementId)(c.JokoExtensionRootElement.adBlockerDetectionIframe),o=setTimeout((function(){e(!1),y(t),chrome.runtime.onMessage.removeListener(r)}),f),r=(0,l.withSentry)((function(n){"adBlockerDetected"===n.message&&(clearTimeout(o),e(!0),y(t),chrome.runtime.onMessage.removeListener(r))}));chrome.runtime.onMessage.addListener(r),function(e){var n=e.iframeId,t=e.adBlockerDetectionAssetUrl,o=document.createElement("iframe");o.id=n,o.src=t,o.style.display="none",document.documentElement.append(o)}({iframeId:t,adBlockerDetectionAssetUrl:n})}))]}}))}))}function y(e){var n=document.getElementById(e);n&&n.remove()}n.handlePostLoadingAdBlockerDetection=function(e){return o(this,void 0,void 0,(function(){var n,t,o;return r(this,(function(r){switch(r.label){case 0:return(null==e?void 0:e.offerId)?(n=e.offerId,[4,(0,u.getLocalStorageItem)(u.LocalStorageKey.offerActivatedInSessionTimestampMsMap)]):[2];case 1:return(null==(t=r.sent())?void 0:t[n])?(o=t[n],Date.now()-o>3e3?[2]:[4,m()]):[2];case 2:return r.sent()&&p("browserExtensionPostLoadingCheck"),[2]}}))}))}},7444:function(e,n,t){var o=this&&this.__awaiter||function(e,n,t,o){return new(t||(t=Promise))((function(r,a){function i(e){try{u(o.next(e))}catch(e){a(e)}}function s(e){try{u(o.throw(e))}catch(e){a(e)}}function u(e){var n;e.done?r(e.value):(n=e.value,n instanceof t?n:new t((function(e){e(n)}))).then(i,s)}u((o=o.apply(e,n||[])).next())}))},r=this&&this.__generator||function(e,n){var t,o,r,a,i={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return a={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function s(s){return function(u){return function(s){if(t)throw new TypeError("Generator is already executing.");for(;a&&(a=0,s[0]&&(i=0)),i;)try{if(t=1,o&&(r=2&s[0]?o.return:s[0]?o.throw||((r=o.return)&&r.call(o),0):o.next)&&!(r=r.call(o,s[1])).done)return r;switch(o=0,r&&(s=[2&s[0],r.value]),s[0]){case 0:case 1:r=s;break;case 4:return i.label++,{value:s[1],done:!1};case 5:i.label++,o=s[1],s=[0];continue;case 7:s=i.ops.pop(),i.trys.pop();continue;default:if(!(r=i.trys,(r=r.length>0&&r[r.length-1])||6!==s[0]&&2!==s[0])){i=0;continue}if(3===s[0]&&(!r||s[1]>r[0]&&s[1]<r[3])){i.label=s[1];break}if(6===s[0]&&i.label<r[1]){i.label=r[1],r=s;break}if(r&&i.label<r[2]){i.label=r[2],i.ops.push(s);break}r[2]&&i.ops.pop(),i.trys.pop();continue}s=n.call(e,i)}catch(e){s=[6,e],o=0}finally{t=r=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,u])}}},a=this&&this.__read||function(e,n){var t="function"==typeof Symbol&&e[Symbol.iterator];if(!t)return e;var o,r,a=t.call(e),i=[];try{for(;(void 0===n||n-- >0)&&!(o=a.next()).done;)i.push(o.value)}catch(e){r={error:e}}finally{try{o&&!o.done&&(t=a.return)&&t.call(a)}finally{if(r)throw r.error}}return i},i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(n,"__esModule",{value:!0}),n.getUserFeaturesMapWithTimeout=n.useAppFeature=n.checkHasFeatureByPlatform=void 0;var s=i(t(96540)),u=t(55015),c=t(58029),l=t(55071),d=t(32668),p=t(74137);n.checkHasFeatureByPlatform=function(e){var n=e.desktopFeature,t=e.mobileFeature;return o(this,void 0,void 0,(function(){var e,o;return r(this,(function(r){switch(r.label){case 0:return(0,d.checkIsOnMobileScreen)()?(e=t)?[4,(0,u.checkHasFeature)(t)]:[3,2]:[3,3];case 1:e=r.sent(),r.label=2;case 2:return[2,!!e];case 3:return(o=n)?[4,(0,u.checkHasFeature)(n)]:[3,5];case 4:o=r.sent(),r.label=5;case 5:return[2,!!o]}}))}))},n.useAppFeature=function(e){var n=a(s.default.useState(!1),2),t=n[0],o=n[1];return s.default.useEffect((function(){(0,u.checkHasFeature)(e).then(o)}),[]),t};n.getUserFeaturesMapWithTimeout=function(e){var n;return void 0===e&&(e=500),o(this,void 0,void 0,(function(){var t,o;return r(this,(function(r){switch(r.label){case 0:return r.trys.push([0,2,,3]),[4,(0,l.wrapPromiseWithTimeout)((0,c.getUserFeaturesMap)(),e)];case 1:return t=null!==(n=r.sent())&&void 0!==n?n:{},[3,3];case 2:return o=r.sent(),(0,p.captureSentryException)(o),console.error(o),t={},[3,3];case 3:return[2,t]}}))}))}},40334:function(e,n,t){var o=this&&this.__awaiter||function(e,n,t,o){return new(t||(t=Promise))((function(r,a){function i(e){try{u(o.next(e))}catch(e){a(e)}}function s(e){try{u(o.throw(e))}catch(e){a(e)}}function u(e){var n;e.done?r(e.value):(n=e.value,n instanceof t?n:new t((function(e){e(n)}))).then(i,s)}u((o=o.apply(e,n||[])).next())}))},r=this&&this.__generator||function(e,n){var t,o,r,a,i={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return a={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function s(s){return function(u){return function(s){if(t)throw new TypeError("Generator is already executing.");for(;a&&(a=0,s[0]&&(i=0)),i;)try{if(t=1,o&&(r=2&s[0]?o.return:s[0]?o.throw||((r=o.return)&&r.call(o),0):o.next)&&!(r=r.call(o,s[1])).done)return r;switch(o=0,r&&(s=[2&s[0],r.value]),s[0]){case 0:case 1:r=s;break;case 4:return i.label++,{value:s[1],done:!1};case 5:i.label++,o=s[1],s=[0];continue;case 7:s=i.ops.pop(),i.trys.pop();continue;default:if(!(r=i.trys,(r=r.length>0&&r[r.length-1])||6!==s[0]&&2!==s[0])){i=0;continue}if(3===s[0]&&(!r||s[1]>r[0]&&s[1]<r[3])){i.label=s[1];break}if(6===s[0]&&i.label<r[1]){i.label=r[1],r=s;break}if(r&&i.label<r[2]){i.label=r[2],i.ops.push(s);break}r[2]&&i.ops.pop(),i.trys.pop();continue}s=n.call(e,i)}catch(e){s=[6,e],o=0}finally{t=r=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,u])}}},a=this&&this.__values||function(e){var n="function"==typeof Symbol&&Symbol.iterator,t=n&&e[n],o=0;if(t)return t.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&o>=e.length&&(e=void 0),{value:e&&e[o++],done:!e}}};throw new TypeError(n?"Object is not iterable.":"Symbol.iterator is not defined.")};Object.defineProperty(n,"__esModule",{value:!0}),n.getUserRegion=n.blockRedirectsToMerchantApps=void 0;var i=t(55015),s=t(7444),u=t(32668),c=t(46239);n.blockRedirectsToMerchantApps=function(){return o(this,void 0,void 0,(function(){var e;return r(this,(function(n){switch(n.label){case 0:return(0,u.checkIsOnMobileScreen)()?[4,(0,s.checkHasFeatureByPlatform)({mobileFeature:i.Feature.appRedirectsBlockingMobileSafariExtension})]:[2];case 1:return n.sent()?[4,d()]:[2];case 2:return(e=n.sent())?[4,new Promise((function(e){return setTimeout(e,1e3)}))]:[2];case 3:return n.sent(),Array.isArray(e.blockedCustomUrlSchemes)&&e.blockedCustomUrlSchemes.length>0&&function(e){var n,t,s,u,l=this,d=e.map((function(e){return e.toLowerCase()})).filter((function(e){return/^[a-z0-9-]+:/.test(e)}));if(0===d.length)return;try{for(var f=a(d),y=f.next();!y.done;y=f.next()){var _=y.value,h=document.querySelectorAll('a[href^="'.concat(_,'"]')),v=function(e){var n=e.getAttribute("href"),t=!0;if(!n)return"continue";e.addEventListener("click",(function(){return o(l,void 0,void 0,(function(){var e,o;return r(this,(function(r){switch(r.label){case 0:return o=i.getLocalizedTexts,[4,p()];case 1:return e=o.apply(void 0,[r.sent()]).contentscript.appRedirectsBlockingMessages.confirmationPopup,window.confirm(e)?(m({url:n,redirectType:"customUrlScheme",hasConfirmedRedirect:!0}),t?(t=!1,window.location.href=n):(0,c.sendMessageToBackgroundScript)({message:"openTab",data:{url:n}})):m({url:n,redirectType:"customUrlScheme",hasConfirmedRedirect:!1}),[2]}}))}))})),e.setAttribute("href","#")};try{for(var g=(s=void 0,a(Array.from(h))),C=g.next();!C.done;C=g.next()){v(C.value)}}catch(e){s={error:e}}finally{try{C&&!C.done&&(u=g.return)&&u.call(g)}finally{if(s)throw s.error}}}}catch(e){n={error:e}}finally{try{y&&!y.done&&(t=f.return)&&t.call(f)}finally{if(n)throw n.error}}}(e.blockedCustomUrlSchemes),Array.isArray(e.blockedUniversalLinkDomains)&&e.blockedUniversalLinkDomains.length>0&&function(e){var n,t,o,r,i,s;try{for(var u=a(e),c=u.next();!c.done;c=u.next()){var l=c.value;if(/^([a-z0-9-]+\.)?[a-z0-9-]+\.[a-z0-9-]+$/.test(l)){var d=["http://".concat(l),"https://".concat(l),"http://www.".concat(l),"https://www.".concat(l)];if(!d.some((function(e){return window.location.href.startsWith(e)})))try{for(var p=(o=void 0,a(d)),y=p.next();!y.done;y=p.next()){var _=y.value,h=document.querySelectorAll('a[href^="'.concat(_,'"]')),v=function(e){var n=e.getAttribute("href");if(!n)return"continue";"#mock-anchor"!==n&&(e.addEventListener("click",(function(){m({url:n,redirectType:"universalLink"}),f(n)}),{capture:!0}),e.setAttribute("href","#mock-anchor"))};try{for(var g=(i=void 0,a(Array.from(h))),C=g.next();!C.done;C=g.next()){v(C.value)}}catch(e){i={error:e}}finally{try{C&&!C.done&&(s=g.return)&&s.call(g)}finally{if(i)throw i.error}}}}catch(e){o={error:e}}finally{try{y&&!y.done&&(r=p.return)&&r.call(p)}finally{if(o)throw o.error}}}}}catch(e){n={error:e}}finally{try{c&&!c.done&&(t=u.return)&&t.call(u)}finally{if(n)throw n.error}}}(e.blockedUniversalLinkDomains),[2]}}))}))};var l=3e6;function d(){return o(this,void 0,void 0,(function(){var e;return r(this,(function(n){switch(n.label){case 0:return[4,(0,i.getSetting)(i.SettingKey.mobileSafariExtensionAppRedirectsBlockingSettings,l)];case 1:return(e=n.sent())&&"object"==typeof e?[2,e]:[2,void 0]}}))}))}function p(){return o(this,void 0,void 0,(function(){var e;return r(this,(function(n){switch(n.label){case 0:return[4,(0,i.getLocalStorageItem)(i.LocalStorageKey.userRegion)];case 1:return(e=n.sent())?[2,e]:[2,(0,i.getRegionFromBrowserLanguage)()]}}))}))}function f(e){return o(this,void 0,void 0,(function(){var n;return r(this,(function(t){switch(t.label){case 0:return n=new Promise((function(n){return(0,c.sendMessageToBackgroundScript)({message:"openUrlInCurrentTab",data:{url:e}},(function(){return n(!0)}))})),[4,Promise.race([n,new Promise((function(e){return setTimeout((function(){return e(!1)}),500)}))])];case 1:return!t.sent()&&(window.location.href=e),[2]}}))}))}function m(e){var n={url:e.url,redirectType:e.redirectType,hasConfirmedRedirect:e.hasConfirmedRedirect};(0,c.sendMessageToBackgroundScript)({message:"logUserEvent",data:{event:{type:"appRedirectBlocked",payload:n}}}),(0,c.sendMessageToBackgroundScript)({message:"logAmplitudeEvent",data:{event:{type:"Navigation - App Redirect Blocked",properties:n}}})}n.getUserRegion=p},47175:(e,n,t)=>{var o;Object.defineProperty(n,"__esModule",{value:!0}),n.SPINNER_ICON_URL=n.SHOPPING_BAG_GREEN_ICON_URL=n.SHOPPING_BAG_ICON_URL=n.JOKO_CARD_MINIMIZED_ICON_URL=n.COUPON_WHITE_ICON_URL=n.COUPON_WITHOUT_PERCENT_ICON_URL=n.GEAR_ICON_URL=n.USER_SILHOUETTE_GREEN_ICON_URL=n.USER_SILHOUETTE_ICON_URL=n.REDIRECTION_ICON_URL=n.LIGHTNING_BOLT_FILLED_CIRCLE_GREEN_ICON_URL=n.LIGHTNING_BOLT_FILLED_CIRCLE_BLACK_ICON_URL=n.MAGNIFYING_GLASS_WITH_SQUARE_GREEN_ICON_URL=n.MAGNIFYING_GLASS_WITH_SQUARE_ICON_URL=n.MAGNIFYING_GLASS_ICON_URL=n.CREDIT_CARD_ICON_URL=n.INFO_CIRCLE_BLACK_ICON_URL=n.WARNING_TRIANGLE_RED_ICON_URL=n.BOOK_OPEN_BLACK_ICON_URL=n.EMPTY_CHECKBOX_ICON_URL=n.TRASH_CAN_ICON_URL=n.COPY_BUTTON_PURPLE_ICON_URL=n.NOTIFICATION_OFF_ICON_URL=n.CLOCK_GRAY_ICON_URL=n.CLOCK_BLACK_ICON_URL=n.RADIO_BUTTON_UNCHECKED_GRAY=n.RADIO_BUTTON_CHECKED_GREEN=n.CHECK_MARK_PURPLE_ICON_URL=n.CHECK_MARK_GREEN_ICON_URL=n.CHECK_MARK_BLACK_ICON_URL=n.CHECK_MARK_FILLED_ROUND_GREEN_ICON_URL=n.CHECK_MARK_FILLED_GREEN_ICON_URL=n.STOPWATCH_BLACK_ICON_URL=n.SETTINGS_WHEEL_ICON_URL=n.LOGIN_PADLOCK_GREEN_ICON_URL=n.LOGIN_PADLOCK_WHITE_ICON_URL=n.COOKIE_ICON_URL=n.THREE_DOTS_GRAY_ICON_URL=n.THREE_DOTS_ICON_URL=n.FOUR_DOTS_ICON_URL=n.ARROW_RIGHT_BLACK_ICON_URL=n.CHEVRON_LEFT_STRAIGHT_ICON_URL=n.CHEVRON_RIGHT_THIN_ROUND_ICON_URL=n.CHEVRON_DOWN_ICON_URL=n.CROSS_BLACK_ICON_URL=n.LOGO_WITH_TITLE_WHITE_IMAGE_URL=n.OLD_LOGO_WITH_TITLE_IMAGE_URL=n.LOGO_WITH_TITLE_IMAGE_URL=n.LOGO_WHITE_IMAGE_URL=n.LOGO_IMAGE_URL=void 0,n.AMBIT_BLACK_ITALIC_FONT_URL=n.AMBIT_BLACK_FONT_URL=n.AMBIT_BOLD_ITALIC_FONT_URL=n.AMBIT_BOLD_FONT_URL=n.AMBIT_SEMI_BOLD_ITALIC_FONT_URL=n.AMBIT_SEMI_BOLD_FONT_URL=n.AMBIT_LIGHT_ITALIC_FONT_URL=n.AMBIT_LIGHT_FONT_URL=n.AMBIT_EXTRA_LIGHT_ITALIC_FONT_URL=n.AMBIT_EXTRA_LIGHT_FONT_URL=n.AMBIT_THIN_ITALIC_FONT_URL=n.AMBIT_THIN_FONT_URL=n.AMBIT_ITALIC_FONT_URL=n.AMBIT_REGULAR_FONT_URL=n.STEPS_TO_COMPLETE_VERTICAL_SOLID_LINES_ILLUSTRATION_URL=n.STEPS_TO_COMPLETE_VERTICAL_ILLUSTRATION_URL=n.HORIZONTAL_BAR_GRAY_ILLUSTRATION_URL=n.HORIZONTAL_BAR_GREEN_ILLUSTRATION_URL=n.JOKO_CARD_BARE_ILLUSTRATION_URL=n.JOKO_CARD_TILTED_ILLUSTRATION_URL=n.JOKO_CARD_ILLUSTRATION_URL=n.PRICE_TRACKING_GRAPH_LOADING_PLACEHOLDER_ILLUSTRATION_URL=n.LIGHTNING_BOLT_PURPLE_ILLUSTRATION_URL=n.COUPY_SUCCESS_ILLUSTRATION_URL=n.COUPY_SHADOW_ILLUSTRATION_URL=n.COUPY_MEDITATING_ILLUSTRATION_URL=n.COUPY_NO_SAVINGS_ILLUSTRATION_URL=n.COUPY_ERROR_ILLUSTRATION_URL=n.COUPY_WAVING_LEFT_ARM_ILLUSTRATION_URL=n.COUPY_WAVING_WITHOUT_LEFT_ARM_ILLUSTRATION_URL=n.OFFER_PLACEHOLDER_ILLUSTRATION_URL=n.SEARCH_ENGINE_ACTIVATE_OFFER_BUTTON_ICON_URL=n.SEARCH_ENGINE_SHOP_BUTTON_ICON_URL=n.THREE_TIMES_ICON_URL=n.PRICE_TRACKING_GRAY_ICON_URL=n.PRICE_TRACKING_ICON_URL=void 0;var r=t(55015),a=(0,t(24543).getExtensionAssetUrl)("/assets");n.LOGO_IMAGE_URL="".concat(a,"/logo.svg"),n.LOGO_WHITE_IMAGE_URL="".concat(a,"/logo-white.svg"),n.LOGO_WITH_TITLE_IMAGE_URL="".concat(a,"/logo-with-title.png"),n.OLD_LOGO_WITH_TITLE_IMAGE_URL="".concat(a,"/old-logo-with-title.png"),n.LOGO_WITH_TITLE_WHITE_IMAGE_URL="".concat(a,"/logo-with-title-white.svg"),n.CROSS_BLACK_ICON_URL="".concat(a,"/cross-black.svg"),n.CHEVRON_DOWN_ICON_URL="".concat(a,"/chevron.svg"),n.CHEVRON_RIGHT_THIN_ROUND_ICON_URL="".concat(a,"/chevron-thin-round-right.svg"),n.CHEVRON_LEFT_STRAIGHT_ICON_URL="".concat(a,"/chevron-straight-left.svg"),n.ARROW_RIGHT_BLACK_ICON_URL="".concat(a,"/arrow-right-black.png"),n.FOUR_DOTS_ICON_URL="".concat(a,"/four-dots.svg"),n.THREE_DOTS_ICON_URL="".concat(a,"/three-dots.svg"),n.THREE_DOTS_GRAY_ICON_URL="".concat(a,"/three-dots-gray.svg"),n.COOKIE_ICON_URL="".concat(a,"/cookie.png"),n.LOGIN_PADLOCK_WHITE_ICON_URL="".concat(a,"/login-padlock-white.svg"),n.LOGIN_PADLOCK_GREEN_ICON_URL="".concat(a,"/login-padlock-green.svg"),n.SETTINGS_WHEEL_ICON_URL="".concat(a,"/settings-wheel.svg"),n.STOPWATCH_BLACK_ICON_URL="".concat(a,"/stopwatch-black.svg"),n.CHECK_MARK_FILLED_GREEN_ICON_URL="".concat(a,"/check-mark-filled-green.svg"),n.CHECK_MARK_FILLED_ROUND_GREEN_ICON_URL="".concat(a,"/check-mark-filled-round-green.svg"),n.CHECK_MARK_BLACK_ICON_URL="".concat(a,"/check-mark-black.svg"),n.CHECK_MARK_GREEN_ICON_URL="".concat(a,"/check-mark-green.svg"),n.CHECK_MARK_PURPLE_ICON_URL="".concat(a,"/check-mark-purple.svg"),n.RADIO_BUTTON_CHECKED_GREEN="".concat(a,"/radio-button-checked-green.svg"),n.RADIO_BUTTON_UNCHECKED_GRAY="".concat(a,"/radio-button-unchecked-gray.svg"),n.CLOCK_BLACK_ICON_URL="".concat(a,"/clock-black.svg"),n.CLOCK_GRAY_ICON_URL="".concat(a,"/clock-gray.svg"),n.NOTIFICATION_OFF_ICON_URL="".concat(a,"/notification-off.svg"),n.COPY_BUTTON_PURPLE_ICON_URL="".concat(a,"/copy-button-purple.svg"),n.TRASH_CAN_ICON_URL="".concat(a,"/trash-can.svg"),n.EMPTY_CHECKBOX_ICON_URL="".concat(a,"/checkbox-empty.svg"),n.BOOK_OPEN_BLACK_ICON_URL="".concat(a,"/book-open-black.png"),n.WARNING_TRIANGLE_RED_ICON_URL="".concat(a,"/warning-triangle-red.svg"),n.INFO_CIRCLE_BLACK_ICON_URL="".concat(a,"/info-circle-black.png"),n.CREDIT_CARD_ICON_URL="".concat(a,"/credit-card.svg"),n.MAGNIFYING_GLASS_ICON_URL="".concat(a,"/magnifying-glass.svg"),n.MAGNIFYING_GLASS_WITH_SQUARE_ICON_URL="".concat(a,"/magnifying-glass-with-square.svg"),n.MAGNIFYING_GLASS_WITH_SQUARE_GREEN_ICON_URL="".concat(a,"/magnifying-glass-with-square-green.svg"),n.LIGHTNING_BOLT_FILLED_CIRCLE_BLACK_ICON_URL="".concat(a,"/lightning-bolt-filled-circle-black.svg"),n.LIGHTNING_BOLT_FILLED_CIRCLE_GREEN_ICON_URL="".concat(a,"/lightning-bolt-filled-circle-green.svg"),n.REDIRECTION_ICON_URL="".concat(a,"/redirection.svg"),n.USER_SILHOUETTE_ICON_URL="".concat(a,"/user-silhouette.svg"),n.USER_SILHOUETTE_GREEN_ICON_URL="".concat(a,"/user-silhouette-green.svg"),n.GEAR_ICON_URL="".concat(a,"/gear.svg"),n.COUPON_WITHOUT_PERCENT_ICON_URL="".concat(a,"/coupon-without-percent.svg"),n.COUPON_WHITE_ICON_URL="".concat(a,"/coupon-white.svg"),n.JOKO_CARD_MINIMIZED_ICON_URL="".concat(a,"/joko-card-minimized.svg"),n.SHOPPING_BAG_ICON_URL="".concat(a,"/shopping-bag.svg"),n.SHOPPING_BAG_GREEN_ICON_URL="".concat(a,"/shopping-bag-green.svg"),n.SPINNER_ICON_URL="".concat(a,"/spinner.png"),n.PRICE_TRACKING_ICON_URL="".concat(a,"/price-tracking.svg"),n.PRICE_TRACKING_GRAY_ICON_URL="".concat(a,"/price-tracking-gray.svg"),n.THREE_TIMES_ICON_URL="".concat(a,"/three-times.svg"),n.SEARCH_ENGINE_SHOP_BUTTON_ICON_URL="".concat(a,"/search-engine-shop-offer-button.svg"),n.SEARCH_ENGINE_ACTIVATE_OFFER_BUTTON_ICON_URL=((o={})[r.Region.FR]="".concat(a,"/search-engine-activate-offer-button.svg"),o[r.Region.US]="".concat(a,"/search-engine-activate-offer-button-us.svg"),o[r.Region.GB]="".concat(a,"/search-engine-activate-offer-button-us.svg"),o),n.OFFER_PLACEHOLDER_ILLUSTRATION_URL="".concat(a,"/offer-placeholder.svg"),n.COUPY_WAVING_WITHOUT_LEFT_ARM_ILLUSTRATION_URL="".concat(a,"/coupy-waving-without-left-arm.png"),n.COUPY_WAVING_LEFT_ARM_ILLUSTRATION_URL="".concat(a,"/coupy-waving-left-arm.svg"),n.COUPY_ERROR_ILLUSTRATION_URL="".concat(a,"/coupy-error.svg"),n.COUPY_NO_SAVINGS_ILLUSTRATION_URL="".concat(a,"/coupy-no-savings.png"),n.COUPY_MEDITATING_ILLUSTRATION_URL="".concat(a,"/coupy-meditating.svg"),n.COUPY_SHADOW_ILLUSTRATION_URL="".concat(a,"/coupy-shadow.svg"),n.COUPY_SUCCESS_ILLUSTRATION_URL="".concat(a,"/coupy-success.png"),n.LIGHTNING_BOLT_PURPLE_ILLUSTRATION_URL="".concat(a,"/lightning-bolt-purple.svg"),n.PRICE_TRACKING_GRAPH_LOADING_PLACEHOLDER_ILLUSTRATION_URL="".concat(a,"/price-tracking-graph-loading-placeholder.svg"),n.JOKO_CARD_ILLUSTRATION_URL="".concat(a,"/joko-card.png"),n.JOKO_CARD_TILTED_ILLUSTRATION_URL="".concat(a,"/joko-card-tilted.png"),n.JOKO_CARD_BARE_ILLUSTRATION_URL="".concat(a,"/joko-card-bare.png"),n.HORIZONTAL_BAR_GREEN_ILLUSTRATION_URL="".concat(a,"/horizontal-bar-green.svg"),n.HORIZONTAL_BAR_GRAY_ILLUSTRATION_URL="".concat(a,"/horizontal-bar-gray.svg"),n.STEPS_TO_COMPLETE_VERTICAL_ILLUSTRATION_URL="".concat(a,"/steps-to-complete-vertical.svg"),n.STEPS_TO_COMPLETE_VERTICAL_SOLID_LINES_ILLUSTRATION_URL="".concat(a,"/steps-to-complete-vertical-solid-lines.svg"),n.AMBIT_REGULAR_FONT_URL="".concat(a,"/Ambit-Regular.ttf"),n.AMBIT_ITALIC_FONT_URL="".concat(a,"/Ambit-Italic.ttf"),n.AMBIT_THIN_FONT_URL="".concat(a,"/Ambit-Thin.ttf"),n.AMBIT_THIN_ITALIC_FONT_URL="".concat(a,"/Ambit-ThinItalic.ttf"),n.AMBIT_EXTRA_LIGHT_FONT_URL="".concat(a,"/Ambit-ExtraLight.ttf"),n.AMBIT_EXTRA_LIGHT_ITALIC_FONT_URL="".concat(a,"/Ambit-ExtraLightItalic.ttf"),n.AMBIT_LIGHT_FONT_URL="".concat(a,"/Ambit-Light.ttf"),n.AMBIT_LIGHT_ITALIC_FONT_URL="".concat(a,"/Ambit-LightItalic.ttf"),n.AMBIT_SEMI_BOLD_FONT_URL="".concat(a,"/Ambit-SemiBold.ttf"),n.AMBIT_SEMI_BOLD_ITALIC_FONT_URL="".concat(a,"/Ambit-SemiBoldItalic.ttf"),n.AMBIT_BOLD_FONT_URL="".concat(a,"/Ambit-Bold.ttf"),n.AMBIT_BOLD_ITALIC_FONT_URL="".concat(a,"/Ambit-BoldItalic.ttf"),n.AMBIT_BLACK_FONT_URL="".concat(a,"/Ambit-Black.ttf"),n.AMBIT_BLACK_ITALIC_FONT_URL="".concat(a,"/Ambit-BlackItalic.ttf")},70992:function(e,n,t){var o=this&&this.__awaiter||function(e,n,t,o){return new(t||(t=Promise))((function(r,a){function i(e){try{u(o.next(e))}catch(e){a(e)}}function s(e){try{u(o.throw(e))}catch(e){a(e)}}function u(e){var n;e.done?r(e.value):(n=e.value,n instanceof t?n:new t((function(e){e(n)}))).then(i,s)}u((o=o.apply(e,n||[])).next())}))},r=this&&this.__generator||function(e,n){var t,o,r,a,i={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return a={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function s(s){return function(u){return function(s){if(t)throw new TypeError("Generator is already executing.");for(;a&&(a=0,s[0]&&(i=0)),i;)try{if(t=1,o&&(r=2&s[0]?o.return:s[0]?o.throw||((r=o.return)&&r.call(o),0):o.next)&&!(r=r.call(o,s[1])).done)return r;switch(o=0,r&&(s=[2&s[0],r.value]),s[0]){case 0:case 1:r=s;break;case 4:return i.label++,{value:s[1],done:!1};case 5:i.label++,o=s[1],s=[0];continue;case 7:s=i.ops.pop(),i.trys.pop();continue;default:if(!(r=i.trys,(r=r.length>0&&r[r.length-1])||6!==s[0]&&2!==s[0])){i=0;continue}if(3===s[0]&&(!r||s[1]>r[0]&&s[1]<r[3])){i.label=s[1];break}if(6===s[0]&&i.label<r[1]){i.label=r[1],r=s;break}if(r&&i.label<r[2]){i.label=r[2],i.ops.push(s);break}r[2]&&i.ops.pop(),i.trys.pop();continue}s=n.call(e,i)}catch(e){s=[6,e],o=0}finally{t=r=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,u])}}};Object.defineProperty(n,"__esModule",{value:!0}),n.updateCognitoPhoneNumber=n.checkIsSignedIn=void 0;var a=t(55015),i=t(46239);n.checkIsSignedIn=function(){return o(this,void 0,void 0,(function(){return r(this,(function(e){switch(e.label){case 0:return[4,(0,a.getLocalStorageItem)(a.LocalStorageKey.userId)];case 1:return e.sent()?[2,!0]:[4,new Promise((function(e){(0,i.sendMessageToBackgroundScript)({message:"checkIsSignedIn"},(function(n){n&&"object"==typeof n&&"isSignedIn"in n&&"boolean"==typeof n.isSignedIn&&e(n.isSignedIn)}))}))];case 2:return[2,e.sent()]}}))}))},n.updateCognitoPhoneNumber=function(e){return new Promise((function(n,t){return(0,i.sendMessageToBackgroundScript)({message:"updateCognitoPhoneNumber",data:{formattedPhoneNumber:e}},(function(e){return e.success?n():t()}))}))}},46863:function(e,n,t){var o,r=this&&this.__extends||(o=function(e,n){return o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,n){e.__proto__=n}||function(e,n){for(var t in n)Object.prototype.hasOwnProperty.call(n,t)&&(e[t]=n[t])},o(e,n)},function(e,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function t(){this.constructor=e}o(e,n),e.prototype=null===n?Object.create(n):(t.prototype=n.prototype,new t)}),a=this&&this.__awaiter||function(e,n,t,o){return new(t||(t=Promise))((function(r,a){function i(e){try{u(o.next(e))}catch(e){a(e)}}function s(e){try{u(o.throw(e))}catch(e){a(e)}}function u(e){var n;e.done?r(e.value):(n=e.value,n instanceof t?n:new t((function(e){e(n)}))).then(i,s)}u((o=o.apply(e,n||[])).next())}))},i=this&&this.__generator||function(e,n){var t,o,r,a,i={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return a={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function s(s){return function(u){return function(s){if(t)throw new TypeError("Generator is already executing.");for(;a&&(a=0,s[0]&&(i=0)),i;)try{if(t=1,o&&(r=2&s[0]?o.return:s[0]?o.throw||((r=o.return)&&r.call(o),0):o.next)&&!(r=r.call(o,s[1])).done)return r;switch(o=0,r&&(s=[2&s[0],r.value]),s[0]){case 0:case 1:r=s;break;case 4:return i.label++,{value:s[1],done:!1};case 5:i.label++,o=s[1],s=[0];continue;case 7:s=i.ops.pop(),i.trys.pop();continue;default:if(!(r=i.trys,(r=r.length>0&&r[r.length-1])||6!==s[0]&&2!==s[0])){i=0;continue}if(3===s[0]&&(!r||s[1]>r[0]&&s[1]<r[3])){i.label=s[1];break}if(6===s[0]&&i.label<r[1]){i.label=r[1],r=s;break}if(r&&i.label<r[2]){i.label=r[2],i.ops.push(s);break}r[2]&&i.ops.pop(),i.trys.pop();continue}s=n.call(e,i)}catch(e){s=[6,e],o=0}finally{t=r=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,u])}}};Object.defineProperty(n,"__esModule",{value:!0}),n.setBackgroundScriptMonitoring=void 0;var s=t(55015),u=t(74137),c=t(98668),l=36e5;function d(){return a(this,void 0,void 0,(function(){var e;return i(this,(function(n){switch(n.label){case 0:e=new Promise((function(e,n){chrome.runtime.sendMessage({message:"pingBackgroundScriptFromContentScript"},{},(function(t){"pingContentScriptFromBackgroundScript"===t?e():n()}))})),n.label=1;case 1:return n.trys.push([1,3,,4]),[4,(t=e,o=4e3,r=new Promise((function(e,n){setTimeout((function(){return n(new p)}),o)})),Promise.race([t,r]))];case 2:return n.sent(),[3,4];case 3:return function(e){a(this,void 0,void 0,(function(){var n,t;return i(this,(function(o){switch(o.label){case 0:return[4,(0,s.getLocalStorageItem)(s.LocalStorageKey.backgroundScriptMonitoringInfo)];case 1:if(!((n=o.sent()||{lastCaptureTimestampMs:0,numberOfErrorsSinceLastCapture:0}).lastCaptureTimestampMs&&Date.now()-n.lastCaptureTimestampMs>l))return[3,6];(0,u.captureSentryException)(e),o.label=2;case 2:return o.trys.push([2,4,,5]),[4,(0,c.logUserEventFromContentScript)({type:"backgroundScriptPingTimedOut",payload:{numberOfErrorsSinceLastCapture:n.numberOfErrorsSinceLastCapture},active:!1})];case 3:return o.sent(),n.lastCaptureTimestampMs=Date.now(),n.numberOfErrorsSinceLastCapture=0,[3,5];case 4:return t=o.sent(),console.log(t),n.numberOfErrorsSinceLastCapture+=1,[3,5];case 5:return[3,7];case 6:n.numberOfErrorsSinceLastCapture+=1,o.label=7;case 7:return[4,(0,s.setLocalStorageItem)(s.LocalStorageKey.backgroundScriptMonitoringInfo,n)];case 8:return o.sent(),[2]}}))}))}(n.sent()),[3,4];case 4:return[2]}var t,o,r}))}))}n.setBackgroundScriptMonitoring=function(){setInterval(d,4e3)};var p=function(e){function n(){var t=e.call(this)||this;return t.name="BackgroundScriptPingTimedOutError",t.message="Background script ping timed out",Object.setPrototypeOf(t,n.prototype),t}return r(n,e),n}(Error)},52879:function(e,n,t){var o=this&&this.__read||function(e,n){var t="function"==typeof Symbol&&e[Symbol.iterator];if(!t)return e;var o,r,a=t.call(e),i=[];try{for(;(void 0===n||n-- >0)&&!(o=a.next()).done;)i.push(o.value)}catch(e){r={error:e}}finally{try{o&&!o.done&&(t=a.return)&&t.call(a)}finally{if(r)throw r.error}}return i},r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(n,"__esModule",{value:!0}),n.useShouldDisplayBankReconnectionBanner=void 0;var a=r(t(96540)),i=t(55015),s=t(46239);n.useShouldDisplayBankReconnectionBanner=function(){var e=(0,i.useHasFeature)(i.Feature.bankReconnectionBannerMobileBrowserExtension),n=o(a.default.useState(!1),2),t=n[0],r=n[1];return a.default.useEffect((function(){e&&new Promise((function(e){return(0,s.sendMessageToBackgroundScript)({message:"checkHasDisconnectedBank"},(function(n){return e(n)}))})).then(r)}),[]),t}},99556:function(e,n,t){var o=this&&this.__assign||function(){return o=Object.assign||function(e){for(var n,t=1,o=arguments.length;t<o;t++)for(var r in n=arguments[t])Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r]);return e},o.apply(this,arguments)},r=this&&this.__awaiter||function(e,n,t,o){return new(t||(t=Promise))((function(r,a){function i(e){try{u(o.next(e))}catch(e){a(e)}}function s(e){try{u(o.throw(e))}catch(e){a(e)}}function u(e){var n;e.done?r(e.value):(n=e.value,n instanceof t?n:new t((function(e){e(n)}))).then(i,s)}u((o=o.apply(e,n||[])).next())}))},a=this&&this.__generator||function(e,n){var t,o,r,a,i={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return a={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function s(s){return function(u){return function(s){if(t)throw new TypeError("Generator is already executing.");for(;a&&(a=0,s[0]&&(i=0)),i;)try{if(t=1,o&&(r=2&s[0]?o.return:s[0]?o.throw||((r=o.return)&&r.call(o),0):o.next)&&!(r=r.call(o,s[1])).done)return r;switch(o=0,r&&(s=[2&s[0],r.value]),s[0]){case 0:case 1:r=s;break;case 4:return i.label++,{value:s[1],done:!1};case 5:i.label++,o=s[1],s=[0];continue;case 7:s=i.ops.pop(),i.trys.pop();continue;default:if(!(r=i.trys,(r=r.length>0&&r[r.length-1])||6!==s[0]&&2!==s[0])){i=0;continue}if(3===s[0]&&(!r||s[1]>r[0]&&s[1]<r[3])){i.label=s[1];break}if(6===s[0]&&i.label<r[1]){i.label=r[1],r=s;break}if(r&&i.label<r[2]){i.label=r[2],i.ops.push(s);break}r[2]&&i.ops.pop(),i.trys.pop();continue}s=n.call(e,i)}catch(e){s=[6,e],o=0}finally{t=r=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,u])}}},i=this&&this.__values||function(e){var n="function"==typeof Symbol&&Symbol.iterator,t=n&&e[n],o=0;if(t)return t.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&o>=e.length&&(e=void 0),{value:e&&e[o++],done:!e}}};throw new TypeError(n?"Object is not iterable.":"Symbol.iterator is not defined.")};Object.defineProperty(n,"__esModule",{value:!0}),n.handleOfferWidgetDisplayLogicHealthCheckAfterContentScriptRestart=n.triggerContentScriptOfferWidgetDisplayLogicHealthCheckAfterDelay=n.logUrlChangeMessageHandledUserEventForSpecificHostnames=void 0;var s=t(55015),u=t(74137),c=t(98668),l=t(46239),d=new Set(["aliexpress","temu","apple","cdiscount","etsy","asos","courir","hm","castorama","nocibe"]);n.logUrlChangeMessageHandledUserEventForSpecificHostnames=function(e){var n=(0,s.getSecondLevelDomain)(e);n&&d.has(n)&&(0,c.logUserEventFromContentScript)({type:"urlChangeMessageHandled",payload:{secondLevelDomain:n},active:!1})};function p(e){var n=e.offerId,t=e.displayOfferWidgetMessageReceivedTimestampInMs,o=e.initialUrlHostname,i=e.wasContentScriptReloaded;return r(this,void 0,void 0,(function(){var e,u,d,p,f;return a(this,(function(m){switch(m.label){case 0:return e=new Promise((function(e){return(0,l.sendMessageToBackgroundScript)({message:"getTabId"},(function(n){return e(!!(null==n?void 0:n.tabId))}))})),u=new Promise((function(e){return setTimeout((function(){return e(!1)}),4e3)})),[4,Promise.race([e,u])];case 1:d=m.sent(),p=(0,s.getCurrentUrlHostname)(),f={type:"contentScriptOfferWidgetDisplayLogicHealthCheckTriggered",active:!1,payload:{offerId:n,displayOfferWidgetMessageReceivedTimestampInMs:t,healthCheckTriggeredTimestampInMs:Date.now(),initialUrlHostname:o,currentUrlHostname:p,hasChangedUrlHostname:void 0===o||void 0===p?void 0:o!==p,isBackgroundScriptResponding:d,wasContentScriptReloaded:i}};try{(0,c.logUserEventFromContentScript)(f)}catch(e){console.error(e),(0,c.logUserEvent)(f)}return function(e){var n=e.offerId,t=e.displayOfferWidgetMessageReceivedTimestampInMs;r(this,void 0,void 0,(function(){var e,o;return a(this,(function(r){switch(r.label){case 0:return[4,(0,s.getLocalStorageItem)(s.LocalStorageKey.contentScriptOfferWidgetDisplayLogicHealthCheckInfo)];case 1:return e=r.sent()||{},(null==(o=null==e?void 0:e[n])?void 0:o["".concat(t)])&&delete o["".concat(t)],o&&0===Object.keys(o).length&&delete e[n],[4,(0,s.setLocalStorageItem)(s.LocalStorageKey.contentScriptOfferWidgetDisplayLogicHealthCheckInfo,e)];case 2:return r.sent(),[2]}}))}))}({offerId:n,displayOfferWidgetMessageReceivedTimestampInMs:t}),[2]}}))}))}n.triggerContentScriptOfferWidgetDisplayLogicHealthCheckAfterDelay=function(e){var n=e.offerId,t=e.displayOfferWidgetMessageReceivedTimestampInMs,i=e.initialUrlHostname;setTimeout((function(){return p({offerId:n,displayOfferWidgetMessageReceivedTimestampInMs:t,initialUrlHostname:i,wasContentScriptReloaded:!1})}),2e4),function(e){var n=e.offerId,t=e.displayOfferWidgetMessageReceivedTimestampInMs,i=e.initialUrlHostname;r(this,void 0,void 0,(function(){var e,r;return a(this,(function(a){switch(a.label){case 0:return[4,(0,s.getLocalStorageItem)(s.LocalStorageKey.contentScriptOfferWidgetDisplayLogicHealthCheckInfo)];case 1:return(e=a.sent()||{})[n]=o(o({},e[n]),((r={})["".concat(t)]={hasLoggedUserEvent:!1,displayOfferWidgetMessageReceivedTimestampInMs:t,initialUrlHostname:i},r)),[4,(0,s.setLocalStorageItem)(s.LocalStorageKey.contentScriptOfferWidgetDisplayLogicHealthCheckInfo,e)];case 2:return a.sent(),[2]}}))}))}({offerId:n,displayOfferWidgetMessageReceivedTimestampInMs:t,initialUrlHostname:i})},n.handleOfferWidgetDisplayLogicHealthCheckAfterContentScriptRestart=function(){return r(this,void 0,void 0,(function(){var e,n,t,o,r,c,l,d;return a(this,(function(a){switch(a.label){case 0:return a.trys.push([0,2,,3]),[4,(0,s.getLocalStorageItem)(s.LocalStorageKey.contentScriptOfferWidgetDisplayLogicHealthCheckInfo)];case 1:if(!(e=a.sent())||0===Object.keys(e).length)return[2];n=function(n){var t,o,r=e[n];if(!r||0===Object.keys(r).length)return"continue";var a=function(e){var t=r[e],o=t.displayOfferWidgetMessageReceivedTimestampInMs,a=t.initialUrlHostname;setTimeout((function(){return p({offerId:n,displayOfferWidgetMessageReceivedTimestampInMs:o,initialUrlHostname:a,wasContentScriptReloaded:!0})}),Math.max(0,2e4-(Date.now()-o)))};try{for(var s=(t=void 0,i(Object.keys(r))),u=s.next();!u.done;u=s.next()){a(u.value)}}catch(e){t={error:e}}finally{try{u&&!u.done&&(o=s.return)&&o.call(s)}finally{if(t)throw t.error}}};try{for(t=i(Object.keys(e)),o=t.next();!o.done;o=t.next())r=o.value,n(r)}catch(e){l={error:e}}finally{try{o&&!o.done&&(d=t.return)&&d.call(t)}finally{if(l)throw l.error}}return[3,3];case 2:return c=a.sent(),console.error(c),(0,u.captureSentryException)(c),[3,3];case 3:return[2]}}))}))}},37392:(e,n)=>{Object.defineProperty(n,"__esModule",{value:!0}),n.removeJokoDomEventListener=n.setJokoDomEventListener=n.sendJokoDomEvent=n.JokoDomEvent=void 0,function(e){e.onJokoPanelDisplayed="onJokoPanelDisplayed",e.onJokoPanelCloseRequest="onJokoPanelCloseRequest",e.onJokoPanelLocationChangeRequest="onJokoPanelLocationChangeRequest",e.onJokoWidgetsCloseRequest="onJokoWidgetsCloseRequest",e.onOfferActivated="onOfferActivated",e.onOfferWidgetClosed="onOfferWidgetClosed",e.onCashbackTrackingLostWidgetClosed="onCashbackTrackingLostWidgetClosed",e.startSideButtonCashbackActivationAnimation="startSideButtonCashbackActivationAnimation"}(n.JokoDomEvent||(n.JokoDomEvent={})),n.sendJokoDomEvent=function(e,n){document.dispatchEvent(new CustomEvent(e,{detail:n}))},n.setJokoDomEventListener=function(e,n){var t=function(t){t.detail?n(t.detail):console.error("An undefined event data was received for the event ".concat(e))};return document.addEventListener(e,t),t},n.removeJokoDomEventListener=function(e,n){document.removeEventListener(e,n)}},17621:function(e,n,t){var o=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(n,"__esModule",{value:!0}),n.getHashedElementId=n.useHashedElementId=n.JokoExtensionElement=n.JokoExtensionRootElement=void 0;var r=o(t(96540)),a=o(t(83503));function i(e,n){var t=window.navigator.userAgent,o="".concat(e,"-").concat(t,"-").concat(n||"");return function(e){var n=e.charCodeAt(0);if(n>96&&n<123)return e;var t=n%26+97;return String.fromCharCode(t)+e.substring(1)}((0,a.default)(o))}!function(e){e.offerWidget="offerWidgetRoot",e.cashbackReminderWidget="cashbackReminderWidgetRoot",e.cashbackTrackingLostWidget="cashbackTrackingLostWidgetRoot",e.cashbackReactivationAtCheckoutWidget="cashbackReactivationAtCheckoutWidgetRoot",e.cashbackActivationConfirmationWidget="cashbackActivationConfirmationWidgetRoot",e.alternativeOffersWidget="alternativeOffersWidgetRoot",e.couponAutomationProposalWidget="couponAutomationProposalWidgetRoot",e.couponApplicationWidget="couponApplicationWidgetRoot",e.bnplSubscriptionWidget="bnplSubscriptionWidgetRoot",e.bnplSuggestionAtCheckoutWidget="bnplSuggestionAtCheckoutWidgetRoot",e.bnplCardReadyWidget="bnplCardReadyWidgetRoot",e.priceComparisonWidget="priceComparisonWidgetRoot",e.priceComparisonFeedbackWidget="priceComparisonFeedbackWidgetRoot",e.priceComparisonFeedbackSubmittedWidget="priceComparisonFeedbackSubmittedWidgetRoot",e.merchantWebsiteTrackingConsentSuggestionWidget="merchantWebsiteTrackingConsentSuggestionWidgetRoot",e.merchantWebsiteTrackingConsentErrorWidget="merchantWebsiteTrackingConsentErrorWidgetRoot",e.panel="panelRoot",e.sideButton="sideButtonRoot",e.affiliateLinkIframeLoader="affiliateLinkIframeLoaderRoot",e.couponNetworkRequestFormatterSandboxedIframe="couponNetworkRequestFormatterSandboxedIframeRoot",e.offerCashbackActivationInterstitial="offerCashbackActivationInterstitialRoot",e.embeddedAmazonBnplButton="embeddedAmazonBnplButtonRoot",e.embeddedSearchResultsInfo="embeddedSearchResultsInfo",e.embeddedProductDiscoveryExperience="embeddedProductDiscoveryExperience",e.adBlockerDetectionIframe="adBlockerDetectionIframeRoot",e.snoozingConfirmationWidget="snoozingConfirmationWidgetRoot",e.snoozingBottomSheet="snoozingBottomSheetRoot",e.deleteAllBrowsedProductsBottomSheet="deleteAllBrowsedProductsBottomSheetRoot"}(n.JokoExtensionRootElement||(n.JokoExtensionRootElement={})),function(e){e.offerWidget="offerWidget",e.cashbackReminderWidget="cashbackReminderWidget",e.cashbackTrackingLostWidget="cashbackTrackingLostWidget",e.cashbackReactivationAtCheckoutWidget="cashbackReactivationAtCheckoutWidget",e.cashbackActivationConfirmationWidget="cashbackActivationConfirmationWidget",e.alternativeOffersWidget="alternativeOffersWidget",e.couponAutomationProposalWidget="couponAutomationProposalWidget",e.couponApplicationWidget="couponApplicationWidget",e.bnplSubscriptionWidget="bnplSubscriptionWidget",e.bnplSuggestionAtCheckoutWidget="bnplSuggestionAtCheckoutWidget",e.bnplCardReadyWidget="bnplCardReadyWidget",e.priceComparisonWidget="priceComparisonWidget",e.priceComparisonFeedbackWidget="priceComparisonFeedbackWidget",e.priceComparisonFeedbackSubmittedWidget="priceComparisonFeedbackSubmittedWidget",e.merchantWebsiteTrackingConsentSuggestionWidget="merchantWebsiteTrackingConsentSuggestionWidget",e.merchantWebsiteTrackingConsentErrorWidget="merchantWebsiteTrackingConsentErrorWidget",e.snoozingConfirmationWidget="snoozingConfirmationWidget",e.panel="panel",e.panelFrame="panelFrame",e.bnplSubscriptionFrame="bnplSubscriptionFrame",e.errorScreen="errorScreen",e.offerActivationInterstitial="offerActivationInterstitial",e.snoozingBottomSheet="snoozingBottomSheet",e.deleteAllBrowsedProductsBottomSheet="deleteAllBrowsedProductsBottomSheet"}(n.JokoExtensionElement||(n.JokoExtensionElement={})),n.useHashedElementId=function(e,n){return r.default.useMemo((function(){return i(e,n)}),[e,n])},n.getHashedElementId=i},62849:function(e,n,t){var o=this&&this.__createBinding||(Object.create?function(e,n,t,o){void 0===o&&(o=t);var r=Object.getOwnPropertyDescriptor(n,t);r&&!("get"in r?!n.__esModule:r.writable||r.configurable)||(r={enumerable:!0,get:function(){return n[t]}}),Object.defineProperty(e,o,r)}:function(e,n,t,o){void 0===o&&(o=t),e[o]=n[t]}),r=this&&this.__setModuleDefault||(Object.create?function(e,n){Object.defineProperty(e,"default",{enumerable:!0,value:n})}:function(e,n){e.default=n}),a=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var n={};if(null!=e)for(var t in e)"default"!==t&&Object.prototype.hasOwnProperty.call(e,t)&&o(n,e,t);return r(n,e),n},i=this&&this.__awaiter||function(e,n,t,o){return new(t||(t=Promise))((function(r,a){function i(e){try{u(o.next(e))}catch(e){a(e)}}function s(e){try{u(o.throw(e))}catch(e){a(e)}}function u(e){var n;e.done?r(e.value):(n=e.value,n instanceof t?n:new t((function(e){e(n)}))).then(i,s)}u((o=o.apply(e,n||[])).next())}))},s=this&&this.__generator||function(e,n){var t,o,r,a,i={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return a={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function s(s){return function(u){return function(s){if(t)throw new TypeError("Generator is already executing.");for(;a&&(a=0,s[0]&&(i=0)),i;)try{if(t=1,o&&(r=2&s[0]?o.return:s[0]?o.throw||((r=o.return)&&r.call(o),0):o.next)&&!(r=r.call(o,s[1])).done)return r;switch(o=0,r&&(s=[2&s[0],r.value]),s[0]){case 0:case 1:r=s;break;case 4:return i.label++,{value:s[1],done:!1};case 5:i.label++,o=s[1],s=[0];continue;case 7:s=i.ops.pop(),i.trys.pop();continue;default:if(!(r=i.trys,(r=r.length>0&&r[r.length-1])||6!==s[0]&&2!==s[0])){i=0;continue}if(3===s[0]&&(!r||s[1]>r[0]&&s[1]<r[3])){i.label=s[1];break}if(6===s[0]&&i.label<r[1]){i.label=r[1],r=s;break}if(r&&i.label<r[2]){i.label=r[2],i.ops.push(s);break}r[2]&&i.ops.pop(),i.trys.pop();continue}s=n.call(e,i)}catch(e){s=[6,e],o=0}finally{t=r=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,u])}}},u=this&&this.__read||function(e,n){var t="function"==typeof Symbol&&e[Symbol.iterator];if(!t)return e;var o,r,a=t.call(e),i=[];try{for(;(void 0===n||n-- >0)&&!(o=a.next()).done;)i.push(o.value)}catch(e){r={error:e}}finally{try{o&&!o.done&&(t=a.return)&&t.call(a)}finally{if(r)throw r.error}}return i};Object.defineProperty(n,"__esModule",{value:!0}),n.useExtensionType=n.getExtensionType=void 0;var c=a(t(96540)),l=t(46239);function d(){return i(this,void 0,void 0,(function(){return s(this,(function(e){return[2,new Promise((function(e){(0,l.sendMessageToBackgroundScript)({message:"getExtensionType",data:{}},(function(n){e(n.extensionType)}))}))]}))}))}n.getExtensionType=d,n.useExtensionType=function(){var e=u(c.useState(void 0),2),n=e[0],t=e[1];return c.useEffect((function(){d().then(t)}),[]),n}},87867:function(e,n){var t=this&&this.__values||function(e){var n="function"==typeof Symbol&&Symbol.iterator,t=n&&e[n],o=0;if(t)return t.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&o>=e.length&&(e=void 0),{value:e&&e[o++],done:!e}}};throw new TypeError(n?"Object is not iterable.":"Symbol.iterator is not defined.")};Object.defineProperty(n,"__esModule",{value:!0}),n.removeInputElement=n.removeAllAttributesExceptClassAndUseSafeIdAndName=n.traverseChildrenAndApplyHtmlElementTransformers=void 0,n.traverseChildrenAndApplyHtmlElementTransformers=function e(n,o){var r,a,i,s;if(o.length){try{for(var u=t(o),c=u.next();!c.done;c=u.next()){(0,c.value)(n)}}catch(e){r={error:e}}finally{try{c&&!c.done&&(a=u.return)&&a.call(u)}finally{if(r)throw r.error}}try{for(var l=t(Array.from(n.children)),d=l.next();!d.done;d=l.next()){var p=d.value;p instanceof HTMLElement&&e(p,o)}}catch(e){i={error:e}}finally{try{d&&!d.done&&(s=l.return)&&s.call(l)}finally{if(i)throw i.error}}}},n.removeAllAttributesExceptClassAndUseSafeIdAndName=function(e){var n,o;try{for(var r=t(Array.from(e.attributes)),a=r.next();!a.done;a=r.next()){var i=a.value;switch(i.name){case"class":break;case"id":case"name":e.setAttribute(i.name,"".concat(e.getAttribute(i.name),"-joko"));break;default:e.removeAttribute(i.name)}}}catch(e){n={error:e}}finally{try{a&&!a.done&&(o=r.return)&&o.call(r)}finally{if(n)throw n.error}}},n.removeInputElement=function(e){e instanceof HTMLInputElement&&e.remove()}},92204:function(e,n,t){var o=this&&this.__awaiter||function(e,n,t,o){return new(t||(t=Promise))((function(r,a){function i(e){try{u(o.next(e))}catch(e){a(e)}}function s(e){try{u(o.throw(e))}catch(e){a(e)}}function u(e){var n;e.done?r(e.value):(n=e.value,n instanceof t?n:new t((function(e){e(n)}))).then(i,s)}u((o=o.apply(e,n||[])).next())}))},r=this&&this.__generator||function(e,n){var t,o,r,a,i={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return a={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function s(s){return function(u){return function(s){if(t)throw new TypeError("Generator is already executing.");for(;a&&(a=0,s[0]&&(i=0)),i;)try{if(t=1,o&&(r=2&s[0]?o.return:s[0]?o.throw||((r=o.return)&&r.call(o),0):o.next)&&!(r=r.call(o,s[1])).done)return r;switch(o=0,r&&(s=[2&s[0],r.value]),s[0]){case 0:case 1:r=s;break;case 4:return i.label++,{value:s[1],done:!1};case 5:i.label++,o=s[1],s=[0];continue;case 7:s=i.ops.pop(),i.trys.pop();continue;default:if(!(r=i.trys,(r=r.length>0&&r[r.length-1])||6!==s[0]&&2!==s[0])){i=0;continue}if(3===s[0]&&(!r||s[1]>r[0]&&s[1]<r[3])){i.label=s[1];break}if(6===s[0]&&i.label<r[1]){i.label=r[1],r=s;break}if(r&&i.label<r[2]){i.label=r[2],i.ops.push(s);break}r[2]&&i.ops.pop(),i.trys.pop();continue}s=n.call(e,i)}catch(e){s=[6,e],o=0}finally{t=r=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,u])}}},a=this&&this.__read||function(e,n){var t="function"==typeof Symbol&&e[Symbol.iterator];if(!t)return e;var o,r,a=t.call(e),i=[];try{for(;(void 0===n||n-- >0)&&!(o=a.next()).done;)i.push(o.value)}catch(e){r={error:e}}finally{try{o&&!o.done&&(t=a.return)&&t.call(a)}finally{if(r)throw r.error}}return i},i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(n,"__esModule",{value:!0}),n.useImageSource=n.checkShouldLoadImagesThroughBackgroundScript=n.shouldLoadImagesThroughBackgroundScript=n.useImagePreloader=void 0;var s=i(t(96540)),u=i(t(2543)),c=t(46239);function l(e){return new Promise((function(n){var t=new Image;t.onload=function(){return n()},t.src=e}))}n.useImagePreloader=function(e){var n=a(s.default.useState(!0),2),t=n[0],i=n[1],c=s.default.useMemo((function(){return u.default.uniq(e)}),[e]);return s.default.useEffect((function(){var e=!1;if(c.length)return function(){o(this,void 0,void 0,(function(){return r(this,(function(n){switch(n.label){case 0:return e?[2]:[4,Promise.all(c.map(l))];case 1:return n.sent(),e?[2]:(i(!1),[2])}}))}))}(),function(){e=!0}}),[c]),t},n.shouldLoadImagesThroughBackgroundScript=!1;n.checkShouldLoadImagesThroughBackgroundScript=function(){var e=new Image;e.onerror=function(){return n.shouldLoadImagesThroughBackgroundScript=!0},e.src="https://joko-mobile-app-media.s3.eu-west-1.amazonaws.com/browser-extension/background_script/background_script_image_loading_assessment_asset.png"},n.useImageSource=function(e){var t=a(s.default.useState(void 0),2),i=t[0],u=t[1];return s.default.useEffect((function(){n.shouldLoadImagesThroughBackgroundScript&&e&&function(e){return o(this,void 0,void 0,(function(){return r(this,(function(n){switch(n.label){case 0:return[4,new Promise((function(n){return(0,c.sendMessageToBackgroundScript)({message:"loadImage",data:{imageUrl:e}},(function(e){return n(e.base64Image)}))}))];case 1:return[2,n.sent()]}}))}))}(e).then(u)}),[]),n.shouldLoadImagesThroughBackgroundScript?i||"":e}},77653:function(e,n,t){var o=this&&this.__read||function(e,n){var t="function"==typeof Symbol&&e[Symbol.iterator];if(!t)return e;var o,r,a=t.call(e),i=[];try{for(;(void 0===n||n-- >0)&&!(o=a.next()).done;)i.push(o.value)}catch(e){r={error:e}}finally{try{o&&!o.done&&(t=a.return)&&t.call(a)}finally{if(r)throw r.error}}return i},r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(n,"__esModule",{value:!0}),n.getUserOfferActivationInfo=n.useMerchantOfferMatchingUrlWithConditionsAndCoupons=n.getMerchantOffersWithConditionsAndCouponsFromOfferIds=n.getMerchantOfferWithConditionsAndCouponsFromS3=n.getMerchantOfferMatchingUrlWithConditionsAndCoupons=void 0;var a=r(t(96540)),i=t(46239);function s(e){return new Promise((function(n){return(0,i.sendMessageToBackgroundScript)({message:"getMerchantOfferMatchingUrlWithConditionsAndCoupons",data:{url:e}},(function(e){return n((null==e?void 0:e.offer)?e.offer:void 0)}))}))}n.getMerchantOfferMatchingUrlWithConditionsAndCoupons=s,n.getMerchantOfferWithConditionsAndCouponsFromS3=function(e){return new Promise((function(n){return(0,i.sendMessageToBackgroundScript)({message:"getMerchantOfferWithConditionsAndCouponsFromS3",data:{offerId:e}},(function(e){return n((null==e?void 0:e.offer)?e.offer:void 0)}))}))},n.getMerchantOffersWithConditionsAndCouponsFromOfferIds=function(e){return new Promise((function(n){return(0,i.sendMessageToBackgroundScript)({message:"getMerchantOffersWithConditionsAndCouponsFromOfferIds",data:{offerIds:e}},(function(e){return n((null==e?void 0:e.offers)||void 0)}))}))},n.useMerchantOfferMatchingUrlWithConditionsAndCoupons=function(e){var n=o(a.default.useState(void 0),2),t=n[0],r=n[1];return a.default.useEffect((function(){s(e).then(r)}),[]),t},n.getUserOfferActivationInfo=function(e){return e?new Promise((function(n){(0,i.sendMessageToBackgroundScript)({message:"getUserOfferActivationInfo",data:{offerId:e.offerId}},(function(e){(null==e?void 0:e.userOfferActivationInfo)&&n(e.userOfferActivationInfo),n(void 0)}))})):Promise.resolve(void 0)}},38542:function(e,n,t){var o=this&&this.__awaiter||function(e,n,t,o){return new(t||(t=Promise))((function(r,a){function i(e){try{u(o.next(e))}catch(e){a(e)}}function s(e){try{u(o.throw(e))}catch(e){a(e)}}function u(e){var n;e.done?r(e.value):(n=e.value,n instanceof t?n:new t((function(e){e(n)}))).then(i,s)}u((o=o.apply(e,n||[])).next())}))},r=this&&this.__generator||function(e,n){var t,o,r,a,i={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return a={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function s(s){return function(u){return function(s){if(t)throw new TypeError("Generator is already executing.");for(;a&&(a=0,s[0]&&(i=0)),i;)try{if(t=1,o&&(r=2&s[0]?o.return:s[0]?o.throw||((r=o.return)&&r.call(o),0):o.next)&&!(r=r.call(o,s[1])).done)return r;switch(o=0,r&&(s=[2&s[0],r.value]),s[0]){case 0:case 1:r=s;break;case 4:return i.label++,{value:s[1],done:!1};case 5:i.label++,o=s[1],s=[0];continue;case 7:s=i.ops.pop(),i.trys.pop();continue;default:if(!(r=i.trys,(r=r.length>0&&r[r.length-1])||6!==s[0]&&2!==s[0])){i=0;continue}if(3===s[0]&&(!r||s[1]>r[0]&&s[1]<r[3])){i.label=s[1];break}if(6===s[0]&&i.label<r[1]){i.label=r[1],r=s;break}if(r&&i.label<r[2]){i.label=r[2],i.ops.push(s);break}r[2]&&i.ops.pop(),i.trys.pop();continue}s=n.call(e,i)}catch(e){s=[6,e],o=0}finally{t=r=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,u])}}};Object.defineProperty(n,"__esModule",{value:!0}),n.listenToMobileAppBrowserDisplayPanelMessages=n.addTestElementForMobileAppWebView=void 0;var a=t(74137),i=t(74617),s=t(95752);n.addTestElementForMobileAppWebView=function(e){var n=document.createElement("div");n.id=e,n.style.display="none",document.documentElement.appendChild(n)},n.listenToMobileAppBrowserDisplayPanelMessages=function(e,n,t,u){var c=(0,a.withSentry)((function(a){if("displayPanel"===a.message&&a.data&&"object"==typeof a.data&&"panelLocation"in a.data){var c=a.data.panelLocation;if((0,s.checkIsPanelLocation)(c))return function(e,n,t,a,u){o(this,void 0,void 0,(function(){var o,c,l,d,p;return r(this,(function(r){switch(r.label){case 0:return[4,(0,s.checkIsProductAndCheckoutWebpage)(window.location.href)];case 1:return o=r.sent(),c=o.isProductPage,l=o.isCheckoutPage,d={offer:n,userOfferActivationInfo:t,isProductPage:c,isCheckoutPage:l,bnpl:{isBnplSectionEnabledForOffer:a},isTemporaryUser:u,defaultPanelLocationOverride:e},p="mobileAppBrowserTopBarButton",(0,i.displayPanelAndLogEvents)(d,p,e),[2]}}))}))}(c,e,n,t,u),!0}}));chrome.runtime.onMessage.removeListener(c),chrome.runtime.onMessage.addListener(c)}},32668:function(e,n,t){var o=this&&this.__read||function(e,n){var t="function"==typeof Symbol&&e[Symbol.iterator];if(!t)return e;var o,r,a=t.call(e),i=[];try{for(;(void 0===n||n-- >0)&&!(o=a.next()).done;)i.push(o.value)}catch(e){r={error:e}}finally{try{o&&!o.done&&(t=a.return)&&t.call(a)}finally{if(r)throw r.error}}return i},r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(n,"__esModule",{value:!0}),n.checkIsOnMobileScreen=n.useDisableMobileSafariAutoZoomOnInputFocus=n.useDisableMobileSafariNativeSwipe=n.useForceMobileSafariAutoLoginEasterEgg=n.isOsVersion18OrLater=void 0;var a=r(t(96540)),i=t(55015),s=t(25841),u=t(46239);function c(e){e.touches[0].pageX>20&&e.touches[0].pageX<window.innerWidth-20||e.preventDefault()}n.isOsVersion18OrLater=Number((0,s.getSafariMajorAndMinorOsVersion)())>=18,n.useForceMobileSafariAutoLoginEasterEgg=function(){var e=o(a.default.useState(0),2),n=e[0],t=e[1];return a.default.useEffect((function(){n>=5&&(0,i.getLocalStorageItem)(i.LocalStorageKey.userId).then((function(e){t(0),window.confirm("You are logged in with user ".concat(e,". Do you want to manually trigger automatic login?"))&&(0,u.sendMessageToBackgroundScript)({message:"forceMobileSafariAutoLogin",data:{}})}))}),[n]),function(){return t(n+1)}},n.useDisableMobileSafariNativeSwipe=function(e){var n=e.isMobileExtension,t=e.sideButtonElementRef;a.default.useEffect((function(){return n&&t.current&&t.current.addEventListener("touchstart",c),function(){n&&t.current&&t.current.removeEventListener("touchstart",c)}}),[n,t])},n.useDisableMobileSafariAutoZoomOnInputFocus=function(e){var n=a.default.useRef();a.default.useEffect((function(){if(e){var t=document.querySelector("[name=viewport]");return t?n.current=t.getAttribute("content")||void 0:t=document.createElement("meta"),t.setAttribute("content","width=device-width, initial-scale=1, maximum-scale=1"),function(){var e=document.querySelector("[name=viewport]");e&&(n.current?e.setAttribute("content",n.current):e.remove())}}}),[])};n.checkIsOnMobileScreen=function(){return window.screen.width<500}},84092:function(e,n,t){var o,r=this&&this.__createBinding||(Object.create?function(e,n,t,o){void 0===o&&(o=t);var r=Object.getOwnPropertyDescriptor(n,t);r&&!("get"in r?!n.__esModule:r.writable||r.configurable)||(r={enumerable:!0,get:function(){return n[t]}}),Object.defineProperty(e,o,r)}:function(e,n,t,o){void 0===o&&(o=t),e[o]=n[t]}),a=this&&this.__setModuleDefault||(Object.create?function(e,n){Object.defineProperty(e,"default",{enumerable:!0,value:n})}:function(e,n){e.default=n}),i=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var n={};if(null!=e)for(var t in e)"default"!==t&&Object.prototype.hasOwnProperty.call(e,t)&&r(n,e,t);return a(n,e),n};Object.defineProperty(n,"__esModule",{value:!0}),n.parsePriceAmountAndCurrency=void 0;var s=i(t(2543)),u=t(55015),c=((o={})[u.CurrencySymbol.EUR]=u.Currency.EUR,o[u.CurrencySymbol.GBP]=u.Currency.GBP,o[u.CurrencySymbol.USD]=u.Currency.USD,o);n.parsePriceAmountAndCurrency=function(e){if(!e)return{priceAmount:null,priceCurrency:null};var n=s.deburr(e.toLowerCase().trim());if(""===n)return{priceAmount:null,priceCurrency:null};var t=n.match(/\$|€|£|(eur)|(usd)|(gbp)/);if(!t)return{priceAmount:null,priceCurrency:null};var o=t[0],r=null;if(r=Object.values(u.CurrencySymbol).includes(o)?c[o]:o.toUpperCase(),!Object.values(u.Currency).includes(r))return{priceAmount:null,priceCurrency:null};if(Object.values(u.CurrencySymbol).includes(o)&&0!==t.index&&t.index!==n.length-1)return n=(n=n.replace(/[$€£]/g,".")).replace(/[,\s]/g,""),{priceAmount:parseFloat(n),priceCurrency:r};if((n=n.replace(/\$|€|£|(eur)|(usd)|(gbp)|\s/g,"")).includes(".")&&n.includes(","))n=n.replace(/,/g,"");else if(n.includes(",")){var a=n.split(",");n=a.length>2||3===a[a.length-1].length?n.replace(/,/g,""):n.replace(",",".")}return{priceAmount:parseFloat(n),priceCurrency:r}}},24366:function(e,n,t){var o=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(n,"__esModule",{value:!0}),n.useSetMomentLocale=void 0;var r=o(t(96540)),a=o(t(95093));t(85498),t(53872);var i=t(55015);n.useSetMomentLocale=function(){var e=(0,i.useUserRegion)();r.default.useEffect((function(){switch(e){case i.Region.FR:a.default.locale("fr");break;case i.Region.US:a.default.locale("en-au")}}),[e])}},74137:function(e,n,t){var o=this&&this.__awaiter||function(e,n,t,o){return new(t||(t=Promise))((function(r,a){function i(e){try{u(o.next(e))}catch(e){a(e)}}function s(e){try{u(o.throw(e))}catch(e){a(e)}}function u(e){var n;e.done?r(e.value):(n=e.value,n instanceof t?n:new t((function(e){e(n)}))).then(i,s)}u((o=o.apply(e,n||[])).next())}))},r=this&&this.__generator||function(e,n){var t,o,r,a,i={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return a={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function s(s){return function(u){return function(s){if(t)throw new TypeError("Generator is already executing.");for(;a&&(a=0,s[0]&&(i=0)),i;)try{if(t=1,o&&(r=2&s[0]?o.return:s[0]?o.throw||((r=o.return)&&r.call(o),0):o.next)&&!(r=r.call(o,s[1])).done)return r;switch(o=0,r&&(s=[2&s[0],r.value]),s[0]){case 0:case 1:r=s;break;case 4:return i.label++,{value:s[1],done:!1};case 5:i.label++,o=s[1],s=[0];continue;case 7:s=i.ops.pop(),i.trys.pop();continue;default:if(!(r=i.trys,(r=r.length>0&&r[r.length-1])||6!==s[0]&&2!==s[0])){i=0;continue}if(3===s[0]&&(!r||s[1]>r[0]&&s[1]<r[3])){i.label=s[1];break}if(6===s[0]&&i.label<r[1]){i.label=r[1],r=s;break}if(r&&i.label<r[2]){i.label=r[2],i.ops.push(s);break}r[2]&&i.ops.pop(),i.trys.pop();continue}s=n.call(e,i)}catch(e){s=[6,e],o=0}finally{t=r=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,u])}}},a=this&&this.__read||function(e,n){var t="function"==typeof Symbol&&e[Symbol.iterator];if(!t)return e;var o,r,a=t.call(e),i=[];try{for(;(void 0===n||n-- >0)&&!(o=a.next()).done;)i.push(o.value)}catch(e){r={error:e}}finally{try{o&&!o.done&&(t=a.return)&&t.call(a)}finally{if(r)throw r.error}}return i},i=this&&this.__spreadArray||function(e,n,t){if(t||2===arguments.length)for(var o,r=0,a=n.length;r<a;r++)!o&&r in n||(o||(o=Array.prototype.slice.call(n,0,r)),o[r]=n[r]);return e.concat(o||Array.prototype.slice.call(n))};Object.defineProperty(n,"__esModule",{value:!0}),n.withSentry=n.captureSentryException=n.sentryHub=void 0;var s=t(37315),u=t(55015),c=t(58029),l=t(70992),d=t(62849),p=t(32668),f=t(46239);n.sentryHub=new s.Hub(new s.BrowserClient({dsn:u.SENTRY_DSN,transport:s.makeFetchTransport,stackParser:s.defaultStackParser,integrations:[],release:u.versionNumber,sampleRate:1,beforeSend:function(e){try{return function(e){var n,t;o(this,void 0,void 0,(function(){var o;return r(this,(function(r){switch(r.label){case 0:return[4,(0,l.checkIsSignedIn)()];case 1:return(o=r.sent())?[4,(0,c.checkHasFeatureFromLocalStorage)((0,p.checkIsOnMobileScreen)()?u.Feature.logSentryEventsInUserEventsMobileBrowserExtension:u.Feature.logSentryEventsInUserEventsDesktopBrowserExtension)]:[3,3];case 2:o=r.sent(),r.label=3;case 3:return o?[4,(0,f.sendMessageToBackgroundScript)({message:"logUserEvent",data:{event:{type:"sentryEventSent",active:!1,payload:{script:"contentScript",sentryEventId:e.event_id,exceptions:null===(t=null===(n=e.exception)||void 0===n?void 0:n.values)||void 0===t?void 0:t.map((function(e){return{exceptionType:(null==e?void 0:e.type)?"".concat(e.type):"",exceptionValue:(null==e?void 0:e.value)?"".concat(e.value):""}})),eventLevel:e.level,eventTimestamp:e.timestamp}}}})]:[3,5];case 4:r.sent(),r.label=5;case 5:return[2]}}))}))}(e),e}catch(n){return console.error(n),e}}})),n.sentryHub.setTags({script:"contentScript",environment:"production",versionNumber:u.versionNumber}),(0,u.getLocalStorageItem)(u.LocalStorageKey.userId).then((function(e){return n.sentryHub.setTag("userId",e)})),(0,d.getExtensionType)().then((function(e){return n.sentryHub.setTag("extensionType",e)})),(0,u.checkIsOnDevStack)().then((function(e){return n.sentryHub.setTag("isDevStack",e)})),n.captureSentryException=function(e){n.sentryHub.captureException(e)},n.withSentry=function(e){return function(){for(var t=[],o=0;o<arguments.length;o++)t[o]=arguments[o];try{return e.apply(void 0,i([],a(t),!1))}catch(e){throw n.sentryHub.captureException(e),e}}}},84159:function(e,n,t){var o=this&&this.__awaiter||function(e,n,t,o){return new(t||(t=Promise))((function(r,a){function i(e){try{u(o.next(e))}catch(e){a(e)}}function s(e){try{u(o.throw(e))}catch(e){a(e)}}function u(e){var n;e.done?r(e.value):(n=e.value,n instanceof t?n:new t((function(e){e(n)}))).then(i,s)}u((o=o.apply(e,n||[])).next())}))},r=this&&this.__generator||function(e,n){var t,o,r,a,i={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return a={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function s(s){return function(u){return function(s){if(t)throw new TypeError("Generator is already executing.");for(;a&&(a=0,s[0]&&(i=0)),i;)try{if(t=1,o&&(r=2&s[0]?o.return:s[0]?o.throw||((r=o.return)&&r.call(o),0):o.next)&&!(r=r.call(o,s[1])).done)return r;switch(o=0,r&&(s=[2&s[0],r.value]),s[0]){case 0:case 1:r=s;break;case 4:return i.label++,{value:s[1],done:!1};case 5:i.label++,o=s[1],s=[0];continue;case 7:s=i.ops.pop(),i.trys.pop();continue;default:if(!(r=i.trys,(r=r.length>0&&r[r.length-1])||6!==s[0]&&2!==s[0])){i=0;continue}if(3===s[0]&&(!r||s[1]>r[0]&&s[1]<r[3])){i.label=s[1];break}if(6===s[0]&&i.label<r[1]){i.label=r[1],r=s;break}if(r&&i.label<r[2]){i.label=r[2],i.ops.push(s);break}r[2]&&i.ops.pop(),i.trys.pop();continue}s=n.call(e,i)}catch(e){s=[6,e],o=0}finally{t=r=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,u])}}},a=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(n,"__esModule",{value:!0}),n.getSnoozeEndTimestampInMs=n.useSnoozeSettingsButtonInnerState=n.checkIsExtensionSnoozed=void 0;var i=a(t(96540)),s=a(t(95093)),u=t(55015),c=t(37392),l=t(46239),d=t(74617),p=t(18989),f=t(76764),m=t(94700),y="snoozeEndTimestampInMs";n.checkIsExtensionSnoozed=function(){return(e=localStorage.getItem(y))&&Date.now()<Number(e)?Promise.resolve(!0):function(){return o(this,void 0,void 0,(function(){var e;return r(this,(function(n){switch(n.label){case 0:return[4,(0,u.getLocalStorageItem)(u.LocalStorageKey.snoozeForAllWebsitesEndTimestampInMs)];case 1:return[2,!!((e=n.sent())&&Date.now()<Number(e))]}}))}))}();var e},n.useSnoozeSettingsButtonInnerState=function(e){var n=e.isMobileExtension,t=e.offer,o=e.closingActionOnSnoozing,r=e.widgetInnerContainerRef,a=e.panelInnerContainerRef,s=e.snoozeSettingsButtonRef,_=e.setIsSnoozeSettingsPopupOpen,h=e.setIsBottomSheetDisplayed,g=i.default.useCallback((function(){var e,n=window.location.href,r=v();localStorage.setItem(y,r),(0,p.unmountSideButton)(),(0,c.sendJokoDomEvent)(c.JokoDomEvent.onJokoWidgetsCloseRequest,{}),"panel"===o.source?o.closePanelAndLogEvents("snoozeButton"):"widget"===o.source&&o.closeWidget();var a,i,s=null!==(e=null==t?void 0:t.screen.title)&&void 0!==e?e:(0,u.getSecondLevelDomain)(n);(0,f.displaySnoozingConfirmationWidget)({offerId:null==t?void 0:t.offerId,websiteName:s}),a=null==t?void 0:t.offerId,i={offerId:a},(0,l.sendMessageToBackgroundScript)({message:"logUserEvent",data:{event:{type:"snoozedExtensionForCurrentWebsite",payload:i}}}),(0,l.sendMessageToBackgroundScript)({message:"logAmplitudeEvent",data:{event:{type:"Browser Extension - Snoozed For Current Website",properties:i}}})}),[t]),C=i.default.useRef(null),b=i.default.useRef(null);return(0,d.useOnClickInsidePanel)({panelInnerContainerRef:a,excludedElementRefs:[C,b,s],onClick:function(){n?null==h||h(!1):null==_||_(!1)},shouldAlsoDetectClickOutsidePanel:!0}),(0,m.useOnClickInsideWidget)({widgetInnerContainerRef:r,excludedElementRefs:[C,b,s],onClick:function(){n?null==h||h(!1):null==_||_(!1)}}),{onClickSnoozeForCurrentWebsiteButton:g,desktopSnoozeSettingsPopupRef:C,mobileSnoozingBottomSheetRef:b}};var _=2,h=36;function v(){var e=(0,s.default)(),n=(0,s.default)().add(1,"days").startOf("day");return n.diff(e,"hours")<_?n=(0,s.default)().add(_,"hours"):n.diff(e,"hours")>h&&(n=(0,s.default)().add(h,"hours")),n.valueOf().toString()}n.getSnoozeEndTimestampInMs=v},64534:function(e,n,t){var o=this&&this.__createBinding||(Object.create?function(e,n,t,o){void 0===o&&(o=t);var r=Object.getOwnPropertyDescriptor(n,t);r&&!("get"in r?!n.__esModule:r.writable||r.configurable)||(r={enumerable:!0,get:function(){return n[t]}}),Object.defineProperty(e,o,r)}:function(e,n,t,o){void 0===o&&(o=t),e[o]=n[t]}),r=this&&this.__setModuleDefault||(Object.create?function(e,n){Object.defineProperty(e,"default",{enumerable:!0,value:n})}:function(e,n){e.default=n}),a=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var n={};if(null!=e)for(var t in e)"default"!==t&&Object.prototype.hasOwnProperty.call(e,t)&&o(n,e,t);return r(n,e),n},i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(n,"__esModule",{value:!0}),n.useCheckIsSocialProofValueSatisfyingThreshold=n.SocialProofName=void 0;var s,u=i(t(95093)),c=a(t(35759)),l=t(55015),d=c.object({displayedAmountOfCashbackEarnedByUsers:c.number(),displayedAmountSavedByUsersUsingAutoCoupons:c.number(),totalAmountSavedByUsersUsingAutoCoupons:c.number()}).nonstrict(),p=c.object({highSuccessRateReassuranceElement:c.object({minSuccessRate:c.number()}),lastUsedRecentlyReassuranceElement:c.object({maxDelaySinceLastUseInHours:c.number()})}).nonstrict();!function(e){e.displayedAmountOfCashbackEarnedByUsers="displayedAmountOfCashbackEarnedByUsers",e.displayedAmountSavedByUsersUsingAutoCoupons="displayedAmountSavedByUsersUsingAutoCoupons",e.totalAmountSavedByUsersUsingAutoCoupons="totalAmountSavedByUsersUsingAutoCoupons",e.displayedSuccessRateAutoCoupons="displayedSuccessRateAutoCoupons",e.lastUsedAtAutoCoupons="lastUsedAtAutoCoupons"}(s=n.SocialProofName||(n.SocialProofName={}));var f={displayedAmountOfCashbackEarnedByUsers:.1,displayedAmountSavedByUsersUsingAutoCoupons:.1,totalAmountSavedByUsersUsingAutoCoupons:.1},m={highSuccessRateReassuranceElement:{minSuccessRate:.03},lastUsedRecentlyReassuranceElement:{maxDelaySinceLastUseInHours:48}};n.useCheckIsSocialProofValueSatisfyingThreshold=function(e){var n,t,o=e.socialProofName,r=e.socialProofValue,a=null!==(n=(0,l.useSetting)({settingKey:l.SettingKey.minimumAmountValuesSocialProofDisplay,validator:d}))&&void 0!==n?n:f,i=null!==(t=(0,l.useSetting)({settingKey:l.SettingKey.autoCouponCheckoutWidgetReassuranceElementThresholds,validator:p}))&&void 0!==t?t:m;if(!r)return!1;switch(o){case s.displayedAmountOfCashbackEarnedByUsers:case s.displayedAmountSavedByUsersUsingAutoCoupons:case s.totalAmountSavedByUsersUsingAutoCoupons:return r>a[o];case s.displayedSuccessRateAutoCoupons:return r>i.highSuccessRateReassuranceElement.minSuccessRate;case s.lastUsedAtAutoCoupons:return(0,u.default)().diff((0,u.default)(r),"hours")<i.lastUsedRecentlyReassuranceElement.maxDelaySinceLastUseInHours}}},26368:function(e,n,t){var o=this&&this.__makeTemplateObject||function(e,n){return Object.defineProperty?Object.defineProperty(e,"raw",{value:n}):e.raw=n,e};Object.defineProperty(n,"__esModule",{value:!0}),n.MOBILE_PANEL_HEIGHT=n.TRUNCATED_TEXT_CSS_MIXIN=n.CLICKABLE_ELEMENT_CSS_MIXIN=n.NON_HIGHLIGHTABLE_NOR_DRAGGABLE_ELEMENT_CSS_MIXIN=n.OPEN_AND_CLOSE_ANIMATIONS_DURATION_IN_SECONDS=n.DEFAULT_BUTTON_FONT_WEIGHT=n.DEFAULT_FULL_WIDTH_BUTTON_FONT_SIZE=n.DEFAULT_BUTTON_FONT_SIZE=n.DEFAULT_BOTTOM_SHEET_BOTTOM_PADDING=n.DEFAULT_BOTTOM_SHEET_HORIZONTAL_PADDING=n.BOTTOM_SHEET_BAR_HEIGHT=n.BOTTOM_SHEET_MAXIMUM_HEIGHT=n.DEFAULT_PANEL_TOP_PADDING=n.DEFAULT_PANEL_AND_WIDGET_HORIZONTAL_PADDING=n.WIDGET_VERTICAL_PADDING=n.DEFAULT_FULL_WIDTH_BUTTON_HEIGHT=n.DEFAULT_BUTTON_HEIGHT=n.TAB_SELECTOR_HEIGHT=n.PANEL_TOP_BAR_HEIGHT=n.DESKTOP_PANEL_AND_WIDGET_WIDTH=n.DESKTOP_PANEL_HEIGHT=n.HIGHER_TRANSLATE3D_Z_AXIS=n.HIGHEST_Z_INDEX=void 0;var r,a,i,s=t(38267);n.HIGHEST_Z_INDEX=2147483647,n.HIGHER_TRANSLATE3D_Z_AXIS=9999999,n.DESKTOP_PANEL_HEIGHT=600,n.DESKTOP_PANEL_AND_WIDGET_WIDTH=390,n.PANEL_TOP_BAR_HEIGHT=45,n.TAB_SELECTOR_HEIGHT=68,n.DEFAULT_BUTTON_HEIGHT=34,n.DEFAULT_FULL_WIDTH_BUTTON_HEIGHT=40,n.WIDGET_VERTICAL_PADDING=16,n.DEFAULT_PANEL_AND_WIDGET_HORIZONTAL_PADDING=16,n.DEFAULT_PANEL_TOP_PADDING=16,n.BOTTOM_SHEET_MAXIMUM_HEIGHT=100,n.BOTTOM_SHEET_BAR_HEIGHT=21,n.DEFAULT_BOTTOM_SHEET_HORIZONTAL_PADDING=16,n.DEFAULT_BOTTOM_SHEET_BOTTOM_PADDING=8,n.DEFAULT_BUTTON_FONT_SIZE=12,n.DEFAULT_FULL_WIDTH_BUTTON_FONT_SIZE=14,n.DEFAULT_BUTTON_FONT_WEIGHT=900,n.OPEN_AND_CLOSE_ANIMATIONS_DURATION_IN_SECONDS=.3,n.NON_HIGHLIGHTABLE_NOR_DRAGGABLE_ELEMENT_CSS_MIXIN=(0,s.css)(r||(r=o(["\n    -webkit-touch-callout: none;\n    -webkit-user-select: none;\n    -html-user-select: none;\n    -moz-user-select: none;\n    -ms-user-select: none;\n    user-select: none;\n    user-drag: none;\n"],["\n    -webkit-touch-callout: none;\n    -webkit-user-select: none;\n    -html-user-select: none;\n    -moz-user-select: none;\n    -ms-user-select: none;\n    user-select: none;\n    user-drag: none;\n"]))),n.CLICKABLE_ELEMENT_CSS_MIXIN=(0,s.css)(a||(a=o(["\n    touch-action: manipulation;\n    -webkit-tap-highlight-color: transparent;\n    cursor: pointer;\n    ","\n"],["\n    touch-action: manipulation;\n    -webkit-tap-highlight-color: transparent;\n    cursor: pointer;\n    ","\n"])),n.NON_HIGHLIGHTABLE_NOR_DRAGGABLE_ELEMENT_CSS_MIXIN),n.TRUNCATED_TEXT_CSS_MIXIN=(0,s.css)(i||(i=o(["\n    overflow: hidden;\n    text-overflow: ellipsis;\n    white-space: nowrap;\n"],["\n    overflow: hidden;\n    text-overflow: ellipsis;\n    white-space: nowrap;\n"]))),n.MOBILE_PANEL_HEIGHT=function(){var e=2*Math.round(.6*window.screen.height/2);if(e<425)return 425;if(e>600)return 600;return e}()},68134:function(e,n,t){var o=this&&this.__read||function(e,n){var t="function"==typeof Symbol&&e[Symbol.iterator];if(!t)return e;var o,r,a=t.call(e),i=[];try{for(;(void 0===n||n-- >0)&&!(o=a.next()).done;)i.push(o.value)}catch(e){r={error:e}}finally{try{o&&!o.done&&(t=a.return)&&t.call(a)}finally{if(r)throw r.error}}return i},r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(n,"__esModule",{value:!0}),n.useGetTabId=n.getTabId=void 0;var a=r(t(96540)),i=t(46239);function s(){return new Promise((function(e){return(0,i.sendMessageToBackgroundScript)({message:"getTabId"},(function(n){return e(n.tabId)}))}))}n.getTabId=s,n.useGetTabId=function(){var e=o(a.default.useState(void 0),2),n=e[0],t=e[1];return a.default.useEffect((function(){s().then(t)}),[]),n}},31229:function(e,n,t){var o=this&&this.__awaiter||function(e,n,t,o){return new(t||(t=Promise))((function(r,a){function i(e){try{u(o.next(e))}catch(e){a(e)}}function s(e){try{u(o.throw(e))}catch(e){a(e)}}function u(e){var n;e.done?r(e.value):(n=e.value,n instanceof t?n:new t((function(e){e(n)}))).then(i,s)}u((o=o.apply(e,n||[])).next())}))},r=this&&this.__generator||function(e,n){var t,o,r,a,i={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return a={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function s(s){return function(u){return function(s){if(t)throw new TypeError("Generator is already executing.");for(;a&&(a=0,s[0]&&(i=0)),i;)try{if(t=1,o&&(r=2&s[0]?o.return:s[0]?o.throw||((r=o.return)&&r.call(o),0):o.next)&&!(r=r.call(o,s[1])).done)return r;switch(o=0,r&&(s=[2&s[0],r.value]),s[0]){case 0:case 1:r=s;break;case 4:return i.label++,{value:s[1],done:!1};case 5:i.label++,o=s[1],s=[0];continue;case 7:s=i.ops.pop(),i.trys.pop();continue;default:if(!(r=i.trys,(r=r.length>0&&r[r.length-1])||6!==s[0]&&2!==s[0])){i=0;continue}if(3===s[0]&&(!r||s[1]>r[0]&&s[1]<r[3])){i.label=s[1];break}if(6===s[0]&&i.label<r[1]){i.label=r[1],r=s;break}if(r&&i.label<r[2]){i.label=r[2],i.ops.push(s);break}r[2]&&i.ops.pop(),i.trys.pop();continue}s=n.call(e,i)}catch(e){s=[6,e],o=0}finally{t=r=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,u])}}},a=this&&this.__read||function(e,n){var t="function"==typeof Symbol&&e[Symbol.iterator];if(!t)return e;var o,r,a=t.call(e),i=[];try{for(;(void 0===n||n-- >0)&&!(o=a.next()).done;)i.push(o.value)}catch(e){r={error:e}}finally{try{o&&!o.done&&(t=a.return)&&t.call(a)}finally{if(r)throw r.error}}return i},i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(n,"__esModule",{value:!0}),n.useIsTemporaryUser=n.checkIsTemporaryUser=n.checkIsPhoneNumberDuplicate=n.updateUser=n.useUser=void 0;var s=i(t(96540)),u=t(46239);function c(){return new Promise((function(e){return(0,u.sendMessageToBackgroundScript)({message:"checkIsTemporaryUser"},(function(n){e((null==n?void 0:n.isTemporaryUser)||!1)}))}))}n.useUser=function(){var e=a(s.default.useState(void 0),2),n=e[0],t=e[1];return s.default.useEffect((function(){(0,u.sendMessageToBackgroundScript)({message:"getUser"},(function(e){(null==e?void 0:e.user)&&t(e.user)}))}),[]),n},n.updateUser=function(e){return new Promise((function(n,t){return(0,u.sendMessageToBackgroundScript)({message:"updateUser",data:e},(function(e){return e.success?n():t()}))}))},n.checkIsPhoneNumberDuplicate=function(e){return new Promise((function(n,t){return(0,u.sendMessageToBackgroundScript)({message:"checkIsPhoneNumberDuplicate",data:{formattedPhoneNumber:e}},(function(e){var o=e.isDuplicate;void 0===o&&t(),n(!!o)}))}))},n.checkIsTemporaryUser=c,n.useIsTemporaryUser=function(){var e=this,n=a(s.default.useState(!1),2),t=n[0],i=n[1],u=function(){return o(e,void 0,void 0,(function(){var e;return r(this,(function(n){switch(n.label){case 0:return"visible"!==document.visibilityState?[3,2]:(e=i,[4,c()]);case 1:e.apply(void 0,[n.sent()]),n.label=2;case 2:return[2]}}))}))};return s.default.useEffect((function(){return function(){o(this,void 0,void 0,(function(){return r(this,(function(e){switch(e.label){case 0:return document.addEventListener("visibilitychange",u),[4,u()];case 1:return e.sent(),[2]}}))}))}(),function(){return document.removeEventListener("visibilitychange",u)}}),[]),t}},98668:function(e,n,t){var o=this&&this.__assign||function(){return o=Object.assign||function(e){for(var n,t=1,o=arguments.length;t<o;t++)for(var r in n=arguments[t])Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r]);return e},o.apply(this,arguments)},r=this&&this.__awaiter||function(e,n,t,o){return new(t||(t=Promise))((function(r,a){function i(e){try{u(o.next(e))}catch(e){a(e)}}function s(e){try{u(o.throw(e))}catch(e){a(e)}}function u(e){var n;e.done?r(e.value):(n=e.value,n instanceof t?n:new t((function(e){e(n)}))).then(i,s)}u((o=o.apply(e,n||[])).next())}))},a=this&&this.__generator||function(e,n){var t,o,r,a,i={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return a={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function s(s){return function(u){return function(s){if(t)throw new TypeError("Generator is already executing.");for(;a&&(a=0,s[0]&&(i=0)),i;)try{if(t=1,o&&(r=2&s[0]?o.return:s[0]?o.throw||((r=o.return)&&r.call(o),0):o.next)&&!(r=r.call(o,s[1])).done)return r;switch(o=0,r&&(s=[2&s[0],r.value]),s[0]){case 0:case 1:r=s;break;case 4:return i.label++,{value:s[1],done:!1};case 5:i.label++,o=s[1],s=[0];continue;case 7:s=i.ops.pop(),i.trys.pop();continue;default:if(!(r=i.trys,(r=r.length>0&&r[r.length-1])||6!==s[0]&&2!==s[0])){i=0;continue}if(3===s[0]&&(!r||s[1]>r[0]&&s[1]<r[3])){i.label=s[1];break}if(6===s[0]&&i.label<r[1]){i.label=r[1],r=s;break}if(r&&i.label<r[2]){i.label=r[2],i.ops.push(s);break}r[2]&&i.ops.pop(),i.trys.pop();continue}s=n.call(e,i)}catch(e){s=[6,e],o=0}finally{t=r=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,u])}}},i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(n,"__esModule",{value:!0}),n.logUserEventFromContentScript=n.logUserEvent=void 0;var s=i(t(2543)),u=t(55015),c=t(47248),l=t(32668),d=t(46239);n.logUserEvent=function(e){return r(this,void 0,void 0,(function(){return a(this,(function(n){switch(n.label){case 0:return[4,(0,d.sendMessageToBackgroundScript)({message:"logUserEvent",data:{event:e}})];case 1:return n.sent(),[2]}}))}))},n.logUserEventFromContentScript=function(e){return r(this,void 0,void 0,(function(){var n,t,r,i,s,d,f,m,_;return a(this,(function(a){switch(a.label){case 0:return h=Date.now(),v=p.lastEventTimestampMs,g=v&&h<=v?v+1:h,p.lastEventTimestampMs=g,n=Number((g/1e3).toFixed(3)),[4,(0,u.getLocalStorageItem)(u.LocalStorageKey.userId)];case 1:return(t=a.sent())?[4,(0,u.getLocalStorageItem)(u.LocalStorageKey.deviceId)]:[2];case 2:return r=a.sent(),i=u.browserKind===u.Browser.mobileAppWebView?c.UserEventPlatform.mobileApp:u.browserKind===u.Browser.chrome?c.UserEventPlatform.chromeExtension:u.browserKind===u.Browser.firefox?c.UserEventPlatform.firefoxExtension:u.browserKind===u.Browser.safari&&(0,l.checkIsOnMobileScreen)()?c.UserEventPlatform.mobileSafariExtension:u.browserKind===u.Browser.safari&&(0,l.checkIsOnMobileScreen)()?c.UserEventPlatform.safariExtension:c.UserEventPlatform.unknown,s=(0,u.getVersionNumberKeyName)(i===c.UserEventPlatform.mobileSafariExtension),d=o(o({},e.payload),((_={})[s]=u.versionNumber,_.platform=i,_.deviceId=r,_)),f=JSON.stringify(d),m=o(o({},e),{payload:f,active:void 0===e.active||e.active,timestamp:n}),[4,y(t,[m])];case 3:return a.sent(),[2]}var h,v,g}))}))};var p={lastEventTimestampMs:void 0};var f="https://ttwgkhkd82.execute-api.eu-west-1.amazonaws.com/ingest-user-events",m="https://5lcadbj7za.execute-api.eu-west-1.amazonaws.com/ingest-user-events";function y(e,n){return r(this,void 0,void 0,(function(){var t,o,i,c=this;return a(this,(function(l){switch(l.label){case 0:return(t=new Headers).append("Content-Type","application/json"),[4,(0,u.checkIsOnDevStack)()];case 1:return o=l.sent(),i=s.default.chunk(n,5),[4,Promise.all(i.map((function(n){return r(c,void 0,void 0,(function(){return a(this,(function(r){switch(r.label){case 0:return[4,fetch(o?f:m,{method:"POST",headers:t,body:JSON.stringify({userId:e,events:n})})];case 1:return[2,r.sent()]}}))}))})))];case 2:return l.sent(),[2]}}))}))}},87439:(e,n)=>{Object.defineProperty(n,"__esModule",{value:!0}),n.compareVersions=void 0,n.compareVersions=function(e,n){for(var t=e.split("."),o=n.split("."),r=Math.max(t.length,o.length),a=0;a<r;a++){var i=parseInt(t[a]||"0"),s=parseInt(o[a]||"0");if(i<s)return-1;if(i>s)return 1}return 0}},66499:function(e,n,t){var o=this&&this.__awaiter||function(e,n,t,o){return new(t||(t=Promise))((function(r,a){function i(e){try{u(o.next(e))}catch(e){a(e)}}function s(e){try{u(o.throw(e))}catch(e){a(e)}}function u(e){var n;e.done?r(e.value):(n=e.value,n instanceof t?n:new t((function(e){e(n)}))).then(i,s)}u((o=o.apply(e,n||[])).next())}))},r=this&&this.__generator||function(e,n){var t,o,r,a,i={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return a={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function s(s){return function(u){return function(s){if(t)throw new TypeError("Generator is already executing.");for(;a&&(a=0,s[0]&&(i=0)),i;)try{if(t=1,o&&(r=2&s[0]?o.return:s[0]?o.throw||((r=o.return)&&r.call(o),0):o.next)&&!(r=r.call(o,s[1])).done)return r;switch(o=0,r&&(s=[2&s[0],r.value]),s[0]){case 0:case 1:r=s;break;case 4:return i.label++,{value:s[1],done:!1};case 5:i.label++,o=s[1],s=[0];continue;case 7:s=i.ops.pop(),i.trys.pop();continue;default:if(!(r=i.trys,(r=r.length>0&&r[r.length-1])||6!==s[0]&&2!==s[0])){i=0;continue}if(3===s[0]&&(!r||s[1]>r[0]&&s[1]<r[3])){i.label=s[1];break}if(6===s[0]&&i.label<r[1]){i.label=r[1],r=s;break}if(r&&i.label<r[2]){i.label=r[2],i.ops.push(s);break}r[2]&&i.ops.pop(),i.trys.pop();continue}s=n.call(e,i)}catch(e){s=[6,e],o=0}finally{t=r=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,u])}}};Object.defineProperty(n,"__esModule",{value:!0}),n.retrieveConsentToTermsOfServiceAndPrivacyPolicyFromWebApp=n.setWebAppListener=n.openWebAppSignInPage=n.handleGetWebAppLoginInfoMessage=void 0;var a=t(74137),i=t(46239);n.handleGetWebAppLoginInfoMessage=function(){for(var e={},n=0;;n++){var t=localStorage.key(n);if(!t)break;("@AuthenticationStore:devStackMode"===t||t.startsWith("CognitoIdentityServiceProvider"))&&(e[t]=localStorage.getItem(t))}(0,i.sendMessageToBackgroundScript)({message:"webAppLoginInfoSent",data:e})};function s(e){if(e.source===window&&e.data.type&&"string"==typeof e.data.type&&e.data.type.startsWith("joko:"))switch(e.data.type){case"joko:saveOfferActivatedInitialUrlPayload":(0,i.sendMessageToBackgroundScript)({message:"saveOfferActivatedInitialUrlPayload",data:e.data.payload});break;case"joko:offerActivatedFromWebApp":(0,i.sendMessageToBackgroundScript)({message:"triggerPostAffiliateLinkLoadingActions",data:{offerId:e.data.payload.offerId,rememberActivation:!0}})}}n.openWebAppSignInPage=function(){return new Promise((function(e){(0,i.sendMessageToBackgroundScript)({message:"openTab",data:{url:"https://app.joko.com/auth/sign-in"}},e)}))},n.setWebAppListener=function(){var e=(0,a.withSentry)(s);window.removeEventListener("message",e),window.addEventListener("message",e)};n.retrieveConsentToTermsOfServiceAndPrivacyPolicyFromWebApp=function(){return o(this,void 0,void 0,(function(){var e,n;return r(this,(function(t){switch(t.label){case 0:return[4,new Promise((function(e){return setTimeout(e,1e3)}))];case 1:return t.sent(),function(){try{var e=new URL(window.location.href).hostname;return!!/app\.(hello)?joko\.com/.test(e)}catch(e){return(0,a.captureSentryException)(e),!1}}()?(e="true"===localStorage.getItem("@ConsentsStore:mobileSafariExtensionTermsOfServiceAndPrivacyPolicyConsent"),n="true"===localStorage.getItem("@ConsentsStore:mobileSafariExtensionTermsOfServiceAndPrivacyPolicyConsentIsDevStackMode"),e&&(0,i.sendMessageToBackgroundScript)({message:"termsOfServiceAndPrivacyPolicyConsentDetected",data:{isDevStackMode:n}}),[2]):[2]}}))}))}},13093:function(e,n,t){var o=this&&this.__assign||function(){return o=Object.assign||function(e){for(var n,t=1,o=arguments.length;t<o;t++)for(var r in n=arguments[t])Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r]);return e},o.apply(this,arguments)},r=this&&this.__awaiter||function(e,n,t,o){return new(t||(t=Promise))((function(r,a){function i(e){try{u(o.next(e))}catch(e){a(e)}}function s(e){try{u(o.throw(e))}catch(e){a(e)}}function u(e){var n;e.done?r(e.value):(n=e.value,n instanceof t?n:new t((function(e){e(n)}))).then(i,s)}u((o=o.apply(e,n||[])).next())}))},a=this&&this.__generator||function(e,n){var t,o,r,a,i={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return a={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function s(s){return function(u){return function(s){if(t)throw new TypeError("Generator is already executing.");for(;a&&(a=0,s[0]&&(i=0)),i;)try{if(t=1,o&&(r=2&s[0]?o.return:s[0]?o.throw||((r=o.return)&&r.call(o),0):o.next)&&!(r=r.call(o,s[1])).done)return r;switch(o=0,r&&(s=[2&s[0],r.value]),s[0]){case 0:case 1:r=s;break;case 4:return i.label++,{value:s[1],done:!1};case 5:i.label++,o=s[1],s=[0];continue;case 7:s=i.ops.pop(),i.trys.pop();continue;default:if(!(r=i.trys,(r=r.length>0&&r[r.length-1])||6!==s[0]&&2!==s[0])){i=0;continue}if(3===s[0]&&(!r||s[1]>r[0]&&s[1]<r[3])){i.label=s[1];break}if(6===s[0]&&i.label<r[1]){i.label=r[1],r=s;break}if(r&&i.label<r[2]){i.label=r[2],i.ops.push(s);break}r[2]&&i.ops.pop(),i.trys.pop();continue}s=n.call(e,i)}catch(e){s=[6,e],o=0}finally{t=r=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,u])}}},i=this&&this.__rest||function(e,n){var t={};for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&n.indexOf(o)<0&&(t[o]=e[o]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var r=0;for(o=Object.getOwnPropertySymbols(e);r<o.length;r++)n.indexOf(o[r])<0&&Object.prototype.propertyIsEnumerable.call(e,o[r])&&(t[o[r]]=e[o[r]])}return t},s=this&&this.__read||function(e,n){var t="function"==typeof Symbol&&e[Symbol.iterator];if(!t)return e;var o,r,a=t.call(e),i=[];try{for(;(void 0===n||n-- >0)&&!(o=a.next()).done;)i.push(o.value)}catch(e){r={error:e}}finally{try{o&&!o.done&&(t=a.return)&&t.call(a)}finally{if(r)throw r.error}}return i},u=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(n,"__esModule",{value:!0}),n.saveState=n.handleActiveState=n.startCouponApplication=n.startCouponAutomation=void 0;var c=u(t(2543)),l=t(55015),d=t(74137),p=t(95537),f=t(33682),m=t(18045),y=t(91958),_=t(99959),h=t(622),v=t(50479),g=t(42604),C=t(18345),b=t(98356),S=t(13103),T=t(11046),I=t(46239),A=t(89710),E=t(23907),w=t(72886);function O(e){return r(this,void 0,void 0,(function(){var n,t,o,r,i,s,u,c,l;return a(this,(function(a){switch(a.label){case 0:return R({passive:e}),n=e.coupons,t=e.offerId,o=e.selectors,r=e.shouldLoadAffiliateLinkOnAutomation,i=e.couponApplicationProcessId,s=e.displayedAmountSavedByUsersUsingAutoCoupons,u=e.totalAmountSavedByUsersUsingAutoCoupons,c=e.displayedSuccessRateAutoCoupons,l=e.lastUsedAtAutoCoupons,[4,(0,E.checkShouldDisplayCouponsCheckoutWidgetForOffer)(e)];case 1:return a.sent()?(0,E.handleCouponAutomationProposalWidgetDisplay)({numberOfCoupons:n.length,offerId:t,selectors:o,shouldLoadAffiliateLinkOnAutomation:r,startCouponApplication:function(n){return P(e,"couponWidget",n)},couponApplicationProcessId:i,displayedAmountSavedByUsersUsingAutoCoupons:s,totalAmountSavedByUsersUsingAutoCoupons:u,displayedSuccessRateAutoCoupons:c,lastUsedAtAutoCoupons:l}):(0,w.submitWidgetDisplayDecision)({widgetName:w.PriorityOrderedWidgetName.couponAutomationProposalWidget,shouldDisplayWidget:!1}),[2]}}))}))}function P(e,n,t){!1!==e.shouldLoadAffiliateLinkOnAutomation&&(0,A.handleUserInterfaceComponentInteractionInBackground)(o(o({},e),{triggeringEventType:l.UserInterfaceComponentInteractionEventType.couponSuggestionWidgetStartButton})),(0,I.sendMessageToBackgroundScript)({message:"updateMerchantOfferLastUsedAtAutoCoupons",data:{offerId:e.offerId,lastUsedAtAutoCouponsTimestampInSeconds:Math.floor(Date.now()/1e3)}}),e.stateType=l.CouponAutomationPassiveStateType.init,N(e,n,t)}function N(e,n,t){return r(this,void 0,void 0,(function(){var r,s;return a(this,(function(a){switch(a.label){case 0:return R({passive:e}),(0,b.injectScriptAndReplaceExistingOne)(b.InjectedScriptElement.countPendingRequests),r=function(){"couponWidget"===n&&(null==t||t());var r=(0,h.getPriceAmountAndCurrency)(e),a=r.priceAmount,s=r.priceCurrency,u=r.priceSelector;if(e.selectors.price=u,(0,v.logStartedCouponApplicationEvents)(e,n),null!==a&&s){var c=function(e,n,t){var r=e.shouldUseNetworkRequestsApplication,a=i(e,["shouldUseNetworkRequestsApplication"]);return{active:o(o({},a),{shouldUseNetworkRequestsApplication:r,shouldUseIframePriceParsing:r,basePrice:n,priceCurrency:t,couponIndex:0,isFinal:!1,webpageUrl:window.location.href,stateType:r?l.CouponAutomationActiveStateType.send:l.CouponAutomationActiveStateType.prepare})}}(e,a,s);(0,E.displayCouponApplicationWidget)(c,!1)}else(0,E.displayCouponApplicationWidget)({},!0)},(s=e.selectors.showCouponFieldClickableElement?e.selectors.showCouponFieldClickableElement.selector:void 0)&&!e.shouldUseNetworkRequestsApplication?[3,1]:(r(),[3,3]);case 1:return k(s),[4,(0,S.sleepUntilNoPendingRequestsAndUntilAllCouponElementsAreFoundWithTimeout)(e,S.SHOW_COUPON_FIELD_CLICKABLE_ELEMENT_POST_CLICK_DELAY_IN_MS,S.COUPON_ELEMENTS_INSPECTION_TIMEOUT_IN_MS)];case 2:a.sent(),r(),a.label=3;case 3:return[2]}}))}))}function k(e){var n=(0,f.getElementFromSelector)(e);(0,l.checkIsCouponSelectorError)(n)||"function"!=typeof n.click||n.click()}function R(e){var n=window.location.href;(0,I.sendMessageToBackgroundScript)({message:"saveCouponAutomationState",data:{state:e,url:n}})}function L(e){var n=e.coupons,t=e.bestCoupon,o=e.isFinal,r=e.couponIndex;return o&&t&&t!==n[r]}function M(e){return r(this,void 0,void 0,(function(){var n,t,o,r;return a(this,(function(a){switch(a.label){case 0:if(!e.networkRequestsParameters)throw new Error("Invalid or missing network request parameters");return n=(0,T.getCouponTokens)(e.responseParsingResult),t=Math.random().toString(36).substring(2,8).toUpperCase(),[4,(0,g.fetchMerchantApiCouponApplicationResponse)({couponCode:t,activeState:e,couponRequestTokens:n})];case 1:return o=a.sent(),[4,(0,C.checkWasApplicationSuccessfulFromMerchantApiResponse)({response:o,appliedCouponCode:t,activeState:e,warmupCouponApplicationStatus:void 0})];case 2:return r=a.sent(),[4,(0,S.sleepUntilNoPendingRequests)(S.NETWORK_REQUESTS_POST_COUPON_APPLICATION_DELAY_IN_MS)];case 3:if(a.sent(),"successful"===r.result.type)throw new Error("The response parsing mechanism interpreted the warmup application as a successful one");return e.warmupCouponApplicationStatus={wasResponseOk:o.ok},e.responseParsingResult=r,[2]}}))}))}function D(e,n){return r(this,void 0,void 0,(function(){var t,o,r;return a(this,(function(a){switch(a.label){case 0:return t=(0,T.getCouponTokens)(n.active?n.active.responseParsingResult:n.done?n.done.responseParsingResult:void 0),o=e.isFinal&&e.bestCoupon?e.bestCoupon.code:e.coupons[e.couponIndex].code,[4,(0,g.fetchMerchantApiCouponApplicationResponse)({couponCode:o,couponRequestTokens:t,activeState:e})];case 1:return r=a.sent(),[2,(0,C.checkWasApplicationSuccessfulFromMerchantApiResponse)({response:r,appliedCouponCode:o,activeState:e,warmupCouponApplicationStatus:n.active?n.active.warmupCouponApplicationStatus:n.done?n.done.warmupCouponApplicationStatus:void 0})]}}))}))}function x(e,n,t,o){return r(this,void 0,void 0,(function(){var r,i,s;return a(this,(function(a){switch(a.label){case 0:return[4,U()];case 1:if(r=a.sent(),!e.contentWindow)throw new Error("Iframe content window not found");return(i=e.contentWindow.document).open(),i.write(r),i.close(),[4,(0,S.sleepUntilNoPendingRequests)(100)];case 2:return a.sent(),s=(0,h.getPriceAmountAndCurrency)(n,i.body),W({nextActiveState:t,previousActiveState:n,priceAmount:s.priceAmount}),document.documentElement.removeChild(e),F({nextActiveState:t,previousActiveState:n,setState:o,priceAmount:s.priceAmount}),[2]}}))}))}function U(){return r(this,void 0,void 0,(function(){return a(this,(function(e){switch(e.label){case 0:return[4,fetch(window.location.href)];case 1:return[2,e.sent().text()]}}))}))}function B(e){var n=e.activeState,t=e.nextActiveState,o=e.setState,i=e.onError;return r(this,void 0,void 0,(function(){var e,r,s,u;return a(this,(function(a){switch(a.label){case 0:return e=(0,h.getPriceAmountAndCurrency)(n),r=e.priceAmount,s=e.priceSelector,t.selectors.price=s,r||!n.isPageReloading?[3,2]:[4,(0,S.sleepUntilNoPendingRequests)(S.SELECTORS_POST_PAGE_RELOAD_CHECK_VALIDITY_DELAY_IN_MS)];case 1:a.sent(),u=(0,h.getPriceAmountAndCurrency)(n),r=u.priceAmount,t.selectors.price=u.priceSelector,a.label=2;case 2:return r||n.shouldUseNetworkRequestsApplication?(W({nextActiveState:t,previousActiveState:n,priceAmount:r}),F({nextActiveState:t,previousActiveState:n,setState:o,priceAmount:r}),[2]):(i(n,Error("Could not read price."),!1),[2])}}))}))}function F(e){var n=e.nextActiveState,t=e.previousActiveState,o=e.setState,r=e.priceAmount,a={active:n};(0,v.logCouponTestedEvent)(a.active,t.webpageUrl,r),t.couponIndex+1>=t.coupons.length?(a.active.isFinal=!0,a.active.shouldUseIframePriceParsing=!1):a.active.couponIndex+=1,R(a),o(a)}function W(e){var n=e.nextActiveState,t=e.previousActiveState,o=e.priceAmount;null!==o&&(o>t.basePrice&&(n.basePrice=o),(t.bestPrice&&o<t.bestPrice||void 0===t.bestPrice&&o<t.basePrice)&&(n.bestPrice=o,n.bestCoupon=t.coupons[t.couponIndex])),!t.bestCoupon&&t.responseParsingResult&&"successful"===t.responseParsingResult.result.type&&(n.bestCoupon=t.coupons[t.couponIndex])}n.startCouponAutomation=function(){return r(this,void 0,void 0,(function(){var e,n;return a(this,(function(t){switch(t.label){case 0:return[4,(0,w.checkShouldPrioritizeAutoCouponsWidgetOverCashbackReminderWidget)()];case 1:return t.sent(),e=window.location.href,n=function(e){if(null==e?void 0:e.passive)e.passive.shouldUseNetworkRequestsApplication&&(0,b.injectScriptAndReplaceExistingOne)(b.InjectedScriptElement.captureHeadersAuthorizationToken),function(e){switch(e.stateType){case l.CouponAutomationPassiveStateType.inspect:!function(e){var n=this;if(0===e.coupons.length)return;(0,v.logCouponElementsDetectionMechanismStartedOnCartWebpage)(e);var t=0,o=c.default.once(v.logCouponElementsFoundEvent),i=(0,p.detectCouponCrmDriverForCurrentWebsite)(),s=window.setInterval((0,d.withSentry)((function(){return r(n,void 0,void 0,(function(){var n,r,u,c,d;return a(this,(function(a){switch(a.label){case 0:return t+=1,n=(0,m.checkDoCouponElementsExistAndUpdateSelectors)(e),r=n.doCouponElementsExist,u=n.selectors,c=(0,m.checkShowCouponElementsButtonExists)(u),e.selectors=u,(0,v.checkShouldLogElementsFoundEvent)(e)&&o(e),r||c?(clearInterval(s),e.stateType=l.CouponAutomationPassiveStateType.propose,e.selectors=u,[4,i]):[3,2];case 1:return(d=a.sent())&&(e.couponCrm=d.couponCrm),O(e),[3,3];case 2:(1===t&&!(0,E.checkShouldDisplayCouponsCheckoutWidgetForOffer)(e)||2===t)&&((0,w.submitWidgetDisplayDecision)({widgetName:w.PriorityOrderedWidgetName.couponAutomationProposalWidget,shouldDisplayWidget:!1}),(0,v.logCouponElementsNotFoundEvent)(e)),a.label=3;case 3:return[2]}}))}))})),S.COUPON_AUTOMATION_INSPECT_INTERVAL_IN_MS)}(e);break;case l.CouponAutomationPassiveStateType.propose:O(e);break;case l.CouponAutomationPassiveStateType.init:N(e,"couponWidget")}}(e.passive);else if(e&&(e.active||e.done)){(0,b.injectScriptAndReplaceExistingOne)(b.InjectedScriptElement.countPendingRequests);var n=function(e){return e.active?{active:o(o({},e.active),{isPageReloading:!0})}:e}(e);(0,E.displayCouponApplicationWidget)(n,!1)}else(0,w.submitWidgetDisplayDecision)({widgetName:w.PriorityOrderedWidgetName.couponAutomationProposalWidget,shouldDisplayWidget:!1})},(0,I.sendMessageToBackgroundScript)({message:"getCouponAutomationState",data:{url:e}},n),[2]}}))}))},n.startCouponApplication=P,n.handleActiveState=function(e,n,t){switch(e.stateType){case l.CouponAutomationActiveStateType.prepare:!function(e,n,t){r(this,void 0,void 0,(function(){var r,i,u,c,d,p,f,_;return a(this,(function(a){switch(a.label){case 0:if(r=e.selectors.showCouponFieldClickableElement?e.selectors.showCouponFieldClickableElement.selector:void 0,i=s((0,y.getRemovalButton)(e),2),u=i[0],c=i[1],e.selectors.removalButton=c,R(d={active:o(o({},e),{stateType:l.CouponAutomationActiveStateType.fill})}),e.isFinal&&(e.bestCoupon===e.coupons[e.couponIndex]||!e.bestCoupon))return n(d),[2];a.label=1;case 1:return a.trys.push([1,11,,12]),u?(u.click(),r?[3,3]:[4,(0,S.sleepUntilNoPendingRequestsAndUntilAllCouponElementsAreFoundWithTimeout)(d.active,S.REMOVAL_BUTTON_POST_CLICK_DELAY_IN_MS,S.COUPON_ELEMENTS_INSPECTION_TIMEOUT_IN_MS)]):[3,6];case 2:return a.sent(),[3,5];case 3:return[4,(0,S.sleepUntilNoPendingRequests)(S.REMOVAL_BUTTON_POST_CLICK_DELAY_IN_MS)];case 4:a.sent(),a.label=5;case 5:return[3,8];case 6:return(0,m.checkDoCouponElementsExistAndUpdateSelectors)(d.active).doCouponElementsExist?[3,8]:[4,(0,S.sleepUntilRemovalButtonElementIsFoundWithTimeout)(d.active,S.COUPON_ELEMENTS_INSPECTION_TIMEOUT_IN_MS)];case 7:a.sent(),p=s((0,y.getRemovalButton)(d.active),1),(f=p[0])&&f.click(),a.label=8;case 8:return!r||(0,m.checkDoCouponElementsExistAndUpdateSelectors)(d.active).doCouponElementsExist?[3,10]:(k(r),[4,(0,S.sleepUntilNoPendingRequestsAndUntilAllCouponElementsAreFoundWithTimeout)(d.active,S.SHOW_COUPON_FIELD_CLICKABLE_ELEMENT_POST_CLICK_DELAY_IN_MS,S.COUPON_ELEMENTS_INSPECTION_TIMEOUT_IN_MS)]);case 9:a.sent(),a.label=10;case 10:return n(d),[3,12];case 11:return _=a.sent(),t(e,_,!1),[3,12];case 12:return[2]}}))}))}(e,n,t);break;case l.CouponAutomationActiveStateType.fill:!function(e,n,t){var i=this,u=function(){return r(i,void 0,void 0,(function(){var r,i,u,c,d;return a(this,(function(a){switch(a.label){case 0:return e.isPageReloading?[4,(0,S.sleepUntilNoPendingRequestsAndUntilAllCouponElementsAreFoundWithTimeout)(e,S.FILL_COUPON_INPUT_FIELD_DELAY_IN_MS,S.COUPON_ELEMENTS_INSPECTION_TIMEOUT_IN_MS)]:[3,2];case 1:a.sent(),a.label=2;case 2:r={active:o(o({},e),{stateType:l.CouponAutomationActiveStateType.checkValidity,isPageReloading:void 0===e.isPageReloading||e.isPageReloading})},i=e.coupons[e.couponIndex],e.isFinal&&(void 0!==e.bestCoupon&&(i=e.bestCoupon),r={done:r.active}),R(r);try{e.isFinal&&!L(e)||function(e,n){var t=function(e,n){var t=n.selectors,o=s((0,_.getCouponInputField)(t),2),r=o[0],a=o[1];return n.selectors.couponField=a,r&&r instanceof HTMLInputElement?(r.focus(),r.click(),r.dispatchEvent(new KeyboardEvent("keydown",{key:"Backspace",bubbles:!0})),r.dispatchEvent(new KeyboardEvent("keyup",{key:"Backspace",bubbles:!0})),r.value=e,r.dispatchEvent(new Event("change",{bubbles:!0})),r.dispatchEvent(new Event("input",{bubbles:!0})),{wasFillingSuccessful:!0,couponInputFieldElement:r}):{wasFillingSuccessful:!1}}(n,e),o=t.wasFillingSuccessful,r=t.couponInputFieldElement;if(!o||!r)throw new Error("Coupon input field not found or invalid");!function(e,n){var t=s((0,y.getValidationButton)(e.selectors,n),2),o=t[0],r=t[1];e.selectors.validationButton=r,n.dispatchEvent(new KeyboardEvent("keydown",{key:"Enter",bubbles:!0})),n.dispatchEvent(new KeyboardEvent("keyup",{key:"Enter",bubbles:!0})),n.blur(),o&&o.click()}(e,r)}(e,i.code),e.isFinal&&((0,v.logCouponApplicationFinalEvents)(e),(0,E.setLastCouponAutomationResult)({type:E.CouponAutomationResultType.completed,timestampInMs:Date.now()}))}catch(n){return t(e,n,e.isFinal),[2]}u=!!r.active&&r.active.isPageReloading,a.label=3;case 3:return a.trys.push([3,5,,6]),c=e.customDelayBetweenApplicationsInMs?e.customDelayBetweenApplicationsInMs:u?S.COUPON_APPLICATION_PAGE_RELOAD_TIMEOUT_IN_MS:S.SELECTORS_POST_COUPON_APPLICATION_DELAY_IN_MS,[4,(0,S.sleepUntilNoPendingRequests)(c)];case 4:return a.sent(),n(o(o({},r),{active:r.active?o(o({},r.active),{isPageReloading:!1}):void 0})),[3,6];case 5:return d=a.sent(),t(e,d,e.isFinal),[3,6];case 6:return[2]}}))}))},c=e.isPageReloading,d=e.selectors,p=e.couponIndex;if(c){var f=d.showCouponFieldClickableElement?d.showCouponFieldClickableElement.selector:void 0;f&&p>0&&k(f)}(0,S.runCallbackOnPageFinishedLoading)(u,c)}(e,n,t);break;case l.CouponAutomationActiveStateType.send:!function(e,n,t){r(this,void 0,void 0,(function(){var r,i,s;return a(this,(function(a){switch(a.label){case 0:r=e.isFinal?{done:e}:{active:o(o({},e),{stateType:l.CouponAutomationActiveStateType.checkValidity})},i=Date.now(),a.label=1;case 1:if(a.trys.push([1,5,,6]),!e.networkRequestsParameters)throw new Error("Invalid or missing network request parameters");return!r.active||r.active.warmupCouponApplicationStatus?[3,3]:[4,M(r.active)];case 2:a.sent(),a.label=3;case 3:return[4,D(e,r)];case 4:return s=a.sent(),e.isFinal&&((0,v.logCouponApplicationFinalEvents)(e),(0,E.setLastCouponAutomationResult)({type:E.CouponAutomationResultType.completed,timestampInMs:Date.now()}),!L(e))?(R(r),n(r),[2]):(r.active&&(r.active.responseParsingResult=s,r.active.couponCrm=s.couponCrm),R(r),"successful"===s.result.type||L(e)&&e.isFinal?(function(e,n){var t;if(e.active&&(R(e),e.active.couponCrm)){var o=(0,p.getCouponCrmDriver)(e.active.couponCrm);try{return o.getAmountSaved(),void n(e)}catch(e){console.error(e)}}if(!(null===(t=e.active)||void 0===t?void 0:t.shouldUseIframePriceParsing))return e.active&&(e.active.isPageReloading=!0),setTimeout((function(){return n(e)}),S.COUPON_APPLICATION_PAGE_RELOAD_TIMEOUT_IN_MS),void window.location.reload();e.active&&(e.active.isPageReloading=!1);R(e),n(e)}(r,n),[2]):((0,S.executeDelayedCallback)(e.customDelayBetweenApplicationsInMs?e.customDelayBetweenApplicationsInMs:S.NETWORK_REQUESTS_POST_COUPON_APPLICATION_DELAY_IN_MS,i,(function(){return n(r)})),[3,6]));case 5:return function(e,n,t,r,a){if(t.active)return t.active.shouldUseNetworkRequestsApplication=!1,t.active.stateType=l.CouponAutomationActiveStateType.prepare,void r(t);if(t.done){return a.shouldUseNetworkRequestsApplication=!1,void r({active:o(o({},a),{stateType:l.CouponAutomationActiveStateType.prepare})})}n(a,e,!1)}(a.sent(),t,r,n,e),[3,6];case 6:return[2]}}))}))}(e,n,t);break;case l.CouponAutomationActiveStateType.checkValidity:!function(e,n,t){var i=this,s=function(){return r(i,void 0,void 0,(function(){var r,i,s;return a(this,(function(a){switch(a.label){case 0:return e.isPageReloading?[4,(0,S.sleepUntilNoPendingRequests)(e.shouldUseNetworkRequestsApplication?S.NETWORK_REQUESTS_POST_PAGE_RELOAD_CHECK_VALIDITY_DELAY_IN_MS:S.SELECTORS_POST_PAGE_RELOAD_CHECK_VALIDITY_DELAY_IN_MS)]:[3,2];case 1:a.sent(),a.label=2;case 2:if(r=o(o({},e),{webpageUrl:window.location.href,stateType:e.shouldUseNetworkRequestsApplication?l.CouponAutomationActiveStateType.send:l.CouponAutomationActiveStateType.prepare}),!e.couponCrm||!e.shouldUseNetworkRequestsApplication)return[3,3];try{return function(e){var n=e.activeState,t=e.nextActiveState,o=e.setState;if(!n.couponCrm)throw new Error("Missing coupon CRM");var r=(0,p.getCouponCrmDriver)(n.couponCrm),a=r.getAmountSaved().priceAmount;W({nextActiveState:t,previousActiveState:n,priceAmount:a}),F({nextActiveState:t,previousActiveState:n,setState:o,priceAmount:a})}({activeState:e,nextActiveState:r,setState:n}),[2]}catch(e){console.error(e)}return[3,9];case 3:if(!e.shouldUseNetworkRequestsApplication||!e.shouldUseIframePriceParsing)return[3,9];if(!e.responseParsingResult||"successful"!==e.responseParsingResult.result.type)return[3,8];(i=document.createElement("iframe")).style.display="none",document.documentElement.appendChild(i),a.label=4;case 4:return a.trys.push([4,6,,7]),[4,x(i,e,r,n)];case 5:return a.sent(),[2];case 6:return s=a.sent(),console.error(s),document.documentElement.contains(i)&&document.documentElement.removeChild(i),e.shouldUseNetworkRequestsApplication=!1,e.isPageReloading=!0,R({active:e}),window.location.reload(),[2];case 7:return[3,9];case 8:return F({nextActiveState:r,previousActiveState:e,setState:n,priceAmount:e.basePrice}),[2];case 9:return[4,B({activeState:e,nextActiveState:r,setState:n,onError:t})];case 10:return a.sent(),[2]}}))}))};(0,S.runCallbackOnPageFinishedLoading)(s,e.isPageReloading)}(e,n,t)}},n.saveState=R},50139:function(e,n,t){var o=this&&this.__values||function(e){var n="function"==typeof Symbol&&Symbol.iterator,t=n&&e[n],o=0;if(t)return t.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&o>=e.length&&(e=void 0),{value:e&&e[o++],done:!e}}};throw new TypeError(n?"Object is not iterable.":"Symbol.iterator is not defined.")},r=this&&this.__read||function(e,n){var t="function"==typeof Symbol&&e[Symbol.iterator];if(!t)return e;var o,r,a=t.call(e),i=[];try{for(;(void 0===n||n-- >0)&&!(o=a.next()).done;)i.push(o.value)}catch(e){r={error:e}}finally{try{o&&!o.done&&(t=a.return)&&t.call(a)}finally{if(r)throw r.error}}return i},a=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(n,"__esModule",{value:!0}),n.replaceFirstLeafFieldMatchingCriterionInObject=n.getLeafFieldValuesMatchingRegexesInObject=n.replaceArbitrarilyNestedFieldInObject=n.checkIsUuid=n.checkIsBase64Encoded=n.convertVariableNameToReadableText=n.standardizeText=n.BASE_COUPON_ELEMENTS_KEYWORDS=n.TEXT_HTML_TAGS=void 0;var i=a(t(2543));n.TEXT_HTML_TAGS=["span","div","dl","td","p","strong","section","dd","dt","em","del","b","h1","h2","h3","h4","h5","h6","i","title"],n.BASE_COUPON_ELEMENTS_KEYWORDS=["coupon","avantage","promo","discount","reduction","remise","rebate","voucher","code"],n.standardizeText=function(e){return i.default.deburr(e.toLowerCase().trim())},n.convertVariableNameToReadableText=function(e){return/^([A-Z_]+)$/.test(e)?e.toLowerCase().replace(/_/g," "):e.replace(/([A-Z])/g," $&").toLowerCase().replace(/(-|_)/g," ").replace(/\d/,"")},n.checkIsBase64Encoded=function(e){return/^[A-Za-z0-9+/\-_]{8,}={1,2}$/.test(e)},n.checkIsUuid=function(e){return/^[a-f\d]{8}(-[a-f\d]{4}){3}-[a-f\d]{12}$/i.test(e)},n.replaceArbitrarilyNestedFieldInObject=function e(n,t,r){var a,i;if(!n||"object"!=typeof n)return!1;if(t in n)return n[t]=r,!0;try{for(var s=o(Object.values(n)),u=s.next();!u.done;u=s.next()){var c=u.value;if("object"==typeof c&&e(c,t,r))return!0}}catch(e){a={error:e}}finally{try{u&&!u.done&&(i=s.return)&&i.call(s)}finally{if(a)throw a.error}}return!1},n.getLeafFieldValuesMatchingRegexesInObject=function e(n,t,a,i){var s,u;if(void 0===i&&(i=[]),!n||"object"!=typeof n)return i;var c=function(n,o){"object"==typeof o&&e(o,t,a,i),t.some((function(e){return e.test(n)}))&&!a.some((function(e){return e.test(n)}))&&i.push({fieldKey:n,fieldValue:o})};try{for(var l=o(Object.entries(n)),d=l.next();!d.done;d=l.next()){var p=r(d.value,2);c(p[0],p[1])}}catch(e){s={error:e}}finally{try{d&&!d.done&&(u=l.return)&&u.call(l)}finally{if(s)throw s.error}}return i},n.replaceFirstLeafFieldMatchingCriterionInObject=function e(n,t,a){var i,s;if(!n||"object"!=typeof n)return!1;try{for(var u=o(Object.entries(n)),c=u.next();!c.done;c=u.next()){var l=r(c.value,2),d=l[0],p=l[1];if("object"==typeof p&&e(p,t,a))return!0;if(t({key:d,value:p}))return n[d]=a,!0}}catch(e){i={error:e}}finally{try{c&&!c.done&&(s=u.return)&&s.call(u)}finally{if(i)throw i.error}}return!1}},9971:(e,n)=>{Object.defineProperty(n,"__esModule",{value:!0}),n.getAllCookieNames=n.getCookieValueByName=void 0,n.getCookieValueByName=function(e){var n=new RegExp("(^| )"+e+"=([^;]+)"),t=document.cookie.match(n);if(t)return t[2]},n.getAllCookieNames=function(){return document.cookie.split(";").map((function(e){return e.split("=")[0].trim()}))}},73703:function(e,n,t){var o=this&&this.__read||function(e,n){var t="function"==typeof Symbol&&e[Symbol.iterator];if(!t)return e;var o,r,a=t.call(e),i=[];try{for(;(void 0===n||n-- >0)&&!(o=a.next()).done;)i.push(o.value)}catch(e){r={error:e}}finally{try{o&&!o.done&&(t=a.return)&&t.call(a)}finally{if(r)throw r.error}}return i},r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(n,"__esModule",{value:!0}),n.useCouponApplicationWidgetInnerState=n.useCouponAutomationProposalWidgetInnerState=void 0;var a=r(t(96540)),i=t(55015),s=t(74137),u=t(26368),c=t(31229),l=t(13093),d=t(622),p=t(50479),f=t(23907),m=t(94700);n.useCouponAutomationProposalWidgetInnerState=function(e){var n=e.startCouponApplication,t=e.offerId,o=e.closeButtonDisplayedText,r=(0,m.useWidgetDisplay)(),u=r.isWidgetDisplayed,l=r.closeWidget,d=r.onWidgetInnerStateLoadEnd,y=(0,c.useIsTemporaryUser)(),_=a.default.useCallback((function(){(0,p.logClosedCouponWidgetEvents)(t,y,o),(0,f.setLastCouponAutomationResult)({type:f.CouponAutomationResultType.dismissed,timestampInMs:Date.now()}),l()}),[]),h=a.default.useCallback((function(){return n(l)}),[]);return a.default.useEffect((function(){var e=(0,s.withSentry)((function(e,n){var t;if("local"===n){var o=new URL(window.location.href).hostname,r="".concat(i.LocalStorageKey.couponAutomationStateKeyPrefix).concat(o);!e[r]||(null===(t=e[r].newValue.state)||void 0===t?void 0:t.passive)&&e[r].newValue.state.passive.stateType===i.CouponAutomationPassiveStateType.propose||l()}}));return chrome.storage.onChanged.addListener(e),function(){return chrome.storage.onChanged.removeListener(e)}}),[l]),a.default.useEffect(d,[]),{onClickStartButton:h,onClickWidgetCloseButton:_,isWidgetDisplayed:u}},n.useCouponApplicationWidgetInnerState=function(e,n){var t=(0,m.useWidgetDisplay)(),r=t.isWidgetDisplayed,s=t.closeWidget,y=t.onWidgetInnerStateLoadEnd,_=(0,c.useIsTemporaryUser)(),h=o(a.default.useState(!1),2),v=h[0],g=h[1],C=o(a.default.useState(n),2),b=C[0],S=C[1],T=o(a.default.useState(e),2),I=T[0],A=T[1],E=(0,i.useLocalizedTexts)().contentscript.couponAutomation.applicationWidget.progressContent.exitConfirmationContent,w=a.default.useCallback((function(){if(!I.active||I.active.isFinal||I.active.isPageReloading||b||window.confirm(E)){var e=I.passive?I.passive.offerId:I.active?I.active.offerId:I.done?I.done.offerId:void 0;(0,p.logClosedCouponWidgetEvents)(e,_),function(e,n,t,o,r){!e.active||n||e.active.isFinal||((0,p.logCancelledCouponApplicationEvents)(e),t(!0),(0,f.setLastCouponAutomationResult)({type:f.CouponAutomationResultType.cancelled,timestampInMs:Date.now()}));setTimeout((function(){o({}),r({})}),1e3*u.OPEN_AND_CLOSE_ANIMATIONS_DURATION_IN_SECONDS)}(I,b,g,A,l.saveState),s()}}),[I,b,_]),O=a.default.useCallback((function(e,n,t){return function(e,n,t,o,r){if(function(e){if(!e)return!1;var n=(0,d.getPriceAmountAndCurrency)(e).priceAmount;if(!n)return!1;if(n<e.basePrice&&(!e.bestPrice||n<=e.bestPrice))return e.bestPrice=n,e.bestCoupon||(e.bestCoupon=e.coupons[e.couponIndex]),!0;return!1}(e)){var a={done:e};r(a),(0,l.saveState)(a),(0,p.logCouponApplicationSucceededEvents)(e,!1,t?e.coupons.length:e.couponIndex),(0,f.setLastCouponAutomationResult)({type:f.CouponAutomationResultType.completed,timestampInMs:Date.now()})}else{var i=void 0;n instanceof Error&&(i=n.message),o(!0),(0,p.logCouponApplicationFailedEvents)(e,!0,i,t?e.coupons.length:e.couponIndex),(0,f.setLastCouponAutomationResult)({type:f.CouponAutomationResultType.crashed,timestampInMs:Date.now()})}}(e,n,t,S,A)}),[]);return a.default.useEffect((function(){void 0!==I.active&&(v||(0,l.handleActiveState)(I.active,A,O))}),[I]),a.default.useEffect(y,[]),{isWidgetDisplayed:r,state:I,hasError:b,stopAutomationAndCloseWidget:w,closeWidget:s}}},95537:function(e,n,t){var o=this&&this.__awaiter||function(e,n,t,o){return new(t||(t=Promise))((function(r,a){function i(e){try{u(o.next(e))}catch(e){a(e)}}function s(e){try{u(o.throw(e))}catch(e){a(e)}}function u(e){var n;e.done?r(e.value):(n=e.value,n instanceof t?n:new t((function(e){e(n)}))).then(i,s)}u((o=o.apply(e,n||[])).next())}))},r=this&&this.__generator||function(e,n){var t,o,r,a,i={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return a={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function s(s){return function(u){return function(s){if(t)throw new TypeError("Generator is already executing.");for(;a&&(a=0,s[0]&&(i=0)),i;)try{if(t=1,o&&(r=2&s[0]?o.return:s[0]?o.throw||((r=o.return)&&r.call(o),0):o.next)&&!(r=r.call(o,s[1])).done)return r;switch(o=0,r&&(s=[2&s[0],r.value]),s[0]){case 0:case 1:r=s;break;case 4:return i.label++,{value:s[1],done:!1};case 5:i.label++,o=s[1],s=[0];continue;case 7:s=i.ops.pop(),i.trys.pop();continue;default:if(!(r=i.trys,(r=r.length>0&&r[r.length-1])||6!==s[0]&&2!==s[0])){i=0;continue}if(3===s[0]&&(!r||s[1]>r[0]&&s[1]<r[3])){i.label=s[1];break}if(6===s[0]&&i.label<r[1]){i.label=r[1],r=s;break}if(r&&i.label<r[2]){i.label=r[2],i.ops.push(s);break}r[2]&&i.ops.pop(),i.trys.pop();continue}s=n.call(e,i)}catch(e){s=[6,e],o=0}finally{t=r=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,u])}}};Object.defineProperty(n,"__esModule",{value:!0}),n.getCouponCrmDriver=n.detectCouponCrmDriverForCurrentWebsite=void 0;var a=t(55015),i=t(28722),s=t(21472),u=t(89342),c=t(49557),l=t(69375),d=t(60778),p=t(59102);n.detectCouponCrmDriverForCurrentWebsite=function(){return o(this,void 0,void 0,(function(){var e,n,t=this;return r(this,(function(a){switch(a.label){case 0:return e=[new i.DemandwareDriver,new s.ShopifyDriver,new u.WooCommerceDriver,new c.PrestaShopDriver,new l.BigCommerceDriver,new d.OpenCartDriver,new p.WixDriver],[4,Promise.all(e.map((function(e){return o(t,void 0,void 0,(function(){var n;return r(this,(function(t){switch(t.label){case 0:return n={couponDriver:e},[4,e.checkShouldUseDriver()];case 1:return[2,(n.shouldUseDriver=t.sent(),n)]}}))}))})))];case 1:return 1===(n=a.sent().filter((function(e){return e.shouldUseDriver})).map((function(e){return e.couponDriver}))).length?(f.crmDriver=n[0],[2,n[0]]):[2,void 0]}}))}))};var f={crmDriver:void 0};n.getCouponCrmDriver=function(e){if(f.crmDriver&&f.crmDriver.couponCrm===e)return f.crmDriver;switch(e){case a.CouponCrm.demandware:f.crmDriver=new i.DemandwareDriver;break;case a.CouponCrm.shopify:f.crmDriver=new s.ShopifyDriver;break;case a.CouponCrm.wooCommerce:f.crmDriver=new u.WooCommerceDriver;break;case a.CouponCrm.prestaShop:f.crmDriver=new c.PrestaShopDriver;break;case a.CouponCrm.bigCommerce:f.crmDriver=new l.BigCommerceDriver;break;case a.CouponCrm.openCart:f.crmDriver=new d.OpenCartDriver;break;case a.CouponCrm.wix:f.crmDriver=new p.WixDriver}return f.crmDriver}},33757:(e,n)=>{Object.defineProperty(n,"__esModule",{value:!0}),n.BaseCouponCrmDriver=void 0;var t=function(){function e(e,n){this.couponCrm=e,this.expectedContentType=n,this.responseBody=void 0}return e.prototype.checkIsValidContentType=function(e){if(this.expectedContentType){var n=e.headers.get("content-type")||void 0;if(!n||!n.includes(this.expectedContentType))throw new Error("Unexpected response content type")}},e}();n.BaseCouponCrmDriver=t},69375:function(e,n,t){var o,r=this&&this.__extends||(o=function(e,n){return o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,n){e.__proto__=n}||function(e,n){for(var t in n)Object.prototype.hasOwnProperty.call(n,t)&&(e[t]=n[t])},o(e,n)},function(e,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function t(){this.constructor=e}o(e,n),e.prototype=null===n?Object.create(n):(t.prototype=n.prototype,new t)}),a=this&&this.__awaiter||function(e,n,t,o){return new(t||(t=Promise))((function(r,a){function i(e){try{u(o.next(e))}catch(e){a(e)}}function s(e){try{u(o.throw(e))}catch(e){a(e)}}function u(e){var n;e.done?r(e.value):(n=e.value,n instanceof t?n:new t((function(e){e(n)}))).then(i,s)}u((o=o.apply(e,n||[])).next())}))},i=this&&this.__generator||function(e,n){var t,o,r,a,i={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return a={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function s(s){return function(u){return function(s){if(t)throw new TypeError("Generator is already executing.");for(;a&&(a=0,s[0]&&(i=0)),i;)try{if(t=1,o&&(r=2&s[0]?o.return:s[0]?o.throw||((r=o.return)&&r.call(o),0):o.next)&&!(r=r.call(o,s[1])).done)return r;switch(o=0,r&&(s=[2&s[0],r.value]),s[0]){case 0:case 1:r=s;break;case 4:return i.label++,{value:s[1],done:!1};case 5:i.label++,o=s[1],s=[0];continue;case 7:s=i.ops.pop(),i.trys.pop();continue;default:if(!(r=i.trys,(r=r.length>0&&r[r.length-1])||6!==s[0]&&2!==s[0])){i=0;continue}if(3===s[0]&&(!r||s[1]>r[0]&&s[1]<r[3])){i.label=s[1];break}if(6===s[0]&&i.label<r[1]){i.label=r[1],r=s;break}if(r&&i.label<r[2]){i.label=r[2],i.ops.push(s);break}r[2]&&i.ops.pop(),i.trys.pop();continue}s=n.call(e,i)}catch(e){s=[6,e],o=0}finally{t=r=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,u])}}};Object.defineProperty(n,"__esModule",{value:!0}),n.BigCommerceDriver=void 0;var s=t(55015),u=function(e){function n(){return e.call(this,s.CouponCrm.bigCommerce,"application/json")||this}return r(n,e),n.prototype.checkShouldUseDriver=function(){return!!document.querySelector('meta[content*="bigcommerce"]')},n.prototype.checkIsCouponApplicationSuccessful=function(e){return a(this,void 0,void 0,(function(){var n;return i(this,(function(t){switch(t.label){case 0:return this.checkIsValidContentType(e),n=this,[4,e.json()];case 1:if(n.responseBody=t.sent(),!this.responseBody.data&&!this.responseBody.data.hasOwnProperty("status"))throw new Error("Unexpected response structure");return[2,"success"===this.responseBody.data.status]}}))}))},n.prototype.applyCoupon=function(){return a(this,void 0,void 0,(function(){return i(this,(function(e){throw new Error("Not implemented")}))}))},n.prototype.getAmountSaved=function(){throw new Error("Not implemented")},n}(t(33757).BaseCouponCrmDriver);n.BigCommerceDriver=u},28722:function(e,n,t){var o,r=this&&this.__extends||(o=function(e,n){return o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,n){e.__proto__=n}||function(e,n){for(var t in n)Object.prototype.hasOwnProperty.call(n,t)&&(e[t]=n[t])},o(e,n)},function(e,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function t(){this.constructor=e}o(e,n),e.prototype=null===n?Object.create(n):(t.prototype=n.prototype,new t)}),a=this&&this.__awaiter||function(e,n,t,o){return new(t||(t=Promise))((function(r,a){function i(e){try{u(o.next(e))}catch(e){a(e)}}function s(e){try{u(o.throw(e))}catch(e){a(e)}}function u(e){var n;e.done?r(e.value):(n=e.value,n instanceof t?n:new t((function(e){e(n)}))).then(i,s)}u((o=o.apply(e,n||[])).next())}))},i=this&&this.__generator||function(e,n){var t,o,r,a,i={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return a={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function s(s){return function(u){return function(s){if(t)throw new TypeError("Generator is already executing.");for(;a&&(a=0,s[0]&&(i=0)),i;)try{if(t=1,o&&(r=2&s[0]?o.return:s[0]?o.throw||((r=o.return)&&r.call(o),0):o.next)&&!(r=r.call(o,s[1])).done)return r;switch(o=0,r&&(s=[2&s[0],r.value]),s[0]){case 0:case 1:r=s;break;case 4:return i.label++,{value:s[1],done:!1};case 5:i.label++,o=s[1],s=[0];continue;case 7:s=i.ops.pop(),i.trys.pop();continue;default:if(!(r=i.trys,(r=r.length>0&&r[r.length-1])||6!==s[0]&&2!==s[0])){i=0;continue}if(3===s[0]&&(!r||s[1]>r[0]&&s[1]<r[3])){i.label=s[1];break}if(6===s[0]&&i.label<r[1]){i.label=r[1],r=s;break}if(r&&i.label<r[2]){i.label=r[2],i.ops.push(s);break}r[2]&&i.ops.pop(),i.trys.pop();continue}s=n.call(e,i)}catch(e){s=[6,e],o=0}finally{t=r=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,u])}}};Object.defineProperty(n,"__esModule",{value:!0}),n.DemandwareDriver=void 0;var s=t(55015),u=function(e){function n(){return e.call(this,s.CouponCrm.demandware,"application/json")||this}return r(n,e),n.prototype.checkShouldUseDriver=function(){return!!document.querySelector('form[action*="/on/demandware.store/"][action$="Cart-AddCoupon"], script[src*="demandware.static"], img[src*="demandware.static"]')},n.prototype.checkIsCouponApplicationSuccessful=function(e){return a(this,void 0,void 0,(function(){var n;return i(this,(function(t){switch(t.label){case 0:return this.checkIsValidContentType(e),n=this,[4,e.json()];case 1:if(n.responseBody=t.sent(),this.responseBody.hasOwnProperty("ok"))return[2,this.responseBody.ok];if(this.responseBody.hasOwnProperty("error"))return[2,!this.responseBody.error];throw new Error("Unexpected response structure")}}))}))},n.prototype.applyCoupon=function(){return a(this,void 0,void 0,(function(){return i(this,(function(e){throw new Error("Not implemented")}))}))},n.prototype.getAmountSaved=function(){throw new Error("Not implemented")},n}(t(33757).BaseCouponCrmDriver);n.DemandwareDriver=u},60778:function(e,n,t){var o,r=this&&this.__extends||(o=function(e,n){return o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,n){e.__proto__=n}||function(e,n){for(var t in n)Object.prototype.hasOwnProperty.call(n,t)&&(e[t]=n[t])},o(e,n)},function(e,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function t(){this.constructor=e}o(e,n),e.prototype=null===n?Object.create(n):(t.prototype=n.prototype,new t)}),a=this&&this.__awaiter||function(e,n,t,o){return new(t||(t=Promise))((function(r,a){function i(e){try{u(o.next(e))}catch(e){a(e)}}function s(e){try{u(o.throw(e))}catch(e){a(e)}}function u(e){var n;e.done?r(e.value):(n=e.value,n instanceof t?n:new t((function(e){e(n)}))).then(i,s)}u((o=o.apply(e,n||[])).next())}))},i=this&&this.__generator||function(e,n){var t,o,r,a,i={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return a={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function s(s){return function(u){return function(s){if(t)throw new TypeError("Generator is already executing.");for(;a&&(a=0,s[0]&&(i=0)),i;)try{if(t=1,o&&(r=2&s[0]?o.return:s[0]?o.throw||((r=o.return)&&r.call(o),0):o.next)&&!(r=r.call(o,s[1])).done)return r;switch(o=0,r&&(s=[2&s[0],r.value]),s[0]){case 0:case 1:r=s;break;case 4:return i.label++,{value:s[1],done:!1};case 5:i.label++,o=s[1],s=[0];continue;case 7:s=i.ops.pop(),i.trys.pop();continue;default:if(!(r=i.trys,(r=r.length>0&&r[r.length-1])||6!==s[0]&&2!==s[0])){i=0;continue}if(3===s[0]&&(!r||s[1]>r[0]&&s[1]<r[3])){i.label=s[1];break}if(6===s[0]&&i.label<r[1]){i.label=r[1],r=s;break}if(r&&i.label<r[2]){i.label=r[2],i.ops.push(s);break}r[2]&&i.ops.pop(),i.trys.pop();continue}s=n.call(e,i)}catch(e){s=[6,e],o=0}finally{t=r=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,u])}}};Object.defineProperty(n,"__esModule",{value:!0}),n.OpenCartDriver=n.OPEN_CART_JAVASCRIPT_BROADCAST_CHANNEL_NAME=void 0;var s=t(55015),u=t(33757),c=t(98356);n.OPEN_CART_JAVASCRIPT_BROADCAST_CHANNEL_NAME="jokoAreOpenCartJavascriptVariablesDefinedChannel";var l=function(e){function t(){return e.call(this,s.CouponCrm.openCart)||this}return r(t,e),t.prototype.checkShouldUseDriver=function(){return a(this,void 0,void 0,(function(){return i(this,(function(e){switch(e.label){case 0:return document.querySelector('a[href*="index.php?route=checkout"], form[action*="index.php?route=checkout/cart"]')?[2,!0]:[4,this.refreshDoOpenCartJavascriptVariablesExist()];case 1:return e.sent(),[2,!!this.doOpenCartJavascriptVariablesExist]}}))}))},t.prototype.refreshDoOpenCartJavascriptVariablesExist=function(){return a(this,void 0,void 0,(function(){var e,t=this;return i(this,(function(o){return e=new BroadcastChannel(n.OPEN_CART_JAVASCRIPT_BROADCAST_CHANNEL_NAME),(0,c.injectScriptAndReplaceExistingOne)(c.InjectedScriptElement.checkOpenCartJavascriptVariablesExist),[2,Promise.race([new Promise((function(n){e.onmessage=function(o){e.close(),t.doOpenCartJavascriptVariablesExist=!!o.data,n()}})),new Promise((function(n){setTimeout((function(){e.close(),n()}),200)}))])]}))}))},t.prototype.checkIsCouponApplicationSuccessful=function(e){return a(this,void 0,void 0,(function(){var n;return i(this,(function(t){switch(t.label){case 0:return n=this,[4,e.text()];case 1:return n.responseBody=t.sent(),[2,!/invalid||error/i.test(this.responseBody)]}}))}))},t.prototype.applyCoupon=function(){return a(this,void 0,void 0,(function(){return i(this,(function(e){throw new Error("Not implemented")}))}))},t.prototype.getAmountSaved=function(){throw new Error("Not implemented")},t}(u.BaseCouponCrmDriver);n.OpenCartDriver=l},49557:function(e,n,t){var o,r=this&&this.__extends||(o=function(e,n){return o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,n){e.__proto__=n}||function(e,n){for(var t in n)Object.prototype.hasOwnProperty.call(n,t)&&(e[t]=n[t])},o(e,n)},function(e,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function t(){this.constructor=e}o(e,n),e.prototype=null===n?Object.create(n):(t.prototype=n.prototype,new t)}),a=this&&this.__awaiter||function(e,n,t,o){return new(t||(t=Promise))((function(r,a){function i(e){try{u(o.next(e))}catch(e){a(e)}}function s(e){try{u(o.throw(e))}catch(e){a(e)}}function u(e){var n;e.done?r(e.value):(n=e.value,n instanceof t?n:new t((function(e){e(n)}))).then(i,s)}u((o=o.apply(e,n||[])).next())}))},i=this&&this.__generator||function(e,n){var t,o,r,a,i={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return a={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function s(s){return function(u){return function(s){if(t)throw new TypeError("Generator is already executing.");for(;a&&(a=0,s[0]&&(i=0)),i;)try{if(t=1,o&&(r=2&s[0]?o.return:s[0]?o.throw||((r=o.return)&&r.call(o),0):o.next)&&!(r=r.call(o,s[1])).done)return r;switch(o=0,r&&(s=[2&s[0],r.value]),s[0]){case 0:case 1:r=s;break;case 4:return i.label++,{value:s[1],done:!1};case 5:i.label++,o=s[1],s=[0];continue;case 7:s=i.ops.pop(),i.trys.pop();continue;default:if(!(r=i.trys,(r=r.length>0&&r[r.length-1])||6!==s[0]&&2!==s[0])){i=0;continue}if(3===s[0]&&(!r||s[1]>r[0]&&s[1]<r[3])){i.label=s[1];break}if(6===s[0]&&i.label<r[1]){i.label=r[1],r=s;break}if(r&&i.label<r[2]){i.label=r[2],i.ops.push(s);break}r[2]&&i.ops.pop(),i.trys.pop();continue}s=n.call(e,i)}catch(e){s=[6,e],o=0}finally{t=r=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,u])}}};Object.defineProperty(n,"__esModule",{value:!0}),n.PrestaShopDriver=n.PRESTASHOP_JAVASCRIPT_OBJECT_BROADCAST_CHANNEL_NAME=void 0;var s=t(55015),u=t(33757),c=t(98356);n.PRESTASHOP_JAVASCRIPT_OBJECT_BROADCAST_CHANNEL_NAME="jokoPrestaShopJavascriptObjectChannel";var l=function(e){function t(){return e.call(this,s.CouponCrm.prestaShop,"application/json")||this}return r(t,e),t.prototype.checkShouldUseDriver=function(){return a(this,void 0,void 0,(function(){return i(this,(function(e){switch(e.label){case 0:return[4,this.refreshPrestashopJavascriptObject()];case 1:return e.sent(),[2,!!this.prestaShopJavascriptObject]}}))}))},t.prototype.refreshPrestashopJavascriptObject=function(){return a(this,void 0,void 0,(function(){var e,t=this;return i(this,(function(o){return e=new BroadcastChannel(n.PRESTASHOP_JAVASCRIPT_OBJECT_BROADCAST_CHANNEL_NAME),(0,c.injectScriptAndReplaceExistingOne)(c.InjectedScriptElement.capturePrestashopJavascriptObject),[2,Promise.race([new Promise((function(n){e.onmessage=function(o){e.close(),t.prestaShopJavascriptObject=o.data,n()}})),new Promise((function(n){setTimeout((function(){e.close(),n()}),200)}))])]}))}))},t.prototype.checkIsCouponApplicationSuccessful=function(e){return a(this,void 0,void 0,(function(){var n;return i(this,(function(t){switch(t.label){case 0:return this.checkIsValidContentType(e),n=this,[4,e.json()];case 1:if(n.responseBody=t.sent(),!this.responseBody.hasOwnProperty("success"))throw new Error("Unexpected response structure");return[2,this.responseBody.success]}}))}))},t.prototype.applyCoupon=function(){return a(this,void 0,void 0,(function(){return i(this,(function(e){throw new Error("Not implemented")}))}))},t.prototype.getAmountSaved=function(){throw new Error("Not implemented")},t}(u.BaseCouponCrmDriver);n.PrestaShopDriver=l},21472:function(e,n,t){var o,r=this&&this.__extends||(o=function(e,n){return o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,n){e.__proto__=n}||function(e,n){for(var t in n)Object.prototype.hasOwnProperty.call(n,t)&&(e[t]=n[t])},o(e,n)},function(e,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function t(){this.constructor=e}o(e,n),e.prototype=null===n?Object.create(n):(t.prototype=n.prototype,new t)}),a=this&&this.__awaiter||function(e,n,t,o){return new(t||(t=Promise))((function(r,a){function i(e){try{u(o.next(e))}catch(e){a(e)}}function s(e){try{u(o.throw(e))}catch(e){a(e)}}function u(e){var n;e.done?r(e.value):(n=e.value,n instanceof t?n:new t((function(e){e(n)}))).then(i,s)}u((o=o.apply(e,n||[])).next())}))},i=this&&this.__generator||function(e,n){var t,o,r,a,i={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return a={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function s(s){return function(u){return function(s){if(t)throw new TypeError("Generator is already executing.");for(;a&&(a=0,s[0]&&(i=0)),i;)try{if(t=1,o&&(r=2&s[0]?o.return:s[0]?o.throw||((r=o.return)&&r.call(o),0):o.next)&&!(r=r.call(o,s[1])).done)return r;switch(o=0,r&&(s=[2&s[0],r.value]),s[0]){case 0:case 1:r=s;break;case 4:return i.label++,{value:s[1],done:!1};case 5:i.label++,o=s[1],s=[0];continue;case 7:s=i.ops.pop(),i.trys.pop();continue;default:if(!(r=i.trys,(r=r.length>0&&r[r.length-1])||6!==s[0]&&2!==s[0])){i=0;continue}if(3===s[0]&&(!r||s[1]>r[0]&&s[1]<r[3])){i.label=s[1];break}if(6===s[0]&&i.label<r[1]){i.label=r[1],r=s;break}if(r&&i.label<r[2]){i.label=r[2],i.ops.push(s);break}r[2]&&i.ops.pop(),i.trys.pop();continue}s=n.call(e,i)}catch(e){s=[6,e],o=0}finally{t=r=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,u])}}},s=this&&this.__read||function(e,n){var t="function"==typeof Symbol&&e[Symbol.iterator];if(!t)return e;var o,r,a=t.call(e),i=[];try{for(;(void 0===n||n-- >0)&&!(o=a.next()).done;)i.push(o.value)}catch(e){r={error:e}}finally{try{o&&!o.done&&(t=a.return)&&t.call(a)}finally{if(r)throw r.error}}return i};Object.defineProperty(n,"__esModule",{value:!0}),n.ShopifyDriver=void 0;var u=t(55015),c=t(9971),l=t(33757),d=t(76070),p=["REDUCTION_INVALID_DISCOUNT_CODE","REDUCTION_INVALID_CODE"],f=function(e){function n(){var n=e.call(this,u.CouponCrm.shopify,"application/json")||this;return n.shopifyTokens=n.getInitialShopifyTokens(),n.graphqlApiEndpointUrl="https://".concat(new URL(window.location.href).hostname,"/checkouts/unstable/graphql"),n}return r(n,e),n.prototype.getInitialShopifyTokens=function(){var e=s(n.SHOPIFY_TOKENS_META_TAG_SELECTORS.map((function(e){return document.querySelector(e)})).map((function(e){return e?e.getAttribute("content"):null})).map((function(e){return e?e.substring(1,e.length-1):null})),2),t=e[0],o=e[1],r=(0,c.getCookieValueByName)("queue_token");if(t&&o&&r)return{sessionToken:t,sourceToken:o,queueToken:r}},n.prototype.checkShouldUseDriver=function(){return!!document.querySelector('script[src*="cdn.shopify.com"]')},n.prototype.checkIsCouponApplicationSuccessful=function(e){return a(this,void 0,void 0,(function(){var n,t;return i(this,(function(o){switch(o.label){case 0:return n=this,[4,e.json()];case 1:if(n.responseBody=o.sent(),!(this.responseBody&&this.responseBody.data&&this.responseBody.data.session&&this.responseBody.data.session.negotiate))throw new Error("Unexpected response structure");return this.responseBody.data.session.negotiate.hasOwnProperty("errors")?(t=new Set(this.responseBody.data.session.negotiate.errors.map((function(e){return e.code}))),[2,!p.some((function(e){return t.has(e)}))]):[2,!0]}}))}))},n.prototype.applyCoupon=function(e){return a(this,void 0,void 0,(function(){var n;return i(this,(function(t){if(!this.shopifyTokens)throw new Error("Shopify tokens not found");return n={sessionInput:{sessionToken:this.shopifyTokens.sessionToken},reduction:{code:e}},[2,fetch(this.graphqlApiEndpointUrl,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({query:d.shopifyProposalQuery,variables:n})})]}))}))},n.prototype.getAmountSaved=function(){throw new Error("Not implemented")},n.SHOPIFY_TOKENS_META_TAG_SELECTORS=['meta[name="serialized-session-token"]','meta[name="serialized-source-token"]'],n}(l.BaseCouponCrmDriver);n.ShopifyDriver=f},76070:(e,n)=>{Object.defineProperty(n,"__esModule",{value:!0}),n.shopifyProposalQuery=void 0,n.shopifyProposalQuery="\n    query Proposal(\n        $alternativePaymentCurrency: AlternativePaymentCurrencyInput\n        $delivery: DeliveryTermsInput\n        $discounts: DiscountTermsInput\n        $payment: PaymentTermInput\n        $merchandise: MerchandiseTermInput\n        $buyerIdentity: BuyerIdentityTermInput\n        $taxes: TaxTermInput\n        $sessionInput: SessionTokenInput!\n        $checkpointData: String\n        $queueToken: String\n        $reduction: ReductionInput\n        $availableRedeemables: AvailableRedeemablesInput\n        $changesetTokens: [String!]\n        $tip: TipTermInput\n        $note: NoteInput\n        $localizationExtension: LocalizationExtensionInput\n        $nonNegotiableTerms: NonNegotiableTermsInput\n        $scriptFingerprint: ScriptFingerprintInput\n        $transformerFingerprintV2: String\n        $optionalDuties: OptionalDutiesInput\n        $attribution: AttributionInput\n        $captcha: CaptchaInput\n        $poNumber: String\n        $saleAttributions: SaleAttributionsInput\n    ) {\n        session(sessionInput: $sessionInput) {\n            negotiate(\n                input: {\n                    purchaseProposal: {\n                        alternativePaymentCurrency: $alternativePaymentCurrency\n                        delivery: $delivery\n                        discounts: $discounts\n                        payment: $payment\n                        merchandise: $merchandise\n                        buyerIdentity: $buyerIdentity\n                        taxes: $taxes\n                        reduction: $reduction\n                        availableRedeemables: $availableRedeemables\n                        tip: $tip\n                        note: $note\n                        poNumber: $poNumber\n                        nonNegotiableTerms: $nonNegotiableTerms\n                        localizationExtension: $localizationExtension\n                        scriptFingerprint: $scriptFingerprint\n                        transformerFingerprintV2: $transformerFingerprintV2\n                        optionalDuties: $optionalDuties\n                        attribution: $attribution\n                        captcha: $captcha\n                        saleAttributions: $saleAttributions\n                    }\n                    checkpointData: $checkpointData\n                    queueToken: $queueToken\n                    changesetTokens: $changesetTokens\n                }\n            ) {\n                __typename\n                result {\n                    ... on NegotiationResultAvailable {\n                        queueToken\n                        buyerProposal {\n                            ...BuyerProposalDetails\n                            __typename\n                        }\n                        sellerProposal {\n                            ...ProposalDetails\n                            __typename\n                        }\n                        __typename\n                    }\n                    ... on CheckpointDenied {\n                        redirectUrl\n                        __typename\n                    }\n                    ... on Throttled {\n                        pollAfter\n                        queueToken\n                        pollUrl\n                        __typename\n                    }\n                    ... on SubmittedForCompletion {\n                        receipt {\n                            ...ReceiptDetails\n                            __typename\n                        }\n                        __typename\n                    }\n                    ... on NegotiationResultFailed {\n                        __typename\n                    }\n                    __typename\n                }\n                errors {\n                    code\n                    localizedMessage\n                    nonLocalizedMessage\n                    localizedMessageHtml\n                    ... on RemoveTermViolation {\n                        target\n                        __typename\n                    }\n                    ... on AcceptNewTermViolation {\n                        target\n                        __typename\n                    }\n                    ... on ConfirmChangeViolation {\n                        from\n                        to\n                        __typename\n                    }\n                    ... on UnprocessableTermViolation {\n                        target\n                        __typename\n                    }\n                    ... on UnresolvableTermViolation {\n                        target\n                        __typename\n                    }\n                    ... on GenericError {\n                        __typename\n                    }\n                    __typename\n                }\n            }\n            __typename\n        }\n    }\n    fragment BuyerProposalDetails on Proposal {\n        merchandiseDiscount {\n            ...ProposalDiscountFragment\n            __typename\n        }\n        deliveryDiscount {\n            ...ProposalDiscountFragment\n            __typename\n        }\n        delivery {\n            ...ProposalDeliveryFragment\n            __typename\n        }\n        merchandise {\n            ... on FilledMerchandiseTerms {\n                taxesIncluded\n                merchandiseLines {\n                    stableId\n                    merchandise {\n                        ...SourceProvidedMerchandise\n                        ...ProductVariantMerchandiseDetails\n                        ...ContextualizedProductVariantMerchandiseDetails\n                        ... on MissingProductVariantMerchandise {\n                            id\n                            digest\n                            variantId\n                            __typename\n                        }\n                        __typename\n                    }\n                    quantity {\n                        ... on ProposalMerchandiseQuantityByItem {\n                            items {\n                                ... on IntValueConstraint {\n                                    value\n                                    __typename\n                                }\n                                __typename\n                            }\n                            __typename\n                        }\n                        __typename\n                    }\n                    totalAmount {\n                        ... on MoneyValueConstraint {\n                            value {\n                                amount\n                                currencyCode\n                                __typename\n                            }\n                            __typename\n                        }\n                        __typename\n                    }\n                    recurringTotal {\n                        title\n                        interval\n                        intervalCount\n                        recurringPrice {\n                            amount\n                            currencyCode\n                            __typename\n                        }\n                        fixedPrice {\n                            amount\n                            currencyCode\n                            __typename\n                        }\n                        fixedPriceCount\n                        __typename\n                    }\n                    lineAllocations {\n                        ...LineAllocationDetails\n                        __typename\n                    }\n                    lineComponentsSource\n                    lineComponents {\n                        ...MerchandiseBundleLineComponent\n                        __typename\n                    }\n                    __typename\n                }\n                __typename\n            }\n            __typename\n        }\n        runningTotal {\n            ... on MoneyValueConstraint {\n                value {\n                    amount\n                    currencyCode\n                    __typename\n                }\n                __typename\n            }\n            __typename\n        }\n        total {\n            ... on MoneyValueConstraint {\n                value {\n                    amount\n                    currencyCode\n                    __typename\n                }\n                __typename\n            }\n            __typename\n        }\n        checkoutTotalBeforeTaxesAndShipping {\n            ... on MoneyValueConstraint {\n                value {\n                    amount\n                    currencyCode\n                    __typename\n                }\n                __typename\n            }\n            __typename\n        }\n        checkoutTotalTaxes {\n            ... on MoneyValueConstraint {\n                value {\n                    amount\n                    currencyCode\n                    __typename\n                }\n                __typename\n            }\n            __typename\n        }\n        checkoutTotal {\n            ... on MoneyValueConstraint {\n                value {\n                    amount\n                    currencyCode\n                    __typename\n                }\n                __typename\n            }\n            __typename\n        }\n        deferredTotal {\n            amount {\n                ... on MoneyValueConstraint {\n                    value {\n                        amount\n                        currencyCode\n                        __typename\n                    }\n                    __typename\n                }\n                __typename\n            }\n            subtotalAmount {\n                ... on MoneyValueConstraint {\n                    value {\n                        amount\n                        currencyCode\n                        __typename\n                    }\n                    __typename\n                }\n                __typename\n            }\n            taxes {\n                ... on MoneyValueConstraint {\n                    value {\n                        amount\n                        currencyCode\n                        __typename\n                    }\n                    __typename\n                }\n                __typename\n            }\n            dueAt\n            __typename\n        }\n        hasOnlyDeferredShipping\n        subtotalBeforeTaxesAndShipping {\n            ... on MoneyValueConstraint {\n                value {\n                    amount\n                    currencyCode\n                    __typename\n                }\n                __typename\n            }\n            __typename\n        }\n        attribution {\n            attributions {\n                ... on AttributionItem {\n                    ... on RetailAttributions {\n                        deviceId\n                        locationId\n                        userId\n                        __typename\n                    }\n                    ... on DraftOrderAttributions {\n                        userIdentifier: userId\n                        sourceName\n                        locationIdentifier: locationId\n                        __typename\n                    }\n                    __typename\n                }\n                __typename\n            }\n            __typename\n        }\n        saleAttributions {\n            attributions {\n                ... on SaleAttribution {\n                    recipient {\n                        ... on StaffMember {\n                            id\n                            __typename\n                        }\n                        ... on Location {\n                            id\n                            __typename\n                        }\n                        ... on PointOfSaleDevice {\n                            id\n                            __typename\n                        }\n                        __typename\n                    }\n                    targetMerchandiseLines {\n                        ...FilledMerchandiseLineTargetCollectionFragment\n                        ... on AnyMerchandiseLineTargetCollection {\n                            any\n                            __typename\n                        }\n                        __typename\n                    }\n                    __typename\n                }\n                __typename\n            }\n            __typename\n        }\n        __typename\n    }\n    fragment ProposalDiscountFragment on DiscountTermsV2 {\n        __typename\n        ... on FilledDiscountTerms {\n            acceptUnexpectedDiscounts\n            lines {\n                ...DiscountLineDetailsFragment\n                __typename\n            }\n            __typename\n        }\n        ... on PendingTerms {\n            pollDelay\n            taskId\n            __typename\n        }\n        ... on UnavailableTerms {\n            __typename\n        }\n    }\n    fragment DiscountLineDetailsFragment on DiscountLine {\n        allocations {\n            ... on DiscountAllocatedAllocationSet {\n                __typename\n                allocations {\n                    amount {\n                        ... on MoneyValueConstraint {\n                            value {\n                                amount\n                                currencyCode\n                                __typename\n                            }\n                            __typename\n                        }\n                        __typename\n                    }\n                    target {\n                        index\n                        targetType\n                        stableId\n                        __typename\n                    }\n                    __typename\n                }\n            }\n            __typename\n        }\n        discount {\n            ...DiscountDetailsFragment\n            __typename\n        }\n        lineAmount {\n            ... on MoneyValueConstraint {\n                value {\n                    amount\n                    currencyCode\n                    __typename\n                }\n                __typename\n            }\n            __typename\n        }\n        __typename\n    }\n    fragment DiscountDetailsFragment on Discount {\n        ... on CustomDiscount {\n            title\n            presentationLevel\n            allocationMethod\n            targetSelection\n            targetType\n            signature\n            signatureUuid\n            type\n            value {\n                ... on PercentageValue {\n                    percentage\n                    __typename\n                }\n                ... on FixedAmountValue {\n                    appliesOnEachItem\n                    fixedAmount {\n                        ... on MoneyValueConstraint {\n                            value {\n                                amount\n                                currencyCode\n                                __typename\n                            }\n                            __typename\n                        }\n                        __typename\n                    }\n                    __typename\n                }\n                __typename\n            }\n            __typename\n        }\n        ... on CodeDiscount {\n            title\n            code\n            presentationLevel\n            allocationMethod\n            targetSelection\n            targetType\n            value {\n                ... on PercentageValue {\n                    percentage\n                    __typename\n                }\n                ... on FixedAmountValue {\n                    appliesOnEachItem\n                    fixedAmount {\n                        ... on MoneyValueConstraint {\n                            value {\n                                amount\n                                currencyCode\n                                __typename\n                            }\n                            __typename\n                        }\n                        __typename\n                    }\n                    __typename\n                }\n                __typename\n            }\n            __typename\n        }\n        ... on DiscountCodeTrigger {\n            code\n            __typename\n        }\n        ... on AutomaticDiscount {\n            presentationLevel\n            title\n            allocationMethod\n            targetSelection\n            targetType\n            value {\n                ... on PercentageValue {\n                    percentage\n                    __typename\n                }\n                ... on FixedAmountValue {\n                    appliesOnEachItem\n                    fixedAmount {\n                        ... on MoneyValueConstraint {\n                            value {\n                                amount\n                                currencyCode\n                                __typename\n                            }\n                            __typename\n                        }\n                        __typename\n                    }\n                    __typename\n                }\n                __typename\n            }\n            __typename\n        }\n        __typename\n    }\n    fragment ProposalDeliveryFragment on DeliveryTerms {\n        __typename\n        ... on FilledDeliveryTerms {\n            intermediateRates\n            progressiveRatesEstimatedTimeUntilCompletion\n            shippingRatesStatusToken\n            deliveryLines {\n                destinationAddress {\n                    ... on StreetAddress {\n                        name\n                        firstName\n                        lastName\n                        company\n                        address1\n                        address2\n                        city\n                        countryCode\n                        zoneCode\n                        postalCode\n                        coordinates {\n                            latitude\n                            longitude\n                            __typename\n                        }\n                        phone\n                        __typename\n                    }\n                    ... on Geolocation {\n                        country {\n                            code\n                            __typename\n                        }\n                        zone {\n                            code\n                            __typename\n                        }\n                        coordinates {\n                            latitude\n                            longitude\n                            __typename\n                        }\n                        postalCode\n                        __typename\n                    }\n                    ... on PartialStreetAddress {\n                        name\n                        firstName\n                        lastName\n                        company\n                        address1\n                        address2\n                        city\n                        countryCode\n                        zoneCode\n                        postalCode\n                        phone\n                        coordinates {\n                            latitude\n                            longitude\n                            __typename\n                        }\n                        __typename\n                    }\n                    __typename\n                }\n                targetMerchandise {\n                    ...FilledMerchandiseLineTargetCollectionFragment\n                    __typename\n                }\n                groupType\n                selectedDeliveryStrategy {\n                    ... on CompleteDeliveryStrategy {\n                        handle\n                        __typename\n                    }\n                    ... on DeliveryStrategyReference {\n                        handle\n                        __typename\n                    }\n                    __typename\n                }\n                availableDeliveryStrategies {\n                    ... on CompleteDeliveryStrategy {\n                        title\n                        handle\n                        custom\n                        description\n                        code\n                        acceptsInstructions\n                        phoneRequired\n                        methodType\n                        carrierName\n                        incoterms\n                        brandedPromise {\n                            logoUrl\n                            name\n                            __typename\n                        }\n                        deliveryStrategyBreakdown {\n                            amount {\n                                ... on MoneyValueConstraint {\n                                    value {\n                                        amount\n                                        currencyCode\n                                        __typename\n                                    }\n                                    __typename\n                                }\n                                __typename\n                            }\n                            discountRecurringCycleLimit\n                            excludeFromDeliveryOptionPrice\n                            targetMerchandise {\n                                ...FilledMerchandiseLineTargetCollectionFragment\n                                __typename\n                            }\n                            __typename\n                        }\n                        minDeliveryDateTime\n                        maxDeliveryDateTime\n                        deliveryPromisePresentmentTitle {\n                            short\n                            long\n                            __typename\n                        }\n                        displayCheckoutRedesign\n                        estimatedTimeInTransit {\n                            ... on IntIntervalConstraint {\n                                lowerBound\n                                upperBound\n                                __typename\n                            }\n                            ... on IntValueConstraint {\n                                value\n                                __typename\n                            }\n                            __typename\n                        }\n                        amount {\n                            ... on MoneyValueConstraint {\n                                value {\n                                    amount\n                                    currencyCode\n                                    __typename\n                                }\n                                __typename\n                            }\n                            __typename\n                        }\n                        amountAfterDiscounts {\n                            ... on MoneyValueConstraint {\n                                value {\n                                    amount\n                                    currencyCode\n                                    __typename\n                                }\n                                __typename\n                            }\n                            __typename\n                        }\n                        pickupLocation {\n                            ... on PickupInStoreLocation {\n                                address {\n                                    address1\n                                    address2\n                                    city\n                                    countryCode\n                                    phone\n                                    postalCode\n                                    zoneCode\n                                    __typename\n                                }\n                                instructions\n                                name\n                                __typename\n                            }\n                            ... on PickupPointLocation {\n                                address {\n                                    address1\n                                    address2\n                                    address3\n                                    city\n                                    countryCode\n                                    zoneCode\n                                    postalCode\n                                    coordinates {\n                                        latitude\n                                        longitude\n                                        __typename\n                                    }\n                                    __typename\n                                }\n                                businessHours {\n                                    day\n                                    openingTime\n                                    closingTime\n                                    __typename\n                                }\n                                carrierCode\n                                carrierName\n                                handle\n                                kind\n                                name\n                                carrierLogoUrl\n                                fromDeliveryOptionGenerator\n                                __typename\n                            }\n                            __typename\n                        }\n                        __typename\n                    }\n                    __typename\n                }\n                __typename\n            }\n            __typename\n        }\n        ... on PendingTerms {\n            pollDelay\n            taskId\n            __typename\n        }\n        ... on UnavailableTerms {\n            __typename\n        }\n    }\n    fragment FilledMerchandiseLineTargetCollectionFragment on FilledMerchandiseLineTargetCollection {\n        linesV2 {\n            ... on MerchandiseLine {\n                stableId\n                merchandise {\n                    ...MerchandiseFragment\n                    __typename\n                }\n                totalAmount {\n                    ... on MoneyValueConstraint {\n                        value {\n                            amount\n                            currencyCode\n                            __typename\n                        }\n                        __typename\n                    }\n                    __typename\n                }\n                __typename\n            }\n            ... on MerchandiseBundleLineComponent {\n                stableId\n                merchandise {\n                    ...MerchandiseFragment\n                    __typename\n                }\n                totalAmount {\n                    ... on MoneyValueConstraint {\n                        value {\n                            amount\n                            currencyCode\n                            __typename\n                        }\n                        __typename\n                    }\n                    __typename\n                }\n                __typename\n            }\n            __typename\n        }\n        __typename\n    }\n    fragment MerchandiseFragment on ProposalMerchandise {\n        ...SourceProvidedMerchandise\n        ... on ProductVariantMerchandise {\n            id\n            digest\n            variantId\n            title\n            subtitle\n            requiresShipping\n            properties {\n                ...MerchandiseProperties\n                __typename\n            }\n            __typename\n        }\n        ... on ContextualizedProductVariantMerchandise {\n            id\n            digest\n            variantId\n            title\n            subtitle\n            requiresShipping\n            sellingPlan {\n                id\n                digest\n                name\n                prepaid\n                deliveriesPerBillingCycle\n                subscriptionDetails {\n                    billingInterval\n                    billingIntervalCount\n                    billingMaxCycles\n                    deliveryInterval\n                    deliveryIntervalCount\n                    __typename\n                }\n                __typename\n            }\n            properties {\n                ...MerchandiseProperties\n                __typename\n            }\n            __typename\n        }\n        ... on MissingProductVariantMerchandise {\n            id\n            digest\n            variantId\n            __typename\n        }\n        __typename\n    }\n    fragment SourceProvidedMerchandise on Merchandise {\n        ... on SourceProvidedMerchandise {\n            __typename\n            product {\n                id\n                title\n                productType\n                vendor\n                __typename\n            }\n            productUrl\n            digest\n            variantId\n            optionalIdentifier\n            title\n            untranslatedTitle\n            subtitle\n            untranslatedSubtitle\n            taxable\n            giftCard\n            requiresShipping\n            price {\n                amount\n                currencyCode\n                __typename\n            }\n            deferredAmount {\n                amount\n                currencyCode\n                __typename\n            }\n            image {\n                altText\n                one: transformedSrc(maxWidth: 64, maxHeight: 64)\n                two: transformedSrc(maxWidth: 128, maxHeight: 128)\n                four: transformedSrc(maxWidth: 256, maxHeight: 256)\n                __typename\n            }\n            options {\n                name\n                value\n                __typename\n            }\n            properties {\n                ...MerchandiseProperties\n                __typename\n            }\n            taxCode\n            taxesIncluded\n            weight {\n                value\n                unit\n                __typename\n            }\n            sku\n        }\n        __typename\n    }\n    fragment MerchandiseProperties on MerchandiseProperty {\n        name\n        value {\n            ... on MerchandisePropertyValueString {\n                string: value\n                __typename\n            }\n            ... on MerchandisePropertyValueInt {\n                int: value\n                __typename\n            }\n            ... on MerchandisePropertyValueFloat {\n                float: value\n                __typename\n            }\n            ... on MerchandisePropertyValueBoolean {\n                boolean: value\n                __typename\n            }\n            ... on MerchandisePropertyValueJson {\n                json: value\n                __typename\n            }\n            __typename\n        }\n        visible\n        __typename\n    }\n    fragment ProductVariantMerchandiseDetails on ProductVariantMerchandise {\n        id\n        digest\n        variantId\n        title\n        untranslatedTitle\n        subtitle\n        untranslatedSubtitle\n        product {\n            id\n            vendor\n            productType\n            __typename\n        }\n        productUrl\n        image {\n            altText\n            one: transformedSrc(maxWidth: 64, maxHeight: 64)\n            two: transformedSrc(maxWidth: 128, maxHeight: 128)\n            four: transformedSrc(maxWidth: 256, maxHeight: 256)\n            __typename\n        }\n        properties {\n            ...MerchandiseProperties\n            __typename\n        }\n        requiresShipping\n        options {\n            name\n            value\n            __typename\n        }\n        sellingPlan {\n            id\n            subscriptionDetails {\n                billingInterval\n                __typename\n            }\n            __typename\n        }\n        giftCard\n        __typename\n    }\n    fragment ContextualizedProductVariantMerchandiseDetails on ContextualizedProductVariantMerchandise {\n        id\n        digest\n        variantId\n        title\n        untranslatedTitle\n        subtitle\n        untranslatedSubtitle\n        sku\n        price {\n            amount\n            currencyCode\n            __typename\n        }\n        product {\n            id\n            vendor\n            productType\n            __typename\n        }\n        productUrl\n        image {\n            altText\n            one: transformedSrc(maxWidth: 64, maxHeight: 64)\n            two: transformedSrc(maxWidth: 128, maxHeight: 128)\n            four: transformedSrc(maxWidth: 256, maxHeight: 256)\n            __typename\n        }\n        properties {\n            ...MerchandiseProperties\n            __typename\n        }\n        requiresShipping\n        options {\n            name\n            value\n            __typename\n        }\n        sellingPlan {\n            name\n            id\n            digest\n            deliveriesPerBillingCycle\n            prepaid\n            subscriptionDetails {\n                billingInterval\n                billingIntervalCount\n                billingMaxCycles\n                deliveryInterval\n                deliveryIntervalCount\n                __typename\n            }\n            __typename\n        }\n        giftCard\n        deferredAmount {\n            amount\n            currencyCode\n            __typename\n        }\n        __typename\n    }\n    fragment LineAllocationDetails on LineAllocation {\n        stableId\n        quantity\n        totalAmountBeforeReductions {\n            amount\n            currencyCode\n            __typename\n        }\n        totalAmountAfterDiscounts {\n            amount\n            currencyCode\n            __typename\n        }\n        totalAmountAfterLineDiscounts {\n            amount\n            currencyCode\n            __typename\n        }\n        checkoutPriceAfterDiscounts {\n            amount\n            currencyCode\n            __typename\n        }\n        checkoutPriceAfterLineDiscounts {\n            amount\n            currencyCode\n            __typename\n        }\n        checkoutPriceBeforeReductions {\n            amount\n            currencyCode\n            __typename\n        }\n        unitPrice {\n            price {\n                amount\n                currencyCode\n                __typename\n            }\n            measurement {\n                referenceUnit\n                referenceValue\n                __typename\n            }\n            __typename\n        }\n        allocations {\n            ... on LineComponentDiscountAllocation {\n                allocation {\n                    amount {\n                        ... on MoneyValueConstraint {\n                            value {\n                                amount\n                                currencyCode\n                                __typename\n                            }\n                            __typename\n                        }\n                        __typename\n                    }\n                    __typename\n                }\n                amount {\n                    amount\n                    currencyCode\n                    __typename\n                }\n                discount {\n                    ...DiscountDetailsFragment\n                    __typename\n                }\n                __typename\n            }\n            __typename\n        }\n        __typename\n    }\n    fragment MerchandiseBundleLineComponent on MerchandiseBundleLineComponent {\n        __typename\n        stableId\n        merchandise {\n            ...SourceProvidedMerchandise\n            ...ProductVariantMerchandiseDetails\n            ...ContextualizedProductVariantMerchandiseDetails\n            ... on MissingProductVariantMerchandise {\n                id\n                digest\n                variantId\n                __typename\n            }\n            __typename\n        }\n        quantity {\n            ... on ProposalMerchandiseQuantityByItem {\n                items {\n                    ... on IntValueConstraint {\n                        value\n                        __typename\n                    }\n                    __typename\n                }\n                __typename\n            }\n            __typename\n        }\n        totalAmount {\n            ... on MoneyValueConstraint {\n                value {\n                    amount\n                    currencyCode\n                    __typename\n                }\n                __typename\n            }\n            __typename\n        }\n        recurringTotal {\n            title\n            interval\n            intervalCount\n            recurringPrice {\n                amount\n                currencyCode\n                __typename\n            }\n            fixedPrice {\n                amount\n                currencyCode\n                __typename\n            }\n            fixedPriceCount\n            __typename\n        }\n        lineAllocations {\n            ...LineAllocationDetails\n            __typename\n        }\n    }\n    fragment ProposalDetails on Proposal {\n        merchandiseDiscount {\n            ...ProposalDiscountFragment\n            __typename\n        }\n        deliveryDiscount {\n            ...ProposalDiscountFragment\n            __typename\n        }\n        deliveryExpectations {\n            ...ProposalDeliveryExpectationFragment\n            __typename\n        }\n        availableRedeemables {\n            ... on PendingTerms {\n                taskId\n                pollDelay\n                __typename\n            }\n            ... on AvailableRedeemables {\n                availableRedeemables {\n                    paymentMethod {\n                        ...RedeemablePaymentMethodFragment\n                        __typename\n                    }\n                    balance {\n                        ... on MoneyValueConstraint {\n                            value {\n                                amount\n                                currencyCode\n                                __typename\n                            }\n                            __typename\n                        }\n                        __typename\n                    }\n                    __typename\n                }\n                __typename\n            }\n            __typename\n        }\n        delivery {\n            ... on FilledDeliveryTerms {\n                intermediateRates\n                progressiveRatesEstimatedTimeUntilCompletion\n                shippingRatesStatusToken\n                deliveryLines {\n                    id\n                    availableOn\n                    destinationAddress {\n                        ... on StreetAddress {\n                            name\n                            firstName\n                            lastName\n                            company\n                            address1\n                            address2\n                            city\n                            countryCode\n                            zoneCode\n                            postalCode\n                            coordinates {\n                                latitude\n                                longitude\n                                __typename\n                            }\n                            phone\n                            __typename\n                        }\n                        ... on Geolocation {\n                            country {\n                                code\n                                __typename\n                            }\n                            zone {\n                                code\n                                __typename\n                            }\n                            coordinates {\n                                latitude\n                                longitude\n                                __typename\n                            }\n                            postalCode\n                            __typename\n                        }\n                        ... on PartialStreetAddress {\n                            name\n                            firstName\n                            lastName\n                            company\n                            address1\n                            address2\n                            city\n                            countryCode\n                            zoneCode\n                            postalCode\n                            phone\n                            coordinates {\n                                latitude\n                                longitude\n                                __typename\n                            }\n                            __typename\n                        }\n                        __typename\n                    }\n                    targetMerchandise {\n                        ...FilledMerchandiseLineTargetCollectionFragment\n                        __typename\n                    }\n                    groupType\n                    selectedDeliveryStrategy {\n                        ... on CompleteDeliveryStrategy {\n                            handle\n                            __typename\n                        }\n                        __typename\n                    }\n                    availableDeliveryStrategies {\n                        ... on CompleteDeliveryStrategy {\n                            originLocation {\n                                id\n                                __typename\n                            }\n                            title\n                            handle\n                            custom\n                            description\n                            code\n                            acceptsInstructions\n                            phoneRequired\n                            methodType\n                            carrierName\n                            incoterms\n                            brandedPromise {\n                                logoUrl\n                                name\n                                __typename\n                            }\n                            deliveryStrategyBreakdown {\n                                amount {\n                                    ... on MoneyValueConstraint {\n                                        value {\n                                            amount\n                                            currencyCode\n                                            __typename\n                                        }\n                                        __typename\n                                    }\n                                    __typename\n                                }\n                                discountRecurringCycleLimit\n                                excludeFromDeliveryOptionPrice\n                                targetMerchandise {\n                                    ...FilledMerchandiseLineTargetCollectionFragment\n                                    __typename\n                                }\n                                __typename\n                            }\n                            minDeliveryDateTime\n                            maxDeliveryDateTime\n                            deliveryPromiseProviderApiClientId\n                            deliveryPromisePresentmentTitle {\n                                short\n                                long\n                                __typename\n                            }\n                            displayCheckoutRedesign\n                            estimatedTimeInTransit {\n                                ... on IntIntervalConstraint {\n                                    lowerBound\n                                    upperBound\n                                    __typename\n                                }\n                                ... on IntValueConstraint {\n                                    value\n                                    __typename\n                                }\n                                __typename\n                            }\n                            amount {\n                                ... on MoneyValueConstraint {\n                                    value {\n                                        amount\n                                        currencyCode\n                                        __typename\n                                    }\n                                    __typename\n                                }\n                                __typename\n                            }\n                            amountAfterDiscounts {\n                                ... on MoneyValueConstraint {\n                                    value {\n                                        amount\n                                        currencyCode\n                                        __typename\n                                    }\n                                    __typename\n                                }\n                                __typename\n                            }\n                            pickupLocation {\n                                ... on PickupInStoreLocation {\n                                    address {\n                                        address1\n                                        address2\n                                        city\n                                        countryCode\n                                        phone\n                                        postalCode\n                                        zoneCode\n                                        __typename\n                                    }\n                                    instructions\n                                    name\n                                    distanceFromBuyer {\n                                        unit\n                                        value\n                                        __typename\n                                    }\n                                    __typename\n                                }\n                                ... on PickupPointLocation {\n                                    address {\n                                        address1\n                                        address2\n                                        address3\n                                        city\n                                        countryCode\n                                        zoneCode\n                                        postalCode\n                                        coordinates {\n                                            latitude\n                                            longitude\n                                            __typename\n                                        }\n                                        __typename\n                                    }\n                                    businessHours {\n                                        day\n                                        openingTime\n                                        closingTime\n                                        __typename\n                                    }\n                                    carrierCode\n                                    carrierName\n                                    handle\n                                    kind\n                                    name\n                                    carrierLogoUrl\n                                    fromDeliveryOptionGenerator\n                                    __typename\n                                }\n                                __typename\n                            }\n                            __typename\n                        }\n                        __typename\n                    }\n                    __typename\n                }\n                simpleDeliveryLine {\n                    availableDeliveryStrategies {\n                        title\n                        amountAfterDiscounts {\n                            ... on MoneyValueConstraint {\n                                value {\n                                    amount\n                                    currencyCode\n                                    __typename\n                                }\n                                __typename\n                            }\n                            __typename\n                        }\n                        deliveryPromisePresentmentTitle {\n                            short\n                            long\n                            __typename\n                        }\n                        __typename\n                    }\n                    __typename\n                }\n                __typename\n            }\n            ... on PendingTerms {\n                pollDelay\n                taskId\n                __typename\n            }\n            ... on UnavailableTerms {\n                __typename\n            }\n            __typename\n        }\n        payment {\n            ... on FilledPaymentTerms {\n                availablePayments {\n                    paymentMethod {\n                        ... on AnyDirectPaymentMethod {\n                            __typename\n                            availablePaymentProviders {\n                                paymentMethodIdentifier\n                                name\n                                brands\n                                orderingIndex\n                                displayName\n                                availablePresentmentCurrencies\n                                paymentMethodUiExtension {\n                                    ...UiExtensionInstallationFragment\n                                    __typename\n                                }\n                                checkoutHostedFields\n                                alternative\n                                __typename\n                            }\n                        }\n                        ... on AnyOffsitePaymentMethod {\n                            __typename\n                            availableOffsiteProviders {\n                                __typename\n                                paymentMethodIdentifier\n                                name\n                                paymentBrands\n                                orderingIndex\n                                showRedirectionNotice\n                                availablePresentmentCurrencies\n                            }\n                        }\n                        ... on AnyCustomOnsitePaymentMethod {\n                            __typename\n                            availableCustomOnsiteProviders {\n                                __typename\n                                paymentMethodIdentifier\n                                name\n                                paymentBrands\n                                orderingIndex\n                                availablePresentmentCurrencies\n                                paymentMethodUiExtension {\n                                    ...UiExtensionInstallationFragment\n                                    __typename\n                                }\n                            }\n                        }\n                        ... on DirectPaymentMethod {\n                            __typename\n                            paymentMethodIdentifier\n                        }\n                        ... on GiftCardPaymentMethod {\n                            __typename\n                        }\n                        ... on AnyRedeemablePaymentMethod {\n                            __typename\n                            availableRedemptionConfigs {\n                                __typename\n                                ... on CustomRedemptionConfig {\n                                    paymentMethodIdentifier\n                                    paymentMethodUiExtension {\n                                        ...UiExtensionInstallationFragment\n                                        __typename\n                                    }\n                                    __typename\n                                }\n                            }\n                            orderingIndex\n                        }\n                        ... on WalletsPlatformConfiguration {\n                            name\n                            configurationParams\n                            __typename\n                        }\n                        ... on AnyWalletPaymentMethod {\n                            availableWalletPaymentConfigs {\n                                ... on PaypalWalletConfig {\n                                    __typename\n                                    name\n                                    clientId\n                                    merchantId\n                                    venmoEnabled\n                                    payflow\n                                    paymentIntent\n                                    paymentMethodIdentifier\n                                    orderingIndex\n                                }\n                                ... on ShopPayWalletConfig {\n                                    __typename\n                                    name\n                                    storefrontUrl\n                                    paymentMethodIdentifier\n                                    orderingIndex\n                                }\n                                ... on ShopifyInstallmentsWalletConfig {\n                                    __typename\n                                    name\n                                    availableLoanTypes\n                                    maxPrice {\n                                        amount\n                                        currencyCode\n                                        __typename\n                                    }\n                                    minPrice {\n                                        amount\n                                        currencyCode\n                                        __typename\n                                    }\n                                    supportedCountries\n                                    supportedCurrencies\n                                    giftCardsNotAllowed\n                                    subscriptionItemsNotAllowed\n                                    ineligibleTestModeCheckout\n                                    ineligibleLineItem\n                                    paymentMethodIdentifier\n                                    orderingIndex\n                                }\n                                ... on FacebookPayWalletConfig {\n                                    __typename\n                                    name\n                                    partnerId\n                                    partnerMerchantId\n                                    supportedContainers\n                                    acquirerCountryCode\n                                    mode\n                                    paymentMethodIdentifier\n                                    orderingIndex\n                                }\n                                ... on ApplePayWalletConfig {\n                                    __typename\n                                    name\n                                    supportedNetworks\n                                    walletAuthenticationToken\n                                    walletOrderTypeIdentifier\n                                    walletServiceUrl\n                                    paymentMethodIdentifier\n                                    orderingIndex\n                                }\n                                ... on GooglePayWalletConfig {\n                                    __typename\n                                    name\n                                    allowedAuthMethods\n                                    allowedCardNetworks\n                                    gateway\n                                    gatewayMerchantId\n                                    merchantId\n                                    authJwt\n                                    environment\n                                    paymentMethodIdentifier\n                                    orderingIndex\n                                }\n                                ... on AmazonPayClassicWalletConfig {\n                                    __typename\n                                    name\n                                    orderingIndex\n                                }\n                                __typename\n                            }\n                            __typename\n                        }\n                        ... on LocalPaymentMethodConfig {\n                            __typename\n                            paymentMethodIdentifier\n                            name\n                            displayName\n                            additionalParameters {\n                                ... on IdealBankSelectionParameterConfig {\n                                    __typename\n                                    label\n                                    options {\n                                        label\n                                        value\n                                        __typename\n                                    }\n                                }\n                                __typename\n                            }\n                            orderingIndex\n                        }\n                        ... on AnyPaymentOnDeliveryMethod {\n                            __typename\n                            additionalDetails\n                            paymentInstructions\n                            paymentMethodIdentifier\n                            orderingIndex\n                            displayName\n                            availablePresentmentCurrencies\n                        }\n                        ... on PaymentOnDeliveryMethod {\n                            __typename\n                            additionalDetails\n                            paymentInstructions\n                            paymentMethodIdentifier\n                        }\n                        ... on CustomPaymentMethod {\n                            id\n                            name\n                            additionalDetails\n                            paymentInstructions\n                            __typename\n                        }\n                        ... on ManualPaymentMethodConfig {\n                            id\n                            name\n                            additionalDetails\n                            paymentInstructions\n                            paymentMethodIdentifier\n                            orderingIndex\n                            availablePresentmentCurrencies\n                            __typename\n                        }\n                        ... on CustomPaymentMethodConfig {\n                            id\n                            name\n                            additionalDetails\n                            paymentInstructions\n                            paymentMethodIdentifier\n                            orderingIndex\n                            availablePresentmentCurrencies\n                            __typename\n                        }\n                        ... on DeferredPaymentMethod {\n                            orderingIndex\n                            displayName\n                            __typename\n                        }\n                        ... on NoopPaymentMethod {\n                            __typename\n                        }\n                        ... on GiftCardPaymentMethod {\n                            __typename\n                        }\n                        ... on CustomerCreditCardPaymentMethod {\n                            __typename\n                            expired\n                            expiryMonth\n                            expiryYear\n                            name\n                            orderingIndex\n                            ...CustomerCreditCardPaymentMethodFragment\n                        }\n                        ... on PaypalBillingAgreementPaymentMethod {\n                            __typename\n                            orderingIndex\n                            paypalAccountEmail\n                            ...PaypalBillingAgreementPaymentMethodFragment\n                        }\n                        __typename\n                    }\n                    __typename\n                }\n                paymentLines {\n                    ...PaymentLines\n                    __typename\n                }\n                billingAddress {\n                    ... on StreetAddress {\n                        firstName\n                        lastName\n                        company\n                        address1\n                        address2\n                        city\n                        countryCode\n                        zoneCode\n                        postalCode\n                        phone\n                        __typename\n                    }\n                    ... on InvalidBillingAddress {\n                        __typename\n                    }\n                    __typename\n                }\n                paymentFlexibilityPaymentTermsTemplate {\n                    id\n                    translatedName\n                    dueDate\n                    dueInDays\n                    type\n                    __typename\n                }\n                __typename\n            }\n            ... on PendingTerms {\n                pollDelay\n                __typename\n            }\n            ... on UnavailableTerms {\n                __typename\n            }\n            __typename\n        }\n        poNumber\n        merchandise {\n            ... on FilledMerchandiseTerms {\n                taxesIncluded\n                merchandiseLines {\n                    stableId\n                    merchandise {\n                        ...SourceProvidedMerchandise\n                        ...ProductVariantMerchandiseDetails\n                        ...ContextualizedProductVariantMerchandiseDetails\n                        ... on MissingProductVariantMerchandise {\n                            id\n                            digest\n                            variantId\n                            __typename\n                        }\n                        __typename\n                    }\n                    quantity {\n                        ... on ProposalMerchandiseQuantityByItem {\n                            items {\n                                ... on IntValueConstraint {\n                                    value\n                                    __typename\n                                }\n                                __typename\n                            }\n                            __typename\n                        }\n                        __typename\n                    }\n                    totalAmount {\n                        ... on MoneyValueConstraint {\n                            value {\n                                amount\n                                currencyCode\n                                __typename\n                            }\n                            __typename\n                        }\n                        __typename\n                    }\n                    recurringTotal {\n                        title\n                        interval\n                        intervalCount\n                        recurringPrice {\n                            amount\n                            currencyCode\n                            __typename\n                        }\n                        fixedPrice {\n                            amount\n                            currencyCode\n                            __typename\n                        }\n                        fixedPriceCount\n                        __typename\n                    }\n                    lineAllocations {\n                        ...LineAllocationDetails\n                        __typename\n                    }\n                    lineComponentsSource\n                    lineComponents {\n                        ...MerchandiseBundleLineComponent\n                        __typename\n                    }\n                    __typename\n                }\n                __typename\n            }\n            __typename\n        }\n        note {\n            customAttributes {\n                key\n                value\n                __typename\n            }\n            message\n            __typename\n        }\n        scriptFingerprint {\n            signature\n            signatureUuid\n            lineItemScriptChanges\n            paymentScriptChanges\n            shippingScriptChanges\n            __typename\n        }\n        transformerFingerprintV2\n        buyerIdentity {\n            ... on FilledBuyerIdentityTerms {\n                buyerIdentity {\n                    ... on GuestProfile {\n                        presentmentCurrency\n                        countryCode\n                        market {\n                            id\n                            handle\n                            __typename\n                        }\n                        __typename\n                    }\n                    ... on CustomerProfile {\n                        id\n                        presentmentCurrency\n                        fullName\n                        firstName\n                        lastName\n                        countryCode\n                        email\n                        imageUrl\n                        acceptsMarketing\n                        acceptsSmsMarketing\n                        acceptsEmailMarketing\n                        ordersCount\n                        phone\n                        billingAddresses {\n                            id\n                            default\n                            address {\n                                firstName\n                                lastName\n                                address1\n                                address2\n                                phone\n                                postalCode\n                                city\n                                company\n                                zoneCode\n                                countryCode\n                                label\n                                __typename\n                            }\n                            __typename\n                        }\n                        shippingAddresses {\n                            id\n                            default\n                            address {\n                                firstName\n                                lastName\n                                address1\n                                address2\n                                phone\n                                postalCode\n                                city\n                                company\n                                zoneCode\n                                countryCode\n                                label\n                                __typename\n                            }\n                            __typename\n                        }\n                        storeCreditAccounts {\n                            id\n                            balance {\n                                amount\n                                currencyCode\n                                __typename\n                            }\n                            __typename\n                        }\n                        __typename\n                    }\n                    ... on BusinessCustomerProfile {\n                        checkoutExperienceConfiguration {\n                            availablePaymentOptions\n                            editableShippingAddress\n                            __typename\n                        }\n                        id\n                        presentmentCurrency\n                        fullName\n                        firstName\n                        lastName\n                        acceptsMarketing\n                        acceptsSmsMarketing\n                        acceptsEmailMarketing\n                        company {\n                            id\n                            name\n                            externalId\n                            __typename\n                        }\n                        countryCode\n                        imageUrl\n                        email\n                        ordersCount\n                        phone\n                        selectedCompanyLocation {\n                            id\n                            name\n                            externalId\n                            __typename\n                        }\n                        locationCount\n                        billingAddress {\n                            firstName\n                            lastName\n                            address1\n                            address2\n                            phone\n                            postalCode\n                            city\n                            company\n                            zoneCode\n                            countryCode\n                            label\n                            __typename\n                        }\n                        shippingAddress {\n                            firstName\n                            lastName\n                            address1\n                            address2\n                            phone\n                            postalCode\n                            city\n                            company\n                            zoneCode\n                            countryCode\n                            label\n                            __typename\n                        }\n                        __typename\n                    }\n                    __typename\n                }\n                contactInfoV2 {\n                    ... on EmailFormContents {\n                        email\n                        __typename\n                    }\n                    ... on SMSFormContents {\n                        phoneNumber\n                        __typename\n                    }\n                    __typename\n                }\n                marketingConsent {\n                    ... on SMSMarketingConsent {\n                        value\n                        __typename\n                    }\n                    ... on EmailMarketingConsent {\n                        value\n                        __typename\n                    }\n                    __typename\n                }\n                shopPayOptInPhone\n                __typename\n            }\n            __typename\n        }\n        checkoutCompletionTarget\n        recurringTotals {\n            title\n            interval\n            intervalCount\n            recurringPrice {\n                amount\n                currencyCode\n                __typename\n            }\n            fixedPrice {\n                amount\n                currencyCode\n                __typename\n            }\n            fixedPriceCount\n            __typename\n        }\n        subtotalBeforeTaxesAndShipping {\n            ... on MoneyValueConstraint {\n                value {\n                    amount\n                    currencyCode\n                    __typename\n                }\n                __typename\n            }\n            __typename\n        }\n        totalSavings {\n            ... on MoneyValueConstraint {\n                value {\n                    amount\n                    currencyCode\n                    __typename\n                }\n                __typename\n            }\n            __typename\n        }\n        runningTotal {\n            ... on MoneyValueConstraint {\n                value {\n                    amount\n                    currencyCode\n                    __typename\n                }\n                __typename\n            }\n            __typename\n        }\n        total {\n            ... on MoneyValueConstraint {\n                value {\n                    amount\n                    currencyCode\n                    __typename\n                }\n                __typename\n            }\n            __typename\n        }\n        checkoutTotalBeforeTaxesAndShipping {\n            ... on MoneyValueConstraint {\n                value {\n                    amount\n                    currencyCode\n                    __typename\n                }\n                __typename\n            }\n            __typename\n        }\n        checkoutTotalTaxes {\n            ... on MoneyValueConstraint {\n                value {\n                    amount\n                    currencyCode\n                    __typename\n                }\n                __typename\n            }\n            __typename\n        }\n        checkoutTotal {\n            ... on MoneyValueConstraint {\n                value {\n                    amount\n                    currencyCode\n                    __typename\n                }\n                __typename\n            }\n            __typename\n        }\n        deferredTotal {\n            amount {\n                ... on MoneyValueConstraint {\n                    value {\n                        amount\n                        currencyCode\n                        __typename\n                    }\n                    __typename\n                }\n                __typename\n            }\n            subtotalAmount {\n                ... on MoneyValueConstraint {\n                    value {\n                        amount\n                        currencyCode\n                        __typename\n                    }\n                    __typename\n                }\n                __typename\n            }\n            taxes {\n                ... on MoneyValueConstraint {\n                    value {\n                        amount\n                        currencyCode\n                        __typename\n                    }\n                    __typename\n                }\n                __typename\n            }\n            dueAt\n            __typename\n        }\n        hasOnlyDeferredShipping\n        subtotalBeforeReductions {\n            ... on MoneyValueConstraint {\n                value {\n                    amount\n                    currencyCode\n                    __typename\n                }\n                __typename\n            }\n            __typename\n        }\n        duty {\n            ... on FilledDutyTerms {\n                totalDutyAmount {\n                    ... on MoneyValueConstraint {\n                        value {\n                            amount\n                            currencyCode\n                            __typename\n                        }\n                        __typename\n                    }\n                    __typename\n                }\n                totalTaxAndDutyAmount {\n                    ... on MoneyValueConstraint {\n                        value {\n                            amount\n                            currencyCode\n                            __typename\n                        }\n                        __typename\n                    }\n                    __typename\n                }\n                totalAdditionalFeesAmount {\n                    ... on MoneyValueConstraint {\n                        value {\n                            amount\n                            currencyCode\n                            __typename\n                        }\n                        __typename\n                    }\n                    __typename\n                }\n                __typename\n            }\n            ... on PendingTerms {\n                pollDelay\n                __typename\n            }\n            ... on UnavailableTerms {\n                __typename\n            }\n            __typename\n        }\n        tax {\n            ... on FilledTaxTerms {\n                totalTaxAmount {\n                    ... on MoneyValueConstraint {\n                        value {\n                            amount\n                            currencyCode\n                            __typename\n                        }\n                        __typename\n                    }\n                    __typename\n                }\n                totalTaxAndDutyAmount {\n                    ... on MoneyValueConstraint {\n                        value {\n                            amount\n                            currencyCode\n                            __typename\n                        }\n                        __typename\n                    }\n                    __typename\n                }\n                totalAmountIncludedInTarget {\n                    ... on MoneyValueConstraint {\n                        value {\n                            amount\n                            currencyCode\n                            __typename\n                        }\n                        __typename\n                    }\n                    __typename\n                }\n                exemptions {\n                    taxExemptionReason\n                    targets {\n                        ... on TargetAllLines {\n                            __typename\n                        }\n                        __typename\n                    }\n                    __typename\n                }\n                __typename\n            }\n            ... on PendingTerms {\n                pollDelay\n                __typename\n            }\n            ... on UnavailableTerms {\n                __typename\n            }\n            __typename\n        }\n        tip {\n            tipSuggestions {\n                ... on TipSuggestion {\n                    __typename\n                    percentage\n                    amount {\n                        ... on MoneyValueConstraint {\n                            value {\n                                amount\n                                currencyCode\n                                __typename\n                            }\n                            __typename\n                        }\n                        __typename\n                    }\n                }\n                __typename\n            }\n            terms {\n                ... on FilledTipTerms {\n                    tipLines {\n                        amount {\n                            ... on MoneyValueConstraint {\n                                value {\n                                    amount\n                                    currencyCode\n                                    __typename\n                                }\n                                __typename\n                            }\n                            __typename\n                        }\n                        __typename\n                    }\n                    __typename\n                }\n                __typename\n            }\n            __typename\n        }\n        localizationExtension {\n            ... on LocalizationExtension {\n                fields {\n                    ... on LocalizationExtensionField {\n                        key\n                        title\n                        value\n                        __typename\n                    }\n                    __typename\n                }\n                __typename\n            }\n            __typename\n        }\n        landedCostDetails {\n            incotermInformation {\n                incoterm\n                reason\n                __typename\n            }\n            __typename\n        }\n        nonNegotiableTerms {\n            signature\n            contents {\n                signature\n                targetTerms\n                targetLine {\n                    allLines\n                    index\n                    __typename\n                }\n                attributes\n                __typename\n            }\n            __typename\n        }\n        optionalDuties {\n            buyerRefusesDuties\n            refuseDutiesPermitted\n            __typename\n        }\n        attribution {\n            attributions {\n                ... on AttributionItem {\n                    ... on RetailAttributions {\n                        deviceId\n                        locationId\n                        userId\n                        __typename\n                    }\n                    ... on DraftOrderAttributions {\n                        userIdentifier: userId\n                        sourceName\n                        locationIdentifier: locationId\n                        __typename\n                    }\n                    __typename\n                }\n                __typename\n            }\n            __typename\n        }\n        saleAttributions {\n            attributions {\n                ... on SaleAttribution {\n                    recipient {\n                        ... on StaffMember {\n                            id\n                            __typename\n                        }\n                        ... on Location {\n                            id\n                            __typename\n                        }\n                        ... on PointOfSaleDevice {\n                            id\n                            __typename\n                        }\n                        __typename\n                    }\n                    targetMerchandiseLines {\n                        ...FilledMerchandiseLineTargetCollectionFragment\n                        ... on AnyMerchandiseLineTargetCollection {\n                            any\n                            __typename\n                        }\n                        __typename\n                    }\n                    __typename\n                }\n                __typename\n            }\n            __typename\n        }\n        managedByMarketsPro\n        captcha {\n            ... on Captcha {\n                provider\n                challenge\n                sitekey\n                token\n                __typename\n            }\n            ... on PendingTerms {\n                taskId\n                pollDelay\n                __typename\n            }\n            __typename\n        }\n        cartCheckoutValidation {\n            ... on PendingTerms {\n                taskId\n                pollDelay\n                __typename\n            }\n            __typename\n        }\n        alternativePaymentCurrency {\n            ... on AllocatedAlternativePaymentCurrencyTotal {\n                total {\n                    amount\n                    currencyCode\n                    __typename\n                }\n                paymentLineAllocations {\n                    amount {\n                        amount\n                        currencyCode\n                        __typename\n                    }\n                    stableId\n                    __typename\n                }\n                __typename\n            }\n            __typename\n        }\n        __typename\n    }\n    fragment ProposalDeliveryExpectationFragment on DeliveryExpectationTerms {\n        __typename\n        ... on FilledDeliveryExpectationTerms {\n            deliveryExpectations {\n                minDeliveryDateTime\n                maxDeliveryDateTime\n                deliveryStrategyHandle\n                brandedPromise {\n                    logoUrl\n                    name\n                    __typename\n                }\n                deliveryOptionHandle\n                deliveryExpectationPresentmentTitle {\n                    short\n                    long\n                    __typename\n                }\n                promiseProviderApiClientId\n                __typename\n            }\n            __typename\n        }\n        ... on PendingTerms {\n            pollDelay\n            taskId\n            __typename\n        }\n        ... on UnavailableTerms {\n            __typename\n        }\n    }\n    fragment RedeemablePaymentMethodFragment on RedeemablePaymentMethod {\n        redemptionSource\n        redemptionContent {\n            ... on ShopCashRedemptionContent {\n                billingAddress {\n                    ... on StreetAddress {\n                        firstName\n                        lastName\n                        company\n                        address1\n                        address2\n                        city\n                        countryCode\n                        zoneCode\n                        postalCode\n                        phone\n                        __typename\n                    }\n                    __typename\n                }\n                redemptionId\n                destinationAmount {\n                    amount\n                    currencyCode\n                    __typename\n                }\n                sourceAmount {\n                    amount\n                    currencyCode\n                    __typename\n                }\n                __typename\n            }\n            ... on StoreCreditRedemptionContent {\n                storeCreditAccountId\n                __typename\n            }\n            ... on CustomRedemptionContent {\n                redemptionAttributes {\n                    key\n                    value\n                    __typename\n                }\n                maskedIdentifier\n                paymentMethodIdentifier\n                __typename\n            }\n            __typename\n        }\n        __typename\n    }\n    fragment UiExtensionInstallationFragment on UiExtensionInstallation {\n        extension {\n            approvalScopes {\n                handle\n                __typename\n            }\n            capabilities {\n                apiAccess\n                networkAccess\n                blockProgress\n                collectBuyerConsent {\n                    smsMarketing\n                    __typename\n                }\n                __typename\n            }\n            appId\n            extensionLocale\n            extensionPoints\n            translations\n            scriptUrl\n            uuid\n            registrationUuid\n            version\n            apiVersion\n            __typename\n        }\n        __typename\n    }\n    fragment CustomerCreditCardPaymentMethodFragment on CustomerCreditCardPaymentMethod {\n        cvvSessionId\n        paymentMethodIdentifier\n        token\n        displayLastDigits\n        brand\n        defaultPaymentMethod\n        deletable\n        requiresCvvConfirmation\n        billingAddress {\n            ... on StreetAddress {\n                address1\n                address2\n                city\n                company\n                countryCode\n                firstName\n                lastName\n                phone\n                postalCode\n                zoneCode\n                __typename\n            }\n            __typename\n        }\n        __typename\n    }\n    fragment PaypalBillingAgreementPaymentMethodFragment on PaypalBillingAgreementPaymentMethod {\n        paymentMethodIdentifier\n        token\n        billingAddress {\n            ... on StreetAddress {\n                address1\n                address2\n                city\n                company\n                countryCode\n                firstName\n                lastName\n                phone\n                postalCode\n                zoneCode\n                __typename\n            }\n            __typename\n        }\n        __typename\n    }\n    fragment PaymentLines on PaymentLine {\n        stableId\n        specialInstructions\n        amount {\n            ... on MoneyValueConstraint {\n                value {\n                    amount\n                    currencyCode\n                    __typename\n                }\n                __typename\n            }\n            __typename\n        }\n        dueAt\n        paymentMethod {\n            ... on DirectPaymentMethod {\n                sessionId\n                paymentMethodIdentifier\n                creditCard {\n                    ... on CreditCard {\n                        brand\n                        lastDigits\n                        name\n                        __typename\n                    }\n                    __typename\n                }\n                paymentAttributes\n                __typename\n            }\n            ... on GiftCardPaymentMethod {\n                code\n                balance {\n                    amount\n                    currencyCode\n                    __typename\n                }\n                __typename\n            }\n            ... on RedeemablePaymentMethod {\n                ...RedeemablePaymentMethodFragment\n                __typename\n            }\n            ... on WalletsPlatformPaymentMethod {\n                name\n                walletParams\n                __typename\n            }\n            ... on WalletPaymentMethod {\n                name\n                walletContent {\n                    ... on ShopPayWalletContent {\n                        billingAddress {\n                            ... on StreetAddress {\n                                firstName\n                                lastName\n                                company\n                                address1\n                                address2\n                                city\n                                countryCode\n                                zoneCode\n                                postalCode\n                                phone\n                                __typename\n                            }\n                            ... on InvalidBillingAddress {\n                                __typename\n                            }\n                            __typename\n                        }\n                        sessionToken\n                        paymentMethodIdentifier\n                        __typename\n                    }\n                    ... on PaypalWalletContent {\n                        paypalBillingAddress: billingAddress {\n                            ... on StreetAddress {\n                                firstName\n                                lastName\n                                company\n                                address1\n                                address2\n                                city\n                                countryCode\n                                zoneCode\n                                postalCode\n                                phone\n                                __typename\n                            }\n                            ... on InvalidBillingAddress {\n                                __typename\n                            }\n                            __typename\n                        }\n                        email\n                        payerId\n                        token\n                        paymentMethodIdentifier\n                        acceptedSubscriptionTerms\n                        expiresAt\n                        __typename\n                    }\n                    ... on ApplePayWalletContent {\n                        data\n                        signature\n                        version\n                        lastDigits\n                        paymentMethodIdentifier\n                        header {\n                            applicationData\n                            ephemeralPublicKey\n                            publicKeyHash\n                            transactionId\n                            __typename\n                        }\n                        __typename\n                    }\n                    ... on GooglePayWalletContent {\n                        signature\n                        signedMessage\n                        protocolVersion\n                        paymentMethodIdentifier\n                        __typename\n                    }\n                    ... on FacebookPayWalletContent {\n                        billingAddress {\n                            ... on StreetAddress {\n                                firstName\n                                lastName\n                                company\n                                address1\n                                address2\n                                city\n                                countryCode\n                                zoneCode\n                                postalCode\n                                phone\n                                __typename\n                            }\n                            ... on InvalidBillingAddress {\n                                __typename\n                            }\n                            __typename\n                        }\n                        containerData\n                        containerId\n                        mode\n                        paymentMethodIdentifier\n                        __typename\n                    }\n                    ... on ShopifyInstallmentsWalletContent {\n                        autoPayEnabled\n                        billingAddress {\n                            ... on StreetAddress {\n                                firstName\n                                lastName\n                                company\n                                address1\n                                address2\n                                city\n                                countryCode\n                                zoneCode\n                                postalCode\n                                phone\n                                __typename\n                            }\n                            ... on InvalidBillingAddress {\n                                __typename\n                            }\n                            __typename\n                        }\n                        disclosureDetails {\n                            evidence\n                            id\n                            type\n                            __typename\n                        }\n                        installmentsToken\n                        sessionToken\n                        paymentMethodIdentifier\n                        __typename\n                    }\n                    __typename\n                }\n                __typename\n            }\n            ... on LocalPaymentMethod {\n                paymentMethodIdentifier\n                name\n                additionalParameters {\n                    ... on IdealPaymentMethodParameters {\n                        bank\n                        __typename\n                    }\n                    __typename\n                }\n                __typename\n            }\n            ... on PaymentOnDeliveryMethod {\n                additionalDetails\n                paymentInstructions\n                paymentMethodIdentifier\n                __typename\n            }\n            ... on OffsitePaymentMethod {\n                paymentMethodIdentifier\n                name\n                __typename\n            }\n            ... on CustomPaymentMethod {\n                id\n                name\n                additionalDetails\n                paymentInstructions\n                paymentMethodIdentifier\n                __typename\n            }\n            ... on CustomOnsitePaymentMethod {\n                paymentMethodIdentifier\n                name\n                paymentAttributes\n                __typename\n            }\n            ... on ManualPaymentMethod {\n                id\n                name\n                paymentMethodIdentifier\n                __typename\n            }\n            ... on DeferredPaymentMethod {\n                orderingIndex\n                displayName\n                __typename\n            }\n            ... on CustomerCreditCardPaymentMethod {\n                ...CustomerCreditCardPaymentMethodFragment\n                __typename\n            }\n            ... on PaypalBillingAgreementPaymentMethod {\n                ...PaypalBillingAgreementPaymentMethodFragment\n                __typename\n            }\n            ... on NoopPaymentMethod {\n                __typename\n            }\n            __typename\n        }\n        __typename\n    }\n    fragment ReceiptDetails on Receipt {\n        ... on ProcessedReceipt {\n            id\n            token\n            redirectUrl\n            analytics {\n                checkoutCompletedEventId\n                __typename\n            }\n            poNumber\n            orderIdentity {\n                buyerIdentifier\n                id\n                __typename\n            }\n            eligibleForMarketingOptIn\n            purchaseOrder {\n                ...ReceiptPurchaseOrder\n                __typename\n            }\n            orderCreationStatus {\n                __typename\n            }\n            paymentDetails {\n                creditCardBrand\n                paymentCardBrand\n                creditCardLastFourDigits\n                paymentAmount {\n                    amount\n                    currencyCode\n                    __typename\n                }\n                paymentGateway\n                __typename\n            }\n            shopAppLinksAndResources {\n                mobileUrl\n                qrCodeUrl\n                canTrackOrderUpdates\n                shopInstallmentsViewSchedules\n                shopInstallmentsMobileUrl\n                installmentsHighlightEligible\n                mobileUrlAttributionPayload\n                shopAppEligible\n                shopAppQrCodeKillswitch\n                shopPayOrder\n                buyerHasShopApp\n                buyerHasShopPay\n                orderUpdateOptions\n                __typename\n            }\n            postPurchasePageUrl\n            postPurchasePageRequested\n            postPurchaseVaultedPaymentMethodStatus\n            paymentFlexibilityPaymentTermsTemplate {\n                __typename\n                dueDate\n                dueInDays\n                id\n                translatedName\n                type\n            }\n            __typename\n        }\n        ... on ProcessingReceipt {\n            id\n            pollDelay\n            __typename\n        }\n        ... on ActionRequiredReceipt {\n            id\n            action {\n                ... on CompletePaymentChallenge {\n                    offsiteRedirect\n                    url\n                    __typename\n                }\n                __typename\n            }\n            timeout {\n                millisecondsRemaining\n                __typename\n            }\n            __typename\n        }\n        ... on FailedReceipt {\n            id\n            processingError {\n                ... on InventoryClaimFailure {\n                    __typename\n                }\n                ... on InventoryReservationFailure {\n                    __typename\n                }\n                ... on OrderCreationFailure {\n                    paymentsHaveBeenReverted\n                    __typename\n                }\n                ... on OrderCreationSchedulingFailure {\n                    __typename\n                }\n                ... on PaymentFailed {\n                    code\n                    messageUntranslated\n                    hasOffsitePaymentMethod\n                    __typename\n                }\n                ... on DiscountUsageLimitExceededFailure {\n                    __typename\n                }\n                ... on CustomerPersistenceFailure {\n                    __typename\n                }\n                __typename\n            }\n            __typename\n        }\n        __typename\n    }\n    fragment ReceiptPurchaseOrder on PurchaseOrder {\n        __typename\n        sessionToken\n        totalAmountToPay {\n            amount\n            currencyCode\n            __typename\n        }\n        checkoutCompletionTarget\n        delivery {\n            ... on PurchaseOrderDeliveryTerms {\n                deliveryLines {\n                    __typename\n                    deliveryStrategy {\n                        handle\n                        title\n                        description\n                        methodType\n                        pickupLocation {\n                            ... on PickupInStoreLocation {\n                                name\n                                address {\n                                    address1\n                                    address2\n                                    city\n                                    countryCode\n                                    zoneCode\n                                    postalCode\n                                    phone\n                                    coordinates {\n                                        latitude\n                                        longitude\n                                        __typename\n                                    }\n                                    __typename\n                                }\n                                instructions\n                                __typename\n                            }\n                            __typename\n                        }\n                        __typename\n                    }\n                    lineAmount {\n                        amount\n                        currencyCode\n                        __typename\n                    }\n                    lineAmountAfterDiscounts {\n                        amount\n                        currencyCode\n                        __typename\n                    }\n                    destinationAddress {\n                        ... on StreetAddress {\n                            name\n                            firstName\n                            lastName\n                            company\n                            address1\n                            address2\n                            city\n                            countryCode\n                            zoneCode\n                            postalCode\n                            coordinates {\n                                latitude\n                                longitude\n                                __typename\n                            }\n                            phone\n                            __typename\n                        }\n                        __typename\n                    }\n                    groupType\n                    targetMerchandise {\n                        ... on PurchaseOrderMerchandiseLine {\n                            stableId\n                            merchandise {\n                                ... on ProductVariantSnapshot {\n                                    ...ProductVariantSnapshotMerchandiseDetails\n                                    __typename\n                                }\n                                __typename\n                            }\n                            __typename\n                        }\n                        ... on PurchaseOrderBundleLineComponent {\n                            stableId\n                            merchandise {\n                                ... on ProductVariantSnapshot {\n                                    ...ProductVariantSnapshotMerchandiseDetails\n                                    __typename\n                                }\n                                __typename\n                            }\n                            __typename\n                        }\n                        __typename\n                    }\n                }\n                __typename\n            }\n            __typename\n        }\n        payment {\n            ... on PurchaseOrderPaymentTerms {\n                billingAddress {\n                    __typename\n                    ... on StreetAddress {\n                        name\n                        firstName\n                        lastName\n                        company\n                        address1\n                        address2\n                        city\n                        countryCode\n                        zoneCode\n                        postalCode\n                        coordinates {\n                            latitude\n                            longitude\n                            __typename\n                        }\n                        phone\n                        __typename\n                    }\n                    ... on InvalidBillingAddress {\n                        __typename\n                    }\n                }\n                paymentLines {\n                    amount {\n                        amount\n                        currencyCode\n                        __typename\n                    }\n                    postPaymentMessage\n                    dueAt\n                    paymentMethod {\n                        ... on DirectPaymentMethod {\n                            sessionId\n                            paymentMethodIdentifier\n                            vaultingAgreement\n                            creditCard {\n                                brand\n                                lastDigits\n                                __typename\n                            }\n                            billingAddress {\n                                ... on StreetAddress {\n                                    name\n                                    firstName\n                                    lastName\n                                    company\n                                    address1\n                                    address2\n                                    city\n                                    countryCode\n                                    zoneCode\n                                    postalCode\n                                    coordinates {\n                                        latitude\n                                        longitude\n                                        __typename\n                                    }\n                                    phone\n                                    __typename\n                                }\n                                ... on InvalidBillingAddress {\n                                    __typename\n                                }\n                                __typename\n                            }\n                            __typename\n                        }\n                        ... on CustomerCreditCardPaymentMethod {\n                            brand\n                            displayLastDigits\n                            token\n                            deletable\n                            defaultPaymentMethod\n                            requiresCvvConfirmation\n                            billingAddress {\n                                ... on StreetAddress {\n                                    address1\n                                    address2\n                                    city\n                                    company\n                                    countryCode\n                                    firstName\n                                    lastName\n                                    phone\n                                    postalCode\n                                    zoneCode\n                                    __typename\n                                }\n                                __typename\n                            }\n                            __typename\n                        }\n                        ... on PurchaseOrderGiftCardPaymentMethod {\n                            balance {\n                                amount\n                                currencyCode\n                                __typename\n                            }\n                            code\n                            __typename\n                        }\n                        ... on WalletPaymentMethod {\n                            name\n                            walletContent {\n                                ... on ShopPayWalletContent {\n                                    billingAddress {\n                                        ... on StreetAddress {\n                                            firstName\n                                            lastName\n                                            company\n                                            address1\n                                            address2\n                                            city\n                                            countryCode\n                                            zoneCode\n                                            postalCode\n                                            phone\n                                            __typename\n                                        }\n                                        ... on InvalidBillingAddress {\n                                            __typename\n                                        }\n                                        __typename\n                                    }\n                                    sessionToken\n                                    paymentMethodIdentifier\n                                    __typename\n                                }\n                                ... on PaypalWalletContent {\n                                    billingAddress {\n                                        ... on StreetAddress {\n                                            firstName\n                                            lastName\n                                            company\n                                            address1\n                                            address2\n                                            city\n                                            countryCode\n                                            zoneCode\n                                            postalCode\n                                            phone\n                                            __typename\n                                        }\n                                        ... on InvalidBillingAddress {\n                                            __typename\n                                        }\n                                        __typename\n                                    }\n                                    email\n                                    payerId\n                                    token\n                                    expiresAt\n                                    __typename\n                                }\n                                ... on ApplePayWalletContent {\n                                    billingAddress {\n                                        ... on StreetAddress {\n                                            firstName\n                                            lastName\n                                            company\n                                            address1\n                                            address2\n                                            city\n                                            countryCode\n                                            zoneCode\n                                            postalCode\n                                            phone\n                                            __typename\n                                        }\n                                        ... on InvalidBillingAddress {\n                                            __typename\n                                        }\n                                        __typename\n                                    }\n                                    data\n                                    signature\n                                    version\n                                    __typename\n                                }\n                                ... on GooglePayWalletContent {\n                                    billingAddress {\n                                        ... on StreetAddress {\n                                            firstName\n                                            lastName\n                                            company\n                                            address1\n                                            address2\n                                            city\n                                            countryCode\n                                            zoneCode\n                                            postalCode\n                                            phone\n                                            __typename\n                                        }\n                                        ... on InvalidBillingAddress {\n                                            __typename\n                                        }\n                                        __typename\n                                    }\n                                    signature\n                                    signedMessage\n                                    protocolVersion\n                                    __typename\n                                }\n                                ... on FacebookPayWalletContent {\n                                    billingAddress {\n                                        ... on StreetAddress {\n                                            firstName\n                                            lastName\n                                            company\n                                            address1\n                                            address2\n                                            city\n                                            countryCode\n                                            zoneCode\n                                            postalCode\n                                            phone\n                                            __typename\n                                        }\n                                        ... on InvalidBillingAddress {\n                                            __typename\n                                        }\n                                        __typename\n                                    }\n                                    containerData\n                                    containerId\n                                    mode\n                                    __typename\n                                }\n                                ... on ShopifyInstallmentsWalletContent {\n                                    autoPayEnabled\n                                    billingAddress {\n                                        ... on StreetAddress {\n                                            firstName\n                                            lastName\n                                            company\n                                            address1\n                                            address2\n                                            city\n                                            countryCode\n                                            zoneCode\n                                            postalCode\n                                            phone\n                                            __typename\n                                        }\n                                        ... on InvalidBillingAddress {\n                                            __typename\n                                        }\n                                        __typename\n                                    }\n                                    disclosureDetails {\n                                        evidence\n                                        id\n                                        type\n                                        __typename\n                                    }\n                                    installmentsToken\n                                    sessionToken\n                                    creditCard {\n                                        brand\n                                        lastDigits\n                                        __typename\n                                    }\n                                    __typename\n                                }\n                                __typename\n                            }\n                            __typename\n                        }\n                        ... on WalletsPlatformPaymentMethod {\n                            name\n                            walletParams\n                            __typename\n                        }\n                        ... on LocalPaymentMethod {\n                            paymentMethodIdentifier\n                            name\n                            displayName\n                            billingAddress {\n                                ... on StreetAddress {\n                                    name\n                                    firstName\n                                    lastName\n                                    company\n                                    address1\n                                    address2\n                                    city\n                                    countryCode\n                                    zoneCode\n                                    postalCode\n                                    coordinates {\n                                        latitude\n                                        longitude\n                                        __typename\n                                    }\n                                    phone\n                                    __typename\n                                }\n                                ... on InvalidBillingAddress {\n                                    __typename\n                                }\n                                __typename\n                            }\n                            additionalParameters {\n                                ... on IdealPaymentMethodParameters {\n                                    bank\n                                    __typename\n                                }\n                                __typename\n                            }\n                            __typename\n                        }\n                        ... on PaymentOnDeliveryMethod {\n                            additionalDetails\n                            paymentInstructions\n                            paymentMethodIdentifier\n                            billingAddress {\n                                ... on StreetAddress {\n                                    name\n                                    firstName\n                                    lastName\n                                    company\n                                    address1\n                                    address2\n                                    city\n                                    countryCode\n                                    zoneCode\n                                    postalCode\n                                    coordinates {\n                                        latitude\n                                        longitude\n                                        __typename\n                                    }\n                                    phone\n                                    __typename\n                                }\n                                ... on InvalidBillingAddress {\n                                    __typename\n                                }\n                                __typename\n                            }\n                            __typename\n                        }\n                        ... on OffsitePaymentMethod {\n                            paymentMethodIdentifier\n                            name\n                            billingAddress {\n                                ... on StreetAddress {\n                                    name\n                                    firstName\n                                    lastName\n                                    company\n                                    address1\n                                    address2\n                                    city\n                                    countryCode\n                                    zoneCode\n                                    postalCode\n                                    coordinates {\n                                        latitude\n                                        longitude\n                                        __typename\n                                    }\n                                    phone\n                                    __typename\n                                }\n                                ... on InvalidBillingAddress {\n                                    __typename\n                                }\n                                __typename\n                            }\n                            __typename\n                        }\n                        ... on ManualPaymentMethod {\n                            additionalDetails\n                            name\n                            paymentInstructions\n                            id\n                            paymentMethodIdentifier\n                            billingAddress {\n                                ... on StreetAddress {\n                                    name\n                                    firstName\n                                    lastName\n                                    company\n                                    address1\n                                    address2\n                                    city\n                                    countryCode\n                                    zoneCode\n                                    postalCode\n                                    coordinates {\n                                        latitude\n                                        longitude\n                                        __typename\n                                    }\n                                    phone\n                                    __typename\n                                }\n                                ... on InvalidBillingAddress {\n                                    __typename\n                                }\n                                __typename\n                            }\n                            __typename\n                        }\n                        ... on CustomPaymentMethod {\n                            additionalDetails\n                            name\n                            paymentInstructions\n                            id\n                            paymentMethodIdentifier\n                            billingAddress {\n                                ... on StreetAddress {\n                                    name\n                                    firstName\n                                    lastName\n                                    company\n                                    address1\n                                    address2\n                                    city\n                                    countryCode\n                                    zoneCode\n                                    postalCode\n                                    coordinates {\n                                        latitude\n                                        longitude\n                                        __typename\n                                    }\n                                    phone\n                                    __typename\n                                }\n                                ... on InvalidBillingAddress {\n                                    __typename\n                                }\n                                __typename\n                            }\n                            __typename\n                        }\n                        ... on DeferredPaymentMethod {\n                            orderingIndex\n                            displayName\n                            __typename\n                        }\n                        ... on PaypalBillingAgreementPaymentMethod {\n                            token\n                            billingAddress {\n                                ... on StreetAddress {\n                                    address1\n                                    address2\n                                    city\n                                    company\n                                    countryCode\n                                    firstName\n                                    lastName\n                                    phone\n                                    postalCode\n                                    zoneCode\n                                    __typename\n                                }\n                                __typename\n                            }\n                            __typename\n                        }\n                        ... on RedeemablePaymentMethod {\n                            redemptionSource\n                            redemptionContent {\n                                ... on CustomRedemptionContent {\n                                    redemptionAttributes {\n                                        key\n                                        value\n                                        __typename\n                                    }\n                                    maskedIdentifier\n                                    paymentMethodIdentifier\n                                    __typename\n                                }\n                                ... on StoreCreditRedemptionContent {\n                                    storeCreditAccountId\n                                    __typename\n                                }\n                                __typename\n                            }\n                            __typename\n                        }\n                        ... on CustomOnsitePaymentMethod {\n                            paymentMethodIdentifier\n                            name\n                            __typename\n                        }\n                        __typename\n                    }\n                    __typename\n                }\n                __typename\n            }\n            __typename\n        }\n        buyerIdentity {\n            ... on PurchaseOrderBuyerIdentityTerms {\n                contactMethod {\n                    ... on PurchaseOrderEmailContactMethod {\n                        email\n                        __typename\n                    }\n                    ... on PurchaseOrderSMSContactMethod {\n                        phoneNumber\n                        __typename\n                    }\n                    __typename\n                }\n                marketingConsent {\n                    ... on PurchaseOrderEmailContactMethod {\n                        email\n                        __typename\n                    }\n                    ... on PurchaseOrderSMSContactMethod {\n                        phoneNumber\n                        __typename\n                    }\n                    __typename\n                }\n                __typename\n            }\n            buyerIdentity {\n                __typename\n                ... on GuestProfile {\n                    presentmentCurrency\n                    countryCode\n                    market {\n                        id\n                        handle\n                        __typename\n                    }\n                    __typename\n                }\n                ... on DecodedCustomerProfile {\n                    id\n                    presentmentCurrency\n                    fullName\n                    firstName\n                    lastName\n                    countryCode\n                    email\n                    imageUrl\n                    acceptsMarketing\n                    acceptsSmsMarketing\n                    acceptsEmailMarketing\n                    ordersCount\n                    phone\n                    __typename\n                }\n                ... on BusinessCustomerProfile {\n                    checkoutExperienceConfiguration {\n                        availablePaymentOptions\n                        editableShippingAddress\n                        __typename\n                    }\n                    id\n                    presentmentCurrency\n                    fullName\n                    firstName\n                    lastName\n                    acceptsMarketing\n                    acceptsSmsMarketing\n                    acceptsEmailMarketing\n                    countryCode\n                    imageUrl\n                    email\n                    ordersCount\n                    phone\n                    selectedCompanyLocation {\n                        id\n                        name\n                        externalId\n                        __typename\n                    }\n                    locationCount\n                    company {\n                        id\n                        name\n                        externalId\n                        __typename\n                    }\n                    __typename\n                }\n            }\n            __typename\n        }\n        merchandise {\n            merchandiseLines {\n                stableId\n                merchandise {\n                    ...ProductVariantSnapshotMerchandiseDetails\n                    __typename\n                }\n                lineAllocations {\n                    checkoutPriceAfterDiscounts {\n                        amount\n                        currencyCode\n                        __typename\n                    }\n                    checkoutPriceAfterLineDiscounts {\n                        amount\n                        currencyCode\n                        __typename\n                    }\n                    checkoutPriceBeforeReductions {\n                        amount\n                        currencyCode\n                        __typename\n                    }\n                    quantity\n                    stableId\n                    totalAmountAfterDiscounts {\n                        amount\n                        currencyCode\n                        __typename\n                    }\n                    totalAmountAfterLineDiscounts {\n                        amount\n                        currencyCode\n                        __typename\n                    }\n                    totalAmountBeforeReductions {\n                        amount\n                        currencyCode\n                        __typename\n                    }\n                    discountAllocations {\n                        __typename\n                        amount {\n                            amount\n                            currencyCode\n                            __typename\n                        }\n                        discount {\n                            ...DiscountDetailsFragment\n                            __typename\n                        }\n                    }\n                    unitPrice {\n                        measurement {\n                            referenceUnit\n                            referenceValue\n                            __typename\n                        }\n                        price {\n                            amount\n                            currencyCode\n                            __typename\n                        }\n                        __typename\n                    }\n                    __typename\n                }\n                lineComponents {\n                    ...PurchaseOrderBundleLineComponent\n                    __typename\n                }\n                quantity {\n                    __typename\n                    ... on PurchaseOrderMerchandiseQuantityByItem {\n                        items\n                        __typename\n                    }\n                }\n                recurringTotal {\n                    fixedPrice {\n                        __typename\n                        amount\n                        currencyCode\n                    }\n                    fixedPriceCount\n                    interval\n                    intervalCount\n                    recurringPrice {\n                        __typename\n                        amount\n                        currencyCode\n                    }\n                    title\n                    __typename\n                }\n                lineAmount {\n                    __typename\n                    amount\n                    currencyCode\n                }\n                __typename\n            }\n            __typename\n        }\n        tax {\n            totalTaxAmountV2 {\n                __typename\n                amount\n                currencyCode\n            }\n            totalDutyAmount {\n                amount\n                currencyCode\n                __typename\n            }\n            totalTaxAndDutyAmount {\n                amount\n                currencyCode\n                __typename\n            }\n            totalAmountIncludedInTarget {\n                amount\n                currencyCode\n                __typename\n            }\n            __typename\n        }\n        discounts {\n            lines {\n                ...PurchaseOrderDiscountLineFragment\n                __typename\n            }\n            __typename\n        }\n        totalSavings {\n            amount\n            currencyCode\n            __typename\n        }\n        subtotalBeforeTaxesAndShipping {\n            amount\n            currencyCode\n            __typename\n        }\n        landedCostDetails {\n            incotermInformation {\n                incoterm\n                reason\n                __typename\n            }\n            __typename\n        }\n        optionalDuties {\n            buyerRefusesDuties\n            refuseDutiesPermitted\n            __typename\n        }\n        tip {\n            tipLines {\n                amount {\n                    amount\n                    currencyCode\n                    __typename\n                }\n                __typename\n            }\n            __typename\n        }\n        hasOnlyDeferredShipping\n        note {\n            customAttributes {\n                key\n                value\n                __typename\n            }\n            message\n            __typename\n        }\n        shopPayArtifact {\n            optIn {\n                vaultPhone\n                __typename\n            }\n            __typename\n        }\n        recurringTotals {\n            fixedPrice {\n                amount\n                currencyCode\n                __typename\n            }\n            fixedPriceCount\n            interval\n            intervalCount\n            recurringPrice {\n                amount\n                currencyCode\n                __typename\n            }\n            title\n            __typename\n        }\n        checkoutTotalBeforeTaxesAndShipping {\n            __typename\n            amount\n            currencyCode\n        }\n        checkoutTotal {\n            __typename\n            amount\n            currencyCode\n        }\n        checkoutTotalTaxes {\n            __typename\n            amount\n            currencyCode\n        }\n        subtotalBeforeReductions {\n            __typename\n            amount\n            currencyCode\n        }\n        deferredTotal {\n            amount {\n                __typename\n                ... on MoneyValueConstraint {\n                    value {\n                        amount\n                        currencyCode\n                        __typename\n                    }\n                    __typename\n                }\n            }\n            dueAt\n            subtotalAmount {\n                __typename\n                ... on MoneyValueConstraint {\n                    value {\n                        amount\n                        currencyCode\n                        __typename\n                    }\n                    __typename\n                }\n            }\n            taxes {\n                __typename\n                ... on MoneyValueConstraint {\n                    value {\n                        amount\n                        currencyCode\n                        __typename\n                    }\n                    __typename\n                }\n            }\n            __typename\n        }\n        metafields {\n            key\n            namespace\n            value\n            valueType: type\n            __typename\n        }\n    }\n    fragment ProductVariantSnapshotMerchandiseDetails on ProductVariantSnapshot {\n        variantId\n        options {\n            name\n            value\n            __typename\n        }\n        productTitle\n        title\n        productUrl\n        untranslatedTitle\n        untranslatedSubtitle\n        sellingPlan {\n            name\n            id\n            digest\n            deliveriesPerBillingCycle\n            prepaid\n            subscriptionDetails {\n                billingInterval\n                billingIntervalCount\n                billingMaxCycles\n                deliveryInterval\n                deliveryIntervalCount\n                __typename\n            }\n            __typename\n        }\n        deferredAmount {\n            amount\n            currencyCode\n            __typename\n        }\n        digest\n        giftCard\n        image {\n            altText\n            one: url(transform: { maxWidth: 64, maxHeight: 64 })\n            two: url(transform: { maxWidth: 128, maxHeight: 128 })\n            four: url(transform: { maxWidth: 256, maxHeight: 256 })\n            __typename\n        }\n        price {\n            amount\n            currencyCode\n            __typename\n        }\n        productId\n        productType\n        properties {\n            ...MerchandiseProperties\n            __typename\n        }\n        requiresShipping\n        sku\n        taxCode\n        taxable\n        vendor\n        weight {\n            unit\n            value\n            __typename\n        }\n        __typename\n    }\n    fragment PurchaseOrderBundleLineComponent on PurchaseOrderBundleLineComponent {\n        stableId\n        merchandise {\n            ...ProductVariantSnapshotMerchandiseDetails\n            __typename\n        }\n        lineAllocations {\n            checkoutPriceAfterDiscounts {\n                amount\n                currencyCode\n                __typename\n            }\n            checkoutPriceAfterLineDiscounts {\n                amount\n                currencyCode\n                __typename\n            }\n            checkoutPriceBeforeReductions {\n                amount\n                currencyCode\n                __typename\n            }\n            quantity\n            stableId\n            totalAmountAfterDiscounts {\n                amount\n                currencyCode\n                __typename\n            }\n            totalAmountAfterLineDiscounts {\n                amount\n                currencyCode\n                __typename\n            }\n            totalAmountBeforeReductions {\n                amount\n                currencyCode\n                __typename\n            }\n            discountAllocations {\n                __typename\n                amount {\n                    amount\n                    currencyCode\n                    __typename\n                }\n                discount {\n                    ...DiscountDetailsFragment\n                    __typename\n                }\n                index\n            }\n            unitPrice {\n                measurement {\n                    referenceUnit\n                    referenceValue\n                    __typename\n                }\n                price {\n                    amount\n                    currencyCode\n                    __typename\n                }\n                __typename\n            }\n            __typename\n        }\n        quantity\n        recurringTotal {\n            fixedPrice {\n                __typename\n                amount\n                currencyCode\n            }\n            fixedPriceCount\n            interval\n            intervalCount\n            recurringPrice {\n                __typename\n                amount\n                currencyCode\n            }\n            title\n            __typename\n        }\n        totalAmount {\n            __typename\n            amount\n            currencyCode\n        }\n        __typename\n    }\n    fragment PurchaseOrderDiscountLineFragment on PurchaseOrderDiscountLine {\n        discount {\n            ...DiscountDetailsFragment\n            __typename\n        }\n        lineAmount {\n            amount\n            currencyCode\n            __typename\n        }\n        deliveryAllocations {\n            amount {\n                amount\n                currencyCode\n                __typename\n            }\n            discount {\n                ...DiscountDetailsFragment\n                __typename\n            }\n            index\n            stableId\n            targetType\n            __typename\n        }\n        merchandiseAllocations {\n            amount {\n                amount\n                currencyCode\n                __typename\n            }\n            discount {\n                ...DiscountDetailsFragment\n                __typename\n            }\n            index\n            stableId\n            targetType\n            __typename\n        }\n        __typename\n    }\n"},59102:function(e,n,t){var o,r=this&&this.__extends||(o=function(e,n){return o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,n){e.__proto__=n}||function(e,n){for(var t in n)Object.prototype.hasOwnProperty.call(n,t)&&(e[t]=n[t])},o(e,n)},function(e,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function t(){this.constructor=e}o(e,n),e.prototype=null===n?Object.create(n):(t.prototype=n.prototype,new t)}),a=this&&this.__createBinding||(Object.create?function(e,n,t,o){void 0===o&&(o=t);var r=Object.getOwnPropertyDescriptor(n,t);r&&!("get"in r?!n.__esModule:r.writable||r.configurable)||(r={enumerable:!0,get:function(){return n[t]}}),Object.defineProperty(e,o,r)}:function(e,n,t,o){void 0===o&&(o=t),e[o]=n[t]}),i=this&&this.__setModuleDefault||(Object.create?function(e,n){Object.defineProperty(e,"default",{enumerable:!0,value:n})}:function(e,n){e.default=n}),s=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var n={};if(null!=e)for(var t in e)"default"!==t&&Object.prototype.hasOwnProperty.call(e,t)&&a(n,e,t);return i(n,e),n},u=this&&this.__awaiter||function(e,n,t,o){return new(t||(t=Promise))((function(r,a){function i(e){try{u(o.next(e))}catch(e){a(e)}}function s(e){try{u(o.throw(e))}catch(e){a(e)}}function u(e){var n;e.done?r(e.value):(n=e.value,n instanceof t?n:new t((function(e){e(n)}))).then(i,s)}u((o=o.apply(e,n||[])).next())}))},c=this&&this.__generator||function(e,n){var t,o,r,a,i={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return a={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function s(s){return function(u){return function(s){if(t)throw new TypeError("Generator is already executing.");for(;a&&(a=0,s[0]&&(i=0)),i;)try{if(t=1,o&&(r=2&s[0]?o.return:s[0]?o.throw||((r=o.return)&&r.call(o),0):o.next)&&!(r=r.call(o,s[1])).done)return r;switch(o=0,r&&(s=[2&s[0],r.value]),s[0]){case 0:case 1:r=s;break;case 4:return i.label++,{value:s[1],done:!1};case 5:i.label++,o=s[1],s=[0];continue;case 7:s=i.ops.pop(),i.trys.pop();continue;default:if(!(r=i.trys,(r=r.length>0&&r[r.length-1])||6!==s[0]&&2!==s[0])){i=0;continue}if(3===s[0]&&(!r||s[1]>r[0]&&s[1]<r[3])){i.label=s[1];break}if(6===s[0]&&i.label<r[1]){i.label=r[1],r=s;break}if(r&&i.label<r[2]){i.label=r[2],i.ops.push(s);break}r[2]&&i.ops.pop(),i.trys.pop();continue}s=n.call(e,i)}catch(e){s=[6,e],o=0}finally{t=r=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,u])}}};Object.defineProperty(n,"__esModule",{value:!0}),n.WixDriver=void 0;var l=s(t(2543)),d=t(55015),p=t(33757),f=t(4008),m=function(e){function n(){var n=e.call(this,d.CouponCrm.wix,"application/json")||this;return n.graphqlApiEndpointUrl="https://".concat(new URL(window.location.href).hostname,"/_api/wixstores-graphql-server/graphql"),n.cartId=void 0,n}return r(n,e),n.prototype.checkShouldUseDriver=function(){return!!document.querySelector('script[src*="static.parastorage.com"]')},n.prototype.getCartId=function(){return u(this,void 0,void 0,(function(){var e,n;return c(this,(function(t){switch(t.label){case 0:return this.cartId?[2,this.cartId]:[4,fetch(this.graphqlApiEndpointUrl,{headers:this.buildRequestHeaders(),referrerPolicy:"strict-origin-when-cross-origin",method:"POST",mode:"cors",credentials:"include",body:JSON.stringify({query:f.wixCartQuery,variables:{locale:document.documentElement.lang||"en",withTax:!0,withShipping:!1}})})];case 1:return[4,t.sent().json()];case 2:if(e=t.sent(),"string"!=typeof(n=l.get(e,"data.cart.cartId")))throw new Error("Invalid cart ID");return this.cartId=n,[2,n]}}))}))},n.prototype.buildRequestHeaders=function(){var e=new Headers;return e.set("content-type","application/json; charset=utf-8"),e},n.prototype.checkIsCouponApplicationSuccessful=function(e){return u(this,void 0,void 0,(function(){var n;return c(this,(function(t){switch(t.label){case 0:return this.checkIsValidContentType(e),n=this,[4,e.json()];case 1:if(n.responseBody=t.sent(),!this.responseBody.data||!this.responseBody.data.cart||!this.responseBody.data.cart.setCoupon)throw new Error("Unexpected response structure");if(!this.responseBody.data.cart.setCoupon.hasOwnProperty("errors"))return[2,!0];if(!Array.isArray(this.responseBody.data.cart.setCoupon.errors))throw new Error("Unexpected response structure");return[2,0===this.responseBody.data.cart.setCoupon.errors.length]}}))}))},n.prototype.applyCoupon=function(e){return u(this,void 0,void 0,(function(){var n;return c(this,(function(t){switch(t.label){case 0:return[4,this.getCartId()];case 1:return n=t.sent(),[2,fetch(this.graphqlApiEndpointUrl,{headers:this.buildRequestHeaders(),referrer:window.location.href,referrerPolicy:"strict-origin-when-cross-origin",method:"POST",mode:"cors",credentials:"include",body:JSON.stringify({query:f.wixSetCouponMutation,variables:{params:{cartId:n,code:e}},operationName:"setCoupon",source:"WixStoresWebClient"})})]}}))}))},n.prototype.getAmountSaved=function(){throw new Error("Not implemented")},n}(p.BaseCouponCrmDriver);n.WixDriver=m},4008:(e,n)=>{Object.defineProperty(n,"__esModule",{value:!0}),n.wixSetCouponMutation=n.wixCartQuery=void 0,n.wixCartQuery="query getCart($locale: String!, $withTax: Boolean, $withShipping: Boolean) {\n    cart {\n        cartId\n        checkoutId\n        ecomId\n        purchaseFlowId\n        storeId\n        buyerNote\n        tems {\n           cartItemId\n           catalogAppId\n            product {\n                id\n                productType\n                urlPart\n                weight\n                name\n                price\n                comparePrice\n                customTextFields {\n                    title\n                    value\n                }\n            media(limit: 1) {\n                altText\n                mediaType\n                url\n                height\n                width\n            }\n            digitalProductFileItems {\n                fileType\n            }\n        }\n        optionsSelectionsValues {\n            id\n            title\n            value\n        }\n        freeText {\n            title\n            value\n        }\n        sku\n        quantity\n        inventoryQuantity\n        convertedPrices {\n            formattedComparePrice\n            formattedPrice\n            formattedTotalPrice\n            totalPrice\n            formattedPriceBeforeDiscount\n            price\n            depositAmount\n            formattedDepositAmount\n        }\n        formattedDepositAmount\n        depositAmount\n        formattedPriceBeforeDiscount\n        discountRules {\n            name\n        }\n        renderingConfig {\n            hidePrice\n            hideQuantity\n        }\n        paymentType\n        selectedMembership {\n            membershipId\n            appId\n            name {\n                original\n                translated\n            }      \n        }\n    }   \n    appliedCoupon {\n      discountValue\n      convertedDiscountValue\n      code\n      couponId\n      couponType\n      name\n    }\n    currencyFormat {\n      code\n    }\n    convertedCurrencyFormat {\n      code\n    }\n    additionalFees {\n      code\n      name\n      totalPrice\n      formattedTotalPrice\n      convertedFormattedTotalPrice\n    }\n    totals(withTax: $withTax, withShipping: $withShipping) {\n      subTotal\n      total\n      shipping\n      discount\n      itemsTotal\n      tax\n      payNow\n      payLater\n      additionalFeesTotal\n      formattedItemsTotal\n      formattedSubTotal\n      formattedShipping\n      formattedDiscount\n      formattedTax\n      formattedAdditionalFeesTotal\n      formattedPayNow\n      formattedPayLater\n      formattedTotal\n    }\n    convertedTotals(withTax: $withTax, withShipping: $withShipping) {\n      subTotal\n      total\n      shipping\n      discount\n      itemsTotal\n      tax\n      payNow\n      payLater\n      additionalFeesTotal\n      formattedItemsTotal\n      formattedSubTotal\n      formattedShipping\n      formattedDiscount\n      formattedTax\n      formattedAdditionalFeesTotal\n      formattedPayNow\n      formattedPayLater\n      formattedTotal\n    }\n    destination {\n      country\n      countryName(translateTo: $locale)\n      subdivision\n      subdivisionName(translateTo: $locale)\n      zipCode\n    }\n    selectedShippingOption {\n      id\n    }\n    shippingRuleInfo {\n      status\n      canShipToDestination\n      shippingRule {\n    id\n    options {\n      id\n      title\n      rate: convertedRate\n      formattedRate: convertedFormattedRate\n      deliveryTime\n      pickupInfo {\n        address {\n            countryName(translateTo: $locale)\n            subdivisionName(translateTo: $locale)\n            addressLine\n            city\n        }\n        pickupMethod\n      }\n      deliveryTimeSlot {\n        from\n        to\n      }\n    }\n      }\n    }\n    destinationCompleteness\n    minimumOrderAmount {\n      reached\n      diff\n      value\n      convertedDiff\n      convertedValue\n      formattedConvertedDiff\n      formattedConvertedValue\n    }\n    violations {\n      severity\n      target {\n    other {\n      name\n    }\n    lineItem {\n      name\n      id\n    }\n      }\n      description\n    }\n    }\n  }\n",n.wixSetCouponMutation="mutation setCoupon($params: SetCouponInput!) {\n  cart {\n    setCoupon(params: $params) {\n\n  errors {\n    code\n    commandName\n    message\n    field\n  }\n  cart {\n    cartId\n    checkoutId\n    ecomId\n    storeId\n    buyerNote\n    items {\ncartItemId\ncatalogAppId\nconvertedFormattedComparePrice\nconvertedFormattedPrice\nconvertedFormattedTotalPrice\nconvertedPrices {\n  comparePrice\n  formattedComparePrice\n  formattedPrice\n  formattedTotalPrice\n  price\n  totalPrice\n  formattedPriceBeforeDiscount\n}\nproduct {\n  comparePrice\n  convertedComparePrice\n  convertedPrice\n  customTextFields {\ntitle\nvalue\n  }\n  id\n  productType\n  urlPart\n  name\n  pageUrl\n  price\n  sku\n  weight\n  media(limit: 1) {\naltText\nmediaType\nurl\nheight\nwidth\n  }\n  digitalProductFileItems {\nfileType\n  }\n}\noptionsSelectionsValues {\n  id\n  title\n  value\n}\nconvertedTotalPrice\nfreeText {\n  title\n  value\n}\nsku\nquantity\ninventoryQuantity\nformattedComparePrice\nformattedPrice\nformattedTotalPrice\nformattedPriceBeforeDiscount\ndiscountRules {\n  name\n}\nsubscriptionPlan {\n  id\n  name\n  tagline\n  frequency\n  duration\n}\ntotalPrice\n    }\n    subscriptionPlan {\nid\nname\ntagline\nfrequency\nduration\n    }\n\n    appliedCoupon {\nconvertedDiscountValue\ncode\ncouponId\ncouponType\nname\ndiscountValue\n    }\n    couponCalculationError\n     additionalFees {\ncode\nname\ntotalPrice\nformattedTotalPrice\nconvertedFormattedTotalPrice\n    }\n    totals {\nsubTotal\nshipping\ntax\ntotal\ndiscount\nshippingWithoutTax\ngiftCardAmount\nformattedSubTotal\nformattedShipping\nformattedTax\noriginalTotal\nitemsTotal\nadditionalFeesTotal\nformattedItemsTotal\nformattedOriginalTotal\nformattedTotalBeforeTax\nformattedTotal\nformattedDiscount\nformattedShippingWithoutTax\nformattedGiftCardAmount\nformattedAdditionalFeesTotal\ntotalBeforeTax\n    }\n    destination {\ncountry\nsubdivision\nzipCode\n    }\n    selectedShippingOption {\nid\n    }\n    shippingAddress {\nemail\nfirstName\nlastName\nfullName\naddressLine\naddressLine1\naddressLine2\nstreet {\n  name\n  number\n}\ncity\ncompany\ncountry\nsubdivision\nzipCode\nphoneNumber\ntaxInfo {\n  taxId\n  taxType\n}\naddressesServiceId\n    }\n    billingAddress {\naddressLine\nemail\nfirstName\nlastName\nfullName\naddressLine1\naddressLine2\nstreet {\n  name\n  number\n}\ncity\ncompany\ncountry\nsubdivision\nzipCode\nphoneNumber\ntaxInfo {\n  taxId\n  taxType\n}\naddressesServiceId\n    }\n    taxCalculationError\n    taxRuleInfo {\nrule {\n  applyToShipping\n}\nstatus\n    }\n    checkoutCustomField {\nvalue\n    }\n    convertedCurrencyFormat {\ncode\n    }\n    convertedTotals {\ndiscount\nformattedDiscount\nformattedGiftCardAmount\nformattedItemsTotal\nformattedOriginalTotal\nformattedShipping\nformattedShippingWithoutTax\nformattedSubTotal\nformattedTax\nformattedTotal\nformattedTotalBeforeTax\ngiftCardAmount\nitemsTotal\noriginalTotal\nshipping\nshippingWithoutTax\nsubTotal\ntax\ntotal\ntotalBeforeTax\n    }\n    currencyFormat {\ncode\n    }\n    destinationCompleteness\n    giftCard {\nid\ncode\nerrorCode\n    }\n    shippingRuleInfo {\nshippingRule {\n  id\n  ruleType\n  options {\nconvertedRate\nconvertedFormattedRate\nid\ntitle\nrate\nformattedRate\ndeliveryTime\npickupInfo {\n  address {\n    country\n    subdivision\n    addressLine\n    city\n    zipCode\n  }\n  instructions\n}\n  }\n}\n    }\n  }\n\n    }\n  }\n}\n"},89342:function(e,n,t){var o,r=this&&this.__extends||(o=function(e,n){return o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,n){e.__proto__=n}||function(e,n){for(var t in n)Object.prototype.hasOwnProperty.call(n,t)&&(e[t]=n[t])},o(e,n)},function(e,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function t(){this.constructor=e}o(e,n),e.prototype=null===n?Object.create(n):(t.prototype=n.prototype,new t)}),a=this&&this.__awaiter||function(e,n,t,o){return new(t||(t=Promise))((function(r,a){function i(e){try{u(o.next(e))}catch(e){a(e)}}function s(e){try{u(o.throw(e))}catch(e){a(e)}}function u(e){var n;e.done?r(e.value):(n=e.value,n instanceof t?n:new t((function(e){e(n)}))).then(i,s)}u((o=o.apply(e,n||[])).next())}))},i=this&&this.__generator||function(e,n){var t,o,r,a,i={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return a={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function s(s){return function(u){return function(s){if(t)throw new TypeError("Generator is already executing.");for(;a&&(a=0,s[0]&&(i=0)),i;)try{if(t=1,o&&(r=2&s[0]?o.return:s[0]?o.throw||((r=o.return)&&r.call(o),0):o.next)&&!(r=r.call(o,s[1])).done)return r;switch(o=0,r&&(s=[2&s[0],r.value]),s[0]){case 0:case 1:r=s;break;case 4:return i.label++,{value:s[1],done:!1};case 5:i.label++,o=s[1],s=[0];continue;case 7:s=i.ops.pop(),i.trys.pop();continue;default:if(!(r=i.trys,(r=r.length>0&&r[r.length-1])||6!==s[0]&&2!==s[0])){i=0;continue}if(3===s[0]&&(!r||s[1]>r[0]&&s[1]<r[3])){i.label=s[1];break}if(6===s[0]&&i.label<r[1]){i.label=r[1],r=s;break}if(r&&i.label<r[2]){i.label=r[2],i.ops.push(s);break}r[2]&&i.ops.pop(),i.trys.pop();continue}s=n.call(e,i)}catch(e){s=[6,e],o=0}finally{t=r=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,u])}}};Object.defineProperty(n,"__esModule",{value:!0}),n.WooCommerceDriver=void 0;var s=t(55015),u=function(e){function n(){return e.call(this,s.CouponCrm.wooCommerce,"text/html")||this}return r(n,e),n.prototype.checkShouldUseDriver=function(){return!!document.querySelector('script[id*="woocommerce"]')},n.prototype.checkIsCouponApplicationSuccessful=function(e){return a(this,void 0,void 0,(function(){var n,t;return i(this,(function(o){switch(o.label){case 0:return this.checkIsValidContentType(e),n=this,[4,e.text()];case 1:return n.responseBody=o.sent(),(t=document.createElement("html")).innerHTML=this.responseBody,[2,!t.querySelector('ul[class*="woocommerce-error"]')]}}))}))},n.prototype.applyCoupon=function(){return a(this,void 0,void 0,(function(){return i(this,(function(e){throw new Error("Not implemented")}))}))},n.prototype.getAmountSaved=function(){throw new Error("Not implemented")},n}(t(33757).BaseCouponCrmDriver);n.WooCommerceDriver=u},33682:function(e,n,t){var o,r=this&&this.__values||function(e){var n="function"==typeof Symbol&&Symbol.iterator,t=n&&e[n],o=0;if(t)return t.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&o>=e.length&&(e=void 0),{value:e&&e[o++],done:!e}}};throw new TypeError(n?"Object is not iterable.":"Symbol.iterator is not defined.")},a=this&&this.__read||function(e,n){var t="function"==typeof Symbol&&e[Symbol.iterator];if(!t)return e;var o,r,a=t.call(e),i=[];try{for(;(void 0===n||n-- >0)&&!(o=a.next()).done;)i.push(o.value)}catch(e){r={error:e}}finally{try{o&&!o.done&&(t=a.return)&&t.call(a)}finally{if(r)throw r.error}}return i},i=this&&this.__spreadArray||function(e,n,t){if(t||2===arguments.length)for(var o,r=0,a=n.length;r<a;r++)!o&&r in n||(o||(o=Array.prototype.slice.call(n,0,r)),o[r]=n[r]);return e.concat(o||Array.prototype.slice.call(n))};Object.defineProperty(n,"__esModule",{value:!0}),n.buildCssSelector=n.getElementFromSelector=void 0;var s=t(55015),u=t(50139);n.getElementFromSelector=function(e,n){void 0===n&&(n=document.documentElement);try{if(!e)return{message:"Selector is not defined",selector:"",type:s.CouponAutomationSelectorErrorType.Unknown};var t=n.querySelectorAll(e);if(t.length>1)return{message:"More than one result",selector:e,type:s.CouponAutomationSelectorErrorType.MoreThanOneMatch};if(0===t.length)return{message:"No result",selector:e,type:s.CouponAutomationSelectorErrorType.NoMatch};var o=t.item(0);return o.nodeType===n.ELEMENT_NODE?o:{message:"Not an element node",selector:e,type:s.CouponAutomationSelectorErrorType.NotANode}}catch(n){return n instanceof DOMException?{message:"DOM error: ".concat(n.message),selector:e||"",type:s.CouponAutomationSelectorErrorType.DOM}:{message:"Unknown error: ".concat(n),selector:e||"",type:s.CouponAutomationSelectorErrorType.Unknown}}},n.buildCssSelector=function(e,n){var t=function(e,n){var t,o;if(!n)return;var a=e.tagName;try{for(var i=r(e.getAttributeNames()),s=i.next();!s.done;s=i.next()){var u=s.value,c=e.getAttribute(u);if(l({attributeName:u,attributeValue:c,elementType:n})&&(a+="[".concat(u,'="').concat(c,'"]')),d(a))return a}}catch(e){t={error:e}}finally{try{s&&!s.done&&(o=i.return)&&o.call(i)}finally{if(t)throw t.error}}return}(e,n);return t||(t=function(e){var n=[],t=e;for(;t.parentElement;){if(t.id){n.unshift("#"+t.id);break}for(var o=1,r=t;r.previousElementSibling;)r=r.previousElementSibling,o++;n.unshift(t.tagName+":nth-child(".concat(o,")")),t=t.parentElement}return n.join(" > ")}(e)),t};var c=((o={})[s.CouponElementType.couponInputField]=["input","field"],o[s.CouponElementType.validationButton]=["apply","submit","add","valid","redeem","confirm"],o[s.CouponElementType.removalButton]=["cancel","delete","remove","annuler","supprimer","retirer"],o[s.CouponElementType.totalPrice]=["price","total","amount","value","checkout","cart","basket"],o[s.CouponElementType.showCouponFieldClickableElement]=["display","show","collapse","expand"],o);function l(e){var n=e.attributeName,t=e.attributeValue,o=e.elementType;if(!t||!n||t.includes("\n"))return!1;var r=o?i(i([],a(u.BASE_COUPON_ELEMENTS_KEYWORDS),!1),a(c[o]),!1):u.BASE_COUPON_ELEMENTS_KEYWORDS,s=(0,u.convertVariableNameToReadableText)(t),l=(0,u.convertVariableNameToReadableText)(n);return r.some((function(e){return s.includes(e)}))||r.some((function(e){return l.includes(e)}))}function d(e){return 1===document.querySelectorAll(e).length}},18045:function(e,n,t){var o=this&&this.__assign||function(){return o=Object.assign||function(e){for(var n,t=1,o=arguments.length;t<o;t++)for(var r in n=arguments[t])Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r]);return e},o.apply(this,arguments)},r=this&&this.__read||function(e,n){var t="function"==typeof Symbol&&e[Symbol.iterator];if(!t)return e;var o,r,a=t.call(e),i=[];try{for(;(void 0===n||n-- >0)&&!(o=a.next()).done;)i.push(o.value)}catch(e){r={error:e}}finally{try{o&&!o.done&&(t=a.return)&&t.call(a)}finally{if(r)throw r.error}}return i};Object.defineProperty(n,"__esModule",{value:!0}),n.checkShowCouponElementsButtonExists=n.checkDoCouponElementsExistAndUpdateSelectors=void 0;var a=t(55015),i=t(622),s=t(33682),u=t(91958),c=t(99959);n.checkDoCouponElementsExistAndUpdateSelectors=function(e){var n=e.selectors,t=n,o=r((0,c.getCouponInputField)(n),2),a=o[0],s=o[1];if(t.couponField=s,!a)return{doCouponElementsExist:!1,selectors:t};var l=r((0,u.getValidationButton)(n,a),2),d=l[0],p=l[1];if(t.validationButton=p,!d)return{doCouponElementsExist:!1,selectors:t};var f=(0,i.getPriceAmountAndCurrency)(e),m=f.priceAmount,y=f.priceSelector;return t.price=y,m?{doCouponElementsExist:!0,selectors:t}:{doCouponElementsExist:!1,selectors:t}},n.checkShowCouponElementsButtonExists=function(e){if(e.showCouponFieldClickableElement){var n=!(0,a.checkIsCouponSelectorError)((0,s.getElementFromSelector)(e.showCouponFieldClickableElement.selector));return e.showCouponFieldClickableElement=o(o({},e.showCouponFieldClickableElement),{detectionStatus:n?a.CouponSelectorElementDetectionStatus.found:a.CouponSelectorElementDetectionStatus.notFound}),n}return!1}},91958:function(e,n,t){var o=this&&this.__values||function(e){var n="function"==typeof Symbol&&Symbol.iterator,t=n&&e[n],o=0;if(t)return t.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&o>=e.length&&(e=void 0),{value:e&&e[o++],done:!e}}};throw new TypeError(n?"Object is not iterable.":"Symbol.iterator is not defined.")},r=this&&this.__read||function(e,n){var t="function"==typeof Symbol&&e[Symbol.iterator];if(!t)return e;var o,r,a=t.call(e),i=[];try{for(;(void 0===n||n-- >0)&&!(o=a.next()).done;)i.push(o.value)}catch(e){r={error:e}}finally{try{o&&!o.done&&(t=a.return)&&t.call(a)}finally{if(r)throw r.error}}return i},a=this&&this.__spreadArray||function(e,n,t){if(t||2===arguments.length)for(var o,r=0,a=n.length;r<a;r++)!o&&r in n||(o||(o=Array.prototype.slice.call(n,0,r)),o[r]=n[r]);return e.concat(o||Array.prototype.slice.call(n))};Object.defineProperty(n,"__esModule",{value:!0}),n.getRemovalButton=n.getValidationButton=void 0;var i,s=t(55015),u=t(50139),c=t(33682),l=t(99959);function d(e){return!!e&&!(0,s.checkIsCouponSelectorError)(e)&&"function"==typeof e.click}n.getValidationButton=function(e,n){var t=e.validationButton,r=(0,c.getElementFromSelector)(t?t.selector:void 0);if(d(r))return t&&(t.detectionStatus=s.CouponSelectorElementDetectionStatus.found),[r,t];var a=function(e){var n=f(e,i.apply,p);n.length>1&&(n=m(n,e,p));if(n.length>=1)return function(e){var n,t,r=e[0],a=0;try{for(var i=o(e),s=i.next();!s.done;s=i.next()){for(var u=s.value,c=u,l=0;c.parentElement;)c=c.parentElement,l++;l>a&&(r=u,a=l)}}catch(e){n={error:e}}finally{try{s&&!s.done&&(t=i.return)&&t.call(i)}finally{if(n)throw n.error}}return r}(n)}(n);return a?t={selector:(0,c.buildCssSelector)(a,s.CouponElementType.validationButton),selectorType:s.CouponSelectorType.automatic,detectionStatus:s.CouponSelectorElementDetectionStatus.found}:t&&(t.detectionStatus=s.CouponSelectorElementDetectionStatus.notFound),[a,t]},function(e){e[e.apply=0]="apply",e[e.remove=1]="remove"}(i||(i={}));var p=5;function f(e,n,t){for(var r,a,i=e,s=1;s<=t&&i.parentElement;s++)i=i.parentElement;var u=v(i,n);try{for(var c=o(u),l=c.next();!l.done;l=c.next()){var d=l.value;if(d.length>=1)return d}}catch(e){r={error:e}}finally{try{l&&!l.done&&(a=c.return)&&a.call(c)}finally{if(r)throw r.error}}return[]}function m(e,n,t){for(var o=n,r=1;r<=t;r++){if(!(o=o.parentElement))return[];var a=e.filter((function(e){return!!o&&o.contains(e)}));if(a.length>=1)return a}return[]}n.getRemovalButton=function(e){var n=e.selectors,t=n.removalButton;if(t){var r=(0,c.getElementFromSelector)(t.selector);if(d(r))return t.detectionStatus=s.CouponSelectorElementDetectionStatus.found,[r,t]}var a=function(e){var n=(0,c.getElementFromSelector)(e.couponField?e.couponField.selector:void 0);return(0,l.checkIsValidCouponInputFieldElement)(n)?function(e){var n=f(e,i.remove,y);(n=n.filter(h)).length>1&&(n=m(n,e,y));return n.length>0?n[0]:void 0}(n):function(){var e,n,t=v(document.body,i.remove);try{for(var r=o(t),a=r.next();!a.done;a=r.next()){var s=a.value,u=s.filter(h);if(1===s.length)return u[0]}}catch(n){e={error:n}}finally{try{a&&!a.done&&(n=r.return)&&n.call(r)}finally{if(e)throw e.error}}}()}(n);return a?[a,t={selector:(0,c.buildCssSelector)(a,s.CouponElementType.removalButton),selectorType:s.CouponSelectorType.automatic,detectionStatus:s.CouponSelectorElementDetectionStatus.found}]:(t&&(t.detectionStatus=s.CouponSelectorElementDetectionStatus.notFound),[void 0,t])};var y=7;var _=["article","product","basket","cart","item","produit","panier"];function h(e){var n,t,r=function(n){var t=e.getAttribute(n);if(!t)return"continue";var o=(0,u.convertVariableNameToReadableText)(n),r=(0,u.convertVariableNameToReadableText)(t);return l.COUPON_GENERAL_KEYWORDS.some((function(e){return o.includes(e)||r.includes(e)}))&&!_.some((function(e){return o.includes(e)||r.includes(e)}))?{value:!0}:void 0};try{for(var a=o(e.getAttributeNames()),i=a.next();!i.done;i=a.next()){var s=r(i.value);if("object"==typeof s)return s.value}}catch(e){n={error:e}}finally{try{i&&!i.done&&(t=a.return)&&t.call(a)}finally{if(n)throw n.error}}return!1}function v(e,n){return[a(a(a([],r(Array.from(e.getElementsByTagName("button"))),!1),r(Array.from(e.querySelectorAll('input[type="submit"]'))),!1),r(Array.from(e.querySelectorAll('input[type="button"]'))),!1).filter((function(e,t,o){return 1===o.length&&n===i.apply||b(e,n)})),Array.from(e.getElementsByTagName("a")).filter((function(e){var t=e.getAttribute("href");return(!t||t.length<=1)&&b(e,n)})),Array.from(e.getElementsByTagName("div")).filter((function(e){return b(e,n)})),Array.from(e.querySelectorAll('input[type="checkbox"]'))]}var g=["valider","ajouter","appliquer","confirmer","utiliser","ok","apply","submit","add"],C=["supprimer","annuler","retirer","remove","cancel","delete"];function b(e,n){if(!e.textContent)return!1;var t=n===i.apply?g:C,o=e.innerText||e.getAttribute("value")||"",r=(0,u.standardizeText)(o);return t.some((function(e){return r.includes(e)}))&&!_.some((function(e){return r.includes(e)}))}},99959:function(e,n,t){var o=this&&this.__values||function(e){var n="function"==typeof Symbol&&Symbol.iterator,t=n&&e[n],o=0;if(t)return t.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&o>=e.length&&(e=void 0),{value:e&&e[o++],done:!e}}};throw new TypeError(n?"Object is not iterable.":"Symbol.iterator is not defined.")};Object.defineProperty(n,"__esModule",{value:!0}),n.getCouponInputFieldHeuristic=n.checkIsValidCouponInputFieldElement=n.getCouponInputField=n.COUPON_GENERAL_KEYWORDS=void 0;var r=t(55015),a=t(50139),i=t(33682);function s(e){if(!e||(0,r.checkIsCouponSelectorError)(e)||"INPUT"!==e.tagName)return!1;var n=e;return!!n.type&&"text"===n.type}n.COUPON_GENERAL_KEYWORDS=["coupon","promo","discount","reduction","remise","rebate","voucher"],n.getCouponInputField=function(e){var n=e.couponField,t=(0,i.getElementFromSelector)(n?n.selector:void 0);if(s(t))return n&&(n.detectionStatus=r.CouponSelectorElementDetectionStatus.found),[t,n];var o=l(document.documentElement);return o?n={selector:(0,i.buildCssSelector)(o,r.CouponElementType.couponInputField),selectorType:r.CouponSelectorType.automatic,detectionStatus:r.CouponSelectorElementDetectionStatus.found}:n&&(n.detectionStatus=r.CouponSelectorElementDetectionStatus.notFound),[o,n]},n.checkIsValidCouponInputFieldElement=s;var u=["placeholder","aria-label"],c=["newsletter","mail","subscribe"];function l(e){var t=Array.from(e.getElementsByTagName("input")).filter((function(e){return"text"===e.type&&!e.getAttribute("readonly")&&!e.getAttribute("disabled")})),o=d(t,u,n.COUPON_GENERAL_KEYWORDS,a.standardizeText,c);return o||d(t,"all",n.COUPON_GENERAL_KEYWORDS,(function(e){return(0,a.standardizeText)((0,a.convertVariableNameToReadableText)(e))}),c)}function d(e,n,t,r,a){var i,s,u,c,l,d;void 0===a&&(a=[]);try{for(var p=o(e),f=p.next();!f.done;f=p.next()){var m=f.value,y="all"===n?m.getAttributeNames():"string"==typeof n?[n]:n,_=function(e){var n=m.getAttribute(e);if(a.some((function(e){return n&&n.includes(e)})))return{value:void 0}};try{for(var h=(u=void 0,o(y)),v=h.next();!v.done;v=h.next()){var g=_(v.value);if("object"==typeof g)return g.value}}catch(e){u={error:e}}finally{try{v&&!v.done&&(c=h.return)&&c.call(h)}finally{if(u)throw u.error}}var C=function(e){var n=m.getAttribute(e);if(!n)return"continue";var o=r(n);return t.some((function(e){return o.includes(e)}))?{value:m}:void 0};try{for(var b=(l=void 0,o(y)),S=b.next();!S.done;S=b.next()){var T=C(S.value);if("object"==typeof T)return T.value}}catch(e){l={error:e}}finally{try{S&&!S.done&&(d=b.return)&&d.call(b)}finally{if(l)throw l.error}}}}catch(e){i={error:e}}finally{try{f&&!f.done&&(s=p.return)&&s.call(p)}finally{if(i)throw i.error}}}n.getCouponInputFieldHeuristic=l},622:function(e,n,t){var o=this&&this.__values||function(e){var n="function"==typeof Symbol&&Symbol.iterator,t=n&&e[n],o=0;if(t)return t.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&o>=e.length&&(e=void 0),{value:e&&e[o++],done:!e}}};throw new TypeError(n?"Object is not iterable.":"Symbol.iterator is not defined.")};Object.defineProperty(n,"__esModule",{value:!0}),n.getPriceAmountAndCurrency=void 0;var r=t(55015),a=t(84092),i=t(50139),s=t(33682);n.getPriceAmountAndCurrency=function(e,n){void 0===n&&(n=document.documentElement);var t=e.selectors.price,u=(0,s.getElementFromSelector)(t?t.selector:void 0,n);if(!(0,r.checkIsCouponSelectorError)(u)){t&&(t.detectionStatus=r.CouponSelectorElementDetectionStatus.found);var f=(0,a.parsePriceAmountAndCurrency)(u.innerText),m=f.priceAmount,_=f.priceCurrency;if(m)return{priceAmount:m,priceCurrency:_,priceSelector:t}}if(!(u=function(e){var n,t,r=function(e){var n,t,r,a,s=[];try{for(var u=o(i.TEXT_HTML_TAGS),l=u.next();!l.done;l=u.next()){var d=l.value,p=Array.from(e.getElementsByTagName(d));try{for(var f=(r=void 0,o(p)),m=f.next();!m.done;m=f.next()){var y=m.value;y.textContent&&c((0,i.standardizeText)(y.textContent))&&s.push(y)}}catch(e){r={error:e}}finally{try{m&&!m.done&&(a=f.return)&&a.call(f)}finally{if(r)throw r.error}}}}catch(e){n={error:e}}finally{try{l&&!l.done&&(t=u.return)&&t.call(u)}finally{if(n)throw n.error}}return s}(e),a=[l,d,p,y,v,C];try{for(var s=o(a),u=s.next();!u.done;u=s.next()){var f=u.value;if(r.length<=1)break;r=f(r)}}catch(e){n={error:e}}finally{try{u&&!u.done&&(t=s.return)&&t.call(s)}finally{if(n)throw n.error}}if(r.length>=1)return r[0]}(n)))return t&&(t.detectionStatus=r.CouponSelectorElementDetectionStatus.notFound),{priceAmount:null,priceCurrency:null,priceSelector:t};t={selector:(0,s.buildCssSelector)(u,r.CouponElementType.totalPrice),selectorType:r.CouponSelectorType.automatic,detectionStatus:r.CouponSelectorElementDetectionStatus.found};var h=(0,a.parsePriceAmountAndCurrency)(u.innerText);return{priceAmount:h.priceAmount,priceCurrency:h.priceCurrency,priceSelector:t}};var u=[/^([\d,\s]+((,|\.)\d{1,2})?\s*(€|\$|£))$/,/^((€|\$|£)\s*[\d,\s]+((,|\.)\d{1,2})?)$/,/^([\d,\s]+(€|\$|£)\s*\d{1,2})$/];function c(e){return u.some((function(n){return n.test(e)}))}function l(e){for(var n={},t=0,o=0;o<e.length;o++)for(var r=0;r<e.length;r++)o!==r&&e[o].contains(e[r])&&e[o].innerText.trim()===e[r].innerText.trim()&&(n[o]=!0);for(var a in n)e.splice(Number(a)-t,1),t+=1;return e}function d(e){return e.filter((function(e){var n=(0,a.parsePriceAmountAndCurrency)(e.innerText);return n.priceAmount&&n.priceAmount>=0}))}function p(e){return e.filter(m)}var f=/(sous[-\s]?total)|(subtotal)/;function m(e){var n,t,r,a,s=window.getComputedStyle(e);if("del"===e.tagName||"line-through"===s.textDecorationLine||"none"===s.display||"visible"!==s.visibility)return!1;var u=e.parentElement;if(u)try{for(var c=o(i.TEXT_HTML_TAGS),l=c.next();!l.done;l=c.next()){var d=l.value,p=Array.from(u.getElementsByTagName(d));try{for(var m=(r=void 0,o(p)),y=m.next();!y.done;y=m.next()){var _=y.value;if(_.innerText&&f.test((0,i.standardizeText)(_.innerText)))return!1}}catch(e){r={error:e}}finally{try{y&&!y.done&&(a=m.return)&&a.call(m)}finally{if(r)throw r.error}}}}catch(e){n={error:e}}finally{try{l&&!l.done&&(t=c.return)&&t.call(c)}finally{if(n)throw n.error}}return!0}function y(e){var n,t,r,a=[];try{for(var i=o(e),s=i.next();!s.done;s=i.next()){var u=s.value,c=h(u);c&&(!r||c<r?(r=c,a=[u]):c===r&&a.push(u))}}catch(e){n={error:e}}finally{try{s&&!s.done&&(t=i.return)&&t.call(i)}finally{if(n)throw n.error}}return a.length?a:e}var _=["total","final"];function h(e,n){var t,r,a,s,u,c;void 0===n&&(n=7);for(var l=e,d=1;d<=n&&(l=l.parentElement);d++)try{for(var p=(t=void 0,o(i.TEXT_HTML_TAGS)),f=p.next();!f.done;f=p.next()){var m=f.value,y=Array.from(l.getElementsByTagName(m));try{for(var h=(a=void 0,o(y)),v=h.next();!v.done;v=h.next()){var g=v.value;try{for(var C=(u=void 0,o(_)),b=C.next();!b.done;b=C.next()){var S=b.value;if(g.innerText&&null!==g.offsetParent&&(0,i.standardizeText)(g.innerText).includes(S))return d}}catch(e){u={error:e}}finally{try{b&&!b.done&&(c=C.return)&&c.call(C)}finally{if(u)throw u.error}}}}catch(e){a={error:e}}finally{try{v&&!v.done&&(s=h.return)&&s.call(h)}finally{if(a)throw a.error}}}}catch(e){t={error:e}}finally{try{f&&!f.done&&(r=p.return)&&r.call(p)}finally{if(t)throw t.error}}}function v(e){var n,t,r,a,i=[],s=0,u=[];try{for(var c=o(e),l=c.next();!l.done;l=c.next()){var d=l.value,p=g(window.getComputedStyle(d).fontSize);p&&p>s?(s=p,i=[d]):p===s?i.push(d):void 0===p&&u.push(d)}}catch(e){n={error:e}}finally{try{l&&!l.done&&(t=c.return)&&t.call(c)}finally{if(n)throw n.error}}try{for(var f=o(u),m=f.next();!m.done;m=f.next()){var y=m.value;i.push(y)}}catch(e){r={error:e}}finally{try{m&&!m.done&&(a=f.return)&&a.call(f)}finally{if(r)throw r.error}}return i}function g(e){if(e){var n=(0,i.standardizeText)(e);if(!n.includes("em"))return Number(n.replace("px","").trim())}}function C(e){var n,t,r=[],a=0;try{for(var i=o(e),s=i.next();!s.done;s=i.next()){var u=s.value,c=Number(window.getComputedStyle(u).fontWeight);c>a?(a=c,r=[u]):c===a&&r.push(u)}}catch(e){n={error:e}}finally{try{s&&!s.done&&(t=i.return)&&t.call(i)}finally{if(n)throw n.error}}return r}},50479:function(e,n,t){var o=this&&this.__awaiter||function(e,n,t,o){return new(t||(t=Promise))((function(r,a){function i(e){try{u(o.next(e))}catch(e){a(e)}}function s(e){try{u(o.throw(e))}catch(e){a(e)}}function u(e){var n;e.done?r(e.value):(n=e.value,n instanceof t?n:new t((function(e){e(n)}))).then(i,s)}u((o=o.apply(e,n||[])).next())}))},r=this&&this.__generator||function(e,n){var t,o,r,a,i={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return a={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function s(s){return function(u){return function(s){if(t)throw new TypeError("Generator is already executing.");for(;a&&(a=0,s[0]&&(i=0)),i;)try{if(t=1,o&&(r=2&s[0]?o.return:s[0]?o.throw||((r=o.return)&&r.call(o),0):o.next)&&!(r=r.call(o,s[1])).done)return r;switch(o=0,r&&(s=[2&s[0],r.value]),s[0]){case 0:case 1:r=s;break;case 4:return i.label++,{value:s[1],done:!1};case 5:i.label++,o=s[1],s=[0];continue;case 7:s=i.ops.pop(),i.trys.pop();continue;default:if(!(r=i.trys,(r=r.length>0&&r[r.length-1])||6!==s[0]&&2!==s[0])){i=0;continue}if(3===s[0]&&(!r||s[1]>r[0]&&s[1]<r[3])){i.label=s[1];break}if(6===s[0]&&i.label<r[1]){i.label=r[1],r=s;break}if(r&&i.label<r[2]){i.label=r[2],i.ops.push(s);break}r[2]&&i.ops.pop(),i.trys.pop();continue}s=n.call(e,i)}catch(e){s=[6,e],o=0}finally{t=r=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,u])}}},a=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(n,"__esModule",{value:!0}),n.logCouponApplicationFailedEvents=n.logCouponApplicationSucceededEvents=n.logCouponApplicationFinalEvents=n.logCancelledCouponApplicationEvents=n.logCouponTestedEvent=n.logStartedCouponApplicationEvents=n.logClosedCouponWidgetEvents=n.logCouponAutomationProposalWidgetDisplayedEvents=n.checkShouldLogElementsFoundEvent=n.logCouponElementsNotFoundEvent=n.logCouponElementsFoundEvent=n.logCouponElementsDetectionMechanismStartedOnCartWebpage=void 0;var i=a(t(2543)),s=t(55015),u=t(46239),c=t(59039),l=t(23907);function d(e,n,t){var o=e.offerId,r=e.bestCoupon,a=e.basePrice,i=e.bestPrice,s=e.selectors,c=e.priceCurrency,l=e.couponApplicationProcessId,d=e.shouldUseNetworkRequestsApplication;if(r){var p=void 0!==a&&void 0!==i?Number((a-i).toFixed(2)):0,f={offerId:o,couponApplied:r.code,couponAppliedMerchantCouponId:r.merchantCouponId,amountSaved:p,currency:c,selectors:s,wereAllCouponsTested:n,couponApplicationProcessId:l,numberOfCouponsTested:t,totalNumberOfCoupons:e.coupons.length,usingNetworkRequestsApplication:d};(0,u.sendMessageToBackgroundScript)({message:"logUserEvent",data:{event:{type:"couponApplicationSucceeded",payload:f}}}),(0,u.sendMessageToBackgroundScript)({message:"logAmplitudeEvent",data:{event:{type:"Coupons - Coupon Application Succeeded",properties:f}}})}}function p(e,n,t,o){var r=e.offerId,a=e.selectors,i=e.couponApplicationProcessId,s=e.shouldUseNetworkRequestsApplication,c={offerId:r,selectors:a,isError:n,errorMessage:t,couponApplicationProcessId:i,numberOfCouponsTested:o,totalNumberOfCoupons:e.coupons.length,usingNetworkRequestsApplication:s};(0,u.sendMessageToBackgroundScript)({message:"logUserEvent",data:{event:{type:"couponApplicationFailed",payload:c}}}),(0,u.sendMessageToBackgroundScript)({message:"logAmplitudeEvent",data:{event:{type:"Coupons - Coupon Application Failed",properties:c}}})}n.logCouponElementsDetectionMechanismStartedOnCartWebpage=function(e){return o(this,void 0,void 0,(function(){var n,t,o,a;return r(this,(function(r){switch(r.label){case 0:return[4,(0,c.checkIsCartWebpageAndGetMatchData)(window.location.href)];case 1:return r.sent().isCartWebpage?(n=e.offerId,t=e.selectors,o=e.couponApplicationProcessId,a={offerId:n,selectors:t,couponApplicationProcessId:o,webpageUrl:window.location.href},(0,u.sendMessageToBackgroundScript)({message:"logUserEvent",data:{event:{type:"couponElementsDetectionMechanismStarted",active:!1,payload:a}}}),[2]):[2]}}))}))},n.logCouponElementsFoundEvent=function(e){var n=e.offerId,t=e.selectors,o=e.couponApplicationProcessId,r=e.isAutoCouponCheckoutWidgetDisplayEnabled,a=e.shouldHideAutoCouponCheckoutWidgetDueToLowSuccessRate,i={offerId:n,selectors:t,couponApplicationProcessId:o,webpageUrl:window.location.href,isAutoCouponCheckoutWidgetDisplayEnabled:r,shouldHideAutoCouponCheckoutWidgetDueToLowSuccessRate:a,isAutoCouponCheckoutWidgetSnoozed:(0,l.checkIsCouponsCheckoutWidgetSnoozed)(e)};(0,u.sendMessageToBackgroundScript)({message:"logUserEvent",data:{event:{type:"couponElementsFound",active:!1,payload:i}}})},n.logCouponElementsNotFoundEvent=function(e){return o(this,void 0,void 0,(function(){var n,t,o,a,i,s;return r(this,(function(r){switch(r.label){case 0:return[4,(0,c.checkIsCartWebpageAndGetMatchData)(window.location.href)];case 1:return r.sent().isCartWebpage?(n=e.offerId,t=e.selectors,o=e.couponApplicationProcessId,a=e.isAutoCouponCheckoutWidgetDisplayEnabled,i=e.shouldHideAutoCouponCheckoutWidgetDueToLowSuccessRate,s={offerId:n,selectors:t,couponApplicationProcessId:o,webpageUrl:window.location.href,isAutoCouponCheckoutWidgetDisplayEnabled:a,shouldHideAutoCouponCheckoutWidgetDueToLowSuccessRate:i,isAutoCouponCheckoutWidgetSnoozed:(0,l.checkIsCouponsCheckoutWidgetSnoozed)(e)},(0,u.sendMessageToBackgroundScript)({message:"logUserEvent",data:{event:{type:"couponElementsNotFound",active:!1,payload:s}}}),[2]):[2]}}))}))},n.checkShouldLogElementsFoundEvent=function(e){var n=e.selectors;return!!(n.couponField&&n.couponField.detectionStatus===s.CouponSelectorElementDetectionStatus.found||n.showCouponFieldClickableElement&&n.showCouponFieldClickableElement.detectionStatus===s.CouponSelectorElementDetectionStatus.found)},n.logCouponAutomationProposalWidgetDisplayedEvents=function(e){var n=e.offerId,t=e.selectors,o=e.couponApplicationProcessId,r=e.widgetVariant,a=e.displayedSuccessRateAutoCoupons,i=e.lastUsedAtAutoCoupons,c=(0,s.getCurrentUrlHostname)(),l={widgetType:"autoCoupon",widgetVariant:r,offerId:n,widgetDisplayedTimestampInMs:Date.now(),timeToDisplayWidgetAfterPageLoadingStart:Date.now()-performance.timeOrigin,currentUrlHostname:c,selectors:t,couponApplicationProcessId:o,displayedSuccessRateAutoCoupons:a,lastUsedAtAutoCoupons:i};(0,u.sendMessageToBackgroundScript)({message:"logUserEvent",data:{event:{type:"browserExtensionWidgetDisplayed",payload:l}}}),(0,u.sendMessageToBackgroundScript)({message:"logAmplitudeEvent",data:{event:{type:"Browser Extension - Widget Displayed",properties:l}}})},n.logClosedCouponWidgetEvents=function(e,n,t){var o={offerId:e,isTemporaryUser:n,closeButtonDisplayedText:t,widgetType:"autoCoupon"};(0,u.sendMessageToBackgroundScript)({message:"logUserEvent",data:{event:{type:"closedBrowserExtensionWidget",payload:o}}}),(0,u.sendMessageToBackgroundScript)({message:"logAmplitudeEvent",data:{event:{type:"Browser Extension - Widget Closed",properties:o}}})},n.logStartedCouponApplicationEvents=function(e,n){var t={offerId:e.offerId,selectors:e.selectors,from:n,couponApplicationProcessId:e.couponApplicationProcessId,usingNetworkRequestsApplication:e.shouldUseNetworkRequestsApplication,networkRequestsParameters:e.networkRequestsParameters,detectedCouponCrm:e.couponCrm};(0,u.sendMessageToBackgroundScript)({message:"logUserEvent",data:{event:{type:"startedCouponApplication",payload:t}}}),(0,u.sendMessageToBackgroundScript)({message:"logAmplitudeEvent",data:{event:{type:"Coupons - Started Coupon Application",properties:t}}})},n.logCouponTestedEvent=function(e,n,t){var o=e.offerId,r=e.couponIndex,a=e.isPageReloading,s=e.coupons,c=e.basePrice,l=e.webpageUrl,d=e.priceCurrency,p=e.couponApplicationProcessId,f=e.shouldUseNetworkRequestsApplication,m=e.responseParsingResult,y=s[r],_=y.merchantCouponId,h=y.code,v=y.isSelectedForReevaluation,g=t?Math.round(100*(c-t))/100:void 0,C={merchantCouponId:_,couponCode:h,isSelectedForReevaluation:v,offerId:o,totalCartPriceBeforeApplication:c,totalCartPriceAfterApplication:t,totalCartPriceCurrency:d,amountSaved:g,didCouponWork:f&&m?"successful"===m.result.type:(g||0)>0,didPageReload:!!a,positionTestedAt:r,webpageUrlBeforeApplication:n,usingNetworkRequestsApplication:f,webpageUrlAfterApplication:l,couponApplicationProcessId:p,nextCouponId:r<s.length-1?s[r+1].merchantCouponId:void 0,responseParsingResult:i.default.omit(m,"rawHtmlResponse")};(0,u.sendMessageToBackgroundScript)({message:"logUserEvent",data:{event:{type:"couponAutomaticallyTested",payload:C}}})},n.logCancelledCouponApplicationEvents=function(e){if(e.active){var n=e.active,t={offerId:n.offerId,selectors:n.selectors,couponApplicationProcessId:n.couponApplicationProcessId,usingNetworkRequestsApplication:n.shouldUseNetworkRequestsApplication};(0,u.sendMessageToBackgroundScript)({message:"logUserEvent",data:{event:{type:"cancelledCouponApplication",payload:t}}}),(0,u.sendMessageToBackgroundScript)({message:"logAmplitudeEvent",data:{event:{type:"Coupons - Cancelled Coupon Application",properties:t}}})}},n.logCouponApplicationFinalEvents=function(e){e.bestCoupon?d(e,!0,e.coupons.length):p(e,!1,void 0,e.coupons.length)},n.logCouponApplicationSucceededEvents=d,n.logCouponApplicationFailedEvents=p},21427:function(e,n,t){var o=this&&this.__assign||function(){return o=Object.assign||function(e){for(var n,t=1,o=arguments.length;t<o;t++)for(var r in n=arguments[t])Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r]);return e},o.apply(this,arguments)},r=this&&this.__awaiter||function(e,n,t,o){return new(t||(t=Promise))((function(r,a){function i(e){try{u(o.next(e))}catch(e){a(e)}}function s(e){try{u(o.throw(e))}catch(e){a(e)}}function u(e){var n;e.done?r(e.value):(n=e.value,n instanceof t?n:new t((function(e){e(n)}))).then(i,s)}u((o=o.apply(e,n||[])).next())}))},a=this&&this.__generator||function(e,n){var t,o,r,a,i={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return a={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function s(s){return function(u){return function(s){if(t)throw new TypeError("Generator is already executing.");for(;a&&(a=0,s[0]&&(i=0)),i;)try{if(t=1,o&&(r=2&s[0]?o.return:s[0]?o.throw||((r=o.return)&&r.call(o),0):o.next)&&!(r=r.call(o,s[1])).done)return r;switch(o=0,r&&(s=[2&s[0],r.value]),s[0]){case 0:case 1:r=s;break;case 4:return i.label++,{value:s[1],done:!1};case 5:i.label++,o=s[1],s=[0];continue;case 7:s=i.ops.pop(),i.trys.pop();continue;default:if(!(r=i.trys,(r=r.length>0&&r[r.length-1])||6!==s[0]&&2!==s[0])){i=0;continue}if(3===s[0]&&(!r||s[1]>r[0]&&s[1]<r[3])){i.label=s[1];break}if(6===s[0]&&i.label<r[1]){i.label=r[1],r=s;break}if(r&&i.label<r[2]){i.label=r[2],i.ops.push(s);break}r[2]&&i.ops.pop(),i.trys.pop();continue}s=n.call(e,i)}catch(e){s=[6,e],o=0}finally{t=r=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,u])}}},i=this&&this.__read||function(e,n){var t="function"==typeof Symbol&&e[Symbol.iterator];if(!t)return e;var o,r,a=t.call(e),i=[];try{for(;(void 0===n||n-- >0)&&!(o=a.next()).done;)i.push(o.value)}catch(e){r={error:e}}finally{try{o&&!o.done&&(t=a.return)&&t.call(a)}finally{if(r)throw r.error}}return i},s=this&&this.__spreadArray||function(e,n,t){if(t||2===arguments.length)for(var o,r=0,a=n.length;r<a;r++)!o&&r in n||(o||(o=Array.prototype.slice.call(n,0,r)),o[r]=n[r]);return e.concat(o||Array.prototype.slice.call(n))},u=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(n,"__esModule",{value:!0}),n.useSkippedCouponsSplit=n.useShouldSkipUnsuccessfulCouponsEnabled=n.useEnrichedMerchantCoupons=void 0;var c=u(t(96540)),l=u(t(2543)),d=t(55015),p=t(32668),f=t(46239);n.useEnrichedMerchantCoupons=function(e,n){var t=i(c.default.useState(void 0),2),s=t[0],u=t[1];return c.default.useEffect((function(){(function(e,n){var t;return r(this,void 0,void 0,(function(){var r,i,s,u;return a(this,(function(a){switch(a.label){case 0:return e?(r=(null===(t=e.browserExtension)||void 0===t?void 0:t.coupons)&&e.browserExtension.coupons.itemList||[],(s=n)?[3,2]:[4,(0,d.checkHasFeature)((0,p.checkIsOnMobileScreen)()?d.Feature.skipUnsuccessfulCouponsMobileBrowserExtension:d.Feature.skipUnsuccessfulCouponsDesktopBrowserExtension)]):[2,[]];case 1:s=a.sent(),a.label=2;case 2:return i=s,[4,(0,d.getSetting)(d.SettingKey.couponsPriorityManagementSettings)];case 3:return u=a.sent(),(0,d.checkShouldSkipUnsuccessfulCoupons)(r.length,i,u)?[2,new Promise((function(n){return(0,f.sendMessageToBackgroundScript)({message:"getEnrichedMerchantCoupons",data:{offer:e}},(function(e){n(e||r.map((function(e){return o(o({},e),{shouldSkip:!1,isSelectedForReevaluation:!1})})))}))}))]:[2,r.map((function(e){return o(o({},e),{shouldSkip:!1,isSelectedForReevaluation:!1})}))]}}))}))})(e,n).then(u)}),[e]),s},n.useShouldSkipUnsuccessfulCouponsEnabled=function(){var e=i(c.default.useState(void 0),2),n=e[0],t=e[1];return c.default.useEffect((function(){(0,d.checkHasFeature)((0,p.checkIsOnMobileScreen)()?d.Feature.skipUnsuccessfulCouponsMobileBrowserExtension:d.Feature.skipUnsuccessfulCouponsDesktopBrowserExtension).then(t)}),[]),n},n.useSkippedCouponsSplit=function(e,n){var t=i(c.default.useMemo((function(){return e&&void 0!==n?n?l.default.partition(e,(function(e){var n=e.shouldSkip,t=e.isSelectedForReevaluation;return n&&!t})):[[],s([],i(e),!1)]:[void 0,void 0]}),[e,n]),2);return{skippedCoupons:t[0],selectedCoupons:t[1]}}},42604:function(e,n,t){var o=this&&this.__awaiter||function(e,n,t,o){return new(t||(t=Promise))((function(r,a){function i(e){try{u(o.next(e))}catch(e){a(e)}}function s(e){try{u(o.throw(e))}catch(e){a(e)}}function u(e){var n;e.done?r(e.value):(n=e.value,n instanceof t?n:new t((function(e){e(n)}))).then(i,s)}u((o=o.apply(e,n||[])).next())}))},r=this&&this.__generator||function(e,n){var t,o,r,a,i={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return a={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function s(s){return function(u){return function(s){if(t)throw new TypeError("Generator is already executing.");for(;a&&(a=0,s[0]&&(i=0)),i;)try{if(t=1,o&&(r=2&s[0]?o.return:s[0]?o.throw||((r=o.return)&&r.call(o),0):o.next)&&!(r=r.call(o,s[1])).done)return r;switch(o=0,r&&(s=[2&s[0],r.value]),s[0]){case 0:case 1:r=s;break;case 4:return i.label++,{value:s[1],done:!1};case 5:i.label++,o=s[1],s=[0];continue;case 7:s=i.ops.pop(),i.trys.pop();continue;default:if(!(r=i.trys,(r=r.length>0&&r[r.length-1])||6!==s[0]&&2!==s[0])){i=0;continue}if(3===s[0]&&(!r||s[1]>r[0]&&s[1]<r[3])){i.label=s[1];break}if(6===s[0]&&i.label<r[1]){i.label=r[1],r=s;break}if(r&&i.label<r[2]){i.label=r[2],i.ops.push(s);break}r[2]&&i.ops.pop(),i.trys.pop();continue}s=n.call(e,i)}catch(e){s=[6,e],o=0}finally{t=r=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,u])}}},a=this&&this.__values||function(e){var n="function"==typeof Symbol&&Symbol.iterator,t=n&&e[n],o=0;if(t)return t.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&o>=e.length&&(e=void 0),{value:e&&e[o++],done:!e}}};throw new TypeError(n?"Object is not iterable.":"Symbol.iterator is not defined.")};Object.defineProperty(n,"__esModule",{value:!0}),n.fetchMerchantApiCouponApplicationResponse=void 0;var i=t(74137),s=t(50139),u=t(95537),c=t(98356),l=t(11046);function d(e,n){return o(this,void 0,void 0,(function(){var t,o,a,s,u,l,d;return r(this,(function(r){switch(r.label){case 0:t={formattedRequestUrlParameters:"",formattedRequestBody:null},r.label=1;case 1:return r.trys.push([1,3,,4]),o=n.requestUrlParametersFormatter,a=n.requestBodyFormatter,[4,(0,c.getCouponNetworkRequestFormattedOutputs)({couponCode:e,requestUrlParametersFormattingScript:o||'""',requestBodyFormattingScript:a||"null"})];case 2:return(s=r.sent())?(u=s.formattedRequestUrlParameters,l=s.formattedRequestBody,[2,{formattedRequestUrlParameters:u||"",formattedRequestBody:l||null}]):[2,t];case 3:return d=r.sent(),(0,i.captureSentryException)(new Error("Error while formatting network request parameters and body: ".concat(d))),[2,t];case 4:return[2]}}))}))}function p(e,n,t){var o=new URL(e.merchantApiEndpointUrl+n);return function(e,n){var t=n.csrfToken,o=n.arbitraryToken,r=l.CSRF_TOKEN_NAMES.find((function(n){return e.searchParams.has(n)}));t&&r&&e.searchParams.set(r,t);o&&e.searchParams.has(o.key)&&e.searchParams.set(o.key,o.value)}(o,t),function(e,n){var t,o,r=n.cartId;if(!r)return;var i=e.pathname.split("/"),u=[s.checkIsBase64Encoded,s.checkIsUuid],c=function(n){if(n(r)){var t=i.findIndex((function(e){return n(e)&&r.length===e.length}));return t<0?"continue":(i[t]=r,e.pathname=i.join("/"),{value:void 0})}};try{for(var l=a(u),d=l.next();!d.done;d=l.next()){var p=c(d.value);if("object"==typeof p)return p.value}}catch(e){t={error:e}}finally{try{d&&!d.done&&(o=l.return)&&o.call(l)}finally{if(t)throw t.error}}}(o,t),o.toString()}function f(e,n,t){var o={headers:y(n,t),referrer:window.location.href,method:n.method,mode:"cors",credentials:"include"};return"GET"!==n.method&&(o.body=function(e,n,t){if(!n.requestContentType||!e)return e;var o=n.requestContentType.split(";").map((function(e){return e.trim()}));if("application/x-www-form-urlencoded"===o[0]){var r=new URLSearchParams(e);return function(e,n){var t=n.jsonRpcToken,o=n.csrfToken,r=n.arbitraryToken;e.has("JSONRPC")&&function(e,n){var t=e.get("JSONRPC");if(!t)return;var o=JSON.parse(t),r=(0,s.replaceArbitrarilyNestedFieldInObject)(o,l.JSONRPC_TOKEN_NAME,n);if(!r)throw new Error("Could not find JSON RPC token in request body");e.set("JSONRPC",JSON.stringify(o))}(e,t);(function(e,n){var t,o;try{for(var r=a(l.CSRF_TOKEN_NAMES),i=r.next();!i.done;i=r.next()){var s=i.value;if(e.has(s)){if(!n)throw new Error("CSRF token not found in the merchant webpage and required in request");e.set(s,n)}}}catch(e){t={error:e}}finally{try{i&&!i.done&&(o=r.return)&&o.call(r)}finally{if(t)throw t.error}}})(e,o),r&&e.has(r.key)&&e.set(r.key,r.value)}(r,t),r.toString()}if("application/json"===o[0])try{var i=JSON.parse(e);return function(e,n){!function(e,n){var t=n.cartId,o=n.csrfToken;t&&(0,s.replaceFirstLeafFieldMatchingCriterionInObject)(e,(function(e){return function(e){var n=e.key,t=e.value,o=e.cartId;return"string"==typeof t&&t.length===o.length&&_.some((function(e){return(0,s.convertVariableNameToReadableText)(n).includes(e)}))&&(r=t,a=o,!((0,s.checkIsBase64Encoded)(r)&&!(0,s.checkIsBase64Encoded)(a)||(0,s.checkIsUuid)(r)&&!(0,s.checkIsUuid)(a)));var r,a}({key:e.key,value:e.value,cartId:t})}),t);o&&(0,s.replaceFirstLeafFieldMatchingCriterionInObject)(e,(function(e){var n=e.key;return/csrf/i.test(n)}),o)}(function(e){return e.hasOwnProperty("query")&&e.hasOwnProperty("variables")&&e.hasOwnProperty("operationName")}(e)?e.variables:e,n)}(i,t),JSON.stringify(i)}catch(e){console.error(e)}return e}(e,n,t)),o}n.fetchMerchantApiCouponApplicationResponse=function(e){var n=e.couponCode,t=e.activeState,a=e.couponRequestTokens;return o(this,void 0,void 0,(function(){var e,o,i,s,c,l;return r(this,(function(r){switch(r.label){case 0:if(e=t.networkRequestsParameters,!(o=t.couponCrm))return[3,4];r.label=1;case 1:return r.trys.push([1,3,,4]),[4,(0,u.getCouponCrmDriver)(o).applyCoupon(n)];case 2:return[2,r.sent()];case 3:return i=r.sent(),console.error(i),[3,4];case 4:if(!e)throw new Error("Invalid network requests parameters");return[4,d(n,e)];case 5:return s=r.sent(),c=s.formattedRequestUrlParameters,l=s.formattedRequestBody,[2,fetch(p(e,c,a),f(l,e,a))]}}))}))};var m=new Set(["accept-charset","accept-encoding","access-control-request-headers","access-control-request-method","connection","content-length","cookie","date","dnt","expect","host","keep-alive","origin","permission-policy","referer","te","trailer","transfer-encoding","upgrade","via","user-agent"]);function y(e,n){var t,o,r=e.requestContentType,i=e.additionalHeaders,s=n.authorizationToken,u=n.jsonRpcToken,c=n.csrfToken,l=new Headers,d=void 0,p=void 0;if(i)try{for(var f=a(i),y=f.next();!y.done;y=f.next()){var _=y.value,h=_.name,v=_.value,g=h.toLowerCase();v.startsWith("Bearer")&&s&&s.startsWith("Bearer")?d=h:m.has(g)||g.startsWith("sec-")||g.startsWith("proxy-")||l.set(h,v),/csrf/.test(g)&&(p=h)}}catch(e){t={error:e}}finally{try{y&&!y.done&&(o=f.return)&&o.call(f)}finally{if(t)throw t.error}}return r&&l.set("content-type",r),s&&(d?l.set(d,s):l.set("authorization",s)),c&&(p?l.set(p,c):l.set("x-csrf-token",c)),u&&l.set("x-csrf-token",u),l}var _=["cart","bag","basket","order"]},18345:function(e,n,t){var o=this&&this.__awaiter||function(e,n,t,o){return new(t||(t=Promise))((function(r,a){function i(e){try{u(o.next(e))}catch(e){a(e)}}function s(e){try{u(o.throw(e))}catch(e){a(e)}}function u(e){var n;e.done?r(e.value):(n=e.value,n instanceof t?n:new t((function(e){e(n)}))).then(i,s)}u((o=o.apply(e,n||[])).next())}))},r=this&&this.__generator||function(e,n){var t,o,r,a,i={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return a={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function s(s){return function(u){return function(s){if(t)throw new TypeError("Generator is already executing.");for(;a&&(a=0,s[0]&&(i=0)),i;)try{if(t=1,o&&(r=2&s[0]?o.return:s[0]?o.throw||((r=o.return)&&r.call(o),0):o.next)&&!(r=r.call(o,s[1])).done)return r;switch(o=0,r&&(s=[2&s[0],r.value]),s[0]){case 0:case 1:r=s;break;case 4:return i.label++,{value:s[1],done:!1};case 5:i.label++,o=s[1],s=[0];continue;case 7:s=i.ops.pop(),i.trys.pop();continue;default:if(!(r=i.trys,(r=r.length>0&&r[r.length-1])||6!==s[0]&&2!==s[0])){i=0;continue}if(3===s[0]&&(!r||s[1]>r[0]&&s[1]<r[3])){i.label=s[1];break}if(6===s[0]&&i.label<r[1]){i.label=r[1],r=s;break}if(r&&i.label<r[2]){i.label=r[2],i.ops.push(s);break}r[2]&&i.ops.pop(),i.trys.pop();continue}s=n.call(e,i)}catch(e){s=[6,e],o=0}finally{t=r=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,u])}}},a=this&&this.__read||function(e,n){var t="function"==typeof Symbol&&e[Symbol.iterator];if(!t)return e;var o,r,a=t.call(e),i=[];try{for(;(void 0===n||n-- >0)&&!(o=a.next()).done;)i.push(o.value)}catch(e){r={error:e}}finally{try{o&&!o.done&&(t=a.return)&&t.call(a)}finally{if(r)throw r.error}}return i},i=this&&this.__spreadArray||function(e,n,t){if(t||2===arguments.length)for(var o,r=0,a=n.length;r<a;r++)!o&&r in n||(o||(o=Array.prototype.slice.call(n,0,r)),o[r]=n[r]);return e.concat(o||Array.prototype.slice.call(n))},s=this&&this.__values||function(e){var n="function"==typeof Symbol&&Symbol.iterator,t=n&&e[n],o=0;if(t)return t.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&o>=e.length&&(e=void 0),{value:e&&e[o++],done:!e}}};throw new TypeError(n?"Object is not iterable.":"Symbol.iterator is not defined.")},u=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(n,"__esModule",{value:!0}),n.checkWasApplicationSuccessfulFromMerchantApiResponse=void 0;var c=u(t(2543)),l=t(55015),d=t(50139),p=t(99959),f=t(95537),m=[401,403,404,405,429,498,500,501];function y(e,n,t,a,i){return o(this,void 0,void 0,(function(){var o,s,u,c,l;return r(this,(function(r){switch(r.label){case 0:if(o=e.headers.get("content-type")||void 0,i&&!i.wasResponseOk&&e.ok)return[2,{responseContentType:o,type:"automatic",result:{type:"successful",decisionReason:"responseOkWithWarmupResponseNotOk"}}];if(!a)return[3,8];r.label=1;case 1:return r.trys.push([1,3,,7]),[4,(c=(0,f.getCouponCrmDriver)(a)).checkIsCouponApplicationSuccessful(e)];case 2:return u=r.sent(),[2,{responseContentType:o,type:"automatic",result:{type:u?"successful":"unsuccessful",decisionReason:"couponCrmDriver"},couponCrm:c.couponCrm}];case 3:return r.sent(),void 0!==(c=(0,f.getCouponCrmDriver)(a)).responseBody?[3,5]:[4,e.text()];case 4:return s=r.sent(),[3,6];case 5:s="string"!=typeof c.responseBody?JSON.stringify(c.responseBody):c.responseBody,r.label=6;case 6:return[3,7];case 7:return[3,10];case 8:return[4,e.text()];case 9:s=r.sent(),r.label=10;case 10:return s.length?(l=function(e){try{return JSON.parse(e)}catch(e){return}}(s),l?[2,v(o,t,l)]:o&&o.includes("text/html")?[2,C(o,s,n,t)]:[2,{responseContentType:o,type:"automatic",result:{type:"unknown",decisionReason:"unhandledResponseContentType"}}]):[2,{responseContentType:o,type:"automatic",result:e.ok?{type:"successful",decisionReason:"responseOkWithEmptyBody"}:{type:"unsuccessful",decisionReason:"responseNotOkWithEmptyBody"}}]}}))}))}n.checkWasApplicationSuccessfulFromMerchantApiResponse=function(e){var n=e.response,t=e.appliedCouponCode,a=e.activeState,i=e.warmupCouponApplicationStatus;return o(this,void 0,void 0,(function(){var e,o,s,u;return r(this,(function(r){switch(r.label){case 0:if(e=a.networkRequestsParameters,o=a.couponsNetworkRequestsSettings,s=a.couponCrm,u=e?e.responseParser:void 0,(o?o.httpErrorStatusCodesForFallback:m).includes(n.status))throw new Error("Received response with HTTP error status code: ".concat(n.status));return n.ok?u?[3,2]:[4,y(n,t,o,s,i)]:[2,{responseContentType:n.headers.get("content-type")||"",type:"automatic",result:{type:"unsuccessful",decisionReason:"responseNotOk"}}];case 1:case 3:return[2,r.sent()];case 2:return[4,O(n,u)]}}))}))};var _=[/error/i,/(in|not)\s?_?valid/i,/(in|not)\s?_?correct/i,/(un|not)\s?_?success/i,/not\s?_?applied/i],h=[/success/i,/applied/i,/valid/i,/correct/i];function v(e,n,t){var o=n?n.negativeJsonFieldDetectionRegexes.map((function(e){return new RegExp(e,"i")})):_,r=n?n.positiveJsonFieldDetectionRegexes.map((function(e){return new RegExp(e,"i")})):h,s=(0,d.getLeafFieldValuesMatchingRegexesInObject)(t,o,[]);if(1===s.length)return{responseContentType:e,type:"automatic",result:{type:s[0].fieldValue?"unsuccessful":"successful",decisionReason:"foundNegativeFieldValue",fieldName:s[0].fieldKey}};var u=(0,d.getLeafFieldValuesMatchingRegexesInObject)(t,r,o);if(1===u.length&&0===s.length)return{responseContentType:e,type:"automatic",result:{type:u[0].fieldValue?"successful":"unsuccessful",decisionReason:"foundPositiveFieldValue",fieldName:u[0].fieldKey}};if(u.length+s.length>1){var c=i(i([],a(u),!1),a(s),!1).sort(g);return u.includes(c[0])?{responseContentType:e,type:"automatic",result:{type:c[0].fieldValue?"successful":"unsuccessful",decisionReason:"foundPositiveFieldValue",fieldName:c[0].fieldKey}}:{responseContentType:e,type:"automatic",result:{type:c[0].fieldValue?"unsuccessful":"successful",decisionReason:"foundNegativeFieldValue",fieldName:c[0].fieldKey}}}return{responseContentType:e,type:"automatic",result:{type:"unknown",decisionReason:"noFieldMatched"}}}function g(e,n){return i=e.fieldValue,s=n.fieldValue,("boolean"==typeof i&&"boolean"!=typeof s?-1:"boolean"!=typeof i&&"boolean"==typeof s?1:null===i&&null!==s?-1:null===s&&null!==i?1:"string"==typeof i&&"string"!=typeof s?-1:"string"!=typeof i&&"string"==typeof s?1:0)||(t=e.fieldKey,o=n.fieldKey,r=d.BASE_COUPON_ELEMENTS_KEYWORDS.some((function(e){return t.includes(e)})),a=d.BASE_COUPON_ELEMENTS_KEYWORDS.some((function(e){return o.includes(e)})),r&&!a?-1:!r&&a?1:0);var t,o,r,a,i,s}function C(e,n,t,o){var r=document.createElement("html");r.innerHTML=n,r.style.display="none",document.body.appendChild(r);var i=b(r,t)||(0,p.getCouponInputFieldHeuristic)(r),s=function(e,n){var t=e.indexOf(n);if(-1===t)return;var o=e.substring(t-w,t+w);return _.some((function(e){return e.test(o)}))}(n,t);if(s)return document.body.removeChild(r),{responseContentType:e,rawHtmlResponse:n,type:"automatic",result:{type:"unsuccessful",decisionReason:"errorLikeMessageFound"}};if(!i)return document.body.removeChild(r),{responseContentType:e,rawHtmlResponse:n,type:"automatic",result:{type:"successful",decisionReason:"noElementFound"}};var u=void 0!==S(i,(function(e){return function(e){return E.some((function(n){return n.test(e.className)}))}(e)||function(e,n){var t=getComputedStyle(e);if(!t)return!1;var o=t.getPropertyValue("color");return r=I,i=o,s=a(A(r),3),u=s[0],c=s[1],l=s[2],d=a(A(i),3),p=d[0],f=d[1],m=d[2],Math.sqrt(Math.pow(u-p,2)+Math.pow(c-f,2)+Math.pow(l-m,2))<(n?n.errorRgbEuclideanDistanceToPureRedThreshold:T);var r,i,s,u,c,l,d,p,f,m}(e,o)}));return u?(document.body.removeChild(r),{responseContentType:e,rawHtmlResponse:n,type:"automatic",result:{type:"unsuccessful",decisionReason:"foundErrorLikeElement"}}):(document.body.removeChild(r),{responseContentType:e,rawHtmlResponse:n,type:"automatic",result:{type:"successful",decisionReason:"noErrorLikeMessageFound"}})}function b(e,n){var t,o;if(e.textContent&&e.textContent.includes(n)){if(!e.children.length)return e;try{for(var r=s(Array.from(e.children)),a=r.next();!a.done;a=r.next()){var i=b(a.value,n);if(i)return i}}catch(e){t={error:e}}finally{try{a&&!a.done&&(o=r.return)&&o.call(r)}finally{if(t)throw t.error}}}}function S(e,n,t){var o,r;if(void 0===t&&(t=4),t&&e){if(n(e))return e;var a=function(e){if(!e)return[];var n=e.parentElement;return n?Array.from(n.children):[]}(e);try{for(var i=s(a),u=i.next();!u.done;u=i.next()){var c=u.value;if(c.parentElement){var l=1===c.parentElement.children.length?t:t-1,d=S(c.parentElement,n,l);if(d)return d}}}catch(e){o={error:e}}finally{try{u&&!u.done&&(r=i.return)&&r.call(i)}finally{if(o)throw o.error}}}}var T=25,I="rgb(255, 0, 0)";function A(e){var n=e.replace(/[^\d,]/g,"").split(",");return 3!==n.length?[255,255,255]:n.map((function(e){return parseInt(e)}))}var E=[/error/i,/warning/i,/invalid/i,/incorrect/i];var w=1e3;function O(e,n){return o(this,void 0,void 0,(function(){var t,o,a;return r(this,(function(r){switch(r.label){case 0:return t=e.headers.get("content-type")||"",[4,e.text()];case 1:switch(o=r.sent(),a=t.includes("text/html")?o:void 0,n.type){case l.CouponResponseParserType.objectPath:return[2,{type:"manual",responseContentType:t,rawHtmlResponse:a,responseParser:n,result:{type:c.default.get(JSON.parse(o),n.value)?"successful":"unsuccessful"}}];case l.CouponResponseParserType.successfulApplicationDetectionRegex:return[2,{type:"manual",responseContentType:t,rawHtmlResponse:a,responseParser:n,result:{type:new RegExp(n.value).test(o)?"successful":"unsuccessful"}}];case l.CouponResponseParserType.unsuccessfulApplicationDetectionRegex:return[2,{type:"manual",responseContentType:t,rawHtmlResponse:a,responseParser:n,result:{type:new RegExp(n.value).test(o)?"unsuccessful":"successful"}}]}return[2]}}))}))}},98356:function(e,n,t){var o=this&&this.__awaiter||function(e,n,t,o){return new(t||(t=Promise))((function(r,a){function i(e){try{u(o.next(e))}catch(e){a(e)}}function s(e){try{u(o.throw(e))}catch(e){a(e)}}function u(e){var n;e.done?r(e.value):(n=e.value,n instanceof t?n:new t((function(e){e(n)}))).then(i,s)}u((o=o.apply(e,n||[])).next())}))},r=this&&this.__generator||function(e,n){var t,o,r,a,i={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return a={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function s(s){return function(u){return function(s){if(t)throw new TypeError("Generator is already executing.");for(;a&&(a=0,s[0]&&(i=0)),i;)try{if(t=1,o&&(r=2&s[0]?o.return:s[0]?o.throw||((r=o.return)&&r.call(o),0):o.next)&&!(r=r.call(o,s[1])).done)return r;switch(o=0,r&&(s=[2&s[0],r.value]),s[0]){case 0:case 1:r=s;break;case 4:return i.label++,{value:s[1],done:!1};case 5:i.label++,o=s[1],s=[0];continue;case 7:s=i.ops.pop(),i.trys.pop();continue;default:if(!(r=i.trys,(r=r.length>0&&r[r.length-1])||6!==s[0]&&2!==s[0])){i=0;continue}if(3===s[0]&&(!r||s[1]>r[0]&&s[1]<r[3])){i.label=s[1];break}if(6===s[0]&&i.label<r[1]){i.label=r[1],r=s;break}if(r&&i.label<r[2]){i.label=r[2],i.ops.push(s);break}r[2]&&i.ops.pop(),i.trys.pop();continue}s=n.call(e,i)}catch(e){s=[6,e],o=0}finally{t=r=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,u])}}};Object.defineProperty(n,"__esModule",{value:!0}),n.getCouponNetworkRequestFormattedOutputs=n.injectScriptAndReplaceExistingOne=n.InjectedScriptElement=void 0;var a,i=t(55015),s=t(17621),u=t(62849),c=t(33682);function l(e){var n=e.couponCode,t=e.requestUrlParametersFormattingScript,o=e.requestBodyFormattingScript;return new Promise((function(e,r){var a=(0,s.getHashedElementId)(s.JokoExtensionRootElement.couponNetworkRequestFormatterSandboxedIframe),i=document.getElementById(a),u=null==i?void 0:i.contentWindow;if(!u)return e(void 0);var c=setTimeout((function(){e(void 0),window.removeEventListener("message",l)}),2e3),l=function(n){var t=n.data,o=t.type,a=t.formattedRequestUrlParameters,i=t.formattedRequestBody,s=t.error;o&&"jokoFormatterSandboxedIframeResponse"===o&&(s&&r(s),e({formattedRequestUrlParameters:a,formattedRequestBody:i}),clearTimeout(c),window.removeEventListener("message",l))};window.addEventListener("message",l);var d={type:"jokoFormatterSandboxedIframeRequest",couponCode:n,requestUrlParametersFormattingScript:t,requestBodyFormattingScript:o};u.postMessage(d,"*")}))}function d(e){var n=e.couponCode,t=e.requestUrlParametersFormattingScript,o=e.requestBodyFormattingScript,r=function(e,n){return new Function('const couponCode = "'.concat(e,'";\n                return ').concat(n,";"))()};return{formattedRequestUrlParameters:r(n,t),formattedRequestBody:r(n,o)}}!function(e){e.countPendingRequests="countPendingRequests",e.captureHeadersAuthorizationToken="captureHeadersAuthorizationToken",e.capturePrestashopJavascriptObject="capturePrestashopJavascriptObject",e.checkOpenCartJavascriptVariablesExist="checkOpenCartJavascriptVariablesExist"}(a=n.InjectedScriptElement||(n.InjectedScriptElement={})),n.injectScriptAndReplaceExistingOne=function(e){return o(this,void 0,void 0,(function(){var n,t,o,l,d;return r(this,(function(r){switch(r.label){case 0:return[4,(0,u.getExtensionType)()];case 1:return n=r.sent(),t=(0,s.getHashedElementId)(e),o=(0,c.getElementFromSelector)("#".concat(t)),(0,i.checkIsCouponSelectorError)(o)||o.remove(),l=document.createElement("script"),n===i.ExtensionType.desktopChromeExtension?l.src=(0,i.getExtensionAssetUrl)("assets/".concat(e,"CouponScript.js")):(d=function(e){switch(e){case a.countPendingRequests:return"(function () {\n                        var container = document.querySelector('#jokoCountPendingRequestsDataContainer');\n                        if (!container) {\n                            container = document.createElement('div');\n                            container.setAttribute('id', 'jokoCountPendingRequestsDataContainer');\n                            document.body.appendChild(container);\n                        }\n                        var proxied = window.XMLHttpRequest.prototype.send;\n                        window.XMLHttpRequest.prototype.send = function () {\n                            var element = document.createElement('div');\n                            element.classList.add('jokoCountPendingRequestsDataContainer');\n                            container.appendChild(element);\n                            var pointer = this;\n                            var intervalId = window.setInterval(function () {\n                                if (pointer.readyState != XMLHttpRequest.DONE) {\n                                    return;\n                                }\n                                element.remove();\n                                clearInterval(intervalId);\n                            }, 100);\n                            return proxied.apply(this, [].slice.call(arguments));\n                        };\n                        const oldFetch = window.fetch;\n                        window.fetch = function (...arguments) {\n                            var element = document.createElement('div');\n                            return Promise.resolve(arguments)\n                                .then(function (args) {\n                                    container.appendChild(element);\n                                    return args;\n                                })\n                                .then(function (args) {\n                                    return oldFetch.apply(this, args);\n                                })\n                                .then(function (response) {\n                                    element.remove();\n                                    return response;\n                                })\n                                .catch(function (error) {\n                                    element.remove();\n                                    throw error;\n                                });\n                        };\n                    })();\n                    ";case a.captureHeadersAuthorizationToken:return"(function () {\n                        const localStorageItem = localStorage.getItem('jokoExtensionTokenData');\n                        if (localStorageItem) {\n                            try {\n                                const localStorageItemObject = JSON.parse(localStorageItem);\n                                if (\n                                    localStorageItemObject.lastRefreshedTimestampMs &&\n                                    Date.now() - localStorageItemObject.lastRefreshedTimestampMs < 1000 * 60 * 30\n                                )\n                                    return;\n                            } catch (error) {\n                                console.error(error);\n                            }\n                        }\n                        const oldFetch = window.fetch;\n                        window.fetch = function (...arguments) {\n                            return Promise.resolve(arguments)\n                                .then(function (arguments) {\n                                    if (arguments.length > 1 && arguments[1] && arguments[1].headers) {\n                                        const token =\n                                            arguments[1].headers['Authorization'] ||\n                                            arguments[1].headers['authorization'];\n                                        if (token)\n                                            localStorage.setItem(\n                                                'jokoExtensionTokenData',\n                                                JSON.stringify({\n                                                    token,\n                                                    lastRefreshedTimestampMs: Date.now(),\n                                                })\n                                            );\n                                    }\n                                    return arguments;\n                                })\n                                .then(function (arguments) {\n                                    return oldFetch.apply(this, arguments).then((response) => {\n                                        if (response.headers && response.headers.has('authorization'))\n                                            localStorage.setItem(\n                                                'jokoExtensionTokenData',\n                                                JSON.stringify({\n                                                    token: response.headers.get('authorization'),\n                                                    lastRefreshedTimestampMs: Date.now(),\n                                                })\n                                            );\n                                        return response;\n                                    });\n                                });\n                        };\n                    })();\n                    ";case a.capturePrestashopJavascriptObject:return"(function () {\n                        const broadcastChannel = new BroadcastChannel('jokoPrestaShopJavascriptObjectChannel');\n                        if (window.prestashop) broadcastChannel.postMessage(window.prestashop.cart);\n                        else broadcastChannel.postMessage(undefined);\n                    })();\n                    ";case a.checkOpenCartJavascriptVariablesExist:return"(function () {\n                        const broadcastChannel = new BroadcastChannel(\n                            'jokoAreOpenCartJavascriptVariablesDefinedChannel'\n                        );\n                        broadcastChannel.postMessage(!!(window.cart && window.voucher));\n                    })();\n                    "}}(e),l.appendChild(document.createTextNode(d)),l.type="text/javascript"),l.id=t,document.body.appendChild(l),[2]}}))}))},n.getCouponNetworkRequestFormattedOutputs=function(e){var n=e.couponCode,t=e.requestUrlParametersFormattingScript,a=e.requestBodyFormattingScript;return o(this,void 0,void 0,(function(){return r(this,(function(e){switch(e.label){case 0:return[4,(0,u.getExtensionType)()];case 1:return e.sent()!==i.ExtensionType.desktopChromeExtension?[3,3]:[4,new Promise((function(e){var n=(0,s.getHashedElementId)(s.JokoExtensionRootElement.couponNetworkRequestFormatterSandboxedIframe);if(document.getElementById(n))return e();var t=document.createElement("iframe");t.id=n,t.style.display="none",t.src=(0,i.getExtensionAssetUrl)("assets/couponNetworkRequestFormatterSandboxedIframe.html"),t.onload=function(){return e()},document.documentElement.append(t)}))];case 2:return e.sent(),[2,l({couponCode:n,requestUrlParametersFormattingScript:t,requestBodyFormattingScript:a})];case 3:return[2,d({couponCode:n,requestUrlParametersFormattingScript:t,requestBodyFormattingScript:a})]}}))}))}},13103:function(e,n,t){var o=this&&this.__awaiter||function(e,n,t,o){return new(t||(t=Promise))((function(r,a){function i(e){try{u(o.next(e))}catch(e){a(e)}}function s(e){try{u(o.throw(e))}catch(e){a(e)}}function u(e){var n;e.done?r(e.value):(n=e.value,n instanceof t?n:new t((function(e){e(n)}))).then(i,s)}u((o=o.apply(e,n||[])).next())}))},r=this&&this.__generator||function(e,n){var t,o,r,a,i={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return a={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function s(s){return function(u){return function(s){if(t)throw new TypeError("Generator is already executing.");for(;a&&(a=0,s[0]&&(i=0)),i;)try{if(t=1,o&&(r=2&s[0]?o.return:s[0]?o.throw||((r=o.return)&&r.call(o),0):o.next)&&!(r=r.call(o,s[1])).done)return r;switch(o=0,r&&(s=[2&s[0],r.value]),s[0]){case 0:case 1:r=s;break;case 4:return i.label++,{value:s[1],done:!1};case 5:i.label++,o=s[1],s=[0];continue;case 7:s=i.ops.pop(),i.trys.pop();continue;default:if(!(r=i.trys,(r=r.length>0&&r[r.length-1])||6!==s[0]&&2!==s[0])){i=0;continue}if(3===s[0]&&(!r||s[1]>r[0]&&s[1]<r[3])){i.label=s[1];break}if(6===s[0]&&i.label<r[1]){i.label=r[1],r=s;break}if(r&&i.label<r[2]){i.label=r[2],i.ops.push(s);break}r[2]&&i.ops.pop(),i.trys.pop();continue}s=n.call(e,i)}catch(e){s=[6,e],o=0}finally{t=r=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,u])}}},a=this&&this.__read||function(e,n){var t="function"==typeof Symbol&&e[Symbol.iterator];if(!t)return e;var o,r,a=t.call(e),i=[];try{for(;(void 0===n||n-- >0)&&!(o=a.next()).done;)i.push(o.value)}catch(e){r={error:e}}finally{try{o&&!o.done&&(t=a.return)&&t.call(a)}finally{if(r)throw r.error}}return i};Object.defineProperty(n,"__esModule",{value:!0}),n.sleepUntilRemovalButtonElementIsFoundWithTimeout=n.sleepUntilNoPendingRequestsAndUntilAllCouponElementsAreFoundWithTimeout=n.runCallbackOnPageFinishedLoading=n.sleepUntilNoPendingRequests=n.executeDelayedCallback=n.SELECTORS_POST_PAGE_RELOAD_CHECK_VALIDITY_DELAY_IN_MS=n.NETWORK_REQUESTS_POST_PAGE_RELOAD_CHECK_VALIDITY_DELAY_IN_MS=n.SELECTORS_POST_COUPON_APPLICATION_DELAY_IN_MS=n.COUPON_APPLICATION_PAGE_RELOAD_TIMEOUT_IN_MS=n.NETWORK_REQUESTS_POST_COUPON_APPLICATION_DELAY_IN_MS=n.FILL_COUPON_INPUT_FIELD_DELAY_IN_MS=n.REMOVAL_BUTTON_POST_CLICK_DELAY_IN_MS=n.SHOW_COUPON_FIELD_CLICKABLE_ELEMENT_POST_CLICK_DELAY_IN_MS=n.COUPON_ELEMENTS_INSPECTION_TIMEOUT_IN_MS=n.COUPON_AUTOMATION_INSPECT_INTERVAL_IN_MS=void 0;var i=t(55015),s=t(74137),u=t(33682),c=t(18045),l=t(91958);n.COUPON_AUTOMATION_INSPECT_INTERVAL_IN_MS=2e3,n.COUPON_ELEMENTS_INSPECTION_TIMEOUT_IN_MS=2500,n.SHOW_COUPON_FIELD_CLICKABLE_ELEMENT_POST_CLICK_DELAY_IN_MS=125,n.REMOVAL_BUTTON_POST_CLICK_DELAY_IN_MS=125,n.FILL_COUPON_INPUT_FIELD_DELAY_IN_MS=125,n.NETWORK_REQUESTS_POST_COUPON_APPLICATION_DELAY_IN_MS=100,n.COUPON_APPLICATION_PAGE_RELOAD_TIMEOUT_IN_MS=2e3,n.SELECTORS_POST_COUPON_APPLICATION_DELAY_IN_MS=500,n.NETWORK_REQUESTS_POST_PAGE_RELOAD_CHECK_VALIDITY_DELAY_IN_MS=150,n.SELECTORS_POST_PAGE_RELOAD_CHECK_VALIDITY_DELAY_IN_MS=750;function d(e){return new Promise((function(n){return setTimeout(n,e)}))}function p(e){return o(this,void 0,void 0,(function(){var n;return r(this,(function(t){switch(t.label){case 0:return[4,d(e)];case 1:return t.sent(),o=(0,u.getElementFromSelector)("#".concat(f)),null===(n=(0,i.checkIsCouponSelectorError)(o)?null:o.childElementCount)?[2,Promise.reject(new Error("Pending requests are not being counted."))]:n>0?[2,p(100)]:[2,Promise.resolve()]}var o}))}))}n.executeDelayedCallback=function(e,n,t){return o(this,void 0,void 0,(function(){var o;return r(this,(function(r){switch(r.label){case 0:return(o=Date.now())-n<e?[4,d(e-(o-n))]:[3,2];case 1:r.sent(),r.label=2;case 2:return t(),[2]}}))}))},n.sleepUntilNoPendingRequests=p;var f="jokoCountPendingRequestsDataContainer";n.runCallbackOnPageFinishedLoading=function(e,n){if(n||"complete"!==document.readyState)var t=setInterval((0,s.withSentry)((function(){"complete"===document.readyState&&(clearInterval(t),e())})),25);else e()},n.sleepUntilNoPendingRequestsAndUntilAllCouponElementsAreFoundWithTimeout=function(e,n,t){return o(this,void 0,void 0,(function(){var o,a,i,s;return r(this,(function(r){switch(r.label){case 0:return[4,p(n)];case 1:r.sent(),o=Date.now(),r.label=2;case 2:return a=(0,c.checkDoCouponElementsExistAndUpdateSelectors)(e),i=a.selectors,s=a.doCouponElementsExist,e.selectors=i,s?[2]:[4,d(100)];case 3:r.sent(),r.label=4;case 4:if(Date.now()-o<t)return[3,2];r.label=5;case 5:return[2]}}))}))},n.sleepUntilRemovalButtonElementIsFoundWithTimeout=function(e,n){return o(this,void 0,void 0,(function(){var t,o,i,s;return r(this,(function(r){switch(r.label){case 0:t=Date.now(),r.label=1;case 1:return o=a((0,l.getRemovalButton)(e),2),i=o[0],s=o[1],i?(e.selectors.removalButton=s,[2]):[4,d(100)];case 2:r.sent(),r.label=3;case 3:if(Date.now()-t<n)return[3,1];r.label=4;case 4:return[2]}}))}))}},11046:function(e,n,t){var o=this&&this.__values||function(e){var n="function"==typeof Symbol&&Symbol.iterator,t=n&&e[n],o=0;if(t)return t.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&o>=e.length&&(e=void 0),{value:e&&e[o++],done:!e}}};throw new TypeError(n?"Object is not iterable.":"Symbol.iterator is not defined.")};Object.defineProperty(n,"__esModule",{value:!0}),n.getCouponTokens=n.CSRF_TOKEN_NAMES=n.JSONRPC_TOKEN_NAME=n.TOKEN_EXPIRATION_DELAY_IN_MS=n.AUTHORIZATION_TOKEN_LOCAL_STORAGE_KEY=void 0;var r=t(99959),a=t(50139),i=t(9971);n.AUTHORIZATION_TOKEN_LOCAL_STORAGE_KEY="jokoExtensionTokenData",n.TOKEN_EXPIRATION_DELAY_IN_MS=18e5,n.JSONRPC_TOKEN_NAME="_TOKEN",n.CSRF_TOKEN_NAMES=["csrf_token","CSRFToken","csrfToken","csrf"];var s=["cart id","bag id","basket id","cart token","bag token","basket token"];function u(e){return n.CSRF_TOKEN_NAMES.map((function(n){return d(n,e)})).find((function(e){return void 0!==e}))}function c(e){var t=Array.from(e.querySelectorAll('input[name*="token" i][type="hidden"]')).filter((function(e){return e.getAttribute("name")!==n.JSONRPC_TOKEN_NAME&&!n.CSRF_TOKEN_NAMES.includes(e.getAttribute("name")||"")}));if(1===t.length)return l(t[0]);var o=f(t);return 1===o.length?l(o[0]):void 0}function l(e){var n=e.getAttribute("name"),t=e.getAttribute("value");if(n&&t)return{key:n,value:t}}function d(e,n){if(void 0===n&&(n=document.documentElement),e){var t=Array.from(n.querySelectorAll('input[name="'.concat(e,'"][type="hidden"]')));if(t.length){if(1===t.length||p(t))return t[0].getAttribute("value")||void 0;var o=f(t);if(o.length)return(1===o.length||p(o))&&o[0].getAttribute("value")||void 0}}}function p(e){if(!e.length)return!0;var n=e[0].getAttribute("value");return e.every((function(e){return e.getAttribute("value")===n}))}function f(e){var n=function(e){var n=e.map((function(e){return e.closest("form")})).filter(m);if(n.length>=1)return n[0];var t=(0,r.getCouponInputFieldHeuristic)(document.documentElement);if(!t)return;var o=t.closest("form");return o||void 0}(e);return n?e.filter((function(e){return null!==e.getAttribute("value")})).filter((function(e){return n.contains(e)})):[]}function m(e){var n,t;if(!e)return!1;var r=e.getAttributeNames(),i=function(n){var t=(0,a.convertVariableNameToReadableText)(n),o=(0,a.convertVariableNameToReadableText)(e.getAttribute(n));if(a.BASE_COUPON_ELEMENTS_KEYWORDS.some((function(e){return o.includes(e)}))||a.BASE_COUPON_ELEMENTS_KEYWORDS.some((function(e){return t.includes(e)})))return{value:!0}};try{for(var s=o(r),u=s.next();!u.done;u=s.next()){var c=i(u.value);if("object"==typeof c)return c.value}}catch(e){n={error:e}}finally{try{u&&!u.done&&(t=s.return)&&t.call(s)}finally{if(n)throw n.error}}return!1}n.getCouponTokens=function(e){var t=function(){var e=localStorage.getItem(n.AUTHORIZATION_TOKEN_LOCAL_STORAGE_KEY);if(e)try{return JSON.parse(e).token}catch(e){return}}(),o=d(n.JSONRPC_TOKEN_NAME),r=function(){var e=Object.keys(localStorage),n=e.map(a.convertVariableNameToReadableText),t=e.filter((function(e,t){return s.some((function(e){return n[t].includes(e)}))}));if(1!==t.length)return;var o=localStorage.getItem(t[0]);return!o||o.length<y?void 0:o}()||function(){try{var e=(0,i.getAllCookieNames)(),n=e.map(a.convertVariableNameToReadableText),t=e.filter((function(e,t){return s.some((function(e){return n[t].includes(e)}))}));if(1!==t.length)return;var o=(0,i.getCookieValueByName)(t[0]);if(!o||o.length<y)return;return o}catch(e){return void console.error(e)}}();if(e&&e.responseContentType&&e.responseContentType.includes("text/html")&&e.rawHtmlResponse){var l=(new DOMParser).parseFromString(e.rawHtmlResponse,"text/html").documentElement;return{authorizationToken:t,jsonRpcToken:o,cartId:r,csrfToken:u(l)||u(document.documentElement),arbitraryToken:c(l)||c(document.documentElement)}}return{authorizationToken:t,jsonRpcToken:o,cartId:r,csrfToken:u(document.documentElement),arbitraryToken:c(document.documentElement)}};var y=8}}]);