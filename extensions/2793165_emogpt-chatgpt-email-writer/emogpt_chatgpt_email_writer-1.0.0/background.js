(()=>{var yr=Object.create;var ke=Object.defineProperty;var hr=Object.getOwnPropertyDescriptor;var br=Object.getOwnPropertyNames;var vr=Object.getPrototypeOf,wr=Object.prototype.hasOwnProperty;var V=(e,r)=>()=>(r||e((r={exports:{}}).exports,r),r.exports);var Tr=(e,r,t,a)=>{if(r&&typeof r=="object"||typeof r=="function")for(let s of br(r))!wr.call(e,s)&&s!==t&&ke(e,s,{get:()=>r[s],enumerable:!(a=hr(r,s))||a.enumerable});return e};var z=(e,r,t)=>(t=e!=null?yr(vr(e)):{},Tr(r||!e||!e.__esModule?ke(t,"default",{value:e,enumerable:!0}):t,e));var Oe=V((Oo,je)=>{"use strict";je.exports=()=>{let e={};return e.promise=new Promise((r,t)=>{e.resolve=r,e.reject=t}),e}});var Ce=V((So,Se)=>{"use strict";var Pr=Oe();function kr(e,r="maxAge"){let t,a,s,u=async()=>{if(t!==void 0)return;let A=async v=>{s=Pr();let N=v[1][r]-Date.now();if(N<=0){e.delete(v[0]),s.resolve();return}return t=v[0],a=setTimeout(()=>{e.delete(v[0]),s&&s.resolve()},N),typeof a.unref=="function"&&a.unref(),s.promise};try{for(let v of e)await A(v)}catch{}t=void 0},m=()=>{t=void 0,a!==void 0&&(clearTimeout(a),a=void 0),s!==void 0&&(s.reject(void 0),s=void 0)},h=e.set.bind(e);return e.set=(A,v)=>{e.has(A)&&e.delete(A);let N=h(A,v);return t&&t===A&&m(),u(),N},u(),e}Se.exports=kr});var pe=V((Co,Ee)=>{"use strict";var jr=Ce(),ue=class{constructor(r,t){if(this.maxAge=r,this[Symbol.toStringTag]="Map",this.data=new Map,jr(this.data),t)for(let[a,s]of t)this.set(a,s)}get size(){return this.data.size}clear(){this.data.clear()}delete(r){return this.data.delete(r)}has(r){return this.data.has(r)}get(r){let t=this.data.get(r);if(t)return t.data}set(r,t){return this.data.set(r,{maxAge:Date.now()+this.maxAge,data:t}),this}values(){return this.createIterator(r=>r[1].data)}keys(){return this.data.keys()}entries(){return this.createIterator(r=>[r[0],r[1].data])}forEach(r,t){for(let[a,s]of this.entries())r.apply(t,[s,a,this])}[Symbol.iterator](){return this.entries()}*createIterator(r){for(let t of this.data.entries())yield r(t)}};Ee.exports=ue});var ye=V((Ae,fr)=>{(function(e,r){if(typeof define=="function"&&define.amd)define("webextension-polyfill",["module"],r);else if(typeof Ae<"u")r(fr);else{var t={exports:{}};r(t),e.browser=t.exports}})(typeof globalThis<"u"?globalThis:typeof self<"u"?self:Ae,function(e){"use strict";if(!globalThis.chrome?.runtime?.id)throw new Error("This script should only be loaded in a browser extension.");if(typeof globalThis.browser>"u"||Object.getPrototypeOf(globalThis.browser)!==Object.prototype){let r="The message port closed before a response was received.",t=a=>{let s={alarms:{clear:{minArgs:0,maxArgs:1},clearAll:{minArgs:0,maxArgs:0},get:{minArgs:0,maxArgs:1},getAll:{minArgs:0,maxArgs:0}},bookmarks:{create:{minArgs:1,maxArgs:1},get:{minArgs:1,maxArgs:1},getChildren:{minArgs:1,maxArgs:1},getRecent:{minArgs:1,maxArgs:1},getSubTree:{minArgs:1,maxArgs:1},getTree:{minArgs:0,maxArgs:0},move:{minArgs:2,maxArgs:2},remove:{minArgs:1,maxArgs:1},removeTree:{minArgs:1,maxArgs:1},search:{minArgs:1,maxArgs:1},update:{minArgs:2,maxArgs:2}},browserAction:{disable:{minArgs:0,maxArgs:1,fallbackToNoCallback:!0},enable:{minArgs:0,maxArgs:1,fallbackToNoCallback:!0},getBadgeBackgroundColor:{minArgs:1,maxArgs:1},getBadgeText:{minArgs:1,maxArgs:1},getPopup:{minArgs:1,maxArgs:1},getTitle:{minArgs:1,maxArgs:1},openPopup:{minArgs:0,maxArgs:0},setBadgeBackgroundColor:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0},setBadgeText:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0},setIcon:{minArgs:1,maxArgs:1},setPopup:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0},setTitle:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0}},browsingData:{remove:{minArgs:2,maxArgs:2},removeCache:{minArgs:1,maxArgs:1},removeCookies:{minArgs:1,maxArgs:1},removeDownloads:{minArgs:1,maxArgs:1},removeFormData:{minArgs:1,maxArgs:1},removeHistory:{minArgs:1,maxArgs:1},removeLocalStorage:{minArgs:1,maxArgs:1},removePasswords:{minArgs:1,maxArgs:1},removePluginData:{minArgs:1,maxArgs:1},settings:{minArgs:0,maxArgs:0}},commands:{getAll:{minArgs:0,maxArgs:0}},contextMenus:{remove:{minArgs:1,maxArgs:1},removeAll:{minArgs:0,maxArgs:0},update:{minArgs:2,maxArgs:2}},cookies:{get:{minArgs:1,maxArgs:1},getAll:{minArgs:1,maxArgs:1},getAllCookieStores:{minArgs:0,maxArgs:0},remove:{minArgs:1,maxArgs:1},set:{minArgs:1,maxArgs:1}},devtools:{inspectedWindow:{eval:{minArgs:1,maxArgs:2,singleCallbackArg:!1}},panels:{create:{minArgs:3,maxArgs:3,singleCallbackArg:!0},elements:{createSidebarPane:{minArgs:1,maxArgs:1}}}},downloads:{cancel:{minArgs:1,maxArgs:1},download:{minArgs:1,maxArgs:1},erase:{minArgs:1,maxArgs:1},getFileIcon:{minArgs:1,maxArgs:2},open:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0},pause:{minArgs:1,maxArgs:1},removeFile:{minArgs:1,maxArgs:1},resume:{minArgs:1,maxArgs:1},search:{minArgs:1,maxArgs:1},show:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0}},extension:{isAllowedFileSchemeAccess:{minArgs:0,maxArgs:0},isAllowedIncognitoAccess:{minArgs:0,maxArgs:0}},history:{addUrl:{minArgs:1,maxArgs:1},deleteAll:{minArgs:0,maxArgs:0},deleteRange:{minArgs:1,maxArgs:1},deleteUrl:{minArgs:1,maxArgs:1},getVisits:{minArgs:1,maxArgs:1},search:{minArgs:1,maxArgs:1}},i18n:{detectLanguage:{minArgs:1,maxArgs:1},getAcceptLanguages:{minArgs:0,maxArgs:0}},identity:{launchWebAuthFlow:{minArgs:1,maxArgs:1}},idle:{queryState:{minArgs:1,maxArgs:1}},management:{get:{minArgs:1,maxArgs:1},getAll:{minArgs:0,maxArgs:0},getSelf:{minArgs:0,maxArgs:0},setEnabled:{minArgs:2,maxArgs:2},uninstallSelf:{minArgs:0,maxArgs:1}},notifications:{clear:{minArgs:1,maxArgs:1},create:{minArgs:1,maxArgs:2},getAll:{minArgs:0,maxArgs:0},getPermissionLevel:{minArgs:0,maxArgs:0},update:{minArgs:2,maxArgs:2}},pageAction:{getPopup:{minArgs:1,maxArgs:1},getTitle:{minArgs:1,maxArgs:1},hide:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0},setIcon:{minArgs:1,maxArgs:1},setPopup:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0},setTitle:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0},show:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0}},permissions:{contains:{minArgs:1,maxArgs:1},getAll:{minArgs:0,maxArgs:0},remove:{minArgs:1,maxArgs:1},request:{minArgs:1,maxArgs:1}},runtime:{getBackgroundPage:{minArgs:0,maxArgs:0},getPlatformInfo:{minArgs:0,maxArgs:0},openOptionsPage:{minArgs:0,maxArgs:0},requestUpdateCheck:{minArgs:0,maxArgs:0},sendMessage:{minArgs:1,maxArgs:3},sendNativeMessage:{minArgs:2,maxArgs:2},setUninstallURL:{minArgs:1,maxArgs:1}},sessions:{getDevices:{minArgs:0,maxArgs:1},getRecentlyClosed:{minArgs:0,maxArgs:1},restore:{minArgs:0,maxArgs:1}},storage:{local:{clear:{minArgs:0,maxArgs:0},get:{minArgs:0,maxArgs:1},getBytesInUse:{minArgs:0,maxArgs:1},remove:{minArgs:1,maxArgs:1},set:{minArgs:1,maxArgs:1}},managed:{get:{minArgs:0,maxArgs:1},getBytesInUse:{minArgs:0,maxArgs:1}},sync:{clear:{minArgs:0,maxArgs:0},get:{minArgs:0,maxArgs:1},getBytesInUse:{minArgs:0,maxArgs:1},remove:{minArgs:1,maxArgs:1},set:{minArgs:1,maxArgs:1}}},tabs:{captureVisibleTab:{minArgs:0,maxArgs:2},create:{minArgs:1,maxArgs:1},detectLanguage:{minArgs:0,maxArgs:1},discard:{minArgs:0,maxArgs:1},duplicate:{minArgs:1,maxArgs:1},executeScript:{minArgs:1,maxArgs:2},get:{minArgs:1,maxArgs:1},getCurrent:{minArgs:0,maxArgs:0},getZoom:{minArgs:0,maxArgs:1},getZoomSettings:{minArgs:0,maxArgs:1},goBack:{minArgs:0,maxArgs:1},goForward:{minArgs:0,maxArgs:1},highlight:{minArgs:1,maxArgs:1},insertCSS:{minArgs:1,maxArgs:2},move:{minArgs:2,maxArgs:2},query:{minArgs:1,maxArgs:1},reload:{minArgs:0,maxArgs:2},remove:{minArgs:1,maxArgs:1},removeCSS:{minArgs:1,maxArgs:2},sendMessage:{minArgs:2,maxArgs:3},setZoom:{minArgs:1,maxArgs:2},setZoomSettings:{minArgs:1,maxArgs:2},update:{minArgs:1,maxArgs:2}},topSites:{get:{minArgs:0,maxArgs:0}},webNavigation:{getAllFrames:{minArgs:1,maxArgs:1},getFrame:{minArgs:1,maxArgs:1}},webRequest:{handlerBehaviorChanged:{minArgs:0,maxArgs:0}},windows:{create:{minArgs:0,maxArgs:1},get:{minArgs:1,maxArgs:2},getAll:{minArgs:0,maxArgs:1},getCurrent:{minArgs:0,maxArgs:1},getLastFocused:{minArgs:0,maxArgs:1},remove:{minArgs:1,maxArgs:1},update:{minArgs:2,maxArgs:2}}};if(Object.keys(s).length===0)throw new Error("api-metadata.json has not been included in browser-polyfill");class u extends WeakMap{constructor(n,f=void 0){super(f),this.createItem=n}get(n){return this.has(n)||this.set(n,this.createItem(n)),super.get(n)}}let m=o=>o&&typeof o=="object"&&typeof o.then=="function",h=(o,n)=>(...f)=>{a.runtime.lastError?o.reject(new Error(a.runtime.lastError.message)):n.singleCallbackArg||f.length<=1&&n.singleCallbackArg!==!1?o.resolve(f[0]):o.resolve(f)},A=o=>o==1?"argument":"arguments",v=(o,n)=>function(l,...c){if(c.length<n.minArgs)throw new Error(`Expected at least ${n.minArgs} ${A(n.minArgs)} for ${o}(), got ${c.length}`);if(c.length>n.maxArgs)throw new Error(`Expected at most ${n.maxArgs} ${A(n.maxArgs)} for ${o}(), got ${c.length}`);return new Promise((T,k)=>{if(n.fallbackToNoCallback)try{l[o](...c,h({resolve:T,reject:k},n))}catch(i){console.warn(`${o} API method doesn't seem to support the callback parameter, falling back to call it without a callback: `,i),l[o](...c),n.fallbackToNoCallback=!1,n.noCallback=!0,T()}else n.noCallback?(l[o](...c),T()):l[o](...c,h({resolve:T,reject:k},n))})},N=(o,n,f)=>new Proxy(n,{apply(l,c,T){return f.call(c,o,...T)}}),O=Function.call.bind(Object.prototype.hasOwnProperty),b=(o,n={},f={})=>{let l=Object.create(null),c={has(k,i){return i in o||i in l},get(k,i,j){if(i in l)return l[i];if(!(i in o))return;let g=o[i];if(typeof g=="function")if(typeof n[i]=="function")g=N(o,o[i],n[i]);else if(O(f,i)){let D=v(i,f[i]);g=N(o,o[i],D)}else g=g.bind(o);else if(typeof g=="object"&&g!==null&&(O(n,i)||O(f,i)))g=b(g,n[i],f[i]);else if(O(f,"*"))g=b(g,n[i],f["*"]);else return Object.defineProperty(l,i,{configurable:!0,enumerable:!0,get(){return o[i]},set(D){o[i]=D}}),g;return l[i]=g,g},set(k,i,j,g){return i in l?l[i]=j:o[i]=j,!0},defineProperty(k,i,j){return Reflect.defineProperty(l,i,j)},deleteProperty(k,i){return Reflect.deleteProperty(l,i)}},T=Object.create(o);return new Proxy(T,c)},d=o=>({addListener(n,f,...l){n.addListener(o.get(f),...l)},hasListener(n,f){return n.hasListener(o.get(f))},removeListener(n,f){n.removeListener(o.get(f))}}),E=new u(o=>typeof o!="function"?o:function(f){let l=b(f,{},{getContent:{minArgs:0,maxArgs:0}});o(l)}),P=new u(o=>typeof o!="function"?o:function(f,l,c){let T=!1,k,i=new Promise($=>{k=function(I){T=!0,$(I)}}),j;try{j=o(f,l,k)}catch($){j=Promise.reject($)}let g=j!==!0&&m(j);if(j!==!0&&!g&&!T)return!1;let D=$=>{$.then(I=>{c(I)},I=>{let le;I&&(I instanceof Error||typeof I.message=="string")?le=I.message:le="An unexpected error occurred",c({__mozWebExtensionPolyfillReject__:!0,message:le})}).catch(I=>{console.error("Failed to send onMessage rejected reply",I)})};return D(g?j:i),!0}),S=({reject:o,resolve:n},f)=>{a.runtime.lastError?a.runtime.lastError.message===r?n():o(new Error(a.runtime.lastError.message)):f&&f.__mozWebExtensionPolyfillReject__?o(new Error(f.message)):n(f)},w=(o,n,f,...l)=>{if(l.length<n.minArgs)throw new Error(`Expected at least ${n.minArgs} ${A(n.minArgs)} for ${o}(), got ${l.length}`);if(l.length>n.maxArgs)throw new Error(`Expected at most ${n.maxArgs} ${A(n.maxArgs)} for ${o}(), got ${l.length}`);return new Promise((c,T)=>{let k=S.bind(null,{resolve:c,reject:T});l.push(k),f.sendMessage(...l)})},C={devtools:{network:{onRequestFinished:d(E)}},runtime:{onMessage:d(P),onMessageExternal:d(P),sendMessage:w.bind(null,"sendMessage",{minArgs:1,maxArgs:3})},tabs:{sendMessage:w.bind(null,"sendMessage",{minArgs:2,maxArgs:3})}},W={clear:{minArgs:1,maxArgs:1},get:{minArgs:1,maxArgs:1},set:{minArgs:1,maxArgs:1}};return s.privacy={network:{"*":W},services:{"*":W},websites:{"*":W}},b(a,C,s)};e.exports=t(chrome)}else e.exports=globalThis.browser})});var Ar=z(pe());var Or=typeof global=="object"&&global&&global.Object===Object&&global,K=Or;var Sr=typeof self=="object"&&self&&self.Object===Object&&self,Cr=K||Sr||Function("return this")(),y=Cr;var Er=y.Symbol,_=Er;var Ie=Object.prototype,Ir=Ie.hasOwnProperty,Mr=Ie.toString,G=_?_.toStringTag:void 0;function Nr(e){var r=Ir.call(e,G),t=e[G];try{e[G]=void 0;var a=!0}catch{}var s=Mr.call(e);return a&&(r?e[G]=t:delete e[G]),s}var Me=Nr;var Rr=Object.prototype,Br=Rr.toString;function Lr(e){return Br.call(e)}var Ne=Lr;var Ur="[object Null]",Dr="[object Undefined]",Re=_?_.toStringTag:void 0;function _r(e){return e==null?e===void 0?Dr:Ur:Re&&Re in Object(e)?Me(e):Ne(e)}var R=_r;function Fr(e){return e!=null&&typeof e=="object"}var F=Fr;var Wr=Array.isArray,Be=Wr;function $r(e){var r=typeof e;return e!=null&&(r=="object"||r=="function")}var J=$r;var Gr="[object AsyncFunction]",qr="[object Function]",Vr="[object GeneratorFunction]",zr="[object Proxy]";function Kr(e){if(!J(e))return!1;var r=R(e);return r==qr||r==Vr||r==Gr||r==zr}var H=Kr;var Jr=y["__core-js_shared__"],Z=Jr;var Le=function(){var e=/[^.]+$/.exec(Z&&Z.keys&&Z.keys.IE_PROTO||"");return e?"Symbol(src)_1."+e:""}();function Hr(e){return!!Le&&Le in e}var Ue=Hr;var Zr=Function.prototype,Yr=Zr.toString;function Qr(e){if(e!=null){try{return Yr.call(e)}catch{}try{return e+""}catch{}}return""}var B=Qr;var Xr=/[\\^$.*+?()[\]{}|]/g,et=/^\[object .+?Constructor\]$/,rt=Function.prototype,tt=Object.prototype,ot=rt.toString,at=tt.hasOwnProperty,st=RegExp("^"+ot.call(at).replace(Xr,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$");function nt(e){if(!J(e)||Ue(e))return!1;var r=H(e)?st:et;return r.test(B(e))}var De=nt;function it(e,r){return e?.[r]}var _e=it;function ft(e,r){var t=_e(e,r);return De(t)?t:void 0}var M=ft;var mt=M(y,"WeakMap"),Y=mt;var lt=9007199254740991;function ut(e){return typeof e=="number"&&e>-1&&e%1==0&&e<=lt}var Q=ut;function pt(e){return e!=null&&Q(e.length)&&!H(e)}var Fe=pt;var dt=Object.prototype;function gt(e){var r=e&&e.constructor,t=typeof r=="function"&&r.prototype||dt;return e===t}var X=gt;var ct="[object Arguments]";function xt(e){return F(e)&&R(e)==ct}var de=xt;var We=Object.prototype,At=We.hasOwnProperty,yt=We.propertyIsEnumerable,ht=de(function(){return arguments}())?de:function(e){return F(e)&&At.call(e,"callee")&&!yt.call(e,"callee")},$e=ht;function bt(){return!1}var Ge=bt;var ze=typeof exports=="object"&&exports&&!exports.nodeType&&exports,qe=ze&&typeof module=="object"&&module&&!module.nodeType&&module,vt=qe&&qe.exports===ze,Ve=vt?y.Buffer:void 0,wt=Ve?Ve.isBuffer:void 0,Tt=wt||Ge,Ke=Tt;var Pt="[object Arguments]",kt="[object Array]",jt="[object Boolean]",Ot="[object Date]",St="[object Error]",Ct="[object Function]",Et="[object Map]",It="[object Number]",Mt="[object Object]",Nt="[object RegExp]",Rt="[object Set]",Bt="[object String]",Lt="[object WeakMap]",Ut="[object ArrayBuffer]",Dt="[object DataView]",_t="[object Float32Array]",Ft="[object Float64Array]",Wt="[object Int8Array]",$t="[object Int16Array]",Gt="[object Int32Array]",qt="[object Uint8Array]",Vt="[object Uint8ClampedArray]",zt="[object Uint16Array]",Kt="[object Uint32Array]",p={};p[_t]=p[Ft]=p[Wt]=p[$t]=p[Gt]=p[qt]=p[Vt]=p[zt]=p[Kt]=!0;p[Pt]=p[kt]=p[Ut]=p[jt]=p[Dt]=p[Ot]=p[St]=p[Ct]=p[Et]=p[It]=p[Mt]=p[Nt]=p[Rt]=p[Bt]=p[Lt]=!1;function Jt(e){return F(e)&&Q(e.length)&&!!p[R(e)]}var Je=Jt;function Ht(e){return function(r){return e(r)}}var He=Ht;var Ze=typeof exports=="object"&&exports&&!exports.nodeType&&exports,q=Ze&&typeof module=="object"&&module&&!module.nodeType&&module,Zt=q&&q.exports===Ze,ge=Zt&&K.process,Yt=function(){try{var e=q&&q.require&&q.require("util").types;return e||ge&&ge.binding&&ge.binding("util")}catch{}}(),ce=Yt;var Ye=ce&&ce.isTypedArray,Qt=Ye?He(Ye):Je,Qe=Qt;function Xt(e,r){return function(t){return e(r(t))}}var Xe=Xt;var eo=Xe(Object.keys,Object),er=eo;var ro=Object.prototype,to=ro.hasOwnProperty;function oo(e){if(!X(e))return er(e);var r=[];for(var t in Object(e))to.call(e,t)&&t!="constructor"&&r.push(t);return r}var rr=oo;var ao=M(y,"Map"),ee=ao;var so=M(y,"DataView"),re=so;var no=M(y,"Promise"),te=no;var io=M(y,"Set"),oe=io;var tr="[object Map]",fo="[object Object]",or="[object Promise]",ar="[object Set]",sr="[object WeakMap]",nr="[object DataView]",mo=B(re),lo=B(ee),uo=B(te),po=B(oe),go=B(Y),L=R;(re&&L(new re(new ArrayBuffer(1)))!=nr||ee&&L(new ee)!=tr||te&&L(te.resolve())!=or||oe&&L(new oe)!=ar||Y&&L(new Y)!=sr)&&(L=function(e){var r=R(e),t=r==fo?e.constructor:void 0,a=t?B(t):"";if(a)switch(a){case mo:return nr;case lo:return tr;case uo:return or;case po:return ar;case go:return sr}return r});var ir=L;var co="[object Map]",xo="[object Set]",Ao=Object.prototype,yo=Ao.hasOwnProperty;function ho(e){if(e==null)return!0;if(Fe(e)&&(Be(e)||typeof e=="string"||typeof e.splice=="function"||Ke(e)||Qe(e)||$e(e)))return!e.length;var r=ir(e);if(r==co||r==xo)return!e.size;if(X(e))return!rr(e).length;for(var t in e)if(yo.call(e,t))return!1;return!0}var xe=ho;var he=z(ye());async function mr(){let{provider:e="ChatGPT"}=await he.default.storage.local.get("provider"),r=`emoProvider:${"OpenAI"}`,t=await he.default.storage.local.get(r);return{provider:e,configs:{["OpenAI"]:t[r]}}}var gr=z(pe());var ae,bo=new Uint8Array(16);function be(){if(!ae&&(ae=typeof crypto<"u"&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto),!ae))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return ae(bo)}var x=[];for(let e=0;e<256;++e)x.push((e+256).toString(16).slice(1));function lr(e,r=0){return(x[e[r+0]]+x[e[r+1]]+x[e[r+2]]+x[e[r+3]]+"-"+x[e[r+4]]+x[e[r+5]]+"-"+x[e[r+6]]+x[e[r+7]]+"-"+x[e[r+8]]+x[e[r+9]]+"-"+x[e[r+10]]+x[e[r+11]]+x[e[r+12]]+x[e[r+13]]+x[e[r+14]]+x[e[r+15]]).toLowerCase()}var vo=typeof crypto<"u"&&crypto.randomUUID&&crypto.randomUUID.bind(crypto),ve={randomUUID:vo};function wo(e,r,t){if(ve.randomUUID&&!r&&!e)return ve.randomUUID();e=e||{};let a=e.random||(e.rng||be)();if(a[6]=a[6]&15|64,a[8]=a[8]&63|128,r){t=t||0;for(let s=0;s<16;++s)r[t+s]=a[s];return r}return lr(a)}var se=wo;function ur(e){let r,t,a,s,u,m,h;return A(),{feed:v,reset:A};function A(){r=!0,t="",a=0,s=-1,u=void 0,m=void 0,h=""}function v(O){t=t?t+O:O,r&&To(t)&&(t=t.slice(pr.length)),r=!1;let b=t.length,d=0,E=!1;for(;d<b;){E&&(t[d]===`
`&&++d,E=!1);let P=-1,S=s,w;for(let C=a;P<0&&C<b;++C)w=t[C],w===":"&&S<0?S=C-d:w==="\r"?(E=!0,P=C-d):w===`
`&&(P=C-d);if(P<0){a=b-d,s=S;break}else a=0,s=-1;N(t,d,S,P),d+=P+1}d===b?t="":d>0&&(t=t.slice(d))}function N(O,b,d,E){if(E===0){h.length>0&&(e({type:"event",id:u,event:m||void 0,data:h.slice(0,-1)}),h="",u=void 0),m=void 0;return}let P=d<0,S=O.slice(b,b+(P?E:d)),w=0;P?w=E:O[b+d+1]===" "?w=d+2:w=d+1;let C=b+w,W=E-w,o=O.slice(C,C+W).toString();if(S==="data")h+=o?"".concat(o,`
`):`
`;else if(S==="event")m=o;else if(S==="id"&&!o.includes("\0"))u=o;else if(S==="retry"){let n=parseInt(o,10);Number.isNaN(n)||e({type:"reconnect-interval",value:n})}}}var pr=[239,187,191];function To(e){return pr.every((r,t)=>e.charCodeAt(t)===r)}async function*dr(e){let r=e.getReader();try{for(;;){let{done:t,value:a}=await r.read();if(t)return;yield a}}finally{r.releaseLock()}}async function ne(e,r){let{onMessage:t,...a}=r,s=await fetch(e,a);if(!s.ok){let m=await s.json().catch(()=>({}));throw new Error(xe(m)?`${s.status} ${s.statusText}`:JSON.stringify(m))}let u=ur(m=>{m.type==="event"&&t(m.data)});for await(let m of dr(s.body)){let h=new TextDecoder().decode(m);u.feed(h)}}async function Pe(e,r,t,a){return fetch(`https://chat.openai.com/backend-api${t}`,{method:r,headers:{"Content-Type":"application/json",Authorization:`Bearer ${e}`},body:a===void 0?void 0:JSON.stringify(a)})}async function cr(e,r){await Pe(e,"POST","/conversation/message_feedback",r)}async function Po(e,r,t){await Pe(e,"PATCH",`/conversation/${r}`,t)}var we="accessToken",Te=new gr.default(10*1e3);async function fe(){if(Te.get(we))return Te.get(we);let e=await fetch("https://chat.openai.com/api/auth/session");if(e.status===403)throw new Error("CLOUDFLARE");let r=await e.json().catch(()=>({}));if(!r.accessToken)throw new Error("UNAUTHORIZED");return Te.set(we,r.accessToken),r.accessToken}var ie=class{constructor(r){this.token=r;this.token=r}async fetchModels(){return(await Pe(this.token,"GET","/models").then(t=>t.json())).models}async getModelName(){try{return(await this.fetchModels())[0].slug}catch(r){return console.error(r),"text-davinci-002-render"}}async generateAnswer(r){let t,a=()=>{t&&Po(this.token,t,{is_visible:!1})},s=await this.getModelName();return console.debug("Using model:",s),await ne("https://chat.openai.com/backend-api/conversation",{method:"POST",signal:r.signal,headers:{"Content-Type":"application/json",Authorization:`Bearer ${this.token}`},body:JSON.stringify({action:"next",messages:[{id:se(),role:"user",content:{content_type:"text",parts:[r.prompt]}}],model:s,parent_message_id:se()}),onMessage(u){if(console.debug("sse message",u),u==="[DONE]"){r.onEvent({type:"done"}),a();return}let m;try{m=JSON.parse(u)}catch(A){console.error(A);return}let h=m.message?.content?.parts?.[0];h&&(t=m.conversation_id,r.onEvent({type:"answer",data:{text:h,messageId:m.message.id,conversationId:m.conversation_id}}))}}),{cleanup:a}}};var me=class{constructor(r,t){this.token=r;this.model=t;this.token=r,this.model=t}async generateAnswer(r){let t="";return await ne("https://api.openai.com/v1/chat/completions",{method:"POST",signal:r.signal,headers:{"Content-Type":"application/json",Authorization:`Bearer ${this.token}`},body:JSON.stringify({model:this.model,messages:[{role:"user",content:r.prompt}],stream:!0,max_tokens:500}),onMessage(a){if(console.debug("sse message",a),a==="[DONE]"){r.onEvent({type:"done"});return}let s;try{s=JSON.parse(a);let u=s.choices[0]&&s.choices[0].delta&&s.choices[0].delta.content||"";if(u==="undefined"||u==="<|im_end|>"||u==="<|im_sep|>")return;t+=u,r.onEvent({type:"answer",data:{text:t,messageId:s.id,conversationId:s.id}})}catch(u){console.error(u);return}}}),{}}};var U=z(ye());var xr="gpt-3.5-turbo";var Ks=new Ar.default(10*1e3);async function ko(e,r){let t=await mr(),a;if(t.provider==="ChatGPT"){let m=await fe();a=new ie(m)}else if(t.provider==="OpenAI"){let{apiKey:m}=t.configs["OpenAI"];a=new me(m,xr)}else throw new Error(`Unknown provider ${t.provider}`);let s=new AbortController;e.onDisconnect.addListener(()=>{s.abort(),u?.()});let{cleanup:u}=await a.generateAnswer({prompt:r,signal:s.signal,onEvent(m){if(m.type==="done"){e.postMessage({event:"DONE"});return}e.postMessage(m.data)}})}U.default.runtime.onConnect.addListener(e=>{e.onMessage.addListener(async r=>{try{await ko(e,r.question)}catch(t){console.error(t),e.postMessage({error:t.message})}})});U.default.runtime.onMessage.addListener(async e=>{if(e.type==="FEEDBACK"){let r=await fe();await cr(r,e.data)}else if(e.type==="OPEN_OPTIONS_PAGE")U.default.runtime.openOptionsPage();else if(e.type==="GET_ACCESS_TOKEN")return fe()});U.default.runtime.onInstalled.addListener(function(e){e.reason==="install"&&U.default.runtime.openOptionsPage()});U.default.runtime.setUninstallURL("https://forms.gle/oYjwQ4uzyJHo7TsTA");})();
