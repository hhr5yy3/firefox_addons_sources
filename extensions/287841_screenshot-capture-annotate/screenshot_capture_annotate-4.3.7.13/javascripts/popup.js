var Bg=chrome.extension.getBackgroundPage(),camDevices=[],baseURL="https://www.awesomescreenshot.com",isSignIn=!1,meter=null,rafID=null,volumeStream=null,premiumLevel=0,prepareInterval=null,mediaDevices=null,haveAudioDevices=!1,haveVideoDevices=!1,isAllowedMic=!1,isAllowedCam=!1,availableAudioDevices=[],availableVideoDevices=[],isWin=navigator.platform&&navigator.platform.includes("Win"),shortcutTxt="Ctrl+"+(isWin?"Alt":"Shift")+"+";function sendMessageToTab(e,t,s){return browser.tabs.sendMessage(e,t,{frameId:0}).then((e=>{s&&s(e)})).catch((e=>{}))}function getCurrentTab(e,t){chrome.tabs.query(Object.assign({active:!0},e),(function(e){t(e[0])}))}"true"===localStorage["dark-mode"]&&$("body").addClass("dark-mode"),sendMessageBG({action:"isCapturing"},(e=>{e&&switchView("capturing-view")}));var recordingTimer=null;function updateTime(){$("#recording-view").find(".time").text(Bg.recordingTime)}chrome.cookies.getAll({url:"https://www.awesomescreenshot.com"},(function(e){if(e){for(var t=0,s=e.length;t<s;t++)if("screenshot_personal_fullname"===e[t].name)var r=decodeURI(e[t].value);else if("screenshot_personal_type"===e[t].name)var o=e[t].value;else if("screenshot_personal_premium_level"===e[t].name)var a=e[t].value;a?premiumLevel=a:$.ajax({method:"GET",url:"https://www.awesomescreenshot.com/api/v1/user/einfo"}).done((function(e){premiumLevel=e.data.premiumLevel})),r?(isSignIn=!0,$(".aws-info").find(".user-name").text(r).attr("title",r),$(".aws-user").show(),$(".aws-login").hide(),$(".more-links").show()):($(".aws-user").hide(),$(".aws-login").show()),"0"==o?$(".aws-user").removeClass("premium"):void 0===o?($(".aws-premium-icon").hide(),$(".aws-upgrade").hide()):$(".aws-user").addClass("premium")}})),"record"===localStorage.popupTab&&$(".tab-header").addClass("default-record"),chrome.windows.getCurrent((function(e){getCurrentTab({windowId:e.id},(function(t){chrome.browserAction.getBadgeText({tabId:t.id},(function(t){"New"==t&&(chrome.browserAction.setBadgeText({text:""}),chrome.tabs.create({url:"https://blog.awesomescreenshot.com/2020/07/24/updates-on-awesome-screenshot-add-on-for-firefox/"}),localStorage.newClickVersion=Bg.newClickVersion,e.close())}))}))})),$("#stop-entire-capture").on("click",(function(){getCurrentTab({currentWindow:!0},(function(e){sendMessageToTab(e.id,{action:"stop-entire-capture"})}))})),"record"===localStorage.popupTab&&$(".tab-header-item[data-tab='record']").trigger("click"),$(".action-btn").on("click",(function(){var e=$(this);e.hasClass("option")?(chrome.tabs.create({url:"/option-react.html"}),window.close()):e.hasClass("feedback")?(chrome.tabs.create({url:"/feedback.html"}),window.close()):e.hasClass("more")&&(e.toggleClass("expand"),$(".more-links").toggle())})),$(".more-links-item").on("click",(function(){var e=$(this);if(e.hasClass("mp"))var t=baseURL+"/getProjectList";else if(e.hasClass("mv"))t=baseURL+"/myVideos";else if(e.hasClass("logout"))t=baseURL+"/user/loginOut";chrome.tabs.create({url:t}),window.close()})),$("#popup-sign-in-btn").on("click",(function(){let e=$(this).attr("redirect_url");chrome.tabs.create({url:"https://www.awesomescreenshot.com/user/login?redirect_url="+e}),window.close()})),$(".popup").find(".close").on("click",(function(){$(this).parents(".popup").hide()}));var url,enableSelected=!0;function updatePageEle(){switchView("recording-view"),recordingTimer=setInterval(updateTime,100),Bg.isRecordingPaused?($("#recording-view").find(".recording-action").addClass("paused"),Bg.isRecordingPausedError?$("#recording-error").show():$("#recording-error").hide()):$("#recording-error").hide()}function addShortcut(){let e=localStorage.msObj;if(e&&e.length>0){var t=JSON.parse(e),s=1==t.visible.enable?shortcutTxt+t.visible.key:"Not set",r=1==t.selected.enable?shortcutTxt+t.selected.key:"Not set",o=1==t.entire.enable?shortcutTxt+t.entire.key:"Not set";$("#visible").find(".shortcut").remove().end().append("<span class='shortcut'>"+s+"</span>"),$("#selected").find(".shortcut").remove().end().append("<span class='shortcut'>"+r+"</span>"),$("#entire").find(".shortcut").remove().end().append("<span class='shortcut'>"+o+"</span>")}}function i18n(){$(".i18n").each((function(){var e=this.id;$(this).html(chrome.i18n.getMessage(e.replace(/-/,"")))})),$(".title").each((function(){var e=this.id;$(this).attr({title:chrome.i18n.getMessage(e.replace(/-/,"")+"_title")})}))}function switchView(e){$(".layout-view").hide(),$("#"+e).show()}function capturing(){$("ul").remove(),$(".aws-account, .sep").hide(),$("#capturing").fadeIn("slow")}function sendMessageBG(e,t){return browser.runtime.sendMessage(e).then(t).catch((e=>{}))}function showPopup(e){$("#"+e).show()}i18n(),addShortcut(),!localStorage.capture_desktop||localStorage.capture_desktop,chrome.tabs.query({active:!0,currentWindow:!0},(function(e){var t=e[0];(null==(url=t.url).match(/https?:\/\/*\/*/gi)||url.match(/https:\/\/chrome.google.com\/extensions/i)||url.match(/https:\/\/addons.mozilla.org/i))&&$("#selected, #delay, #entire").attr({title:"Not available in this page."}).addClass("disabled").unbind("click"),"complete"!=t.status&&($("#selected").attr({title:"Page still loading! Please wait."}).addClass("disabled"),enableSelected=!1)})),chrome.runtime.onMessage.addListener((function(e,t,s){switch(e.action){case"enable_selected":if(url.match(/https:\/\/*\/*/gi))return void $("#selected").attr({title:"For security reason, Capture Selected Area doesn't work in https pages!"});enableSelected=!0,$("#selected").attr({title:""}).css({color:"#000"});break;case"stopRecord":case"closeWin":window.close();break;case"entireCaptureProgress":$("#entire-progress-percentage").text(e.percentage),$("#entire-progress").css("width",e.percentage),e.scrollNum&&e.scrollNum>=1&&$("#stop-msg").show()}})),$(".logo").click((()=>{chrome.tabs.create({url:"https://www.awesomescreenshot.com"}),window.close()})),$("a").click((function(){var e=this.id;if("visible"==e&&sendMessageBG({action:e},(()=>{Bg&&Bg.loggerEvent("capture visible","capture"),window.close()})),"delay"!=e){if("entire"==e&&sendMessageBG({action:e},(()=>{switchView("capturing-view"),Bg&&Bg.loggerEvent("capture entire","capture")})),"selected"==e){let t=()=>{Bg&&Bg.loggerEvent("capture selected","capture"),window.close()};sendMessageBG(enableSelected?{action:e}:{action:"https"},t)}if("upload"==e){var t=chrome.runtime.getURL("")+"upload.html";chrome.tabs.create({url:t}),Bg&&Bg.loggerEvent("capture local","capture"),window.close()}if("screen"==e||"camera"==e){t="https://www.awesomescreenshot.com/recorder?from=ext&show=false&type="+e;if(!isSignIn)return $(".popup[data-name=sign-in]").show(),void $("#popup-sign-in-btn").attr("redirect_url",encodeURIComponent(t));sendMessageBG({action:"recordTabBackup"},(()=>{chrome.tabs.create({url:t}),window.close()}))}if("option"==e){t=chrome.runtime.getURL("")+"option-react.html";chrome.tabs.create({url:t}),window.close()}if("help"==e){t=chrome.runtime.getURL("")+"feedback.html";chrome.tabs.create({url:t}),window.close()}"log-out"==e&&(chrome.tabs.create({url:"https://www.awesomescreenshot.com/user/loginOut"}),window.close()),"aws-login"==e&&(chrome.tabs.create({url:"https://www.awesomescreenshot.com/user/login"}),window.close()),"aws-info-upgrade"==e&&(Bg.loggerEvent("upgrade from main menu","upgrade"),chrome.tabs.create({url:"https://www.awesomescreenshot.com/pricing?from=extMenu"}),window.close())}else sendMessageBG({action:e},(()=>{Bg&&Bg.loggerEvent("capture delay","capture"),window.close()}))}));