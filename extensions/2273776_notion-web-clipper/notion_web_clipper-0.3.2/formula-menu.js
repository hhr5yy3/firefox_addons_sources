(window.webpackJsonp=window.webpackJsonp||[]).push([[4],{1150:function(e,t,n){"use strict";var r=n(0),o=n.n(r),a=n(3),i=n(184),s=n(8),l=n(14),c=n(76);class p extends a.a{renderComponent(){return o.a.createElement(i.a,{style:{display:"flex",marginLeft:-6},className:"notion-print-ignore",href:this.props.href,external:!0,onClick:()=>l.B(this.environment,{from:this.props.analyticsFrom})},o.a.createElement(c.a,{icon:s.a.help,isSmall:!0,isLightGray:!0},this.props.title))}}t.a=p},2362:function(e,t,n){"use strict";n.r(t);n(15),n(11);var r=n(0),o=n.n(r),a=n(344),i=n(16);class s extends i.a{getInitialState(){return{value:"",html:"",query:""}}}var l=s,c=n(3),p=n(2),u=n.n(p),m=n(40),d=n(560),h=n(410),y=n(492),f=n(23),g=n(31),b=n(307),S=n(103),v=n(19),E=n(285),O=(n(160),n(168),n(1568));function x(e,t){if(!e)return"";const n=function e(t,n){if(!t)return;if("conditional"===t.type)return new C.expression.node.ConditionalNode(e(t.condition,n),e(t.true,n),e(t.false,n));if("constant"===t.type)return new C.expression.node.ConstantNode(t.value,t.value_type);if("function"===t.type)return new C.expression.node.FunctionNode(new C.expression.node.SymbolNode(t.name),(t.args||[]).map(t=>e(t,n)));if("operator"===t.type)return new C.expression.node.OperatorNode(t.operator,t.name,(t.args||[]).map(t=>e(t,n)));if("property"===t.type){const e=n[t.id],r=e?e.name:t.name;return new C.expression.node.FunctionNode("prop",[new C.expression.node.ConstantNode(r,"string")])}if("symbol"===t.type)return new C.expression.node.SymbolNode(t.name)}(e,t);if(!n)return"";const r=n.toString({parenthesis:"auto",handler:(e,t)=>{if(e.isOperatorNode&&"not"===e.fn)return"not ".concat(e.args[0].toString(t))}});return r.replace(/\n/g,"\\n").replace(/\t/g,"\\t")}const C=n.n(O).a.create();C.import(n(1570)),C.import(n(1319)),C.import(n(1571)),C.import(n(1572));const w=Object(g.k)(y.c,e=>e.value),k=Object(g.k)(y.h,e=>e.apply),j=Object(g.k)(y.e,e=>e.apply);C.import(w,{override:!0}),C.import(k,{override:!0}),C.import(j,{override:!0}),C.config({predictable:!0});var M=n(2180),T=n.n(M),P=n(115);function I(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function N(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?I(Object(n),!0).forEach((function(t){L(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):I(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function L(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function D(e,t,n){const r=e.replace(/\\n/g,"\n").replace(/\\t/g,"\t");if(""===r.trim())return;let o;try{o=T.a.parse(r)}catch({message:a}){return{type:"error",message:a,size:1}}return function e(t,n,r){if(!t)return;if(t.isAccessorNode||t.isArrayNode||t.isAssignmentNode||t.isBlockNode||t.isFunctionAssignmentNode||t.isIndexNode||t.isObjectNode||t.isRangeNode)return{type:"error",size:1,message:"Invalid syntax: ".concat(t.toString().nodeString)};if(t.isConditionalNode){const o=e(t.condition,n,r),a=e(t.trueExpr,n,r),i=e(t.falseExpr,n,r);if(!o)return;if("error"===o.type)return o;if(a&&"error"===a.type)return a;if(i&&"error"===i.type)return i;if(a&&i)return a.result_type!==i.result_type?{type:"error",size:1,message:"Each branch of a condition must be of the same type: ".concat(t.toString().nodeString)}:{type:"conditional",result_type:a.result_type,condition:o,true:a,false:i}}else{if(t.isConstantNode){const{value:e,valueType:n}=t,r={string:"text",number:"number",boolean:"checkbox"};return n in r?{type:"constant",result_type:r[n],value:e.toString(),value_type:n}:{type:"error",size:1,message:"Illegal constant: ".concat(e,".")}}if(t.isFunctionNode){const{fn:o,args:a}=t;if("prop"===o.name){if(1!==a.length)return{type:"error",size:1,message:"Too many arguments passed to prop()."};const e=a[0];if(!e.isConstantNode||"string"!==e.valueType)return{type:"error",size:1,message:"Invalid property reference: ".concat(e.toString().nodeString)};const t=e.value,o=Object.keys(r).find(e=>{const n=r[e];return Boolean(n&&n.name===t)}),i=o&&r[o];if(!o||!i)return{type:"error",size:1,message:"Property not found: prop('".concat(t,"')")};if("formula"===i.type){const{formula:e}=i;if(!e||!e.result_type)return;return Object(h.a)(e).includes(n)?{type:"error",size:1,message:"Property ".concat(i.name," creates a circular dependency.")}:{type:"property",result_type:Object(h.b)(i),name:t,id:o}}return{type:"property",result_type:Object(h.b)(i),name:t,id:o}}const i=y.f(o.name)||y.g(o.name);if(!i)return{type:"error",size:1,message:"Undefined function: ".concat(o.name)};const s=u.a.compact((a||[]).map(t=>e(t,n,r))),l=z({functionName:o.name,functionArgs:s,signatures:i.signatures,schema:r});return l.error?l.error:{type:"function",result_type:l.value.resultType,name:o.name,args:s}}if(t.isOperatorNode){const{op:o,fn:a,args:i}=t,s=y.g(a);if(!s)return{type:"error",size:1,message:"Undefined operator: ".concat(o)};const l=u.a.compact((i||[]).map(t=>e(t,n,r))),c=z({functionName:a,functionArgs:l,signatures:s.signatures,schema:r});return c.error?c.error:{type:"operator",result_type:c.value.resultType,operator:o,name:a,args:l}}if(t.isParenthesisNode)return e(t.content,n,r);if(t.isSymbolNode){const{name:e}=t;return e in y.c?{type:"symbol",result_type:y.c[e].resultType,name:e}:{type:"error",size:1,message:"Undefined constant: ".concat(e)}}}}(o,t,n)}function z(e){const{functionName:t,functionArgs:n,signatures:r,schema:o}=e;return r.reduce((e,r)=>{if(!e.error)return e;const a=function(e){const{functionName:t,functionArgs:n,signature:r,schema:o}=e,{arity:a,variadic:i}=r;if(i){if(!(n.length>0))return{type:"error",size:1,message:"Too few arguments in function ".concat(t,".")};{const e=u.a.compact(n.map(e=>F({resultType:i,functionArg:e,schema:o})));if(e.length>0)return N({},e[0],{size:e.length})}}if(a){if(n.length<a.length)return{type:"error",size:1,message:"Too few arguments in function ".concat(t,".")};if(n.length>a.length)return{type:"error",size:1,message:"Too many arguments in function ".concat(t,".")};const e=u.a.compact(n.map((e,t)=>F({resultType:a[t],functionArg:e,schema:o})));if(e.length>0)return N({},e[0],{size:e.length})}}({functionName:t,functionArgs:n,signature:r,schema:o});return a?e.error.size<a.size?e:{error:a}:{value:r}},{error:{type:"error",size:99,message:"No signatures found for function: ".concat(t)}})}function F(e){const{resultType:t,functionArg:n,schema:r}=e;if("error"===n.type)return n;if(t!==n.result_type){const e=x(n,r);return{type:"error",size:1,message:"Type mismatch: ".concat(e," is not a ").concat(t?P.n[t]:"undefined",".")}}}var R=n(1),W=n(6);function B(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function _(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?B(Object(n),!0).forEach((function(t){A(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):B(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function A(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}const U=Object(R.f)({placeholder:{id:"database.formula.placeholder",defaultMessage:"Type a formula"}});class q extends c.a{constructor(){super(...arguments),this.storeTypes={store:l},this.handleInputMount=e=>this.input=e,this.handleInput=e=>{const{target:{textContent:t}}=e;this.updateValue(t),g.h(this.updateTimer)&&(this.updateTimer=window.setTimeout(()=>this.executeUpdate(),q.delay))},this.handlePaste=e=>{e.preventDefault();const t=e.clipboardData.getData("text/plain");document.execCommand("insertText",!1,t)},this.handleKeyUp=e=>{this.updateSelection()},this.handleClick=e=>{this.updateSelection()},this.handleKeyDown=e=>{Object(d.a)(this.environment,e,"command+enter")&&(this.handleAccept(),e.stopPropagation())}}insertEntry(e){const{value:t}=this.stores.store.state,{name:n}=e,r=q.getCompletion(e),o=document.getSelection(),a=o.anchorOffset;let i=a,s=o.focusOffset;const l=h.e(t,a);if(l){const[e,o]=l,a=t.slice(e,o).toLowerCase();a!==r.toLowerCase().slice(0,o-e)&&a!==n.toLowerCase().slice(0,o-e)||(i=e,s=o)}if(this.input.focus(),i<s){const e=this.input.firstChild||this.input,t=document.createRange();t.setStart(e,i),t.setEnd(e,s),o.removeAllRanges(),o.addRange(t),document.execCommand("delete",!1)}document.execCommand("insertText",!1,r);const c=(s+r.length)/(this.input&&this.input.textContent&&this.input.textContent.length||0)*this.container.scrollWidth;c>this.container.scrollLeft+this.container.offsetWidth&&(this.container.scrollLeft=c-this.container.offsetWidth)}handleAccept(){this.updateTimer&&(window.clearTimeout(this.updateTimer),this.updateTimer=void 0);const{value:e}=this.stores.store.state;if(""===e.trim())this.props.onSubmit();else{const{formula:t,error:n}=this.updateFormula(e);n||this.props.onSubmit(t)}}willMount(e){super.willMount(e);const{formula:t,schema:n}=e,r=x(t,n);this.updateValue(r)}didMount(){const{device:e}=this.environment,{value:t}=this.stores.store.state;if(this.input&&(this.input.textContent=t,e.isMobile||this.input.focus(),t)){const e=document.getSelection();this.input.firstChild&&e.collapse(this.input.firstChild,t.length),this.container.scrollLeft=this.container.scrollWidth-this.container.offsetWidth}}renderComponent(){const{device:e}=this.environment,{disabled:t}=this.props,{command:n}=b.a(this.environment),{html:r}=this.stores.store.state;return o.a.createElement("div",{style:this.getWrapStyle()},o.a.createElement("div",{ref:e=>{e&&(this.container=e)},style:q.style},o.a.createElement(S.a,{capture:!t,onLeft:u.a.identity,onRight:u.a.identity,onSelectAll:u.a.identity,onRedo:u.a.identity,onUndo:u.a.identity,onToggleBold:u.a.identity,onToggleItalics:u.a.identity,onToggleCode:u.a.identity,onCut:u.a.identity,onCopy:u.a.identity,onPaste:u.a.identity,onKeypress:u.a.identity,onDelete:u.a.identity,onBackspace:u.a.identity},o.a.createElement("div",{ref:this.handleInputMount,contentEditable:!t,spellCheck:!1,autoCorrect:"off",autoCapitalize:"off",onClick:this.handleClick,onKeyUp:this.handleKeyUp,onKeyDown:this.handleKeyDown,onInput:this.handleInput,onPaste:this.handlePaste,style:this.getInputStyle()})),o.a.createElement("div",{style:this.getOverlayStyle(),dangerouslySetInnerHTML:{__html:r}})),!e.isMobile&&!t&&o.a.createElement(m.a,{renderTooltip:()=>o.a.createElement("div",null,o.a.createElement("span",null,o.a.createElement(R.a,{defaultMessage:"Accept",id:"database.formula.acceptFormulaInput.tooltip"}))," ",o.a.createElement("span",{style:{color:this.theme.mediumInvertedTextColor}},n,"+Enter")),render:t=>o.a.createElement(E.a,Object.assign({disabled:Boolean(this.stores.store.state.error),onClick:()=>this.handleAccept(),style:_({height:24,padding:"0 8px",alignSelf:"flex-end",marginRight:6,marginBottom:4},e.isMobile&&{marginRight:12})},t),o.a.createElement(R.a,{id:"database.formula.doneButton.label",defaultMessage:"Done",description:"Label for button that confirms changes to a formula."}))}))}updateValue(e){const t=""===e.trim()?this.props.disabled?"":W.a.formatMessage(U.placeholder):h.c(this.props.Prism,e);this.stores.store.setState(_({},this.stores.store.state,{html:t,value:e}))}updateSelection(){const e=document.getSelection().anchorOffset,{value:t}=this.stores.store.state,n=h.e(t,e),r=n?t.slice(n[0],n[1]):"";r!==this.stores.store.state.query&&this.stores.store.setState(_({},this.stores.store.state,{query:r}))}updateFormula(e){const{schema:t,property:n}=this.props;if(""===e.trim())return{error:void 0,formula:void 0,type:void 0};{const r=D(e,n,t);if(r&&"error"===r.type){const{message:e}=r;return{formula:void 0,error:e,type:void 0}}return{formula:r,error:void 0,type:void 0}}}executeUpdate(){const{value:e}=this.stores.store.state,{error:t,formula:n}=this.updateFormula(e);!t&&n&&this.props.onChange(n),this.updateTimer=void 0,this.stores.store.setState(_({},this.stores.store.state,{error:t}))}static getCompletion(e){const{category:t,name:n}=e;return t===y.a.property?"prop(".concat(JSON.stringify(n),")"):t===y.a.constant?n:"".concat(n,"(")}getWrapStyle(){const{device:e,WindowSizeStore:t}=this.environment;return _({display:"flex",flex:"none",background:this.theme.inputBackground,minHeight:33,borderTopLeftRadius:3,borderTopRightRadius:3},this.props.disabled&&{background:this.theme.contentBackground,borderRadius:3},{},e.isMobile&&{borderBottom:"1px solid ".concat(this.theme.regularDividerColor),background:this.theme.popoverBackground,minHeight:44,paddingLeft:t.state.paddingLeftCSS,paddingRight:t.state.paddingRightCSS})}getOverlayStyle(){const{device:e}=this.environment,{value:t}=this.stores.store.state;return _({},e.isMobile?q.mobileInputStyle:q.desktopInputStyle,{zIndex:0},""===t.trim()&&{color:this.theme.mediumTextColor},{position:void 0})}getInputStyle(){const{device:e}=this.environment,t=e.isSafari||e.isChrome?"WebkitTextFillColor":"color";return _({},e.isMobile?q.mobileInputStyle:q.desktopInputStyle,{border:"none",background:"none",[t]:""===this.stores.store.state.value?this.theme.regularTextColor:v.f.transparent,caretColor:this.theme.regularTextColor,zIndex:1,width:"100%"})}}q.delay=0,q.style={flexGrow:1,position:"relative",minWidth:0},q.desktopInputStyle={alignItems:"center",position:"absolute",minWidth:"100%",minHeight:32,margin:0,padding:0,paddingLeft:10,paddingRight:8,paddingTop:8,fontSize:13,fontFamily:f.a.fontFamily.mono,wordWrap:"break-word"},q.mobileInputStyle={alignItems:"center",position:"absolute",minWidth:"100%",minHeight:44,margin:0,paddingLeft:16,paddingRight:0,paddingTop:12,paddingBottom:12,fontSize:14,fontFamily:f.a.fontFamily.githubMono};var K=q,H=n(316),V=n(53),J=n(47),G=n(314),Y=n(170);class X extends c.a{renderDescription(){const{entry:e}=this.props;if(e){const{descriptionMessage:t,fallbackDescription:n}=e;if(t)return o.a.createElement(R.a,Object.assign({},t));if(n)return n}return null}renderComponent(){const{entry:e}=this.props;if(e){const{name:t,examples:n}=e,r=Object(h.c)(this.props.Prism,(n||[]).join("\n")),a=this.renderSyntax();return o.a.createElement("div",null,o.a.createElement("h1",{style:X.headerStyle},t),o.a.createElement("p",{style:X.textStyle},this.renderDescription()),o.a.createElement("p",{style:X.textStyle},o.a.createElement("b",null,o.a.createElement(R.a,{id:"database.formula.syntaxSection.title",defaultMessage:"Syntax",description:"Title of the section describing the syntax of a formula component. For example, for sqrt this title appears above 'sqrt(number)', and appears alongside the Examples section."}))),o.a.createElement("pre",{style:this.getCodeStyle()},Object(G.a)(a,e=>o.a.createElement("br",{key:"sep:".concat(e)}))),o.a.createElement("p",{style:X.textStyle},o.a.createElement("b",null,o.a.createElement(R.a,{id:"database.formula.examplesSection.title",defaultMessage:"Examples",description:"Title of the section listing examples ofthe syntax of a formula component. For example, for sqrt this title appears above 'sqrt(144) == 12', and appears alongside the Syntax section."}))),o.a.createElement("pre",{style:this.getCodeStyle(),dangerouslySetInnerHTML:{__html:r}}))}return o.a.createElement("div",null)}renderSyntax(){const{entry:e}=this.props;if(!e)return[];const{name:t,category:n}=e;return n===y.a.property?[o.a.createElement("span",{key:0},"prop(",JSON.stringify(t),")")]:n===y.a.constant?[o.a.createElement("span",{key:0},t)]:n===y.a.function?this.getFunctionSyntax(e):n===y.a.operator?this.getOperatorSyntax(e):[]}getFunctionSyntax(e){const{name:t}=e;return X.getSignatureNames(e).map((e,n)=>{let{variadic:r,arity:a}=e;return r?o.a.createElement("span",{key:n},t,"(",o.a.createElement("i",null,r),"...)"):o.a.createElement("span",{key:n},t,"(",Object(G.a)(a.map((e,t)=>o.a.createElement("i",{key:t},e)),e=>o.a.createElement("span",{key:"sep:".concat(e)},","," ")),")")})}getOperatorSyntax(e){const{operator:t}=e;return u.a.compact(X.getSignatureNames(e).map((e,n)=>{let{arity:r}=e;if(1===r.length){const[e]=r;return o.a.createElement("span",{key:-n-1},t," ",o.a.createElement("i",null,e))}if(2===r.length){const[e,a]=r;return o.a.createElement("span",{key:-n-1},o.a.createElement("i",null,e)," ",t," ",o.a.createElement("i",null,a))}if(3===r.length){const[e,t,a]=r;return o.a.createElement("span",{key:-n-1},o.a.createElement("i",null,e)," ","? ",o.a.createElement("i",null,t)," ",": ",o.a.createElement("i",null,a))}}).concat(this.getFunctionSyntax(e)))}static getSignatureNames(e){const{name:t,signatures:n}=e;return"if"===t?[{arity:["boolean","value","value"]}]:"format"===t||"unaryPlus"===t?[{arity:["value"]}]:"equal"===t||"unequal"===t?[{arity:["value","value"]}]:n.map(e=>{let{arity:t,variadic:n}=e;return{variadic:n?X.typeNameMap[n]:void 0,arity:t?u.a.compact(t.map(e=>X.typeNameMap[e])):[]}})}getCodeStyle(){return{paddingTop:6,paddingBottom:8,paddingLeft:10,paddingRight:10,overflowX:"scroll",background:this.theme.sidebarBackground,borderRadius:3,fontSize:13,margin:0,fontFamily:f.a.fontFamily.mono,lineHeight:1.4}}}X.typeNameMap={checkbox:"boolean",number:"number",text:"text",date:"date"},X.headerStyle={fontSize:20,margin:0,lineHeight:1,marginTop:4,marginBottom:12},X.textStyle={marginTop:8,marginBottom:8,fontSize:13,lineHeight:1.4};var Z=Object(Y.o)(Y.m.prismjs,(e,t)=>o.a.createElement(X,Object.assign({},t,{Prism:e}))),Q=n(24),$=n(154),ee=n(8),te=n(22),ne=n(34),re=n(94);function oe(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function ae(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?oe(Object(n),!0).forEach((function(t){ie(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):oe(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function ie(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}class se extends c.a{renderComponent(){const{entry:{name:e}}=this.props;return o.a.createElement(V.a,{focused:this.props.focused,onClick:this.props.onClick,onMouseEnter:this.props.onMouseEnter,icon:o.a.createElement("div",{style:ae({},H.a.defaultWrapStyle,{},this.environment.device.isMobile&&{marginLeft:14})},this.renderPropertyIcon()),title:e,right:this.renderDocumentationButtonPopup(),style:ae({},!this.environment.device.isMobile&&{paddingLeft:8,paddingRight:8}),desktopIconStyle:{marginLeft:0}})}renderDocumentationButtonPopup(){const{device:e}=this.environment;if(this.environment.device.isMobile)return o.a.createElement(J.a,{popupType:e.isMobile?J.a.PopupType.SlideUp:J.a.PopupType.Popup,renderOrigin:e=>o.a.createElement(ne.a,Object.assign({mobileFeedback:!0,style:{width:16,height:16}},e),ee.a.typesUnknownType({fill:this.theme.mediumIconColor})),render:t=>{let n;return n=e.isMobile?{menuType:te.b.MenuType.Modal,title:o.a.createElement(R.a,{defaultMessage:"Documentation",id:"database.formulaPropertyEntryMenuItem.title",description:"In this context, documentation refers to the documentation popup for formulas property values in databases."}),right:o.a.createElement(re.DoneMenuText,null),onClickRight:t.close}:{menuType:te.b.MenuType.Popup},o.a.createElement(te.b,Object.assign({},n),o.a.createElement(Q.a,null,o.a.createElement($.a,{title:o.a.createElement(Z,{entry:this.props.entry}),style:{paddingTop:10,paddingBottom:16}})))}})}renderPropertyIcon(){const{entry:e}=this.props;if(e.category===y.a.property||e.category===y.a.constant){const{resultType:t}=e;return o.a.createElement(H.a,{type:t,size:14,theme:this.theme})}if(e.category===y.a.function||e.category===y.a.operator){const{signatures:[{resultType:t}]}=e;return o.a.createElement(H.a,{type:t,size:14,theme:this.theme})}}}se.contextTypes=ae({},te.c);var le=se,ce=n(274),pe=n(14),ue=n(245),me=n(173),de=n(13),he=n(17),ye=n(1150),fe=n(133);function ge(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function be(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?ge(Object(n),!0).forEach((function(t){Se(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):ge(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function Se(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}class ve extends c.a{constructor(){super(...arguments),this.storeTypes={formulaInputStore:l,menuListStore:ue.a}}renderComponent(){const{device:e}=this.environment,{schema:t,property:n,disabled:a}=this.props,{error:i}=this.stores.formulaInputStore.state,{formula:s}=t[n],l=o.a.createElement(r.Fragment,null,o.a.createElement(Y.a,{dependency:Y.m.prismjs},e=>o.a.createElement(K,{ref:e=>{e&&(this.formulaInput=e)},Prism:e,store:this.stores.formulaInputStore,formula:s,schema:t,property:n,disabled:a,onChange:e=>this.handleInputChange(e),onSubmit:e=>this.handleInputSubmit(e)})),e.isMobile&&this.renderStatus());let c;return c=e.isMobile?{menuType:te.b.MenuType.Modal,title:o.a.createElement(R.a,{id:"database.mobileFormulaModal.title",defaultMessage:"Formula"}),left:o.a.createElement(re.CancelMenuText,null),right:i?void 0:o.a.createElement(R.a,{id:"database.mobileFormulaModal.saveButton.label",defaultMessage:"Save"}),onClickLeft:this.props.onClickCancel,onClickRight:()=>this.formulaInput.handleAccept(),header:l}:{menuType:te.b.MenuType.Popup,width:580,height:a?"none":void 0,disableScroller:!0,header:l,footer:this.renderStatus()},o.a.createElement(te.b,Object.assign({},c),!a&&this.renderContent())}renderContent(){const{device:e}=this.environment,t=this.getLibrary(),n=this.getFocusedEntry(t);return e.isMobile?o.a.createElement(a.a,{initialFocus:0,context:{blocks:[],environment:this.environment},filter:this.stores.formulaInputStore.state.query,sections:this.renderSections(t),menuListStore:this.stores.menuListStore}):o.a.createElement("div",{style:{display:"flex",flexGrow:1,overflow:"hidden",boxShadow:"\n\t\t\t\t\t\t\tinset 0 1px 0 ".concat(this.theme.regularDividerColor,",\n\t\t\t\t\t\t\tinset 0 -1px 0 ").concat(this.theme.regularDividerColor,"\n\t\t\t\t\t\t"),height:295}},o.a.createElement(me.b,{type:me.a.Y,style:{width:180,flexGrow:0,flexShrink:0}},o.a.createElement(a.a,{initialFocus:0,context:{blocks:[],environment:this.environment},filter:this.stores.formulaInputStore.state.query,sections:this.renderSections(t),menuListStore:this.stores.menuListStore,disableMouseLeaveBlur:!0})),o.a.createElement(me.b,{type:me.a.Y,style:{padding:12,boxShadow:"inset 1px 0 0 ".concat(this.theme.regularDividerColor),flexGrow:1}},o.a.createElement(Z,{entry:n})))}renderStatus(){const{device:e}=this.environment,{disabled:t}=this.props,{command:n}=b.a(this.environment),{error:r}=this.stores.formulaInputStore.state;return r?o.a.createElement("div",{style:e.isMobile?this.getMobileStatusWrapStyle():this.getDesktopStatusWrapStyle()},o.a.createElement("span",{style:be({},e.isMobile&&ve.mobileStatusStyle,{},ve.errorStatusStyle)},r),!e.isMobile&&this.renderLearnMoreLink()):e.isMobile?o.a.createElement("div",{style:this.getMobileStatusWrapStyle()},o.a.createElement("span",{style:ve.mobileStatusStyle},o.a.createElement(R.a,{defaultMessage:"No errors.",id:"database.formula.mobileNoErrors.message"}))):t?void 0:o.a.createElement("div",{style:this.getDesktopStatusWrapStyle()},o.a.createElement("span",null,o.a.createElement(R.a,{id:"database.formula.keyboardShortcutHint",defaultMessage:"{commandEnter} to accept.",description:'Caption that describes keyboard shortcut to confirm changes to a formula and close the formula editor. Appears as "⌘+Enter to accept." on Mac, Ctrl+Enter on Windows.',values:{commandEnter:o.a.createElement("span",{style:{fontWeight:f.a.fontWeight.medium}},n,"+Enter")}})),this.renderLearnMoreLink())}renderLearnMoreLink(){return o.a.createElement("div",{style:{marginLeft:"auto"}},o.a.createElement(ye.a,{title:o.a.createElement("span",{style:{fontSize:f.a.fontSize.UISmall.desktop}},o.a.createElement(R.a,{defaultMessage:"Learn more about formulas",id:"formulaPropertyMenu.learnMore.button.label"})),href:Object(fe.a)("guides.formulas"),analyticsFrom:"formula_property_menu"}))}renderSections(e){return e.map(e=>({key:e.key,title:this.props.intl.formatMessage(e.titleMessage),render:e=>o.a.createElement(Q.a,Object.assign({},e,{desktopTitleStyle:{paddingLeft:8,paddingRight:8}})),actions:e.entries.map((e,t)=>({key:this.getEntryKey(e,t),displayName:e.name,analyticsName:e.name,searchName:e.name,render:t=>o.a.createElement(le,Object.assign({},t,{entry:e})),action:()=>{this.formulaInput.insertEntry(e)},closeParentMenu:!1}))}))}handleUpdate(e,t){const{onChange:n,schema:r,property:o,analyticsFrom:a}=this.props;if(e&&"error"===e.type);else{const{type:i,name:s,number_format:l}=r[o];n({schema:be({},r,{[o]:{type:i,name:s,formula:e,number_format:l}}),close:t});const c=r[o];c&&pe.O(this.environment,{property_type:c.type,action:"formula_edit",from:a})}}getLibrary(){const{schema:e,property:t,block:n,intl:r}=this.props,o={},a=Object.keys(e).filter(e=>e!==t).map(t=>{const a=e[t];if(!a)throw new Error("Property not found.");const{name:i}=a,s=ce.b({property:t,schema:e,block:n,getRecordValue:this.getRecordValue,userTimeZone:de.m,intl:r,depth:0,resultCache:{},normalizedSchemaCache:o});return{name:i,category:y.a.property,fallbackDescription:r.formatMessage({id:"database.formula.property.description",defaultMessage:"Returns the {propertyName} property for each entry."},{propertyName:i}),resultType:h.b(a),examples:["prop(".concat(JSON.stringify(i),") == ").concat(JSON.stringify(s))]}});return[y.d(y.a.property,a),...y.b]}getFocusedEntry(e){const t=this.stores.menuListStore.state.focus.focusedKey;if(void 0!==t)for(const n of e)for(const[e,r]of n.entries.entries())if(this.getEntryKey(r,e)===t)return r}getEntryKey(e,t){return"".concat(e.name," ").concat(t)}getDesktopStatusWrapStyle(){return{display:"flex",flex:"none",alignItems:"center",fontSize:12,paddingLeft:8,paddingRight:8,height:30,color:this.theme.mediumTextColor}}getMobileStatusWrapStyle(){const{WindowSizeStore:e}=this.environment;return{display:"flex",flex:"none",alignItems:"center",fontSize:14,height:28,color:this.theme.mediumTextColor,background:this.theme.popoverBackground,boxShadow:"0 1px 0 ".concat(this.theme.regularDividerColor),paddingLeft:e.state.paddingLeftCSS,paddingRight:e.state.paddingRightCSS}}get getRecordValue(){return he.a.getCurrentBlockValueFn()}handleInputChange(e){this.handleUpdate(e,!1)}handleInputSubmit(e){this.handleUpdate(e,!0)}}ve.mobileStatusStyle={paddingLeft:16,paddingRight:16},ve.errorStatusStyle=be({color:v.f.redWithAlpha(.8)},f.a.textOverflowStyle);t.default=Object(R.g)(ve)}}]);