console.log("ESEP Crypto extension content: loading...");var CryptoExtensionContent={requestTimeout:6e4,nodes:{},configure:function(){var phCheck=document.getElementById("ExtensionCheck_EsepCryptoExtension");if(phCheck!=null){phCheck.innerText="loaded";this.listenBackgroundAnswer()}this.listenPageRequest()},listenPageRequest:function(){document.addEventListener("EsepCryptoExtensionQuery",function(event){var node=event.target;if(!node||node.nodeType!==Node.TEXT_NODE){return}var id=uuid.v4();CryptoExtensionContent.nodes[id]=node;var data=JSON.parse(node.nodeValue);data.id=id;var message={data:data};switch(data.requestType){case"CryptoHost":message.type="EsepCryptoHostMessage";break;case"UpdaterHost":message.type="EsepCryptoUpdaterHostMessage";break;case"Tab":message.type="EsepTabRequestMessage";break;case"Init":this.listenBackgroundAnswer();this.sendAnswerToPage(id,false,{success:true});return}data.requestType=null;if(data.tabId!=null&&data.tabId!==""){message.tabId=data.tabId;data.tabId=null}browser.runtime.sendMessage(message);setTimeout(function(){CryptoExtensionContent.sendAnswerToPage(id,true)},CryptoExtensionContent.requestTimeout)},false,true)},sendAnswerToPage:function(id,fromTimeChecker,data){var node=CryptoExtensionContent.nodes[id];if(node==null){return}node.nodeValue=JSON.stringify(fromTimeChecker?CryptoExtensionContent.getFailed():data);var doc=node.ownerDocument;var event=doc.createEvent("HTMLEvents");event.initEvent("EsepCryptoExtensionResponse",true,false);node.dispatchEvent(event);CryptoExtensionContent.nodes[id]=null},getFailed:function(){return{success:"0",message:"ExtensionTimeoutError"}},listenBackgroundAnswer:function(){browser.runtime.onMessage.addListener(function(request,sender,sendResponse){if(request.type!=="EsepCryptoHostAnswer"){return true}CryptoExtensionContent.sendAnswerToPage(request.id,false,request.data);return true})}};CryptoExtensionContent.configure();console.log("ESEP Crypto extension content: loaded.");