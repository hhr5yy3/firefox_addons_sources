import{d,c as s,a,t as c,F as n,e as l,r as u,o as t,_ as m,b as p}from"../plugin-vue:export-helper.QJ_DnVAA.js";import{d as y,b as r}from"../config.eBkZtza0.js";import{t as f,m as g,c as v,a as A}from"../charly.DEUjx20x.js";import{c as P,r as k}from"../permissions.DBd3mbHa.js";function C(){return r.runtime.getManifest().version}const b=d({name:"App",data:()=>({lastPatids:[],charlyAvailable:null,intervalId:0,loading:!1,version:"",requestPermissionRequired:!1}),computed:{shownPatIds(){return this.lastPatids?this.lastPatids.slice(-5).reverse():[]}},async mounted(){if(console.log("[helper] Hello from popup"),this.version=C(),console.log("[helper] version",this.version),this.checkPermissionStatus(),this.checkCharlyStatus(),this.intervalId=window.setInterval(()=>{this.checkCharlyStatus()},y),r&&r.storage&&r.storage.local){let e=await r.storage.local.get("lastPatids");this.lastPatids=e.lastPatids,r.storage.onChanged.addListener(async()=>{let i=await r.storage.local.get("lastPatids");this.lastPatids=i.lastPatids,console.log("[helper] new patids",i)})}else console.warn("[helper] no storage")},methods:{async checkPermissionStatus(){this.requestPermissionRequired=!await P()},async installPermission(){try{await k(),this.refreshCharlyStatus()}catch(e){console.error("[helper] permission request failed",e)}finally{this.checkPermissionStatus()}},async refreshCharlyStatus(){this.loading=!0;try{await this.checkCharlyStatus()}catch{}this.loading=!1},async checkCharlyStatus(){try{await f(),this.charlyAvailable=!0}catch{this.charlyAvailable=!1}},async openPat(e){g(v(A(e)))}},beforeDestroy(){clearInterval(this.intervalId)}}),w="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABMAAAATCAYAAAByUDbMAAAAAXNSR0IArs4c6QAAAjRJREFUOBG9VEFrE1EQ/t7bt9vGSGiwxCJoVWoRLFTRn1CoglfBi1BBqVJpT3rxF4i3WizaYL1799AevQi2YiGI4JaW6knRQ7C1Ibvv+c0LJYFsEr04sJvJzvd9OzNvZhVa7fnmKKLwNqy92Pq4zVeBg8YCvoUruD+0exBX3lmMSzicf42kfgFwGs4dxDv/Kg3oYA/OljF1fE6ACvOf+zCQ+4gkOd2Z2SWitePLF3BzeFbhxdYDvuERS5M3kWXX4PCzC50hKcieJ67kcYH5jX09aGCiCZbHONOGncbUiSX+6V3ns7UQUekLyzzKRHKIkssGaTrh1SWreu1TV6FyPMLsj+BHtYLp8V0s73wgd5KCpAUzbLZtHIJX7HHTwRuy3mKwcK+BdE2uS5XpQQdebj+GVaMw6iESaSyNLc/iZYstbw0x7Tyqta+wuEb2MCfmVZZA6zPperuFh1agVIxC/1UGM7NoJwHZmUk1vqK/md6mbHZmzfg/ef9BTHFoZYiTlJnx9MV3XG4x8SWeYQZab7M/JxuDp/Me4+x1WF1EX34DCQfZ2QEE3zfgCuvEF5HkKiLLq+jxiq517xWneJGLescfWmBi2GQOqf3lQd1u2pyDVk9hmb3SsgJnFcrxGMLcO6T1fs+VtfJ72k2JMRGRNRILo3XcOHZJ49ZIhYG7CMJ9n7mAUi5+r8vvI/tnok3U1RXRbO5WeWcMRs/wgzHJ5T8lwY6m+A0z0Spxq6juPcHsmZpg/wAmeMt88LzSAAAAAABJRU5ErkJggg==",S={class:"info"},I={class:"logo-and-name"},J=a("img",{class:"logo",src:w},null,-1),R=a("span",null,"rose-helper",-1),B={id:"version"},L=a("p",null,"Bitte erlauben Sie Zugriff auf rose.",-1),q={key:0,id:"charly-verbindung-ok"},V={key:1,id:"charly-verbindung-nok"},z={key:1},E={key:2},F={class:"patList"},G=["onClick"];function M(e,i,_,H,U,Y){return t(),s("div",S,[a("div",I,[J,a("h3",null,[R,a("span",B,c(e.version),1)])]),e.requestPermissionRequired?(t(),s(n,{key:0},[L,a("div",{class:"requestPermissionsButton",type:"button",onClick:i[0]||(i[0]=(...o)=>e.installPermission&&e.installPermission(...o))},"Zugriff auf rose erlauben")],64)):(t(),s(n,{key:1},[e.loading?(t(),s("div",z,"Lädt..")):(t(),s("div",{key:0,id:"charly-connection",onClick:i[1]||(i[1]=(...o)=>e.refreshCharlyStatus&&e.refreshCharlyStatus(...o))},[e.charlyAvailable?(t(),s("div",q,"charly erreichbar")):l("",!0),e.charlyAvailable===!1?(t(),s("div",V,"charly nicht erreichbar")):l("",!0)])),e.shownPatIds.length?(t(),s("h5",E,"Patient öffnen")):l("",!0),a("div",F,[(t(!0),s(n,null,u(e.shownPatIds,(o,h)=>(t(),s("div",{class:"patItem",key:h,onClick:O=>e.openPat(o)},"Patient ID: "+c(o),9,G))),128))])],64))])}const Z=m(b,[["render",M]]);p(Z).mount("#app");
