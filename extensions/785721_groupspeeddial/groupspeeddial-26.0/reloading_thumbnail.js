"use strict";(globalThis.webpackChunkgroup_speed_dial=globalThis.webpackChunkgroup_speed_dial||[]).push([[241],{1879:(e,t,a)=>{a.d(t,{e:()=>_});var i=a(4323),n=a(5076),s=a(8794),r=(a(6062),a(5048)),o=a(1962),l=a(2846),d=a(6382),u=a(2221),c=a(910),h=a(9574),w=a(7865),p=a(6419),g=a(9998),m=a(744),y=a(6777),f=a(4559),R=a(8698),v=a(2924),E=a(6037),I=a(3778);const A=(0,h.m)((e=>e.REMEMBER_GROUP_RUNTIME?new c.F("lastGroup",i.s6,{storageArea:"session"}):new c.F("lastGroup",i.s6,{storageArea:"local"}))),_=new class extends d.c{_id=-1;get id(){return this._id}set id(e){this._id=l.M.groupById(e)?.id,(0,v.J)(this._id)}initPromiseResolver=(0,i.NU)();promise=this.initPromiseResolver.promise;di;activateFromEventWithDelay=this.createDelayedActivationEventHandler(600);constructor(){super()}async initialize(e){this.di=e;const t=window.location.hash;await l.M.promise,l.M.isEmpty()&&await m.b,this.id=this.extractHashGroupId(t),t||(u.lw.REMEMBER_GROUP?(0,n.J)(await A(u.lw).get().catch(i.s6),(e=>this.id=e)):(0,n.J)(await s.ne.get(),(e=>this.id=e))),window.addEventListener("hashchange",(e=>this.onHashChange(e)),!1),window.addEventListener("change_active_group",(e=>this.activate(e.detail))),await w.W;const a=(0,f.O1)();if(u.lw.SCROLL_GROUPS&&(a.onwheel=(0,f.uT)().onwheel=async e=>{if(e.buttons!==y.w.RIGHT&&e.composedPath().find((e=>e instanceof HTMLElement&&["dials-container","groups"].includes(e.id)))){const t=u.lw.SCROLL_GROUPS_REVERSE?-1:1,a=((e.deltaY||e.deltaX||e.deltaZ)>0?1:-1)*t,i=_.getCurrentGroup(),n=await i.getNeighbouringGroup(a>0?"next":"prev",u.lw.SCROLL_GROUPS_CIRCLE?"loop":"stay");n&&_.activate(n.id)}}),u.lw.ACTIVATE_GROUP_HOVER){const e=(0,R.U)(u.lw.ACTIVATE_GROUP_HOVER_DELAY);a.addEventListener("mouseover",(t=>(0,n.J)((0,r.rm)(t),(t=>e((()=>this.activate(t))))))),a.addEventListener("mouseleave",(()=>e.cancel()))}super.notifyChange(this.id),this.initPromiseResolver.resolve()}async updateActiveGroupAndRedraw(e){this.id=e,u.lw.REMEMBER_GROUP&&A(u.lw).set(e),await this.di.redrawDials(),(0,E.R)(e),super.notifyChange(e)}async onHashChange(e){const t=this.extractHashGroupId(e.newURL);t!==this.id&&await this.updateActiveGroupAndRedraw(t)}async activate(e,t=!1){await this.promise;l.M.GROUPS.find((t=>t.id===e))&&(e!==this.id||t)&&(window.location.hash=(0,r._V)(e),await this.updateActiveGroupAndRedraw(e),(0,f.O1)().dispatchEvent(new CustomEvent("change",{detail:e})))}activateFromEvent(e){0===e.button&&(0,n.J)((0,r.rm)(e),(e=>this.activate(e)))}createDelayedActivationEventHandler(e){let t,a=null,i=!1,s=Date.now();return(o,l)=>{0===o.button&&(0,n.J)(l??(0,r.rm)(o),(n=>{const r=Date.now();a!==n||r-s>e?(i=!1,a=n,clearTimeout(t),t=self.setTimeout((()=>i=!0),e)):i&&this.activate(n),s=r}))}}getCurrentGroup(){return l.M.groupById(this.id)}dialById(e){const t=this.getCurrentGroup(),a=t.dials,i=(0,r.om)(e);if(t.topSites)return new p.O(i,t.id,{name:"",url:(0,o.$H)(e).href});const n=a[i];return n}extractHashGroupId(e){e=e||"";const t=(0,r.m4)(e);let a=l.M.groupById(t);return!g.Jk&&a.topSites&&(a=l.M.GROUPS.find((e=>!e.topSites))||a),u.lw.GROUP_ICON_IN_TITLE&&(0,I.i)(a.iconId||0),a.id}}},6810:(e,t,a)=>{a.d(t,{O:()=>u,g:()=>c});var i=a(6801),n=a(1879),s=a(4323),r=a(4214),o=a(3700),l=a(9439);const d=new o.j;async function u(e){if(l.vt)return;const t=await(0,i._z)({type:"reload_get_running_for_group",groupId:n.e.id}).catch(s.s6)||[],a=(0,r.W)(t,"url"),o=d.get(e.id);e.dials.forEach(((e,t)=>{const i=e.url||"",n=a[i],s=n?.isVisibleSpin&&!e.isLiveDial();s&&o.delete(i),e.setSpinner(s||o.has(i))}))}function c(e){l.vt||(d.add(e.groupId,e.url),(0,s.BK)(1e3).then((()=>{d.remove(e.groupId,e.url),e.groupId===n.e.id&&u(n.e.getCurrentGroup())})),e.setSpinner())}},6064:(e,t,a)=>{a.r(t),a.d(t,{reloadService:()=>Y});var i=a(6683),n=a(2924),s=a(9510),r=a(5772),o=a(1374),l=a(6801),d=a(3380),u=a(2399),c=a(6810),h=a(683),w=a(2857),p=a(2846),g=a(2221),m=a(1009),y=a(5524),f=a(4099),R=a(6663),v=a(8289),E=a(3694);class I{groupId;url;dial;dialsEnvironment;type;delay;isManualReload;isVisibleSpin;refreshMethod;value;cloud;isGroupDial;lastRunTime;nextRunTime;constructor(e,t,a,i,n,s,r=0,o,l,d,u,c){this.groupId=t,this.url=a,this.dial=i,this.dialsEnvironment=n,this.type=s,this.delay=r,this.isManualReload=o,this.isVisibleSpin=l,this.refreshMethod=d,this.value=u,this.cloud=c,this.isGroupDial=(0,v.Z)(a),this.lastRunTime=e[this.getKey()]||0,this.nextRunTime=this.getNextScheduleTime()}getKey(){return I.getKey(this)}static getKey(e){return e.groupId+e.url}getNextScheduleTime(){const e=new Date,t=e.getTime(),a=this.value||Number.MAX_SAFE_INTEGER,[n,s,r]=(0,E.Xm)(a),o=this.lastRunTime;function l(e){const a=(0,E.dR)(e,n,s,r).getTime(),i=(0,E.dR)(e-7,n,s,r).getTime(),l=(0,E.dR)(e+7,n,s,r).getTime();return a<t?o<a?t:l:o<i?t:a}switch(this.type){case i.kw.ReloadEvery:return o+1e3*a;case i.kw.Daily:{const e=(new Date).setHours(n,s,r,0),a=(new Date).setHours(n-24,s,r,0),i=(new Date).setHours(n+24,s,r,0);return e<t?o<e?t:i:o<a?t:e}case i.kw.Monthly:{const a=(0,E.aG)(new Date,(e=>{e.setDate(1),e.setHours(n,s,r,0)})),i=(0,E.aG)(new Date,(e=>{e.setDate(0),e.setDate(1),e.setHours(n,s,r,0)})),l=new Date(e.getFullYear(),e.getMonth()+1,1,n,s,r,0).getTime();return a<t?o<a?t:l:o<i?t:a}case i.kw.WeekDays:return Math.min(...[1,2,3,4,5].map(l));case i.kw.Weekends:return Math.min(...[0,6].map(l));case i.kw.Monday:return l(1);case i.kw.Tuesday:return l(2);case i.kw.Wednesday:return l(3);case i.kw.Thursday:return l(4);case i.kw.Friday:return l(5);case i.kw.Saturday:return l(6);case i.kw.Sunday:return l(0);default:return}}}var A=a(9598),_=a(9439),b=a(4352),D=a(9574),P=a(7384),S=a(865),T=a(416),G=a(5444),O=a(6836),M=a(1305);var U=a(8063),k=a(1434),H=a(235),L=a(9180),C=a(7700);const B=(0,D.m)((async()=>{if(!self.OffscreenCanvas)return!1;const e=new self.OffscreenCanvas(2,2),t=e.getContext("2d");t.fillStyle="rgb(255, 0, 0)",t.fillRect(0,0,1,1);const a="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAIAAAACCAYAAABytg0kAAAAFElEQVQIW2P8z8Dwn5GBgRGIIQAAHyUCAymYnnsAAAAASUVORK5CYII="===await(0,C.G)(await e.convertToBlob({type:"image/png"}));return a}));async function x(){return await B()}var N=a(7632);async function F(e,t){const a=URL.createObjectURL(e),{width:i,height:n}=await(0,N.m)(a),s=await async function(e,t){if(await x())return new self.OffscreenCanvas(e,t);{const a=document.createElementNS("http://www.w3.org/1999/xhtml","html:canvas");return a.width=e,a.height=t,a}}(i,n);return s.getContext("2d").drawImage(await createImageBitmap(e),0,0),await async function(e,t,a){return"convertToBlob"in e?e.convertToBlob({type:t,quality:a}):new Promise(((i,n)=>e.toBlob((e=>e?i(e):n(Error("empty blob!"))),t,a)))}(s,"image/webp",t)}var V=a(539);class z{groupId;dial;reload;constructor(e,t,a){this.groupId=e,this.dial=t,this.reload=a}}class W{executeSynchronously;actions;constructor(e,t){this.executeSynchronously=e,this.actions=t}async execute(){return this.executeSynchronously?(0,h.f)(this.actions.map((e=>e.reload)),{ignoreExceptions:!0}):Promise.all(this.actions.map((e=>e.reload())))}}const Y=new class{async refreshAllDials(e=i.Up.REFRESH_ALL,t=R.P.default){if(e===i.Up.REFRESH_THIS_GROUP)await(await this.refreshAllDialsInGroup(p.M.groupById(n.H),e,t)).execute();else{const a=await Promise.all(p.M.GROUPS.map((a=>this.refreshAllDialsInGroup(a,e,t,{scheduleParent:!1})))),i=a.flatMap((e=>e.actions)),{true:n,false:s}=(0,d.eg)(i,(e=>e.dial.isGroupDial()));await new W(a[0].executeSynchronously,[...s,...n.reverse()]).execute()}}async refreshAllDialsInGroup(e,t=i.Up.REFRESH_MISSING,a=R.P.default,{scheduleParent:n=!0}={}){const l=e.id,d=await(0,s.$)(l).catch((()=>({}))),u=e.dials.filter((e=>e.canHaveThumbnail()&&(t!==i.Up.REFRESH_MISSING||!d[e.url])&&(t!==i.Up.REFRESH_AUTO_RELOAD||e.reload)&&(t!==i.Up.REFRESH_GROUP_DIALS||e.type===i.kh.GROUP))).sort((0,r.s)("type")),c=await(0,o.dS)(u,(async e=>!await e.hasCustomThumbnail()));switch(a===R.P.default?g.lw.DEFAULT_RELOAD_METHOD??R.P.background:a){case R.P.hiddenVisit:return new W(!0,c.map((e=>new z(l,e,(()=>this.reloadDial(e,l,{method:R.P.hiddenVisit,scheduleParent:n}))))));case R.P.visit:return new W(!0,c.map((e=>new z(l,e,(()=>this.reloadDial(e,l,{method:R.P.visit,scheduleParent:n}))))));default:case R.P.background:return new W(!1,c.map((e=>new z(l,e,(()=>this.reloadDial(e,l,{method:R.P.background,scheduleParent:n}))))))}}async reloadDial(e,t=n.H,{method:a=g.lw.DEFAULT_RELOAD_METHOD,invisible:i=!1,scheduleParent:s=!0,delay:r=g.lw.BY_VISIT_DELAY||1200,alignLeft:o=!1,screenshotId:d}={}){const h=e.url;if(!h||await e.hasCustomThumbnail())return;if(p.M.groupById(t).list)try{await p.M.action("updateDialNameIfNeeded",{groupId:t,url:h,newName:await(0,m.E)(h)}),(0,f.O)(t,h)}catch(e){(0,y.vV)("reload dial",e)}else{if((0,w.g)(e,t),await(0,l._z)({type:"createThumbnailForBlockedPage",groupId:t,url:e.url}));else{e.domId&&!i&&t===n.H&&(0,c.g)(e);const s=(0,V.c)();switch(a){case R.P.hiddenVisit:await(0,l._z)({type:"by_visit_invisible",groupId:t,url:h,reloadOptions:{dialsEnvironment:s,invisible:i,manual:!0}});break;case R.P.visit:await(0,l._z)({type:"take_screen",groupId:t,url:h,dialsEnvironment:s,dialSize:e.size,delay:r,alignLeft:!!o,screenshotId:d});break;default:case R.P.default:case R.P.background:if(await this.tryLookupImage(h,t))break;await this.reloadHere(e,t,i)}}s&&(0,u.D)(t,e)}}buildReloaderIframe=(0,D.m)((async()=>{const e=document.body.appendChild((0,A.z)("iframe",{src:_.CX,class:"reloading_iframe"}));return await(0,P.p)(S.aU,(async()=>{})),e}));async reloadHere(e,t=n.H,a=!1){await this.buildReloaderIframe();await(0,T.$)((t=>{e.url?.includes("youtube")&&browser.tabs.update(S.aU,{muted:t})}),(async()=>{const i=new I({},t,e.url,e,(0,V.c)(),-1,e?.reload?.delay,!0,!a,R.P.background);await(0,l._z)({type:"selfMessage",message:{type:"reload_work",work:i}}),(0,b.L)(i.groupId)}))}async tryLookupImage(e,t){const a=(0,G.N)(e);if(g.lw.AUTO_THUMBNAIL_PAGES.split("\n").includes(a)){const a=await async function(e){const t=await(await(0,U.F)(e)).text(),[{nodes:a}]=await(0,k.$)(t,[{query:'meta[property="og:image"]',attributes:["content"]}]),i=a?.at(0)?.content;if(i)try{const e=await fetch(i,{signal:(0,H.n)((0,L.n)(12))});if(e.ok){const t=await e.blob(),a=t.size<2e6&&t.type.startsWith("image")?t:void 0,i=a&&new RegExp("^image/(png|bmp)").test(a.type)?await F(a,1):a;return i&&i.size<a.size?i:a}}catch(e){}}(e);if(a){await async function(e,t,a){if(!a)return;const i="string"==typeof a?await(0,O.XZ)(a):a;return await M.i.withDB((async a=>{(await a.updateDial(e,t,(e=>{e.imgBlob=i,delete e.hash}))).iconBlob||(0,f.O)(e,t)}))}(t,e,a);const n=p.M.dialByUrl(t,e);return n.thumbnail=Object.assign(n.thumbnail||{},{type:i.O8.AUTO_GENERATED,value:0,position:g.lw.AUTO_THUMBNAIL_POSITION}),await p.M.action("replaceDial",{groupId:t,dial:n}),await p.M.action("updateDialNameIfNeeded",{groupId:t,url:e,newName:await(0,m.E)(e)}),(0,b.L)(t),!0}}return!1}async parentReload(e,t){const a=p.M.groupById(e);for(const i of(0,o.jw)(t)){const t=a.dials.find((e=>e.url===i));t&&await this.reloadDial(t,e,{method:R.P.background,invisible:!0,scheduleParent:!1})}}}},6037:(e,t,a)=>{a.d(t,{R:()=>r});var i=a(8794),n=a(5941),s=a(4069);async function r(e){if(s.m0)return;const t=(await i.SR.get()).filter((([t])=>t===e));t.length&&(await i.SR.update((t=>t.filter((([t])=>t!==e)))),await(await(0,n.w)()).parentReload(e,t.map((([,e])=>e))))}},539:(e,t,a)=>{function i(){return{devicePixelRatio:window.devicePixelRatio}}a.d(t,{c:()=>i}),(0,a(2031).g)("non-background")},9439:(e,t,a)=>{a.d(t,{CX:()=>d,i7:()=>c,vt:()=>u});var i=a(7302),n=a(1319),s=a(4069),r=a(2036),o=a(2221),l=a(1792);const d=(0,i.Z)("reload/reload.html"),u=(0,n.G)()&&r.Dg;function c(e){const t=e?.DIAL_PADDING??o.lw.DIAL_PADDING;return u&&s.m0?Math.max(32,5*t):l.b?t/2:t}},3380:(e,t,a)=>{function i(e,t){const a=[],i=[];for(let n=0;n<e.length;n++){const s=e[n];(t(s,n)?a:i).push(s)}return{true:a,false:i}}function n(e,t,a={}){for(let i=0;i<e.length;i++){const n=e[i],s=String(t(n,i)),r=a[s];r?r.push(n):a[s]=[n]}return a}a.d(t,{$z:()=>n,eg:()=>i})},7632:(e,t,a)=>{function i(e){return new Promise(((t,a)=>{let i=new Image;i.onload=()=>t({width:i.naturalWidth,height:i.naturalHeight}),i.onerror=()=>t({width:0,height:0}),i.src=e}))}a.d(t,{m:()=>i})},6836:(e,t,a)=>{a.d(t,{XZ:()=>i});a(6062);const i=async e=>(await fetch(e)).blob()},3700:(e,t,a)=>{a.d(t,{j:()=>i});class i extends Map{options;constructor(e={}){super(e.entries||e.iterable),this.options=e}get(e){const t=super.get(e),a=t||new Set;return t||super.set(e,a),a}add(e,t){const a=this.get(e);return a.add(t),super.set(e,a)}remove(e,t){const a=this.get(e);return a.delete(t),super.set(e,a)}map(e){const t=new i;for(const[a,i]of this){const n=new Set;let s=0;for(const t of i)n.add(e(t,s++,a));t.set(a,n)}return t}}}}]);