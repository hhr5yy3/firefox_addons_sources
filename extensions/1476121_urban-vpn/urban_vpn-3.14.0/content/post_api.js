(()=>{"use strict";var e={99959:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0});const n=s(63442);t.MarioEvent=class{constructor(e,t,s){this.event=e,this.data=t,this.id=s||n.Guid.create().toString()}}},27932:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0});t.ContentDispatcherService=class{constructor(){this.listeners={},this.listenersIndex={},this.counter=0,chrome.runtime.onMessage.addListener((e=>{if(!this.isEventMessage(e))return;if(!this.hasEventListeners(e.event))return;const t=[],s=this.listeners[e.event];for(const n of Object.keys(s)){const r=(0,s[n])(e);t.push(r)}return Promise.all(t).then(),!1}))}emit(e,t){chrome.runtime.sendMessage(e,t)}on(e,t){const s=++this.counter;return this.hasEventListeners(e)||(this.listeners[e]={}),this.listeners[e][s]=t,this.listenersIndex[s]=e,s}hasEventListeners(e){return void 0!==this.listeners[e]}removeListener(e){if(this.hasListener(e)){const t=this.listenersIndex[e];delete this.listeners[t][e],delete this.listenersIndex[e]}}hasListener(e){return this.listenersIndex.hasOwnProperty(e)}getListener(e){if(!this.hasListener(e))throw new Error("boom");const t=this.listenersIndex[e];return this.listeners[t][e]}isEventMessage(e){return"object"==typeof e&&"string"==typeof e.event}}},19576:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),function(e){e.RESPONSE="WINDOW_POST_MESSAGE_RESPONSE",e.EVENT="WINDOW_POST_MESSAGE_EVENT"}(t.PostBgEvents||(t.PostBgEvents={}))},59889:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0});t.PostClient=class{constructor(e,t){this.name=e,this.destination=t,this.serverListeners={},this.bgRequestsListeners={},this.bgEventsListeners={},window.addEventListener("message",(e=>{const t=e.data,s=!(t.destination&&t.destination===this.name),n=!t.event;if(!s&&!n)if("MARIO_POST_SERVER__BG_RESPONSE"===t.event){const e=t.args;if(this.hasBgRequestListener(e.requestId)){try{this.bgRequestsListeners[e.requestId](e.response)}catch(e){}delete this.bgRequestsListeners[e.requestId]}}else if("MARIO_POST_SERVER__BG_EVENT"===t.event){const e=t.args;if(this.hasBgEventListener(e.event))try{this.bgEventsListeners[t.id](e.payload)}catch(e){}}else if(this.hasServerListener(t.event))try{this.serverListeners[t.event](t.args)}catch(e){}}))}emitToServer(e,t){const s=this.generateUIID(),n={args:t,destination:this.destination,event:e,id:s};return window.postMessage(n,location.origin),s}emitToBg(e,t){const s=this.generateUIID(),n={bgEventName:e,requestId:s,args:t};return this.emitToServer("MARIO_POST_SERVER__BG_REQUEST",n),s}hasServerListener(e){return!!this.serverListeners[e]}hasBgRequestListener(e){return!!this.bgRequestsListeners[e]}hasBgEventListener(e){return!!this.bgEventsListeners[e]}fromServerEvent(e,t){this.serverListeners[e]=t}fromBgEvent(e,t){this.bgEventsListeners[e]=t}fromBgResponse(e,t){this.bgRequestsListeners[e]=t}generateUIID(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(function(e){const t=16*Math.random()|0;return("x"===e?t:3&t|8).toString(16)}))}}},7995:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),function(e){e.BG_REQUEST="MARIO_POST_SERVER__BG_REQUEST"}(t.PostClientEvents||(t.PostClientEvents={}))},29828:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0});t.PostHelper=class{static serverName(){return`MARIO_POST_SERVER_${chrome.runtime.id}`}static clientName(){return`MARIO_POST_CLIENT_${chrome.runtime.id}`}}},26258:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0});const n=s(19576),r=s(99959),i=s(52429),o=s(63442),a=s(7995);t.PostServer=class{constructor(e,t,s){this.name=e,this.destination=t,this.dispatcher=s,this.listeners={},window.addEventListener("message",(e=>{const t=e.data,s=!(t.destination&&t.destination===this.name),n=!t.event;if(!s&&!n)if(t.event===a.PostClientEvents.BG_REQUEST){const e=t.args;this.dispatcher.emit(new r.MarioEvent(e.bgEventName,e.args,e.requestId))}else this.hasClientListener(t.event)&&this.listeners[t.event](t.args)})),this.dispatcher.on(n.PostBgEvents.RESPONSE,(e=>{const t=e.data,s={requestId:e.id,response:t.response};this.emitToClient(i.PostServerEvents.BG_RESPONSE,s)})),this.dispatcher.on(n.PostBgEvents.EVENT,(e=>{const t=e.data,s={event:t.event,payload:t.payload};this.emitToClient(i.PostServerEvents.BG_EVENT,s)}))}emitToClient(e,t){const s={args:t,destination:this.destination,event:e,id:o.Guid.create().toString()};window.postMessage(s,location.origin)}fromClient(e,t){this.listeners[e]=t}hasClientListener(e){return!!this.listeners[e]}}},52429:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),function(e){e.BG_RESPONSE="MARIO_POST_SERVER__BG_RESPONSE",e.BG_EVENT="MARIO_POST_SERVER__BG_EVENT"}(t.PostServerEvents||(t.PostServerEvents={}))},63442:(e,t)=>{t.__esModule=!0;var s=function(){function e(t){if(!t)throw new TypeError("Invalid argument; `value` has no value.");this.value=e.EMPTY,t&&e.isGuid(t)&&(this.value=t)}return e.isGuid=function(t){var s=t.toString();return t&&(t instanceof e||e.validator.test(s))},e.create=function(){return new e([e.gen(2),e.gen(1),e.gen(1),e.gen(1),e.gen(3)].join("-"))},e.createEmpty=function(){return new e("emptyguid")},e.parse=function(t){return new e(t)},e.raw=function(){return[e.gen(2),e.gen(1),e.gen(1),e.gen(1),e.gen(3)].join("-")},e.gen=function(e){for(var t="",s=0;s<e;s++)t+=(65536*(1+Math.random())|0).toString(16).substring(1);return t},e.prototype.equals=function(t){return e.isGuid(t)&&this.value===t.toString()},e.prototype.isEmpty=function(){return this.value===e.EMPTY},e.prototype.toString=function(){return this.value},e.prototype.toJSON=function(){return{value:this.value}},e.validator=new RegExp("^[a-z0-9]{8}-[a-z0-9]{4}-[a-z0-9]{4}-[a-z0-9]{4}-[a-z0-9]{12}$","i"),e.EMPTY="00000000-0000-0000-0000-000000000000",e}();t.Guid=s}},t={};function s(n){var r=t[n];if(void 0!==r)return r.exports;var i=t[n]={exports:{}};return e[n](i,i.exports,s),i.exports}(()=>{const e=s(27932),t=s(59889),n=s(26258),r=s(29828);if("text/html"===document.contentType){const s=new e.ContentDispatcherService,i=r.PostHelper.serverName(),o=r.PostHelper.clientName(),a=new n.PostServer(i,o,s);window[Symbol.for(i)]=a;const u=document.createElement("script");u.innerHTML=`\n    window[Symbol.for('${o}')] = new (${t.PostClient.toString()})('${o}', '${i}')`,u.async=!1,document.documentElement.appendChild(u)}})()})();