class URLSaver{constructor(){this.#initShortcut(),this.#registerRuntimeChannel(),eagle.shortcuts.changed(()=>{this.#initShortcut()})}async saveURL(){let t=this.#getSiteInfo();var e,i,a;t.videoThumb?(t.src=await eagle.utils.urlToBase64(t.videoThumb,1e4),t.width=t.videoWidth,t.height=t.videoHeight):(t.src=await eagle.screenCapturer.captureCurrentTab({format:"jpeg",quality:85}),t.width=document.documentElement.clientWidth,t.height=document.documentElement.clientHeight,t.src&&({base64:e,width:i,height:a}=await eagle.utils.resizeBase64ImageToMaxSize(t.src,720),t.src=e,t.width=i,t.height=a)),eagle.env.shouldShowNewCollectWindow()?eagle.collectWindow.open({...t,onCollect:e=>{eagle.item.addURL({...t,...e})}}):eagle.item.addURL(t)}#registerRuntimeChannel(){eagle.runtime.onMessage("save-url",async(e,t,i)=>{if(await eagle.env.isReady())return await this.saveURL(),i(),!0})}#initShortcut(){var e;eagle.preference.keybindings["url-save"]&&(e=eagle.preference.keybindings["url-save"].replace(/\s/g,"").toLowerCase(),Mousetrap.bind(e,eagle.utils.debounce(async e=>{if(await eagle.env.isReady())return e.preventDefault(),await this.saveURL(),!1},500,!0)))}#getSiteInfo(){var{metaTags:e,metaTitle:t,metaDescription:i,metaKeywords:a}=eagle.siteParser.getMeta(),{videoID:r,videoWidth:s,videoHeight:o,videoMedium:l,videoThumb:n,videoDuration:d,videoEmbed:u}=eagle.siteParser.getVideoMeta(),e={behavior:"save-url",type:"save-url",url:location.href,metaTags:e,metaTitle:t,metaDescription:i,metaKeywords:a,title:(t||eagle.utils.clearWeirdCharacters(document.title)).substr(0,65)};return(r||s||o||l||n)&&(e.videoID=r,e.videoWidth=s,e.videoHeight=o,e.medium=l,e.videoThumb=n),d&&(e.videoDuration=d),u&&(e.videoEmbed=u),e}}eagle.preference.ready(()=>{eagle.urlSaver=new URLSaver});